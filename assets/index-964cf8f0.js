(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const C of document.querySelectorAll('link[rel="modulepreload"]'))c(C);new MutationObserver(C=>{for(const O of C)if(O.type==="childList")for(const F of O.addedNodes)F.tagName==="LINK"&&F.rel==="modulepreload"&&c(F)}).observe(document,{childList:!0,subtree:!0});function w(C){const O={};return C.integrity&&(O.integrity=C.integrity),C.referrerPolicy&&(O.referrerPolicy=C.referrerPolicy),C.crossOrigin==="use-credentials"?O.credentials="include":C.crossOrigin==="anonymous"?O.credentials="omit":O.credentials="same-origin",O}function c(C){if(C.ep)return;C.ep=!0;const O=w(C);fetch(C.href,O)}})();const style="",index="",_null="";function _assertThisInitialized(K){if(K===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return K}function _inheritsLoose(K,A){K.prototype=Object.create(A.prototype),K.prototype.constructor=K,K.__proto__=A}/*!
 * GSAP 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _config={autoSleep:120,force3D:"auto",nullTargetWarn:1,units:{lineHeight:""}},_defaults$1={duration:.5,overwrite:!1,delay:0},_suppressOverwrites$1,_reverting$1,_context$2,_bigNum$1=1e8,_tinyNum=1/_bigNum$1,_2PI=Math.PI*2,_HALF_PI=_2PI/4,_gsID=0,_sqrt=Math.sqrt,_cos=Math.cos,_sin=Math.sin,_isString$1=function(A){return typeof A=="string"},_isFunction$1=function(A){return typeof A=="function"},_isNumber$1=function(A){return typeof A=="number"},_isUndefined=function(A){return typeof A>"u"},_isObject$1=function(A){return typeof A=="object"},_isNotFalse=function(A){return A!==!1},_windowExists$2=function(){return typeof window<"u"},_isFuncOrString=function(A){return _isFunction$1(A)||_isString$1(A)},_isTypedArray=typeof ArrayBuffer=="function"&&ArrayBuffer.isView||function(){},_isArray=Array.isArray,_strictNumExp=/(?:-?\.?\d|\.)+/gi,_numExp=/[-+=.]*\d+[.e\-+]*\d*[e\-+]*\d*/g,_numWithUnitExp=/[-+=.]*\d+[.e-]*\d*[a-z%]*/g,_complexStringNumExp=/[-+=.]*\d+\.?\d*(?:e-|e\+)?\d*/gi,_relExp=/[+-]=-?[.\d]+/,_delimitedValueExp=/[^,'"\[\]\s]+/gi,_unitExp=/^[+\-=e\s\d]*\d+[.\d]*([a-z]*|%)\s*$/i,_globalTimeline,_win$3,_coreInitted$2,_doc$3,_globals={},_installScope={},_coreReady,_install=function(A){return(_installScope=_merge(A,_globals))&&gsap$2},_missingPlugin=function(A,w){return console.warn("Invalid property",A,"set to",w,"Missing plugin? gsap.registerPlugin()")},_warn=function(A,w){return!w&&console.warn(A)},_addGlobal=function(A,w){return A&&(_globals[A]=w)&&_installScope&&(_installScope[A]=w)||_globals},_emptyFunc=function(){return 0},_startAtRevertConfig={suppressEvents:!0,isStart:!0,kill:!1},_revertConfigNoKill={suppressEvents:!0,kill:!1},_revertConfig={suppressEvents:!0},_reservedProps={},_lazyTweens=[],_lazyLookup={},_lastRenderedFrame,_plugins={},_effects={},_nextGCFrame=30,_harnessPlugins=[],_callbackNames="",_harness=function(A){var w=A[0],c,C;if(_isObject$1(w)||_isFunction$1(w)||(A=[A]),!(c=(w._gsap||{}).harness)){for(C=_harnessPlugins.length;C--&&!_harnessPlugins[C].targetTest(w););c=_harnessPlugins[C]}for(C=A.length;C--;)A[C]&&(A[C]._gsap||(A[C]._gsap=new GSCache(A[C],c)))||A.splice(C,1);return A},_getCache=function(A){return A._gsap||_harness(toArray(A))[0]._gsap},_getProperty=function(A,w,c){return(c=A[w])&&_isFunction$1(c)?A[w]():_isUndefined(c)&&A.getAttribute&&A.getAttribute(w)||c},_forEachName=function(A,w){return(A=A.split(",")).forEach(w)||A},_round$1=function(A){return Math.round(A*1e5)/1e5||0},_roundPrecise=function(A){return Math.round(A*1e7)/1e7||0},_parseRelative=function(A,w){var c=w.charAt(0),C=parseFloat(w.substr(2));return A=parseFloat(A),c==="+"?A+C:c==="-"?A-C:c==="*"?A*C:A/C},_arrayContainsAny=function(A,w){for(var c=w.length,C=0;A.indexOf(w[C])<0&&++C<c;);return C<c},_lazyRender=function(){var A=_lazyTweens.length,w=_lazyTweens.slice(0),c,C;for(_lazyLookup={},_lazyTweens.length=0,c=0;c<A;c++)C=w[c],C&&C._lazy&&(C.render(C._lazy[0],C._lazy[1],!0)._lazy=0)},_lazySafeRender=function(A,w,c,C){_lazyTweens.length&&!_reverting$1&&_lazyRender(),A.render(w,c,C||_reverting$1&&w<0&&(A._initted||A._startAt)),_lazyTweens.length&&!_reverting$1&&_lazyRender()},_numericIfPossible=function(A){var w=parseFloat(A);return(w||w===0)&&(A+"").match(_delimitedValueExp).length<2?w:_isString$1(A)?A.trim():A},_passThrough$1=function(A){return A},_setDefaults$1=function(A,w){for(var c in w)c in A||(A[c]=w[c]);return A},_setKeyframeDefaults=function(A){return function(w,c){for(var C in c)C in w||C==="duration"&&A||C==="ease"||(w[C]=c[C])}},_merge=function(A,w){for(var c in w)A[c]=w[c];return A},_mergeDeep=function K(A,w){for(var c in w)c!=="__proto__"&&c!=="constructor"&&c!=="prototype"&&(A[c]=_isObject$1(w[c])?K(A[c]||(A[c]={}),w[c]):w[c]);return A},_copyExcluding=function(A,w){var c={},C;for(C in A)C in w||(c[C]=A[C]);return c},_inheritDefaults=function(A){var w=A.parent||_globalTimeline,c=A.keyframes?_setKeyframeDefaults(_isArray(A.keyframes)):_setDefaults$1;if(_isNotFalse(A.inherit))for(;w;)c(A,w.vars.defaults),w=w.parent||w._dp;return A},_arraysMatch=function(A,w){for(var c=A.length,C=c===w.length;C&&c--&&A[c]===w[c];);return c<0},_addLinkedListItem=function(A,w,c,C,O){c===void 0&&(c="_first"),C===void 0&&(C="_last");var F=A[C],G;if(O)for(G=w[O];F&&F[O]>G;)F=F._prev;return F?(w._next=F._next,F._next=w):(w._next=A[c],A[c]=w),w._next?w._next._prev=w:A[C]=w,w._prev=F,w.parent=w._dp=A,w},_removeLinkedListItem=function(A,w,c,C){c===void 0&&(c="_first"),C===void 0&&(C="_last");var O=w._prev,F=w._next;O?O._next=F:A[c]===w&&(A[c]=F),F?F._prev=O:A[C]===w&&(A[C]=O),w._next=w._prev=w.parent=null},_removeFromParent=function(A,w){A.parent&&(!w||A.parent.autoRemoveChildren)&&A.parent.remove(A),A._act=0},_uncache=function(A,w){if(A&&(!w||w._end>A._dur||w._start<0))for(var c=A;c;)c._dirty=1,c=c.parent;return A},_recacheAncestors=function(A){for(var w=A.parent;w&&w.parent;)w._dirty=1,w.totalDuration(),w=w.parent;return A},_rewindStartAt=function(A,w,c,C){return A._startAt&&(_reverting$1?A._startAt.revert(_revertConfigNoKill):A.vars.immediateRender&&!A.vars.autoRevert||A._startAt.render(w,!0,C))},_hasNoPausedAncestors=function K(A){return!A||A._ts&&K(A.parent)},_elapsedCycleDuration=function(A){return A._repeat?_animationCycle(A._tTime,A=A.duration()+A._rDelay)*A:0},_animationCycle=function(A,w){var c=Math.floor(A/=w);return A&&c===A?c-1:c},_parentToChildTotalTime=function(A,w){return(A-w._start)*w._ts+(w._ts>=0?0:w._dirty?w.totalDuration():w._tDur)},_setEnd=function(A){return A._end=_roundPrecise(A._start+(A._tDur/Math.abs(A._ts||A._rts||_tinyNum)||0))},_alignPlayhead=function(A,w){var c=A._dp;return c&&c.smoothChildTiming&&A._ts&&(A._start=_roundPrecise(c._time-(A._ts>0?w/A._ts:((A._dirty?A.totalDuration():A._tDur)-w)/-A._ts)),_setEnd(A),c._dirty||_uncache(c,A)),A},_postAddChecks=function(A,w){var c;if((w._time||w._initted&&!w._dur)&&(c=_parentToChildTotalTime(A.rawTime(),w),(!w._dur||_clamp$1(0,w.totalDuration(),c)-w._tTime>_tinyNum)&&w.render(c,!0)),_uncache(A,w)._dp&&A._initted&&A._time>=A._dur&&A._ts){if(A._dur<A.duration())for(c=A;c._dp;)c.rawTime()>=0&&c.totalTime(c._tTime),c=c._dp;A._zTime=-_tinyNum}},_addToTimeline=function(A,w,c,C){return w.parent&&_removeFromParent(w),w._start=_roundPrecise((_isNumber$1(c)?c:c||A!==_globalTimeline?_parsePosition$1(A,c,w):A._time)+w._delay),w._end=_roundPrecise(w._start+(w.totalDuration()/Math.abs(w.timeScale())||0)),_addLinkedListItem(A,w,"_first","_last",A._sort?"_start":0),_isFromOrFromStart(w)||(A._recent=w),C||_postAddChecks(A,w),A._ts<0&&_alignPlayhead(A,A._tTime),A},_scrollTrigger=function(A,w){return(_globals.ScrollTrigger||_missingPlugin("scrollTrigger",w))&&_globals.ScrollTrigger.create(w,A)},_attemptInitTween=function(A,w,c,C,O){if(_initTween(A,w,O),!A._initted)return 1;if(!c&&A._pt&&!_reverting$1&&(A._dur&&A.vars.lazy!==!1||!A._dur&&A.vars.lazy)&&_lastRenderedFrame!==_ticker.frame)return _lazyTweens.push(A),A._lazy=[O,C],1},_parentPlayheadIsBeforeStart=function K(A){var w=A.parent;return w&&w._ts&&w._initted&&!w._lock&&(w.rawTime()<0||K(w))},_isFromOrFromStart=function(A){var w=A.data;return w==="isFromStart"||w==="isStart"},_renderZeroDurationTween=function(A,w,c,C){var O=A.ratio,F=w<0||!w&&(!A._start&&_parentPlayheadIsBeforeStart(A)&&!(!A._initted&&_isFromOrFromStart(A))||(A._ts<0||A._dp._ts<0)&&!_isFromOrFromStart(A))?0:1,G=A._rDelay,X=0,te,ue,fe;if(G&&A._repeat&&(X=_clamp$1(0,A._tDur,w),ue=_animationCycle(X,G),A._yoyo&&ue&1&&(F=1-F),ue!==_animationCycle(A._tTime,G)&&(O=1-F,A.vars.repeatRefresh&&A._initted&&A.invalidate())),F!==O||_reverting$1||C||A._zTime===_tinyNum||!w&&A._zTime){if(!A._initted&&_attemptInitTween(A,w,C,c,X))return;for(fe=A._zTime,A._zTime=w||(c?_tinyNum:0),c||(c=w&&!fe),A.ratio=F,A._from&&(F=1-F),A._time=0,A._tTime=X,te=A._pt;te;)te.r(F,te.d),te=te._next;w<0&&_rewindStartAt(A,w,c,!0),A._onUpdate&&!c&&_callback$1(A,"onUpdate"),X&&A._repeat&&!c&&A.parent&&_callback$1(A,"onRepeat"),(w>=A._tDur||w<0)&&A.ratio===F&&(F&&_removeFromParent(A,1),!c&&!_reverting$1&&(_callback$1(A,F?"onComplete":"onReverseComplete",!0),A._prom&&A._prom()))}else A._zTime||(A._zTime=w)},_findNextPauseTween=function(A,w,c){var C;if(c>w)for(C=A._first;C&&C._start<=c;){if(C.data==="isPause"&&C._start>w)return C;C=C._next}else for(C=A._last;C&&C._start>=c;){if(C.data==="isPause"&&C._start<w)return C;C=C._prev}},_setDuration=function(A,w,c,C){var O=A._repeat,F=_roundPrecise(w)||0,G=A._tTime/A._tDur;return G&&!C&&(A._time*=F/A._dur),A._dur=F,A._tDur=O?O<0?1e10:_roundPrecise(F*(O+1)+A._rDelay*O):F,G>0&&!C&&_alignPlayhead(A,A._tTime=A._tDur*G),A.parent&&_setEnd(A),c||_uncache(A.parent,A),A},_onUpdateTotalDuration=function(A){return A instanceof Timeline?_uncache(A):_setDuration(A,A._dur)},_zeroPosition={_start:0,endTime:_emptyFunc,totalDuration:_emptyFunc},_parsePosition$1=function K(A,w,c){var C=A.labels,O=A._recent||_zeroPosition,F=A.duration()>=_bigNum$1?O.endTime(!1):A._dur,G,X,te;return _isString$1(w)&&(isNaN(w)||w in C)?(X=w.charAt(0),te=w.substr(-1)==="%",G=w.indexOf("="),X==="<"||X===">"?(G>=0&&(w=w.replace(/=/,"")),(X==="<"?O._start:O.endTime(O._repeat>=0))+(parseFloat(w.substr(1))||0)*(te?(G<0?O:c).totalDuration()/100:1)):G<0?(w in C||(C[w]=F),C[w]):(X=parseFloat(w.charAt(G-1)+w.substr(G+1)),te&&c&&(X=X/100*(_isArray(c)?c[0]:c).totalDuration()),G>1?K(A,w.substr(0,G-1),c)+X:F+X)):w==null?F:+w},_createTweenType=function(A,w,c){var C=_isNumber$1(w[1]),O=(C?2:1)+(A<2?0:1),F=w[O],G,X;if(C&&(F.duration=w[1]),F.parent=c,A){for(G=F,X=c;X&&!("immediateRender"in G);)G=X.vars.defaults||{},X=_isNotFalse(X.vars.inherit)&&X.parent;F.immediateRender=_isNotFalse(G.immediateRender),A<2?F.runBackwards=1:F.startAt=w[O-1]}return new Tween(w[0],F,w[O+1])},_conditionalReturn=function(A,w){return A||A===0?w(A):w},_clamp$1=function(A,w,c){return c<A?A:c>w?w:c},getUnit=function(A,w){return!_isString$1(A)||!(w=_unitExp.exec(A))?"":w[1]},clamp=function(A,w,c){return _conditionalReturn(c,function(C){return _clamp$1(A,w,C)})},_slice=[].slice,_isArrayLike=function(A,w){return A&&_isObject$1(A)&&"length"in A&&(!w&&!A.length||A.length-1 in A&&_isObject$1(A[0]))&&!A.nodeType&&A!==_win$3},_flatten=function(A,w,c){return c===void 0&&(c=[]),A.forEach(function(C){var O;return _isString$1(C)&&!w||_isArrayLike(C,1)?(O=c).push.apply(O,toArray(C)):c.push(C)})||c},toArray=function(A,w,c){return _context$2&&!w&&_context$2.selector?_context$2.selector(A):_isString$1(A)&&!c&&(_coreInitted$2||!_wake())?_slice.call((w||_doc$3).querySelectorAll(A),0):_isArray(A)?_flatten(A,c):_isArrayLike(A)?_slice.call(A,0):A?[A]:[]},selector=function(A){return A=toArray(A)[0]||_warn("Invalid scope")||{},function(w){var c=A.current||A.nativeElement||A;return toArray(w,c.querySelectorAll?c:c===A?_warn("Invalid scope")||_doc$3.createElement("div"):A)}},shuffle=function(A){return A.sort(function(){return .5-Math.random()})},distribute=function(A){if(_isFunction$1(A))return A;var w=_isObject$1(A)?A:{each:A},c=_parseEase(w.ease),C=w.from||0,O=parseFloat(w.base)||0,F={},G=C>0&&C<1,X=isNaN(C)||G,te=w.axis,ue=C,fe=C;return _isString$1(C)?ue=fe={center:.5,edges:.5,end:1}[C]||0:!G&&X&&(ue=C[0],fe=C[1]),function(de,le,me){var $=(me||w).length,_e=F[$],oe,ge,Se,je,ye,Ne,Z,se,ae;if(!_e){if(ae=w.grid==="auto"?0:(w.grid||[1,_bigNum$1])[1],!ae){for(Z=-_bigNum$1;Z<(Z=me[ae++].getBoundingClientRect().left)&&ae<$;);ae--}for(_e=F[$]=[],oe=X?Math.min(ae,$)*ue-.5:C%ae,ge=ae===_bigNum$1?0:X?$*fe/ae-.5:C/ae|0,Z=0,se=_bigNum$1,Ne=0;Ne<$;Ne++)Se=Ne%ae-oe,je=ge-(Ne/ae|0),_e[Ne]=ye=te?Math.abs(te==="y"?je:Se):_sqrt(Se*Se+je*je),ye>Z&&(Z=ye),ye<se&&(se=ye);C==="random"&&shuffle(_e),_e.max=Z-se,_e.min=se,_e.v=$=(parseFloat(w.amount)||parseFloat(w.each)*(ae>$?$-1:te?te==="y"?$/ae:ae:Math.max(ae,$/ae))||0)*(C==="edges"?-1:1),_e.b=$<0?O-$:O,_e.u=getUnit(w.amount||w.each)||0,c=c&&$<0?_invertEase(c):c}return $=(_e[de]-_e.min)/_e.max||0,_roundPrecise(_e.b+(c?c($):$)*_e.v)+_e.u}},_roundModifier=function(A){var w=Math.pow(10,((A+"").split(".")[1]||"").length);return function(c){var C=_roundPrecise(Math.round(parseFloat(c)/A)*A*w);return(C-C%1)/w+(_isNumber$1(c)?0:getUnit(c))}},snap=function(A,w){var c=_isArray(A),C,O;return!c&&_isObject$1(A)&&(C=c=A.radius||_bigNum$1,A.values?(A=toArray(A.values),(O=!_isNumber$1(A[0]))&&(C*=C)):A=_roundModifier(A.increment)),_conditionalReturn(w,c?_isFunction$1(A)?function(F){return O=A(F),Math.abs(O-F)<=C?O:F}:function(F){for(var G=parseFloat(O?F.x:F),X=parseFloat(O?F.y:0),te=_bigNum$1,ue=0,fe=A.length,de,le;fe--;)O?(de=A[fe].x-G,le=A[fe].y-X,de=de*de+le*le):de=Math.abs(A[fe]-G),de<te&&(te=de,ue=fe);return ue=!C||te<=C?A[ue]:F,O||ue===F||_isNumber$1(F)?ue:ue+getUnit(F)}:_roundModifier(A))},random=function(A,w,c,C){return _conditionalReturn(_isArray(A)?!w:c===!0?!!(c=0):!C,function(){return _isArray(A)?A[~~(Math.random()*A.length)]:(c=c||1e-5)&&(C=c<1?Math.pow(10,(c+"").length-2):1)&&Math.floor(Math.round((A-c/2+Math.random()*(w-A+c*.99))/c)*c*C)/C})},pipe=function(){for(var A=arguments.length,w=new Array(A),c=0;c<A;c++)w[c]=arguments[c];return function(C){return w.reduce(function(O,F){return F(O)},C)}},unitize=function(A,w){return function(c){return A(parseFloat(c))+(w||getUnit(c))}},normalize=function(A,w,c){return mapRange(A,w,0,1,c)},_wrapArray=function(A,w,c){return _conditionalReturn(c,function(C){return A[~~w(C)]})},wrap=function K(A,w,c){var C=w-A;return _isArray(A)?_wrapArray(A,K(0,A.length),w):_conditionalReturn(c,function(O){return(C+(O-A)%C)%C+A})},wrapYoyo=function K(A,w,c){var C=w-A,O=C*2;return _isArray(A)?_wrapArray(A,K(0,A.length-1),w):_conditionalReturn(c,function(F){return F=(O+(F-A)%O)%O||0,A+(F>C?O-F:F)})},_replaceRandom=function(A){for(var w=0,c="",C,O,F,G;~(C=A.indexOf("random(",w));)F=A.indexOf(")",C),G=A.charAt(C+7)==="[",O=A.substr(C+7,F-C-7).match(G?_delimitedValueExp:_strictNumExp),c+=A.substr(w,C-w)+random(G?O:+O[0],G?0:+O[1],+O[2]||1e-5),w=F+1;return c+A.substr(w,A.length-w)},mapRange=function(A,w,c,C,O){var F=w-A,G=C-c;return _conditionalReturn(O,function(X){return c+((X-A)/F*G||0)})},interpolate=function K(A,w,c,C){var O=isNaN(A+w)?0:function(le){return(1-le)*A+le*w};if(!O){var F=_isString$1(A),G={},X,te,ue,fe,de;if(c===!0&&(C=1)&&(c=null),F)A={p:A},w={p:w};else if(_isArray(A)&&!_isArray(w)){for(ue=[],fe=A.length,de=fe-2,te=1;te<fe;te++)ue.push(K(A[te-1],A[te]));fe--,O=function(me){me*=fe;var $=Math.min(de,~~me);return ue[$](me-$)},c=w}else C||(A=_merge(_isArray(A)?[]:{},A));if(!ue){for(X in w)_addPropTween.call(G,A,X,"get",w[X]);O=function(me){return _renderPropTweens(me,G)||(F?A.p:A)}}}return _conditionalReturn(c,O)},_getLabelInDirection=function(A,w,c){var C=A.labels,O=_bigNum$1,F,G,X;for(F in C)G=C[F]-w,G<0==!!c&&G&&O>(G=Math.abs(G))&&(X=F,O=G);return X},_callback$1=function(A,w,c){var C=A.vars,O=C[w],F=_context$2,G=A._ctx,X,te,ue;if(O)return X=C[w+"Params"],te=C.callbackScope||A,c&&_lazyTweens.length&&_lazyRender(),G&&(_context$2=G),ue=X?O.apply(te,X):O.call(te),_context$2=F,ue},_interrupt=function(A){return _removeFromParent(A),A.scrollTrigger&&A.scrollTrigger.kill(!!_reverting$1),A.progress()<1&&_callback$1(A,"onInterrupt"),A},_quickTween,_createPlugin=function(A){A=!A.name&&A.default||A;var w=A.name,c=_isFunction$1(A),C=w&&!c&&A.init?function(){this._props=[]}:A,O={init:_emptyFunc,render:_renderPropTweens,add:_addPropTween,kill:_killPropTweensOf,modifier:_addPluginModifier,rawVars:0},F={targetTest:0,get:0,getSetter:_getSetter,aliases:{},register:0};if(_wake(),A!==C){if(_plugins[w])return;_setDefaults$1(C,_setDefaults$1(_copyExcluding(A,O),F)),_merge(C.prototype,_merge(O,_copyExcluding(A,F))),_plugins[C.prop=w]=C,A.targetTest&&(_harnessPlugins.push(C),_reservedProps[w]=1),w=(w==="css"?"CSS":w.charAt(0).toUpperCase()+w.substr(1))+"Plugin"}_addGlobal(w,C),A.register&&A.register(gsap$2,C,PropTween)},_255=255,_colorLookup={aqua:[0,_255,_255],lime:[0,_255,0],silver:[192,192,192],black:[0,0,0],maroon:[128,0,0],teal:[0,128,128],blue:[0,0,_255],navy:[0,0,128],white:[_255,_255,_255],olive:[128,128,0],yellow:[_255,_255,0],orange:[_255,165,0],gray:[128,128,128],purple:[128,0,128],green:[0,128,0],red:[_255,0,0],pink:[_255,192,203],cyan:[0,_255,_255],transparent:[_255,_255,_255,0]},_hue=function(A,w,c){return A+=A<0?1:A>1?-1:0,(A*6<1?w+(c-w)*A*6:A<.5?c:A*3<2?w+(c-w)*(2/3-A)*6:w)*_255+.5|0},splitColor=function(A,w,c){var C=A?_isNumber$1(A)?[A>>16,A>>8&_255,A&_255]:0:_colorLookup.black,O,F,G,X,te,ue,fe,de,le,me;if(!C){if(A.substr(-1)===","&&(A=A.substr(0,A.length-1)),_colorLookup[A])C=_colorLookup[A];else if(A.charAt(0)==="#"){if(A.length<6&&(O=A.charAt(1),F=A.charAt(2),G=A.charAt(3),A="#"+O+O+F+F+G+G+(A.length===5?A.charAt(4)+A.charAt(4):"")),A.length===9)return C=parseInt(A.substr(1,6),16),[C>>16,C>>8&_255,C&_255,parseInt(A.substr(7),16)/255];A=parseInt(A.substr(1),16),C=[A>>16,A>>8&_255,A&_255]}else if(A.substr(0,3)==="hsl"){if(C=me=A.match(_strictNumExp),!w)X=+C[0]%360/360,te=+C[1]/100,ue=+C[2]/100,F=ue<=.5?ue*(te+1):ue+te-ue*te,O=ue*2-F,C.length>3&&(C[3]*=1),C[0]=_hue(X+1/3,O,F),C[1]=_hue(X,O,F),C[2]=_hue(X-1/3,O,F);else if(~A.indexOf("="))return C=A.match(_numExp),c&&C.length<4&&(C[3]=1),C}else C=A.match(_strictNumExp)||_colorLookup.transparent;C=C.map(Number)}return w&&!me&&(O=C[0]/_255,F=C[1]/_255,G=C[2]/_255,fe=Math.max(O,F,G),de=Math.min(O,F,G),ue=(fe+de)/2,fe===de?X=te=0:(le=fe-de,te=ue>.5?le/(2-fe-de):le/(fe+de),X=fe===O?(F-G)/le+(F<G?6:0):fe===F?(G-O)/le+2:(O-F)/le+4,X*=60),C[0]=~~(X+.5),C[1]=~~(te*100+.5),C[2]=~~(ue*100+.5)),c&&C.length<4&&(C[3]=1),C},_colorOrderData=function(A){var w=[],c=[],C=-1;return A.split(_colorExp).forEach(function(O){var F=O.match(_numWithUnitExp)||[];w.push.apply(w,F),c.push(C+=F.length+1)}),w.c=c,w},_formatColors=function(A,w,c){var C="",O=(A+C).match(_colorExp),F=w?"hsla(":"rgba(",G=0,X,te,ue,fe;if(!O)return A;if(O=O.map(function(de){return(de=splitColor(de,w,1))&&F+(w?de[0]+","+de[1]+"%,"+de[2]+"%,"+de[3]:de.join(","))+")"}),c&&(ue=_colorOrderData(A),X=c.c,X.join(C)!==ue.c.join(C)))for(te=A.replace(_colorExp,"1").split(_numWithUnitExp),fe=te.length-1;G<fe;G++)C+=te[G]+(~X.indexOf(G)?O.shift()||F+"0,0,0,0)":(ue.length?ue:O.length?O:c).shift());if(!te)for(te=A.split(_colorExp),fe=te.length-1;G<fe;G++)C+=te[G]+O[G];return C+te[fe]},_colorExp=function(){var K="(?:\\b(?:(?:rgb|rgba|hsl|hsla)\\(.+?\\))|\\B#(?:[0-9a-f]{3,4}){1,2}\\b",A;for(A in _colorLookup)K+="|"+A+"\\b";return new RegExp(K+")","gi")}(),_hslExp=/hsl[a]?\(/,_colorStringFilter=function(A){var w=A.join(" "),c;if(_colorExp.lastIndex=0,_colorExp.test(w))return c=_hslExp.test(w),A[1]=_formatColors(A[1],c),A[0]=_formatColors(A[0],c,_colorOrderData(A[1])),!0},_tickerActive,_ticker=function(){var K=Date.now,A=500,w=33,c=K(),C=c,O=1e3/240,F=O,G=[],X,te,ue,fe,de,le,me=function $(_e){var oe=K()-C,ge=_e===!0,Se,je,ye,Ne;if(oe>A&&(c+=oe-w),C+=oe,ye=C-c,Se=ye-F,(Se>0||ge)&&(Ne=++fe.frame,de=ye-fe.time*1e3,fe.time=ye=ye/1e3,F+=Se+(Se>=O?4:O-Se),je=1),ge||(X=te($)),je)for(le=0;le<G.length;le++)G[le](ye,de,Ne,_e)};return fe={time:0,frame:0,tick:function(){me(!0)},deltaRatio:function(_e){return de/(1e3/(_e||60))},wake:function(){_coreReady&&(!_coreInitted$2&&_windowExists$2()&&(_win$3=_coreInitted$2=window,_doc$3=_win$3.document||{},_globals.gsap=gsap$2,(_win$3.gsapVersions||(_win$3.gsapVersions=[])).push(gsap$2.version),_install(_installScope||_win$3.GreenSockGlobals||!_win$3.gsap&&_win$3||{}),ue=_win$3.requestAnimationFrame),X&&fe.sleep(),te=ue||function(_e){return setTimeout(_e,F-fe.time*1e3+1|0)},_tickerActive=1,me(2))},sleep:function(){(ue?_win$3.cancelAnimationFrame:clearTimeout)(X),_tickerActive=0,te=_emptyFunc},lagSmoothing:function(_e,oe){A=_e||1/0,w=Math.min(oe||33,A)},fps:function(_e){O=1e3/(_e||240),F=fe.time*1e3+O},add:function(_e,oe,ge){var Se=oe?function(je,ye,Ne,Z){_e(je,ye,Ne,Z),fe.remove(Se)}:_e;return fe.remove(_e),G[ge?"unshift":"push"](Se),_wake(),Se},remove:function(_e,oe){~(oe=G.indexOf(_e))&&G.splice(oe,1)&&le>=oe&&le--},_listeners:G},fe}(),_wake=function(){return!_tickerActive&&_ticker.wake()},_easeMap={},_customEaseExp=/^[\d.\-M][\d.\-,\s]/,_quotesExp=/["']/g,_parseObjectInString=function(A){for(var w={},c=A.substr(1,A.length-3).split(":"),C=c[0],O=1,F=c.length,G,X,te;O<F;O++)X=c[O],G=O!==F-1?X.lastIndexOf(","):X.length,te=X.substr(0,G),w[C]=isNaN(te)?te.replace(_quotesExp,"").trim():+te,C=X.substr(G+1).trim();return w},_valueInParentheses=function(A){var w=A.indexOf("(")+1,c=A.indexOf(")"),C=A.indexOf("(",w);return A.substring(w,~C&&C<c?A.indexOf(")",c+1):c)},_configEaseFromString=function(A){var w=(A+"").split("("),c=_easeMap[w[0]];return c&&w.length>1&&c.config?c.config.apply(null,~A.indexOf("{")?[_parseObjectInString(w[1])]:_valueInParentheses(A).split(",").map(_numericIfPossible)):_easeMap._CE&&_customEaseExp.test(A)?_easeMap._CE("",A):c},_invertEase=function(A){return function(w){return 1-A(1-w)}},_propagateYoyoEase=function K(A,w){for(var c=A._first,C;c;)c instanceof Timeline?K(c,w):c.vars.yoyoEase&&(!c._yoyo||!c._repeat)&&c._yoyo!==w&&(c.timeline?K(c.timeline,w):(C=c._ease,c._ease=c._yEase,c._yEase=C,c._yoyo=w)),c=c._next},_parseEase=function(A,w){return A&&(_isFunction$1(A)?A:_easeMap[A]||_configEaseFromString(A))||w},_insertEase=function(A,w,c,C){c===void 0&&(c=function(X){return 1-w(1-X)}),C===void 0&&(C=function(X){return X<.5?w(X*2)/2:1-w((1-X)*2)/2});var O={easeIn:w,easeOut:c,easeInOut:C},F;return _forEachName(A,function(G){_easeMap[G]=_globals[G]=O,_easeMap[F=G.toLowerCase()]=c;for(var X in O)_easeMap[F+(X==="easeIn"?".in":X==="easeOut"?".out":".inOut")]=_easeMap[G+"."+X]=O[X]}),O},_easeInOutFromOut=function(A){return function(w){return w<.5?(1-A(1-w*2))/2:.5+A((w-.5)*2)/2}},_configElastic=function K(A,w,c){var C=w>=1?w:1,O=(c||(A?.3:.45))/(w<1?w:1),F=O/_2PI*(Math.asin(1/C)||0),G=function(ue){return ue===1?1:C*Math.pow(2,-10*ue)*_sin((ue-F)*O)+1},X=A==="out"?G:A==="in"?function(te){return 1-G(1-te)}:_easeInOutFromOut(G);return O=_2PI/O,X.config=function(te,ue){return K(A,te,ue)},X},_configBack=function K(A,w){w===void 0&&(w=1.70158);var c=function(F){return F?--F*F*((w+1)*F+w)+1:0},C=A==="out"?c:A==="in"?function(O){return 1-c(1-O)}:_easeInOutFromOut(c);return C.config=function(O){return K(A,O)},C};_forEachName("Linear,Quad,Cubic,Quart,Quint,Strong",function(K,A){var w=A<5?A+1:A;_insertEase(K+",Power"+(w-1),A?function(c){return Math.pow(c,w)}:function(c){return c},function(c){return 1-Math.pow(1-c,w)},function(c){return c<.5?Math.pow(c*2,w)/2:1-Math.pow((1-c)*2,w)/2})});_easeMap.Linear.easeNone=_easeMap.none=_easeMap.Linear.easeIn;_insertEase("Elastic",_configElastic("in"),_configElastic("out"),_configElastic());(function(K,A){var w=1/A,c=2*w,C=2.5*w,O=function(G){return G<w?K*G*G:G<c?K*Math.pow(G-1.5/A,2)+.75:G<C?K*(G-=2.25/A)*G+.9375:K*Math.pow(G-2.625/A,2)+.984375};_insertEase("Bounce",function(F){return 1-O(1-F)},O)})(7.5625,2.75);_insertEase("Expo",function(K){return K?Math.pow(2,10*(K-1)):0});_insertEase("Circ",function(K){return-(_sqrt(1-K*K)-1)});_insertEase("Sine",function(K){return K===1?1:-_cos(K*_HALF_PI)+1});_insertEase("Back",_configBack("in"),_configBack("out"),_configBack());_easeMap.SteppedEase=_easeMap.steps=_globals.SteppedEase={config:function(A,w){A===void 0&&(A=1);var c=1/A,C=A+(w?0:1),O=w?1:0,F=1-_tinyNum;return function(G){return((C*_clamp$1(0,F,G)|0)+O)*c}}};_defaults$1.ease=_easeMap["quad.out"];_forEachName("onComplete,onUpdate,onStart,onRepeat,onReverseComplete,onInterrupt",function(K){return _callbackNames+=K+","+K+"Params,"});var GSCache=function(A,w){this.id=_gsID++,A._gsap=this,this.target=A,this.harness=w,this.get=w?w.get:_getProperty,this.set=w?w.getSetter:_getSetter},Animation=function(){function K(w){this.vars=w,this._delay=+w.delay||0,(this._repeat=w.repeat===1/0?-2:w.repeat||0)&&(this._rDelay=w.repeatDelay||0,this._yoyo=!!w.yoyo||!!w.yoyoEase),this._ts=1,_setDuration(this,+w.duration,1,1),this.data=w.data,_context$2&&(this._ctx=_context$2,_context$2.data.push(this)),_tickerActive||_ticker.wake()}var A=K.prototype;return A.delay=function(c){return c||c===0?(this.parent&&this.parent.smoothChildTiming&&this.startTime(this._start+c-this._delay),this._delay=c,this):this._delay},A.duration=function(c){return arguments.length?this.totalDuration(this._repeat>0?c+(c+this._rDelay)*this._repeat:c):this.totalDuration()&&this._dur},A.totalDuration=function(c){return arguments.length?(this._dirty=0,_setDuration(this,this._repeat<0?c:(c-this._repeat*this._rDelay)/(this._repeat+1))):this._tDur},A.totalTime=function(c,C){if(_wake(),!arguments.length)return this._tTime;var O=this._dp;if(O&&O.smoothChildTiming&&this._ts){for(_alignPlayhead(this,c),!O._dp||O.parent||_postAddChecks(O,this);O&&O.parent;)O.parent._time!==O._start+(O._ts>=0?O._tTime/O._ts:(O.totalDuration()-O._tTime)/-O._ts)&&O.totalTime(O._tTime,!0),O=O.parent;!this.parent&&this._dp.autoRemoveChildren&&(this._ts>0&&c<this._tDur||this._ts<0&&c>0||!this._tDur&&!c)&&_addToTimeline(this._dp,this,this._start-this._delay)}return(this._tTime!==c||!this._dur&&!C||this._initted&&Math.abs(this._zTime)===_tinyNum||!c&&!this._initted&&(this.add||this._ptLookup))&&(this._ts||(this._pTime=c),_lazySafeRender(this,c,C)),this},A.time=function(c,C){return arguments.length?this.totalTime(Math.min(this.totalDuration(),c+_elapsedCycleDuration(this))%(this._dur+this._rDelay)||(c?this._dur:0),C):this._time},A.totalProgress=function(c,C){return arguments.length?this.totalTime(this.totalDuration()*c,C):this.totalDuration()?Math.min(1,this._tTime/this._tDur):this.ratio},A.progress=function(c,C){return arguments.length?this.totalTime(this.duration()*(this._yoyo&&!(this.iteration()&1)?1-c:c)+_elapsedCycleDuration(this),C):this.duration()?Math.min(1,this._time/this._dur):this.ratio},A.iteration=function(c,C){var O=this.duration()+this._rDelay;return arguments.length?this.totalTime(this._time+(c-1)*O,C):this._repeat?_animationCycle(this._tTime,O)+1:1},A.timeScale=function(c){if(!arguments.length)return this._rts===-_tinyNum?0:this._rts;if(this._rts===c)return this;var C=this.parent&&this._ts?_parentToChildTotalTime(this.parent._time,this):this._tTime;return this._rts=+c||0,this._ts=this._ps||c===-_tinyNum?0:this._rts,this.totalTime(_clamp$1(-this._delay,this._tDur,C),!0),_setEnd(this),_recacheAncestors(this)},A.paused=function(c){return arguments.length?(this._ps!==c&&(this._ps=c,c?(this._pTime=this._tTime||Math.max(-this._delay,this.rawTime()),this._ts=this._act=0):(_wake(),this._ts=this._rts,this.totalTime(this.parent&&!this.parent.smoothChildTiming?this.rawTime():this._tTime||this._pTime,this.progress()===1&&Math.abs(this._zTime)!==_tinyNum&&(this._tTime-=_tinyNum)))),this):this._ps},A.startTime=function(c){if(arguments.length){this._start=c;var C=this.parent||this._dp;return C&&(C._sort||!this.parent)&&_addToTimeline(C,this,c-this._delay),this}return this._start},A.endTime=function(c){return this._start+(_isNotFalse(c)?this.totalDuration():this.duration())/Math.abs(this._ts||1)},A.rawTime=function(c){var C=this.parent||this._dp;return C?c&&(!this._ts||this._repeat&&this._time&&this.totalProgress()<1)?this._tTime%(this._dur+this._rDelay):this._ts?_parentToChildTotalTime(C.rawTime(c),this):this._tTime:this._tTime},A.revert=function(c){c===void 0&&(c=_revertConfig);var C=_reverting$1;return _reverting$1=c,(this._initted||this._startAt)&&(this.timeline&&this.timeline.revert(c),this.totalTime(-.01,c.suppressEvents)),this.data!=="nested"&&c.kill!==!1&&this.kill(),_reverting$1=C,this},A.globalTime=function(c){for(var C=this,O=arguments.length?c:C.rawTime();C;)O=C._start+O/(C._ts||1),C=C._dp;return!this.parent&&this._sat?this._sat.vars.immediateRender?-1:this._sat.globalTime(c):O},A.repeat=function(c){return arguments.length?(this._repeat=c===1/0?-2:c,_onUpdateTotalDuration(this)):this._repeat===-2?1/0:this._repeat},A.repeatDelay=function(c){if(arguments.length){var C=this._time;return this._rDelay=c,_onUpdateTotalDuration(this),C?this.time(C):this}return this._rDelay},A.yoyo=function(c){return arguments.length?(this._yoyo=c,this):this._yoyo},A.seek=function(c,C){return this.totalTime(_parsePosition$1(this,c),_isNotFalse(C))},A.restart=function(c,C){return this.play().totalTime(c?-this._delay:0,_isNotFalse(C))},A.play=function(c,C){return c!=null&&this.seek(c,C),this.reversed(!1).paused(!1)},A.reverse=function(c,C){return c!=null&&this.seek(c||this.totalDuration(),C),this.reversed(!0).paused(!1)},A.pause=function(c,C){return c!=null&&this.seek(c,C),this.paused(!0)},A.resume=function(){return this.paused(!1)},A.reversed=function(c){return arguments.length?(!!c!==this.reversed()&&this.timeScale(-this._rts||(c?-_tinyNum:0)),this):this._rts<0},A.invalidate=function(){return this._initted=this._act=0,this._zTime=-_tinyNum,this},A.isActive=function(){var c=this.parent||this._dp,C=this._start,O;return!!(!c||this._ts&&this._initted&&c.isActive()&&(O=c.rawTime(!0))>=C&&O<this.endTime(!0)-_tinyNum)},A.eventCallback=function(c,C,O){var F=this.vars;return arguments.length>1?(C?(F[c]=C,O&&(F[c+"Params"]=O),c==="onUpdate"&&(this._onUpdate=C)):delete F[c],this):F[c]},A.then=function(c){var C=this;return new Promise(function(O){var F=_isFunction$1(c)?c:_passThrough$1,G=function(){var te=C.then;C.then=null,_isFunction$1(F)&&(F=F(C))&&(F.then||F===C)&&(C.then=te),O(F),C.then=te};C._initted&&C.totalProgress()===1&&C._ts>=0||!C._tTime&&C._ts<0?G():C._prom=G})},A.kill=function(){_interrupt(this)},K}();_setDefaults$1(Animation.prototype,{_time:0,_start:0,_end:0,_tTime:0,_tDur:0,_dirty:0,_repeat:0,_yoyo:!1,parent:null,_initted:!1,_rDelay:0,_ts:1,_dp:0,ratio:0,_zTime:-_tinyNum,_prom:0,_ps:!1,_rts:1});var Timeline=function(K){_inheritsLoose(A,K);function A(c,C){var O;return c===void 0&&(c={}),O=K.call(this,c)||this,O.labels={},O.smoothChildTiming=!!c.smoothChildTiming,O.autoRemoveChildren=!!c.autoRemoveChildren,O._sort=_isNotFalse(c.sortChildren),_globalTimeline&&_addToTimeline(c.parent||_globalTimeline,_assertThisInitialized(O),C),c.reversed&&O.reverse(),c.paused&&O.paused(!0),c.scrollTrigger&&_scrollTrigger(_assertThisInitialized(O),c.scrollTrigger),O}var w=A.prototype;return w.to=function(C,O,F){return _createTweenType(0,arguments,this),this},w.from=function(C,O,F){return _createTweenType(1,arguments,this),this},w.fromTo=function(C,O,F,G){return _createTweenType(2,arguments,this),this},w.set=function(C,O,F){return O.duration=0,O.parent=this,_inheritDefaults(O).repeatDelay||(O.repeat=0),O.immediateRender=!!O.immediateRender,new Tween(C,O,_parsePosition$1(this,F),1),this},w.call=function(C,O,F){return _addToTimeline(this,Tween.delayedCall(0,C,O),F)},w.staggerTo=function(C,O,F,G,X,te,ue){return F.duration=O,F.stagger=F.stagger||G,F.onComplete=te,F.onCompleteParams=ue,F.parent=this,new Tween(C,F,_parsePosition$1(this,X)),this},w.staggerFrom=function(C,O,F,G,X,te,ue){return F.runBackwards=1,_inheritDefaults(F).immediateRender=_isNotFalse(F.immediateRender),this.staggerTo(C,O,F,G,X,te,ue)},w.staggerFromTo=function(C,O,F,G,X,te,ue,fe){return G.startAt=F,_inheritDefaults(G).immediateRender=_isNotFalse(G.immediateRender),this.staggerTo(C,O,G,X,te,ue,fe)},w.render=function(C,O,F){var G=this._time,X=this._dirty?this.totalDuration():this._tDur,te=this._dur,ue=C<=0?0:_roundPrecise(C),fe=this._zTime<0!=C<0&&(this._initted||!te),de,le,me,$,_e,oe,ge,Se,je,ye,Ne,Z;if(this!==_globalTimeline&&ue>X&&C>=0&&(ue=X),ue!==this._tTime||F||fe){if(G!==this._time&&te&&(ue+=this._time-G,C+=this._time-G),de=ue,je=this._start,Se=this._ts,oe=!Se,fe&&(te||(G=this._zTime),(C||!O)&&(this._zTime=C)),this._repeat){if(Ne=this._yoyo,_e=te+this._rDelay,this._repeat<-1&&C<0)return this.totalTime(_e*100+C,O,F);if(de=_roundPrecise(ue%_e),ue===X?($=this._repeat,de=te):($=~~(ue/_e),$&&$===ue/_e&&(de=te,$--),de>te&&(de=te)),ye=_animationCycle(this._tTime,_e),!G&&this._tTime&&ye!==$&&(ye=$),Ne&&$&1&&(de=te-de,Z=1),$!==ye&&!this._lock){var se=Ne&&ye&1,ae=se===(Ne&&$&1);if($<ye&&(se=!se),G=se?0:te,this._lock=1,this.render(G||(Z?0:_roundPrecise($*_e)),O,!te)._lock=0,this._tTime=ue,!O&&this.parent&&_callback$1(this,"onRepeat"),this.vars.repeatRefresh&&!Z&&(this.invalidate()._lock=1),G&&G!==this._time||oe!==!this._ts||this.vars.onRepeat&&!this.parent&&!this._act)return this;if(te=this._dur,X=this._tDur,ae&&(this._lock=2,G=se?te:-1e-4,this.render(G,!0),this.vars.repeatRefresh&&!Z&&this.invalidate()),this._lock=0,!this._ts&&!oe)return this;_propagateYoyoEase(this,Z)}}if(this._hasPause&&!this._forcing&&this._lock<2&&(ge=_findNextPauseTween(this,_roundPrecise(G),_roundPrecise(de)),ge&&(ue-=de-(de=ge._start))),this._tTime=ue,this._time=de,this._act=!Se,this._initted||(this._onUpdate=this.vars.onUpdate,this._initted=1,this._zTime=C,G=0),!G&&de&&!O&&(_callback$1(this,"onStart"),this._tTime!==ue))return this;if(de>=G&&C>=0)for(le=this._first;le;){if(me=le._next,(le._act||de>=le._start)&&le._ts&&ge!==le){if(le.parent!==this)return this.render(C,O,F);if(le.render(le._ts>0?(de-le._start)*le._ts:(le._dirty?le.totalDuration():le._tDur)+(de-le._start)*le._ts,O,F),de!==this._time||!this._ts&&!oe){ge=0,me&&(ue+=this._zTime=-_tinyNum);break}}le=me}else{le=this._last;for(var Be=C<0?C:de;le;){if(me=le._prev,(le._act||Be<=le._end)&&le._ts&&ge!==le){if(le.parent!==this)return this.render(C,O,F);if(le.render(le._ts>0?(Be-le._start)*le._ts:(le._dirty?le.totalDuration():le._tDur)+(Be-le._start)*le._ts,O,F||_reverting$1&&(le._initted||le._startAt)),de!==this._time||!this._ts&&!oe){ge=0,me&&(ue+=this._zTime=Be?-_tinyNum:_tinyNum);break}}le=me}}if(ge&&!O&&(this.pause(),ge.render(de>=G?0:-_tinyNum)._zTime=de>=G?1:-1,this._ts))return this._start=je,_setEnd(this),this.render(C,O,F);this._onUpdate&&!O&&_callback$1(this,"onUpdate",!0),(ue===X&&this._tTime>=this.totalDuration()||!ue&&G)&&(je===this._start||Math.abs(Se)!==Math.abs(this._ts))&&(this._lock||((C||!te)&&(ue===X&&this._ts>0||!ue&&this._ts<0)&&_removeFromParent(this,1),!O&&!(C<0&&!G)&&(ue||G||!X)&&(_callback$1(this,ue===X&&C>=0?"onComplete":"onReverseComplete",!0),this._prom&&!(ue<X&&this.timeScale()>0)&&this._prom())))}return this},w.add=function(C,O){var F=this;if(_isNumber$1(O)||(O=_parsePosition$1(this,O,C)),!(C instanceof Animation)){if(_isArray(C))return C.forEach(function(G){return F.add(G,O)}),this;if(_isString$1(C))return this.addLabel(C,O);if(_isFunction$1(C))C=Tween.delayedCall(0,C);else return this}return this!==C?_addToTimeline(this,C,O):this},w.getChildren=function(C,O,F,G){C===void 0&&(C=!0),O===void 0&&(O=!0),F===void 0&&(F=!0),G===void 0&&(G=-_bigNum$1);for(var X=[],te=this._first;te;)te._start>=G&&(te instanceof Tween?O&&X.push(te):(F&&X.push(te),C&&X.push.apply(X,te.getChildren(!0,O,F)))),te=te._next;return X},w.getById=function(C){for(var O=this.getChildren(1,1,1),F=O.length;F--;)if(O[F].vars.id===C)return O[F]},w.remove=function(C){return _isString$1(C)?this.removeLabel(C):_isFunction$1(C)?this.killTweensOf(C):(_removeLinkedListItem(this,C),C===this._recent&&(this._recent=this._last),_uncache(this))},w.totalTime=function(C,O){return arguments.length?(this._forcing=1,!this._dp&&this._ts&&(this._start=_roundPrecise(_ticker.time-(this._ts>0?C/this._ts:(this.totalDuration()-C)/-this._ts))),K.prototype.totalTime.call(this,C,O),this._forcing=0,this):this._tTime},w.addLabel=function(C,O){return this.labels[C]=_parsePosition$1(this,O),this},w.removeLabel=function(C){return delete this.labels[C],this},w.addPause=function(C,O,F){var G=Tween.delayedCall(0,O||_emptyFunc,F);return G.data="isPause",this._hasPause=1,_addToTimeline(this,G,_parsePosition$1(this,C))},w.removePause=function(C){var O=this._first;for(C=_parsePosition$1(this,C);O;)O._start===C&&O.data==="isPause"&&_removeFromParent(O),O=O._next},w.killTweensOf=function(C,O,F){for(var G=this.getTweensOf(C,F),X=G.length;X--;)_overwritingTween!==G[X]&&G[X].kill(C,O);return this},w.getTweensOf=function(C,O){for(var F=[],G=toArray(C),X=this._first,te=_isNumber$1(O),ue;X;)X instanceof Tween?_arrayContainsAny(X._targets,G)&&(te?(!_overwritingTween||X._initted&&X._ts)&&X.globalTime(0)<=O&&X.globalTime(X.totalDuration())>O:!O||X.isActive())&&F.push(X):(ue=X.getTweensOf(G,O)).length&&F.push.apply(F,ue),X=X._next;return F},w.tweenTo=function(C,O){O=O||{};var F=this,G=_parsePosition$1(F,C),X=O,te=X.startAt,ue=X.onStart,fe=X.onStartParams,de=X.immediateRender,le,me=Tween.to(F,_setDefaults$1({ease:O.ease||"none",lazy:!1,immediateRender:!1,time:G,overwrite:"auto",duration:O.duration||Math.abs((G-(te&&"time"in te?te.time:F._time))/F.timeScale())||_tinyNum,onStart:function(){if(F.pause(),!le){var _e=O.duration||Math.abs((G-(te&&"time"in te?te.time:F._time))/F.timeScale());me._dur!==_e&&_setDuration(me,_e,0,1).render(me._time,!0,!0),le=1}ue&&ue.apply(me,fe||[])}},O));return de?me.render(0):me},w.tweenFromTo=function(C,O,F){return this.tweenTo(O,_setDefaults$1({startAt:{time:_parsePosition$1(this,C)}},F))},w.recent=function(){return this._recent},w.nextLabel=function(C){return C===void 0&&(C=this._time),_getLabelInDirection(this,_parsePosition$1(this,C))},w.previousLabel=function(C){return C===void 0&&(C=this._time),_getLabelInDirection(this,_parsePosition$1(this,C),1)},w.currentLabel=function(C){return arguments.length?this.seek(C,!0):this.previousLabel(this._time+_tinyNum)},w.shiftChildren=function(C,O,F){F===void 0&&(F=0);for(var G=this._first,X=this.labels,te;G;)G._start>=F&&(G._start+=C,G._end+=C),G=G._next;if(O)for(te in X)X[te]>=F&&(X[te]+=C);return _uncache(this)},w.invalidate=function(C){var O=this._first;for(this._lock=0;O;)O.invalidate(C),O=O._next;return K.prototype.invalidate.call(this,C)},w.clear=function(C){C===void 0&&(C=!0);for(var O=this._first,F;O;)F=O._next,this.remove(O),O=F;return this._dp&&(this._time=this._tTime=this._pTime=0),C&&(this.labels={}),_uncache(this)},w.totalDuration=function(C){var O=0,F=this,G=F._last,X=_bigNum$1,te,ue,fe;if(arguments.length)return F.timeScale((F._repeat<0?F.duration():F.totalDuration())/(F.reversed()?-C:C));if(F._dirty){for(fe=F.parent;G;)te=G._prev,G._dirty&&G.totalDuration(),ue=G._start,ue>X&&F._sort&&G._ts&&!F._lock?(F._lock=1,_addToTimeline(F,G,ue-G._delay,1)._lock=0):X=ue,ue<0&&G._ts&&(O-=ue,(!fe&&!F._dp||fe&&fe.smoothChildTiming)&&(F._start+=ue/F._ts,F._time-=ue,F._tTime-=ue),F.shiftChildren(-ue,!1,-1/0),X=0),G._end>O&&G._ts&&(O=G._end),G=te;_setDuration(F,F===_globalTimeline&&F._time>O?F._time:O,1,1),F._dirty=0}return F._tDur},A.updateRoot=function(C){if(_globalTimeline._ts&&(_lazySafeRender(_globalTimeline,_parentToChildTotalTime(C,_globalTimeline)),_lastRenderedFrame=_ticker.frame),_ticker.frame>=_nextGCFrame){_nextGCFrame+=_config.autoSleep||120;var O=_globalTimeline._first;if((!O||!O._ts)&&_config.autoSleep&&_ticker._listeners.length<2){for(;O&&!O._ts;)O=O._next;O||_ticker.sleep()}}},A}(Animation);_setDefaults$1(Timeline.prototype,{_lock:0,_hasPause:0,_forcing:0});var _addComplexStringPropTween=function(A,w,c,C,O,F,G){var X=new PropTween(this._pt,A,w,0,1,_renderComplexString,null,O),te=0,ue=0,fe,de,le,me,$,_e,oe,ge;for(X.b=c,X.e=C,c+="",C+="",(oe=~C.indexOf("random("))&&(C=_replaceRandom(C)),F&&(ge=[c,C],F(ge,A,w),c=ge[0],C=ge[1]),de=c.match(_complexStringNumExp)||[];fe=_complexStringNumExp.exec(C);)me=fe[0],$=C.substring(te,fe.index),le?le=(le+1)%5:$.substr(-5)==="rgba("&&(le=1),me!==de[ue++]&&(_e=parseFloat(de[ue-1])||0,X._pt={_next:X._pt,p:$||ue===1?$:",",s:_e,c:me.charAt(1)==="="?_parseRelative(_e,me)-_e:parseFloat(me)-_e,m:le&&le<4?Math.round:0},te=_complexStringNumExp.lastIndex);return X.c=te<C.length?C.substring(te,C.length):"",X.fp=G,(_relExp.test(C)||oe)&&(X.e=0),this._pt=X,X},_addPropTween=function(A,w,c,C,O,F,G,X,te,ue){_isFunction$1(C)&&(C=C(O||0,A,F));var fe=A[w],de=c!=="get"?c:_isFunction$1(fe)?te?A[w.indexOf("set")||!_isFunction$1(A["get"+w.substr(3)])?w:"get"+w.substr(3)](te):A[w]():fe,le=_isFunction$1(fe)?te?_setterFuncWithParam:_setterFunc:_setterPlain,me;if(_isString$1(C)&&(~C.indexOf("random(")&&(C=_replaceRandom(C)),C.charAt(1)==="="&&(me=_parseRelative(de,C)+(getUnit(de)||0),(me||me===0)&&(C=me))),!ue||de!==C||_forceAllPropTweens)return!isNaN(de*C)&&C!==""?(me=new PropTween(this._pt,A,w,+de||0,C-(de||0),typeof fe=="boolean"?_renderBoolean:_renderPlain,0,le),te&&(me.fp=te),G&&me.modifier(G,this,A),this._pt=me):(!fe&&!(w in A)&&_missingPlugin(w,C),_addComplexStringPropTween.call(this,A,w,de,C,le,X||_config.stringFilter,te))},_processVars=function(A,w,c,C,O){if(_isFunction$1(A)&&(A=_parseFuncOrString(A,O,w,c,C)),!_isObject$1(A)||A.style&&A.nodeType||_isArray(A)||_isTypedArray(A))return _isString$1(A)?_parseFuncOrString(A,O,w,c,C):A;var F={},G;for(G in A)F[G]=_parseFuncOrString(A[G],O,w,c,C);return F},_checkPlugin=function(A,w,c,C,O,F){var G,X,te,ue;if(_plugins[A]&&(G=new _plugins[A]).init(O,G.rawVars?w[A]:_processVars(w[A],C,O,F,c),c,C,F)!==!1&&(c._pt=X=new PropTween(c._pt,O,A,0,1,G.render,G,0,G.priority),c!==_quickTween))for(te=c._ptLookup[c._targets.indexOf(O)],ue=G._props.length;ue--;)te[G._props[ue]]=X;return G},_overwritingTween,_forceAllPropTweens,_initTween=function K(A,w,c){var C=A.vars,O=C.ease,F=C.startAt,G=C.immediateRender,X=C.lazy,te=C.onUpdate,ue=C.onUpdateParams,fe=C.callbackScope,de=C.runBackwards,le=C.yoyoEase,me=C.keyframes,$=C.autoRevert,_e=A._dur,oe=A._startAt,ge=A._targets,Se=A.parent,je=Se&&Se.data==="nested"?Se.vars.targets:ge,ye=A._overwrite==="auto"&&!_suppressOverwrites$1,Ne=A.timeline,Z,se,ae,Be,we,tt,St,_t,xt,ct,Ot,At,Pt;if(Ne&&(!me||!O)&&(O="none"),A._ease=_parseEase(O,_defaults$1.ease),A._yEase=le?_invertEase(_parseEase(le===!0?O:le,_defaults$1.ease)):0,le&&A._yoyo&&!A._repeat&&(le=A._yEase,A._yEase=A._ease,A._ease=le),A._from=!Ne&&!!C.runBackwards,!Ne||me&&!C.stagger){if(_t=ge[0]?_getCache(ge[0]).harness:0,At=_t&&C[_t.prop],Z=_copyExcluding(C,_reservedProps),oe&&(oe._zTime<0&&oe.progress(1),w<0&&de&&G&&!$?oe.render(-1,!0):oe.revert(de&&_e?_revertConfigNoKill:_startAtRevertConfig),oe._lazy=0),F){if(_removeFromParent(A._startAt=Tween.set(ge,_setDefaults$1({data:"isStart",overwrite:!1,parent:Se,immediateRender:!0,lazy:!oe&&_isNotFalse(X),startAt:null,delay:0,onUpdate:te,onUpdateParams:ue,callbackScope:fe,stagger:0},F))),A._startAt._dp=0,A._startAt._sat=A,w<0&&(_reverting$1||!G&&!$)&&A._startAt.revert(_revertConfigNoKill),G&&_e&&w<=0&&c<=0){w&&(A._zTime=w);return}}else if(de&&_e&&!oe){if(w&&(G=!1),ae=_setDefaults$1({overwrite:!1,data:"isFromStart",lazy:G&&!oe&&_isNotFalse(X),immediateRender:G,stagger:0,parent:Se},Z),At&&(ae[_t.prop]=At),_removeFromParent(A._startAt=Tween.set(ge,ae)),A._startAt._dp=0,A._startAt._sat=A,w<0&&(_reverting$1?A._startAt.revert(_revertConfigNoKill):A._startAt.render(-1,!0)),A._zTime=w,!G)K(A._startAt,_tinyNum,_tinyNum);else if(!w)return}for(A._pt=A._ptCache=0,X=_e&&_isNotFalse(X)||X&&!_e,se=0;se<ge.length;se++){if(we=ge[se],St=we._gsap||_harness(ge)[se]._gsap,A._ptLookup[se]=ct={},_lazyLookup[St.id]&&_lazyTweens.length&&_lazyRender(),Ot=je===ge?se:je.indexOf(we),_t&&(xt=new _t).init(we,At||Z,A,Ot,je)!==!1&&(A._pt=Be=new PropTween(A._pt,we,xt.name,0,1,xt.render,xt,0,xt.priority),xt._props.forEach(function(Ie){ct[Ie]=Be}),xt.priority&&(tt=1)),!_t||At)for(ae in Z)_plugins[ae]&&(xt=_checkPlugin(ae,Z,A,Ot,we,je))?xt.priority&&(tt=1):ct[ae]=Be=_addPropTween.call(A,we,ae,"get",Z[ae],Ot,je,0,C.stringFilter);A._op&&A._op[se]&&A.kill(we,A._op[se]),ye&&A._pt&&(_overwritingTween=A,_globalTimeline.killTweensOf(we,ct,A.globalTime(w)),Pt=!A.parent,_overwritingTween=0),A._pt&&X&&(_lazyLookup[St.id]=1)}tt&&_sortPropTweensByPriority(A),A._onInit&&A._onInit(A)}A._onUpdate=te,A._initted=(!A._op||A._pt)&&!Pt,me&&w<=0&&Ne.render(_bigNum$1,!0,!0)},_updatePropTweens=function(A,w,c,C,O,F,G){var X=(A._pt&&A._ptCache||(A._ptCache={}))[w],te,ue,fe,de;if(!X)for(X=A._ptCache[w]=[],fe=A._ptLookup,de=A._targets.length;de--;){if(te=fe[de][w],te&&te.d&&te.d._pt)for(te=te.d._pt;te&&te.p!==w&&te.fp!==w;)te=te._next;if(!te)return _forceAllPropTweens=1,A.vars[w]="+=0",_initTween(A,G),_forceAllPropTweens=0,1;X.push(te)}for(de=X.length;de--;)ue=X[de],te=ue._pt||ue,te.s=(C||C===0)&&!O?C:te.s+(C||0)+F*te.c,te.c=c-te.s,ue.e&&(ue.e=_round$1(c)+getUnit(ue.e)),ue.b&&(ue.b=te.s+getUnit(ue.b))},_addAliasesToVars=function(A,w){var c=A[0]?_getCache(A[0]).harness:0,C=c&&c.aliases,O,F,G,X;if(!C)return w;O=_merge({},w);for(F in C)if(F in O)for(X=C[F].split(","),G=X.length;G--;)O[X[G]]=O[F];return O},_parseKeyframe=function(A,w,c,C){var O=w.ease||C||"power1.inOut",F,G;if(_isArray(w))G=c[A]||(c[A]=[]),w.forEach(function(X,te){return G.push({t:te/(w.length-1)*100,v:X,e:O})});else for(F in w)G=c[F]||(c[F]=[]),F==="ease"||G.push({t:parseFloat(A),v:w[F],e:O})},_parseFuncOrString=function(A,w,c,C,O){return _isFunction$1(A)?A.call(w,c,C,O):_isString$1(A)&&~A.indexOf("random(")?_replaceRandom(A):A},_staggerTweenProps=_callbackNames+"repeat,repeatDelay,yoyo,repeatRefresh,yoyoEase,autoRevert",_staggerPropsToSkip={};_forEachName(_staggerTweenProps+",id,stagger,delay,duration,paused,scrollTrigger",function(K){return _staggerPropsToSkip[K]=1});var Tween=function(K){_inheritsLoose(A,K);function A(c,C,O,F){var G;typeof C=="number"&&(O.duration=C,C=O,O=null),G=K.call(this,F?C:_inheritDefaults(C))||this;var X=G.vars,te=X.duration,ue=X.delay,fe=X.immediateRender,de=X.stagger,le=X.overwrite,me=X.keyframes,$=X.defaults,_e=X.scrollTrigger,oe=X.yoyoEase,ge=C.parent||_globalTimeline,Se=(_isArray(c)||_isTypedArray(c)?_isNumber$1(c[0]):"length"in C)?[c]:toArray(c),je,ye,Ne,Z,se,ae,Be,we;if(G._targets=Se.length?_harness(Se):_warn("GSAP target "+c+" not found. https://greensock.com",!_config.nullTargetWarn)||[],G._ptLookup=[],G._overwrite=le,me||de||_isFuncOrString(te)||_isFuncOrString(ue)){if(C=G.vars,je=G.timeline=new Timeline({data:"nested",defaults:$||{},targets:ge&&ge.data==="nested"?ge.vars.targets:Se}),je.kill(),je.parent=je._dp=_assertThisInitialized(G),je._start=0,de||_isFuncOrString(te)||_isFuncOrString(ue)){if(Z=Se.length,Be=de&&distribute(de),_isObject$1(de))for(se in de)~_staggerTweenProps.indexOf(se)&&(we||(we={}),we[se]=de[se]);for(ye=0;ye<Z;ye++)Ne=_copyExcluding(C,_staggerPropsToSkip),Ne.stagger=0,oe&&(Ne.yoyoEase=oe),we&&_merge(Ne,we),ae=Se[ye],Ne.duration=+_parseFuncOrString(te,_assertThisInitialized(G),ye,ae,Se),Ne.delay=(+_parseFuncOrString(ue,_assertThisInitialized(G),ye,ae,Se)||0)-G._delay,!de&&Z===1&&Ne.delay&&(G._delay=ue=Ne.delay,G._start+=ue,Ne.delay=0),je.to(ae,Ne,Be?Be(ye,ae,Se):0),je._ease=_easeMap.none;je.duration()?te=ue=0:G.timeline=0}else if(me){_inheritDefaults(_setDefaults$1(je.vars.defaults,{ease:"none"})),je._ease=_parseEase(me.ease||C.ease||"none");var tt=0,St,_t,xt;if(_isArray(me))me.forEach(function(ct){return je.to(Se,ct,">")}),je.duration();else{Ne={};for(se in me)se==="ease"||se==="easeEach"||_parseKeyframe(se,me[se],Ne,me.easeEach);for(se in Ne)for(St=Ne[se].sort(function(ct,Ot){return ct.t-Ot.t}),tt=0,ye=0;ye<St.length;ye++)_t=St[ye],xt={ease:_t.e,duration:(_t.t-(ye?St[ye-1].t:0))/100*te},xt[se]=_t.v,je.to(Se,xt,tt),tt+=xt.duration;je.duration()<te&&je.to({},{duration:te-je.duration()})}}te||G.duration(te=je.duration())}else G.timeline=0;return le===!0&&!_suppressOverwrites$1&&(_overwritingTween=_assertThisInitialized(G),_globalTimeline.killTweensOf(Se),_overwritingTween=0),_addToTimeline(ge,_assertThisInitialized(G),O),C.reversed&&G.reverse(),C.paused&&G.paused(!0),(fe||!te&&!me&&G._start===_roundPrecise(ge._time)&&_isNotFalse(fe)&&_hasNoPausedAncestors(_assertThisInitialized(G))&&ge.data!=="nested")&&(G._tTime=-_tinyNum,G.render(Math.max(0,-ue)||0)),_e&&_scrollTrigger(_assertThisInitialized(G),_e),G}var w=A.prototype;return w.render=function(C,O,F){var G=this._time,X=this._tDur,te=this._dur,ue=C<0,fe=C>X-_tinyNum&&!ue?X:C<_tinyNum?0:C,de,le,me,$,_e,oe,ge,Se,je;if(!te)_renderZeroDurationTween(this,C,O,F);else if(fe!==this._tTime||!C||F||!this._initted&&this._tTime||this._startAt&&this._zTime<0!==ue){if(de=fe,Se=this.timeline,this._repeat){if($=te+this._rDelay,this._repeat<-1&&ue)return this.totalTime($*100+C,O,F);if(de=_roundPrecise(fe%$),fe===X?(me=this._repeat,de=te):(me=~~(fe/$),me&&me===fe/$&&(de=te,me--),de>te&&(de=te)),oe=this._yoyo&&me&1,oe&&(je=this._yEase,de=te-de),_e=_animationCycle(this._tTime,$),de===G&&!F&&this._initted)return this._tTime=fe,this;me!==_e&&(Se&&this._yEase&&_propagateYoyoEase(Se,oe),this.vars.repeatRefresh&&!oe&&!this._lock&&(this._lock=F=1,this.render(_roundPrecise($*me),!0).invalidate()._lock=0))}if(!this._initted){if(_attemptInitTween(this,ue?C:de,F,O,fe))return this._tTime=0,this;if(G!==this._time)return this;if(te!==this._dur)return this.render(C,O,F)}if(this._tTime=fe,this._time=de,!this._act&&this._ts&&(this._act=1,this._lazy=0),this.ratio=ge=(je||this._ease)(de/te),this._from&&(this.ratio=ge=1-ge),de&&!G&&!O&&(_callback$1(this,"onStart"),this._tTime!==fe))return this;for(le=this._pt;le;)le.r(ge,le.d),le=le._next;Se&&Se.render(C<0?C:!de&&oe?-_tinyNum:Se._dur*Se._ease(de/this._dur),O,F)||this._startAt&&(this._zTime=C),this._onUpdate&&!O&&(ue&&_rewindStartAt(this,C,O,F),_callback$1(this,"onUpdate")),this._repeat&&me!==_e&&this.vars.onRepeat&&!O&&this.parent&&_callback$1(this,"onRepeat"),(fe===this._tDur||!fe)&&this._tTime===fe&&(ue&&!this._onUpdate&&_rewindStartAt(this,C,!0,!0),(C||!te)&&(fe===this._tDur&&this._ts>0||!fe&&this._ts<0)&&_removeFromParent(this,1),!O&&!(ue&&!G)&&(fe||G||oe)&&(_callback$1(this,fe===X?"onComplete":"onReverseComplete",!0),this._prom&&!(fe<X&&this.timeScale()>0)&&this._prom()))}return this},w.targets=function(){return this._targets},w.invalidate=function(C){return(!C||!this.vars.runBackwards)&&(this._startAt=0),this._pt=this._op=this._onUpdate=this._lazy=this.ratio=0,this._ptLookup=[],this.timeline&&this.timeline.invalidate(C),K.prototype.invalidate.call(this,C)},w.resetTo=function(C,O,F,G){_tickerActive||_ticker.wake(),this._ts||this.play();var X=Math.min(this._dur,(this._dp._time-this._start)*this._ts),te;return this._initted||_initTween(this,X),te=this._ease(X/this._dur),_updatePropTweens(this,C,O,F,G,te,X)?this.resetTo(C,O,F,G):(_alignPlayhead(this,0),this.parent||_addLinkedListItem(this._dp,this,"_first","_last",this._dp._sort?"_start":0),this.render(0))},w.kill=function(C,O){if(O===void 0&&(O="all"),!C&&(!O||O==="all"))return this._lazy=this._pt=0,this.parent?_interrupt(this):this;if(this.timeline){var F=this.timeline.totalDuration();return this.timeline.killTweensOf(C,O,_overwritingTween&&_overwritingTween.vars.overwrite!==!0)._first||_interrupt(this),this.parent&&F!==this.timeline.totalDuration()&&_setDuration(this,this._dur*this.timeline._tDur/F,0,1),this}var G=this._targets,X=C?toArray(C):G,te=this._ptLookup,ue=this._pt,fe,de,le,me,$,_e,oe;if((!O||O==="all")&&_arraysMatch(G,X))return O==="all"&&(this._pt=0),_interrupt(this);for(fe=this._op=this._op||[],O!=="all"&&(_isString$1(O)&&($={},_forEachName(O,function(ge){return $[ge]=1}),O=$),O=_addAliasesToVars(G,O)),oe=G.length;oe--;)if(~X.indexOf(G[oe])){de=te[oe],O==="all"?(fe[oe]=O,me=de,le={}):(le=fe[oe]=fe[oe]||{},me=O);for($ in me)_e=de&&de[$],_e&&((!("kill"in _e.d)||_e.d.kill($)===!0)&&_removeLinkedListItem(this,_e,"_pt"),delete de[$]),le!=="all"&&(le[$]=1)}return this._initted&&!this._pt&&ue&&_interrupt(this),this},A.to=function(C,O){return new A(C,O,arguments[2])},A.from=function(C,O){return _createTweenType(1,arguments)},A.delayedCall=function(C,O,F,G){return new A(O,0,{immediateRender:!1,lazy:!1,overwrite:!1,delay:C,onComplete:O,onReverseComplete:O,onCompleteParams:F,onReverseCompleteParams:F,callbackScope:G})},A.fromTo=function(C,O,F){return _createTweenType(2,arguments)},A.set=function(C,O){return O.duration=0,O.repeatDelay||(O.repeat=0),new A(C,O)},A.killTweensOf=function(C,O,F){return _globalTimeline.killTweensOf(C,O,F)},A}(Animation);_setDefaults$1(Tween.prototype,{_targets:[],_lazy:0,_startAt:0,_op:0,_onInit:0});_forEachName("staggerTo,staggerFrom,staggerFromTo",function(K){Tween[K]=function(){var A=new Timeline,w=_slice.call(arguments,0);return w.splice(K==="staggerFromTo"?5:4,0,0),A[K].apply(A,w)}});var _setterPlain=function(A,w,c){return A[w]=c},_setterFunc=function(A,w,c){return A[w](c)},_setterFuncWithParam=function(A,w,c,C){return A[w](C.fp,c)},_setterAttribute=function(A,w,c){return A.setAttribute(w,c)},_getSetter=function(A,w){return _isFunction$1(A[w])?_setterFunc:_isUndefined(A[w])&&A.setAttribute?_setterAttribute:_setterPlain},_renderPlain=function(A,w){return w.set(w.t,w.p,Math.round((w.s+w.c*A)*1e6)/1e6,w)},_renderBoolean=function(A,w){return w.set(w.t,w.p,!!(w.s+w.c*A),w)},_renderComplexString=function(A,w){var c=w._pt,C="";if(!A&&w.b)C=w.b;else if(A===1&&w.e)C=w.e;else{for(;c;)C=c.p+(c.m?c.m(c.s+c.c*A):Math.round((c.s+c.c*A)*1e4)/1e4)+C,c=c._next;C+=w.c}w.set(w.t,w.p,C,w)},_renderPropTweens=function(A,w){for(var c=w._pt;c;)c.r(A,c.d),c=c._next},_addPluginModifier=function(A,w,c,C){for(var O=this._pt,F;O;)F=O._next,O.p===C&&O.modifier(A,w,c),O=F},_killPropTweensOf=function(A){for(var w=this._pt,c,C;w;)C=w._next,w.p===A&&!w.op||w.op===A?_removeLinkedListItem(this,w,"_pt"):w.dep||(c=1),w=C;return!c},_setterWithModifier=function(A,w,c,C){C.mSet(A,w,C.m.call(C.tween,c,C.mt),C)},_sortPropTweensByPriority=function(A){for(var w=A._pt,c,C,O,F;w;){for(c=w._next,C=O;C&&C.pr>w.pr;)C=C._next;(w._prev=C?C._prev:F)?w._prev._next=w:O=w,(w._next=C)?C._prev=w:F=w,w=c}A._pt=O},PropTween=function(){function K(w,c,C,O,F,G,X,te,ue){this.t=c,this.s=O,this.c=F,this.p=C,this.r=G||_renderPlain,this.d=X||this,this.set=te||_setterPlain,this.pr=ue||0,this._next=w,w&&(w._prev=this)}var A=K.prototype;return A.modifier=function(c,C,O){this.mSet=this.mSet||this.set,this.set=_setterWithModifier,this.m=c,this.mt=O,this.tween=C},K}();_forEachName(_callbackNames+"parent,duration,ease,delay,overwrite,runBackwards,startAt,yoyo,immediateRender,repeat,repeatDelay,data,paused,reversed,lazy,callbackScope,stringFilter,id,yoyoEase,stagger,inherit,repeatRefresh,keyframes,autoRevert,scrollTrigger",function(K){return _reservedProps[K]=1});_globals.TweenMax=_globals.TweenLite=Tween;_globals.TimelineLite=_globals.TimelineMax=Timeline;_globalTimeline=new Timeline({sortChildren:!1,defaults:_defaults$1,autoRemoveChildren:!0,id:"root",smoothChildTiming:!0});_config.stringFilter=_colorStringFilter;var _media=[],_listeners$1={},_emptyArray$1=[],_lastMediaTime=0,_dispatch$1=function(A){return(_listeners$1[A]||_emptyArray$1).map(function(w){return w()})},_onMediaChange=function(){var A=Date.now(),w=[];A-_lastMediaTime>2&&(_dispatch$1("matchMediaInit"),_media.forEach(function(c){var C=c.queries,O=c.conditions,F,G,X,te;for(G in C)F=_win$3.matchMedia(C[G]).matches,F&&(X=1),F!==O[G]&&(O[G]=F,te=1);te&&(c.revert(),X&&w.push(c))}),_dispatch$1("matchMediaRevert"),w.forEach(function(c){return c.onMatch(c)}),_lastMediaTime=A,_dispatch$1("matchMedia"))},Context=function(){function K(w,c){this.selector=c&&selector(c),this.data=[],this._r=[],this.isReverted=!1,w&&this.add(w)}var A=K.prototype;return A.add=function(c,C,O){_isFunction$1(c)&&(O=C,C=c,c=_isFunction$1);var F=this,G=function(){var te=_context$2,ue=F.selector,fe;return te&&te!==F&&te.data.push(F),O&&(F.selector=selector(O)),_context$2=F,fe=C.apply(F,arguments),_isFunction$1(fe)&&F._r.push(fe),_context$2=te,F.selector=ue,F.isReverted=!1,fe};return F.last=G,c===_isFunction$1?G(F):c?F[c]=G:G},A.ignore=function(c){var C=_context$2;_context$2=null,c(this),_context$2=C},A.getTweens=function(){var c=[];return this.data.forEach(function(C){return C instanceof K?c.push.apply(c,C.getTweens()):C instanceof Tween&&!(C.parent&&C.parent.data==="nested")&&c.push(C)}),c},A.clear=function(){this._r.length=this.data.length=0},A.kill=function(c,C){var O=this;if(c){var F=this.getTweens();this.data.forEach(function(X){X.data==="isFlip"&&(X.revert(),X.getChildren(!0,!0,!1).forEach(function(te){return F.splice(F.indexOf(te),1)}))}),F.map(function(X){return{g:X.globalTime(0),t:X}}).sort(function(X,te){return te.g-X.g||-1}).forEach(function(X){return X.t.revert(c)}),this.data.forEach(function(X){return!(X instanceof Animation)&&X.revert&&X.revert(c)}),this._r.forEach(function(X){return X(c,O)}),this.isReverted=!0}else this.data.forEach(function(X){return X.kill&&X.kill()});if(this.clear(),C){var G=_media.indexOf(this);~G&&_media.splice(G,1)}},A.revert=function(c){this.kill(c||{})},K}(),MatchMedia=function(){function K(w){this.contexts=[],this.scope=w}var A=K.prototype;return A.add=function(c,C,O){_isObject$1(c)||(c={matches:c});var F=new Context(0,O||this.scope),G=F.conditions={},X,te,ue;this.contexts.push(F),C=F.add("onMatch",C),F.queries=c;for(te in c)te==="all"?ue=1:(X=_win$3.matchMedia(c[te]),X&&(_media.indexOf(F)<0&&_media.push(F),(G[te]=X.matches)&&(ue=1),X.addListener?X.addListener(_onMediaChange):X.addEventListener("change",_onMediaChange)));return ue&&C(F),this},A.revert=function(c){this.kill(c||{})},A.kill=function(c){this.contexts.forEach(function(C){return C.kill(c,!0)})},K}(),_gsap={registerPlugin:function(){for(var A=arguments.length,w=new Array(A),c=0;c<A;c++)w[c]=arguments[c];w.forEach(function(C){return _createPlugin(C)})},timeline:function(A){return new Timeline(A)},getTweensOf:function(A,w){return _globalTimeline.getTweensOf(A,w)},getProperty:function(A,w,c,C){_isString$1(A)&&(A=toArray(A)[0]);var O=_getCache(A||{}).get,F=c?_passThrough$1:_numericIfPossible;return c==="native"&&(c=""),A&&(w?F((_plugins[w]&&_plugins[w].get||O)(A,w,c,C)):function(G,X,te){return F((_plugins[G]&&_plugins[G].get||O)(A,G,X,te))})},quickSetter:function(A,w,c){if(A=toArray(A),A.length>1){var C=A.map(function(ue){return gsap$2.quickSetter(ue,w,c)}),O=C.length;return function(ue){for(var fe=O;fe--;)C[fe](ue)}}A=A[0]||{};var F=_plugins[w],G=_getCache(A),X=G.harness&&(G.harness.aliases||{})[w]||w,te=F?function(ue){var fe=new F;_quickTween._pt=0,fe.init(A,c?ue+c:ue,_quickTween,0,[A]),fe.render(1,fe),_quickTween._pt&&_renderPropTweens(1,_quickTween)}:G.set(A,X);return F?te:function(ue){return te(A,X,c?ue+c:ue,G,1)}},quickTo:function(A,w,c){var C,O=gsap$2.to(A,_merge((C={},C[w]="+=0.1",C.paused=!0,C),c||{})),F=function(X,te,ue){return O.resetTo(w,X,te,ue)};return F.tween=O,F},isTweening:function(A){return _globalTimeline.getTweensOf(A,!0).length>0},defaults:function(A){return A&&A.ease&&(A.ease=_parseEase(A.ease,_defaults$1.ease)),_mergeDeep(_defaults$1,A||{})},config:function(A){return _mergeDeep(_config,A||{})},registerEffect:function(A){var w=A.name,c=A.effect,C=A.plugins,O=A.defaults,F=A.extendTimeline;(C||"").split(",").forEach(function(G){return G&&!_plugins[G]&&!_globals[G]&&_warn(w+" effect requires "+G+" plugin.")}),_effects[w]=function(G,X,te){return c(toArray(G),_setDefaults$1(X||{},O),te)},F&&(Timeline.prototype[w]=function(G,X,te){return this.add(_effects[w](G,_isObject$1(X)?X:(te=X)&&{},this),te)})},registerEase:function(A,w){_easeMap[A]=_parseEase(w)},parseEase:function(A,w){return arguments.length?_parseEase(A,w):_easeMap},getById:function(A){return _globalTimeline.getById(A)},exportRoot:function(A,w){A===void 0&&(A={});var c=new Timeline(A),C,O;for(c.smoothChildTiming=_isNotFalse(A.smoothChildTiming),_globalTimeline.remove(c),c._dp=0,c._time=c._tTime=_globalTimeline._time,C=_globalTimeline._first;C;)O=C._next,(w||!(!C._dur&&C instanceof Tween&&C.vars.onComplete===C._targets[0]))&&_addToTimeline(c,C,C._start-C._delay),C=O;return _addToTimeline(_globalTimeline,c,0),c},context:function(A,w){return A?new Context(A,w):_context$2},matchMedia:function(A){return new MatchMedia(A)},matchMediaRefresh:function(){return _media.forEach(function(A){var w=A.conditions,c,C;for(C in w)w[C]&&(w[C]=!1,c=1);c&&A.revert()})||_onMediaChange()},addEventListener:function(A,w){var c=_listeners$1[A]||(_listeners$1[A]=[]);~c.indexOf(w)||c.push(w)},removeEventListener:function(A,w){var c=_listeners$1[A],C=c&&c.indexOf(w);C>=0&&c.splice(C,1)},utils:{wrap,wrapYoyo,distribute,random,snap,normalize,getUnit,clamp,splitColor,toArray,selector,mapRange,pipe,unitize,interpolate,shuffle},install:_install,effects:_effects,ticker:_ticker,updateRoot:Timeline.updateRoot,plugins:_plugins,globalTimeline:_globalTimeline,core:{PropTween,globals:_addGlobal,Tween,Timeline,Animation,getCache:_getCache,_removeLinkedListItem,reverting:function(){return _reverting$1},context:function(A){return A&&_context$2&&(_context$2.data.push(A),A._ctx=_context$2),_context$2},suppressOverwrites:function(A){return _suppressOverwrites$1=A}}};_forEachName("to,from,fromTo,delayedCall,set,killTweensOf",function(K){return _gsap[K]=Tween[K]});_ticker.add(Timeline.updateRoot);_quickTween=_gsap.to({},{duration:0});var _getPluginPropTween=function(A,w){for(var c=A._pt;c&&c.p!==w&&c.op!==w&&c.fp!==w;)c=c._next;return c},_addModifiers=function(A,w){var c=A._targets,C,O,F;for(C in w)for(O=c.length;O--;)F=A._ptLookup[O][C],F&&(F=F.d)&&(F._pt&&(F=_getPluginPropTween(F,C)),F&&F.modifier&&F.modifier(w[C],A,c[O],C))},_buildModifierPlugin=function(A,w){return{name:A,rawVars:1,init:function(C,O,F){F._onInit=function(G){var X,te;if(_isString$1(O)&&(X={},_forEachName(O,function(ue){return X[ue]=1}),O=X),w){X={};for(te in O)X[te]=w(O[te]);O=X}_addModifiers(G,O)}}}},gsap$2=_gsap.registerPlugin({name:"attr",init:function(A,w,c,C,O){var F,G,X;this.tween=c;for(F in w)X=A.getAttribute(F)||"",G=this.add(A,"setAttribute",(X||0)+"",w[F],C,O,0,0,F),G.op=F,G.b=X,this._props.push(F)},render:function(A,w){for(var c=w._pt;c;)_reverting$1?c.set(c.t,c.p,c.b,c):c.r(A,c.d),c=c._next}},{name:"endArray",init:function(A,w){for(var c=w.length;c--;)this.add(A,c,A[c]||0,w[c],0,0,0,0,0,1)}},_buildModifierPlugin("roundProps",_roundModifier),_buildModifierPlugin("modifiers"),_buildModifierPlugin("snap",snap))||_gsap;Tween.version=Timeline.version=gsap$2.version="3.11.4";_coreReady=1;_windowExists$2()&&_wake();_easeMap.Power0;_easeMap.Power1;_easeMap.Power2;_easeMap.Power3;_easeMap.Power4;_easeMap.Linear;_easeMap.Quad;_easeMap.Cubic;_easeMap.Quart;_easeMap.Quint;_easeMap.Strong;_easeMap.Elastic;_easeMap.Back;_easeMap.SteppedEase;_easeMap.Bounce;_easeMap.Sine;_easeMap.Expo;_easeMap.Circ;/*!
 * CSSPlugin 3.11.4
 * https://greensock.com
 *
 * Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var _win$2,_doc$2,_docElement,_pluginInitted,_tempDiv,_recentSetterPlugin,_reverting,_windowExists$1=function(){return typeof window<"u"},_transformProps={},_RAD2DEG=180/Math.PI,_DEG2RAD=Math.PI/180,_atan2=Math.atan2,_bigNum=1e8,_capsExp$1=/([A-Z])/g,_horizontalExp=/(left|right|width|margin|padding|x)/i,_complexExp=/[\s,\(]\S/,_propertyAliases={autoAlpha:"opacity,visibility",scale:"scaleX,scaleY",alpha:"opacity"},_renderCSSProp=function(A,w){return w.set(w.t,w.p,Math.round((w.s+w.c*A)*1e4)/1e4+w.u,w)},_renderPropWithEnd=function(A,w){return w.set(w.t,w.p,A===1?w.e:Math.round((w.s+w.c*A)*1e4)/1e4+w.u,w)},_renderCSSPropWithBeginning=function(A,w){return w.set(w.t,w.p,A?Math.round((w.s+w.c*A)*1e4)/1e4+w.u:w.b,w)},_renderRoundedCSSProp=function(A,w){var c=w.s+w.c*A;w.set(w.t,w.p,~~(c+(c<0?-.5:.5))+w.u,w)},_renderNonTweeningValue=function(A,w){return w.set(w.t,w.p,A?w.e:w.b,w)},_renderNonTweeningValueOnlyAtEnd=function(A,w){return w.set(w.t,w.p,A!==1?w.b:w.e,w)},_setterCSSStyle=function(A,w,c){return A.style[w]=c},_setterCSSProp=function(A,w,c){return A.style.setProperty(w,c)},_setterTransform=function(A,w,c){return A._gsap[w]=c},_setterScale=function(A,w,c){return A._gsap.scaleX=A._gsap.scaleY=c},_setterScaleWithRender=function(A,w,c,C,O){var F=A._gsap;F.scaleX=F.scaleY=c,F.renderTransform(O,F)},_setterTransformWithRender=function(A,w,c,C,O){var F=A._gsap;F[w]=c,F.renderTransform(O,F)},_transformProp$1="transform",_transformOriginProp=_transformProp$1+"Origin",_saveStyle=function(A,w){var c=this,C=this.target,O=C.style;if(A in _transformProps){if(this.tfm=this.tfm||{},A!=="transform"&&(A=_propertyAliases[A]||A,~A.indexOf(",")?A.split(",").forEach(function(F){return c.tfm[F]=_get(C,F)}):this.tfm[A]=C._gsap.x?C._gsap[A]:_get(C,A)),this.props.indexOf(_transformProp$1)>=0)return;C._gsap.svg&&(this.svgo=C.getAttribute("data-svg-origin"),this.props.push(_transformOriginProp,w,"")),A=_transformProp$1}(O||w)&&this.props.push(A,w,O[A])},_removeIndependentTransforms=function(A){A.translate&&(A.removeProperty("translate"),A.removeProperty("scale"),A.removeProperty("rotate"))},_revertStyle=function(){var A=this.props,w=this.target,c=w.style,C=w._gsap,O,F;for(O=0;O<A.length;O+=3)A[O+1]?w[A[O]]=A[O+2]:A[O+2]?c[A[O]]=A[O+2]:c.removeProperty(A[O].replace(_capsExp$1,"-$1").toLowerCase());if(this.tfm){for(F in this.tfm)C[F]=this.tfm[F];C.svg&&(C.renderTransform(),w.setAttribute("data-svg-origin",this.svgo||"")),O=_reverting(),O&&!O.isStart&&!c[_transformProp$1]&&(_removeIndependentTransforms(c),C.uncache=1)}},_getStyleSaver=function(A,w){var c={target:A,props:[],revert:_revertStyle,save:_saveStyle};return w&&w.split(",").forEach(function(C){return c.save(C)}),c},_supports3D,_createElement=function(A,w){var c=_doc$2.createElementNS?_doc$2.createElementNS((w||"http://www.w3.org/1999/xhtml").replace(/^https/,"http"),A):_doc$2.createElement(A);return c.style?c:_doc$2.createElement(A)},_getComputedProperty=function K(A,w,c){var C=getComputedStyle(A);return C[w]||C.getPropertyValue(w.replace(_capsExp$1,"-$1").toLowerCase())||C.getPropertyValue(w)||!c&&K(A,_checkPropPrefix(w)||w,1)||""},_prefixes="O,Moz,ms,Ms,Webkit".split(","),_checkPropPrefix=function(A,w,c){var C=w||_tempDiv,O=C.style,F=5;if(A in O&&!c)return A;for(A=A.charAt(0).toUpperCase()+A.substr(1);F--&&!(_prefixes[F]+A in O););return F<0?null:(F===3?"ms":F>=0?_prefixes[F]:"")+A},_initCore$1=function(){_windowExists$1()&&window.document&&(_win$2=window,_doc$2=_win$2.document,_docElement=_doc$2.documentElement,_tempDiv=_createElement("div")||{style:{}},_createElement("div"),_transformProp$1=_checkPropPrefix(_transformProp$1),_transformOriginProp=_transformProp$1+"Origin",_tempDiv.style.cssText="border-width:0;line-height:0;position:absolute;padding:0",_supports3D=!!_checkPropPrefix("perspective"),_reverting=gsap$2.core.reverting,_pluginInitted=1)},_getBBoxHack=function K(A){var w=_createElement("svg",this.ownerSVGElement&&this.ownerSVGElement.getAttribute("xmlns")||"http://www.w3.org/2000/svg"),c=this.parentNode,C=this.nextSibling,O=this.style.cssText,F;if(_docElement.appendChild(w),w.appendChild(this),this.style.display="block",A)try{F=this.getBBox(),this._gsapBBox=this.getBBox,this.getBBox=K}catch{}else this._gsapBBox&&(F=this._gsapBBox());return c&&(C?c.insertBefore(this,C):c.appendChild(this)),_docElement.removeChild(w),this.style.cssText=O,F},_getAttributeFallbacks=function(A,w){for(var c=w.length;c--;)if(A.hasAttribute(w[c]))return A.getAttribute(w[c])},_getBBox=function(A){var w;try{w=A.getBBox()}catch{w=_getBBoxHack.call(A,!0)}return w&&(w.width||w.height)||A.getBBox===_getBBoxHack||(w=_getBBoxHack.call(A,!0)),w&&!w.width&&!w.x&&!w.y?{x:+_getAttributeFallbacks(A,["x","cx","x1"])||0,y:+_getAttributeFallbacks(A,["y","cy","y1"])||0,width:0,height:0}:w},_isSVG=function(A){return!!(A.getCTM&&(!A.parentNode||A.ownerSVGElement)&&_getBBox(A))},_removeProperty=function(A,w){if(w){var c=A.style;w in _transformProps&&w!==_transformOriginProp&&(w=_transformProp$1),c.removeProperty?((w.substr(0,2)==="ms"||w.substr(0,6)==="webkit")&&(w="-"+w),c.removeProperty(w.replace(_capsExp$1,"-$1").toLowerCase())):c.removeAttribute(w)}},_addNonTweeningPT=function(A,w,c,C,O,F){var G=new PropTween(A._pt,w,c,0,1,F?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue);return A._pt=G,G.b=C,G.e=O,A._props.push(c),G},_nonConvertibleUnits={deg:1,rad:1,turn:1},_nonStandardLayouts={grid:1,flex:1},_convertToUnit=function K(A,w,c,C){var O=parseFloat(c)||0,F=(c+"").trim().substr((O+"").length)||"px",G=_tempDiv.style,X=_horizontalExp.test(w),te=A.tagName.toLowerCase()==="svg",ue=(te?"client":"offset")+(X?"Width":"Height"),fe=100,de=C==="px",le=C==="%",me,$,_e,oe;return C===F||!O||_nonConvertibleUnits[C]||_nonConvertibleUnits[F]?O:(F!=="px"&&!de&&(O=K(A,w,c,"px")),oe=A.getCTM&&_isSVG(A),(le||F==="%")&&(_transformProps[w]||~w.indexOf("adius"))?(me=oe?A.getBBox()[X?"width":"height"]:A[ue],_round$1(le?O/me*fe:O/100*me)):(G[X?"width":"height"]=fe+(de?F:C),$=~w.indexOf("adius")||C==="em"&&A.appendChild&&!te?A:A.parentNode,oe&&($=(A.ownerSVGElement||{}).parentNode),(!$||$===_doc$2||!$.appendChild)&&($=_doc$2.body),_e=$._gsap,_e&&le&&_e.width&&X&&_e.time===_ticker.time&&!_e.uncache?_round$1(O/_e.width*fe):((le||F==="%")&&!_nonStandardLayouts[_getComputedProperty($,"display")]&&(G.position=_getComputedProperty(A,"position")),$===A&&(G.position="static"),$.appendChild(_tempDiv),me=_tempDiv[ue],$.removeChild(_tempDiv),G.position="absolute",X&&le&&(_e=_getCache($),_e.time=_ticker.time,_e.width=$[ue]),_round$1(de?me*O/fe:me&&O?fe/me*O:0))))},_get=function(A,w,c,C){var O;return _pluginInitted||_initCore$1(),w in _propertyAliases&&w!=="transform"&&(w=_propertyAliases[w],~w.indexOf(",")&&(w=w.split(",")[0])),_transformProps[w]&&w!=="transform"?(O=_parseTransform(A,C),O=w!=="transformOrigin"?O[w]:O.svg?O.origin:_firstTwoOnly(_getComputedProperty(A,_transformOriginProp))+" "+O.zOrigin+"px"):(O=A.style[w],(!O||O==="auto"||C||~(O+"").indexOf("calc("))&&(O=_specialProps[w]&&_specialProps[w](A,w,c)||_getComputedProperty(A,w)||_getProperty(A,w)||(w==="opacity"?1:0))),c&&!~(O+"").trim().indexOf(" ")?_convertToUnit(A,w,O,c)+c:O},_tweenComplexCSSString=function(A,w,c,C){if(!c||c==="none"){var O=_checkPropPrefix(w,A,1),F=O&&_getComputedProperty(A,O,1);F&&F!==c?(w=O,c=F):w==="borderColor"&&(c=_getComputedProperty(A,"borderTopColor"))}var G=new PropTween(this._pt,A.style,w,0,1,_renderComplexString),X=0,te=0,ue,fe,de,le,me,$,_e,oe,ge,Se,je,ye;if(G.b=c,G.e=C,c+="",C+="",C==="auto"&&(A.style[w]=C,C=_getComputedProperty(A,w)||C,A.style[w]=c),ue=[c,C],_colorStringFilter(ue),c=ue[0],C=ue[1],de=c.match(_numWithUnitExp)||[],ye=C.match(_numWithUnitExp)||[],ye.length){for(;fe=_numWithUnitExp.exec(C);)_e=fe[0],ge=C.substring(X,fe.index),me?me=(me+1)%5:(ge.substr(-5)==="rgba("||ge.substr(-5)==="hsla(")&&(me=1),_e!==($=de[te++]||"")&&(le=parseFloat($)||0,je=$.substr((le+"").length),_e.charAt(1)==="="&&(_e=_parseRelative(le,_e)+je),oe=parseFloat(_e),Se=_e.substr((oe+"").length),X=_numWithUnitExp.lastIndex-Se.length,Se||(Se=Se||_config.units[w]||je,X===C.length&&(C+=Se,G.e+=Se)),je!==Se&&(le=_convertToUnit(A,w,$,Se)||0),G._pt={_next:G._pt,p:ge||te===1?ge:",",s:le,c:oe-le,m:me&&me<4||w==="zIndex"?Math.round:0});G.c=X<C.length?C.substring(X,C.length):""}else G.r=w==="display"&&C==="none"?_renderNonTweeningValueOnlyAtEnd:_renderNonTweeningValue;return _relExp.test(C)&&(G.e=0),this._pt=G,G},_keywordToPercent={top:"0%",bottom:"100%",left:"0%",right:"100%",center:"50%"},_convertKeywordsToPercentages=function(A){var w=A.split(" "),c=w[0],C=w[1]||"50%";return(c==="top"||c==="bottom"||C==="left"||C==="right")&&(A=c,c=C,C=A),w[0]=_keywordToPercent[c]||c,w[1]=_keywordToPercent[C]||C,w.join(" ")},_renderClearProps=function(A,w){if(w.tween&&w.tween._time===w.tween._dur){var c=w.t,C=c.style,O=w.u,F=c._gsap,G,X,te;if(O==="all"||O===!0)C.cssText="",X=1;else for(O=O.split(","),te=O.length;--te>-1;)G=O[te],_transformProps[G]&&(X=1,G=G==="transformOrigin"?_transformOriginProp:_transformProp$1),_removeProperty(c,G);X&&(_removeProperty(c,_transformProp$1),F&&(F.svg&&c.removeAttribute("transform"),_parseTransform(c,1),F.uncache=1,_removeIndependentTransforms(C)))}},_specialProps={clearProps:function(A,w,c,C,O){if(O.data!=="isFromStart"){var F=A._pt=new PropTween(A._pt,w,c,0,0,_renderClearProps);return F.u=C,F.pr=-10,F.tween=O,A._props.push(c),1}}},_identity2DMatrix=[1,0,0,1,0,0],_rotationalProperties={},_isNullTransform=function(A){return A==="matrix(1, 0, 0, 1, 0, 0)"||A==="none"||!A},_getComputedTransformMatrixAsArray=function(A){var w=_getComputedProperty(A,_transformProp$1);return _isNullTransform(w)?_identity2DMatrix:w.substr(7).match(_numExp).map(_round$1)},_getMatrix=function(A,w){var c=A._gsap||_getCache(A),C=A.style,O=_getComputedTransformMatrixAsArray(A),F,G,X,te;return c.svg&&A.getAttribute("transform")?(X=A.transform.baseVal.consolidate().matrix,O=[X.a,X.b,X.c,X.d,X.e,X.f],O.join(",")==="1,0,0,1,0,0"?_identity2DMatrix:O):(O===_identity2DMatrix&&!A.offsetParent&&A!==_docElement&&!c.svg&&(X=C.display,C.display="block",F=A.parentNode,(!F||!A.offsetParent)&&(te=1,G=A.nextElementSibling,_docElement.appendChild(A)),O=_getComputedTransformMatrixAsArray(A),X?C.display=X:_removeProperty(A,"display"),te&&(G?F.insertBefore(A,G):F?F.appendChild(A):_docElement.removeChild(A))),w&&O.length>6?[O[0],O[1],O[4],O[5],O[12],O[13]]:O)},_applySVGOrigin=function(A,w,c,C,O,F){var G=A._gsap,X=O||_getMatrix(A,!0),te=G.xOrigin||0,ue=G.yOrigin||0,fe=G.xOffset||0,de=G.yOffset||0,le=X[0],me=X[1],$=X[2],_e=X[3],oe=X[4],ge=X[5],Se=w.split(" "),je=parseFloat(Se[0])||0,ye=parseFloat(Se[1])||0,Ne,Z,se,ae;c?X!==_identity2DMatrix&&(Z=le*_e-me*$)&&(se=je*(_e/Z)+ye*(-$/Z)+($*ge-_e*oe)/Z,ae=je*(-me/Z)+ye*(le/Z)-(le*ge-me*oe)/Z,je=se,ye=ae):(Ne=_getBBox(A),je=Ne.x+(~Se[0].indexOf("%")?je/100*Ne.width:je),ye=Ne.y+(~(Se[1]||Se[0]).indexOf("%")?ye/100*Ne.height:ye)),C||C!==!1&&G.smooth?(oe=je-te,ge=ye-ue,G.xOffset=fe+(oe*le+ge*$)-oe,G.yOffset=de+(oe*me+ge*_e)-ge):G.xOffset=G.yOffset=0,G.xOrigin=je,G.yOrigin=ye,G.smooth=!!C,G.origin=w,G.originIsAbsolute=!!c,A.style[_transformOriginProp]="0px 0px",F&&(_addNonTweeningPT(F,G,"xOrigin",te,je),_addNonTweeningPT(F,G,"yOrigin",ue,ye),_addNonTweeningPT(F,G,"xOffset",fe,G.xOffset),_addNonTweeningPT(F,G,"yOffset",de,G.yOffset)),A.setAttribute("data-svg-origin",je+" "+ye)},_parseTransform=function(A,w){var c=A._gsap||new GSCache(A);if("x"in c&&!w&&!c.uncache)return c;var C=A.style,O=c.scaleX<0,F="px",G="deg",X=getComputedStyle(A),te=_getComputedProperty(A,_transformOriginProp)||"0",ue,fe,de,le,me,$,_e,oe,ge,Se,je,ye,Ne,Z,se,ae,Be,we,tt,St,_t,xt,ct,Ot,At,Pt,Ie,vt,ft,jt,rt,pe;return ue=fe=de=$=_e=oe=ge=Se=je=0,le=me=1,c.svg=!!(A.getCTM&&_isSVG(A)),X.translate&&((X.translate!=="none"||X.scale!=="none"||X.rotate!=="none")&&(C[_transformProp$1]=(X.translate!=="none"?"translate3d("+(X.translate+" 0 0").split(" ").slice(0,3).join(", ")+") ":"")+(X.rotate!=="none"?"rotate("+X.rotate+") ":"")+(X.scale!=="none"?"scale("+X.scale.split(" ").join(",")+") ":"")+(X[_transformProp$1]!=="none"?X[_transformProp$1]:"")),C.scale=C.rotate=C.translate="none"),Z=_getMatrix(A,c.svg),c.svg&&(c.uncache?(At=A.getBBox(),te=c.xOrigin-At.x+"px "+(c.yOrigin-At.y)+"px",Ot=""):Ot=!w&&A.getAttribute("data-svg-origin"),_applySVGOrigin(A,Ot||te,!!Ot||c.originIsAbsolute,c.smooth!==!1,Z)),ye=c.xOrigin||0,Ne=c.yOrigin||0,Z!==_identity2DMatrix&&(we=Z[0],tt=Z[1],St=Z[2],_t=Z[3],ue=xt=Z[4],fe=ct=Z[5],Z.length===6?(le=Math.sqrt(we*we+tt*tt),me=Math.sqrt(_t*_t+St*St),$=we||tt?_atan2(tt,we)*_RAD2DEG:0,ge=St||_t?_atan2(St,_t)*_RAD2DEG+$:0,ge&&(me*=Math.abs(Math.cos(ge*_DEG2RAD))),c.svg&&(ue-=ye-(ye*we+Ne*St),fe-=Ne-(ye*tt+Ne*_t))):(pe=Z[6],jt=Z[7],Ie=Z[8],vt=Z[9],ft=Z[10],rt=Z[11],ue=Z[12],fe=Z[13],de=Z[14],se=_atan2(pe,ft),_e=se*_RAD2DEG,se&&(ae=Math.cos(-se),Be=Math.sin(-se),Ot=xt*ae+Ie*Be,At=ct*ae+vt*Be,Pt=pe*ae+ft*Be,Ie=xt*-Be+Ie*ae,vt=ct*-Be+vt*ae,ft=pe*-Be+ft*ae,rt=jt*-Be+rt*ae,xt=Ot,ct=At,pe=Pt),se=_atan2(-St,ft),oe=se*_RAD2DEG,se&&(ae=Math.cos(-se),Be=Math.sin(-se),Ot=we*ae-Ie*Be,At=tt*ae-vt*Be,Pt=St*ae-ft*Be,rt=_t*Be+rt*ae,we=Ot,tt=At,St=Pt),se=_atan2(tt,we),$=se*_RAD2DEG,se&&(ae=Math.cos(se),Be=Math.sin(se),Ot=we*ae+tt*Be,At=xt*ae+ct*Be,tt=tt*ae-we*Be,ct=ct*ae-xt*Be,we=Ot,xt=At),_e&&Math.abs(_e)+Math.abs($)>359.9&&(_e=$=0,oe=180-oe),le=_round$1(Math.sqrt(we*we+tt*tt+St*St)),me=_round$1(Math.sqrt(ct*ct+pe*pe)),se=_atan2(xt,ct),ge=Math.abs(se)>2e-4?se*_RAD2DEG:0,je=rt?1/(rt<0?-rt:rt):0),c.svg&&(Ot=A.getAttribute("transform"),c.forceCSS=A.setAttribute("transform","")||!_isNullTransform(_getComputedProperty(A,_transformProp$1)),Ot&&A.setAttribute("transform",Ot))),Math.abs(ge)>90&&Math.abs(ge)<270&&(O?(le*=-1,ge+=$<=0?180:-180,$+=$<=0?180:-180):(me*=-1,ge+=ge<=0?180:-180)),w=w||c.uncache,c.x=ue-((c.xPercent=ue&&(!w&&c.xPercent||(Math.round(A.offsetWidth/2)===Math.round(-ue)?-50:0)))?A.offsetWidth*c.xPercent/100:0)+F,c.y=fe-((c.yPercent=fe&&(!w&&c.yPercent||(Math.round(A.offsetHeight/2)===Math.round(-fe)?-50:0)))?A.offsetHeight*c.yPercent/100:0)+F,c.z=de+F,c.scaleX=_round$1(le),c.scaleY=_round$1(me),c.rotation=_round$1($)+G,c.rotationX=_round$1(_e)+G,c.rotationY=_round$1(oe)+G,c.skewX=ge+G,c.skewY=Se+G,c.transformPerspective=je+F,(c.zOrigin=parseFloat(te.split(" ")[2])||0)&&(C[_transformOriginProp]=_firstTwoOnly(te)),c.xOffset=c.yOffset=0,c.force3D=_config.force3D,c.renderTransform=c.svg?_renderSVGTransforms:_supports3D?_renderCSSTransforms:_renderNon3DTransforms,c.uncache=0,c},_firstTwoOnly=function(A){return(A=A.split(" "))[0]+" "+A[1]},_addPxTranslate=function(A,w,c){var C=getUnit(w);return _round$1(parseFloat(w)+parseFloat(_convertToUnit(A,"x",c+"px",C)))+C},_renderNon3DTransforms=function(A,w){w.z="0px",w.rotationY=w.rotationX="0deg",w.force3D=0,_renderCSSTransforms(A,w)},_zeroDeg="0deg",_zeroPx="0px",_endParenthesis=") ",_renderCSSTransforms=function(A,w){var c=w||this,C=c.xPercent,O=c.yPercent,F=c.x,G=c.y,X=c.z,te=c.rotation,ue=c.rotationY,fe=c.rotationX,de=c.skewX,le=c.skewY,me=c.scaleX,$=c.scaleY,_e=c.transformPerspective,oe=c.force3D,ge=c.target,Se=c.zOrigin,je="",ye=oe==="auto"&&A&&A!==1||oe===!0;if(Se&&(fe!==_zeroDeg||ue!==_zeroDeg)){var Ne=parseFloat(ue)*_DEG2RAD,Z=Math.sin(Ne),se=Math.cos(Ne),ae;Ne=parseFloat(fe)*_DEG2RAD,ae=Math.cos(Ne),F=_addPxTranslate(ge,F,Z*ae*-Se),G=_addPxTranslate(ge,G,-Math.sin(Ne)*-Se),X=_addPxTranslate(ge,X,se*ae*-Se+Se)}_e!==_zeroPx&&(je+="perspective("+_e+_endParenthesis),(C||O)&&(je+="translate("+C+"%, "+O+"%) "),(ye||F!==_zeroPx||G!==_zeroPx||X!==_zeroPx)&&(je+=X!==_zeroPx||ye?"translate3d("+F+", "+G+", "+X+") ":"translate("+F+", "+G+_endParenthesis),te!==_zeroDeg&&(je+="rotate("+te+_endParenthesis),ue!==_zeroDeg&&(je+="rotateY("+ue+_endParenthesis),fe!==_zeroDeg&&(je+="rotateX("+fe+_endParenthesis),(de!==_zeroDeg||le!==_zeroDeg)&&(je+="skew("+de+", "+le+_endParenthesis),(me!==1||$!==1)&&(je+="scale("+me+", "+$+_endParenthesis),ge.style[_transformProp$1]=je||"translate(0, 0)"},_renderSVGTransforms=function(A,w){var c=w||this,C=c.xPercent,O=c.yPercent,F=c.x,G=c.y,X=c.rotation,te=c.skewX,ue=c.skewY,fe=c.scaleX,de=c.scaleY,le=c.target,me=c.xOrigin,$=c.yOrigin,_e=c.xOffset,oe=c.yOffset,ge=c.forceCSS,Se=parseFloat(F),je=parseFloat(G),ye,Ne,Z,se,ae;X=parseFloat(X),te=parseFloat(te),ue=parseFloat(ue),ue&&(ue=parseFloat(ue),te+=ue,X+=ue),X||te?(X*=_DEG2RAD,te*=_DEG2RAD,ye=Math.cos(X)*fe,Ne=Math.sin(X)*fe,Z=Math.sin(X-te)*-de,se=Math.cos(X-te)*de,te&&(ue*=_DEG2RAD,ae=Math.tan(te-ue),ae=Math.sqrt(1+ae*ae),Z*=ae,se*=ae,ue&&(ae=Math.tan(ue),ae=Math.sqrt(1+ae*ae),ye*=ae,Ne*=ae)),ye=_round$1(ye),Ne=_round$1(Ne),Z=_round$1(Z),se=_round$1(se)):(ye=fe,se=de,Ne=Z=0),(Se&&!~(F+"").indexOf("px")||je&&!~(G+"").indexOf("px"))&&(Se=_convertToUnit(le,"x",F,"px"),je=_convertToUnit(le,"y",G,"px")),(me||$||_e||oe)&&(Se=_round$1(Se+me-(me*ye+$*Z)+_e),je=_round$1(je+$-(me*Ne+$*se)+oe)),(C||O)&&(ae=le.getBBox(),Se=_round$1(Se+C/100*ae.width),je=_round$1(je+O/100*ae.height)),ae="matrix("+ye+","+Ne+","+Z+","+se+","+Se+","+je+")",le.setAttribute("transform",ae),ge&&(le.style[_transformProp$1]=ae)},_addRotationalPropTween=function(A,w,c,C,O){var F=360,G=_isString$1(O),X=parseFloat(O)*(G&&~O.indexOf("rad")?_RAD2DEG:1),te=X-C,ue=C+te+"deg",fe,de;return G&&(fe=O.split("_")[1],fe==="short"&&(te%=F,te!==te%(F/2)&&(te+=te<0?F:-F)),fe==="cw"&&te<0?te=(te+F*_bigNum)%F-~~(te/F)*F:fe==="ccw"&&te>0&&(te=(te-F*_bigNum)%F-~~(te/F)*F)),A._pt=de=new PropTween(A._pt,w,c,C,te,_renderPropWithEnd),de.e=ue,de.u="deg",A._props.push(c),de},_assign=function(A,w){for(var c in w)A[c]=w[c];return A},_addRawTransformPTs=function(A,w,c){var C=_assign({},c._gsap),O="perspective,force3D,transformOrigin,svgOrigin",F=c.style,G,X,te,ue,fe,de,le,me;C.svg?(te=c.getAttribute("transform"),c.setAttribute("transform",""),F[_transformProp$1]=w,G=_parseTransform(c,1),_removeProperty(c,_transformProp$1),c.setAttribute("transform",te)):(te=getComputedStyle(c)[_transformProp$1],F[_transformProp$1]=w,G=_parseTransform(c,1),F[_transformProp$1]=te);for(X in _transformProps)te=C[X],ue=G[X],te!==ue&&O.indexOf(X)<0&&(le=getUnit(te),me=getUnit(ue),fe=le!==me?_convertToUnit(c,X,te,me):parseFloat(te),de=parseFloat(ue),A._pt=new PropTween(A._pt,G,X,fe,de-fe,_renderCSSProp),A._pt.u=me||0,A._props.push(X));_assign(G,C)};_forEachName("padding,margin,Width,Radius",function(K,A){var w="Top",c="Right",C="Bottom",O="Left",F=(A<3?[w,c,C,O]:[w+O,w+c,C+c,C+O]).map(function(G){return A<2?K+G:"border"+G+K});_specialProps[A>1?"border"+K:K]=function(G,X,te,ue,fe){var de,le;if(arguments.length<4)return de=F.map(function(me){return _get(G,me,te)}),le=de.join(" "),le.split(de[0]).length===5?de[0]:le;de=(ue+"").split(" "),le={},F.forEach(function(me,$){return le[me]=de[$]=de[$]||de[($-1)/2|0]}),G.init(X,le,fe)}});var CSSPlugin={name:"css",register:_initCore$1,targetTest:function(A){return A.style&&A.nodeType},init:function(A,w,c,C,O){var F=this._props,G=A.style,X=c.vars.startAt,te,ue,fe,de,le,me,$,_e,oe,ge,Se,je,ye,Ne,Z,se;_pluginInitted||_initCore$1(),this.styles=this.styles||_getStyleSaver(A),se=this.styles.props,this.tween=c;for($ in w)if($!=="autoRound"&&(ue=w[$],!(_plugins[$]&&_checkPlugin($,w,c,C,A,O)))){if(le=typeof ue,me=_specialProps[$],le==="function"&&(ue=ue.call(c,C,A,O),le=typeof ue),le==="string"&&~ue.indexOf("random(")&&(ue=_replaceRandom(ue)),me)me(this,A,$,ue,c)&&(Z=1);else if($.substr(0,2)==="--")te=(getComputedStyle(A).getPropertyValue($)+"").trim(),ue+="",_colorExp.lastIndex=0,_colorExp.test(te)||(_e=getUnit(te),oe=getUnit(ue)),oe?_e!==oe&&(te=_convertToUnit(A,$,te,oe)+oe):_e&&(ue+=_e),this.add(G,"setProperty",te,ue,C,O,0,0,$),F.push($),se.push($,0,G[$]);else if(le!=="undefined"){if(X&&$ in X?(te=typeof X[$]=="function"?X[$].call(c,C,A,O):X[$],_isString$1(te)&&~te.indexOf("random(")&&(te=_replaceRandom(te)),getUnit(te+"")||(te+=_config.units[$]||getUnit(_get(A,$))||""),(te+"").charAt(1)==="="&&(te=_get(A,$))):te=_get(A,$),de=parseFloat(te),ge=le==="string"&&ue.charAt(1)==="="&&ue.substr(0,2),ge&&(ue=ue.substr(2)),fe=parseFloat(ue),$ in _propertyAliases&&($==="autoAlpha"&&(de===1&&_get(A,"visibility")==="hidden"&&fe&&(de=0),se.push("visibility",0,G.visibility),_addNonTweeningPT(this,G,"visibility",de?"inherit":"hidden",fe?"inherit":"hidden",!fe)),$!=="scale"&&$!=="transform"&&($=_propertyAliases[$],~$.indexOf(",")&&($=$.split(",")[0]))),Se=$ in _transformProps,Se){if(this.styles.save($),je||(ye=A._gsap,ye.renderTransform&&!w.parseTransform||_parseTransform(A,w.parseTransform),Ne=w.smoothOrigin!==!1&&ye.smooth,je=this._pt=new PropTween(this._pt,G,_transformProp$1,0,1,ye.renderTransform,ye,0,-1),je.dep=1),$==="scale")this._pt=new PropTween(this._pt,ye,"scaleY",ye.scaleY,(ge?_parseRelative(ye.scaleY,ge+fe):fe)-ye.scaleY||0,_renderCSSProp),this._pt.u=0,F.push("scaleY",$),$+="X";else if($==="transformOrigin"){se.push(_transformOriginProp,0,G[_transformOriginProp]),ue=_convertKeywordsToPercentages(ue),ye.svg?_applySVGOrigin(A,ue,0,Ne,0,this):(oe=parseFloat(ue.split(" ")[2])||0,oe!==ye.zOrigin&&_addNonTweeningPT(this,ye,"zOrigin",ye.zOrigin,oe),_addNonTweeningPT(this,G,$,_firstTwoOnly(te),_firstTwoOnly(ue)));continue}else if($==="svgOrigin"){_applySVGOrigin(A,ue,1,Ne,0,this);continue}else if($ in _rotationalProperties){_addRotationalPropTween(this,ye,$,de,ge?_parseRelative(de,ge+ue):ue);continue}else if($==="smoothOrigin"){_addNonTweeningPT(this,ye,"smooth",ye.smooth,ue);continue}else if($==="force3D"){ye[$]=ue;continue}else if($==="transform"){_addRawTransformPTs(this,ue,A);continue}}else $ in G||($=_checkPropPrefix($)||$);if(Se||(fe||fe===0)&&(de||de===0)&&!_complexExp.test(ue)&&$ in G)_e=(te+"").substr((de+"").length),fe||(fe=0),oe=getUnit(ue)||($ in _config.units?_config.units[$]:_e),_e!==oe&&(de=_convertToUnit(A,$,te,oe)),this._pt=new PropTween(this._pt,Se?ye:G,$,de,(ge?_parseRelative(de,ge+fe):fe)-de,!Se&&(oe==="px"||$==="zIndex")&&w.autoRound!==!1?_renderRoundedCSSProp:_renderCSSProp),this._pt.u=oe||0,_e!==oe&&oe!=="%"&&(this._pt.b=te,this._pt.r=_renderCSSPropWithBeginning);else if($ in G)_tweenComplexCSSString.call(this,A,$,te,ge?ge+ue:ue);else if($ in A)this.add(A,$,te||A[$],ge?ge+ue:ue,C,O);else if($!=="parseTransform"){_missingPlugin($,ue);continue}Se||($ in G?se.push($,0,G[$]):se.push($,1,te||A[$])),F.push($)}}Z&&_sortPropTweensByPriority(this)},render:function(A,w){if(w.tween._time||!_reverting())for(var c=w._pt;c;)c.r(A,c.d),c=c._next;else w.styles.revert()},get:_get,aliases:_propertyAliases,getSetter:function(A,w,c){var C=_propertyAliases[w];return C&&C.indexOf(",")<0&&(w=C),w in _transformProps&&w!==_transformOriginProp&&(A._gsap.x||_get(A,"x"))?c&&_recentSetterPlugin===c?w==="scale"?_setterScale:_setterTransform:(_recentSetterPlugin=c||{})&&(w==="scale"?_setterScaleWithRender:_setterTransformWithRender):A.style&&!_isUndefined(A.style[w])?_setterCSSStyle:~w.indexOf("-")?_setterCSSProp:_getSetter(A,w)},core:{_removeProperty,_getMatrix}};gsap$2.utils.checkPrefix=_checkPropPrefix;gsap$2.core.getStyleSaver=_getStyleSaver;(function(K,A,w,c){var C=_forEachName(K+","+A+","+w,function(O){_transformProps[O]=1});_forEachName(A,function(O){_config.units[O]="deg",_rotationalProperties[O]=1}),_propertyAliases[C[13]]=K+","+A,_forEachName(c,function(O){var F=O.split(":");_propertyAliases[F[1]]=C[F[0]]})})("x,y,z,scale,scaleX,scaleY,xPercent,yPercent","rotation,rotationX,rotationY,skewX,skewY","transform,transformOrigin,svgOrigin,force3D,smoothOrigin,transformPerspective","0:translateX,1:translateY,2:translateZ,8:rotate,8:rotationZ,8:rotateZ,9:rotateX,10:rotateY");_forEachName("x,y,z,top,right,bottom,left,width,height,fontSize,padding,margin,perspective",function(K){_config.units[K]="px"});gsap$2.registerPlugin(CSSPlugin);var gsapWithCSS=gsap$2.registerPlugin(CSSPlugin)||gsap$2;gsapWithCSS.core.Tween;function _defineProperties(K,A){for(var w=0;w<A.length;w++){var c=A[w];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(K,c.key,c)}}function _createClass(K,A,w){return A&&_defineProperties(K.prototype,A),w&&_defineProperties(K,w),K}/*!
 * Observer 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap$1,_coreInitted$1,_win$1,_doc$1,_docEl$1,_body$1,_isTouch,_pointerType,ScrollTrigger$1,_root$1,_normalizer$1,_eventTypes,_context$1,_getGSAP$1=function(){return gsap$1||typeof window<"u"&&(gsap$1=window.gsap)&&gsap$1.registerPlugin&&gsap$1},_startup$1=1,_observers=[],_scrollers=[],_proxies=[],_getTime$1=Date.now,_bridge=function(A,w){return w},_integrate=function(){var A=ScrollTrigger$1.core,w=A.bridge||{},c=A._scrollers,C=A._proxies;c.push.apply(c,_scrollers),C.push.apply(C,_proxies),_scrollers=c,_proxies=C,_bridge=function(F,G){return w[F](G)}},_getProxyProp=function(A,w){return~_proxies.indexOf(A)&&_proxies[_proxies.indexOf(A)+1][w]},_isViewport$1=function(A){return!!~_root$1.indexOf(A)},_addListener$1=function(A,w,c,C,O){return A.addEventListener(w,c,{passive:!C,capture:!!O})},_removeListener$1=function(A,w,c,C){return A.removeEventListener(w,c,!!C)},_scrollLeft="scrollLeft",_scrollTop="scrollTop",_onScroll$1=function(){return _normalizer$1&&_normalizer$1.isPressed||_scrollers.cache++},_scrollCacheFunc=function(A,w){var c=function C(O){if(O||O===0){_startup$1&&(_win$1.history.scrollRestoration="manual");var F=_normalizer$1&&_normalizer$1.isPressed;O=C.v=Math.round(O)||(_normalizer$1&&_normalizer$1.iOS?1:0),A(O),C.cacheID=_scrollers.cache,F&&_bridge("ss",O)}else(w||_scrollers.cache!==C.cacheID||_bridge("ref"))&&(C.cacheID=_scrollers.cache,C.v=A());return C.v+C.offset};return c.offset=0,A&&c},_horizontal={s:_scrollLeft,p:"left",p2:"Left",os:"right",os2:"Right",d:"width",d2:"Width",a:"x",sc:_scrollCacheFunc(function(K){return arguments.length?_win$1.scrollTo(K,_vertical.sc()):_win$1.pageXOffset||_doc$1[_scrollLeft]||_docEl$1[_scrollLeft]||_body$1[_scrollLeft]||0})},_vertical={s:_scrollTop,p:"top",p2:"Top",os:"bottom",os2:"Bottom",d:"height",d2:"Height",a:"y",op:_horizontal,sc:_scrollCacheFunc(function(K){return arguments.length?_win$1.scrollTo(_horizontal.sc(),K):_win$1.pageYOffset||_doc$1[_scrollTop]||_docEl$1[_scrollTop]||_body$1[_scrollTop]||0})},_getTarget=function(A){return gsap$1.utils.toArray(A)[0]||(typeof A=="string"&&gsap$1.config().nullTargetWarn!==!1?console.warn("Element not found:",A):null)},_getScrollFunc=function(A,w){var c=w.s,C=w.sc;_isViewport$1(A)&&(A=_doc$1.scrollingElement||_docEl$1);var O=_scrollers.indexOf(A),F=C===_vertical.sc?1:2;!~O&&(O=_scrollers.push(A)-1),_scrollers[O+F]||A.addEventListener("scroll",_onScroll$1);var G=_scrollers[O+F],X=G||(_scrollers[O+F]=_scrollCacheFunc(_getProxyProp(A,c),!0)||(_isViewport$1(A)?C:_scrollCacheFunc(function(te){return arguments.length?A[c]=te:A[c]})));return X.target=A,G||(X.smooth=gsap$1.getProperty(A,"scrollBehavior")==="smooth"),X},_getVelocityProp=function(A,w,c){var C=A,O=A,F=_getTime$1(),G=F,X=w||50,te=Math.max(500,X*3),ue=function(me,$){var _e=_getTime$1();$||_e-F>X?(O=C,C=me,G=F,F=_e):c?C+=me:C=O+(me-O)/(_e-G)*(F-G)},fe=function(){O=C=c?0:C,G=F=0},de=function(me){var $=G,_e=O,oe=_getTime$1();return(me||me===0)&&me!==C&&ue(me),F===G||oe-G>te?0:(C+(c?_e:-_e))/((c?oe:F)-$)*1e3};return{update:ue,reset:fe,getVelocity:de}},_getEvent=function(A,w){return w&&!A._gsapAllow&&A.preventDefault(),A.changedTouches?A.changedTouches[0]:A},_getAbsoluteMax=function(A){var w=Math.max.apply(Math,A),c=Math.min.apply(Math,A);return Math.abs(w)>=Math.abs(c)?w:c},_setScrollTrigger=function(){ScrollTrigger$1=gsap$1.core.globals().ScrollTrigger,ScrollTrigger$1&&ScrollTrigger$1.core&&_integrate()},_initCore=function(A){return gsap$1=A||_getGSAP$1(),gsap$1&&typeof document<"u"&&document.body&&(_win$1=window,_doc$1=document,_docEl$1=_doc$1.documentElement,_body$1=_doc$1.body,_root$1=[_win$1,_doc$1,_docEl$1,_body$1],gsap$1.utils.clamp,_context$1=gsap$1.core.context||function(){},_pointerType="onpointerenter"in _body$1?"pointer":"mouse",_isTouch=Observer.isTouch=_win$1.matchMedia&&_win$1.matchMedia("(hover: none), (pointer: coarse)").matches?1:"ontouchstart"in _win$1||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0?2:0,_eventTypes=Observer.eventTypes=("ontouchstart"in _docEl$1?"touchstart,touchmove,touchcancel,touchend":"onpointerdown"in _docEl$1?"pointerdown,pointermove,pointercancel,pointerup":"mousedown,mousemove,mouseup,mouseup").split(","),setTimeout(function(){return _startup$1=0},500),_setScrollTrigger(),_coreInitted$1=1),_coreInitted$1};_horizontal.op=_vertical;_scrollers.cache=0;var Observer=function(){function K(w){this.init(w)}var A=K.prototype;return A.init=function(c){_coreInitted$1||_initCore(gsap$1)||console.warn("Please gsap.registerPlugin(Observer)"),ScrollTrigger$1||_setScrollTrigger();var C=c.tolerance,O=c.dragMinimum,F=c.type,G=c.target,X=c.lineHeight,te=c.debounce,ue=c.preventDefault,fe=c.onStop,de=c.onStopDelay,le=c.ignore,me=c.wheelSpeed,$=c.event,_e=c.onDragStart,oe=c.onDragEnd,ge=c.onDrag,Se=c.onPress,je=c.onRelease,ye=c.onRight,Ne=c.onLeft,Z=c.onUp,se=c.onDown,ae=c.onChangeX,Be=c.onChangeY,we=c.onChange,tt=c.onToggleX,St=c.onToggleY,_t=c.onHover,xt=c.onHoverEnd,ct=c.onMove,Ot=c.ignoreCheck,At=c.isNormalizer,Pt=c.onGestureStart,Ie=c.onGestureEnd,vt=c.onWheel,ft=c.onEnable,jt=c.onDisable,rt=c.onClick,pe=c.scrollSpeed,be=c.capture,Xe=c.allowClicks,zt=c.lockAxis,Wt=c.onLockAxis;this.target=G=_getTarget(G)||_docEl$1,this.vars=c,le&&(le=gsap$1.utils.toArray(le)),C=C||1e-9,O=O||0,me=me||1,pe=pe||1,F=F||"wheel,touch,pointer",te=te!==!1,X||(X=parseFloat(_win$1.getComputedStyle(_body$1).lineHeight)||22);var qt,Cn,vn,Zn,Xn,Pi,qn,gt=this,mi=0,Ei=0,Rr=_getScrollFunc(G,_horizontal),Xi=_getScrollFunc(G,_vertical),zi=Rr(),Vi=Xi(),Gi=~F.indexOf("touch")&&!~F.indexOf("pointer")&&_eventTypes[0]==="pointerdown",Vr=_isViewport$1(G),Di=G.ownerDocument||_doc$1,gi=[0,0,0],br=[0,0,0],ar=0,Ki=function(){return ar=_getTime$1()},Po=function(cn,kt){return(gt.event=cn)&&le&&~le.indexOf(cn.target)||kt&&Gi&&cn.pointerType!=="touch"||Ot&&Ot(cn,kt)},lr=function(){gt._vx.reset(),gt._vy.reset(),Cn.pause(),fe&&fe(gt)},cs=function(){var cn=gt.deltaX=_getAbsoluteMax(gi),kt=gt.deltaY=_getAbsoluteMax(br),Gn=Math.abs(cn)>=C,Qn=Math.abs(kt)>=C;we&&(Gn||Qn)&&we(gt,cn,kt,gi,br),Gn&&(ye&&gt.deltaX>0&&ye(gt),Ne&&gt.deltaX<0&&Ne(gt),ae&&ae(gt),tt&&gt.deltaX<0!=mi<0&&tt(gt),mi=gt.deltaX,gi[0]=gi[1]=gi[2]=0),Qn&&(se&&gt.deltaY>0&&se(gt),Z&&gt.deltaY<0&&Z(gt),Be&&Be(gt),St&&gt.deltaY<0!=Ei<0&&St(gt),Ei=gt.deltaY,br[0]=br[1]=br[2]=0),(Zn||vn)&&(ct&&ct(gt),vn&&(ge(gt),vn=!1),Zn=!1),Pi&&!(Pi=!1)&&Wt&&Wt(gt),Xn&&(vt(gt),Xn=!1),qt=0},nr=function(cn,kt,Gn){gi[Gn]+=cn,br[Gn]+=kt,gt._vx.update(cn),gt._vy.update(kt),te?qt||(qt=requestAnimationFrame(cs)):cs()},Es=function(cn,kt){zt&&!qn&&(gt.axis=qn=Math.abs(cn)>Math.abs(kt)?"x":"y",Pi=!0),qn!=="y"&&(gi[2]+=cn,gt._vx.update(cn,!0)),qn!=="x"&&(br[2]+=kt,gt._vy.update(kt,!0)),te?qt||(qt=requestAnimationFrame(cs)):cs()},Do=function(cn){if(!Po(cn,1)){cn=_getEvent(cn,ue);var kt=cn.clientX,Gn=cn.clientY,Qn=kt-gt.x,Nn=Gn-gt.y,ir=gt.isDragging;gt.x=kt,gt.y=Gn,(ir||Math.abs(gt.startX-kt)>=O||Math.abs(gt.startY-Gn)>=O)&&(ge&&(vn=!0),ir||(gt.isDragging=!0),Es(Qn,Nn),ir||_e&&_e(gt))}},Sn=gt.onPress=function(ri){Po(ri,1)||(gt.axis=qn=null,Cn.pause(),gt.isPressed=!0,ri=_getEvent(ri),mi=Ei=0,gt.startX=gt.x=ri.clientX,gt.startY=gt.y=ri.clientY,gt._vx.reset(),gt._vy.reset(),_addListener$1(At?G:Di,_eventTypes[1],Do,ue,!0),gt.deltaX=gt.deltaY=0,Se&&Se(gt))},Ui=function(cn){if(!Po(cn,1)){_removeListener$1(At?G:Di,_eventTypes[1],Do,!0);var kt=!isNaN(gt.y-gt.startY),Gn=gt.isDragging&&(Math.abs(gt.x-gt.startX)>3||Math.abs(gt.y-gt.startY)>3),Qn=_getEvent(cn);!Gn&&kt&&(gt._vx.reset(),gt._vy.reset(),ue&&Xe&&gsap$1.delayedCall(.08,function(){if(_getTime$1()-ar>300&&!cn.defaultPrevented){if(cn.target.click)cn.target.click();else if(Di.createEvent){var Nn=Di.createEvent("MouseEvents");Nn.initMouseEvent("click",!0,!0,_win$1,1,Qn.screenX,Qn.screenY,Qn.clientX,Qn.clientY,!1,!1,!1,!1,0,null),cn.target.dispatchEvent(Nn)}}})),gt.isDragging=gt.isGesturing=gt.isPressed=!1,fe&&!At&&Cn.restart(!0),oe&&Gn&&oe(gt),je&&je(gt,Gn)}},qr=function(cn){return cn.touches&&cn.touches.length>1&&(gt.isGesturing=!0)&&Pt(cn,gt.isDragging)},Sr=function(){return(gt.isGesturing=!1)||Ie(gt)},no=function(cn){if(!Po(cn)){var kt=Rr(),Gn=Xi();nr((kt-zi)*pe,(Gn-Vi)*pe,1),zi=kt,Vi=Gn,fe&&Cn.restart(!0)}},Vs=function(cn){if(!Po(cn)){cn=_getEvent(cn,ue),vt&&(Xn=!0);var kt=(cn.deltaMode===1?X:cn.deltaMode===2?_win$1.innerHeight:1)*me;nr(cn.deltaX*kt,cn.deltaY*kt,0),fe&&!At&&Cn.restart(!0)}},_o=function(cn){if(!Po(cn)){var kt=cn.clientX,Gn=cn.clientY,Qn=kt-gt.x,Nn=Gn-gt.y;gt.x=kt,gt.y=Gn,Zn=!0,(Qn||Nn)&&Es(Qn,Nn)}},et=function(cn){gt.event=cn,_t(gt)},_r=function(cn){gt.event=cn,xt(gt)},Gs=function(cn){return Po(cn)||_getEvent(cn,ue)&&rt(gt)};Cn=gt._dc=gsap$1.delayedCall(de||.25,lr).pause(),gt.deltaX=gt.deltaY=0,gt._vx=_getVelocityProp(0,50,!0),gt._vy=_getVelocityProp(0,50,!0),gt.scrollX=Rr,gt.scrollY=Xi,gt.isDragging=gt.isGesturing=gt.isPressed=!1,_context$1(this),gt.enable=function(ri){return gt.isEnabled||(_addListener$1(Vr?Di:G,"scroll",_onScroll$1),F.indexOf("scroll")>=0&&_addListener$1(Vr?Di:G,"scroll",no,ue,be),F.indexOf("wheel")>=0&&_addListener$1(G,"wheel",Vs,ue,be),(F.indexOf("touch")>=0&&_isTouch||F.indexOf("pointer")>=0)&&(_addListener$1(G,_eventTypes[0],Sn,ue,be),_addListener$1(Di,_eventTypes[2],Ui),_addListener$1(Di,_eventTypes[3],Ui),Xe&&_addListener$1(G,"click",Ki,!1,!0),rt&&_addListener$1(G,"click",Gs),Pt&&_addListener$1(Di,"gesturestart",qr),Ie&&_addListener$1(Di,"gestureend",Sr),_t&&_addListener$1(G,_pointerType+"enter",et),xt&&_addListener$1(G,_pointerType+"leave",_r),ct&&_addListener$1(G,_pointerType+"move",_o)),gt.isEnabled=!0,ri&&ri.type&&Sn(ri),ft&&ft(gt)),gt},gt.disable=function(){gt.isEnabled&&(_observers.filter(function(ri){return ri!==gt&&_isViewport$1(ri.target)}).length||_removeListener$1(Vr?Di:G,"scroll",_onScroll$1),gt.isPressed&&(gt._vx.reset(),gt._vy.reset(),_removeListener$1(At?G:Di,_eventTypes[1],Do,!0)),_removeListener$1(Vr?Di:G,"scroll",no,be),_removeListener$1(G,"wheel",Vs,be),_removeListener$1(G,_eventTypes[0],Sn,be),_removeListener$1(Di,_eventTypes[2],Ui),_removeListener$1(Di,_eventTypes[3],Ui),_removeListener$1(G,"click",Ki,!0),_removeListener$1(G,"click",Gs),_removeListener$1(Di,"gesturestart",qr),_removeListener$1(Di,"gestureend",Sr),_removeListener$1(G,_pointerType+"enter",et),_removeListener$1(G,_pointerType+"leave",_r),_removeListener$1(G,_pointerType+"move",_o),gt.isEnabled=gt.isPressed=gt.isDragging=!1,jt&&jt(gt))},gt.kill=gt.revert=function(){gt.disable();var ri=_observers.indexOf(gt);ri>=0&&_observers.splice(ri,1),_normalizer$1===gt&&(_normalizer$1=0)},_observers.push(gt),At&&_isViewport$1(G)&&(_normalizer$1=gt),gt.enable($)},_createClass(K,[{key:"velocityX",get:function(){return this._vx.getVelocity()}},{key:"velocityY",get:function(){return this._vy.getVelocity()}}]),K}();Observer.version="3.11.4";Observer.create=function(K){return new Observer(K)};Observer.register=_initCore;Observer.getAll=function(){return _observers.slice()};Observer.getById=function(K){return _observers.filter(function(A){return A.vars.id===K})[0]};_getGSAP$1()&&gsap$1.registerPlugin(Observer);/*!
 * ScrollTrigger 3.11.4
 * https://greensock.com
 *
 * @license Copyright 2008-2022, GreenSock. All rights reserved.
 * Subject to the terms at https://greensock.com/standard-license or for
 * Club GreenSock members, the agreement issued with that membership.
 * @author: Jack Doyle, jack@greensock.com
*/var gsap,_coreInitted,_win,_doc,_docEl,_body,_root,_resizeDelay,_toArray,_clamp,_time2,_syncInterval,_refreshing,_pointerIsDown,_transformProp,_i,_prevWidth,_prevHeight,_autoRefresh,_sort,_suppressOverwrites,_ignoreResize,_normalizer,_ignoreMobileResize,_baseScreenHeight,_baseScreenWidth,_fixIOSBug,_context,_scrollRestoration,_limitCallbacks,_startup=1,_getTime=Date.now,_time1=_getTime(),_lastScrollTime=0,_enabled=0,_pointerDownHandler=function(){return _pointerIsDown=1},_pointerUpHandler=function(){return _pointerIsDown=0},_passThrough=function(A){return A},_round=function(A){return Math.round(A*1e5)/1e5||0},_windowExists=function(){return typeof window<"u"},_getGSAP=function(){return gsap||_windowExists()&&(gsap=window.gsap)&&gsap.registerPlugin&&gsap},_isViewport=function(A){return!!~_root.indexOf(A)},_getBoundsFunc=function(A){return _getProxyProp(A,"getBoundingClientRect")||(_isViewport(A)?function(){return _winOffsets.width=_win.innerWidth,_winOffsets.height=_win.innerHeight,_winOffsets}:function(){return _getBounds(A)})},_getSizeFunc=function(A,w,c){var C=c.d,O=c.d2,F=c.a;return(F=_getProxyProp(A,"getBoundingClientRect"))?function(){return F()[C]}:function(){return(w?_win["inner"+O]:A["client"+O])||0}},_getOffsetsFunc=function(A,w){return!w||~_proxies.indexOf(A)?_getBoundsFunc(A):function(){return _winOffsets}},_maxScroll=function(A,w){var c=w.s,C=w.d2,O=w.d,F=w.a;return(c="scroll"+C)&&(F=_getProxyProp(A,c))?F()-_getBoundsFunc(A)()[O]:_isViewport(A)?(_docEl[c]||_body[c])-(_win["inner"+C]||_docEl["client"+C]||_body["client"+C]):A[c]-A["offset"+C]},_iterateAutoRefresh=function(A,w){for(var c=0;c<_autoRefresh.length;c+=3)(!w||~w.indexOf(_autoRefresh[c+1]))&&A(_autoRefresh[c],_autoRefresh[c+1],_autoRefresh[c+2])},_isString=function(A){return typeof A=="string"},_isFunction=function(A){return typeof A=="function"},_isNumber=function(A){return typeof A=="number"},_isObject=function(A){return typeof A=="object"},_endAnimation=function(A,w,c){return A&&A.progress(w?0:1)&&c&&A.pause()},_callback=function(A,w){if(A.enabled){var c=w(A);c&&c.totalTime&&(A.callbackAnimation=c)}},_abs=Math.abs,_left="left",_top="top",_right="right",_bottom="bottom",_width="width",_height="height",_Right="Right",_Left="Left",_Top="Top",_Bottom="Bottom",_padding="padding",_margin="margin",_Width="Width",_Height="Height",_px="px",_getComputedStyle=function(A){return _win.getComputedStyle(A)},_makePositionable=function(A){var w=_getComputedStyle(A).position;A.style.position=w==="absolute"||w==="fixed"?w:"relative"},_setDefaults=function(A,w){for(var c in w)c in A||(A[c]=w[c]);return A},_getBounds=function(A,w){var c=w&&_getComputedStyle(A)[_transformProp]!=="matrix(1, 0, 0, 1, 0, 0)"&&gsap.to(A,{x:0,y:0,xPercent:0,yPercent:0,rotation:0,rotationX:0,rotationY:0,scale:1,skewX:0,skewY:0}).progress(1),C=A.getBoundingClientRect();return c&&c.progress(0).kill(),C},_getSize=function(A,w){var c=w.d2;return A["offset"+c]||A["client"+c]||0},_getLabelRatioArray=function(A){var w=[],c=A.labels,C=A.duration(),O;for(O in c)w.push(c[O]/C);return w},_getClosestLabel=function(A){return function(w){return gsap.utils.snap(_getLabelRatioArray(A),w)}},_snapDirectional=function(A){var w=gsap.utils.snap(A),c=Array.isArray(A)&&A.slice(0).sort(function(C,O){return C-O});return c?function(C,O,F){F===void 0&&(F=.001);var G;if(!O)return w(C);if(O>0){for(C-=F,G=0;G<c.length;G++)if(c[G]>=C)return c[G];return c[G-1]}else for(G=c.length,C+=F;G--;)if(c[G]<=C)return c[G];return c[0]}:function(C,O,F){F===void 0&&(F=.001);var G=w(C);return!O||Math.abs(G-C)<F||G-C<0==O<0?G:w(O<0?C-A:C+A)}},_getLabelAtDirection=function(A){return function(w,c){return _snapDirectional(_getLabelRatioArray(A))(w,c.direction)}},_multiListener=function(A,w,c,C){return c.split(",").forEach(function(O){return A(w,O,C)})},_addListener=function(A,w,c,C,O){return A.addEventListener(w,c,{passive:!C,capture:!!O})},_removeListener=function(A,w,c,C){return A.removeEventListener(w,c,!!C)},_wheelListener=function(A,w,c){return c&&c.wheelHandler&&A(w,"wheel",c)},_markerDefaults={startColor:"green",endColor:"red",indent:0,fontSize:"16px",fontWeight:"normal"},_defaults={toggleActions:"play",anticipatePin:0},_keywords={top:0,left:0,center:.5,bottom:1,right:1},_offsetToPx=function(A,w){if(_isString(A)){var c=A.indexOf("="),C=~c?+(A.charAt(c-1)+1)*parseFloat(A.substr(c+1)):0;~c&&(A.indexOf("%")>c&&(C*=w/100),A=A.substr(0,c-1)),A=C+(A in _keywords?_keywords[A]*w:~A.indexOf("%")?parseFloat(A)*w/100:parseFloat(A)||0)}return A},_createMarker=function(A,w,c,C,O,F,G,X){var te=O.startColor,ue=O.endColor,fe=O.fontSize,de=O.indent,le=O.fontWeight,me=_doc.createElement("div"),$=_isViewport(c)||_getProxyProp(c,"pinType")==="fixed",_e=A.indexOf("scroller")!==-1,oe=$?_body:c,ge=A.indexOf("start")!==-1,Se=ge?te:ue,je="border-color:"+Se+";font-size:"+fe+";color:"+Se+";font-weight:"+le+";pointer-events:none;white-space:nowrap;font-family:sans-serif,Arial;z-index:1000;padding:4px 8px;border-width:0;border-style:solid;";return je+="position:"+((_e||X)&&$?"fixed;":"absolute;"),(_e||X||!$)&&(je+=(C===_vertical?_right:_bottom)+":"+(F+parseFloat(de))+"px;"),G&&(je+="box-sizing:border-box;text-align:left;width:"+G.offsetWidth+"px;"),me._isStart=ge,me.setAttribute("class","gsap-marker-"+A+(w?" marker-"+w:"")),me.style.cssText=je,me.innerText=w||w===0?A+"-"+w:A,oe.children[0]?oe.insertBefore(me,oe.children[0]):oe.appendChild(me),me._offset=me["offset"+C.op.d2],_positionMarker(me,0,C,ge),me},_positionMarker=function(A,w,c,C){var O={display:"block"},F=c[C?"os2":"p2"],G=c[C?"p2":"os2"];A._isFlipped=C,O[c.a+"Percent"]=C?-100:0,O[c.a]=C?"1px":0,O["border"+F+_Width]=1,O["border"+G+_Width]=0,O[c.p]=w+"px",gsap.set(A,O)},_triggers=[],_ids={},_rafID,_sync=function(){return _getTime()-_lastScrollTime>34&&(_rafID||(_rafID=requestAnimationFrame(_updateAll)))},_onScroll=function(){(!_normalizer||!_normalizer.isPressed||_normalizer.startX>_body.clientWidth)&&(_scrollers.cache++,_normalizer?_rafID||(_rafID=requestAnimationFrame(_updateAll)):_updateAll(),_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime())},_setBaseDimensions=function(){_baseScreenWidth=_win.innerWidth,_baseScreenHeight=_win.innerHeight},_onResize=function(){_scrollers.cache++,!_refreshing&&!_ignoreResize&&!_doc.fullscreenElement&&!_doc.webkitFullscreenElement&&(!_ignoreMobileResize||_baseScreenWidth!==_win.innerWidth||Math.abs(_win.innerHeight-_baseScreenHeight)>_win.innerHeight*.25)&&_resizeDelay.restart(!0)},_listeners={},_emptyArray=[],_softRefresh=function K(){return _removeListener(ScrollTrigger,"scrollEnd",K)||_refreshAll(!0)},_dispatch=function(A){return _listeners[A]&&_listeners[A].map(function(w){return w()})||_emptyArray},_savedStyles=[],_revertRecorded=function(A){for(var w=0;w<_savedStyles.length;w+=5)(!A||_savedStyles[w+4]&&_savedStyles[w+4].query===A)&&(_savedStyles[w].style.cssText=_savedStyles[w+1],_savedStyles[w].getBBox&&_savedStyles[w].setAttribute("transform",_savedStyles[w+2]||""),_savedStyles[w+3].uncache=1)},_revertAll=function(A,w){var c;for(_i=0;_i<_triggers.length;_i++)c=_triggers[_i],c&&(!w||c._ctx===w)&&(A?c.kill(1):c.revert(!0,!0));w&&_revertRecorded(w),w||_dispatch("revert")},_clearScrollMemory=function(A,w){_scrollers.cache++,(w||!_refreshingAll)&&_scrollers.forEach(function(c){return _isFunction(c)&&c.cacheID++&&(c.rec=0)}),_isString(A)&&(_win.history.scrollRestoration=_scrollRestoration=A)},_refreshingAll,_refreshID=0,_queueRefreshID,_queueRefreshAll=function(){if(_queueRefreshID!==_refreshID){var A=_queueRefreshID=_refreshID;requestAnimationFrame(function(){return A===_refreshID&&_refreshAll(!0)})}},_refreshAll=function(A,w){if(_lastScrollTime&&!A){_addListener(ScrollTrigger,"scrollEnd",_softRefresh);return}_refreshingAll=ScrollTrigger.isRefreshing=!0,_scrollers.forEach(function(C){return _isFunction(C)&&C.cacheID++&&(C.rec=C())});var c=_dispatch("refreshInit");_sort&&ScrollTrigger.sort(),w||_revertAll(),_scrollers.forEach(function(C){_isFunction(C)&&(C.smooth&&(C.target.style.scrollBehavior="auto"),C(0))}),_triggers.slice(0).forEach(function(C){return C.refresh()}),_triggers.forEach(function(C,O){if(C._subPinOffset&&C.pin){var F=C.vars.horizontal?"offsetWidth":"offsetHeight",G=C.pin[F];C.revert(!0,1),C.adjustPinSpacing(C.pin[F]-G),C.revert(!1,1)}}),_triggers.forEach(function(C){return C.vars.end==="max"&&C.setPositions(C.start,Math.max(C.start+1,_maxScroll(C.scroller,C._dir)))}),c.forEach(function(C){return C&&C.render&&C.render(-1)}),_scrollers.forEach(function(C){_isFunction(C)&&(C.smooth&&requestAnimationFrame(function(){return C.target.style.scrollBehavior="smooth"}),C.rec&&C(C.rec))}),_clearScrollMemory(_scrollRestoration,1),_resizeDelay.pause(),_refreshID++,_updateAll(2),_triggers.forEach(function(C){return _isFunction(C.vars.onRefresh)&&C.vars.onRefresh(C)}),_refreshingAll=ScrollTrigger.isRefreshing=!1,_dispatch("refresh")},_lastScroll=0,_direction=1,_primary,_updateAll=function(A){if(!_refreshingAll||A===2){ScrollTrigger.isUpdating=!0,_primary&&_primary.update(0);var w=_triggers.length,c=_getTime(),C=c-_time1>=50,O=w&&_triggers[0].scroll();if(_direction=_lastScroll>O?-1:1,_lastScroll=O,C&&(_lastScrollTime&&!_pointerIsDown&&c-_lastScrollTime>200&&(_lastScrollTime=0,_dispatch("scrollEnd")),_time2=_time1,_time1=c),_direction<0){for(_i=w;_i-- >0;)_triggers[_i]&&_triggers[_i].update(0,C);_direction=1}else for(_i=0;_i<w;_i++)_triggers[_i]&&_triggers[_i].update(0,C);ScrollTrigger.isUpdating=!1}_rafID=0},_propNamesToCopy=[_left,_top,_bottom,_right,_margin+_Bottom,_margin+_Right,_margin+_Top,_margin+_Left,"display","flexShrink","float","zIndex","gridColumnStart","gridColumnEnd","gridRowStart","gridRowEnd","gridArea","justifySelf","alignSelf","placeSelf","order"],_stateProps=_propNamesToCopy.concat([_width,_height,"boxSizing","max"+_Width,"max"+_Height,"position",_margin,_padding,_padding+_Top,_padding+_Right,_padding+_Bottom,_padding+_Left]),_swapPinOut=function(A,w,c){_setState(c);var C=A._gsap;if(C.spacerIsNative)_setState(C.spacerState);else if(A._gsap.swappedIn){var O=w.parentNode;O&&(O.insertBefore(A,w),O.removeChild(w))}A._gsap.swappedIn=!1},_swapPinIn=function(A,w,c,C){if(!A._gsap.swappedIn){for(var O=_propNamesToCopy.length,F=w.style,G=A.style,X;O--;)X=_propNamesToCopy[O],F[X]=c[X];F.position=c.position==="absolute"?"absolute":"relative",c.display==="inline"&&(F.display="inline-block"),G[_bottom]=G[_right]="auto",F.flexBasis=c.flexBasis||"auto",F.overflow="visible",F.boxSizing="border-box",F[_width]=_getSize(A,_horizontal)+_px,F[_height]=_getSize(A,_vertical)+_px,F[_padding]=G[_margin]=G[_top]=G[_left]="0",_setState(C),G[_width]=G["max"+_Width]=c[_width],G[_height]=G["max"+_Height]=c[_height],G[_padding]=c[_padding],A.parentNode!==w&&(A.parentNode.insertBefore(w,A),w.appendChild(A)),A._gsap.swappedIn=!0}},_capsExp=/([A-Z])/g,_setState=function(A){if(A){var w=A.t.style,c=A.length,C=0,O,F;for((A.t._gsap||gsap.core.getCache(A.t)).uncache=1;C<c;C+=2)F=A[C+1],O=A[C],F?w[O]=F:w[O]&&w.removeProperty(O.replace(_capsExp,"-$1").toLowerCase())}},_getState=function(A){for(var w=_stateProps.length,c=A.style,C=[],O=0;O<w;O++)C.push(_stateProps[O],c[_stateProps[O]]);return C.t=A,C},_copyState=function(A,w,c){for(var C=[],O=A.length,F=c?8:0,G;F<O;F+=2)G=A[F],C.push(G,G in w?w[G]:A[F+1]);return C.t=A.t,C},_winOffsets={left:0,top:0},_parsePosition=function(A,w,c,C,O,F,G,X,te,ue,fe,de,le){_isFunction(A)&&(A=A(X)),_isString(A)&&A.substr(0,3)==="max"&&(A=de+(A.charAt(4)==="="?_offsetToPx("0"+A.substr(3),c):0));var me=le?le.time():0,$,_e,oe;if(le&&le.seek(0),_isNumber(A))G&&_positionMarker(G,c,C,!0);else{_isFunction(w)&&(w=w(X));var ge=(A||"0").split(" "),Se,je,ye,Ne;oe=_getTarget(w)||_body,Se=_getBounds(oe)||{},(!Se||!Se.left&&!Se.top)&&_getComputedStyle(oe).display==="none"&&(Ne=oe.style.display,oe.style.display="block",Se=_getBounds(oe),Ne?oe.style.display=Ne:oe.style.removeProperty("display")),je=_offsetToPx(ge[0],Se[C.d]),ye=_offsetToPx(ge[1]||"0",c),A=Se[C.p]-te[C.p]-ue+je+O-ye,G&&_positionMarker(G,ye,C,c-ye<20||G._isStart&&ye>20),c-=c-ye}if(F){var Z=A+c,se=F._isStart;$="scroll"+C.d2,_positionMarker(F,Z,C,se&&Z>20||!se&&(fe?Math.max(_body[$],_docEl[$]):F.parentNode[$])<=Z+1),fe&&(te=_getBounds(G),fe&&(F.style[C.op.p]=te[C.op.p]-C.op.m-F._offset+_px))}return le&&oe&&($=_getBounds(oe),le.seek(de),_e=_getBounds(oe),le._caScrollDist=$[C.p]-_e[C.p],A=A/le._caScrollDist*de),le&&le.seek(me),le?A:Math.round(A)},_prefixExp=/(webkit|moz|length|cssText|inset)/i,_reparent=function(A,w,c,C){if(A.parentNode!==w){var O=A.style,F,G;if(w===_body){A._stOrig=O.cssText,G=_getComputedStyle(A);for(F in G)!+F&&!_prefixExp.test(F)&&G[F]&&typeof O[F]=="string"&&F!=="0"&&(O[F]=G[F]);O.top=c,O.left=C}else O.cssText=A._stOrig;gsap.core.getCache(A).uncache=1,w.appendChild(A)}},_getTweenCreator=function(A,w){var c=_getScrollFunc(A,w),C="_scroll"+w.p2,O,F,G=function X(te,ue,fe,de,le){var me=X.tween,$=ue.onComplete,_e={};return fe=fe||c(),le=de&&le||0,de=de||te-fe,me&&me.kill(),O=Math.round(fe),ue[C]=te,ue.modifiers=_e,_e[C]=function(oe){return oe=Math.round(c()),oe!==O&&oe!==F&&Math.abs(oe-O)>3&&Math.abs(oe-F)>3?(me.kill(),X.tween=0):oe=fe+de*me.ratio+le*me.ratio*me.ratio,F=O,O=Math.round(oe)},ue.onUpdate=function(){_scrollers.cache++,_updateAll()},ue.onComplete=function(){X.tween=0,$&&$.call(me)},me=X.tween=gsap.to(A,ue),me};return A[C]=c,c.wheelHandler=function(){return G.tween&&G.tween.kill()&&(G.tween=0)},_addListener(A,"wheel",c.wheelHandler),G},ScrollTrigger=function(){function K(w,c){_coreInitted||K.register(gsap)||console.warn("Please gsap.registerPlugin(ScrollTrigger)"),this.init(w,c)}var A=K.prototype;return A.init=function(c,C){if(this.progress=this.start=0,this.vars&&this.kill(!0,!0),!_enabled){this.update=this.refresh=this.kill=_passThrough;return}c=_setDefaults(_isString(c)||_isNumber(c)||c.nodeType?{trigger:c}:c,_defaults);var O=c,F=O.onUpdate,G=O.toggleClass,X=O.id,te=O.onToggle,ue=O.onRefresh,fe=O.scrub,de=O.trigger,le=O.pin,me=O.pinSpacing,$=O.invalidateOnRefresh,_e=O.anticipatePin,oe=O.onScrubComplete,ge=O.onSnapComplete,Se=O.once,je=O.snap,ye=O.pinReparent,Ne=O.pinSpacer,Z=O.containerAnimation,se=O.fastScrollEnd,ae=O.preventOverlaps,Be=c.horizontal||c.containerAnimation&&c.horizontal!==!1?_horizontal:_vertical,we=!fe&&fe!==0,tt=_getTarget(c.scroller||_win),St=gsap.core.getCache(tt),_t=_isViewport(tt),xt=("pinType"in c?c.pinType:_getProxyProp(tt,"pinType")||_t&&"fixed")==="fixed",ct=[c.onEnter,c.onLeave,c.onEnterBack,c.onLeaveBack],Ot=we&&c.toggleActions.split(" "),At="markers"in c?c.markers:_defaults.markers,Pt=_t?0:parseFloat(_getComputedStyle(tt)["border"+Be.p2+_Width])||0,Ie=this,vt=c.onRefreshInit&&function(){return c.onRefreshInit(Ie)},ft=_getSizeFunc(tt,_t,Be),jt=_getOffsetsFunc(tt,_t),rt=0,pe=0,be=_getScrollFunc(tt,Be),Xe,zt,Wt,qt,Cn,vn,Zn,Xn,Pi,qn,gt,mi,Ei,Rr,Xi,zi,Vi,Gi,Vr,Di,gi,br,ar,Ki,Po,lr,cs,nr,Es,Do,Sn,Ui,qr,Sr,no,Vs,_o,et,_r;if(_context(Ie),Ie._dir=Be,_e*=45,Ie.scroller=tt,Ie.scroll=Z?Z.time.bind(Z):be,qt=be(),Ie.vars=c,C=C||c.animation,"refreshPriority"in c&&(_sort=1,c.refreshPriority===-9999&&(_primary=Ie)),St.tweenScroll=St.tweenScroll||{top:_getTweenCreator(tt,_vertical),left:_getTweenCreator(tt,_horizontal)},Ie.tweenTo=Xe=St.tweenScroll[Be.p],Ie.scrubDuration=function(kt){Ui=_isNumber(kt)&&kt,Ui?Sn?Sn.duration(kt):Sn=gsap.to(C,{ease:"expo",totalProgress:"+=0.001",duration:Ui,paused:!0,onComplete:function(){return oe&&oe(Ie)}}):(Sn&&Sn.progress(1).kill(),Sn=0)},C&&(C.vars.lazy=!1,C._initted||C.vars.immediateRender!==!1&&c.immediateRender!==!1&&C.duration()&&C.render(0,!0,!0),Ie.animation=C.pause(),C.scrollTrigger=Ie,Ie.scrubDuration(fe),Es=0,X||(X=C.vars.id)),_triggers.push(Ie),je&&((!_isObject(je)||je.push)&&(je={snapTo:je}),"scrollBehavior"in _body.style&&gsap.set(_t?[_body,_docEl]:tt,{scrollBehavior:"auto"}),_scrollers.forEach(function(kt){return _isFunction(kt)&&kt.target===(_t?_doc.scrollingElement||_docEl:tt)&&(kt.smooth=!1)}),Wt=_isFunction(je.snapTo)?je.snapTo:je.snapTo==="labels"?_getClosestLabel(C):je.snapTo==="labelsDirectional"?_getLabelAtDirection(C):je.directional!==!1?function(kt,Gn){return _snapDirectional(je.snapTo)(kt,_getTime()-pe<500?0:Gn.direction)}:gsap.utils.snap(je.snapTo),qr=je.duration||{min:.1,max:2},qr=_isObject(qr)?_clamp(qr.min,qr.max):_clamp(qr,qr),Sr=gsap.delayedCall(je.delay||Ui/2||.1,function(){var kt=be(),Gn=_getTime()-pe<500,Qn=Xe.tween;if((Gn||Math.abs(Ie.getVelocity())<10)&&!Qn&&!_pointerIsDown&&rt!==kt){var Nn=(kt-vn)/Ei,ir=C&&!we?C.totalProgress():Nn,di=Gn?0:(ir-Do)/(_getTime()-_time2)*1e3||0,Hi=gsap.utils.clamp(-Nn,1-Nn,_abs(di/2)*di/.185),rr=Nn+(je.inertia===!1?0:Hi),Qs=_clamp(0,1,Wt(rr,Ie)),vi=Math.round(vn+Qs*Ei),Gr=je,vo=Gr.onStart,sr=Gr.onInterrupt,Bi=Gr.onComplete;if(kt<=Zn&&kt>=vn&&vi!==kt){if(Qn&&!Qn._initted&&Qn.data<=_abs(vi-kt))return;je.inertia===!1&&(Hi=Qs-Nn),Xe(vi,{duration:qr(_abs(Math.max(_abs(rr-ir),_abs(Qs-ir))*.185/di/.05||0)),ease:je.ease||"power3",data:_abs(vi-kt),onInterrupt:function(){return Sr.restart(!0)&&sr&&sr(Ie)},onComplete:function(){Ie.update(),rt=be(),Es=Do=C&&!we?C.totalProgress():Ie.progress,ge&&ge(Ie),Bi&&Bi(Ie)}},kt,Hi*Ei,vi-kt-Hi*Ei),vo&&vo(Ie,Xe.tween)}}else Ie.isActive&&rt!==kt&&Sr.restart(!0)}).pause()),X&&(_ids[X]=Ie),de=Ie.trigger=_getTarget(de||le),_r=de&&de._gsap&&de._gsap.stRevert,_r&&(_r=_r(Ie)),le=le===!0?de:_getTarget(le),_isString(G)&&(G={targets:de,className:G}),le&&(me===!1||me===_margin||(me=!me&&le.parentNode&&le.parentNode.style&&_getComputedStyle(le.parentNode).display==="flex"?!1:_padding),Ie.pin=le,zt=gsap.core.getCache(le),zt.spacer?Rr=zt.pinState:(Ne&&(Ne=_getTarget(Ne),Ne&&!Ne.nodeType&&(Ne=Ne.current||Ne.nativeElement),zt.spacerIsNative=!!Ne,Ne&&(zt.spacerState=_getState(Ne))),zt.spacer=Vi=Ne||_doc.createElement("div"),Vi.classList.add("pin-spacer"),X&&Vi.classList.add("pin-spacer-"+X),zt.pinState=Rr=_getState(le)),c.force3D!==!1&&gsap.set(le,{force3D:!0}),Ie.spacer=Vi=zt.spacer,nr=_getComputedStyle(le),ar=nr[me+Be.os2],Vr=gsap.getProperty(le),Di=gsap.quickSetter(le,Be.a,_px),_swapPinIn(le,Vi,nr),zi=_getState(le)),At){mi=_isObject(At)?_setDefaults(At,_markerDefaults):_markerDefaults,qn=_createMarker("scroller-start",X,tt,Be,mi,0),gt=_createMarker("scroller-end",X,tt,Be,mi,0,qn),Gi=qn["offset"+Be.op.d2];var Gs=_getTarget(_getProxyProp(tt,"content")||tt);Xn=this.markerStart=_createMarker("start",X,Gs,Be,mi,Gi,0,Z),Pi=this.markerEnd=_createMarker("end",X,Gs,Be,mi,Gi,0,Z),Z&&(et=gsap.quickSetter([Xn,Pi],Be.a,_px)),!xt&&!(_proxies.length&&_getProxyProp(tt,"fixedMarkers")===!0)&&(_makePositionable(_t?_body:tt),gsap.set([qn,gt],{force3D:!0}),Po=gsap.quickSetter(qn,Be.a,_px),cs=gsap.quickSetter(gt,Be.a,_px))}if(Z){var ri=Z.vars.onUpdate,cn=Z.vars.onUpdateParams;Z.eventCallback("onUpdate",function(){Ie.update(0,0,1),ri&&ri.apply(cn||[])})}Ie.previous=function(){return _triggers[_triggers.indexOf(Ie)-1]},Ie.next=function(){return _triggers[_triggers.indexOf(Ie)+1]},Ie.revert=function(kt,Gn){if(!Gn)return Ie.kill(!0);var Qn=kt!==!1||!Ie.enabled,Nn=_refreshing;Qn!==Ie.isReverted&&(Qn&&(Vs=Math.max(be(),Ie.scroll.rec||0),no=Ie.progress,_o=C&&C.progress()),Xn&&[Xn,Pi,qn,gt].forEach(function(ir){return ir.style.display=Qn?"none":"block"}),Qn&&(_refreshing=1,Ie.update(Qn)),le&&(!ye||!Ie.isActive)&&(Qn?_swapPinOut(le,Vi,Rr):_swapPinIn(le,Vi,_getComputedStyle(le),Ki)),Qn||Ie.update(Qn),_refreshing=Nn,Ie.isReverted=Qn)},Ie.refresh=function(kt,Gn){if(!((_refreshing||!Ie.enabled)&&!Gn)){if(le&&kt&&_lastScrollTime){_addListener(K,"scrollEnd",_softRefresh);return}!_refreshingAll&&vt&&vt(Ie),_refreshing=1,pe=_getTime(),Xe.tween&&(Xe.tween.kill(),Xe.tween=0),Sn&&Sn.pause(),$&&C&&C.revert({kill:!1}).invalidate(),Ie.isReverted||Ie.revert(!0,!0),Ie._subPinOffset=!1;for(var Qn=ft(),Nn=jt(),ir=Z?Z.duration():_maxScroll(tt,Be),di=0,Hi=0,rr=c.end,Qs=c.endTrigger||de,vi=c.start||(c.start===0||!de?0:le?"0 0":"0 100%"),Gr=Ie.pinnedContainer=c.pinnedContainer&&_getTarget(c.pinnedContainer),vo=de&&Math.max(0,_triggers.indexOf(Ie))||0,sr=vo,Bi,pr,Ri,us,ki,fr,wr,_n,ja,wn,Yr;sr--;)fr=_triggers[sr],fr.end||fr.refresh(0,1)||(_refreshing=1),wr=fr.pin,wr&&(wr===de||wr===le)&&!fr.isReverted&&(wn||(wn=[]),wn.unshift(fr),fr.revert(!0,!0)),fr!==_triggers[sr]&&(vo--,sr--);for(_isFunction(vi)&&(vi=vi(Ie)),vn=_parsePosition(vi,de,Qn,Be,be(),Xn,qn,Ie,Nn,Pt,xt,ir,Z)||(le?-.001:0),_isFunction(rr)&&(rr=rr(Ie)),_isString(rr)&&!rr.indexOf("+=")&&(~rr.indexOf(" ")?rr=(_isString(vi)?vi.split(" ")[0]:"")+rr:(di=_offsetToPx(rr.substr(2),Qn),rr=_isString(vi)?vi:vn+di,Qs=de)),Zn=Math.max(vn,_parsePosition(rr||(Qs?"100% 0":ir),Qs,Qn,Be,be()+di,Pi,gt,Ie,Nn,Pt,xt,ir,Z))||-.001,Ei=Zn-vn||(vn-=.01)&&.001,di=0,sr=vo;sr--;)fr=_triggers[sr],wr=fr.pin,wr&&fr.start-fr._pinPush<=vn&&!Z&&fr.end>0&&(Bi=fr.end-fr.start,(wr===de&&fr.start-fr._pinPush<vn||wr===Gr)&&!_isNumber(vi)&&(di+=Bi*(1-fr.progress)),wr===le&&(Hi+=Bi));if(vn+=di,Zn+=di,Ie._pinPush=Hi,Xn&&di&&(Bi={},Bi[Be.a]="+="+di,Gr&&(Bi[Be.p]="-="+be()),gsap.set([Xn,Pi],Bi)),le)Bi=_getComputedStyle(le),us=Be===_vertical,Ri=be(),gi=parseFloat(Vr(Be.a))+Hi,!ir&&Zn>1&&(Yr=(_t?_doc.scrollingElement||_docEl:tt).style,Yr={style:Yr,value:Yr["overflow"+Be.a.toUpperCase()]},Yr["overflow"+Be.a.toUpperCase()]="scroll"),_swapPinIn(le,Vi,Bi),zi=_getState(le),pr=_getBounds(le,!0),_n=xt&&_getScrollFunc(tt,us?_horizontal:_vertical)(),me&&(Ki=[me+Be.os2,Ei+Hi+_px],Ki.t=Vi,sr=me===_padding?_getSize(le,Be)+Ei+Hi:0,sr&&Ki.push(Be.d,sr+_px),_setState(Ki),Gr&&_triggers.forEach(function(Ao){Ao.pin===Gr&&Ao.vars.pinSpacing!==!1&&(Ao._subPinOffset=!0)}),xt&&be(Vs)),xt&&(ki={top:pr.top+(us?Ri-vn:_n)+_px,left:pr.left+(us?_n:Ri-vn)+_px,boxSizing:"border-box",position:"fixed"},ki[_width]=ki["max"+_Width]=Math.ceil(pr.width)+_px,ki[_height]=ki["max"+_Height]=Math.ceil(pr.height)+_px,ki[_margin]=ki[_margin+_Top]=ki[_margin+_Right]=ki[_margin+_Bottom]=ki[_margin+_Left]="0",ki[_padding]=Bi[_padding],ki[_padding+_Top]=Bi[_padding+_Top],ki[_padding+_Right]=Bi[_padding+_Right],ki[_padding+_Bottom]=Bi[_padding+_Bottom],ki[_padding+_Left]=Bi[_padding+_Left],Xi=_copyState(Rr,ki,ye),_refreshingAll&&be(0)),C?(ja=C._initted,_suppressOverwrites(1),C.render(C.duration(),!0,!0),br=Vr(Be.a)-gi+Ei+Hi,lr=Math.abs(Ei-br)>1,xt&&lr&&Xi.splice(Xi.length-2,2),C.render(0,!0,!0),ja||C.invalidate(!0),C.parent||C.totalTime(C.totalTime()),_suppressOverwrites(0)):br=Ei,Yr&&(Yr.value?Yr.style["overflow"+Be.a.toUpperCase()]=Yr.value:Yr.style.removeProperty("overflow-"+Be.a));else if(de&&be()&&!Z)for(pr=de.parentNode;pr&&pr!==_body;)pr._pinOffset&&(vn-=pr._pinOffset,Zn-=pr._pinOffset),pr=pr.parentNode;wn&&wn.forEach(function(Ao){return Ao.revert(!1,!0)}),Ie.start=vn,Ie.end=Zn,qt=Cn=_refreshingAll?Vs:be(),!Z&&!_refreshingAll&&(qt<Vs&&be(Vs),Ie.scroll.rec=0),Ie.revert(!1,!0),Sr&&(rt=-1,Ie.isActive&&be(vn+Ei*no),Sr.restart(!0)),_refreshing=0,C&&we&&(C._initted||_o)&&C.progress()!==_o&&C.progress(_o,!0).render(C.time(),!0,!0),(no!==Ie.progress||Z)&&(C&&!we&&C.totalProgress(no,!0),Ie.progress=(qt-vn)/Ei===no?0:no),le&&me&&(Vi._pinOffset=Math.round(Ie.progress*br)),ue&&!_refreshingAll&&ue(Ie)}},Ie.getVelocity=function(){return(be()-Cn)/(_getTime()-_time2)*1e3||0},Ie.endAnimation=function(){_endAnimation(Ie.callbackAnimation),C&&(Sn?Sn.progress(1):C.paused()?we||_endAnimation(C,Ie.direction<0,1):_endAnimation(C,C.reversed()))},Ie.labelToScroll=function(kt){return C&&C.labels&&(vn||Ie.refresh()||vn)+C.labels[kt]/C.duration()*Ei||0},Ie.getTrailing=function(kt){var Gn=_triggers.indexOf(Ie),Qn=Ie.direction>0?_triggers.slice(0,Gn).reverse():_triggers.slice(Gn+1);return(_isString(kt)?Qn.filter(function(Nn){return Nn.vars.preventOverlaps===kt}):Qn).filter(function(Nn){return Ie.direction>0?Nn.end<=vn:Nn.start>=Zn})},Ie.update=function(kt,Gn,Qn){if(!(Z&&!Qn&&!kt)){var Nn=_refreshingAll?Vs:Ie.scroll(),ir=kt?0:(Nn-vn)/Ei,di=ir<0?0:ir>1?1:ir||0,Hi=Ie.progress,rr,Qs,vi,Gr,vo,sr,Bi,pr;if(Gn&&(Cn=qt,qt=Z?be():Nn,je&&(Do=Es,Es=C&&!we?C.totalProgress():di)),_e&&!di&&le&&!_refreshing&&!_startup&&_lastScrollTime&&vn<Nn+(Nn-Cn)/(_getTime()-_time2)*_e&&(di=1e-4),di!==Hi&&Ie.enabled){if(rr=Ie.isActive=!!di&&di<1,Qs=!!Hi&&Hi<1,sr=rr!==Qs,vo=sr||!!di!=!!Hi,Ie.direction=di>Hi?1:-1,Ie.progress=di,vo&&!_refreshing&&(vi=di&&!Hi?0:di===1?1:Hi===1?2:3,we&&(Gr=!sr&&Ot[vi+1]!=="none"&&Ot[vi+1]||Ot[vi],pr=C&&(Gr==="complete"||Gr==="reset"||Gr in C))),ae&&(sr||pr)&&(pr||fe||!C)&&(_isFunction(ae)?ae(Ie):Ie.getTrailing(ae).forEach(function(fr){return fr.endAnimation()})),we||(Sn&&!_refreshing&&!_startup?(Sn._dp._time-Sn._start!==Sn._time&&Sn.render(Sn._dp._time-Sn._start),Sn.resetTo?Sn.resetTo("totalProgress",di,C._tTime/C._tDur):(Sn.vars.totalProgress=di,Sn.invalidate().restart())):C&&C.totalProgress(di,!!_refreshing)),le){if(kt&&me&&(Vi.style[me+Be.os2]=ar),!xt)Di(_round(gi+br*di));else if(vo){if(Bi=!kt&&di>Hi&&Zn+1>Nn&&Nn+1>=_maxScroll(tt,Be),ye)if(!kt&&(rr||Bi)){var Ri=_getBounds(le,!0),us=Nn-vn;_reparent(le,_body,Ri.top+(Be===_vertical?us:0)+_px,Ri.left+(Be===_vertical?0:us)+_px)}else _reparent(le,Vi);_setState(rr||Bi?Xi:zi),lr&&di<1&&rr||Di(gi+(di===1&&!Bi?br:0))}}je&&!Xe.tween&&!_refreshing&&!_startup&&Sr.restart(!0),G&&(sr||Se&&di&&(di<1||!_limitCallbacks))&&_toArray(G.targets).forEach(function(fr){return fr.classList[rr||Se?"add":"remove"](G.className)}),F&&!we&&!kt&&F(Ie),vo&&!_refreshing?(we&&(pr&&(Gr==="complete"?C.pause().totalProgress(1):Gr==="reset"?C.restart(!0).pause():Gr==="restart"?C.restart(!0):C[Gr]()),F&&F(Ie)),(sr||!_limitCallbacks)&&(te&&sr&&_callback(Ie,te),ct[vi]&&_callback(Ie,ct[vi]),Se&&(di===1?Ie.kill(!1,1):ct[vi]=0),sr||(vi=di===1?1:3,ct[vi]&&_callback(Ie,ct[vi]))),se&&!rr&&Math.abs(Ie.getVelocity())>(_isNumber(se)?se:2500)&&(_endAnimation(Ie.callbackAnimation),Sn?Sn.progress(1):_endAnimation(C,Gr==="reverse"?1:!di,1))):we&&F&&!_refreshing&&F(Ie)}if(cs){var ki=Z?Nn/Z.duration()*(Z._caScrollDist||0):Nn;Po(ki+(qn._isFlipped?1:0)),cs(ki)}et&&et(-Nn/Z.duration()*(Z._caScrollDist||0))}},Ie.enable=function(kt,Gn){Ie.enabled||(Ie.enabled=!0,_addListener(tt,"resize",_onResize),_addListener(_t?_doc:tt,"scroll",_onScroll),vt&&_addListener(K,"refreshInit",vt),kt!==!1&&(Ie.progress=no=0,qt=Cn=rt=be()),Gn!==!1&&Ie.refresh())},Ie.getTween=function(kt){return kt&&Xe?Xe.tween:Sn},Ie.setPositions=function(kt,Gn){le&&(gi+=kt-vn,br+=Gn-kt-Ei,me===_padding&&Ie.adjustPinSpacing(Gn-kt-Ei)),Ie.start=vn=kt,Ie.end=Zn=Gn,Ei=Gn-kt,Ie.update()},Ie.adjustPinSpacing=function(kt){if(Ki){var Gn=Ki.indexOf(Be.d)+1;Ki[Gn]=parseFloat(Ki[Gn])+kt+_px,Ki[1]=parseFloat(Ki[1])+kt+_px,_setState(Ki)}},Ie.disable=function(kt,Gn){if(Ie.enabled&&(kt!==!1&&Ie.revert(!0,!0),Ie.enabled=Ie.isActive=!1,Gn||Sn&&Sn.pause(),Vs=0,zt&&(zt.uncache=1),vt&&_removeListener(K,"refreshInit",vt),Sr&&(Sr.pause(),Xe.tween&&Xe.tween.kill()&&(Xe.tween=0)),!_t)){for(var Qn=_triggers.length;Qn--;)if(_triggers[Qn].scroller===tt&&_triggers[Qn]!==Ie)return;_removeListener(tt,"resize",_onResize),_removeListener(tt,"scroll",_onScroll)}},Ie.kill=function(kt,Gn){Ie.disable(kt,Gn),Sn&&!Gn&&Sn.kill(),X&&delete _ids[X];var Qn=_triggers.indexOf(Ie);Qn>=0&&_triggers.splice(Qn,1),Qn===_i&&_direction>0&&_i--,Qn=0,_triggers.forEach(function(Nn){return Nn.scroller===Ie.scroller&&(Qn=1)}),Qn||_refreshingAll||(Ie.scroll.rec=0),C&&(C.scrollTrigger=null,kt&&C.revert({kill:!1}),Gn||C.kill()),Xn&&[Xn,Pi,qn,gt].forEach(function(Nn){return Nn.parentNode&&Nn.parentNode.removeChild(Nn)}),_primary===Ie&&(_primary=0),le&&(zt&&(zt.uncache=1),Qn=0,_triggers.forEach(function(Nn){return Nn.pin===le&&Qn++}),Qn||(zt.spacer=0)),c.onKill&&c.onKill(Ie)},Ie.enable(!1,!1),_r&&_r(Ie),!C||!C.add||Ei?Ie.refresh():gsap.delayedCall(.01,function(){return vn||Zn||Ie.refresh()})&&(Ei=.01)&&(vn=Zn=0),le&&_queueRefreshAll()},K.register=function(c){return _coreInitted||(gsap=c||_getGSAP(),_windowExists()&&window.document&&K.enable(),_coreInitted=_enabled),_coreInitted},K.defaults=function(c){if(c)for(var C in c)_defaults[C]=c[C];return _defaults},K.disable=function(c,C){_enabled=0,_triggers.forEach(function(F){return F[C?"kill":"disable"](c)}),_removeListener(_win,"wheel",_onScroll),_removeListener(_doc,"scroll",_onScroll),clearInterval(_syncInterval),_removeListener(_doc,"touchcancel",_passThrough),_removeListener(_body,"touchstart",_passThrough),_multiListener(_removeListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_removeListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_resizeDelay.kill(),_iterateAutoRefresh(_removeListener);for(var O=0;O<_scrollers.length;O+=3)_wheelListener(_removeListener,_scrollers[O],_scrollers[O+1]),_wheelListener(_removeListener,_scrollers[O],_scrollers[O+2])},K.enable=function(){if(_win=window,_doc=document,_docEl=_doc.documentElement,_body=_doc.body,gsap&&(_toArray=gsap.utils.toArray,_clamp=gsap.utils.clamp,_context=gsap.core.context||_passThrough,_suppressOverwrites=gsap.core.suppressOverwrites||_passThrough,_scrollRestoration=_win.history.scrollRestoration||"auto",gsap.core.globals("ScrollTrigger",K),_body)){_enabled=1,Observer.register(gsap),K.isTouch=Observer.isTouch,_fixIOSBug=Observer.isTouch&&/(iPad|iPhone|iPod|Mac)/g.test(navigator.userAgent),_addListener(_win,"wheel",_onScroll),_root=[_win,_doc,_docEl,_body],gsap.matchMedia?(K.matchMedia=function(X){var te=gsap.matchMedia(),ue;for(ue in X)te.add(ue,X[ue]);return te},gsap.addEventListener("matchMediaInit",function(){return _revertAll()}),gsap.addEventListener("matchMediaRevert",function(){return _revertRecorded()}),gsap.addEventListener("matchMedia",function(){_refreshAll(0,1),_dispatch("matchMedia")}),gsap.matchMedia("(orientation: portrait)",function(){return _setBaseDimensions(),_setBaseDimensions})):console.warn("Requires GSAP 3.11.0 or later"),_setBaseDimensions(),_addListener(_doc,"scroll",_onScroll);var c=_body.style,C=c.borderTopStyle,O=gsap.core.Animation.prototype,F,G;for(O.revert||Object.defineProperty(O,"revert",{value:function(){return this.time(-.01,!0)}}),c.borderTopStyle="solid",F=_getBounds(_body),_vertical.m=Math.round(F.top+_vertical.sc())||0,_horizontal.m=Math.round(F.left+_horizontal.sc())||0,C?c.borderTopStyle=C:c.removeProperty("border-top-style"),_syncInterval=setInterval(_sync,250),gsap.delayedCall(.5,function(){return _startup=0}),_addListener(_doc,"touchcancel",_passThrough),_addListener(_body,"touchstart",_passThrough),_multiListener(_addListener,_doc,"pointerdown,touchstart,mousedown",_pointerDownHandler),_multiListener(_addListener,_doc,"pointerup,touchend,mouseup",_pointerUpHandler),_transformProp=gsap.utils.checkPrefix("transform"),_stateProps.push(_transformProp),_coreInitted=_getTime(),_resizeDelay=gsap.delayedCall(.2,_refreshAll).pause(),_autoRefresh=[_doc,"visibilitychange",function(){var X=_win.innerWidth,te=_win.innerHeight;_doc.hidden?(_prevWidth=X,_prevHeight=te):(_prevWidth!==X||_prevHeight!==te)&&_onResize()},_doc,"DOMContentLoaded",_refreshAll,_win,"load",_refreshAll,_win,"resize",_onResize],_iterateAutoRefresh(_addListener),_triggers.forEach(function(X){return X.enable(0,1)}),G=0;G<_scrollers.length;G+=3)_wheelListener(_removeListener,_scrollers[G],_scrollers[G+1]),_wheelListener(_removeListener,_scrollers[G],_scrollers[G+2])}},K.config=function(c){"limitCallbacks"in c&&(_limitCallbacks=!!c.limitCallbacks);var C=c.syncInterval;C&&clearInterval(_syncInterval)||(_syncInterval=C)&&setInterval(_sync,C),"ignoreMobileResize"in c&&(_ignoreMobileResize=K.isTouch===1&&c.ignoreMobileResize),"autoRefreshEvents"in c&&(_iterateAutoRefresh(_removeListener)||_iterateAutoRefresh(_addListener,c.autoRefreshEvents||"none"),_ignoreResize=(c.autoRefreshEvents+"").indexOf("resize")===-1)},K.scrollerProxy=function(c,C){var O=_getTarget(c),F=_scrollers.indexOf(O),G=_isViewport(O);~F&&_scrollers.splice(F,G?6:2),C&&(G?_proxies.unshift(_win,C,_body,C,_docEl,C):_proxies.unshift(O,C))},K.clearMatchMedia=function(c){_triggers.forEach(function(C){return C._ctx&&C._ctx.query===c&&C._ctx.kill(!0,!0)})},K.isInViewport=function(c,C,O){var F=(_isString(c)?_getTarget(c):c).getBoundingClientRect(),G=F[O?_width:_height]*C||0;return O?F.right-G>0&&F.left+G<_win.innerWidth:F.bottom-G>0&&F.top+G<_win.innerHeight},K.positionInViewport=function(c,C,O){_isString(c)&&(c=_getTarget(c));var F=c.getBoundingClientRect(),G=F[O?_width:_height],X=C==null?G/2:C in _keywords?_keywords[C]*G:~C.indexOf("%")?parseFloat(C)*G/100:parseFloat(C)||0;return O?(F.left+X)/_win.innerWidth:(F.top+X)/_win.innerHeight},K.killAll=function(c){if(_triggers.slice(0).forEach(function(O){return O.vars.id!=="ScrollSmoother"&&O.kill()}),c!==!0){var C=_listeners.killAll||[];_listeners={},C.forEach(function(O){return O()})}},K}();ScrollTrigger.version="3.11.4";ScrollTrigger.saveStyles=function(K){return K?_toArray(K).forEach(function(A){if(A&&A.style){var w=_savedStyles.indexOf(A);w>=0&&_savedStyles.splice(w,5),_savedStyles.push(A,A.style.cssText,A.getBBox&&A.getAttribute("transform"),gsap.core.getCache(A),_context())}}):_savedStyles};ScrollTrigger.revert=function(K,A){return _revertAll(!K,A)};ScrollTrigger.create=function(K,A){return new ScrollTrigger(K,A)};ScrollTrigger.refresh=function(K){return K?_onResize():(_coreInitted||ScrollTrigger.register())&&_refreshAll(!0)};ScrollTrigger.update=function(K){return++_scrollers.cache&&_updateAll(K===!0?2:0)};ScrollTrigger.clearScrollMemory=_clearScrollMemory;ScrollTrigger.maxScroll=function(K,A){return _maxScroll(K,A?_horizontal:_vertical)};ScrollTrigger.getScrollFunc=function(K,A){return _getScrollFunc(_getTarget(K),A?_horizontal:_vertical)};ScrollTrigger.getById=function(K){return _ids[K]};ScrollTrigger.getAll=function(){return _triggers.filter(function(K){return K.vars.id!=="ScrollSmoother"})};ScrollTrigger.isScrolling=function(){return!!_lastScrollTime};ScrollTrigger.snapDirectional=_snapDirectional;ScrollTrigger.addEventListener=function(K,A){var w=_listeners[K]||(_listeners[K]=[]);~w.indexOf(A)||w.push(A)};ScrollTrigger.removeEventListener=function(K,A){var w=_listeners[K],c=w&&w.indexOf(A);c>=0&&w.splice(c,1)};ScrollTrigger.batch=function(K,A){var w=[],c={},C=A.interval||.016,O=A.batchMax||1e9,F=function(te,ue){var fe=[],de=[],le=gsap.delayedCall(C,function(){ue(fe,de),fe=[],de=[]}).pause();return function(me){fe.length||le.restart(!0),fe.push(me.trigger),de.push(me),O<=fe.length&&le.progress(1)}},G;for(G in A)c[G]=G.substr(0,2)==="on"&&_isFunction(A[G])&&G!=="onRefreshInit"?F(G,A[G]):A[G];return _isFunction(O)&&(O=O(),_addListener(ScrollTrigger,"refresh",function(){return O=A.batchMax()})),_toArray(K).forEach(function(X){var te={};for(G in c)te[G]=c[G];te.trigger=X,w.push(ScrollTrigger.create(te))}),w};var _clampScrollAndGetDurationMultiplier=function(A,w,c,C){return w>C?A(C):w<0&&A(0),c>C?(C-w)/(c-w):c<0?w/(w-c):1},_allowNativePanning=function K(A,w){w===!0?A.style.removeProperty("touch-action"):A.style.touchAction=w===!0?"auto":w?"pan-"+w+(Observer.isTouch?" pinch-zoom":""):"none",A===_docEl&&K(_body,w)},_overflow={auto:1,scroll:1},_nestedScroll=function(A){var w=A.event,c=A.target,C=A.axis,O=(w.changedTouches?w.changedTouches[0]:w).target,F=O._gsap||gsap.core.getCache(O),G=_getTime(),X;if(!F._isScrollT||G-F._isScrollT>2e3){for(;O&&O!==_body&&(O.scrollHeight<=O.clientHeight&&O.scrollWidth<=O.clientWidth||!(_overflow[(X=_getComputedStyle(O)).overflowY]||_overflow[X.overflowX]));)O=O.parentNode;F._isScroll=O&&O!==c&&!_isViewport(O)&&(_overflow[(X=_getComputedStyle(O)).overflowY]||_overflow[X.overflowX]),F._isScrollT=G}(F._isScroll||C==="x")&&(w.stopPropagation(),w._gsapAllow=!0)},_inputObserver=function(A,w,c,C){return Observer.create({target:A,capture:!0,debounce:!1,lockAxis:!0,type:w,onWheel:C=C&&_nestedScroll,onPress:C,onDrag:C,onScroll:C,onEnable:function(){return c&&_addListener(_doc,Observer.eventTypes[0],_captureInputs,!1,!0)},onDisable:function(){return _removeListener(_doc,Observer.eventTypes[0],_captureInputs,!0)}})},_inputExp=/(input|label|select|textarea)/i,_inputIsFocused,_captureInputs=function(A){var w=_inputExp.test(A.target.tagName);(w||_inputIsFocused)&&(A._gsapAllow=!0,_inputIsFocused=w)},_getScrollNormalizer=function(A){_isObject(A)||(A={}),A.preventDefault=A.isNormalizer=A.allowClicks=!0,A.type||(A.type="wheel,touch"),A.debounce=!!A.debounce,A.id=A.id||"normalizer";var w=A,c=w.normalizeScrollX,C=w.momentum,O=w.allowNestedScroll,F,G,X=_getTarget(A.target)||_docEl,te=gsap.core.globals().ScrollSmoother,ue=te&&te.get(),fe=_fixIOSBug&&(A.content&&_getTarget(A.content)||ue&&A.content!==!1&&!ue.smooth()&&ue.content()),de=_getScrollFunc(X,_vertical),le=_getScrollFunc(X,_horizontal),me=1,$=(Observer.isTouch&&_win.visualViewport?_win.visualViewport.scale*_win.visualViewport.width:_win.outerWidth)/_win.innerWidth,_e=0,oe=_isFunction(C)?function(){return C(F)}:function(){return C||2.8},ge,Se,je=_inputObserver(X,A.type,!0,O),ye=function(){return Se=!1},Ne=_passThrough,Z=_passThrough,se=function(){G=_maxScroll(X,_vertical),Z=_clamp(_fixIOSBug?1:0,G),c&&(Ne=_clamp(0,_maxScroll(X,_horizontal))),ge=_refreshID},ae=function(){fe._gsap.y=_round(parseFloat(fe._gsap.y)+de.offset)+"px",fe.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+parseFloat(fe._gsap.y)+", 0, 1)",de.offset=de.cacheID=0},Be=function(){if(Se){requestAnimationFrame(ye);var Ot=_round(F.deltaY/2),At=Z(de.v-Ot);if(fe&&At!==de.v+de.offset){de.offset=At-de.v;var Pt=_round((parseFloat(fe&&fe._gsap.y)||0)-de.offset);fe.style.transform="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, "+Pt+", 0, 1)",fe._gsap.y=Pt+"px",de.cacheID=_scrollers.cache,_updateAll()}return!0}de.offset&&ae(),Se=!0},we,tt,St,_t,xt=function(){se(),we.isActive()&&we.vars.scrollY>G&&(de()>G?we.progress(1)&&de(G):we.resetTo("scrollY",G))};return fe&&gsap.set(fe,{y:"+=0"}),A.ignoreCheck=function(ct){return _fixIOSBug&&ct.type==="touchmove"&&Be()||me>1.05&&ct.type!=="touchstart"||F.isGesturing||ct.touches&&ct.touches.length>1},A.onPress=function(){var ct=me;me=_round((_win.visualViewport&&_win.visualViewport.scale||1)/$),we.pause(),ct!==me&&_allowNativePanning(X,me>1.01?!0:c?!1:"x"),tt=le(),St=de(),se(),ge=_refreshID},A.onRelease=A.onGestureStart=function(ct,Ot){if(de.offset&&ae(),!Ot)_t.restart(!0);else{_scrollers.cache++;var At=oe(),Pt,Ie;c&&(Pt=le(),Ie=Pt+At*.05*-ct.velocityX/.227,At*=_clampScrollAndGetDurationMultiplier(le,Pt,Ie,_maxScroll(X,_horizontal)),we.vars.scrollX=Ne(Ie)),Pt=de(),Ie=Pt+At*.05*-ct.velocityY/.227,At*=_clampScrollAndGetDurationMultiplier(de,Pt,Ie,_maxScroll(X,_vertical)),we.vars.scrollY=Z(Ie),we.invalidate().duration(At).play(.01),(_fixIOSBug&&we.vars.scrollY>=G||Pt>=G-1)&&gsap.to({},{onUpdate:xt,duration:At})}},A.onWheel=function(){we._ts&&we.pause(),_getTime()-_e>1e3&&(ge=0,_e=_getTime())},A.onChange=function(ct,Ot,At,Pt,Ie){if(_refreshID!==ge&&se(),Ot&&c&&le(Ne(Pt[2]===Ot?tt+(ct.startX-ct.x):le()+Ot-Pt[1])),At){de.offset&&ae();var vt=Ie[2]===At,ft=vt?St+ct.startY-ct.y:de()+At-Ie[1],jt=Z(ft);vt&&ft!==jt&&(St+=jt-ft),de(jt)}(At||Ot)&&_updateAll()},A.onEnable=function(){_allowNativePanning(X,c?!1:"x"),ScrollTrigger.addEventListener("refresh",xt),_addListener(_win,"resize",xt),de.smooth&&(de.target.style.scrollBehavior="auto",de.smooth=le.smooth=!1),je.enable()},A.onDisable=function(){_allowNativePanning(X,!0),_removeListener(_win,"resize",xt),ScrollTrigger.removeEventListener("refresh",xt),je.kill()},A.lockAxis=A.lockAxis!==!1,F=new Observer(A),F.iOS=_fixIOSBug,_fixIOSBug&&!de()&&de(1),_fixIOSBug&&gsap.ticker.add(_passThrough),_t=F._dc,we=gsap.to(F,{ease:"power4",paused:!0,scrollX:c?"+=0.1":"+=0",scrollY:"+=0.1",onComplete:_t.vars.onComplete}),F};ScrollTrigger.sort=function(K){return _triggers.sort(K||function(A,w){return(A.vars.refreshPriority||0)*-1e6+A.start-(w.start+(w.vars.refreshPriority||0)*-1e6)})};ScrollTrigger.observe=function(K){return new Observer(K)};ScrollTrigger.normalizeScroll=function(K){if(typeof K>"u")return _normalizer;if(K===!0&&_normalizer)return _normalizer.enable();if(K===!1)return _normalizer&&_normalizer.kill();var A=K instanceof Observer?K:_getScrollNormalizer(K);return _normalizer&&_normalizer.target===A.target&&_normalizer.kill(),_isViewport(A.target)&&(_normalizer=A),A};ScrollTrigger.core={_getVelocityProp,_inputObserver,_scrollers,_proxies,bridge:{ss:function(){_lastScrollTime||_dispatch("scrollStart"),_lastScrollTime=_getTime()},ref:function(){return _refreshing}}};_getGSAP()&&gsap.registerPlugin(ScrollTrigger);/*! For license information please see bundle.m.js.LICENSE.txt */var __webpackgi_modules__={798:function(K,A,w){var c=w(352),C=w.n(c)()(function(O){return O[1]});C.push([K.id,"#assetManagerPopup{z-index:300;position:absolute;bottom:2rem;right:2rem;-webkit-backdrop-filter:blur(16px);backdrop-filter:blur(16px);color:#fff;background-blend-mode:luminosity;background-color:#28223CAA;padding:1.5rem;font-size:1rem;width:-webkit-max-content;width:-moz-max-content;width:max-content;max-width:80vw;max-height:80vh;overflow-y:scroll;border-radius:.5rem;height:-webkit-max-content;height:-moz-max-content;height:max-content}#assetManagerPopupClose{position:absolute;top:0;right:0;padding:.5rem;cursor:pointer}#assetManagerPopupContent{padding-top:.5rem}.processState{font-weight:bold}",""]),A.Z=C},898:function(K,A,w){var c=w(352),C=w.n(c)()(function(O){return O[1]});C.push([K.id,':root{--tp-blade-unit-size: 24px;--tp-element-border-radius: 0.25rem;--tp-base-background-color: #28223C;--tp-base-shadow-color: hsla(0, 0%, 0%, 0.2);--tp-button-background-color: hsla(230, 10%, 80%, 1.00);--tp-button-background-color-active: hsla(230, 10%, 95%, 1.00);--tp-button-background-color-focus: hsla(230, 10%, 90%, 1.00);--tp-button-background-color-hover: hsla(230, 10%, 85%, 1.00);--tp-button-foreground-color: hsla(230, 20%, 11%, 1.00);--tp-container-background-color: hsla(230, 25%, 16%, 0.65);--tp-container-background-color-active: hsla(230, 25%, 31%, 0.65);--tp-container-background-color-focus: hsla(230, 25%, 26%, 0.65);--tp-container-background-color-hover: hsla(230, 25%, 21%, 0.65);--tp-container-foreground-color: hsl(240, 10%, 92%);--tp-groove-foreground-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color: hsla(230, 20%, 8%, 1.00);--tp-input-background-color-active: hsla(230, 28%, 23%, 1.00);--tp-input-background-color-focus: hsla(230, 28%, 18%, 1.00);--tp-input-background-color-hover: hsla(230, 20%, 13%, 1.00);--tp-input-foreground-color: hsla(230, 10%, 80%, 1.00);--tp-monitor-background-color: hsla(230, 20%, 8%, 1.00);--tp-monitor-foreground-color: hsla(230, 12%, 48%, 1.00);--tp-label-foreground-color: #E4E2ED;--tp-font-family: "Inter"}.tp-fldv{margin-top:.25rem;margin-bottom:.25rem;background-blend-mode:luminosity;position:relative}.tp-fldv .tp-fldv{margin-top:.5rem;margin-bottom:.5rem}.tp-fldv .tp-brkv{background-color:rgba(32,32,50,.85)}.tp-fldv .tp-fldv .tp-brkv{background-color:rgba(32,32,50,.25) !important}.tp-fldv-expanded>.tp-fldv_b{background-color:rgba(32,32,50,.8) !important}.tp-fldv_b{height:calc(var(--bld-us)*1.5 + 4px) !important;font-size:.85rem !important}.tp-fldv_b+.tp-brkv .tp-fldv_b{height:calc(var(--bld-us)*1.1 + 4px) !important;font-size:.65rem !important}.tp-lblv_l{font-size:.7rem !important;font-weight:400 !important;flex-grow:1 !important;flex-basis:20% !important}.tp-lblv_v{flex-grow:1 !important;flex-basis:50% !important}.tp-txtv_i{font-size:.7rem !important;font-weight:400 !important}.tp-fldv_t{font-weight:400 !important;padding-left:1.5rem !important}.tp-fldv_m{right:auto !important;left:.75rem;opacity:1 !important}.pluginOptionsButton{position:absolute;right:0;top:.75rem;padding-left:.5rem;padding-right:.5rem;height:-webkit-min-content;height:-moz-min-content;height:min-content;background:transparent;color:#eee;border:none}',""]),A.Z=C},513:function(K,A,w){var c=w(352),C=w.n(c)()(function(O){return O[1]});C.push([K.id,".wwise-perspective{perspective:1000px;position:fixed;left:0;top:0;width:100vw;height:100vh}.wwise-wrapper{position:fixed;width:0;height:0;font-weight:400}.wwise-wrapper.v-center{top:50%}.wwise-wrapper.h-center{left:50%}.wwise-wrapper.left{left:0}.wwise-wrapper.right{right:0}.wwise-wrapper.top{top:0}.wwise-wrapper.bottom{bottom:0}.wwise *.preset{color:#fafafa}.wwise *.preset.ok{background:rgba(45,193,80,.95)}.wwise *.preset.error{background:rgba(190,17,51,.95)}.wwise *.preset.info{background:rgba(40,34,60,.95)}.wwise *.preset.caution{background:rgba(239,128,0,.95)}.wwise-no-scroll{position:relative;overflow:hidden}.wwise-overlay{position:fixed;left:0;top:0;width:100vw;height:100vh;background:rgba(50,50,50,.5)}.wwise{position:absolute;left:0;top:0;display:flex;flex-direction:column;border-radius:5px;box-shadow:1px 1px 10px rgba(150,150,150,.5);box-sizing:border-box}.wwise.no-radius{border-radius:0}.wwise *{box-sizing:border-box}.wwise .clear{clear:both}.wwise>.content{padding:0;margin:0;flex-grow:1;border-radius:0 0 4px 4px;background:#fff;color:#333;box-shadow:0 1px 3px rgba(200,200,200,.5) inset}.wwise>.content.no-topbar{border-radius:4px;box-shadow:none}.wwise.no-radius>.content,.wwise.no-radius>.content.no-topbar{border-radius:0}.wwise .modal>.main{width:90vw;max-width:400px;border-radius:4px 4px 0 0;text-align:center;padding-bottom:10px;color:#fff}.wwise .modal>.main .icon{display:block;margin:0 auto;fill:#fff;width:100px}.wwise .modal>.main .title{font-size:30px}.wwise .modal>.main .text{margin:10px 0;font-weight:300;font-size:16px}.wwise .modal>.main.no-op{border-radius:4px}.wwise .modal>.main.ok{background:#2dc150}.wwise .modal>.main.error{background:#be1133}.wwise .modal>.main.info{background:#28223c}.wwise .modal>.main.caution{background:#ef8000}.wwise .modal>.operation .button-wrapper{text-align:center;margin:30px 0 20px 0}.wwise .modal>.operation .button{display:inline-block;line-height:18px;padding:8px 10px;margin:0 15px;line-height:18px;width:100px;border-radius:4px;border:1px solid #eee;box-shadow:1px 1px 3px rgba(220,220,220,.8);color:#555;transition:all ease .2s}.wwise .modal>.operation .button:hover{background:#f5f5f5;cursor:pointer}.wwise .modal>.operation .button.main{color:#fff}.wwise .modal>.operation.ok .main{background:#2dc150}.wwise .modal>.operation.ok .main:hover{background:#23983f}.wwise .modal>.operation.error .main{background:#be1133}.wwise .modal>.operation.error .main:hover{background:#8f0d26}.wwise .modal>.operation.info .main{background:#28223c}.wwise .modal>.operation.info .main:hover{background:#12101b}.wwise .modal>.operation.caution .main{background:#ef8000}.wwise .modal>.operation.caution .main:hover{background:#bc6500}.wwise .input-wrapper{margin:15px auto -15px auto}.wwise .input-wrapper .input{display:block;margin:0 auto;width:95%;max-width:300px;outline:none;border:none;background:#f3f3f3;padding:15px;font-size:16px;border-radius:5px}.wwise .input-wrapper .error{width:95%;text-align:center;margin-top:10px;color:red}div:has(>.wwise-wrapper){position:absolute !important}.wwise-wrapper{position:absolute !important}.wwise .modal>.main{padding-top:10px}",""]),A.Z=C},476:function(K){var A;A=function(){return function(w){var c={};function C(O){if(c[O])return c[O].exports;var F=c[O]={i:O,l:!1,exports:{}};return w[O].call(F.exports,F,F.exports,C),F.l=!0,F.exports}return C.m=w,C.c=c,C.i=function(O){return O},C.d=function(O,F,G){C.o(O,F)||Object.defineProperty(O,F,{configurable:!1,enumerable:!0,get:G})},C.n=function(O){var F=O&&O.__esModule?function(){return O.default}:function(){return O};return C.d(F,"a",F),F},C.o=function(O,F){return Object.prototype.hasOwnProperty.call(O,F)},C.p="",C(C.s=5)}([function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0});var O={convertToObject:function(F){var G=F.substring(F.indexOf("{")+1).trim().slice(0,-1),X={};return G.split(";").map(function(te){if(te=te.trim()){var ue=te.split(":");X[ue[0].trim()]=ue[1].trim()}}),X},getFromSheets:function(F){var G=document.styleSheets;for(var X in G){var te=null;try{te=G[X].rules||G[X].cssRules}catch{}if(te){for(var ue in te)if(te[ue].selectorText&&te[ue].selectorText.split(",").indexOf(F)!=-1)return te[ue].cssText?O.convertToObject(te[ue].cssText):O.convertToObject(te[ue].style.cssText)}}return{}},getPropertyDefault:function(F){return F=="timing-function"?"ease":F=="iteration-count"?1:F=="direction"?"normal":F=="fill-mode"?"none":null}};c.default=O},function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0});var O={generateId:function(){for(var F="",G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",X=0;X<8;++X)F+=G.charAt(Math.floor(Math.random()*G.length));return F},frameToString:function(F){var G="";for(var X in F)G+=X+":"+F[X]+";";return G},convertTimeToMs:function(F){if(!F)return 0;if(typeof F=="number")return F;var G=parseFloat(F);return F.indexOf("ms")!=-1?G:1e3*G},prefixes:["","-webkit-","-moz-","-o-"]};c.default=O},function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0});var O,F=(O=C(0))&&O.__esModule?O:{default:O};c.default=function G(X,te){if(function(de,le){if(!(de instanceof le))throw new TypeError("Cannot call a class as a function")}(this,G),this.styles=typeof X=="string"?F.default.getFromSheets(X):X,typeof te=="string"){var ue=F.default.getFromSheets(te);for(var fe in this.options={},ue)this.options[fe.replace("animation-","")]=ue[fe]}else this.options=typeof te=="number"?{duration:te}:te}},function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0});var O=function(){function fe(de,le){for(var me=0;me<le.length;me++){var $=le[me];$.enumerable=$.enumerable||!1,$.configurable=!0,"value"in $&&($.writable=!0),Object.defineProperty(de,$.key,$)}}return function(de,le,me){return le&&fe(de.prototype,le),me&&fe(de,me),de}}(),F=te(C(4)),G=te(C(1)),X=te(C(0));function te(fe){return fe&&fe.__esModule?fe:{default:fe}}var ue=function(){function fe(de,le,me,$){if(function(ge,Se){if(!(ge instanceof Se))throw new TypeError("Cannot call a class as a function")}(this,fe),de.constructor===Array?this.doms=de:this.doms=[de],le.constructor===Array?this.frames=le:this.frames=[le],this.options={startFrom:0,pauseAt:[],prefix:!1,count:1,clear:!0,applyOnEnd:!1,instant:!1},me!=null&&me!=null)if(typeof me=="boolean")this.options.instant=me;else if(typeof me=="number")this.options.count=me,typeof $=="boolean"&&(this.options.instant=$);else for(var _e in me)_e=="pauseAt"&&me.pauseAt.constructor!==Array?this.options[_e]=[me[_e]]:this.options[_e]=me[_e];for(var oe in this.promiseSupported=typeof Promise<"u"&&Promise.toString().indexOf("[native code]")!==-1,this.countRemainder=[],this.animations=[],this.styleDoms=[],this.superSets=[],this.eventHandler=[],this.options.prefix?this.prefixes=G.default.prefixes:this.prefixes=[""],de)this.countRemainder[oe]=this.options.count-1;this.options.instant&&this.play()}return O(fe,[{key:"play",value:function(){var de=this;for(var le in this.clear(),this.promiseSupported&&(this.promise=new Promise(function($){de.promiseResolve=$})),this.doms){var me=this.makeAnimation(this.doms[le]);this.animations[le]=me.names,this.styleDoms[le]=me.styleDom,this.superSets[le]=this.makeSuperSet(this.doms[le],this.animations[le]),this.playAnimation(this.doms[le],this.superSets[le]),this.eventHandler[le]=this.handleAnimationEnd.bind(this,le),this.doms[le].addEventListener("animationend",this.eventHandler[le])}if(this.promiseSupported)return this.promise}},{key:"clear",value:function(de){if(!de){for(var le in this.doms)this.clear(le);return this.animationEnded=0,this.promise=void 0,void(this.promiseResolve=void 0)}var me=this.styleDoms[de];for(var $ in me&&me.parentNode&&me.parentNode.removeChild(me),this.superSets[de])for(var _e in this.prefixes)this.doms[de].style[this.prefixes[_e]+"animation-"+$]=null;for(var oe in this.prefixes)this.doms[de].style[this.prefixes[oe]+"animation-play-state"]=null;this.doms[de].removeEventListener("animationend",this.eventHandler[de]),this.countRemainder[de]=this.options.count-1}},{key:"replay",value:function(de){var le=this.doms[de],me=le.cloneNode(!0);le.parentNode.replaceChild(me,le),this.doms[de].removeEventListener("animationend",this.eventHandler[de]),this.doms[de]=me,this.doms[de].addEventListener("animationend",this.eventHandler[de])}},{key:"pause",value:function(){for(var de in this.doms)this.pauseDom(this.doms[de])}},{key:"resume",value:function(){for(var de in this.doms)this.resumeDom(this.doms[de])}},{key:"getPromise",value:function(){return this.promise}},{key:"handleAnimationEnd",value:function(de,le){var me=le.animationName,$=me.substring(me.lastIndexOf("-")+1);this.options.pauseAt.includes(parseInt($))&&this.pauseDom(this.doms[de]),$==this.frames.length&&(this.countRemainder[de]==-1?this.replay(de):this.countRemainder[de]>0?(this.countRemainder[de]--,this.replay(de)):(this.options.applyOnEnd&&this.applyOnEnd(de),this.animationEnded++,this.animationEnded==this.doms.length&&(this.promiseSupported&&this.promiseResolve(),this.options.clear&&this.clear())))}},{key:"pauseDom",value:function(de){for(var le in this.prefixes)de.style[this.prefixes[le]+"animation-play-state"]="paused"}},{key:"resumeDom",value:function(de){for(var le in this.prefixes)de.style[this.prefixes[le]+"animation-play-state"]="running"}},{key:"applyOnEnd",value:function(de){var le=this.newFrames[this.frames.length];for(var me in le)this.doms[de].style[me]=le[me]}},{key:"makeAnimation",value:function(de){var le={},me=[],$={};for(var _e in this.frames)for(var oe in me.push(this.frames[_e].styles),me[_e])$[oe]=!0;var ge=window.getComputedStyle(de);for(var Se in $)le[Se]=ge[Se];me.unshift(le);for(var je=[me[0]],ye=1;ye<me.length;++ye){var Ne=JSON.parse(JSON.stringify(je[ye-1]));for(var Z in me[ye])Ne[Z]=me[ye][Z];je.push(Ne)}return this.newFrames=je,F.default.make(je,this.prefixes)}},{key:"makeSuperSet",value:function(de,le){var me=0,$={};for(var _e in this.frames)for(var oe in this.frames[_e].options)$[oe]="";$.name="",$.duration="",$.delay="";for(var ge=0;ge<this.frames.length;++ge){if(ge)for(var Se in $)$[Se]+=",";var je=G.default.convertTimeToMs(this.frames[ge].options.duration),ye=G.default.convertTimeToMs(this.frames[ge].options.delay);for(var Ne in ge<this.options.startFrom&&(je=0,ye=0),$.name+=le[ge],$.duration+=je+"ms",$.delay+=me+ye+"ms",$)Ne!="name"&&Ne!="duration"&&Ne!="delay"&&($[Ne]+=this.frames[ge].options[Ne]?this.frames[ge].options[Ne]:X.default.getPropertyDefault(Ne));var Z=this.frames[ge].options["iteration-count"];me+=je*parseInt(Z||1)+ye}return $}},{key:"playAnimation",value:function(de,le){for(var me in le)for(var $ in this.prefixes)de.style[this.prefixes[$]+"animation-"+me]=le[me];this.options.pauseAt.includes(0)&&this.pauseDom(de)}}]),fe}();c.default=ue},function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0});var O,F=(O=C(1))&&O.__esModule?O:{default:O},G={make:function(X,te){for(var ue=[],fe="",de="atr-"+F.default.generateId(),le=document.createElement("style"),me=0;me<X.length-1;++me)ue.push(de+"-"+(me+1)),fe+=G.makeFromTwoFrames(X[me],X[me+1],ue[me],te);return le.innerHTML=fe,le.class="foo",document.getElementsByTagName("head")[0].appendChild(le),{names:ue,styleDom:le}},makeFromTwoFrames:function(X,te,ue,fe){var de="";for(var le in fe)de+="@"+fe[le]+"keyframes "+ue+" {",de+="0%",de+="{"+F.default.frameToString(X)+"}",de+="100%",de+="{"+F.default.frameToString(te)+"}",de+="}";return de}};c.default=G},function(w,c,C){Object.defineProperty(c,"__esModule",{value:!0}),c.Queue=c.Frame=void 0;var O=G(C(2)),F=G(C(3));function G(X){return X&&X.__esModule?X:{default:X}}c.Frame=O.default,c.Queue=F.default}])},K.exports=A()},352:function(K){K.exports=function(A){var w=[];return w.toString=function(){return this.map(function(c){var C=A(c);return c[2]?"@media ".concat(c[2]," {").concat(C,"}"):C}).join("")},w.i=function(c,C,O){typeof c=="string"&&(c=[[null,c,""]]);var F={};if(O)for(var G=0;G<this.length;G++){var X=this[G][0];X!=null&&(F[X]=!0)}for(var te=0;te<c.length;te++){var ue=[].concat(c[te]);O&&F[ue[0]]||(C&&(ue[2]?ue[2]="".concat(C," and ").concat(ue[2]):ue[2]=C),w.push(ue))}},w}},388:function(K){K.exports=function A(w,c,C){function O(X,te){if(!c[X]){if(!w[X]){if(F)return F(X,!0);throw new Error("Cannot find module '"+X+"'")}var ue=c[X]={exports:{}};w[X][0].call(ue.exports,function(fe){return O(w[X][1][fe]||fe)},ue,ue.exports,A,w,c,C)}return c[X].exports}for(var F=void 0,G=0;G<C.length;G++)O(C[G]);return O}({1:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){var le=A("crypto");function me(ye,Ne){return function(Z,se){var ae;if((ae=se.algorithm!=="passthrough"?le.createHash(se.algorithm):new je).write===void 0&&(ae.write=ae.update,ae.end=ae.update),Se(se,ae).dispatch(Z),ae.update||ae.end(""),ae.digest)return ae.digest(se.encoding==="buffer"?void 0:se.encoding);var Be=ae.read();return se.encoding!=="buffer"?Be.toString(se.encoding):Be}(ye,Ne=oe(ye,Ne))}(c=w.exports=me).sha1=function(ye){return me(ye)},c.keys=function(ye){return me(ye,{excludeValues:!0,algorithm:"sha1",encoding:"hex"})},c.MD5=function(ye){return me(ye,{algorithm:"md5",encoding:"hex"})},c.keysMD5=function(ye){return me(ye,{algorithm:"md5",encoding:"hex",excludeValues:!0})};var $=le.getHashes?le.getHashes().slice():["sha1","md5"];$.push("passthrough");var _e=["buffer","hex","binary","base64"];function oe(ye,Ne){Ne=Ne||{};var Z={};if(Z.algorithm=Ne.algorithm||"sha1",Z.encoding=Ne.encoding||"hex",Z.excludeValues=!!Ne.excludeValues,Z.algorithm=Z.algorithm.toLowerCase(),Z.encoding=Z.encoding.toLowerCase(),Z.ignoreUnknown=Ne.ignoreUnknown===!0,Z.respectType=Ne.respectType!==!1,Z.respectFunctionNames=Ne.respectFunctionNames!==!1,Z.respectFunctionProperties=Ne.respectFunctionProperties!==!1,Z.unorderedArrays=Ne.unorderedArrays===!0,Z.unorderedSets=Ne.unorderedSets!==!1,Z.unorderedObjects=Ne.unorderedObjects!==!1,Z.replacer=Ne.replacer||void 0,Z.excludeKeys=Ne.excludeKeys||void 0,ye===void 0)throw new Error("Object argument required.");for(var se=0;se<$.length;++se)$[se].toLowerCase()===Z.algorithm.toLowerCase()&&(Z.algorithm=$[se]);if($.indexOf(Z.algorithm)===-1)throw new Error('Algorithm "'+Z.algorithm+'"  not supported. supported values: '+$.join(", "));if(_e.indexOf(Z.encoding)===-1&&Z.algorithm!=="passthrough")throw new Error('Encoding "'+Z.encoding+'"  not supported. supported values: '+_e.join(", "));return Z}function ge(ye){if(typeof ye=="function")return/^function\s+\w*\s*\(\s*\)\s*{\s+\[native code\]\s+}$/i.exec(Function.prototype.toString.call(ye))!=null}function Se(ye,Ne,Z){function se(ae){return Ne.update?Ne.update(ae,"utf8"):Ne.write(ae,"utf8")}return Z=Z||[],{dispatch:function(ae){return ye.replacer&&(ae=ye.replacer(ae)),this["_"+(ae===null?"null":typeof ae)](ae)},_object:function(ae){var Be,we=Object.prototype.toString.call(ae),tt=/\[object (.*)\]/i.exec(we);if(tt=(tt=tt?tt[1]:"unknown:["+we+"]").toLowerCase(),0<=(Be=Z.indexOf(ae)))return this.dispatch("[CIRCULAR:"+Be+"]");if(Z.push(ae),F!==void 0&&F.isBuffer&&F.isBuffer(ae))return se("buffer:"),se(ae);if(tt==="object"||tt==="function"||tt==="asyncfunction"){var St=Object.keys(ae);ye.unorderedObjects&&(St=St.sort()),ye.respectType===!1||ge(ae)||St.splice(0,0,"prototype","__proto__","constructor"),ye.excludeKeys&&(St=St.filter(function(xt){return!ye.excludeKeys(xt)})),se("object:"+St.length+":");var _t=this;return St.forEach(function(xt){_t.dispatch(xt),se(":"),ye.excludeValues||_t.dispatch(ae[xt]),se(",")})}if(!this["_"+tt]){if(ye.ignoreUnknown)return se("["+tt+"]");throw new Error('Unknown object type "'+tt+'"')}this["_"+tt](ae)},_array:function(ae,Be){Be=Be!==void 0?Be:ye.unorderedArrays!==!1;var we=this;if(se("array:"+ae.length+":"),!Be||ae.length<=1)return ae.forEach(function(_t){return we.dispatch(_t)});var tt=[],St=ae.map(function(_t){var xt=new je,ct=Z.slice();return Se(ye,xt,ct).dispatch(_t),tt=tt.concat(ct.slice(Z.length)),xt.read().toString()});return Z=Z.concat(tt),St.sort(),this._array(St,!1)},_date:function(ae){return se("date:"+ae.toJSON())},_symbol:function(ae){return se("symbol:"+ae.toString())},_error:function(ae){return se("error:"+ae.toString())},_boolean:function(ae){return se("bool:"+ae.toString())},_string:function(ae){se("string:"+ae.length+":"),se(ae.toString())},_function:function(ae){se("fn:"),ge(ae)?this.dispatch("[native]"):this.dispatch(ae.toString()),ye.respectFunctionNames!==!1&&this.dispatch("function-name:"+String(ae.name)),ye.respectFunctionProperties&&this._object(ae)},_number:function(ae){return se("number:"+ae.toString())},_xml:function(ae){return se("xml:"+ae.toString())},_null:function(){return se("Null")},_undefined:function(){return se("Undefined")},_regexp:function(ae){return se("regex:"+ae.toString())},_uint8array:function(ae){return se("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint8clampedarray:function(ae){return se("uint8clampedarray:"),this.dispatch(Array.prototype.slice.call(ae))},_int8array:function(ae){return se("uint8array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint16array:function(ae){return se("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_int16array:function(ae){return se("uint16array:"),this.dispatch(Array.prototype.slice.call(ae))},_uint32array:function(ae){return se("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_int32array:function(ae){return se("uint32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float32array:function(ae){return se("float32array:"),this.dispatch(Array.prototype.slice.call(ae))},_float64array:function(ae){return se("float64array:"),this.dispatch(Array.prototype.slice.call(ae))},_arraybuffer:function(ae){return se("arraybuffer:"),this.dispatch(new Uint8Array(ae))},_url:function(ae){return se("url:"+ae.toString())},_map:function(ae){se("map:");var Be=Array.from(ae);return this._array(Be,ye.unorderedSets!==!1)},_set:function(ae){se("set:");var Be=Array.from(ae);return this._array(Be,ye.unorderedSets!==!1)},_file:function(ae){return se("file:"),this.dispatch([ae.name,ae.size,ae.type,ae.lastModfied])},_blob:function(){if(ye.ignoreUnknown)return se("[blob]");throw Error(`Hashing Blob objects is currently not supported
(see https://github.com/puleos/object-hash/issues/26)
Use "options.replacer" or "options.ignoreUnknown"
`)},_domwindow:function(){return se("domwindow")},_bigint:function(ae){return se("bigint:"+ae.toString())},_process:function(){return se("process")},_timer:function(){return se("timer")},_pipe:function(){return se("pipe")},_tcp:function(){return se("tcp")},_udp:function(){return se("udp")},_tty:function(){return se("tty")},_statwatcher:function(){return se("statwatcher")},_securecontext:function(){return se("securecontext")},_connection:function(){return se("connection")},_zlib:function(){return se("zlib")},_context:function(){return se("context")},_nodescript:function(){return se("nodescript")},_httpparser:function(){return se("httpparser")},_dataview:function(){return se("dataview")},_signal:function(){return se("signal")},_fsevent:function(){return se("fsevent")},_tlswrap:function(){return se("tlswrap")}}}function je(){return{buf:"",write:function(ye){this.buf+=ye},end:function(ye){this.buf+=ye},read:function(){return this.buf}}}c.writeToStream=function(ye,Ne,Z){return Z===void 0&&(Z=Ne,Ne={}),Se(Ne=oe(ye,Ne),Z).dispatch(ye)}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/fake_7eac155c.js","/")},{buffer:3,crypto:5,lYpoI2:10}],2:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){(function(le){var me=typeof Uint8Array<"u"?Uint8Array:Array,$="+".charCodeAt(0),_e="/".charCodeAt(0),oe="0".charCodeAt(0),ge="a".charCodeAt(0),Se="A".charCodeAt(0),je="-".charCodeAt(0),ye="_".charCodeAt(0);function Ne(Z){var se=Z.charCodeAt(0);return se===$||se===je?62:se===_e||se===ye?63:se<oe?-1:se<oe+10?se-oe+26+26:se<Se+26?se-Se:se<ge+26?se-ge+26:void 0}le.toByteArray=function(Z){var se,ae;if(0<Z.length%4)throw new Error("Invalid string. Length must be a multiple of 4");var Be=Z.length,we=Z.charAt(Be-2)==="="?2:Z.charAt(Be-1)==="="?1:0,tt=new me(3*Z.length/4-we),St=0<we?Z.length-4:Z.length,_t=0;function xt(ct){tt[_t++]=ct}for(se=0;se<St;se+=4,0)xt((16711680&(ae=Ne(Z.charAt(se))<<18|Ne(Z.charAt(se+1))<<12|Ne(Z.charAt(se+2))<<6|Ne(Z.charAt(se+3))))>>16),xt((65280&ae)>>8),xt(255&ae);return we==2?xt(255&(ae=Ne(Z.charAt(se))<<2|Ne(Z.charAt(se+1))>>4)):we==1&&(xt((ae=Ne(Z.charAt(se))<<10|Ne(Z.charAt(se+1))<<4|Ne(Z.charAt(se+2))>>2)>>8&255),xt(255&ae)),tt},le.fromByteArray=function(Z){var se,ae,Be,we,tt=Z.length%3,St="";function _t(xt){return"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(xt)}for(se=0,Be=Z.length-tt;se<Be;se+=3)St+=_t((we=ae=(Z[se]<<16)+(Z[se+1]<<8)+Z[se+2])>>18&63)+_t(we>>12&63)+_t(we>>6&63)+_t(63&we);switch(tt){case 1:St+=_t((ae=Z[Z.length-1])>>2),St+=_t(ae<<4&63),St+="==";break;case 2:St+=_t((ae=(Z[Z.length-2]<<8)+Z[Z.length-1])>>10),St+=_t(ae>>4&63),St+=_t(ae<<2&63),St+="="}return St}})(c===void 0?this.base64js={}:c)}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js","/node_modules/gulp-browserify/node_modules/base64-js/lib")},{buffer:3,lYpoI2:10}],3:[function(A,w,c){(function(C,O,$,G,X,te,ue,fe,de){var le=A("base64-js"),me=A("ieee754");function $(pe,be,Xe){if(!(this instanceof $))return new $(pe,be,Xe);var zt,Wt,qt,Cn,vn,Zn=typeof pe;if(be==="base64"&&Zn=="string")for(pe=(zt=pe).trim?zt.trim():zt.replace(/^\s+|\s+$/g,"");pe.length%4!=0;)pe+="=";if(Zn=="number")Wt=_t(pe);else if(Zn=="string")Wt=$.byteLength(pe,be);else{if(Zn!="object")throw new Error("First argument needs to be a number, array or string.");Wt=_t(pe.length)}if($._useTypedArrays?qt=$._augment(new Uint8Array(Wt)):((qt=this).length=Wt,qt._isBuffer=!0),$._useTypedArrays&&typeof pe.byteLength=="number")qt._set(pe);else if(xt(vn=pe)||$.isBuffer(vn)||vn&&typeof vn=="object"&&typeof vn.length=="number")for(Cn=0;Cn<Wt;Cn++)$.isBuffer(pe)?qt[Cn]=pe.readUInt8(Cn):qt[Cn]=pe[Cn];else if(Zn=="string")qt.write(pe,0,be);else if(Zn=="number"&&!$._useTypedArrays&&!Xe)for(Cn=0;Cn<Wt;Cn++)qt[Cn]=0;return qt}function _e(pe,be,Xe,zt){zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be!=null,"missing offset"),rt(be+1<pe.length,"Trying to read beyond buffer length"));var Wt,qt=pe.length;if(!(qt<=be))return Xe?(Wt=pe[be],be+1<qt&&(Wt|=pe[be+1]<<8)):(Wt=pe[be]<<8,be+1<qt&&(Wt|=pe[be+1])),Wt}function oe(pe,be,Xe,zt){zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be!=null,"missing offset"),rt(be+3<pe.length,"Trying to read beyond buffer length"));var Wt,qt=pe.length;if(!(qt<=be))return Xe?(be+2<qt&&(Wt=pe[be+2]<<16),be+1<qt&&(Wt|=pe[be+1]<<8),Wt|=pe[be],be+3<qt&&(Wt+=pe[be+3]<<24>>>0)):(be+1<qt&&(Wt=pe[be+1]<<16),be+2<qt&&(Wt|=pe[be+2]<<8),be+3<qt&&(Wt|=pe[be+3]),Wt+=pe[be]<<24>>>0),Wt}function ge(pe,be,Xe,zt){if(zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be!=null,"missing offset"),rt(be+1<pe.length,"Trying to read beyond buffer length")),!(pe.length<=be)){var Wt=_e(pe,be,Xe,!0);return 32768&Wt?-1*(65535-Wt+1):Wt}}function Se(pe,be,Xe,zt){if(zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be!=null,"missing offset"),rt(be+3<pe.length,"Trying to read beyond buffer length")),!(pe.length<=be)){var Wt=oe(pe,be,Xe,!0);return 2147483648&Wt?-1*(4294967295-Wt+1):Wt}}function je(pe,be,Xe,zt){return zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be+3<pe.length,"Trying to read beyond buffer length")),me.read(pe,be,Xe,23,4)}function ye(pe,be,Xe,zt){return zt||(rt(typeof Xe=="boolean","missing or invalid endian"),rt(be+7<pe.length,"Trying to read beyond buffer length")),me.read(pe,be,Xe,52,8)}function Ne(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+1<pe.length,"trying to write beyond buffer length"),vt(be,65535));var qt=pe.length;if(!(qt<=Xe))for(var Cn=0,vn=Math.min(qt-Xe,2);Cn<vn;Cn++)pe[Xe+Cn]=(be&255<<8*(zt?Cn:1-Cn))>>>8*(zt?Cn:1-Cn)}function Z(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+3<pe.length,"trying to write beyond buffer length"),vt(be,4294967295));var qt=pe.length;if(!(qt<=Xe))for(var Cn=0,vn=Math.min(qt-Xe,4);Cn<vn;Cn++)pe[Xe+Cn]=be>>>8*(zt?Cn:3-Cn)&255}function se(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+1<pe.length,"Trying to write beyond buffer length"),ft(be,32767,-32768)),pe.length<=Xe||Ne(pe,0<=be?be:65535+be+1,Xe,zt,Wt)}function ae(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+3<pe.length,"Trying to write beyond buffer length"),ft(be,2147483647,-2147483648)),pe.length<=Xe||Z(pe,0<=be?be:4294967295+be+1,Xe,zt,Wt)}function Be(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+3<pe.length,"Trying to write beyond buffer length"),jt(be,34028234663852886e22,-34028234663852886e22)),pe.length<=Xe||me.write(pe,be,Xe,zt,23,4)}function we(pe,be,Xe,zt,Wt){Wt||(rt(be!=null,"missing value"),rt(typeof zt=="boolean","missing or invalid endian"),rt(Xe!=null,"missing offset"),rt(Xe+7<pe.length,"Trying to write beyond buffer length"),jt(be,17976931348623157e292,-17976931348623157e292)),pe.length<=Xe||me.write(pe,be,Xe,zt,52,8)}c.Buffer=$,c.SlowBuffer=$,c.INSPECT_MAX_BYTES=50,$.poolSize=8192,$._useTypedArrays=function(){try{var pe=new ArrayBuffer(0),be=new Uint8Array(pe);return be.foo=function(){return 42},be.foo()===42&&typeof be.subarray=="function"}catch{return!1}}(),$.isEncoding=function(pe){switch(String(pe).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"raw":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},$.isBuffer=function(pe){return!(pe==null||!pe._isBuffer)},$.byteLength=function(pe,be){var Xe;switch(pe+="",be||"utf8"){case"hex":Xe=pe.length/2;break;case"utf8":case"utf-8":Xe=Ot(pe).length;break;case"ascii":case"binary":case"raw":Xe=pe.length;break;case"base64":Xe=At(pe).length;break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":Xe=2*pe.length;break;default:throw new Error("Unknown encoding")}return Xe},$.concat=function(pe,be){if(rt(xt(pe),`Usage: Buffer.concat(list, [totalLength])
list should be an Array.`),pe.length===0)return new $(0);if(pe.length===1)return pe[0];if(typeof be!="number")for(Wt=be=0;Wt<pe.length;Wt++)be+=pe[Wt].length;for(var Xe=new $(be),zt=0,Wt=0;Wt<pe.length;Wt++){var qt=pe[Wt];qt.copy(Xe,zt),zt+=qt.length}return Xe},$.prototype.write=function(pe,be,Xe,zt){var Wt;isFinite(be)?isFinite(Xe)||(zt=Xe,Xe=void 0):(Wt=zt,zt=be,be=Xe,Xe=Wt),be=Number(be)||0;var qt,Cn,vn,Zn,Xn,Pi,qn,gt=this.length-be;switch((!Xe||gt<(Xe=Number(Xe)))&&(Xe=gt),zt=String(zt||"utf8").toLowerCase()){case"hex":qt=function(mi,Ei,Rr,Xi){Rr=Number(Rr)||0;var zi=mi.length-Rr;(!Xi||zi<(Xi=Number(Xi)))&&(Xi=zi);var Vi=Ei.length;rt(Vi%2==0,"Invalid hex string"),Vi/2<Xi&&(Xi=Vi/2);for(var Gi=0;Gi<Xi;Gi++){var Vr=parseInt(Ei.substr(2*Gi,2),16);rt(!isNaN(Vr),"Invalid hex string"),mi[Rr+Gi]=Vr}return $._charsWritten=2*Gi,Gi}(this,pe,be,Xe);break;case"utf8":case"utf-8":Xn=pe,Pi=be,qn=Xe,qt=$._charsWritten=Pt(Ot(Xn),this,Pi,qn);break;case"ascii":case"binary":qt=function(mi,Ei,Rr,Xi){return $._charsWritten=Pt(function(zi){for(var Vi=[],Gi=0;Gi<zi.length;Gi++)Vi.push(255&zi.charCodeAt(Gi));return Vi}(Ei),mi,Rr,Xi)}(this,pe,be,Xe);break;case"base64":Cn=pe,vn=be,Zn=Xe,qt=$._charsWritten=Pt(At(Cn),this,vn,Zn);break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":qt=function(mi,Ei,Rr,Xi){return $._charsWritten=Pt(function(zi){for(var Vi,Gi,Vr,Di=[],gi=0;gi<zi.length;gi++)Gi=(Vi=zi.charCodeAt(gi))>>8,Vr=Vi%256,Di.push(Vr),Di.push(Gi);return Di}(Ei),mi,Rr,Xi)}(this,pe,be,Xe);break;default:throw new Error("Unknown encoding")}return qt},$.prototype.toString=function(pe,be,Xe){var zt,Wt,qt,Cn,vn=this;if(pe=String(pe||"utf8").toLowerCase(),be=Number(be)||0,(Xe=Xe!==void 0?Number(Xe):Xe=vn.length)===be)return"";switch(pe){case"hex":zt=function(Zn,Xn,Pi){var qn=Zn.length;(!Xn||Xn<0)&&(Xn=0),(!Pi||Pi<0||qn<Pi)&&(Pi=qn);for(var gt="",mi=Xn;mi<Pi;mi++)gt+=ct(Zn[mi]);return gt}(vn,be,Xe);break;case"utf8":case"utf-8":zt=function(Zn,Xn,Pi){var qn="",gt="";Pi=Math.min(Zn.length,Pi);for(var mi=Xn;mi<Pi;mi++)Zn[mi]<=127?(qn+=Ie(gt)+String.fromCharCode(Zn[mi]),gt=""):gt+="%"+Zn[mi].toString(16);return qn+Ie(gt)}(vn,be,Xe);break;case"ascii":case"binary":zt=function(Zn,Xn,Pi){var qn="";Pi=Math.min(Zn.length,Pi);for(var gt=Xn;gt<Pi;gt++)qn+=String.fromCharCode(Zn[gt]);return qn}(vn,be,Xe);break;case"base64":Wt=vn,Cn=Xe,zt=(qt=be)===0&&Cn===Wt.length?le.fromByteArray(Wt):le.fromByteArray(Wt.slice(qt,Cn));break;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":zt=function(Zn,Xn,Pi){for(var qn=Zn.slice(Xn,Pi),gt="",mi=0;mi<qn.length;mi+=2)gt+=String.fromCharCode(qn[mi]+256*qn[mi+1]);return gt}(vn,be,Xe);break;default:throw new Error("Unknown encoding")}return zt},$.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},$.prototype.copy=function(pe,be,Xe,zt){if(Xe=Xe||0,zt||zt===0||(zt=this.length),be=be||0,zt!==Xe&&pe.length!==0&&this.length!==0){rt(Xe<=zt,"sourceEnd < sourceStart"),rt(0<=be&&be<pe.length,"targetStart out of bounds"),rt(0<=Xe&&Xe<this.length,"sourceStart out of bounds"),rt(0<=zt&&zt<=this.length,"sourceEnd out of bounds"),zt>this.length&&(zt=this.length),pe.length-be<zt-Xe&&(zt=pe.length-be+Xe);var Wt=zt-Xe;if(Wt<100||!$._useTypedArrays)for(var qt=0;qt<Wt;qt++)pe[qt+be]=this[qt+Xe];else pe._set(this.subarray(Xe,Xe+Wt),be)}},$.prototype.slice=function(pe,be){var Xe=this.length;if(pe=St(pe,Xe,0),be=St(be,Xe,Xe),$._useTypedArrays)return $._augment(this.subarray(pe,be));for(var zt=be-pe,Wt=new $(zt,void 0,!0),qt=0;qt<zt;qt++)Wt[qt]=this[qt+pe];return Wt},$.prototype.get=function(pe){return console.log(".get() is deprecated. Access using array indexes instead."),this.readUInt8(pe)},$.prototype.set=function(pe,be){return console.log(".set() is deprecated. Access using array indexes instead."),this.writeUInt8(pe,be)},$.prototype.readUInt8=function(pe,be){if(be||(rt(pe!=null,"missing offset"),rt(pe<this.length,"Trying to read beyond buffer length")),!(pe>=this.length))return this[pe]},$.prototype.readUInt16LE=function(pe,be){return _e(this,pe,!0,be)},$.prototype.readUInt16BE=function(pe,be){return _e(this,pe,!1,be)},$.prototype.readUInt32LE=function(pe,be){return oe(this,pe,!0,be)},$.prototype.readUInt32BE=function(pe,be){return oe(this,pe,!1,be)},$.prototype.readInt8=function(pe,be){if(be||(rt(pe!=null,"missing offset"),rt(pe<this.length,"Trying to read beyond buffer length")),!(pe>=this.length))return 128&this[pe]?-1*(255-this[pe]+1):this[pe]},$.prototype.readInt16LE=function(pe,be){return ge(this,pe,!0,be)},$.prototype.readInt16BE=function(pe,be){return ge(this,pe,!1,be)},$.prototype.readInt32LE=function(pe,be){return Se(this,pe,!0,be)},$.prototype.readInt32BE=function(pe,be){return Se(this,pe,!1,be)},$.prototype.readFloatLE=function(pe,be){return je(this,pe,!0,be)},$.prototype.readFloatBE=function(pe,be){return je(this,pe,!1,be)},$.prototype.readDoubleLE=function(pe,be){return ye(this,pe,!0,be)},$.prototype.readDoubleBE=function(pe,be){return ye(this,pe,!1,be)},$.prototype.writeUInt8=function(pe,be,Xe){Xe||(rt(pe!=null,"missing value"),rt(be!=null,"missing offset"),rt(be<this.length,"trying to write beyond buffer length"),vt(pe,255)),be>=this.length||(this[be]=pe)},$.prototype.writeUInt16LE=function(pe,be,Xe){Ne(this,pe,be,!0,Xe)},$.prototype.writeUInt16BE=function(pe,be,Xe){Ne(this,pe,be,!1,Xe)},$.prototype.writeUInt32LE=function(pe,be,Xe){Z(this,pe,be,!0,Xe)},$.prototype.writeUInt32BE=function(pe,be,Xe){Z(this,pe,be,!1,Xe)},$.prototype.writeInt8=function(pe,be,Xe){Xe||(rt(pe!=null,"missing value"),rt(be!=null,"missing offset"),rt(be<this.length,"Trying to write beyond buffer length"),ft(pe,127,-128)),be>=this.length||(0<=pe?this.writeUInt8(pe,be,Xe):this.writeUInt8(255+pe+1,be,Xe))},$.prototype.writeInt16LE=function(pe,be,Xe){se(this,pe,be,!0,Xe)},$.prototype.writeInt16BE=function(pe,be,Xe){se(this,pe,be,!1,Xe)},$.prototype.writeInt32LE=function(pe,be,Xe){ae(this,pe,be,!0,Xe)},$.prototype.writeInt32BE=function(pe,be,Xe){ae(this,pe,be,!1,Xe)},$.prototype.writeFloatLE=function(pe,be,Xe){Be(this,pe,be,!0,Xe)},$.prototype.writeFloatBE=function(pe,be,Xe){Be(this,pe,be,!1,Xe)},$.prototype.writeDoubleLE=function(pe,be,Xe){we(this,pe,be,!0,Xe)},$.prototype.writeDoubleBE=function(pe,be,Xe){we(this,pe,be,!1,Xe)},$.prototype.fill=function(pe,be,Xe){if(pe=pe||0,be=be||0,Xe=Xe||this.length,typeof pe=="string"&&(pe=pe.charCodeAt(0)),rt(typeof pe=="number"&&!isNaN(pe),"value is not a number"),rt(be<=Xe,"end < start"),Xe!==be&&this.length!==0){rt(0<=be&&be<this.length,"start out of bounds"),rt(0<=Xe&&Xe<=this.length,"end out of bounds");for(var zt=be;zt<Xe;zt++)this[zt]=pe}},$.prototype.inspect=function(){for(var pe=[],be=this.length,Xe=0;Xe<be;Xe++)if(pe[Xe]=ct(this[Xe]),Xe===c.INSPECT_MAX_BYTES){pe[Xe+1]="...";break}return"<Buffer "+pe.join(" ")+">"},$.prototype.toArrayBuffer=function(){if(typeof Uint8Array>"u")throw new Error("Buffer.toArrayBuffer not supported in this browser");if($._useTypedArrays)return new $(this).buffer;for(var pe=new Uint8Array(this.length),be=0,Xe=pe.length;be<Xe;be+=1)pe[be]=this[be];return pe.buffer};var tt=$.prototype;function St(pe,be,Xe){return typeof pe!="number"?Xe:be<=(pe=~~pe)?be:0<=pe||0<=(pe+=be)?pe:0}function _t(pe){return(pe=~~Math.ceil(+pe))<0?0:pe}function xt(pe){return(Array.isArray||function(be){return Object.prototype.toString.call(be)==="[object Array]"})(pe)}function ct(pe){return pe<16?"0"+pe.toString(16):pe.toString(16)}function Ot(pe){for(var be=[],Xe=0;Xe<pe.length;Xe++){var zt=pe.charCodeAt(Xe);if(zt<=127)be.push(pe.charCodeAt(Xe));else{var Wt=Xe;55296<=zt&&zt<=57343&&Xe++;for(var qt=encodeURIComponent(pe.slice(Wt,Xe+1)).substr(1).split("%"),Cn=0;Cn<qt.length;Cn++)be.push(parseInt(qt[Cn],16))}}return be}function At(pe){return le.toByteArray(pe)}function Pt(pe,be,Xe,zt){for(var Wt=0;Wt<zt&&!(Wt+Xe>=be.length||Wt>=pe.length);Wt++)be[Wt+Xe]=pe[Wt];return Wt}function Ie(pe){try{return decodeURIComponent(pe)}catch{return String.fromCharCode(65533)}}function vt(pe,be){rt(typeof pe=="number","cannot write a non-number as a number"),rt(0<=pe,"specified a negative value for writing an unsigned value"),rt(pe<=be,"value is larger than maximum value for type"),rt(Math.floor(pe)===pe,"value has a fractional component")}function ft(pe,be,Xe){rt(typeof pe=="number","cannot write a non-number as a number"),rt(pe<=be,"value larger than maximum allowed value"),rt(Xe<=pe,"value smaller than minimum allowed value"),rt(Math.floor(pe)===pe,"value has a fractional component")}function jt(pe,be,Xe){rt(typeof pe=="number","cannot write a non-number as a number"),rt(pe<=be,"value larger than maximum allowed value"),rt(Xe<=pe,"value smaller than minimum allowed value")}function rt(pe,be){if(!pe)throw new Error(be||"Failed assertion")}$._augment=function(pe){return pe._isBuffer=!0,pe._get=pe.get,pe._set=pe.set,pe.get=tt.get,pe.set=tt.set,pe.write=tt.write,pe.toString=tt.toString,pe.toLocaleString=tt.toString,pe.toJSON=tt.toJSON,pe.copy=tt.copy,pe.slice=tt.slice,pe.readUInt8=tt.readUInt8,pe.readUInt16LE=tt.readUInt16LE,pe.readUInt16BE=tt.readUInt16BE,pe.readUInt32LE=tt.readUInt32LE,pe.readUInt32BE=tt.readUInt32BE,pe.readInt8=tt.readInt8,pe.readInt16LE=tt.readInt16LE,pe.readInt16BE=tt.readInt16BE,pe.readInt32LE=tt.readInt32LE,pe.readInt32BE=tt.readInt32BE,pe.readFloatLE=tt.readFloatLE,pe.readFloatBE=tt.readFloatBE,pe.readDoubleLE=tt.readDoubleLE,pe.readDoubleBE=tt.readDoubleBE,pe.writeUInt8=tt.writeUInt8,pe.writeUInt16LE=tt.writeUInt16LE,pe.writeUInt16BE=tt.writeUInt16BE,pe.writeUInt32LE=tt.writeUInt32LE,pe.writeUInt32BE=tt.writeUInt32BE,pe.writeInt8=tt.writeInt8,pe.writeInt16LE=tt.writeInt16LE,pe.writeInt16BE=tt.writeInt16BE,pe.writeInt32LE=tt.writeInt32LE,pe.writeInt32BE=tt.writeInt32BE,pe.writeFloatLE=tt.writeFloatLE,pe.writeFloatBE=tt.writeFloatBE,pe.writeDoubleLE=tt.writeDoubleLE,pe.writeDoubleBE=tt.writeDoubleBE,pe.fill=tt.fill,pe.inspect=tt.inspect,pe.toArrayBuffer=tt.toArrayBuffer,pe}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/buffer/index.js","/node_modules/gulp-browserify/node_modules/buffer")},{"base64-js":2,buffer:3,ieee754:11,lYpoI2:10}],4:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){F=A("buffer").Buffer;var le=new F(4);le.fill(0),w.exports={hash:function(me,$,_e,oe){return F.isBuffer(me)||(me=new F(me)),function(ge,Se,je){for(var ye=new F(Se),Ne=je?ye.writeInt32BE:ye.writeInt32LE,Z=0;Z<ge.length;Z++)Ne.call(ye,ge[Z],4*Z,!0);return ye}($(function(ge,Se){var je;ge.length%4!=0&&(je=ge.length+(4-ge.length%4),ge=F.concat([ge,le],je));for(var ye=[],Ne=Se?ge.readInt32BE:ge.readInt32LE,Z=0;Z<ge.length;Z+=4)ye.push(Ne.call(ge,Z));return ye}(me,oe),8*me.length),_e,oe)}}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],5:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){F=A("buffer").Buffer;var le=A("./sha"),me=A("./sha256"),$=A("./rng"),_e={sha1:le,sha256:me,md5:A("./md5")},oe=64,ge=new F(oe);function Se(ye,Ne){var Z=_e[ye=ye||"sha1"],se=[];return Z||je("algorithm:",ye,"is not yet supported"),{update:function(ae){return F.isBuffer(ae)||(ae=new F(ae)),se.push(ae),ae.length,this},digest:function(ae){var Be=F.concat(se),we=Ne?function(tt,St,_t){F.isBuffer(St)||(St=new F(St)),F.isBuffer(_t)||(_t=new F(_t)),St.length>oe?St=tt(St):St.length<oe&&(St=F.concat([St,ge],oe));for(var xt=new F(oe),ct=new F(oe),Ot=0;Ot<oe;Ot++)xt[Ot]=54^St[Ot],ct[Ot]=92^St[Ot];var At=tt(F.concat([xt,_t]));return tt(F.concat([ct,At]))}(Z,Ne,Be):Z(Be);return se=null,ae?we.toString(ae):we}}}function je(){var ye=[].slice.call(arguments).join(" ");throw new Error([ye,"we accept pull requests","http://github.com/dominictarr/crypto-browserify"].join(`
`))}ge.fill(0),c.createHash=function(ye){return Se(ye)},c.createHmac=Se,c.randomBytes=function(ye,Ne){if(!Ne||!Ne.call)return new F($(ye));try{Ne.call(this,void 0,new F($(ye)))}catch(Z){Ne(Z)}},function(ye,Ne){for(var Z in ye)Ne(ye[Z])}(["createCredentials","createCipher","createCipheriv","createDecipher","createDecipheriv","createSign","createVerify","createDiffieHellman","pbkdf2"],function(ye){c[ye]=function(){je("sorry,",ye,"is not implemented yet")}})}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./md5":6,"./rng":7,"./sha":8,"./sha256":9,buffer:3,lYpoI2:10}],6:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){var le=A("./helpers");function me(ye,Ne){ye[Ne>>5]|=128<<Ne%32,ye[14+(Ne+64>>>9<<4)]=Ne;for(var Z=1732584193,se=-271733879,ae=-1732584194,Be=271733878,we=0;we<ye.length;we+=16){var tt=Z,St=se,_t=ae,xt=Be;Z=_e(Z,se,ae,Be,ye[we+0],7,-680876936),Be=_e(Be,Z,se,ae,ye[we+1],12,-389564586),ae=_e(ae,Be,Z,se,ye[we+2],17,606105819),se=_e(se,ae,Be,Z,ye[we+3],22,-1044525330),Z=_e(Z,se,ae,Be,ye[we+4],7,-176418897),Be=_e(Be,Z,se,ae,ye[we+5],12,1200080426),ae=_e(ae,Be,Z,se,ye[we+6],17,-1473231341),se=_e(se,ae,Be,Z,ye[we+7],22,-45705983),Z=_e(Z,se,ae,Be,ye[we+8],7,1770035416),Be=_e(Be,Z,se,ae,ye[we+9],12,-1958414417),ae=_e(ae,Be,Z,se,ye[we+10],17,-42063),se=_e(se,ae,Be,Z,ye[we+11],22,-1990404162),Z=_e(Z,se,ae,Be,ye[we+12],7,1804603682),Be=_e(Be,Z,se,ae,ye[we+13],12,-40341101),ae=_e(ae,Be,Z,se,ye[we+14],17,-1502002290),Z=oe(Z,se=_e(se,ae,Be,Z,ye[we+15],22,1236535329),ae,Be,ye[we+1],5,-165796510),Be=oe(Be,Z,se,ae,ye[we+6],9,-1069501632),ae=oe(ae,Be,Z,se,ye[we+11],14,643717713),se=oe(se,ae,Be,Z,ye[we+0],20,-373897302),Z=oe(Z,se,ae,Be,ye[we+5],5,-701558691),Be=oe(Be,Z,se,ae,ye[we+10],9,38016083),ae=oe(ae,Be,Z,se,ye[we+15],14,-660478335),se=oe(se,ae,Be,Z,ye[we+4],20,-405537848),Z=oe(Z,se,ae,Be,ye[we+9],5,568446438),Be=oe(Be,Z,se,ae,ye[we+14],9,-1019803690),ae=oe(ae,Be,Z,se,ye[we+3],14,-187363961),se=oe(se,ae,Be,Z,ye[we+8],20,1163531501),Z=oe(Z,se,ae,Be,ye[we+13],5,-1444681467),Be=oe(Be,Z,se,ae,ye[we+2],9,-51403784),ae=oe(ae,Be,Z,se,ye[we+7],14,1735328473),Z=ge(Z,se=oe(se,ae,Be,Z,ye[we+12],20,-1926607734),ae,Be,ye[we+5],4,-378558),Be=ge(Be,Z,se,ae,ye[we+8],11,-2022574463),ae=ge(ae,Be,Z,se,ye[we+11],16,1839030562),se=ge(se,ae,Be,Z,ye[we+14],23,-35309556),Z=ge(Z,se,ae,Be,ye[we+1],4,-1530992060),Be=ge(Be,Z,se,ae,ye[we+4],11,1272893353),ae=ge(ae,Be,Z,se,ye[we+7],16,-155497632),se=ge(se,ae,Be,Z,ye[we+10],23,-1094730640),Z=ge(Z,se,ae,Be,ye[we+13],4,681279174),Be=ge(Be,Z,se,ae,ye[we+0],11,-358537222),ae=ge(ae,Be,Z,se,ye[we+3],16,-722521979),se=ge(se,ae,Be,Z,ye[we+6],23,76029189),Z=ge(Z,se,ae,Be,ye[we+9],4,-640364487),Be=ge(Be,Z,se,ae,ye[we+12],11,-421815835),ae=ge(ae,Be,Z,se,ye[we+15],16,530742520),Z=Se(Z,se=ge(se,ae,Be,Z,ye[we+2],23,-995338651),ae,Be,ye[we+0],6,-198630844),Be=Se(Be,Z,se,ae,ye[we+7],10,1126891415),ae=Se(ae,Be,Z,se,ye[we+14],15,-1416354905),se=Se(se,ae,Be,Z,ye[we+5],21,-57434055),Z=Se(Z,se,ae,Be,ye[we+12],6,1700485571),Be=Se(Be,Z,se,ae,ye[we+3],10,-1894986606),ae=Se(ae,Be,Z,se,ye[we+10],15,-1051523),se=Se(se,ae,Be,Z,ye[we+1],21,-2054922799),Z=Se(Z,se,ae,Be,ye[we+8],6,1873313359),Be=Se(Be,Z,se,ae,ye[we+15],10,-30611744),ae=Se(ae,Be,Z,se,ye[we+6],15,-1560198380),se=Se(se,ae,Be,Z,ye[we+13],21,1309151649),Z=Se(Z,se,ae,Be,ye[we+4],6,-145523070),Be=Se(Be,Z,se,ae,ye[we+11],10,-1120210379),ae=Se(ae,Be,Z,se,ye[we+2],15,718787259),se=Se(se,ae,Be,Z,ye[we+9],21,-343485551),Z=je(Z,tt),se=je(se,St),ae=je(ae,_t),Be=je(Be,xt)}return Array(Z,se,ae,Be)}function $(ye,Ne,Z,se,ae,Be){return je((we=je(je(Ne,ye),je(se,Be)))<<(tt=ae)|we>>>32-tt,Z);var we,tt}function _e(ye,Ne,Z,se,ae,Be,we){return $(Ne&Z|~Ne&se,ye,Ne,ae,Be,we)}function oe(ye,Ne,Z,se,ae,Be,we){return $(Ne&se|Z&~se,ye,Ne,ae,Be,we)}function ge(ye,Ne,Z,se,ae,Be,we){return $(Ne^Z^se,ye,Ne,ae,Be,we)}function Se(ye,Ne,Z,se,ae,Be,we){return $(Z^(Ne|~se),ye,Ne,ae,Be,we)}function je(ye,Ne){var Z=(65535&ye)+(65535&Ne);return(ye>>16)+(Ne>>16)+(Z>>16)<<16|65535&Z}w.exports=function(ye){return le.hash(ye,me,16)}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],7:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){var le;le=function(me){for(var $,_e=new Array(me),oe=0;oe<me;oe++)!(3&oe)&&($=4294967296*Math.random()),_e[oe]=$>>>((3&oe)<<3)&255;return _e},w.exports=le}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{buffer:3,lYpoI2:10}],8:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){var le=A("./helpers");function me(oe,ge){oe[ge>>5]|=128<<24-ge%32,oe[15+(ge+64>>9<<4)]=ge;for(var Se,je,ye,Ne,Z,se=Array(80),ae=1732584193,Be=-271733879,we=-1732584194,tt=271733878,St=-1009589776,_t=0;_t<oe.length;_t+=16){for(var xt=ae,ct=Be,Ot=we,At=tt,Pt=St,Ie=0;Ie<80;Ie++){se[Ie]=Ie<16?oe[_t+Ie]:_e(se[Ie-3]^se[Ie-8]^se[Ie-14]^se[Ie-16],1);var vt=$($(_e(ae,5),(ye=Be,Ne=we,Z=tt,(je=Ie)<20?ye&Ne|~ye&Z:!(je<40)&&je<60?ye&Ne|ye&Z|Ne&Z:ye^Ne^Z)),$($(St,se[Ie]),(Se=Ie)<20?1518500249:Se<40?1859775393:Se<60?-1894007588:-899497514));St=tt,tt=we,we=_e(Be,30),Be=ae,ae=vt}ae=$(ae,xt),Be=$(Be,ct),we=$(we,Ot),tt=$(tt,At),St=$(St,Pt)}return Array(ae,Be,we,tt,St)}function $(oe,ge){var Se=(65535&oe)+(65535&ge);return(oe>>16)+(ge>>16)+(Se>>16)<<16|65535&Se}function _e(oe,ge){return oe<<ge|oe>>>32-ge}w.exports=function(oe){return le.hash(oe,me,20,!0)}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],9:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){function le(oe,ge){var Se=(65535&oe)+(65535&ge);return(oe>>16)+(ge>>16)+(Se>>16)<<16|65535&Se}function me(oe,ge){return oe>>>ge|oe<<32-ge}function $(oe,ge){var Se,je,ye,Ne,Z,se,ae,Be,we,tt,St=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),_t=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),xt=new Array(64);oe[ge>>5]|=128<<24-ge%32,oe[15+(ge+64>>9<<4)]=ge;for(var ct,Ot,At,Pt,Ie,vt,ft,jt,rt=0;rt<oe.length;rt+=16){Se=_t[0],je=_t[1],ye=_t[2],Ne=_t[3],Z=_t[4],se=_t[5],ae=_t[6],Be=_t[7];for(var pe=0;pe<64;pe++)xt[pe]=pe<16?oe[pe+rt]:le(le(le(me(jt=xt[pe-2],17)^me(jt,19)^jt>>>10,xt[pe-7]),me(ft=xt[pe-15],7)^me(ft,18)^ft>>>3),xt[pe-16]),we=le(le(le(le(Be,me(vt=Z,6)^me(vt,11)^me(vt,25)),(Ie=Z)&se^~Ie&ae),St[pe]),xt[pe]),tt=le(me(Pt=Se,2)^me(Pt,13)^me(Pt,22),(ct=Se)&(Ot=je)^ct&(At=ye)^Ot&At),Be=ae,ae=se,se=Z,Z=le(Ne,we),Ne=ye,ye=je,je=Se,Se=le(we,tt);_t[0]=le(Se,_t[0]),_t[1]=le(je,_t[1]),_t[2]=le(ye,_t[2]),_t[3]=le(Ne,_t[3]),_t[4]=le(Z,_t[4]),_t[5]=le(se,_t[5]),_t[6]=le(ae,_t[6]),_t[7]=le(Be,_t[7])}return _t}var _e=A("./helpers");w.exports=function(oe){return _e.hash(oe,$,32,!0)}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js","/node_modules/gulp-browserify/node_modules/crypto-browserify")},{"./helpers":4,buffer:3,lYpoI2:10}],10:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){function le(){}(C=w.exports={}).nextTick=function(){var me=typeof window<"u"&&window.setImmediate,$=typeof window<"u"&&window.postMessage&&window.addEventListener;if(me)return function(oe){return window.setImmediate(oe)};if($){var _e=[];return window.addEventListener("message",function(oe){var ge=oe.source;ge!==window&&ge!==null||oe.data!=="process-tick"||(oe.stopPropagation(),0<_e.length&&_e.shift()())},!0),function(oe){_e.push(oe),window.postMessage("process-tick","*")}}return function(oe){setTimeout(oe,0)}}(),C.title="browser",C.browser=!0,C.env={},C.argv=[],C.on=le,C.addListener=le,C.once=le,C.off=le,C.removeListener=le,C.removeAllListeners=le,C.emit=le,C.binding=function(me){throw new Error("process.binding is not supported")},C.cwd=function(){return"/"},C.chdir=function(me){throw new Error("process.chdir is not supported")}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/gulp-browserify/node_modules/process/browser.js","/node_modules/gulp-browserify/node_modules/process")},{buffer:3,lYpoI2:10}],11:[function(A,w,c){(function(C,O,F,G,X,te,ue,fe,de){c.read=function(le,me,$,_e,oe){var ge,Se,je=8*oe-_e-1,ye=(1<<je)-1,Ne=ye>>1,Z=-7,se=$?oe-1:0,ae=$?-1:1,Be=le[me+se];for(se+=ae,ge=Be&(1<<-Z)-1,Be>>=-Z,Z+=je;0<Z;ge=256*ge+le[me+se],se+=ae,Z-=8);for(Se=ge&(1<<-Z)-1,ge>>=-Z,Z+=_e;0<Z;Se=256*Se+le[me+se],se+=ae,Z-=8);if(ge===0)ge=1-Ne;else{if(ge===ye)return Se?NaN:1/0*(Be?-1:1);Se+=Math.pow(2,_e),ge-=Ne}return(Be?-1:1)*Se*Math.pow(2,ge-_e)},c.write=function(le,me,$,_e,oe,ge){var Se,je,ye,Ne=8*ge-oe-1,Z=(1<<Ne)-1,se=Z>>1,ae=oe===23?Math.pow(2,-24)-Math.pow(2,-77):0,Be=_e?0:ge-1,we=_e?1:-1,tt=me<0||me===0&&1/me<0?1:0;for(me=Math.abs(me),isNaN(me)||me===1/0?(je=isNaN(me)?1:0,Se=Z):(Se=Math.floor(Math.log(me)/Math.LN2),me*(ye=Math.pow(2,-Se))<1&&(Se--,ye*=2),2<=(me+=1<=Se+se?ae/ye:ae*Math.pow(2,1-se))*ye&&(Se++,ye/=2),Z<=Se+se?(je=0,Se=Z):1<=Se+se?(je=(me*ye-1)*Math.pow(2,oe),Se+=se):(je=me*Math.pow(2,se-1)*Math.pow(2,oe),Se=0));8<=oe;le[$+Be]=255&je,Be+=we,je/=256,oe-=8);for(Se=Se<<oe|je,Ne+=oe;0<Ne;le[$+Be]=255&Se,Be+=we,Se/=256,Ne-=8);le[$+Be-we]|=128*tt}}).call(this,A("lYpoI2"),typeof self<"u"?self:typeof window<"u"?window:{},A("buffer").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],"/node_modules/ieee754/index.js","/node_modules/ieee754")},{buffer:3,lYpoI2:10}]},{},[1])(1)},654:function(K){var A=function(){function w($){return ue($,fe(te(de($.length),$),1/$.length))}function c($){return te(le($),$)}function C($,_e){return fe($,_e?1/($.length-1):1/$.length)}function O($){var _e=function(ge){var Se,je=Math.pow(2,-52),ye=1e-64/je,Ne=0,Z=0,se=0,ae=0,Be=0,we=me(ge),tt=we.length,St=we[0].length;if(tt<St)throw"Need more rows than columns";var _t=new Array(St),xt=new Array(St);for(Z=0;Z<St;Z++)_t[Z]=xt[Z]=0;var ct=function zt(Wt,qt,Cn){Cn===void 0&&(Cn=0);var vn,Zn=Wt[Cn],Xn=Array(Zn);if(Cn===Wt.length-1){for(vn=Zn-2;vn>=0;vn-=2)Xn[vn+1]=qt,Xn[vn]=qt;return vn===-1&&(Xn[0]=qt),Xn}for(vn=Zn-1;vn>=0;vn--)Xn[vn]=zt(Wt,qt,Cn+1);return Xn}([St,St],0);function Ot(zt,Wt){return(zt=Math.abs(zt))>(Wt=Math.abs(Wt))?zt*Math.sqrt(1+Wt*Wt/zt/zt):Wt==0?zt:Wt*Math.sqrt(1+zt*zt/Wt/Wt)}var At=0,Pt=0,Ie=0,vt=0,ft=0,jt=0,rt=0;for(Z=0;Z<St;Z++){for(_t[Z]=Pt,rt=0,Be=Z+1,se=Z;se<tt;se++)rt+=we[se][Z]*we[se][Z];if(rt<=ye)Pt=0;else for(At=we[Z][Z],Pt=Math.sqrt(rt),At>=0&&(Pt=-Pt),Ie=At*Pt-rt,we[Z][Z]=At-Pt,se=Be;se<St;se++){for(rt=0,ae=Z;ae<tt;ae++)rt+=we[ae][Z]*we[ae][se];for(At=rt/Ie,ae=Z;ae<tt;ae++)we[ae][se]+=At*we[ae][Z]}for(xt[Z]=Pt,rt=0,se=Be;se<St;se++)rt+=we[Z][se]*we[Z][se];if(rt<=ye)Pt=0;else{for(At=we[Z][Z+1],Pt=Math.sqrt(rt),At>=0&&(Pt=-Pt),Ie=At*Pt-rt,we[Z][Z+1]=At-Pt,se=Be;se<St;se++)_t[se]=we[Z][se]/Ie;for(se=Be;se<tt;se++){for(rt=0,ae=Be;ae<St;ae++)rt+=we[se][ae]*we[Z][ae];for(ae=Be;ae<St;ae++)we[se][ae]+=rt*_t[ae]}}(ft=Math.abs(xt[Z])+Math.abs(_t[Z]))>vt&&(vt=ft)}for(Z=St-1;Z!=-1;Z+=-1){if(Pt!=0){for(Ie=Pt*we[Z][Z+1],se=Be;se<St;se++)ct[se][Z]=we[Z][se]/Ie;for(se=Be;se<St;se++){for(rt=0,ae=Be;ae<St;ae++)rt+=we[Z][ae]*ct[ae][se];for(ae=Be;ae<St;ae++)ct[ae][se]+=rt*ct[ae][Z]}}for(se=Be;se<St;se++)ct[Z][se]=0,ct[se][Z]=0;ct[Z][Z]=1,Pt=_t[Z],Be=Z}for(Z=St-1;Z!=-1;Z+=-1){for(Be=Z+1,Pt=xt[Z],se=Be;se<St;se++)we[Z][se]=0;if(Pt!=0){for(Ie=we[Z][Z]*Pt,se=Be;se<St;se++){for(rt=0,ae=Be;ae<tt;ae++)rt+=we[ae][Z]*we[ae][se];for(At=rt/Ie,ae=Z;ae<tt;ae++)we[ae][se]+=At*we[ae][Z]}for(se=Z;se<tt;se++)we[se][Z]=we[se][Z]/Pt}else for(se=Z;se<tt;se++)we[se][Z]=0;we[Z][Z]+=1}for(je*=vt,ae=St-1;ae!=-1;ae+=-1)for(var pe=0;pe<50;pe++){var be=!1;for(Be=ae;Be!=-1;Be+=-1){if(Math.abs(_t[Be])<=je){be=!0;break}if(Math.abs(xt[Be-1])<=je)break}if(!be){Ne=0,rt=1;var Xe=Be-1;for(Z=Be;Z<ae+1&&(At=rt*_t[Z],_t[Z]=Ne*_t[Z],!(Math.abs(At)<=je));Z++)for(Ie=Ot(At,Pt=xt[Z]),xt[Z]=Ie,Ne=Pt/Ie,rt=-At/Ie,se=0;se<tt;se++)ft=we[se][Xe],jt=we[se][Z],we[se][Xe]=ft*Ne+jt*rt,we[se][Z]=-ft*rt+jt*Ne}if(jt=xt[ae],Be==ae){if(jt<0)for(xt[ae]=-jt,se=0;se<St;se++)ct[se][ae]=-ct[se][ae];break}if(pe>=49)throw"Error: no convergence.";for(vt=xt[Be],Pt=Ot(At=(((ft=xt[ae-1])-jt)*(ft+jt)+((Pt=_t[ae-1])-(Ie=_t[ae]))*(Pt+Ie))/(2*Ie*ft),1),At=At<0?((vt-jt)*(vt+jt)+Ie*(ft/(At-Pt)-Ie))/vt:((vt-jt)*(vt+jt)+Ie*(ft/(At+Pt)-Ie))/vt,Ne=1,rt=1,Z=Be+1;Z<ae+1;Z++){for(Pt=_t[Z],ft=xt[Z],Ie=rt*Pt,Pt*=Ne,jt=Ot(At,Ie),_t[Z-1]=jt,At=vt*(Ne=At/jt)+Pt*(rt=Ie/jt),Pt=-vt*rt+Pt*Ne,Ie=ft*rt,ft*=Ne,se=0;se<St;se++)vt=ct[se][Z-1],jt=ct[se][Z],ct[se][Z-1]=vt*Ne+jt*rt,ct[se][Z]=-vt*rt+jt*Ne;for(jt=Ot(At,Ie),xt[Z-1]=jt,At=(Ne=At/jt)*Pt+(rt=Ie/jt)*ft,vt=-rt*Pt+Ne*ft,se=0;se<tt;se++)ft=we[se][Z-1],jt=we[se][Z],we[se][Z-1]=ft*Ne+jt*rt,we[se][Z]=-ft*rt+jt*Ne}_t[Be]=0,_t[ae]=At,xt[ae]=vt}for(Z=0;Z<xt.length;Z++)xt[Z]<je&&(xt[Z]=0);for(Z=0;Z<St;Z++)for(se=Z-1;se>=0;se--)if(xt[se]<xt[Z]){for(Ne=xt[se],xt[se]=xt[Z],xt[Z]=Ne,ae=0;ae<we.length;ae++)Se=we[ae][Z],we[ae][Z]=we[ae][se],we[ae][se]=Se;for(ae=0;ae<ct.length;ae++)Se=ct[ae][Z],ct[ae][Z]=ct[ae][se],ct[ae][se]=Se;Z=se}return{U:we,S:xt,V:ct}}($);console.log(_e);var oe=_e.U;return _e.S.map(function(ge,Se){var je={};return je.eigenvalue=ge,je.vector=oe.map(function(ye,Ne){return-1*ye[Se]}),je})}function F($,..._e){var oe=_e.map(function(je){return je.vector}),ge=te(oe,le(w($))),Se=fe(te(de($.length),$),-1/$.length);return{adjustedData:ge,formattedAdjustedData:X(ge,2),avgData:Se,selectedVectors:oe}}function G($){return O(C(c(w($)),!1))}function X($,_e){var oe=Math.pow(10,_e||2);return $.map(function(ge,Se){return ge.map(function(je){return Math.round(je*oe)/oe})})}function te($,_e){if(!($[0]&&_e[0]&&$.length&&_e.length))throw new Error("Both A and B should be matrices");if(_e.length!==$[0].length)throw new Error("Columns in A should be the same as the number of rows in B");for(var oe=[],ge=0;ge<$.length;ge++){oe[ge]=[];for(var Se=0;Se<_e[0].length;Se++)for(var je=0;je<$[0].length;je++)oe[ge][Se]=oe[ge][Se]?oe[ge][Se]+$[ge][je]*_e[je][Se]:$[ge][je]*_e[je][Se]}return oe}function ue($,_e){if($.length!==_e.length||$[0].length!==_e[0].length)throw new Error("Both A and B should have the same dimensions");for(var oe=[],ge=0;ge<$.length;ge++){oe[ge]=[];for(var Se=0;Se<_e[0].length;Se++)oe[ge][Se]=$[ge][Se]-_e[ge][Se]}return oe}function fe($,_e){for(var oe=[],ge=0;ge<$.length;ge++){oe[ge]=[];for(var Se=0;Se<$[0].length;Se++)oe[ge][Se]=$[ge][Se]*_e}return oe}function de($){for(var _e=[],oe=0;oe<$;oe++){_e[oe]=[];for(var ge=0;ge<$;ge++)_e[oe][ge]=1}return _e}function le($){return me($)[0].map(function(_e,oe){return $.map(function(ge){return ge[oe]})})}function me($){var _e=JSON.stringify($);return JSON.parse(_e)}return{computeDeviationScores:c,computeDeviationMatrix:w,computeSVD:O,computePercentageExplained:function($,..._e){var oe=$.map(function(ge){return ge.eigenvalue}).reduce(function(ge,Se){return ge+Se});return _e.map(function(ge){return ge.eigenvalue}).reduce(function(ge,Se){return ge+Se})/oe},computeOriginalData:function($,_e,oe){var ge=ue(le(te(le(_e),$)),oe);return{originalData:ge,formattedOriginalData:X(ge,2)}},computeVarianceCovariance:C,computeAdjustedData:F,getEigenVectors:G,analyseTopResult:function($){var _e=G($).sort(function(oe,ge){return ge.eigenvalue-oe.eigenvalue});return console.log("Sorted Vectors",_e),F($,_e[0].vector)},transpose:le,multiply:te,clone:me,scale:fe}}();K.exports=A},701:function(K){var A=[];function w(O){for(var F=-1,G=0;G<A.length;G++)if(A[G].identifier===O){F=G;break}return F}function c(O,F){for(var G={},X=[],te=0;te<O.length;te++){var ue=O[te],fe=F.base?ue[0]+F.base:ue[0],de=G[fe]||0,le="".concat(fe," ").concat(de);G[fe]=de+1;var me=w(le),$={css:ue[1],media:ue[2],sourceMap:ue[3],supports:ue[4],layer:ue[5]};if(me!==-1)A[me].references++,A[me].updater($);else{var _e=C($,F);F.byIndex=te,A.splice(te,0,{identifier:le,updater:_e,references:1})}X.push(le)}return X}function C(O,F){var G=F.domAPI(F);return G.update(O),function(X){if(X){if(X.css===O.css&&X.media===O.media&&X.sourceMap===O.sourceMap&&X.supports===O.supports&&X.layer===O.layer)return;G.update(O=X)}else G.remove()}}K.exports=function(O,F){var G=c(O=O||[],F=F||{});return function(X){X=X||[];for(var te=0;te<G.length;te++){var ue=w(G[te]);A[ue].references--}for(var fe=c(X,F),de=0;de<G.length;de++){var le=w(G[de]);A[le].references===0&&(A[le].updater(),A.splice(le,1))}G=fe}}},182:function(K){K.exports=function(A){var w=document.createElement("style");return A.setAttributes(w,A.attributes),A.insert(w,A.options),w}},850:function(K,A,w){K.exports=function(c){var C=w.nc;C&&c.setAttribute("nonce",C)}},236:function(K){K.exports=function(A){var w=A.insertStyleElement(A);return{update:function(c){(function(C,O,F){var G="";F.supports&&(G+="@supports (".concat(F.supports,") {")),F.media&&(G+="@media ".concat(F.media," {"));var X=F.layer!==void 0;X&&(G+="@layer".concat(F.layer.length>0?" ".concat(F.layer):""," {")),G+=F.css,X&&(G+="}"),F.media&&(G+="}"),F.supports&&(G+="}");var te=F.sourceMap;te&&typeof btoa<"u"&&(G+=`
/`,G+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(te))))," *"),G+="/"),O.styleTagTransform(G,C,O.options)})(w,A,c)},remove:function(){(function(c){if(c.parentNode===null)return!1;c.parentNode.removeChild(c)})(w)}}}},213:function(K){K.exports=function(A,w){if(w.styleSheet)w.styleSheet.cssText=A;else{for(;w.firstChild;)w.removeChild(w.firstChild);w.appendChild(document.createTextNode(A))}}},1:function(K){K.exports=function(){var A={820:function(O,F,G){var X=G(537),te=G.n(X),ue=G(645),fe=G.n(ue)()(te());fe.push([O.id,`.treejs {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.treejs *:after,
.treejs *:before {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.treejs > .treejs-node {
  padding-left: 0;
}
.treejs .treejs-nodes {
  list-style: none;
  padding-left: 18px;
  margin: 0;
  overflow: hidden;
  -webkit-transition: height 150ms ease-out, opacity 150ms ease-out;
  -o-transition: height 150ms ease-out, opacity 150ms ease-out;
  transition: height 150ms ease-out, opacity 150ms ease-out;
}
.treejs .treejs-node {
  cursor: pointer;
  overflow: hidden;
}
.treejs .treejs-node.treejs-placeholder {
  padding-left: 18px;
}
.treejs .treejs-switcher {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
  -webkit-transition: -webkit-transform 150ms ease-out;
  transition: -webkit-transform 150ms ease-out;
  -o-transition: transform 150ms ease-out;
  transition: transform 150ms ease-out;
  transition: transform 150ms ease-out, -webkit-transform 150ms ease-out;
}
.treejs .treejs-switcher:before {
  position: absolute;
  top: 8px;
  left: 6px;
  display: block;
  content: ' ';
  border: 4px solid transparent;
  border-top: 4px solid rgba(245, 245, 245, 0.7);
  -webkit-transition: border-color 150ms;
  -o-transition: border-color 150ms;
  transition: border-color 150ms;
}
.treejs .treejs-switcher:hover:before {
  border-top: 4px solid rgba(245, 245, 245, 0.96);
}
.treejs .treejs-node__close > .treejs-switcher {
  -webkit-transform: rotate(-90deg);
      -ms-transform: rotate(-90deg);
          transform: rotate(-90deg);
}
.treejs .treejs-node__close > .treejs-nodes {
  height: 0;
}
.treejs .treejs-checkbox {
  display: inline-block;
  vertical-align: middle;
  width: 20px;
  height: 20px;
  cursor: pointer;
  position: relative;
}
.treejs .treejs-checkbox:before {
  -webkit-transition: all 0.3s;
  -o-transition: all 0.3s;
  transition: all 0.3s;
  cursor: pointer;
  position: absolute;
  top: 2px;
  content: ' ';
  display: block;
  width: 16px;
  height: 16px;
  border: 1px solid #d9d9d9;
  border-radius: 2px;
}
.treejs .treejs-checkbox:hover:before {
  -webkit-box-shadow: 0 0 2px 1px #1890ff;
          box-shadow: 0 0 2px 1px #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__checked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 4px;
  left: 5px;
  width: 5px;
  height: 9px;
  border: 2px solid #fff;
  border-top: none;
  border-left: none;
  -webkit-transform: rotate(45deg);
      -ms-transform: rotate(45deg);
          transform: rotate(45deg);
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:before {
  background-color: #1890ff;
  border-color: #1890ff;
}
.treejs .treejs-node__halfchecked > .treejs-checkbox:after {
  position: absolute;
  content: ' ';
  display: block;
  top: 9px;
  left: 3px;
  width: 10px;
  height: 2px;
  background-color: #fff;
}
.treejs .treejs-node__disabled {
  cursor: not-allowed;
  color: rgba(255, 255, 255, 0.25);
}
.treejs .treejs-node__disabled .treejs-checkbox {
  cursor: not-allowed;
}
.treejs .treejs-node__disabled .treejs-checkbox:before {
  cursor: not-allowed;
  border-color: #d9d9d9 !important;
  background-color: #f5f5f5 !important;
}
.treejs .treejs-node__disabled .treejs-checkbox:hover:before {
  -webkit-box-shadow: none !important;
          box-shadow: none !important;
}
.treejs .treejs-node__disabled .treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled .treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__checked > .treejs-checkbox:after {
  border-color: #d9d9d9;
}
.treejs .treejs-node__disabled.treejs-node__halfchecked > .treejs-checkbox:after {
  background-color: #d9d9d9;
}
.treejs .treejs-label {
  vertical-align: middle;
}
`,"",{version:3,sources:["webpack://./src/index.less"],names:[],mappings:"AAKA;EACE,8BAAA;UAAA,sBAAA;EACA,eAAA;EACA,kBAAA;EACA,yBAAA;KAAA,sBAAA;MAAA,qBAAA;UAAA,iBAAA;AAJF;AAAA;;EAQI,8BAAA;UAAA,sBAAA;AAJJ;AAOE;EACE,eAAA;AALJ;AAPA;EAgBI,gBAAA;EACA,kBAAA;EACA,SAAA;EACA,gBAAA;EACA,iEAAA;EAAA,4DAAA;EAAA,yDAAA;AANJ;AAdA;EAwBI,eAAA;EACA,gBAAA;AAPJ;AASI;EACE,kBAAA;AAPN;AArBA;EAiCI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;EACA,oDAAA;EAAA,4CAAA;EAAA,uCAAA;EAAA,oCAAA;EAAA,sEAAA;AATJ;AAWI;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,cAAA;EACA,YAAA;EACA,6BAAA;EACA,8CAAA;EACA,sCAAA;EAAA,iCAAA;EAAA,8BAAA;AATN;AAWI;EACE,+CAAA;AATN;AA3CA;EAwDI,iCAAA;MAAA,6BAAA;UAAA,yBAAA;AAVJ;AA9CA;EA2DI,SAAA;AAVJ;AAjDA;EA+DI,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,YAAA;EACA,eAAA;EACA,kBAAA;AAXJ;AAaI;EACE,4BAAA;EAAA,uBAAA;EAAA,oBAAA;EACA,eAAA;EACA,kBAAA;EACA,QAAA;EACA,YAAA;EACA,cAAA;EACA,WAAA;EACA,YAAA;EACA,yBAAA;EACA,kBAAA;AAXN;AAaI;EACE,uCAAA;UAAA,+BAAA;AAXN;AAgBM;EACE,yBAAA;EACA,qBAAA;AAdR;AAgBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,UAAA;EACA,WAAA;EACA,sBAAA;EACA,gBAAA;EACA,iBAAA;EACA,gCAAA;MAAA,4BAAA;UAAA,wBAAA;AAdR;AAoBM;EACE,yBAAA;EACA,qBAAA;AAlBR;AAoBM;EACE,kBAAA;EACA,YAAA;EACA,cAAA;EACA,QAAA;EACA,SAAA;EACA,WAAA;EACA,WAAA;EACA,sBAAA;AAlBR;AAvGA;EA+HI,mBAAA;EACA,gCAAA;AArBJ;AA3GA;EAkIM,mBAAA;AApBN;AAqBM;EACE,mBAAA;EACA,gCAAA;EACA,oCAAA;AAnBR;AAqBM;EACE,mCAAA;UAAA,2BAAA;AAnBR;AAwBQ;EACE,qBAAA;AAtBV;AA4BQ;EACE,yBAAA;AA1BV;AAiCM;EACE,qBAAA;AA/BR;AAqCM;EACE,yBAAA;AAnCR;AAlIA;EA2KI,sBAAA;AAtCJ",sourcesContent:[`@color-disable: #d4d4d4;
@bgcolor-disable: #f5f5f5;
@greyborder: #d9d9d9;
@bluebg: #1890ff;

.treejs {
  box-sizing: border-box;
  font-size: 14px;
  margin-left: -18px;
  user-select: none;

  *:after,
  *:before {
    box-sizing: border-box;
  }

  & > .treejs-node {
    padding-left: 0;
  }

  .treejs-nodes {
    list-style: none;
    padding-left: 18px;
    margin: 0; //  for default ul...
    overflow: hidden;
    transition: height 150ms ease-out, opacity 150ms ease-out;
  }

  .treejs-node {
    cursor: pointer;
    overflow: hidden;

    &.treejs-placeholder {
      padding-left: 18px;
    }
  }

  .treejs-switcher {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;
    transition: transform 150ms ease-out;

    &:before {
      position: absolute;
      top: 8px;
      left: 6px;
      display: block;
      content: ' ';
      border: 4px solid transparent;
      border-top: 4px solid rgba(245, 245, 245, 0.7);
      transition: border-color 150ms;
    }
    &:hover:before {
      border-top: 4px solid rgba(245, 245, 245, 0.96);
    }
  }
  .treejs-node__close > .treejs-switcher {
    transform: rotate(-90deg);
  }
  .treejs-node__close > .treejs-nodes {
    height: 0;
  }

  .treejs-checkbox {
    display: inline-block;
    vertical-align: middle;
    width: 20px;
    height: 20px;
    cursor: pointer;
    position: relative;

    &:before {
      transition: all 0.3s;
      cursor: pointer;
      position: absolute;
      top: 2px;
      content: ' ';
      display: block;
      width: 16px;
      height: 16px;
      border: 1px solid @greyborder;
      border-radius: 2px;
    }
    &:hover:before {
      box-shadow: 0 0 2px 1px @bluebg;
    }
  }
  .treejs-node__checked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 4px;
        left: 5px;
        width: 5px;
        height: 9px;
        border: 2px solid #fff;
        border-top: none;
        border-left: none;
        transform: rotate(45deg);
      }
    }
  }
  .treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:before {
        background-color: @bluebg;
        border-color: @bluebg;
      }
      &:after {
        position: absolute;
        content: ' ';
        display: block;
        top: 9px;
        left: 3px;
        width: 10px;
        height: 2px;
        background-color: #fff;
      }
    }
  }

  .treejs-node__disabled {
    cursor: not-allowed;
    color: rgba(255, 255, 255, 0.25);
    .treejs-checkbox {
      cursor: not-allowed;
      &:before {
        cursor: not-allowed;
        border-color: @greyborder !important;
        background-color: @bgcolor-disable !important;
      }
      &:hover:before {
        box-shadow: none !important;
      }
    }
    .treejs-node__checked {
      & > .treejs-checkbox {
        &:after {
          border-color: @greyborder;
        }
      }
    }
    .treejs-node__halfchecked {
      & > .treejs-checkbox {
        &:after {
          background-color: @greyborder;
        }
      }
    }
  }
  .treejs-node__disabled.treejs-node__checked {
    & > .treejs-checkbox {
      &:after {
        border-color: @greyborder;
      }
    }
  }
  .treejs-node__disabled.treejs-node__halfchecked {
    & > .treejs-checkbox {
      &:after {
        background-color: @greyborder;
      }
    }
  }

  .treejs-label {
    vertical-align: middle;
  }
}
`],sourceRoot:""}]),F.Z=fe},645:function(O){O.exports=function(F){var G=[];return G.toString=function(){return this.map(function(X){var te="",ue=X[5]!==void 0;return X[4]&&(te+="@supports (".concat(X[4],") {")),X[2]&&(te+="@media ".concat(X[2]," {")),ue&&(te+="@layer".concat(X[5].length>0?" ".concat(X[5]):""," {")),te+=F(X),ue&&(te+="}"),X[2]&&(te+="}"),X[4]&&(te+="}"),te}).join("")},G.i=function(X,te,ue,fe,de){typeof X=="string"&&(X=[[null,X,void 0]]);var le={};if(ue)for(var me=0;me<this.length;me++){var $=this[me][0];$!=null&&(le[$]=!0)}for(var _e=0;_e<X.length;_e++){var oe=[].concat(X[_e]);ue&&le[oe[0]]||(de!==void 0&&(oe[5]===void 0||(oe[1]="@layer".concat(oe[5].length>0?" ".concat(oe[5]):""," {").concat(oe[1],"}")),oe[5]=de),te&&(oe[2]&&(oe[1]="@media ".concat(oe[2]," {").concat(oe[1],"}")),oe[2]=te),fe&&(oe[4]?(oe[1]="@supports (".concat(oe[4],") {").concat(oe[1],"}"),oe[4]=fe):oe[4]="".concat(fe)),G.push(oe))}},G}},537:function(O){O.exports=function(F){var G=F[1],X=F[3];if(!X)return G;if(typeof btoa=="function"){var te=btoa(unescape(encodeURIComponent(JSON.stringify(X)))),ue="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(te),fe="/*# ".concat(ue," */"),de=X.sources.map(function(le){return"/*# sourceURL=".concat(X.sourceRoot||"").concat(le," */")});return[G].concat(de).concat([fe]).join(`
`)}return[G].join(`
`)}},379:function(O){var F=[];function G(ue){for(var fe=-1,de=0;de<F.length;de++)if(F[de].identifier===ue){fe=de;break}return fe}function X(ue,fe){for(var de={},le=[],me=0;me<ue.length;me++){var $=ue[me],_e=fe.base?$[0]+fe.base:$[0],oe=de[_e]||0,ge="".concat(_e," ").concat(oe);de[_e]=oe+1;var Se=G(ge),je={css:$[1],media:$[2],sourceMap:$[3],supports:$[4],layer:$[5]};if(Se!==-1)F[Se].references++,F[Se].updater(je);else{var ye=te(je,fe);fe.byIndex=me,F.splice(me,0,{identifier:ge,updater:ye,references:1})}le.push(ge)}return le}function te(ue,fe){var de=fe.domAPI(fe);return de.update(ue),function(le){if(le){if(le.css===ue.css&&le.media===ue.media&&le.sourceMap===ue.sourceMap&&le.supports===ue.supports&&le.layer===ue.layer)return;de.update(ue=le)}else de.remove()}}O.exports=function(ue,fe){var de=X(ue=ue||[],fe=fe||{});return function(le){le=le||[];for(var me=0;me<de.length;me++){var $=G(de[me]);F[$].references--}for(var _e=X(le,fe),oe=0;oe<de.length;oe++){var ge=G(de[oe]);F[ge].references===0&&(F[ge].updater(),F.splice(ge,1))}de=_e}}},216:function(O){O.exports=function(F){var G=document.createElement("style");return F.setAttributes(G,F.attributes),F.insert(G,F.options),G}},636:function(O,F,G){O.exports=function(X){var te=G.nc;te&&X.setAttribute("nonce",te)}},795:function(O){O.exports=function(F){var G=F.insertStyleElement(F);return{update:function(X){(function(te,ue,fe){var de="";fe.supports&&(de+="@supports (".concat(fe.supports,") {")),fe.media&&(de+="@media ".concat(fe.media," {"));var le=fe.layer!==void 0;le&&(de+="@layer".concat(fe.layer.length>0?" ".concat(fe.layer):""," {")),de+=fe.css,le&&(de+="}"),fe.media&&(de+="}"),fe.supports&&(de+="}");var me=fe.sourceMap;me&&typeof btoa<"u"&&(de+=`
/`,de+="*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(me))))," *"),de+="/"),ue.styleTagTransform(de,te,ue.options)})(G,F,X)},remove:function(){(function(X){if(X.parentNode===null)return!1;X.parentNode.removeChild(X)})(G)}}}},589:function(O){O.exports=function(F,G){if(G.styleSheet)G.styleSheet.cssText=F;else{for(;G.firstChild;)G.removeChild(G.firstChild);G.appendChild(document.createTextNode(F))}}}},w={};function c(O){var F=w[O];if(F!==void 0)return F.exports;var G=w[O]={id:O,exports:{}};return A[O](G,G.exports,c),G.exports}c.n=function(O){var F=O&&O.__esModule?function(){return O.default}:function(){return O};return c.d(F,{a:F}),F},c.d=function(O,F){for(var G in F)c.o(F,G)&&!c.o(O,G)&&Object.defineProperty(O,G,{enumerable:!0,get:F[G]})},c.o=function(O,F){return Object.prototype.hasOwnProperty.call(O,F)},c.nc=void 0;var C={};return function(){c.d(C,{default:function(){return xt}});var O=c(379),F=c.n(O),G=c(795),X=c.n(G),te=c(636),ue=c.n(te),fe=c(216),de=c.n(fe),le=c(589),me=c.n(le),$=c(820),_e={};$.Z&&$.Z.locals&&(_e.locals=$.Z.locals);var oe,ge=0,Se={};Se.styleTagTransform=me(),Se.setAttributes=ue(),Se.insert=function(ct,Ot){(Ot.target||document.head).appendChild(ct)},Se.domAPI=X(),Se.insertStyleElement=de(),_e.use=function(ct){return Se.options=ct||{},ge++||(oe=F()($.Z,Se)),_e},_e.unuse=function(){ge>0&&!--ge&&(oe(),oe=null)};var je=_e;function ye(ct,Ot){return function(At){if(Array.isArray(At))return At}(ct)||function(At,Pt){var Ie=At==null?null:typeof Symbol<"u"&&At[Symbol.iterator]||At["@@iterator"];if(Ie!=null){var vt,ft,jt=[],rt=!0,pe=!1;try{for(Ie=Ie.call(At);!(rt=(vt=Ie.next()).done)&&(jt.push(vt.value),!Pt||jt.length!==Pt);rt=!0);}catch(be){pe=!0,ft=be}finally{try{rt||Ie.return==null||Ie.return()}finally{if(pe)throw ft}}return jt}}(ct,Ot)||function(At,Pt){if(At){if(typeof At=="string")return Ne(At,Pt);var Ie=Object.prototype.toString.call(At).slice(8,-1);return Ie==="Object"&&At.constructor&&(Ie=At.constructor.name),Ie==="Map"||Ie==="Set"?Array.from(At):Ie==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(Ie)?Ne(At,Pt):void 0}}(ct,Ot)||function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Ne(ct,Ot){(Ot==null||Ot>ct.length)&&(Ot=ct.length);for(var At=0,Pt=new Array(Ot);At<Ot;At++)Pt[At]=ct[At];return Pt}function Z(ct,Ot){var At=Object.keys(ct);if(Object.getOwnPropertySymbols){var Pt=Object.getOwnPropertySymbols(ct);Ot&&(Pt=Pt.filter(function(Ie){return Object.getOwnPropertyDescriptor(ct,Ie).enumerable})),At.push.apply(At,Pt)}return At}function se(ct){for(var Ot=1;Ot<arguments.length;Ot++){var At=arguments[Ot]!=null?arguments[Ot]:{};Ot%2?Z(Object(At),!0).forEach(function(Pt){ae(ct,Pt,At[Pt])}):Object.getOwnPropertyDescriptors?Object.defineProperties(ct,Object.getOwnPropertyDescriptors(At)):Z(Object(At)).forEach(function(Pt){Object.defineProperty(ct,Pt,Object.getOwnPropertyDescriptor(At,Pt))})}return ct}function ae(ct,Ot,At){return Ot in ct?Object.defineProperty(ct,Ot,{value:At,enumerable:!0,configurable:!0,writable:!0}):ct[Ot]=At,ct}function Be(ct,Ot){for(var At=0;At<Ot.length;At++){var Pt=Ot[At];Pt.enumerable=Pt.enumerable||!1,Pt.configurable=!0,"value"in Pt&&(Pt.writable=!0),Object.defineProperty(ct,Pt.key,Pt)}}function we(ct){var Ot={};return ct.reduce(function(At,Pt){return Ot[Pt]||(Ot[Pt]=!0,At.push(Pt)),At},[])}function tt(ct,Ot){requestAnimationFrame(function(){Ot.enter(),requestAnimationFrame(function(){Ot.active(),setTimeout(function(){Ot.leave()},ct)})})}function St(ct,Ot){try{var At=ct.liElementsById[Ot.parent.id];At.classList.contains("treejs-node__close")||At.getElementsByClassName("treejs-switcher")[0].click()}catch{return}Object.prototype.hasOwnProperty.call(Ot,"parent")&&St(ct,Ot.parent)}function _t(ct,Ot){var At=ct.liElementsById[Ot.id];At.classList.contains("treejs-node__close")&&At.getElementsByClassName("treejs-switcher")[0].click(),Object.prototype.hasOwnProperty.call(Ot,"children")&&Ot.children.forEach(function(Pt){return _t(ct,Pt)})}var xt=function(){function ct(Ie,vt){(function(ft,jt){if(!(ft instanceof jt))throw new TypeError("Cannot call a class as a function")})(this,ct),je.use({target:typeof this.container=="string"?document.querySelector(this.container):this.container}),this.treeNodes=[],this.nodesById={},this.leafNodesById={},this.liElementsById={},this.willUpdateNodesById={},this.container=Ie,this.options=Object.assign({values:[],disables:[],loaded:null,closeDepth:null},vt),Object.defineProperties(this,{values:{get:function(){return this.getValues()},set:function(ft){this.setValues(we(ft))}},disables:{get:function(){return this.getDisables()},set:function(ft){this.setDisables(we(ft))}},selectedNodes:{get:function(){var ft=[],jt=this.nodesById;return Object.keys(jt).forEach(function(rt){if(Object.prototype.hasOwnProperty.call(jt,rt)&&(jt[rt].status===1||jt[rt].status===2)){var pe=se({},jt[rt]);delete pe.parent,delete pe.children,ft.push(pe)}}),ft}},disabledNodes:{get:function(){var ft=[],jt=this.nodesById;return Object.keys(jt).forEach(function(rt){if(Object.prototype.hasOwnProperty.call(jt,rt)&&jt[rt].disabled){var pe=se({},jt[rt]);delete pe.parent,ft.push(pe)}}),ft}}}),this.init(this.options.data)}var Ot,At,Pt;return Ot=ct,Pt=[{key:"onSwitcherClick",value:function(Ie){var vt=Ie.parentNode,ft=vt.lastChild,jt=ft.scrollHeight;vt.classList.contains("treejs-node__close")?tt(150,{enter:function(){ft.style.height=0,ft.style.opacity=0},active:function(){ft.style.height="".concat(jt,"px"),ft.style.opacity=1},leave:function(){ft.style.height="",ft.style.opacity="",vt.classList.remove("treejs-node__close")}}):tt(150,{enter:function(){ft.style.height="".concat(jt,"px"),ft.style.opacity=1},active:function(){ft.style.height=0,ft.style.opacity=0},leave:function(){ft.style.height="",ft.style.opacity="",vt.classList.add("treejs-node__close")}})}},{key:"parseTreeData",value:function(Ie){var vt,ft=(vt=Ie,JSON.parse(JSON.stringify(vt))),jt={},rt={},pe=[],be=[];return function Xe(zt,Wt){zt.forEach(function(qt){jt[qt.id]=qt,qt.checked&&pe.push(qt.id),qt.disabled&&be.push(qt.id),Wt&&(qt.parent=Wt),qt.children&&qt.children.length?Xe(qt.children,qt):rt[qt.id]=qt})}(ft),{treeNodes:ft,nodesById:jt,leafNodesById:rt,defaultValues:pe,defaultDisables:be}}},{key:"createRootEle",value:function(){var Ie=document.createElement("div");return Ie.classList.add("treejs"),Ie}},{key:"createUlEle",value:function(){var Ie=document.createElement("ul");return Ie.classList.add("treejs-nodes"),Ie}},{key:"createLiEle",value:function(Ie,vt){var ft=document.createElement("li");if(ft.classList.add("treejs-node"),vt&&ft.classList.add("treejs-node__close"),Ie.children&&Ie.children.length){var jt=document.createElement("span");jt.classList.add("treejs-switcher"),ft.appendChild(jt)}else ft.classList.add("treejs-placeholder");var rt=document.createElement("span");rt.classList.add("treejs-checkbox"),ft.appendChild(rt);var pe=document.createElement("span");pe.classList.add("treejs-label");var be=document.createTextNode(Ie.text);return pe.appendChild(be),ft.appendChild(pe),ft.nodeId=Ie.id,ft}}],(At=[{key:"init",value:function(Ie){var vt=ct.parseTreeData(Ie),ft=vt.treeNodes,jt=vt.nodesById,rt=vt.leafNodesById,pe=vt.defaultValues,be=vt.defaultDisables;this.treeNodes=ft,this.nodesById=jt,this.leafNodesById=rt,this.render(this.treeNodes);var Xe=this.options,zt=Xe.values,Wt=Xe.disables,qt=Xe.loaded;zt&&zt.length?this.setValues(zt):pe&&pe.length&&this.setValues(pe),Wt&&Wt.length?this.setDisables(Wt):be&&be.length&&this.setDisables(be),typeof qt=="function"&&qt.call(this)}},{key:"render",value:function(Ie){var vt=ct.createRootEle();vt.appendChild(this.buildTree(Ie,0)),this.bindEvent(vt);var ft=typeof this.container=="string"?document.querySelector(this.container):this.container;(function(jt){for(;jt.firstChild;)jt.removeChild(jt.firstChild)})(ft),ft.appendChild(vt)}},{key:"buildTree",value:function(Ie,vt){var ft=this,jt=ct.createUlEle();return Ie&&Ie.length&&Ie.forEach(function(rt){var pe=ct.createLiEle(rt,vt===ft.options.closeDepth-1);ft.liElementsById[rt.id]=pe;var be=null;rt.children&&rt.children.length&&(be=ft.buildTree(rt.children,vt+1)),be&&pe.appendChild(be),jt.appendChild(pe)}),jt}},{key:"bindEvent",value:function(Ie){var vt=this;Ie.addEventListener("click",function(ft){var jt=ft.target;jt.nodeName==="SPAN"&&jt.classList.contains("treejs-checkbox")?vt.onItemClick(jt.parentNode.nodeId):jt.nodeName==="SPAN"&&jt.classList.contains("treejs-label")?vt.onItemLabelClick(jt.parentNode.nodeId):jt.nodeName==="LI"&&jt.classList.contains("treejs-node")?vt.onItemClick(jt.nodeId):jt.nodeName==="SPAN"&&jt.classList.contains("treejs-switcher")&&ct.onSwitcherClick(jt)},!1)}},{key:"onItemClick",value:function(Ie){var vt=this.nodesById[Ie],ft=this.options.onChange;vt.disabled||(this.setValue(Ie),this.updateLiElements()),ft&&ft.call(this)}},{key:"onItemLabelClick",value:function(Ie){var vt=this.options.onItemLabelClick;vt&&vt.call(this,Ie)}},{key:"setValue",value:function(Ie){var vt=this.nodesById[Ie];if(vt){var ft=vt.status,jt=ft===1||ft===2?0:2;vt.status=jt,this.markWillUpdateNode(vt),this.walkUp(vt,"status"),this.walkDown(vt,"status")}}},{key:"getValues",value:function(){var Ie=this,vt=[];return Object.keys(this.leafNodesById).forEach(function(ft){Object.prototype.hasOwnProperty.call(Ie.leafNodesById,ft)&&(Ie.leafNodesById[ft].status!==1&&Ie.leafNodesById[ft].status!==2||vt.push(ft))}),vt}},{key:"setValues",value:function(Ie){var vt=this;this.emptyNodesCheckStatus(),Ie.forEach(function(jt){vt.setValue(jt)}),this.updateLiElements();var ft=this.options.onChange;ft&&ft.call(this)}},{key:"setDisable",value:function(Ie){var vt=this.nodesById[Ie];vt&&(vt.disabled||(vt.disabled=!0,this.markWillUpdateNode(vt),this.walkUp(vt,"disabled"),this.walkDown(vt,"disabled")))}},{key:"getDisables",value:function(){var Ie=this,vt=[];return Object.keys(this.leafNodesById).forEach(function(ft){Object.prototype.hasOwnProperty.call(Ie.leafNodesById,ft)&&Ie.leafNodesById[ft].disabled&&vt.push(ft)}),vt}},{key:"setDisables",value:function(Ie){var vt=this;this.emptyNodesDisable(),Ie.forEach(function(ft){vt.setDisable(ft)}),this.updateLiElements()}},{key:"emptyNodesCheckStatus",value:function(){this.willUpdateNodesById=this.getSelectedNodesById(),Object.values(this.willUpdateNodesById).forEach(function(Ie){Ie.disabled||(Ie.status=0)})}},{key:"emptyNodesDisable",value:function(){this.willUpdateNodesById=this.getDisabledNodesById(),Object.values(this.willUpdateNodesById).forEach(function(Ie){Ie.disabled=!1})}},{key:"getSelectedNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(Ie,vt){var ft=ye(vt,2),jt=ft[0],rt=ft[1];return rt.status!==1&&rt.status!==2||(Ie[jt]=rt),Ie},{})}},{key:"getDisabledNodesById",value:function(){return Object.entries(this.nodesById).reduce(function(Ie,vt){var ft=ye(vt,2),jt=ft[0],rt=ft[1];return rt.disabled&&(Ie[jt]=rt),Ie},{})}},{key:"updateLiElements",value:function(){var Ie=this;Object.values(this.willUpdateNodesById).forEach(function(vt){Ie.updateLiElement(vt)}),this.willUpdateNodesById={}}},{key:"markWillUpdateNode",value:function(Ie){this.willUpdateNodesById[Ie.id]=Ie}},{key:"walkUp",value:function(Ie,vt){var ft=Ie.parent;if(ft){if(vt==="status"){var jt,rt=ft.children.reduce(function(be,Xe){return Number.isNaN(Xe.status)?be:be+Xe.status},0);if(jt=rt?rt===2*ft.children.length?2:1:0,ft.status===jt)return;ft.status=jt}else{var pe=ft.children.reduce(function(be,Xe){return be&&Xe.disabled},!0);if(ft.disabled===pe)return;ft.disabled=pe}this.markWillUpdateNode(ft),this.walkUp(ft,vt)}}},{key:"walkDown",value:function(Ie,vt){var ft=this;Ie.children&&Ie.children.length&&Ie.children.forEach(function(jt){vt==="status"&&jt.disabled||(jt[vt]=Ie[vt],ft.markWillUpdateNode(jt),ft.walkDown(jt,vt))})}},{key:"updateLiElement",value:function(Ie){var vt=this.liElementsById[Ie.id].classList;switch(Ie.status){case 0:vt.remove("treejs-node__halfchecked","treejs-node__checked");break;case 1:vt.remove("treejs-node__checked"),vt.add("treejs-node__halfchecked");break;case 2:vt.remove("treejs-node__halfchecked"),vt.add("treejs-node__checked")}switch(Ie.disabled){case!0:vt.contains("treejs-node__disabled")||vt.add("treejs-node__disabled");break;case!1:vt.contains("treejs-node__disabled")&&vt.remove("treejs-node__disabled")}}},{key:"collapseAll",value:function(){var Ie=this;Object.keys(this.leafNodesById).forEach(function(vt){var ft=Ie.leafNodesById[vt];St(Ie,ft)})}},{key:"expandAll",value:function(){_t(this,this.treeNodes[0])}}])&&Be(Ot.prototype,At),Pt&&Be(Ot,Pt),Object.defineProperty(Ot,"prototype",{writable:!1}),ct}()}(),C.default}()},819:function(K,A){(function(w){const c="tp";function C(_e){return oe=>ge=>{if(!oe&&ge===void 0)return{succeeded:!1,value:void 0};if(oe&&ge===void 0)return{succeeded:!0,value:void 0};const Se=_e(ge);return Se!==void 0?{succeeded:!0,value:Se}:{succeeded:!1,value:void 0}}}function O(_e){return{custom:oe=>C(oe)(_e),boolean:C(oe=>typeof oe=="boolean"?oe:void 0)(_e),number:C(oe=>typeof oe=="number"?oe:void 0)(_e),string:C(oe=>typeof oe=="string"?oe:void 0)(_e),function:C(oe=>typeof oe=="function"?oe:void 0)(_e),constant:oe=>C(ge=>ge===oe?oe:void 0)(_e),raw:C(oe=>oe)(_e),object:oe=>C(ge=>{if((Se=ge)!==null&&typeof Se=="object")return function(je,ye){return Object.keys(ye).reduce((Ne,Z)=>{if(Ne===void 0)return;const se=(0,ye[Z])(je[Z]);return se.succeeded?Object.assign(Object.assign({},Ne),{[Z]:se.value}):void 0},{})}(ge,oe);var Se})(_e),array:oe=>C(ge=>{if(Array.isArray(ge))return Se=oe,ge.reduce((je,ye)=>{if(je===void 0)return;const Ne=Se(ye);return Ne.succeeded&&Ne.value!==void 0?[...je,Ne.value]:void 0},[]);var Se})(_e)}}const F={optional:O(!0),required:O(!1)};function G(_e,oe,ge,Se){return new(ge||(ge=Promise))(function(je,ye){function Ne(ae){try{se(Se.next(ae))}catch(Be){ye(Be)}}function Z(ae){try{se(Se.throw(ae))}catch(Be){ye(Be)}}function se(ae){var Be;ae.done?je(ae.value):(Be=ae.value,Be instanceof ge?Be:new ge(function(we){we(Be)})).then(Ne,Z)}se((Se=Se.apply(_e,oe||[])).next())})}function X(_e){return G(this,void 0,void 0,function*(){const oe=new Image;return oe.crossOrigin="anonymous",new Promise((ge,Se)=>{oe.src=_e,oe.onload=()=>{ge(oe)},oe.onerror=Se})})}const te=(ue="img",(_e,oe)=>[c,"-",ue,"v",_e?`_${_e}`:"",oe?`-${oe}`:""].join(""));var ue;class fe{constructor(oe,ge){this.element=oe.createElement("div"),this.element.classList.add(te()),ge.viewProps.bindClassModifiers(this.element),this.input=oe.createElement("input"),this.input.classList.add(te("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",ge.extensions.join(",")),this.image_=oe.createElement("img"),this.image_.classList.add(te("image")),this.image_.classList.add(te(`image_${ge.imageFit}`)),this.image_.crossOrigin="anonymous",this.image_.onclick=Se=>{ge.clickCallback?ge.clickCallback(Se,this.input):this.input.click()},this.element.classList.add(te("area_root")),this.element.appendChild(this.image_),this.element.appendChild(this.input)}changeImage(oe){this.image_.src=oe}changeDraggingState(oe){const ge=this.element;oe?ge==null||ge.classList.add(te("area_dragging")):ge==null||ge.classList.remove(te("area_dragging"))}}let de=null;class le{constructor(oe,ge){this.value=ge.value,this.viewProps=ge.viewProps,this.view=new fe(oe,{viewProps:this.viewProps,extensions:ge.extensions,imageFit:ge.imageFit,clickCallback:ge.clickCallback}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose(()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)}),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(oe){const ge=(oe==null?void 0:oe.target).files;if(!ge||!ge.length)return;const Se=ge[0];this.setValue(Se)}onDrop(oe){return G(this,void 0,void 0,function*(){oe.preventDefault();try{const{dataTransfer:ge}=oe,Se=ge==null?void 0:ge.files[0];if(Se)this.setValue(Se);else{const je=ge==null?void 0:ge.getData("url");if(!je)throw new Error("No url");this.setValue(je)}}catch(ge){console.error("Could not parse the dropped image",ge)}finally{this.view.changeDraggingState(!1)}})}onDragOver(oe){oe.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(oe){return G(this,void 0,void 0,function*(){oe instanceof HTMLImageElement?this.updateImage(oe.src):typeof oe!="string"&&oe?yield this.setValue(oe):(oe!=="placeholder"&&oe||(oe=(yield this.handlePlaceholderImage()).src),this.updateImage(oe))})}updateImage(oe){this.view.changeImage(oe)}setValue(oe){return G(this,void 0,void 0,function*(){if(oe instanceof HTMLImageElement)this.value.setRawValue(oe);else if(oe instanceof File){const ge=URL.createObjectURL(oe)+"#"+oe.name;oe.src=ge;const Se=yield X(ge).catch(()=>{});this.value.setRawValue(Se||oe)}else oe?this.value.setRawValue(yield X(oe)):this.value.setRawValue(yield this.handlePlaceholderImage())})}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return G(this,void 0,void 0,function*(){return de||(de=yield function(){const oe=document.createElement("canvas");oe.width=320,oe.height=50;const ge=oe.getContext("2d");return ge.fillStyle="#00000004",ge.fillRect(0,0,oe.width,oe.height),ge.fillStyle="#eee",ge.font='1.25rem "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace',ge.textAlign="center",ge.textBaseline="middle",ge.fillText("No image",.5*oe.width,.5*oe.height),new Promise(Se=>{oe.toBlob(je=>{const ye=new Image;ye.src=URL.createObjectURL(je),ye.isPlaceholder=!0,ye.onload=()=>{Se(ye)}})})}()),de})}}const me=[".jpg",".png",".gif"],$={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:inline-flex;height:auto !important;max-height:calc(var(--bld-us) * 3);border-radius:4px;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:0;height:0;pointer-events:none;visibility:hidden}.tp-imgv_image{width:100%;height:-webkit-max-content;height:-moz-max-content;height:max-content;max-height:calc(var(--bld-us) * 3);border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:4px;opacity:0.6}",accept(_e,oe){if(!(_e instanceof HTMLImageElement||typeof _e=="string"))return null;const ge=F,Se=function(je,ye){const Ne=F.required.object(ye)(je);return Ne.succeeded?Ne.value:void 0}(oe,{view:ge.required.constant("input-image"),acceptUrl:ge.optional.boolean,clickCallback:ge.optional.function,imageFit:ge.optional.custom(je=>je==="contain"||je==="cover"?je:void 0),extensions:ge.optional.array(ge.required.string)});return Se?{initialValue:_e,params:Se}:null},binding:{reader:_e=>oe=>oe.src!==void 0?oe.src===""?"placeholder":oe.src:oe,writer:_e=>(oe,ge)=>{oe.write(ge)}},controller(_e){var oe,ge;return new le(_e.document,{value:_e.value,imageFit:(oe=_e.params.imageFit)!==null&&oe!==void 0?oe:"cover",clickCallback:_e.params.clickCallback,viewProps:_e.viewProps,extensions:(ge=_e.params.extensions)!==null&&ge!==void 0?ge:me})}};w.plugin=$,Object.defineProperty(w,"__esModule",{value:!0})})(A)},665:function(K,A){(function(w){class c{constructor(_){this.controller_=_}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(_){this.controller_.viewProps.set("disabled",_)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(_){this.controller_.viewProps.set("hidden",_)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class C{constructor(_){this.target=_}}class O extends C{constructor(_,E,V,ce){super(_),this.value=E,this.presetKey=V,this.last=ce==null||ce}}class F extends C{constructor(_,E,V){super(_),this.value=E,this.presetKey=V}}class G extends C{constructor(_,E){super(_),this.expanded=E}}function X(B){return B==null}function te(B,_){if(B.length!==_.length)return!1;for(let E=0;E<B.length;E++)if(B[E]!==_[E])return!1;return!0}const ue={alreadydisposed:()=>"View has been already disposed",invalidparams:B=>`Invalid parameters for '${B.name}'`,nomatchingcontroller:B=>`No matching controller for '${B.key}'`,nomatchingview:B=>`No matching view for '${JSON.stringify(B.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:B=>`Property '${B.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class fe{constructor(_){var E;this.message=(E=ue[_.type](_.context))!==null&&E!==void 0?E:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=_.type}static alreadyDisposed(){return new fe({type:"alreadydisposed"})}static notBindable(){return new fe({type:"notbindable"})}static propertyNotFound(_){return new fe({type:"propertynotfound",context:{name:_}})}static shouldNeverHappen(){return new fe({type:"shouldneverhappen"})}}class de{constructor(_,E,V){this.obj_=_,this.key_=E,this.presetKey_=V??E}static isBindable(_){return _!==null&&typeof _=="object"}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(_){this.obj_[this.key_]=_}writeProperty(_,E){const V=this.read();if(!de.isBindable(V))throw fe.notBindable();if(!(_ in V))throw fe.propertyNotFound(_);V[_]=E}}class le extends c{get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}get title(){var _;return(_=this.controller_.valueController.props.get("title"))!==null&&_!==void 0?_:""}set title(_){this.controller_.valueController.props.set("title",_)}on(_,E){const V=E.bind(this);return this.controller_.valueController.emitter.on(_,()=>{V(new C(this))}),this}}class me{constructor(){this.observers_={}}on(_,E){let V=this.observers_[_];return V||(V=this.observers_[_]=[]),V.push({handler:E}),this}off(_,E){const V=this.observers_[_];return V&&(this.observers_[_]=V.filter(ce=>ce.handler!==E)),this}emit(_,E){const V=this.observers_[_];V&&V.forEach(ce=>{ce.handler(E)})}}const $="tp";function _e(B){return(_,E)=>[$,"-",B,"v",_?`_${_}`:"",E?`-${E}`:""].join("")}function oe(B){return B.rawValue}function ge(B,_){var E,V;B.emitter.on("change",(E=oe,V=_,ce=>V(E(ce)))),_(B.rawValue)}function Se(B,_,E){ge(B.value(_),E)}function je(B,_){return E=>{(function(V,ce,Le){Le?V.classList.add(ce):V.classList.remove(ce)})(B,_,E)}}function ye(B,_){ge(B,E=>{_.textContent=E??""})}const Ne=_e("btn");class Z{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Ne()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("button");V.classList.add(Ne("b")),E.viewProps.bindDisabled(V),this.element.appendChild(V),this.buttonElement=V;const ce=_.createElement("div");ce.classList.add(Ne("t")),ye(E.props.value("title"),ce),this.buttonElement.appendChild(ce)}}class se{constructor(_,E){this.emitter=new me,this.onClick_=this.onClick_.bind(this),this.props=E.props,this.viewProps=E.viewProps,this.view=new Z(_,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ae{constructor(_,E){var V;this.constraint_=E==null?void 0:E.constraint,this.equals_=(V=E==null?void 0:E.equals)!==null&&V!==void 0?V:(ce,Le)=>ce===Le,this.emitter=new me,this.rawValue_=_}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(_){this.setRawValue(_,{forceEmit:!1,last:!0})}setRawValue(_,E){const V=E??{forceEmit:!1,last:!0},ce=this.constraint_?this.constraint_.constrain(_):_;(!this.equals_(this.rawValue_,ce)||V.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=ce,this.emitter.emit("change",{options:V,rawValue:ce,sender:this}))}}class Be{constructor(_){this.emitter=new me,this.value_=_}get rawValue(){return this.value_}set rawValue(_){this.setRawValue(_,{forceEmit:!1,last:!0})}setRawValue(_,E){const V=E??{forceEmit:!1,last:!0};(this.value_!==_||V.forceEmit)&&(this.emitter.emit("beforechange",{sender:this}),this.value_=_,this.emitter.emit("change",{options:V,rawValue:this.value_,sender:this}))}}function we(B,_){const E=_==null?void 0:_.constraint,V=_==null?void 0:_.equals;return E||V?new ae(B,_):new Be(B)}class tt{constructor(_){this.emitter=new me,this.valMap_=_;for(const E in this.valMap_)this.valMap_[E].emitter.on("change",()=>{this.emitter.emit("change",{key:E,sender:this})})}static createCore(_){return Object.keys(_).reduce((E,V)=>Object.assign(E,{[V]:we(_[V])}),{})}static fromObject(_){const E=this.createCore(_);return new tt(E)}get(_){return this.valMap_[_].rawValue}set(_,E){this.valMap_[_].rawValue=E}value(_){return this.valMap_[_]}}function St(B){return _=>E=>{if(!_&&E===void 0)return{succeeded:!1,value:void 0};if(_&&E===void 0)return{succeeded:!0,value:void 0};const V=B(E);return V!==void 0?{succeeded:!0,value:V}:{succeeded:!1,value:void 0}}}function _t(B){return{custom:_=>St(_)(B),boolean:St(_=>typeof _=="boolean"?_:void 0)(B),number:St(_=>typeof _=="number"?_:void 0)(B),string:St(_=>typeof _=="string"?_:void 0)(B),function:St(_=>typeof _=="function"?_:void 0)(B),constant:_=>St(E=>E===_?_:void 0)(B),raw:St(_=>_)(B),object:_=>St(E=>{if((V=E)!==null&&typeof V=="object")return function(ce,Le){return Object.keys(Le).reduce((qe,Et)=>{if(qe===void 0)return;const Yt=(0,Le[Et])(ce[Et]);return Yt.succeeded?Object.assign(Object.assign({},qe),{[Et]:Yt.value}):void 0},{})}(E,_);var V})(B),array:_=>St(E=>{if(Array.isArray(E))return V=_,E.reduce((ce,Le)=>{if(ce===void 0)return;const qe=V(Le);return qe.succeeded&&qe.value!==void 0?[...ce,qe.value]:void 0},[]);var V})(B)}}const xt={optional:_t(!0),required:_t(!1)};function ct(B,_){const E=xt.required.object(_)(B);return E.succeeded?E.value:void 0}const Ot=_e(""),At={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class Pt{constructor(_){this.parent_=null,this.blade=_.blade,this.view=_.view,this.viewProps=_.viewProps;const E=this.view.element;this.blade.value("positions").emitter.on("change",()=>{["veryfirst","first","last","verylast"].forEach(V=>{E.classList.remove(Ot(void 0,At[V]))}),this.blade.get("positions").forEach(V=>{E.classList.add(Ot(void 0,At[V]))})}),this.viewProps.handleDispose(()=>{(function(V){V&&V.parentElement&&V.parentElement.removeChild(V)})(E)})}get parent(){return this.parent_}}const Ie="http://www.w3.org/2000/svg";function vt(B){B.offsetHeight}function ft(B){return B.ontouchstart!==void 0}function jt(){return new Function("return this")().document}const rt={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function pe(B,_){const E=B.createElementNS(Ie,"svg");return E.innerHTML=rt[_],E}function be(B,_,E){B.insertBefore(_,B.children[E])}function Xe(B){B.parentElement&&B.parentElement.removeChild(B)}function zt(B){for(;B.children.length>0;)B.removeChild(B.children[0])}function Wt(B){return B.relatedTarget?B.relatedTarget:"explicitOriginalTarget"in B?B.explicitOriginalTarget:null}const qt=_e("lbl");class Cn{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(qt()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("div");V.classList.add(qt("l")),Se(E.props,"label",Le=>{X(Le)?this.element.classList.add(qt(void 0,"nol")):(this.element.classList.remove(qt(void 0,"nol")),function(qe){for(;qe.childNodes.length>0;)qe.removeChild(qe.childNodes[0])}(V),V.appendChild(function(qe,Et){const Yt=qe.createDocumentFragment();return Et.split(`
`).map(kn=>qe.createTextNode(kn)).forEach((kn,Hn)=>{Hn>0&&Yt.appendChild(qe.createElement("br")),Yt.appendChild(kn)}),Yt}(_,Le)))}),this.element.appendChild(V),this.labelElement=V;const ce=_.createElement("div");ce.classList.add(qt("v")),this.element.appendChild(ce),this.valueElement=ce}}class vn extends Pt{constructor(_,E){const V=E.valueController.viewProps;super(Object.assign(Object.assign({},E),{view:new Cn(_,{props:E.props,viewProps:V}),viewProps:V})),this.props=E.props,this.valueController=E.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Zn={id:"button",type:"blade",accept(B){const _=xt,E=ct(B,{title:_.required.string,view:_.required.constant("button"),label:_.optional.string});return E?{params:E}:null},controller:B=>new vn(B.document,{blade:B.blade,props:tt.fromObject({label:B.params.label}),valueController:new se(B.document,{props:tt.fromObject({title:B.params.title}),viewProps:B.viewProps})}),api:B=>B.controller instanceof vn&&B.controller.valueController instanceof se?new le(B.controller):null};class Xn extends Pt{constructor(_){super(_),this.value=_.value}}function Pi(){return new tt({positions:we([],{equals:te})})}class qn extends tt{constructor(_){super(_)}static create(_){const E={completed:!0,expanded:_,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},V=tt.createCore(E);return new qn(V)}get styleExpanded(){var _;return(_=this.get("temporaryExpanded"))!==null&&_!==void 0?_:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const _=this.get("expandedHeight");return this.get("shouldFixHeight")&&!X(_)?`${_}px`:"auto"}bindExpandedClass(_,E){const V=()=>{this.styleExpanded?_.classList.add(E):_.classList.remove(E)};Se(this,"expanded",V),Se(this,"temporaryExpanded",V)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function gt(B,_){_.style.height=B.styleHeight}function mi(B,_){B.value("expanded").emitter.on("beforechange",()=>{B.set("completed",!1),X(B.get("expandedHeight"))&&B.set("expandedHeight",function(E,V){let ce=0;return function(Le,qe){const Et=Le.style.transition;Le.style.transition="none",qe(),Le.style.transition=Et}(V,()=>{E.set("expandedHeight",null),E.set("temporaryExpanded",!0),vt(V),ce=V.clientHeight,E.set("temporaryExpanded",null),vt(V)}),ce}(B,_)),B.set("shouldFixHeight",!0),vt(_)}),B.emitter.on("change",()=>{gt(B,_)}),gt(B,_),_.addEventListener("transitionend",E=>{E.propertyName==="height"&&B.cleanUpTransition()})}class Ei extends c{constructor(_,E){super(_),this.rackApi_=E}}class Rr{constructor(_){this.emitter=new me,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=_}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(_){for(const E of this.allItems())if(_(E))return E;return null}includes(_){return this.cache_.has(_)}add(_,E){if(this.includes(_))throw fe.shouldNeverHappen();const V=E!==void 0?E:this.items_.length;this.items_.splice(V,0,_),this.cache_.add(_);const ce=this.extract_(_);ce&&(ce.emitter.on("add",this.onSubListAdd_),ce.emitter.on("remove",this.onSubListRemove_),ce.allItems().forEach(Le=>{this.cache_.add(Le)})),this.emitter.emit("add",{index:V,item:_,root:this,target:this})}remove(_){const E=this.items_.indexOf(_);if(E<0)return;this.items_.splice(E,1),this.cache_.delete(_);const V=this.extract_(_);V&&(V.emitter.off("add",this.onSubListAdd_),V.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:E,item:_,root:this,target:this})}onSubListAdd_(_){this.cache_.add(_.item),this.emitter.emit("add",{index:_.index,item:_.item,root:this,target:_.target})}onSubListRemove_(_){this.cache_.delete(_.item),this.emitter.emit("remove",{index:_.index,item:_.item,root:this,target:_.target})}}class Xi extends c{constructor(_){super(_),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new me,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(_){const E=_.sender.target.read();this.emitter_.emit("change",{event:new O(this,E,this.controller_.binding.target.presetKey,_.options.last)})}}class zi extends vn{constructor(_,E){super(_,E),this.binding=E.binding}}class Vi extends c{constructor(_){super(_),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new me,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(_){const E=_.sender.target.read();this.emitter_.emit("update",{event:new F(this,E,this.controller_.binding.target.presetKey)})}}class Gi extends vn{constructor(_,E){super(_,E),this.binding=E.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function Vr(B){return B instanceof br?B.apiSet_:B instanceof Ei?B.rackApi_.apiSet_:null}function Di(B,_){const E=B.find(V=>V.controller_===_);if(!E)throw fe.shouldNeverHappen();return E}function gi(B,_,E){if(!de.isBindable(B))throw fe.notBindable();return new de(B,_,E)}class br extends c{constructor(_,E){super(_),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new me,this.apiSet_=new Rr(Vr),this.pool_=E;const V=this.controller_.rack;V.emitter.on("add",this.onRackAdd_),V.emitter.on("remove",this.onRackRemove_),V.emitter.on("inputchange",this.onRackInputChange_),V.emitter.on("monitorupdate",this.onRackMonitorUpdate_),V.children.forEach(ce=>{this.setUpApi_(ce)})}get children(){return this.controller_.rack.children.map(_=>Di(this.apiSet_,_))}addInput(_,E,V){const ce=V||{},Le=this.controller_.view.element.ownerDocument,qe=this.pool_.createInput(Le,gi(_,E,ce.presetKey),ce),Et=new Xi(qe);return this.add(Et,ce.index)}addMonitor(_,E,V){const ce=V||{},Le=this.controller_.view.element.ownerDocument,qe=this.pool_.createMonitor(Le,gi(_,E),ce),Et=new Vi(qe);return this.add(Et,ce.index)}addFolder(_){return function(E,V){return E.addBlade(Object.assign(Object.assign({},V),{view:"folder"}))}(this,_)}addButton(_){return function(E,V){return E.addBlade(Object.assign(Object.assign({},V),{view:"button"}))}(this,_)}addSeparator(_){return function(E,V){const ce=V||{};return E.addBlade(Object.assign(Object.assign({},ce),{view:"separator"}))}(this,_)}addTab(_){return function(E,V){return E.addBlade(Object.assign(Object.assign({},V),{view:"tab"}))}(this,_)}add(_,E){this.controller_.rack.add(_.controller_,E);const V=this.apiSet_.find(ce=>ce.controller_===_.controller_);return V&&this.apiSet_.remove(V),this.apiSet_.add(_),_}remove(_){this.controller_.rack.remove(_.controller_)}addBlade(_){const E=this.controller_.view.element.ownerDocument,V=this.pool_.createBlade(E,_),ce=this.pool_.createBladeApi(V);return this.add(ce,_.index)}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}setUpApi_(_){this.apiSet_.find(E=>E.controller_===_)||this.apiSet_.add(this.pool_.createBladeApi(_))}onRackAdd_(_){this.setUpApi_(_.bladeController)}onRackRemove_(_){if(_.isRoot){const E=Di(this.apiSet_,_.bladeController);this.apiSet_.remove(E)}}onRackInputChange_(_){const E=_.bladeController;if(E instanceof zi){const V=Di(this.apiSet_,E),ce=E.binding;this.emitter_.emit("change",{event:new O(V,ce.target.read(),ce.target.presetKey,_.options.last)})}else if(E instanceof Xn){const V=Di(this.apiSet_,E);this.emitter_.emit("change",{event:new O(V,E.value.rawValue,void 0,_.options.last)})}}onRackMonitorUpdate_(_){if(!(_.bladeController instanceof Gi))throw fe.shouldNeverHappen();const E=Di(this.apiSet_,_.bladeController),V=_.bladeController.binding;this.emitter_.emit("update",{event:new F(E,V.target.read(),V.target.presetKey)})}}class ar extends Ei{constructor(_,E){super(_,new br(_.rackController,E)),this.emitter_=new me,this.controller_.foldable.value("expanded").emitter.on("change",V=>{this.emitter_.emit("fold",{event:new G(this,V.sender.rawValue)})}),this.rackApi_.on("change",V=>{this.emitter_.emit("change",{event:V})}),this.rackApi_.on("update",V=>{this.emitter_.emit("update",{event:V})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(_){this.controller_.foldable.set("expanded",_)}get title(){return this.controller_.props.get("title")}set title(_){this.controller_.props.set("title",_)}get children(){return this.rackApi_.children}addInput(_,E,V){return this.rackApi_.addInput(_,E,V)}addMonitor(_,E,V){return this.rackApi_.addMonitor(_,E,V)}addFolder(_){return this.rackApi_.addFolder(_)}addButton(_){return this.rackApi_.addButton(_)}addSeparator(_){return this.rackApi_.addSeparator(_)}addTab(_){return this.rackApi_.addTab(_)}add(_,E){return this.rackApi_.add(_,E)}remove(_){this.rackApi_.remove(_)}addBlade(_){return this.rackApi_.addBlade(_)}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}}class Ki extends Pt{constructor(_){super({blade:_.blade,view:_.view,viewProps:_.rackController.viewProps}),this.rackController=_.rackController}}class Po{constructor(_,E){const V=_e(E.viewName);this.element=_.createElement("div"),this.element.classList.add(V()),E.viewProps.bindClassModifiers(this.element)}}function lr(B){return B instanceof Es?B.rack:B instanceof Ki?B.rackController.rack:null}function cs(B){const _=lr(B);return _?_.bcSet_:null}class nr{constructor(_){var E;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new me,this.blade_=_??null,(E=this.blade_)===null||E===void 0||E.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Rr(cs),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(_,E){_.parent&&_.parent.remove(_),_.parent_=this,this.bcSet_.add(_,E)}remove(_){_.parent_=null,this.bcSet_.remove(_)}find(_){return this.bcSet_.allItems().filter(E=>E instanceof _)}onSetAdd_(_){this.updatePositions_();const E=_.target===_.root;if(this.emitter.emit("add",{bladeController:_.item,index:_.index,isRoot:E,sender:this}),!E)return;const V=_.item;if(V.viewProps.emitter.on("change",this.onChildViewPropsChange_),V.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),V.viewProps.handleDispose(this.onChildDispose_),V instanceof zi)V.binding.emitter.on("change",this.onChildInputChange_);else if(V instanceof Gi)V.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(V instanceof Xn)V.value.emitter.on("change",this.onChildValueChange_);else{const ce=lr(V);if(ce){const Le=ce.emitter;Le.on("layout",this.onDescendantLayout_),Le.on("inputchange",this.onDescendantInputChange_),Le.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(_){this.updatePositions_();const E=_.target===_.root;if(this.emitter.emit("remove",{bladeController:_.item,isRoot:E,sender:this}),!E)return;const V=_.item;if(V instanceof zi)V.binding.emitter.off("change",this.onChildInputChange_);else if(V instanceof Gi)V.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(V instanceof Xn)V.value.emitter.off("change",this.onChildValueChange_);else{const ce=lr(V);if(ce){const Le=ce.emitter;Le.off("layout",this.onDescendantLayout_),Le.off("inputchange",this.onDescendantInputChange_),Le.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const _=this.bcSet_.items.filter(ce=>!ce.viewProps.get("hidden")),E=_[0],V=_[_.length-1];this.bcSet_.items.forEach(ce=>{const Le=[];ce===E&&(Le.push("first"),this.blade_&&!this.blade_.get("positions").includes("veryfirst")||Le.push("veryfirst")),ce===V&&(Le.push("last"),this.blade_&&!this.blade_.get("positions").includes("verylast")||Le.push("verylast")),ce.blade.set("positions",Le)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(_){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(_=>_.viewProps.get("disposed")).forEach(_=>{this.bcSet_.remove(_)})}onChildInputChange_(_){const E=function(V,ce){for(let Le=0;Le<V.length;Le++){const qe=V[Le];if(qe instanceof zi&&qe.binding===ce)return qe}return null}(this.find(zi),_.sender);if(!E)throw fe.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:E,options:_.options,sender:this})}onChildMonitorUpdate_(_){const E=function(V,ce){for(let Le=0;Le<V.length;Le++){const qe=V[Le];if(qe instanceof Gi&&qe.binding===ce)return qe}return null}(this.find(Gi),_.sender);if(!E)throw fe.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:E,sender:this})}onChildValueChange_(_){const E=function(V,ce){for(let Le=0;Le<V.length;Le++){const qe=V[Le];if(qe instanceof Xn&&qe.value===ce)return qe}return null}(this.find(Xn),_.sender);if(!E)throw fe.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:E,options:_.options,sender:this})}onDescendantLayout_(_){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(_){this.emitter.emit("inputchange",{bladeController:_.bladeController,options:_.options,sender:this})}onDescendantMonitorUpdate_(_){this.emitter.emit("monitorupdate",{bladeController:_.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class Es extends Pt{constructor(_,E){super(Object.assign(Object.assign({},E),{view:new Po(_,{viewName:"brk",viewProps:E.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const V=new nr(E.root?void 0:E.blade);V.emitter.on("add",this.onRackAdd_),V.emitter.on("remove",this.onRackRemove_),this.rack=V,this.viewProps.handleDispose(()=>{for(let ce=this.rack.children.length-1;ce>=0;ce--)this.rack.children[ce].viewProps.set("disposed",!0)})}onRackAdd_(_){_.isRoot&&be(this.view.element,_.bladeController.view.element,_.index)}onRackRemove_(_){_.isRoot&&Xe(_.bladeController.view.element)}}const Do=_e("cnt");class Sn{constructor(_,E){this.className_=_e(E.viewName||"fld"),this.element=_.createElement("div"),this.element.classList.add(this.className_(),Do()),E.viewProps.bindClassModifiers(this.element),this.foldable_=E.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Se(this.foldable_,"completed",je(this.element,this.className_(void 0,"cpl")));const V=_.createElement("button");V.classList.add(this.className_("b")),Se(E.props,"title",Et=>{X(Et)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),E.viewProps.bindDisabled(V),this.element.appendChild(V),this.buttonElement=V;const ce=_.createElement("div");ce.classList.add(this.className_("t")),ye(E.props.value("title"),ce),this.buttonElement.appendChild(ce),this.titleElement=ce;const Le=_.createElement("div");Le.classList.add(this.className_("m")),this.buttonElement.appendChild(Le);const qe=E.containerElement;qe.classList.add(this.className_("c")),this.element.appendChild(qe),this.containerElement=qe}}class Ui extends Ki{constructor(_,E){var V;const ce=qn.create((V=E.expanded)===null||V===void 0||V),Le=new Es(_,{blade:E.blade,root:E.root,viewProps:E.viewProps});super(Object.assign(Object.assign({},E),{rackController:Le,view:new Sn(_,{containerElement:Le.view.element,foldable:ce,props:E.props,viewName:E.root?"rot":void 0,viewProps:E.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=E.props,this.foldable=ce,mi(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const qr={id:"folder",type:"blade",accept(B){const _=xt,E=ct(B,{title:_.required.string,view:_.required.constant("folder"),expanded:_.optional.boolean});return E?{params:E}:null},controller:B=>new Ui(B.document,{blade:B.blade,expanded:B.params.expanded,props:tt.fromObject({title:B.params.title}),viewProps:B.viewProps}),api:B=>B.controller instanceof Ui?new ar(B.controller,B.pool):null};class Sr extends Xn{constructor(_,E){const V=E.valueController.viewProps;super(Object.assign(Object.assign({},E),{value:E.valueController.value,view:new Cn(_,{props:E.props,viewProps:V}),viewProps:V})),this.props=E.props,this.valueController=E.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class no extends c{}const Vs=_e("spr");class _o{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Vs()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("hr");V.classList.add(Vs("r")),this.element.appendChild(V)}}class et extends Pt{constructor(_,E){super(Object.assign(Object.assign({},E),{view:new _o(_,{viewProps:E.viewProps})}))}}const _r={id:"separator",type:"blade",accept(B){const _=ct(B,{view:xt.required.constant("separator")});return _?{params:_}:null},controller:B=>new et(B.document,{blade:B.blade,viewProps:B.viewProps}),api:B=>B.controller instanceof et?new no(B.controller):null},Gs=_e("");function ri(B,_){return je(B,Gs(void 0,_))}class cn extends tt{constructor(_){super(_)}static create(_){var E,V;const ce=_??{},Le={disabled:(E=ce.disabled)!==null&&E!==void 0&&E,disposed:!1,hidden:(V=ce.hidden)!==null&&V!==void 0&&V},qe=tt.createCore(Le);return new cn(qe)}bindClassModifiers(_){Se(this,"disabled",ri(_,"disabled")),Se(this,"hidden",ri(_,"hidden"))}bindDisabled(_){Se(this,"disabled",E=>{_.disabled=E})}bindTabIndex(_){Se(this,"disabled",E=>{_.tabIndex=E?-1:0})}handleDispose(_){this.value("disposed").emitter.on("change",E=>{E&&_()})}}const kt=_e("tbi");class Gn{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(kt()),E.viewProps.bindClassModifiers(this.element),Se(E.props,"selected",Le=>{Le?this.element.classList.add(kt(void 0,"sel")):this.element.classList.remove(kt(void 0,"sel"))});const V=_.createElement("button");V.classList.add(kt("b")),E.viewProps.bindDisabled(V),this.element.appendChild(V),this.buttonElement=V;const ce=_.createElement("div");ce.classList.add(kt("t")),ye(E.props.value("title"),ce),this.buttonElement.appendChild(ce),this.titleElement=ce}}class Qn{constructor(_,E){this.emitter=new me,this.onClick_=this.onClick_.bind(this),this.props=E.props,this.viewProps=E.viewProps,this.view=new Gn(_,{props:E.props,viewProps:E.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class Nn{constructor(_,E){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new Qn(_,{props:E.itemProps,viewProps:cn.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new Es(_,{blade:Pi(),viewProps:cn.create()}),this.props=E.props,Se(this.props,"selected",V=>{this.itemController.props.set("selected",V),this.contentController.viewProps.set("hidden",!V)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class ir{constructor(_,E){this.controller_=_,this.rackApi_=E}get title(){var _;return(_=this.controller_.itemController.props.get("title"))!==null&&_!==void 0?_:""}set title(_){this.controller_.itemController.props.set("title",_)}get selected(){return this.controller_.props.get("selected")}set selected(_){this.controller_.props.set("selected",_)}get children(){return this.rackApi_.children}addButton(_){return this.rackApi_.addButton(_)}addFolder(_){return this.rackApi_.addFolder(_)}addSeparator(_){return this.rackApi_.addSeparator(_)}addTab(_){return this.rackApi_.addTab(_)}add(_,E){this.rackApi_.add(_,E)}remove(_){this.rackApi_.remove(_)}addInput(_,E,V){return this.rackApi_.addInput(_,E,V)}addMonitor(_,E,V){return this.rackApi_.addMonitor(_,E,V)}addBlade(_){return this.rackApi_.addBlade(_)}}class di extends Ei{constructor(_,E){super(_,new br(_.rackController,E)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.emitter_=new me,this.pageApiMap_=new Map,this.rackApi_.on("change",V=>{this.emitter_.emit("change",{event:V})}),this.rackApi_.on("update",V=>{this.emitter_.emit("update",{event:V})}),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(V=>{this.setUpPageApi_(V)})}get pages(){return this.controller_.pageSet.items.map(_=>{const E=this.pageApiMap_.get(_);if(!E)throw fe.shouldNeverHappen();return E})}addPage(_){const E=this.controller_.view.element.ownerDocument,V=new Nn(E,{itemProps:tt.fromObject({selected:!1,title:_.title}),props:tt.fromObject({selected:!1})});this.controller_.add(V,_.index);const ce=this.pageApiMap_.get(V);if(!ce)throw fe.shouldNeverHappen();return ce}removePage(_){this.controller_.remove(_)}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}setUpPageApi_(_){const E=this.rackApi_.apiSet_.find(ce=>ce.controller_===_.contentController);if(!E)throw fe.shouldNeverHappen();const V=new ir(_,E);this.pageApiMap_.set(_,V)}onPageAdd_(_){this.setUpPageApi_(_.item)}onPageRemove_(_){if(!this.pageApiMap_.get(_.item))throw fe.shouldNeverHappen();this.pageApiMap_.delete(_.item)}}const Hi=_e("tab");class rr{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Hi(),Do()),E.viewProps.bindClassModifiers(this.element),ge(E.empty,je(this.element,Hi(void 0,"nop")));const V=_.createElement("div");V.classList.add(Hi("i")),this.element.appendChild(V),this.itemsElement=V;const ce=E.contentsElement;ce.classList.add(Hi("c")),this.element.appendChild(ce),this.contentsElement=ce}}class Qs extends Ki{constructor(_,E){const V=new Es(_,{blade:E.blade,viewProps:E.viewProps}),ce=we(!0);super({blade:E.blade,rackController:V,view:new rr(_,{contentsElement:V.view.element,empty:ce,viewProps:E.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onPageSelectedChange_=this.onPageSelectedChange_.bind(this),this.pageSet_=new Rr(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.empty_=ce,this.applyPages_()}get pageSet(){return this.pageSet_}add(_,E){this.pageSet_.add(_,E??this.pageSet_.items.length)}remove(_){this.pageSet_.remove(this.pageSet_.items[_])}applyPages_(){this.keepSelection_(),this.empty_.rawValue=this.pageSet_.items.length===0}onPageAdd_(_){const E=_.item;be(this.view.itemsElement,E.itemController.view.element,_.index),this.rackController.rack.add(E.contentController,_.index),E.props.value("selected").emitter.on("change",this.onPageSelectedChange_),this.applyPages_()}onPageRemove_(_){const E=_.item;Xe(E.itemController.view.element),this.rackController.rack.remove(E.contentController),E.props.value("selected").emitter.off("change",this.onPageSelectedChange_),this.applyPages_()}keepSelection_(){if(this.pageSet_.items.length===0)return;const _=this.pageSet_.items.findIndex(E=>E.props.get("selected"));_<0?this.pageSet_.items.forEach((E,V)=>{E.props.set("selected",V===0)}):this.pageSet_.items.forEach((E,V)=>{E.props.set("selected",V===_)})}onPageSelectedChange_(_){if(_.rawValue){const E=this.pageSet_.items.findIndex(V=>V.props.value("selected")===_.sender);this.pageSet_.items.forEach((V,ce)=>{V.props.set("selected",ce===E)})}else this.keepSelection_()}}const vi={id:"tab",type:"blade",accept(B){const _=xt,E=ct(B,{pages:_.required.array(_.required.object({title:_.required.string})),view:_.required.constant("tab")});return E&&E.pages.length!==0?{params:E}:null},controller(B){const _=new Qs(B.document,{blade:B.blade,viewProps:B.viewProps});return B.params.pages.forEach(E=>{const V=new Nn(B.document,{itemProps:tt.fromObject({selected:!1,title:E.title}),props:tt.fromObject({selected:!1})});_.add(V)}),_},api:B=>B.controller instanceof Qs?new di(B.controller,B.pool):null};class Gr{constructor(){this.disabled=!1,this.emitter=new me}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class vo{constructor(_,E){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=_,this.emitter=new me,this.interval_=E,this.setTimer_()}get disabled(){return this.disabled_}set disabled(_){this.disabled_=_,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const _=this.doc_.defaultView;_&&_.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const _=this.doc_.defaultView;_&&(this.timerId_=_.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class sr{constructor(_){this.constraints=_}constrain(_){return this.constraints.reduce((E,V)=>V.constrain(E),_)}}function Bi(B,_){if(B instanceof _)return B;if(B instanceof sr){const E=B.constraints.reduce((V,ce)=>V||(ce instanceof _?ce:null),null);if(E)return E}return null}class pr{constructor(_){this.options=_}constrain(_){const E=this.options;return E.length===0||E.filter(V=>V.value===_).length>0?_:E[0].value}}class Ri{constructor(_){this.maxValue=_.max,this.minValue=_.min}constrain(_){let E=_;return X(this.minValue)||(E=Math.max(E,this.minValue)),X(this.maxValue)||(E=Math.min(E,this.maxValue)),E}}class us{constructor(_){this.step=_}constrain(_){return(_<0?-Math.round(-_/this.step):Math.round(_/this.step))*this.step}}const ki=_e("lst");class fr{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),this.props_=E.props,this.element=_.createElement("div"),this.element.classList.add(ki()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("select");V.classList.add(ki("s")),Se(this.props_,"options",Le=>{zt(V),Le.forEach((qe,Et)=>{const Yt=_.createElement("option");Yt.dataset.index=String(Et),Yt.textContent=qe.text,Yt.value=String(qe.value),V.appendChild(Yt)})}),E.viewProps.bindDisabled(V),this.element.appendChild(V),this.selectElement=V;const ce=_.createElement("div");ce.classList.add(ki("m")),ce.appendChild(pe(_,"dropdown")),this.element.appendChild(ce),E.value.emitter.on("change",this.onValueChange_),this.value_=E.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class wr{constructor(_,E){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=E.props,this.value=E.value,this.viewProps=E.viewProps,this.view=new fr(_,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(_){const E=_.currentTarget.selectedOptions.item(0);if(!E)return;const V=Number(E.dataset.index);this.value.rawValue=this.props.get("options")[V].value}}const _n=_e("pop");class ja{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(_n()),E.viewProps.bindClassModifiers(this.element),ge(E.shows,je(this.element,_n(void 0,"v")))}}class wn{constructor(_,E){this.shows=we(!1),this.viewProps=E.viewProps,this.view=new ja(_,{shows:this.shows,viewProps:this.viewProps})}}const Yr=_e("txt");class Ao{constructor(_,E){this.onChange_=this.onChange_.bind(this),this.element=_.createElement("div"),this.element.classList.add(Yr()),E.viewProps.bindClassModifiers(this.element),this.props_=E.props,this.props_.emitter.on("change",this.onChange_);const V=_.createElement("input");V.classList.add(Yr("i")),V.type="text",E.viewProps.bindDisabled(V),this.element.appendChild(V),this.inputElement=V,E.value.emitter.on("change",this.onChange_),this.value_=E.value,this.refresh()}refresh(){const _=this.props_.get("formatter");this.inputElement.value=_(this.value_.rawValue)}onChange_(){this.refresh()}}class Ji{constructor(_,E){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=E.parser,this.props=E.props,this.value=E.value,this.viewProps=E.viewProps,this.view=new Ao(_,{props:E.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(_){const E=_.currentTarget.value,V=this.parser_(E);X(V)||(this.value.rawValue=V),this.view.refresh()}}function Si(B){return B!=="false"&&!!B}function dl(B){return function(_){return String(_)}(B)}class Th{constructor(_){this.text=_}evaluate(){return Number(this.text)}toString(){return this.text}}const Ql={"**":(B,_)=>Math.pow(B,_),"*":(B,_)=>B*_,"/":(B,_)=>B/_,"%":(B,_)=>B%_,"+":(B,_)=>B+_,"-":(B,_)=>B-_,"<<":(B,_)=>B<<_,">>":(B,_)=>B>>_,">>>":(B,_)=>B>>>_,"&":(B,_)=>B&_,"^":(B,_)=>B^_,"|":(B,_)=>B|_};class Ec{constructor(_,E,V){this.left=E,this.operator=_,this.right=V}evaluate(){const _=Ql[this.operator];if(!_)throw new Error(`unexpected binary operator: '${this.operator}`);return _(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const Ci={"+":B=>B,"-":B=>-B,"~":B=>~B};class Ad{constructor(_,E){this.operator=_,this.expression=E}evaluate(){const _=Ci[this.operator];if(!_)throw new Error(`unexpected unary operator: '${this.operator}`);return _(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function Sc(B){return(_,E)=>{for(let V=0;V<B.length;V++){const ce=B[V](_,E);if(ce!=="")return ce}return""}}function Hl(B,_){var E;const V=B.substr(_).match(/^\s+/);return(E=V&&V[0])!==null&&E!==void 0?E:""}function Wl(B,_){var E;const V=B.substr(_).match(/^[0-9]+/);return(E=V&&V[0])!==null&&E!==void 0?E:""}function cr(B,_){const E=B.substr(_,1);if(_+=1,E.toLowerCase()!=="e")return"";const V=function(ce,Le){const qe=Wl(ce,Le);if(qe!=="")return qe;const Et=ce.substr(Le,1);if(Et!=="-"&&Et!=="+")return"";const Yt=Wl(ce,Le+=1);return Yt===""?"":Et+Yt}(B,_);return V===""?"":E+V}function $i(B,_){const E=B.substr(_,1);if(E==="0")return E;const V=function(ce,Le){const qe=ce.substr(Le,1);return qe.match(/^[1-9]$/)?qe:""}(B,_);return _+=V.length,V===""?"":V+Wl(B,_)}const pl=Sc([function(B,_){const E=$i(B,_);if(_+=E.length,E==="")return"";const V=B.substr(_,1);if(_+=V.length,V!==".")return"";const ce=Wl(B,_);return E+V+ce+cr(B,_+=ce.length)},function(B,_){const E=B.substr(_,1);if(_+=E.length,E!==".")return"";const V=Wl(B,_);return _+=V.length,V===""?"":E+V+cr(B,_)},function(B,_){const E=$i(B,_);return _+=E.length,E===""?"":E+cr(B,_)}]),yo=Sc([function(B,_){const E=B.substr(_,2);if(_+=E.length,E.toLowerCase()!=="0b")return"";const V=function(ce,Le){var qe;const Et=ce.substr(Le).match(/^[01]+/);return(qe=Et&&Et[0])!==null&&qe!==void 0?qe:""}(B,_);return V===""?"":E+V},function(B,_){const E=B.substr(_,2);if(_+=E.length,E.toLowerCase()!=="0o")return"";const V=function(ce,Le){var qe;const Et=ce.substr(Le).match(/^[0-7]+/);return(qe=Et&&Et[0])!==null&&qe!==void 0?qe:""}(B,_);return V===""?"":E+V},function(B,_){const E=B.substr(_,2);if(_+=E.length,E.toLowerCase()!=="0x")return"";const V=function(ce,Le){var qe;const Et=ce.substr(Le).match(/^[0-9a-f]+/i);return(qe=Et&&Et[0])!==null&&qe!==void 0?qe:""}(B,_);return V===""?"":E+V}]),yd=Sc([yo,pl]);function Cc(B,_){return function(E,V){const ce=yd(E,V);return V+=ce.length,ce===""?null:{evaluable:new Th(ce),cursor:V}}(B,_)||function(E,V){const ce=E.substr(V,1);if(V+=ce.length,ce!=="(")return null;const Le=Ss(E,V);if(!Le)return null;V=Le.cursor,V+=Hl(E,V).length;const qe=E.substr(V,1);return V+=qe.length,qe!==")"?null:{evaluable:Le.evaluable,cursor:V}}(B,_)}function Mc(B,_,E){E+=Hl(_,E).length;const V=B.filter(ce=>_.startsWith(ce,E))[0];return V?(E+=V.length,{cursor:E+=Hl(_,E).length,operator:V}):null}const Su=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((B,_)=>function(E,V){return(ce,Le)=>{const qe=E(ce,Le);if(!qe)return null;Le=qe.cursor;let Et=qe.evaluable;for(;;){const Yt=Mc(V,ce,Le);if(!Yt)break;Le=Yt.cursor;const kn=E(ce,Le);if(!kn)return null;Le=kn.cursor,Et=new Ec(Yt.operator,Et,kn.evaluable)}return Et?{cursor:Le,evaluable:Et}:null}}(B,_),function B(_,E){const V=Cc(_,E);if(V)return V;const ce=_.substr(E,1);if(E+=ce.length,ce!=="+"&&ce!=="-"&&ce!=="~")return null;const Le=B(_,E);return Le?{cursor:E=Le.cursor,evaluable:new Ad(ce,Le.evaluable)}:null});function Ss(B,_){return _+=Hl(B,_).length,Su(B,_)}function ps(B){var _;const E=function(V){const ce=Ss(V,0);return ce?ce.cursor+Hl(V,ce.cursor).length!==V.length?null:ce.evaluable:null}(B);return(_=E==null?void 0:E.evaluate())!==null&&_!==void 0?_:null}function Wo(B){if(typeof B=="number")return B;if(typeof B=="string"){const _=ps(B);if(!X(_))return _}return 0}function Tc(B){return String(B)}function Cr(B){return _=>_.toFixed(Math.max(Math.min(B,20),0))}const bd=Cr(0);function ql(B){return bd(B)+"%"}function Em(B){return String(B)}function Ic(B){return B}function Aa(B,_){for(;B.length<_;)B.push(void 0)}function Mi(B){const _=[];return Aa(_,B),we(_)}function Bp(B){const _=B.indexOf(void 0);return _<0?B:B.slice(0,_)}function Pc({primary:B,secondary:_,forward:E,backward:V}){let ce=!1;function Le(qe){ce||(ce=!0,qe(),ce=!1)}B.emitter.on("change",qe=>{Le(()=>{_.setRawValue(E(B,_),qe.options)})}),_.emitter.on("change",qe=>{Le(()=>{B.setRawValue(V(B,_),qe.options)}),Le(()=>{_.setRawValue(E(B,_),qe.options)})}),Le(()=>{_.setRawValue(E(B,_),{forceEmit:!1,last:!0})})}function io(B,_){const E=B*(_.altKey?.1:1)*(_.shiftKey?10:1);return _.upKey?+E:_.downKey?-E:0}function Cu(B){return{altKey:B.altKey,downKey:B.key==="ArrowDown",shiftKey:B.shiftKey,upKey:B.key==="ArrowUp"}}function Cs(B){return{altKey:B.altKey,downKey:B.key==="ArrowLeft",shiftKey:B.shiftKey,upKey:B.key==="ArrowRight"}}function Ms(B){return function(_){return _==="ArrowUp"||_==="ArrowDown"}(B)||B==="ArrowLeft"||B==="ArrowRight"}function Dc(B,_){const E=_.ownerDocument.defaultView,V=_.getBoundingClientRect();return{x:B.pageX-((E&&E.scrollX||0)+V.left),y:B.pageY-((E&&E.scrollY||0)+V.top)}}class Ts{constructor(_){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=_,this.emitter=new me,_.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),_.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),_.addEventListener("touchend",this.onTouchEnd_),_.addEventListener("mousedown",this.onMouseDown_)}computePosition_(_){const E=this.elem_.getBoundingClientRect();return{bounds:{width:E.width,height:E.height},point:_?{x:_.x,y:_.y}:null}}onMouseDown_(_){var E;_.preventDefault(),(E=_.currentTarget)===null||E===void 0||E.focus();const V=this.elem_.ownerDocument;V.addEventListener("mousemove",this.onDocumentMouseMove_),V.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:_.altKey,data:this.computePosition_(Dc(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onDocumentMouseMove_(_){this.emitter.emit("move",{altKey:_.altKey,data:this.computePosition_(Dc(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onDocumentMouseUp_(_){const E=this.elem_.ownerDocument;E.removeEventListener("mousemove",this.onDocumentMouseMove_),E.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:_.altKey,data:this.computePosition_(Dc(_,this.elem_)),sender:this,shiftKey:_.shiftKey})}onTouchStart_(_){_.preventDefault();const E=_.targetTouches.item(0),V=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:_.altKey,data:this.computePosition_(E?{x:E.clientX-V.left,y:E.clientY-V.top}:void 0),sender:this,shiftKey:_.shiftKey}),this.lastTouch_=E}onTouchMove_(_){const E=_.targetTouches.item(0),V=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:_.altKey,data:this.computePosition_(E?{x:E.clientX-V.left,y:E.clientY-V.top}:void 0),sender:this,shiftKey:_.shiftKey}),this.lastTouch_=E}onTouchEnd_(_){var E;const V=(E=_.targetTouches.item(0))!==null&&E!==void 0?E:this.lastTouch_,ce=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:_.altKey,data:this.computePosition_(V?{x:V.clientX-ce.left,y:V.clientY-ce.top}:void 0),sender:this,shiftKey:_.shiftKey})}}function Oi(B,_,E,V,ce){return V+(B-_)/(E-_)*(ce-V)}function _s(B){return String(B.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function or(B,_,E){return Math.min(Math.max(B,_),E)}function wd(B,_){return(B%_+_)%_}const qo=_e("txt");class Yl{constructor(_,E){this.onChange_=this.onChange_.bind(this),this.props_=E.props,this.props_.emitter.on("change",this.onChange_),this.element=_.createElement("div"),this.element.classList.add(qo(),qo(void 0,"num")),E.arrayPosition&&this.element.classList.add(qo(void 0,E.arrayPosition)),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("input");V.classList.add(qo("i")),V.type="text",E.viewProps.bindDisabled(V),this.element.appendChild(V),this.inputElement=V,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=E.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(qo()),this.inputElement.classList.add(qo("i"));const ce=_.createElement("div");ce.classList.add(qo("k")),this.element.appendChild(ce),this.knobElement=ce;const Le=_.createElementNS(Ie,"svg");Le.classList.add(qo("g")),this.knobElement.appendChild(Le);const qe=_.createElementNS(Ie,"path");qe.classList.add(qo("gb")),Le.appendChild(qe),this.guideBodyElem_=qe;const Et=_.createElementNS(Ie,"path");Et.classList.add(qo("gh")),Le.appendChild(Et),this.guideHeadElem_=Et;const Yt=_.createElement("div");Yt.classList.add(_e("tt")()),this.knobElement.appendChild(Yt),this.tooltipElem_=Yt,E.value.emitter.on("change",this.onChange_),this.value=E.value,this.refresh()}onDraggingChange_(_){if(_.rawValue===null)return void this.element.classList.remove(qo(void 0,"drg"));this.element.classList.add(qo(void 0,"drg"));const E=_.rawValue/this.props_.get("draggingScale"),V=E+(E>0?-1:E<0?1:0),ce=or(-V,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${V+ce},0 L${V},4 L${V+ce},8`,`M ${E},-1 L${E},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${E},4`);const Le=this.props_.get("formatter");this.tooltipElem_.textContent=Le(this.value.rawValue),this.tooltipElem_.style.left=`${E}px`}refresh(){const _=this.props_.get("formatter");this.inputElement.value=_(this.value.rawValue)}onChange_(){this.refresh()}}class Rc{constructor(_,E){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=E.baseStep,this.parser_=E.parser,this.props=E.props,this.value=E.value,this.viewProps=E.viewProps,this.dragging_=we(null),this.view=new Yl(_,{arrayPosition:E.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const V=new Ts(this.view.knobElement);V.emitter.on("down",this.onPointerDown_),V.emitter.on("move",this.onPointerMove_),V.emitter.on("up",this.onPointerUp_)}onInputChange_(_){const E=_.currentTarget.value,V=this.parser_(E);X(V)||(this.value.rawValue=V),this.view.refresh()}onInputKeyDown_(_){const E=io(this.baseStep_,Cu(_));E!==0&&this.value.setRawValue(this.value.rawValue+E,{forceEmit:!1,last:!1})}onInputKeyUp_(_){io(this.baseStep_,Cu(_))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(_){if(!_.point)return null;const E=_.point.x-_.bounds.width/2;return this.originRawValue_+E*this.props.get("draggingScale")}onPointerMove_(_){const E=this.computeDraggingValue_(_.data);E!==null&&(this.value.setRawValue(E,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(_){const E=this.computeDraggingValue_(_.data);E!==null&&(this.value.setRawValue(E,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const Lr=_e("sld");class kp{constructor(_,E){this.onChange_=this.onChange_.bind(this),this.props_=E.props,this.props_.emitter.on("change",this.onChange_),this.element=_.createElement("div"),this.element.classList.add(Lr()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("div");V.classList.add(Lr("t")),E.viewProps.bindTabIndex(V),this.element.appendChild(V),this.trackElement=V;const ce=_.createElement("div");ce.classList.add(Lr("k")),this.trackElement.appendChild(ce),this.knobElement=ce,E.value.emitter.on("change",this.onChange_),this.value=E.value,this.update_()}update_(){const _=or(Oi(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${_}%`}onChange_(){this.update_()}}class Op{constructor(_,E){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=E.baseStep,this.value=E.value,this.viewProps=E.viewProps,this.props=E.props,this.view=new kp(_,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(_,E){_.point&&this.value.setRawValue(Oi(or(_.point.x,0,_.bounds.width),0,_.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),E)}onPointerDownOrMove_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerUp_(_){this.handlePointerEvent_(_.data,{forceEmit:!0,last:!0})}onKeyDown_(_){const E=io(this.baseStep_,Cs(_));E!==0&&this.value.setRawValue(this.value.rawValue+E,{forceEmit:!1,last:!1})}onKeyUp_(_){io(this.baseStep_,Cs(_))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Hs=_e("sldtxt");class Lp{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Hs());const V=_.createElement("div");V.classList.add(Hs("s")),this.sliderView_=E.sliderView,V.appendChild(this.sliderView_.element),this.element.appendChild(V);const ce=_.createElement("div");ce.classList.add(Hs("t")),this.textView_=E.textView,ce.appendChild(this.textView_.element),this.element.appendChild(ce)}}class Yo{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.sliderC_=new Op(_,{baseStep:E.baseStep,props:E.sliderProps,value:E.value,viewProps:this.viewProps}),this.textC_=new Rc(_,{baseStep:E.baseStep,parser:E.parser,props:E.textProps,value:E.value,viewProps:E.viewProps}),this.view=new Lp(_,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Xl(B,_){B.write(_)}function Mu(B){const _=xt;return Array.isArray(B)?_.required.array(_.required.object({text:_.required.string,value:_.required.raw}))(B).value:typeof B=="object"?_.required.raw(B).value:void 0}function Sm(B){if(B==="inline"||B==="popup")return B}function za(B){const _=xt;return _.required.object({max:_.optional.number,min:_.optional.number,step:_.optional.number})(B).value}function Bc(B){if(Array.isArray(B))return B;const _=[];return Object.keys(B).forEach(E=>{_.push({text:E,value:B[E]})}),_}function Nr(B){return X(B)?null:new pr(Bc(B))}function xd(B){const _=B?Bi(B,pr):null;return _?_.options:null}function Ed(B,_){const E=B&&Bi(B,us);return E?_s(E.step):Math.max(_s(_),2)}function fl(B){const _=function(E){const V=E?Bi(E,us):null;return V?V.step:null}(B);return _??1}function kc(B,_){var E;const V=B&&Bi(B,us),ce=Math.abs((E=V==null?void 0:V.step)!==null&&E!==void 0?E:_);return ce===0?.1:Math.pow(10,Math.floor(Math.log10(ce))-1)}const Tu=_e("ckb");class Sd{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),this.element=_.createElement("div"),this.element.classList.add(Tu()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("label");V.classList.add(Tu("l")),this.element.appendChild(V);const ce=_.createElement("input");ce.classList.add(Tu("i")),ce.type="checkbox",V.appendChild(ce),this.inputElement=ce,E.viewProps.bindDisabled(this.inputElement);const Le=_.createElement("div");Le.classList.add(Tu("w")),V.appendChild(Le);const qe=pe(_,"check");Le.appendChild(qe),E.value.emitter.on("change",this.onValueChange_),this.value=E.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class L_{constructor(_,E){this.onInputChange_=this.onInputChange_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.view=new Sd(_,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(_){const E=_.currentTarget;this.value.rawValue=E.checked}}const Cm={id:"input-bool",type:"input",accept:(B,_)=>{if(typeof B!="boolean")return null;const E=ct(_,{options:xt.optional.custom(Mu)});return E?{initialValue:B,params:E}:null},binding:{reader:B=>Si,constraint:B=>function(_){const E=[],V=Nr(_.options);return V&&E.push(V),new sr(E)}(B.params),writer:B=>Xl},controller:B=>{var _;const E=B.document,V=B.value,ce=B.constraint;return ce&&Bi(ce,pr)?new wr(E,{props:tt.fromObject({options:(_=xd(ce))!==null&&_!==void 0?_:[]}),value:V,viewProps:B.viewProps}):new L_(E,{value:V,viewProps:B.viewProps})}},ml=_e("col");class Cd{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(ml()),E.foldable.bindExpandedClass(this.element,ml(void 0,"expanded")),Se(E.foldable,"completed",je(this.element,ml(void 0,"cpl")));const V=_.createElement("div");V.classList.add(ml("h")),this.element.appendChild(V);const ce=_.createElement("div");ce.classList.add(ml("s")),V.appendChild(ce),this.swatchElement=ce;const Le=_.createElement("div");if(Le.classList.add(ml("t")),V.appendChild(Le),this.textElement=Le,E.pickerLayout==="inline"){const qe=_.createElement("div");qe.classList.add(ml("p")),this.element.appendChild(qe),this.pickerElement=qe}else this.pickerElement=null}}function ei(B,_,E){const V=wd(B,360),ce=or(_/100,0,1),Le=or(E/100,0,1),qe=Le*ce,Et=qe*(1-Math.abs(V/60%2-1)),Yt=Le-qe;let kn,Hn,In;return[kn,Hn,In]=V>=0&&V<60?[qe,Et,0]:V>=60&&V<120?[Et,qe,0]:V>=120&&V<180?[0,qe,Et]:V>=180&&V<240?[0,Et,qe]:V>=240&&V<300?[Et,0,qe]:[qe,0,Et],[255*(kn+Yt),255*(Hn+Yt),255*(In+Yt)]}function Zr(B){return[B[0],B[1],B[2]]}function Np(B,_){return[B[0],B[1],B[2],_]}const Oc={hsl:{hsl:(B,_,E)=>[B,_,E],hsv:function(B,_,E){const V=E+_*(100-Math.abs(2*E-100))/200;return[B,V!==0?_*(100-Math.abs(2*E-100))/V:0,E+_*(100-Math.abs(2*E-100))/200]},rgb:function(B,_,E){const V=(B%360+360)%360,ce=or(_/100,0,1),Le=or(E/100,0,1),qe=(1-Math.abs(2*Le-1))*ce,Et=qe*(1-Math.abs(V/60%2-1)),Yt=Le-qe/2;let kn,Hn,In;return[kn,Hn,In]=V>=0&&V<60?[qe,Et,0]:V>=60&&V<120?[Et,qe,0]:V>=120&&V<180?[0,qe,Et]:V>=180&&V<240?[0,Et,qe]:V>=240&&V<300?[Et,0,qe]:[qe,0,Et],[255*(kn+Yt),255*(Hn+Yt),255*(In+Yt)]}},hsv:{hsl:function(B,_,E){const V=100-Math.abs(E*(200-_)/100-100);return[B,V!==0?_*E/V:0,E*(200-_)/200]},hsv:(B,_,E)=>[B,_,E],rgb:ei},rgb:{hsl:function(B,_,E){const V=or(B/255,0,1),ce=or(_/255,0,1),Le=or(E/255,0,1),qe=Math.max(V,ce,Le),Et=Math.min(V,ce,Le),Yt=qe-Et;let kn=0,Hn=0;const In=(Et+qe)/2;return Yt!==0&&(Hn=Yt/(1-Math.abs(qe+Et-1)),kn=V===qe?(ce-Le)/Yt:ce===qe?2+(Le-V)/Yt:4+(V-ce)/Yt,kn=kn/6+(kn<0?1:0)),[360*kn,100*Hn,100*In]},hsv:function(B,_,E){const V=or(B/255,0,1),ce=or(_/255,0,1),Le=or(E/255,0,1),qe=Math.max(V,ce,Le),Et=qe-Math.min(V,ce,Le);let Yt;return Yt=Et===0?0:qe===V?((ce-Le)/Et%6+6)%6*60:qe===ce?60*((Le-V)/Et+2):60*((V-ce)/Et+4),[Yt,100*(qe===0?0:Et/qe),100*qe]},rgb:(B,_,E)=>[B,_,E]}},Ih={hsl:B=>{var _;return[wd(B[0],360),or(B[1],0,100),or(B[2],0,100),or((_=B[3])!==null&&_!==void 0?_:1,0,1)]},hsv:B=>{var _;return[wd(B[0],360),or(B[1],0,100),or(B[2],0,100),or((_=B[3])!==null&&_!==void 0?_:1,0,1)]},rgb:B=>{var _;return[or(B[0],0,255),or(B[1],0,255),or(B[2],0,255),or((_=B[3])!==null&&_!==void 0?_:1,0,1)]}};function Ws(B,_){return typeof B=="object"&&!X(B)&&_ in B&&typeof B[_]=="number"}class Vn{constructor(_,E){this.mode_=E,this.comps_=Ih[E](_)}static black(){return new Vn([0,0,0],"rgb")}static fromObject(_){const E="a"in _?[_.r,_.g,_.b,_.a]:[_.r,_.g,_.b];return new Vn(E,"rgb")}static toRgbaObject(_){return _.toRgbaObject()}static isRgbColorObject(_){return Ws(_,"r")&&Ws(_,"g")&&Ws(_,"b")}static isRgbaColorObject(_){return this.isRgbColorObject(_)&&Ws(_,"a")}static isColorObject(_){return this.isRgbColorObject(_)}static equals(_,E){if(_.mode_!==E.mode_)return!1;const V=_.comps_,ce=E.comps_;for(let Le=0;Le<V.length;Le++)if(V[Le]!==ce[Le])return!1;return!0}get mode(){return this.mode_}getComponents(_){return Np((E=Zr(this.comps_),V=this.mode_,ce=_||this.mode_,Oc[V][ce](...E)),this.comps_[3]);var E,V,ce}toRgbaObject(){const _=this.getComponents("rgb");return{r:_[0],g:_[1],b:_[2],a:_[3]}}}const Va=_e("colp");class Ph{constructor(_,E){this.alphaViews_=null,this.element=_.createElement("div"),this.element.classList.add(Va());const V=_.createElement("div");V.classList.add(Va("hsv"));const ce=_.createElement("div");ce.classList.add(Va("sv")),this.svPaletteView_=E.svPaletteView,ce.appendChild(this.svPaletteView_.element),V.appendChild(ce);const Le=_.createElement("div");Le.classList.add(Va("h")),this.hPaletteView_=E.hPaletteView,Le.appendChild(this.hPaletteView_.element),V.appendChild(Le),this.element.appendChild(V);const qe=_.createElement("div");if(qe.classList.add(Va("rgb")),this.textView_=E.textView,qe.appendChild(this.textView_.element),this.element.appendChild(qe),E.alphaViews){this.alphaViews_={palette:E.alphaViews.palette,text:E.alphaViews.text};const Et=_.createElement("div");Et.classList.add(Va("a"));const Yt=_.createElement("div");Yt.classList.add(Va("ap")),Yt.appendChild(this.alphaViews_.palette.element),Et.appendChild(Yt);const kn=_.createElement("div");kn.classList.add(Va("at")),kn.appendChild(this.alphaViews_.text.element),Et.appendChild(kn),this.element.appendChild(Et)}}get allFocusableElements(){const _=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(E=>E.inputElement)];return this.alphaViews_&&_.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),_}}function Dh(B){const _=xt;return ct(B,{alpha:_.optional.boolean,expanded:_.optional.boolean,picker:_.optional.custom(Sm)})}function Kl(B){return B?.1:1}function ro(B,_){const E=B.match(/^(.+)%$/);return Math.min(E?.01*parseFloat(E[1])*_:parseFloat(B),_)}const gl={deg:B=>B,grad:B=>360*B/400,rad:B=>360*B/(2*Math.PI),turn:B=>360*B};function vr(B){const _=B.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!_)return parseFloat(B);const E=parseFloat(_[1]),V=_[2];return gl[V](E)}const Md={"func.rgb":B=>{const _=B.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!_)return null;const E=[ro(_[1],255),ro(_[2],255),ro(_[3],255)];return isNaN(E[0])||isNaN(E[1])||isNaN(E[2])?null:new Vn(E,"rgb")},"func.rgba":B=>{const _=B.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!_)return null;const E=[ro(_[1],255),ro(_[2],255),ro(_[3],255),ro(_[4],1)];return isNaN(E[0])||isNaN(E[1])||isNaN(E[2])||isNaN(E[3])?null:new Vn(E,"rgb")},"func.hsl":B=>{const _=B.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!_)return null;const E=[vr(_[1]),ro(_[2],100),ro(_[3],100)];return isNaN(E[0])||isNaN(E[1])||isNaN(E[2])?null:new Vn(E,"hsl")},"func.hsla":B=>{const _=B.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!_)return null;const E=[vr(_[1]),ro(_[2],100),ro(_[3],100),ro(_[4],1)];return isNaN(E[0])||isNaN(E[1])||isNaN(E[2])||isNaN(E[3])?null:new Vn(E,"hsl")},"hex.rgb":B=>{const _=B.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(_)return new Vn([parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16)],"rgb");const E=B.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return E?new Vn([parseInt(E[1],16),parseInt(E[2],16),parseInt(E[3],16)],"rgb"):null},"hex.rgba":B=>{const _=B.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(_)return new Vn([parseInt(_[1]+_[1],16),parseInt(_[2]+_[2],16),parseInt(_[3]+_[3],16),Oi(parseInt(_[4]+_[4],16),0,255,0,1)],"rgb");const E=B.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return E?new Vn([parseInt(E[1],16),parseInt(E[2],16),parseInt(E[3],16),Oi(parseInt(E[4],16),0,255,0,1)],"rgb"):null}};function Xt(B){return Object.keys(Md).reduce((_,E)=>_||((0,Md[E])(B)?E:null),null)}const Is=B=>{const _=Xt(B);return _?Md[_](B):null};function Mm(B){return B==="func.hsla"||B==="func.rgba"||B==="hex.rgba"}function Fp(B){if(typeof B=="string"){const _=Is(B);if(_)return _}return Vn.black()}function Lc(B){const _=or(Math.floor(B),0,255).toString(16);return _.length===1?`0${_}`:_}function Nc(B,_="#"){return`${_}${Zr(B.getComponents("rgb")).map(Lc).join("")}`}function ya(B,_="#"){const E=B.getComponents("rgb");return`${_}${[E[0],E[1],E[2],255*E[3]].map(Lc).join("")}`}function Rh(B){const _=Cr(0);return`rgb(${Zr(B.getComponents("rgb")).map(E=>_(E)).join(", ")})`}function Iu(B){const _=Cr(2),E=Cr(0);return`rgba(${B.getComponents("rgb").map((V,ce)=>(ce===3?_:E)(V)).join(", ")})`}const qs={"func.hsl":function(B){const _=[Cr(0),ql,ql];return`hsl(${Zr(B.getComponents("hsl")).map((E,V)=>_[V](E)).join(", ")})`},"func.hsla":function(B){const _=[Cr(0),ql,ql,Cr(2)];return`hsla(${B.getComponents("hsl").map((E,V)=>_[V](E)).join(", ")})`},"func.rgb":Rh,"func.rgba":Iu,"hex.rgb":Nc,"hex.rgba":ya};function Td(B){return qs[B]}const Fr=_e("apl");class Xo{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),this.value=E.value,this.value.emitter.on("change",this.onValueChange_),this.element=_.createElement("div"),this.element.classList.add(Fr()),E.viewProps.bindTabIndex(this.element);const V=_.createElement("div");V.classList.add(Fr("b")),this.element.appendChild(V);const ce=_.createElement("div");ce.classList.add(Fr("c")),V.appendChild(ce),this.colorElem_=ce;const Le=_.createElement("div");Le.classList.add(Fr("m")),this.element.appendChild(Le),this.markerElem_=Le;const qe=_.createElement("div");qe.classList.add(Fr("p")),this.markerElem_.appendChild(qe),this.previewElem_=qe,this.update_()}update_(){const _=this.value.rawValue,E=_.getComponents("rgb"),V=new Vn([E[0],E[1],E[2],0],"rgb"),ce=new Vn([E[0],E[1],E[2],255],"rgb"),Le=["to right",Iu(V),Iu(ce)];this.colorElem_.style.background=`linear-gradient(${Le.join(",")})`,this.previewElem_.style.backgroundColor=Iu(_);const qe=Oi(E[3],0,1,0,100);this.markerElem_.style.left=`${qe}%`}onValueChange_(){this.update_()}}class Pu{constructor(_,E){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.view=new Xo(_,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(_,E){if(!_.point)return;const V=_.point.x/_.bounds.width,ce=this.value.rawValue,[Le,qe,Et]=ce.getComponents("hsv");this.value.setRawValue(new Vn([Le,qe,Et,V],"hsv"),E)}onPointerDown_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerMove_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerUp_(_){this.handlePointerEvent_(_.data,{forceEmit:!0,last:!0})}onKeyDown_(_){const E=io(Kl(!0),Cs(_));if(E===0)return;const V=this.value.rawValue,[ce,Le,qe,Et]=V.getComponents("hsv");this.value.setRawValue(new Vn([ce,Le,qe,Et+E],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(_){io(Kl(!0),Cs(_))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Ro=_e("coltxt");class Id{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Ro());const V=_.createElement("div");V.classList.add(Ro("m")),this.modeElem_=function(qe){const Et=qe.createElement("select");return Et.appendChild([{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}].reduce((Yt,kn)=>{const Hn=qe.createElement("option");return Hn.textContent=kn.text,Hn.value=kn.value,Yt.appendChild(Hn),Yt},qe.createDocumentFragment())),Et}(_),this.modeElem_.classList.add(Ro("ms")),V.appendChild(this.modeSelectElement);const ce=_.createElement("div");ce.classList.add(Ro("mm")),ce.appendChild(pe(_,"dropdown")),V.appendChild(ce),this.element.appendChild(V);const Le=_.createElement("div");Le.classList.add(Ro("w")),this.element.appendChild(Le),this.textsElem_=Le,this.textViews_=E.textViews,this.applyTextViews_(),ge(E.colorMode,qe=>{this.modeElem_.value=qe})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(_){this.textViews_=_,this.applyTextViews_()}applyTextViews_(){zt(this.textsElem_);const _=this.element.ownerDocument;this.textViews_.forEach(E=>{const V=_.createElement("div");V.classList.add(Ro("c")),V.appendChild(E.element),this.textsElem_.appendChild(V)})}}const bn=Cr(0),Ko={rgb:()=>new Ri({min:0,max:255}),hsl:B=>new Ri(B===0?{min:0,max:360}:{min:0,max:100}),hsv:B=>new Ri(B===0?{min:0,max:360}:{min:0,max:100})};function Bh(B,_,E){return new Rc(B,{arrayPosition:E===0?"fst":E===2?"lst":"mid",baseStep:Kl(!1),parser:_.parser,props:tt.fromObject({draggingScale:1,formatter:bn}),value:we(0,{constraint:Ko[_.colorMode](E)}),viewProps:_.viewProps})}class Fc{constructor(_,E){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=E.parser,this.value=E.value,this.viewProps=E.viewProps,this.colorMode=we(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(_),this.view=new Id(_,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(_){const E={colorMode:this.colorMode.rawValue,parser:this.parser_,viewProps:this.viewProps},V=[Bh(_,E,0),Bh(_,E,1),Bh(_,E,2)];return V.forEach((ce,Le)=>{Pc({primary:this.value,secondary:ce.value,forward:qe=>qe.rawValue.getComponents(this.colorMode.rawValue)[Le],backward:(qe,Et)=>{const Yt=this.colorMode.rawValue,kn=qe.rawValue.getComponents(Yt);return kn[Le]=Et.rawValue,new Vn(Np(Zr(kn),kn[3]),Yt)}})}),V}onModeSelectChange_(_){const E=_.currentTarget;this.colorMode.rawValue=E.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const Du=_e("hpl");class Up{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),this.value=E.value,this.value.emitter.on("change",this.onValueChange_),this.element=_.createElement("div"),this.element.classList.add(Du()),E.viewProps.bindTabIndex(this.element);const V=_.createElement("div");V.classList.add(Du("c")),this.element.appendChild(V);const ce=_.createElement("div");ce.classList.add(Du("m")),this.element.appendChild(ce),this.markerElem_=ce,this.update_()}update_(){const _=this.value.rawValue,[E]=_.getComponents("hsv");this.markerElem_.style.backgroundColor=Rh(new Vn([E,100,100],"hsv"));const V=Oi(E,0,360,0,100);this.markerElem_.style.left=`${V}%`}onValueChange_(){this.update_()}}class fs{constructor(_,E){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.view=new Up(_,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(_,E){if(!_.point)return;const V=Oi(or(_.point.x,0,_.bounds.width),0,_.bounds.width,0,359),ce=this.value.rawValue,[,Le,qe,Et]=ce.getComponents("hsv");this.value.setRawValue(new Vn([V,Le,qe,Et],"hsv"),E)}onPointerDown_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerMove_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerUp_(_){this.handlePointerEvent_(_.data,{forceEmit:!0,last:!0})}onKeyDown_(_){const E=io(Kl(!1),Cs(_));if(E===0)return;const V=this.value.rawValue,[ce,Le,qe,Et]=V.getComponents("hsv");this.value.setRawValue(new Vn([ce+E,Le,qe,Et],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(_){io(Kl(!1),Cs(_))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Zi=_e("svp");class bo{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),this.value=E.value,this.value.emitter.on("change",this.onValueChange_),this.element=_.createElement("div"),this.element.classList.add(Zi()),E.viewProps.bindTabIndex(this.element);const V=_.createElement("canvas");V.height=64,V.width=64,V.classList.add(Zi("c")),this.element.appendChild(V),this.canvasElement=V;const ce=_.createElement("div");ce.classList.add(Zi("m")),this.element.appendChild(ce),this.markerElem_=ce,this.update_()}update_(){const _=function(kn){const Hn=kn.ownerDocument.defaultView;return Hn&&"document"in Hn?kn.getContext("2d"):null}(this.canvasElement);if(!_)return;const E=this.value.rawValue.getComponents("hsv"),V=this.canvasElement.width,ce=this.canvasElement.height,Le=_.getImageData(0,0,V,ce),qe=Le.data;for(let kn=0;kn<ce;kn++)for(let Hn=0;Hn<V;Hn++){const In=Oi(Hn,0,V,0,100),Tr=Oi(kn,0,ce,100,0),es=ei(E[0],In,Tr),aa=4*(kn*V+Hn);qe[aa]=es[0],qe[aa+1]=es[1],qe[aa+2]=es[2],qe[aa+3]=255}_.putImageData(Le,0,0);const Et=Oi(E[1],0,100,0,100);this.markerElem_.style.left=`${Et}%`;const Yt=Oi(E[2],0,100,100,0);this.markerElem_.style.top=`${Yt}%`}onValueChange_(){this.update_()}}class Ru{constructor(_,E){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.view=new bo(_,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(_,E){if(!_.point)return;const V=Oi(_.point.x,0,_.bounds.width,0,100),ce=Oi(_.point.y,0,_.bounds.height,100,0),[Le,,,qe]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Vn([Le,V,ce,qe],"hsv"),E)}onPointerDown_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerMove_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerUp_(_){this.handlePointerEvent_(_.data,{forceEmit:!0,last:!0})}onKeyDown_(_){Ms(_.key)&&_.preventDefault();const[E,V,ce,Le]=this.value.rawValue.getComponents("hsv"),qe=Kl(!1),Et=io(qe,Cs(_)),Yt=io(qe,Cu(_));Et===0&&Yt===0||this.value.setRawValue(new Vn([E,V+Et,ce+Yt,Le],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(_){const E=Kl(!1),V=io(E,Cs(_)),ce=io(E,Cu(_));V===0&&ce===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Tm{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.hPaletteC_=new fs(_,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new Ru(_,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=E.supportsAlpha?{palette:new Pu(_,{value:this.value,viewProps:this.viewProps}),text:new Rc(_,{parser:ps,baseStep:.1,props:tt.fromObject({draggingScale:.01,formatter:Cr(2)}),value:we(0,{constraint:new Ri({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Pc({primary:this.value,secondary:this.alphaIcs_.text.value,forward:V=>V.rawValue.getComponents()[3],backward:(V,ce)=>{const Le=V.rawValue.getComponents();return Le[3]=ce.rawValue,new Vn(Le,V.rawValue.mode)}}),this.textC_=new Fc(_,{parser:ps,value:this.value,viewProps:this.viewProps}),this.view=new Ph(_,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:E.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Uc=_e("colsw");class Pd{constructor(_,E){this.onValueChange_=this.onValueChange_.bind(this),E.value.emitter.on("change",this.onValueChange_),this.value=E.value,this.element=_.createElement("div"),this.element.classList.add(Uc()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("div");V.classList.add(Uc("sw")),this.element.appendChild(V),this.swatchElem_=V;const ce=_.createElement("button");ce.classList.add(Uc("b")),E.viewProps.bindDisabled(ce),this.element.appendChild(ce),this.buttonElement=ce,this.update_()}update_(){const _=this.value.rawValue;this.swatchElem_.style.backgroundColor=ya(_)}onValueChange_(){this.update_()}}class Jo{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.view=new Pd(_,{value:this.value,viewProps:this.viewProps})}}class Ps{constructor(_,E){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.foldable_=qn.create(E.expanded),this.swatchC_=new Jo(_,{value:this.value,viewProps:this.viewProps});const V=this.swatchC_.view.buttonElement;V.addEventListener("blur",this.onButtonBlur_),V.addEventListener("click",this.onButtonClick_),this.textC_=new Ji(_,{parser:E.parser,props:tt.fromObject({formatter:E.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Cd(_,{foldable:this.foldable_,pickerLayout:E.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=E.pickerLayout==="popup"?new wn(_,{viewProps:this.viewProps}):null;const ce=new Tm(_,{supportsAlpha:E.supportsAlpha,value:this.value,viewProps:this.viewProps});ce.view.allFocusableElements.forEach(Le=>{Le.addEventListener("blur",this.onPopupChildBlur_),Le.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=ce,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(ce.view.element),Pc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:Le=>Le.rawValue,backward:(Le,qe)=>qe.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),mi(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(_){if(!this.popC_)return;const E=this.view.element,V=_.relatedTarget;V&&E.contains(V)||(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(_){if(!this.popC_)return;const E=this.popC_.view.element,V=Wt(_);V&&E.contains(V)||V&&V===this.swatchC_.view.buttonElement&&!ft(E.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(_){this.popC_?_.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&_.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Re(B){return Vn.isColorObject(B)?Vn.fromObject(B):Vn.black()}function _l(B){return Zr(B.getComponents("rgb")).reduce((_,E)=>_<<8|255&Math.floor(E),0)}function $o(B){return B.getComponents("rgb").reduce((_,E,V)=>_<<8|255&Math.floor(V===3?255*E:E),0)>>>0}function jc(B){return typeof B!="number"?Vn.black():new Vn([(_=B)>>16&255,_>>8&255,255&_],"rgb");var _}function vl(B){return typeof B!="number"?Vn.black():new Vn([(_=B)>>24&255,_>>16&255,_>>8&255,Oi(255&_,0,255,0,1)],"rgb");var _}function zc(B,_){const E=_.toRgbaObject();B.writeProperty("r",E.r),B.writeProperty("g",E.g),B.writeProperty("b",E.b),B.writeProperty("a",E.a)}function Dd(B,_){const E=_.toRgbaObject();B.writeProperty("r",E.r),B.writeProperty("g",E.g),B.writeProperty("b",E.b)}function ba(B){return"alpha"in B&&B.alpha===!0}function Jl(B){return B?_=>ya(_,"0x"):_=>Nc(_,"0x")}const Al={id:"input-color-number",type:"input",accept:(B,_)=>{if(typeof B!="number"||!("view"in _)||_.view!=="color")return null;const E=Dh(_);return E?{initialValue:B,params:E}:null},binding:{reader:B=>ba(B.params)?vl:jc,equals:Vn.equals,writer:B=>function(_){const E=_?$o:_l;return(V,ce)=>{Xl(V,E(ce))}}(ba(B.params))},controller:B=>{const _=ba(B.params),E="expanded"in B.params?B.params.expanded:void 0,V="picker"in B.params?B.params.picker:void 0;return new Ps(B.document,{expanded:E!=null&&E,formatter:Jl(_),parser:Is,pickerLayout:V??"popup",supportsAlpha:_,value:B.value,viewProps:B.viewProps})}},wa={id:"input-color-object",type:"input",accept:(B,_)=>{if(!Vn.isColorObject(B))return null;const E=Dh(_);return E?{initialValue:B,params:E}:null},binding:{reader:B=>Re,equals:Vn.equals,writer:B=>{return _=B.initialValue,Vn.isRgbaColorObject(_)?zc:Dd;var _}},controller:B=>{const _=Vn.isRgbaColorObject(B.initialValue),E="expanded"in B.params?B.params.expanded:void 0,V="picker"in B.params?B.params.picker:void 0,ce=_?ya:Nc;return new Ps(B.document,{expanded:E!=null&&E,formatter:ce,parser:Is,pickerLayout:V??"popup",supportsAlpha:_,value:B.value,viewProps:B.viewProps})}},$l={id:"input-color-string",type:"input",accept:(B,_)=>{if(typeof B!="string"||"view"in _&&_.view==="text"||!Xt(B))return null;const E=Dh(_);return E?{initialValue:B,params:E}:null},binding:{reader:B=>Fp,equals:Vn.equals,writer:B=>{const _=Xt(B.initialValue);if(!_)throw fe.shouldNeverHappen();return function(E){const V=Td(E);return(ce,Le)=>{Xl(ce,V(Le))}}(_)}},controller:B=>{const _=Xt(B.initialValue);if(!_)throw fe.shouldNeverHappen();const E=Td(_),V="expanded"in B.params?B.params.expanded:void 0,ce="picker"in B.params?B.params.picker:void 0;return new Ps(B.document,{expanded:V!=null&&V,formatter:E,parser:Is,pickerLayout:ce??"popup",supportsAlpha:Mm(_),value:B.value,viewProps:B.viewProps})}};class wo{constructor(_){this.components=_.components,this.asm_=_.assembly}constrain(_){const E=this.asm_.toComponents(_).map((V,ce)=>{var Le,qe;return(qe=(Le=this.components[ce])===null||Le===void 0?void 0:Le.constrain(V))!==null&&qe!==void 0?qe:V});return this.asm_.fromComponents(E)}}const Bu=_e("pndtxt");class Rd{constructor(_,E){this.textViews=E.textViews,this.element=_.createElement("div"),this.element.classList.add(Bu()),this.textViews.forEach(V=>{const ce=_.createElement("div");ce.classList.add(Bu("a")),ce.appendChild(V.element),this.element.appendChild(ce)})}}class Vc{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.acs_=E.axes.map((V,ce)=>function(Le,qe,Et){return new Rc(Le,{arrayPosition:Et===0?"fst":Et===qe.axes.length-1?"lst":"mid",baseStep:qe.axes[Et].baseStep,parser:qe.parser,props:qe.axes[Et].textProps,value:we(0,{constraint:qe.axes[Et].constraint}),viewProps:qe.viewProps})}(_,E,ce)),this.acs_.forEach((V,ce)=>{Pc({primary:this.value,secondary:V.value,forward:Le=>E.assembly.toComponents(Le.rawValue)[ce],backward:(Le,qe)=>{const Et=E.assembly.toComponents(Le.rawValue);return Et[ce]=qe.rawValue,E.assembly.fromComponents(Et)}})}),this.view=new Rd(_,{textViews:this.acs_.map(V=>V.view)})}}function Zl(B){const _=[],E=function(Le){return"step"in Le&&!X(Le.step)?new us(Le.step):null}(B);E&&_.push(E);const V=function(Le){return"max"in Le&&!X(Le.max)||"min"in Le&&!X(Le.min)?new Ri({max:Le.max,min:Le.min}):null}(B);V&&_.push(V);const ce=Nr(B.options);return ce&&_.push(ce),new sr(_)}function Bd(B){const[_,E]=function(V){const ce=V?Bi(V,Ri):null;return ce?[ce.minValue,ce.maxValue]:[void 0,void 0]}(B);return[_??0,E??100]}const Li={id:"input-number",type:"input",accept:(B,_)=>{if(typeof B!="number")return null;const E=xt,V=ct(_,{format:E.optional.function,max:E.optional.number,min:E.optional.number,options:E.optional.custom(Mu),step:E.optional.number});return V?{initialValue:B,params:V}:null},binding:{reader:B=>Wo,constraint:B=>Zl(B.params),writer:B=>Xl},controller:B=>{var _,E;const V=B.value,ce=B.constraint;if(ce&&Bi(ce,pr))return new wr(B.document,{props:tt.fromObject({options:(_=xd(ce))!==null&&_!==void 0?_:[]}),value:V,viewProps:B.viewProps});const Le=(E="format"in B.params?B.params.format:void 0)!==null&&E!==void 0?E:Cr(Ed(ce,V.rawValue));if(ce&&Bi(ce,Ri)){const[qe,Et]=Bd(ce);return new Yo(B.document,{baseStep:fl(ce),parser:ps,sliderProps:tt.fromObject({maxValue:Et,minValue:qe}),textProps:tt.fromObject({draggingScale:kc(ce,V.rawValue),formatter:Le}),value:V,viewProps:B.viewProps})}return new Rc(B.document,{baseStep:fl(ce),parser:ps,props:tt.fromObject({draggingScale:kc(ce,V.rawValue),formatter:Le}),value:V,viewProps:B.viewProps})}};class Mr{constructor(_=0,E=0){this.x=_,this.y=E}getComponents(){return[this.x,this.y]}static isObject(_){if(X(_))return!1;const E=_.x,V=_.y;return typeof E=="number"&&typeof V=="number"}static equals(_,E){return _.x===E.x&&_.y===E.y}toObject(){return{x:this.x,y:this.y}}}const Zo={toComponents:B=>B.getComponents(),fromComponents:B=>new Mr(...B)},Bo=_e("p2d");class ea{constructor(_,E){this.element=_.createElement("div"),this.element.classList.add(Bo()),E.viewProps.bindClassModifiers(this.element),ge(E.expanded,je(this.element,Bo(void 0,"expanded")));const V=_.createElement("div");V.classList.add(Bo("h")),this.element.appendChild(V);const ce=_.createElement("button");ce.classList.add(Bo("b")),ce.appendChild(pe(_,"p2dpad")),E.viewProps.bindDisabled(ce),V.appendChild(ce),this.buttonElement=ce;const Le=_.createElement("div");if(Le.classList.add(Bo("t")),V.appendChild(Le),this.textElement=Le,E.pickerLayout==="inline"){const qe=_.createElement("div");qe.classList.add(Bo("p")),this.element.appendChild(qe),this.pickerElement=qe}else this.pickerElement=null}}const hs=_e("p2dp");class kd{constructor(_,E){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=E.invertsY,this.maxValue_=E.maxValue,this.element=_.createElement("div"),this.element.classList.add(hs()),E.layout==="popup"&&this.element.classList.add(hs(void 0,"p"));const V=_.createElement("div");V.classList.add(hs("p")),E.viewProps.bindTabIndex(V),this.element.appendChild(V),this.padElement=V;const ce=_.createElementNS(Ie,"svg");ce.classList.add(hs("g")),this.padElement.appendChild(ce),this.svgElem_=ce;const Le=_.createElementNS(Ie,"line");Le.classList.add(hs("ax")),Le.setAttributeNS(null,"x1","0"),Le.setAttributeNS(null,"y1","50%"),Le.setAttributeNS(null,"x2","100%"),Le.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(Le);const qe=_.createElementNS(Ie,"line");qe.classList.add(hs("ax")),qe.setAttributeNS(null,"x1","50%"),qe.setAttributeNS(null,"y1","0"),qe.setAttributeNS(null,"x2","50%"),qe.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(qe);const Et=_.createElementNS(Ie,"line");Et.classList.add(hs("l")),Et.setAttributeNS(null,"x1","50%"),Et.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(Et),this.lineElem_=Et;const Yt=_.createElement("div");Yt.classList.add(hs("m")),this.padElement.appendChild(Yt),this.markerElem_=Yt,E.value.emitter.on("change",this.onValueChange_),this.value=E.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[_,E]=this.value.rawValue.getComponents(),V=this.maxValue_,ce=Oi(_,-V,+V,0,100),Le=Oi(E,-V,+V,0,100),qe=this.invertsY_?100-Le:Le;this.lineElem_.setAttributeNS(null,"x2",`${ce}%`),this.lineElem_.setAttributeNS(null,"y2",`${qe}%`),this.markerElem_.style.left=`${ce}%`,this.markerElem_.style.top=`${qe}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ku(B,_,E){return[io(_[0],Cs(B)),io(_[1],Cu(B))*(E?1:-1)]}class Ga{constructor(_,E){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.baseSteps_=E.baseSteps,this.maxValue_=E.maxValue,this.invertsY_=E.invertsY,this.view=new kd(_,{invertsY:this.invertsY_,layout:E.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new Ts(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(_,E){if(!_.point)return;const V=this.maxValue_,ce=Oi(_.point.x,0,_.bounds.width,-V,+V),Le=Oi(this.invertsY_?_.bounds.height-_.point.y:_.point.y,0,_.bounds.height,-V,+V);this.value.setRawValue(new Mr(ce,Le),E)}onPointerDown_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerMove_(_){this.handlePointerEvent_(_.data,{forceEmit:!1,last:!1})}onPointerUp_(_){this.handlePointerEvent_(_.data,{forceEmit:!0,last:!0})}onPadKeyDown_(_){Ms(_.key)&&_.preventDefault();const[E,V]=ku(_,this.baseSteps_,this.invertsY_);E===0&&V===0||this.value.setRawValue(new Mr(this.value.rawValue.x+E,this.value.rawValue.y+V),{forceEmit:!1,last:!1})}onPadKeyUp_(_){const[E,V]=ku(_,this.baseSteps_,this.invertsY_);E===0&&V===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class Ou{constructor(_,E){var V,ce;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.foldable_=qn.create(E.expanded),this.popC_=E.pickerLayout==="popup"?new wn(_,{viewProps:this.viewProps}):null;const Le=new Ga(_,{baseSteps:[E.axes[0].baseStep,E.axes[1].baseStep],invertsY:E.invertsY,layout:E.pickerLayout,maxValue:E.maxValue,value:this.value,viewProps:this.viewProps});Le.view.allFocusableElements.forEach(qe=>{qe.addEventListener("blur",this.onPopupChildBlur_),qe.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=Le,this.textC_=new Vc(_,{assembly:Zo,axes:E.axes,parser:E.parser,value:this.value,viewProps:this.viewProps}),this.view=new ea(_,{expanded:this.foldable_.value("expanded"),pickerLayout:E.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(V=this.view.buttonElement)===null||V===void 0||V.addEventListener("blur",this.onPadButtonBlur_),(ce=this.view.buttonElement)===null||ce===void 0||ce.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Pc({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:qe=>qe.rawValue,backward:(qe,Et)=>Et.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),mi(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(_){if(!this.popC_)return;const E=this.view.element,V=_.relatedTarget;V&&E.contains(V)||(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(_){if(!this.popC_)return;const E=this.popC_.view.element,V=Wt(_);V&&E.contains(V)||V&&V===this.view.buttonElement&&!ft(E.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(_){this.popC_?_.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&_.key==="Escape"&&this.view.buttonElement.focus()}}function kh(B){return Mr.isObject(B)?new Mr(B.x,B.y):new Mr}function Od(B,_){B.writeProperty("x",_.x),B.writeProperty("y",_.y)}function ec(B){if(!B)return;const _=[];return X(B.step)||_.push(new us(B.step)),X(B.max)&&X(B.min)||_.push(new Ri({max:B.max,min:B.min})),new sr(_)}function ti(B,_){const E=B&&Bi(B,Ri);if(E)return Math.max(Math.abs(E.minValue||0),Math.abs(E.maxValue||0));const V=fl(B);return Math.max(10*Math.abs(V),10*Math.abs(_))}function ur(B,_){const E=_ instanceof wo?_.components[0]:void 0,V=_ instanceof wo?_.components[1]:void 0,ce=ti(E,B.x),Le=ti(V,B.y);return Math.max(ce,Le)}function vs(B,_){return{baseStep:fl(_),constraint:_,textProps:tt.fromObject({draggingScale:kc(_,B),formatter:Cr(Ed(_,B))})}}function ta(B){if(!("y"in B))return!1;const _=B.y;return!!_&&"inverted"in _&&!!_.inverted}const yl={id:"input-point2d",type:"input",accept:(B,_)=>{if(!Mr.isObject(B))return null;const E=xt,V=ct(_,{expanded:E.optional.boolean,picker:E.optional.custom(Sm),x:E.optional.custom(za),y:E.optional.object({inverted:E.optional.boolean,max:E.optional.number,min:E.optional.number,step:E.optional.number})});return V?{initialValue:B,params:V}:null},binding:{reader:B=>kh,constraint:B=>{return _=B.params,new wo({assembly:Zo,components:[ec("x"in _?_.x:void 0),ec("y"in _?_.y:void 0)]});var _},equals:Mr.equals,writer:B=>Od},controller:B=>{const _=B.document,E=B.value,V=B.constraint;if(!(V instanceof wo))throw fe.shouldNeverHappen();const ce="expanded"in B.params?B.params.expanded:void 0,Le="picker"in B.params?B.params.picker:void 0;return new Ou(_,{axes:[vs(E.rawValue.x,V.components[0]),vs(E.rawValue.y,V.components[1])],expanded:ce!=null&&ce,invertsY:ta(B.params),maxValue:ur(E.rawValue,V),parser:ps,pickerLayout:Le??"popup",value:E,viewProps:B.viewProps})}};class As{constructor(_=0,E=0,V=0){this.x=_,this.y=E,this.z=V}getComponents(){return[this.x,this.y,this.z]}static isObject(_){if(X(_))return!1;const E=_.x,V=_.y,ce=_.z;return typeof E=="number"&&typeof V=="number"&&typeof ce=="number"}static equals(_,E){return _.x===E.x&&_.y===E.y&&_.z===E.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Lu={toComponents:B=>B.getComponents(),fromComponents:B=>new As(...B)};function xo(B){return As.isObject(B)?new As(B.x,B.y,B.z):new As}function jp(B,_){B.writeProperty("x",_.x),B.writeProperty("y",_.y),B.writeProperty("z",_.z)}function Oh(B){if(!B)return;const _=[];return X(B.step)||_.push(new us(B.step)),X(B.max)&&X(B.min)||_.push(new Ri({max:B.max,min:B.min})),new sr(_)}function xa(B,_){return{baseStep:fl(_),constraint:_,textProps:tt.fromObject({draggingScale:kc(_,B),formatter:Cr(Ed(_,B))})}}const so={id:"input-point3d",type:"input",accept:(B,_)=>{if(!As.isObject(B))return null;const E=xt,V=ct(_,{x:E.optional.custom(za),y:E.optional.custom(za),z:E.optional.custom(za)});return V?{initialValue:B,params:V}:null},binding:{reader:B=>xo,constraint:B=>{return _=B.params,new wo({assembly:Lu,components:[Oh("x"in _?_.x:void 0),Oh("y"in _?_.y:void 0),Oh("z"in _?_.z:void 0)]});var _},equals:As.equals,writer:B=>jp},controller:B=>{const _=B.value,E=B.constraint;if(!(E instanceof wo))throw fe.shouldNeverHappen();return new Vc(B.document,{assembly:Lu,axes:[xa(_.rawValue.x,E.components[0]),xa(_.rawValue.y,E.components[1]),xa(_.rawValue.z,E.components[2])],parser:ps,value:_,viewProps:B.viewProps})}};class bl{constructor(_=0,E=0,V=0,ce=0){this.x=_,this.y=E,this.z=V,this.w=ce}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(_){if(X(_))return!1;const E=_.x,V=_.y,ce=_.z,Le=_.w;return typeof E=="number"&&typeof V=="number"&&typeof ce=="number"&&typeof Le=="number"}static equals(_,E){return _.x===E.x&&_.y===E.y&&_.z===E.z&&_.w===E.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Gc={toComponents:B=>B.getComponents(),fromComponents:B=>new bl(...B)};function Ds(B){return bl.isObject(B)?new bl(B.x,B.y,B.z,B.w):new bl}function ko(B,_){B.writeProperty("x",_.x),B.writeProperty("y",_.y),B.writeProperty("z",_.z),B.writeProperty("w",_.w)}function Ys(B){if(!B)return;const _=[];return X(B.step)||_.push(new us(B.step)),X(B.max)&&X(B.min)||_.push(new Ri({max:B.max,min:B.min})),new sr(_)}const Qa={id:"input-point4d",type:"input",accept:(B,_)=>{if(!bl.isObject(B))return null;const E=xt,V=ct(_,{x:E.optional.custom(za),y:E.optional.custom(za),z:E.optional.custom(za),w:E.optional.custom(za)});return V?{initialValue:B,params:V}:null},binding:{reader:B=>Ds,constraint:B=>{return _=B.params,new wo({assembly:Gc,components:[Ys("x"in _?_.x:void 0),Ys("y"in _?_.y:void 0),Ys("z"in _?_.z:void 0),Ys("w"in _?_.w:void 0)]});var _},equals:bl.equals,writer:B=>ko},controller:B=>{const _=B.value,E=B.constraint;if(!(E instanceof wo))throw fe.shouldNeverHappen();return new Vc(B.document,{assembly:Gc,axes:_.rawValue.getComponents().map((V,ce)=>{return Le=V,{baseStep:fl(qe=E.components[ce]),constraint:qe,textProps:tt.fromObject({draggingScale:kc(qe,Le),formatter:Cr(Ed(qe,Le))})};var Le,qe}),parser:ps,value:_,viewProps:B.viewProps})}},Ld={id:"input-string",type:"input",accept:(B,_)=>{if(typeof B!="string")return null;const E=ct(_,{options:xt.optional.custom(Mu)});return E?{initialValue:B,params:E}:null},binding:{reader:B=>Em,constraint:B=>function(_){const E=[],V=Nr(_.options);return V&&E.push(V),new sr(E)}(B.params),writer:B=>Xl},controller:B=>{var _;const E=B.document,V=B.value,ce=B.constraint;return ce&&Bi(ce,pr)?new wr(E,{props:tt.fromObject({options:(_=xd(ce))!==null&&_!==void 0?_:[]}),value:V,viewProps:B.viewProps}):new Ji(E,{parser:Le=>Le,props:tt.fromObject({formatter:Ic}),value:V,viewProps:B.viewProps})}},tc={defaultInterval:200,defaultLineCount:3},Lh=_e("mll");class Qc{constructor(_,E){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=E.formatter,this.element=_.createElement("div"),this.element.classList.add(Lh()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("textarea");V.classList.add(Lh("i")),V.style.height=`calc(var(--bld-us) * ${E.lineCount})`,V.readOnly=!0,E.viewProps.bindDisabled(V),this.element.appendChild(V),this.textareaElem_=V,E.value.emitter.on("change",this.onValueUpdate_),this.value=E.value,this.update_()}update_(){const _=this.textareaElem_,E=_.scrollTop===_.scrollHeight-_.clientHeight,V=[];this.value.rawValue.forEach(ce=>{ce!==void 0&&V.push(this.formatter_(ce))}),_.textContent=V.join(`
`),E&&(_.scrollTop=_.scrollHeight)}onValueUpdate_(){this.update_()}}class nc{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.view=new Qc(_,{formatter:E.formatter,lineCount:E.lineCount,value:this.value,viewProps:this.viewProps})}}const Nd=_e("sgl");class zp{constructor(_,E){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=E.formatter,this.element=_.createElement("div"),this.element.classList.add(Nd()),E.viewProps.bindClassModifiers(this.element);const V=_.createElement("input");V.classList.add(Nd("i")),V.readOnly=!0,V.type="text",E.viewProps.bindDisabled(V),this.element.appendChild(V),this.inputElement=V,E.value.emitter.on("change",this.onValueUpdate_),this.value=E.value,this.update_()}update_(){const _=this.value.rawValue,E=_[_.length-1];this.inputElement.value=E!==void 0?this.formatter_(E):""}onValueUpdate_(){this.update_()}}class pi{constructor(_,E){this.value=E.value,this.viewProps=E.viewProps,this.view=new zp(_,{formatter:E.formatter,value:this.value,viewProps:this.viewProps})}}const na={id:"monitor-bool",type:"monitor",accept:(B,_)=>{if(typeof B!="boolean")return null;const E=ct(_,{lineCount:xt.optional.number});return E?{initialValue:B,params:E}:null},binding:{reader:B=>Si},controller:B=>{var _;return B.value.rawValue.length===1?new pi(B.document,{formatter:dl,value:B.value,viewProps:B.viewProps}):new nc(B.document,{formatter:dl,lineCount:(_=B.params.lineCount)!==null&&_!==void 0?_:tc.defaultLineCount,value:B.value,viewProps:B.viewProps})}};class Ha{constructor(){this.emitter=new me,this.index_=-1}get index(){return this.index_}set index(_){this.index_!==_&&(this.index_=_,this.emitter.emit("change",{index:_,sender:this}))}}const oo=_e("grl");class Ea{constructor(_,E){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=_.createElement("div"),this.element.classList.add(oo()),E.viewProps.bindClassModifiers(this.element),this.formatter_=E.formatter,this.minValue_=E.minValue,this.maxValue_=E.maxValue,this.cursor_=E.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const V=_.createElementNS(Ie,"svg");V.classList.add(oo("g")),V.style.height=`calc(var(--bld-us) * ${E.lineCount})`,this.element.appendChild(V),this.svgElem_=V;const ce=_.createElementNS(Ie,"polyline");this.svgElem_.appendChild(ce),this.lineElem_=ce;const Le=_.createElement("div");Le.classList.add(oo("t"),_e("tt")()),this.element.appendChild(Le),this.tooltipElem_=Le,E.value.emitter.on("change",this.onValueUpdate_),this.value=E.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const _=this.svgElem_.getBoundingClientRect(),E=this.value.rawValue.length-1,V=this.minValue_,ce=this.maxValue_,Le=[];this.value.rawValue.forEach((Hn,In)=>{if(Hn===void 0)return;const Tr=Oi(In,0,E,0,_.width),es=Oi(Hn,V,ce,_.height,0);Le.push([Tr,es].join(","))}),this.lineElem_.setAttributeNS(null,"points",Le.join(" "));const qe=this.tooltipElem_,Et=this.value.rawValue[this.cursor_.index];if(Et===void 0)return void qe.classList.remove(oo("t","a"));const Yt=Oi(this.cursor_.index,0,E,0,_.width),kn=Oi(Et,V,ce,_.height,0);qe.style.left=`${Yt}px`,qe.style.top=`${kn}px`,qe.textContent=`${this.formatter_(Et)}`,qe.classList.contains(oo("t","a"))||(qe.classList.add(oo("t","a"),oo("t","in")),vt(qe),qe.classList.remove(oo("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class ia{constructor(_,E){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=E.value,this.viewProps=E.viewProps,this.cursor_=new Ha,this.view=new Ea(_,{cursor:this.cursor_,formatter:E.formatter,lineCount:E.lineCount,maxValue:E.maxValue,minValue:E.minValue,value:this.value,viewProps:this.viewProps}),ft(_)){const V=new Ts(this.view.element);V.emitter.on("down",this.onGraphPointerDown_),V.emitter.on("move",this.onGraphPointerMove_),V.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}onGraphMouseLeave_(){this.cursor_.index=-1}onGraphMouseMove_(_){const E=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(Oi(_.offsetX,0,E.width,0,this.value.rawValue.length))}onGraphPointerDown_(_){this.onGraphPointerMove_(_)}onGraphPointerMove_(_){_.data.point?this.cursor_.index=Math.floor(Oi(_.data.point.x,0,_.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1}onGraphPointerUp_(){this.cursor_.index=-1}}function ra(B){return"format"in B&&!X(B.format)?B.format:Cr(2)}function Fd(B){return"view"in B&&B.view==="graph"}const Nu={id:"monitor-number",type:"monitor",accept:(B,_)=>{if(typeof B!="number")return null;const E=xt,V=ct(_,{format:E.optional.function,lineCount:E.optional.number,max:E.optional.number,min:E.optional.number,view:E.optional.string});return V?{initialValue:B,params:V}:null},binding:{defaultBufferSize:B=>Fd(B)?64:1,reader:B=>Wo},controller:B=>Fd(B.params)?function(_){var E,V,ce;return new ia(_.document,{formatter:ra(_.params),lineCount:(E=_.params.lineCount)!==null&&E!==void 0?E:tc.defaultLineCount,maxValue:(V="max"in _.params?_.params.max:null)!==null&&V!==void 0?V:100,minValue:(ce="min"in _.params?_.params.min:null)!==null&&ce!==void 0?ce:0,value:_.value,viewProps:_.viewProps})}(B):function(_){var E;return _.value.rawValue.length===1?new pi(_.document,{formatter:ra(_.params),value:_.value,viewProps:_.viewProps}):new nc(_.document,{formatter:ra(_.params),lineCount:(E=_.params.lineCount)!==null&&E!==void 0?E:tc.defaultLineCount,value:_.value,viewProps:_.viewProps})}(B)},Ud={id:"monitor-string",type:"monitor",accept:(B,_)=>{if(typeof B!="string")return null;const E=xt,V=ct(_,{lineCount:E.optional.number,multiline:E.optional.boolean});return V?{initialValue:B,params:V}:null},binding:{reader:B=>Em},controller:B=>{var _;const E=B.value;return E.rawValue.length>1||"multiline"in B.params&&B.params.multiline?new nc(B.document,{formatter:Ic,lineCount:(_=B.params.lineCount)!==null&&_!==void 0?_:tc.defaultLineCount,value:E,viewProps:B.viewProps}):new pi(B.document,{formatter:Ic,value:E,viewProps:B.viewProps})}};class ic{constructor(_){this.onValueChange_=this.onValueChange_.bind(this),this.reader=_.reader,this.writer=_.writer,this.emitter=new me,this.value=_.value,this.value.emitter.on("change",this.onValueChange_),this.target=_.target,this.read()}read(){const _=this.target.read();_!==void 0&&(this.value.rawValue=this.reader(_))}write_(_){this.writer(this.target,_)}onValueChange_(_){this.write_(_.rawValue),this.emitter.emit("change",{options:_.options,rawValue:_.rawValue,sender:this})}}class Rs{constructor(_){this.onTick_=this.onTick_.bind(this),this.reader_=_.reader,this.target=_.target,this.emitter=new me,this.value=_.value,this.ticker=_.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const _=this.target.read();if(_===void 0)return;const E=this.value.rawValue,V=this.reader_(_);this.value.rawValue=function(ce,Le){const qe=[...Bp(ce),Le];return qe.length>ce.length?qe.splice(0,qe.length-ce.length):Aa(qe,ce.length),qe}(E,V),this.emitter.emit("update",{rawValue:V,sender:this})}onTick_(_){this.read()}}function Im(B,_){return _===0?new Gr:new vo(B,_??tc.defaultInterval)}class Bs{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(_){_.type==="blade"?this.pluginsMap_.blades.unshift(_):_.type==="input"?this.pluginsMap_.inputs.unshift(_):_.type==="monitor"&&this.pluginsMap_.monitors.unshift(_)}createInput(_,E,V){if(X(E.read()))throw new fe({context:{key:E.key},type:"nomatchingcontroller"});const ce=this.pluginsMap_.inputs.reduce((Le,qe)=>Le||function(Et,Yt){const kn=Et.accept(Yt.target.read(),Yt.params);if(X(kn))return null;const Hn=xt,In={target:Yt.target,initialValue:kn.initialValue,params:kn.params},Tr=Et.binding.reader(In),es=Et.binding.constraint?Et.binding.constraint(In):void 0,aa=we(Tr(kn.initialValue),{constraint:es,equals:Et.binding.equals}),Xs=new ic({reader:Tr,target:Yt.target,value:aa,writer:Et.binding.writer(In)}),Oo=Hn.optional.boolean(Yt.params.disabled).value,Sa=Hn.optional.boolean(Yt.params.hidden).value,Hc=Et.controller({constraint:es,document:Yt.document,initialValue:kn.initialValue,params:kn.params,value:Xs.value,viewProps:cn.create({disabled:Oo,hidden:Sa})}),rc=Hn.optional.string(Yt.params.label).value;return new zi(Yt.document,{binding:Xs,blade:Pi(),props:tt.fromObject({label:rc||Yt.target.key}),valueController:Hc})}(qe,{document:_,target:E,params:V}),null);if(ce)return ce;throw new fe({context:{key:E.key},type:"nomatchingcontroller"})}createMonitor(_,E,V){const ce=this.pluginsMap_.monitors.reduce((Le,qe)=>Le||function(Et,Yt){var kn,Hn,In;const Tr=xt,es=Et.accept(Yt.target.read(),Yt.params);if(X(es))return null;const aa={target:Yt.target,initialValue:es.initialValue,params:es.params},Xs=Et.binding.reader(aa),Oo=(Hn=(kn=Tr.optional.number(Yt.params.bufferSize).value)!==null&&kn!==void 0?kn:Et.binding.defaultBufferSize&&Et.binding.defaultBufferSize(es.params))!==null&&Hn!==void 0?Hn:1,Sa=Tr.optional.number(Yt.params.interval).value,Hc=new Rs({reader:Xs,target:Yt.target,ticker:Im(Yt.document,Sa),value:Mi(Oo)}),rc=Tr.optional.boolean(Yt.params.disabled).value,ju=Tr.optional.boolean(Yt.params.hidden).value,Nh=Et.controller({document:Yt.document,params:es.params,value:Hc.value,viewProps:cn.create({disabled:rc,hidden:ju})}),Fh=(In=Tr.optional.string(Yt.params.label).value)!==null&&In!==void 0?In:Yt.target.key;return new Gi(Yt.document,{binding:Hc,blade:Pi(),props:tt.fromObject({label:Fh}),valueController:Nh})}(qe,{document:_,params:V,target:E}),null);if(ce)return ce;throw new fe({context:{key:E.key},type:"nomatchingcontroller"})}createBlade(_,E){const V=this.pluginsMap_.blades.reduce((ce,Le)=>ce||function(qe,Et){const Yt=qe.accept(Et.params);if(!Yt)return null;const kn=xt.optional.boolean(Et.params.disabled).value,Hn=xt.optional.boolean(Et.params.hidden).value;return qe.controller({blade:Pi(),document:Et.document,params:Object.assign(Object.assign({},Yt.params),{disabled:kn,hidden:Hn}),viewProps:cn.create({disabled:kn,hidden:Hn})})}(Le,{document:_,params:E}),null);if(!V)throw new fe({type:"nomatchingview",context:{params:E}});return V}createBladeApi(_){if(_ instanceof zi)return new Xi(_);if(_ instanceof Gi)return new Vi(_);if(_ instanceof Es)return new br(_,this);const E=this.pluginsMap_.blades.reduce((V,ce)=>V||ce.api({controller:_,pool:this}),null);if(!E)throw fe.shouldNeverHappen();return E}}class Wa extends c{constructor(_){super(_),this.emitter_=new me,this.controller_.valueController.value.emitter.on("change",E=>{this.emitter_.emit("change",{event:new O(this,E.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}get options(){return this.controller_.valueController.props.get("options")}set options(_){this.controller_.valueController.props.set("options",_)}get value(){return this.controller_.valueController.value.rawValue}set value(_){this.controller_.valueController.value.rawValue=_}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}}class Xr extends c{constructor(_){super(_),this.emitter_=new me,this.controller_.valueController.value.emitter.on("change",E=>{this.emitter_.emit("change",{event:new O(this,E.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(_){this.controller_.valueController.sliderController.props.set("maxValue",_)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(_){this.controller_.valueController.sliderController.props.set("minValue",_)}get value(){return this.controller_.valueController.value.rawValue}set value(_){this.controller_.valueController.value.rawValue=_}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}}class sa extends c{constructor(_){super(_),this.emitter_=new me,this.controller_.valueController.value.emitter.on("change",E=>{this.emitter_.emit("change",{event:new O(this,E.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(_){this.controller_.props.set("label",_)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(_){this.controller_.valueController.props.set("formatter",_)}get value(){return this.controller_.valueController.value.rawValue}set value(_){this.controller_.valueController.value.rawValue=_}on(_,E){const V=E.bind(this);return this.emitter_.on(_,ce=>{V(ce.event)}),this}}const mr={id:"list",type:"blade",accept(B){const _=xt,E=ct(B,{options:_.required.custom(Mu),value:_.required.raw,view:_.required.constant("list"),label:_.optional.string});return E?{params:E}:null},controller(B){const _=new wr(B.document,{props:tt.fromObject({options:Bc(B.params.options)}),value:we(B.params.value),viewProps:B.viewProps});return new Sr(B.document,{blade:B.blade,props:tt.fromObject({label:B.params.label}),valueController:_})},api:B=>B.controller instanceof Sr&&B.controller.valueController instanceof wr?new Wa(B.controller):null};class Fu extends ar{constructor(_,E){super(_,E)}get element(){return this.controller_.view.element}importPreset(_){(function(E,V){E.forEach(ce=>{const Le=V[ce.presetKey];Le!==void 0&&ce.write(Le)})})(this.controller_.rackController.rack.find(zi).map(E=>E.binding.target),_),this.refresh()}exportPreset(){return this.controller_.rackController.rack.find(zi).map(_=>_.binding.target).reduce((_,E)=>Object.assign(_,{[E.presetKey]:E.read()}),{})}refresh(){this.controller_.rackController.rack.find(zi).forEach(_=>{_.binding.read()}),this.controller_.rackController.rack.find(Gi).forEach(_=>{_.binding.read()})}}class oa extends Ui{constructor(_,E){super(_,{expanded:E.expanded,blade:E.blade,props:E.props,root:!0,viewProps:E.viewProps})}}const Uu={id:"slider",type:"blade",accept(B){const _=xt,E=ct(B,{max:_.required.number,min:_.required.number,view:_.required.constant("slider"),format:_.optional.function,label:_.optional.string,value:_.optional.number});return E?{params:E}:null},controller(B){var _,E;const V=(_=B.params.value)!==null&&_!==void 0?_:0,ce=new Yo(B.document,{baseStep:1,parser:ps,sliderProps:tt.fromObject({maxValue:B.params.max,minValue:B.params.min}),textProps:tt.fromObject({draggingScale:kc(void 0,V),formatter:(E=B.params.format)!==null&&E!==void 0?E:Tc}),value:we(V),viewProps:B.viewProps});return new Sr(B.document,{blade:B.blade,props:tt.fromObject({label:B.params.label}),valueController:ce})},api:B=>B.controller instanceof Sr&&B.controller.valueController instanceof Yo?new Xr(B.controller):null},ao={id:"text",type:"blade",accept(B){const _=xt,E=ct(B,{parse:_.required.function,value:_.required.raw,view:_.required.constant("text"),format:_.optional.function,label:_.optional.string});return E?{params:E}:null},controller(B){var _;const E=new Ji(B.document,{parser:B.params.parse,props:tt.fromObject({formatter:(_=B.params.format)!==null&&_!==void 0?_:V=>String(V)}),value:we(B.params.value),viewProps:B.viewProps});return new Sr(B.document,{blade:B.blade,props:tt.fromObject({label:B.params.label}),valueController:E})},api:B=>B.controller instanceof Sr&&B.controller.valueController instanceof Ji?new sa(B.controller):null};function Ur(B,_,E){if(B.querySelector(`style[data-tp-style=${_}]`))return;const V=B.createElement("style");V.dataset.tpStyle=_,V.textContent=E,B.head.appendChild(V)}const Vp=new class{constructor(B){const[_,E]=B.split("-"),V=_.split(".");this.major=parseInt(V[0],10),this.minor=parseInt(V[1],10),this.patch=parseInt(V[2],10),this.prerelease=E??null}toString(){const B=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[B,this.prerelease].join("-"):B}}("3.0.8");w.BladeApi=c,w.ButtonApi=le,w.FolderApi=ar,w.InputBindingApi=Xi,w.ListApi=Wa,w.MonitorBindingApi=Vi,w.Pane=class extends Fu{constructor(B){var _;const E=B||{},V=(_=E.document)!==null&&_!==void 0?_:jt(),ce=function(){const Le=new Bs;return[yl,so,Qa,Ld,Li,$l,wa,Al,Cm,na,Ud,Nu,Zn,qr,_r,vi].forEach(qe=>{Le.register(qe)}),Le}();super(new oa(V,{expanded:E.expanded,blade:Pi(),props:tt.fromObject({title:E.title}),viewProps:cn.create()}),ce),this.pool_=ce,this.containerElem_=E.container||function(Le){const qe=Le.createElement("div");return qe.classList.add(_e("dfw")()),Le.body&&Le.body.appendChild(qe),qe}(V),this.containerElem_.appendChild(this.element),this.doc_=V,this.usesDefaultWrapper_=!E.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw fe.alreadyDisposed();return this.doc_}dispose(){const B=this.containerElem_;if(!B)throw fe.alreadyDisposed();if(this.usesDefaultWrapper_){const _=B.parentElement;_&&_.removeChild(B)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(B){("plugin"in B?[B.plugin]:"plugins"in B?B.plugins:[]).forEach(_=>{this.pool_.register(_),this.embedPluginStyle_(_)})}embedPluginStyle_(B){B.css&&Ur(this.document,`plugin-${B.id}`,B.css)}setUpDefaultPlugins_(){Ur(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(B=>{this.embedPluginStyle_(B)}),this.registerPlugin({plugins:[Uu,mr,vi,ao]})}},w.SeparatorApi=no,w.SliderApi=Xr,w.TabApi=di,w.TabPageApi=ir,w.TextApi=sa,w.TpChangeEvent=O,w.VERSION=Vp,Object.defineProperty(w,"__esModule",{value:!0})})(A)},23:function(__unused_webpack_module,__webpackgi_exports__,__webpackgi_require__){__webpackgi_require__.d(__webpackgi_exports__,{Q:function(){return DRACOLoader2}});var three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__=__webpackgi_require__(553),three__WEBPACK_IMPORTED_MODULE_1__=__webpackgi_require__(988);class DRACOLoader2 extends three_examples_jsm_loaders_DRACOLoader__WEBPACK_IMPORTED_MODULE_0__._{constructor(K){super(K),this.encoderPending=null,this.encoderConfig={type:"js"},this.setDecoderPath("https://cdn.jsdelivr.net/gh/google/draco@1.4.1/javascript/"),this.setDecoderConfig({type:"js"})}async loadAsync(K,A){const w=await super.loadAsync(K,A);return w?new three__WEBPACK_IMPORTED_MODULE_1__.Kj0(w,new three__WEBPACK_IMPORTED_MODULE_1__.Wid):void 0}preload(K=!0,A=!1){return K&&super.preload(),A&&this.initEncoder(),this}async initEncoder(){if(this.encoderPending)return this.encoderPending;const useJS=typeof WebAssembly!="object"||this.encoderConfig.type==="js",librariesPending=[],libLoader=this._loadLibrary.bind(this);return useJS?librariesPending.push(libLoader("draco_encoder.js","text")):(librariesPending.push(libLoader("draco_wasm_wrapper.js","text")),librariesPending.push(libLoader("draco_encoder.wasm","arraybuffer"))),this.encoderPending=Promise.all(librariesPending).then(libraries=>{var _a;const jsContent=libraries[0];return useJS||(this.encoderConfig.wasmBinary=libraries[1]),(_a=eval(jsContent+`
DracoEncoderModule;`))===null||_a===void 0?void 0:_a()}),this.encoderPending}async initDecoder(){var _a;await this._initDecoder();const jsContent=await fetch(this.workerSourceURL).then(async K=>K.text()).then(K=>{const A=K.indexOf("/* worker */");if(A<1)throw new Error("unable to load decoder module");return K.substring(0,A-1)});return(_a=eval(jsContent+`
DracoDecoderModule;`))===null||_a===void 0?void 0:_a()}}},87:function(){},263:function(){},988:function(K,A,w){w.d(A,{$TI:function(){return Ug},$V:function(){return Cw},$Vf:function(){return hy},$YQ:function(){return lv},A5E:function(){return mp},AHu:function(){return Wf},AXT:function(){return pf},Aip:function(){return gy},B02:function(){return te},BFQ:function(){return pr},BG$:function(){return Ql},BKK:function(){return vp},BVF:function(){return jt},BVQ:function(){return mf},BbS:function(){return hu},Bf4:function(){return Gi},BtG:function(){return Vd},CJI:function(){return Rs},CN8:function(){return ly},CP7:function(){return ns},CaW:function(){return _n},CdI:function(){return qn},Cne:function(){return Jv},CtA:function(){return vo},CtF:function(){return ru},D1R:function(){return Sn},D9w:function(){return vi},DT1:function(){return qf},Djp:function(){return Th},DqL:function(){return Fo},DvJ:function(){return qa},E2K:function(){return sr},EB7:function(){return df},EJi:function(){return Iv},EoG:function(){return Pi},F5T:function(){return Bs},FDw:function(){return Ui},FE5:function(){return $s},FIo:function(){return GA},FM8:function(){return Xt},FT0:function(){return Dv},FUD:function(){return Wl},FvO:function(){return Zs},GG6:function(){return Sc},GQ:function(){return Za},GUF:function(){return Oi},GVz:function(){return Tm},GZb:function(){return dy},Gih:function(){return Hl},Gql:function(){return Uv},H$k:function(){return $h},HTd:function(){return Po},HW6:function(){return my},HgB:function(){return Tu},HkE:function(){return av},Hmr:function(){return Lf},Hw6:function(){return Fc},Hy8:function(){return Pt},Hyl:function(){return Il},IEO:function(){return Jd},IFH:function(){return Cr},IKL:function(){return QA},ILR:function(){return us},IOt:function(){return Cs},Ilk:function(){return bn},Inb:function(){return Pc},Ir4:function(){return kc},JOQ:function(){return Wc},JQ4:function(){return et},JUT:function(){return Uc},JWc:function(){return Ed},KI_:function(){return Ts},Kgo:function(){return gf},KhW:function(){return _t},Kj0:function(){return ks},Kz5:function(){return _o},L5g:function(){return ah},L5s:function(){return ga},LBq:function(){return ny},LSk:function(){return ml},LY2:function(){return mi},L_r:function(){return Cd},Lcc:function(){return tl},LgE:function(){return Bp},LgZ:function(){return Ot},LsT:function(){return Vs},Ltg:function(){return Zi},Lun:function(){return qd},M5h:function(){return ye},M6v:function(){return qt},M8C:function(){return Md},Mig:function(){return XA},MyG:function(){return Op},N$j:function(){return hv},N4l:function(){return je},NDo:function(){return Zn},NMF:function(){return Su},NYV:function(){return Ec},Ns1:function(){return Cn},NwF:function(){return $a},Ny0:function(){return dg},O7d:function(){return wf},OAl:function(){return Xl},OM3:function(){return V},OTo:function(){return Gn},OdW:function(){return of},OoA:function(){return br},Ox3:function(){return YA},PA7:function(){return Ms},PMe:function(){return Nv},Pa4:function(){return Re},PeU:function(){return F},Pnf:function(){return ps},PpQ:function(){return Bh},QM0:function(){return fl},QRU:function(){return jv},QZ1:function(){return xd},QmN:function(){return O},Qpg:function(){return oy},R2R:function(){return nu},REq:function(){return _p},RNb:function(){return Fu},ROQ:function(){return Av},RSm:function(){return Cf},Rki:function(){return ay},RlZ:function(){return ft},RsA:function(){return C},RvT:function(){return Mu},S2y:function(){return X},S3k:function(){return ap},S9g:function(){return so},SJI:function(){return ey},SPe:function(){return sg},SUY:function(){return Bg},Se2:function(){return rt},Sm8:function(){return we},So8:function(){return zv},SvJ:function(){return $i},Syv:function(){return Mc},T95:function(){return Sr},TOt:function(){return vg},TUj:function(){return Mw},TUv:function(){return uv},T_1:function(){return Hg},T_J:function(){return Lr},T__:function(){return LA},T_f:function(){return KA},TlE:function(){return mr},Tme:function(){return pi},Tn7:function(){return wg},TyD:function(){return ar},U7:function(){return wv},UCm:function(){return Qn},USm:function(){return xa},UY4:function(){return lg},UZH:function(){return c},Uk6:function(){return VA},UlW:function(){return Em},Uol:function(){return eu},V1s:function(){return zd},V4E:function(){return fy},VLJ:function(){return qv},VYz:function(){return ty},Vdb:function(){return Ie},Vj0:function(){return la},Vkp:function(){return Is},VzW:function(){return _r},W2J:function(){return Bc},WMw:function(){return Se},WTc:function(){return oa},WXh:function(){return Ef},Wbm:function(){return se},WdD:function(){return Ai},Wid:function(){return Tv},Wjw:function(){return Wg},Wl3:function(){return me},Wpd:function(){return vt},Wqd:function(){return Ev},WwZ:function(){return ql},Wzm:function(){return hf},XZw:function(){return Ap},Xaj:function(){return Ne},Xcj:function(){return Vv},XvJ:function(){return eh},Y8D:function(){return ir},YBo:function(){return Pv},YGz:function(){return gt},YKA:function(){return yd},YLQ:function(){return Ki},YN5:function(){return uy},YT8:function(){return NA},Ywn:function(){return Pd},Z6B:function(){return L_},ZAu:function(){return Xc},ZQ6:function(){return Zc},ZRs:function(){return qo},ZZA:function(){return Tf},Zp0:function(){return dc},Zr5:function(){return pe},ZzF:function(){return jc},Zzh:function(){return ry},_12:function(){return Qu},_3:function(){return Kv},_AM:function(){return ki},_C8:function(){return Zh},_Li:function(){return $},_MY:function(){return ue},_YM:function(){return tu},_YX:function(){return Vf},_am:function(){return N_},_fP:function(){return Ps},_iA:function(){return fe},_kC:function(){return uc},_lf:function(){return Wo},_sL:function(){return Tc},a$l:function(){return E},aCh:function(){return Dc},aH4:function(){return lr},aLr:function(){return ea},aNw:function(){return Ls},aVm:function(){return ao},ad5:function(){return _s},anP:function(){return Lm},aq0:function(){return Qf},av9:function(){return Gr},b5g:function(){return cv},bGH:function(){return Z},b_z:function(){return Br},bdR:function(){return ge},blk:function(){return $d},bnF:function(){return Xh},brP:function(){return rr},bsb:function(){return pl},c8b:function(){return tt},cBI:function(){return pu},cBK:function(){return kv},cJO:function(){return rp},cLu:function(){return Gs},cPb:function(){return Ks},cRx:function(){return di},cU9:function(){return Bv},ce8:function(){return wd},cek:function(){return qA},cum:function(){return za},dSO:function(){return Vi},dUE:function(){return iu},dYG:function(){return xg},dZ3:function(){return Ei},dd2:function(){return bo},dj0:function(){return Nr},dpR:function(){return Ov},dwk:function(){return le},e62:function(){return _},eD:function(){return Xe},eMJ:function(){return kp},eaV:function(){return wr},ehD:function(){return _e},ejS:function(){return cc},ekQ:function(){return Yr},epp:function(){return qs},fHI:function(){return Os},fO1:function(){return vv},fQA:function(){return Gg},fQK:function(){return Jm},fSK:function(){return At},fY$:function(){return Xi},fto:function(){return ja},g8_:function(){return Vr},gH0:function(){return zf},gSk:function(){return bd},g_z:function(){return ff},ghN:function(){return St},gi4:function(){return dl},gti:function(){return xv},hEm:function(){return Qs},hH6:function(){return ou},iAb:function(){return no},iDF:function(){return Rl},iKG:function(){return Rm},iLg:function(){return ma},iMs:function(){return jg},iUV:function(){return Qi},iWC:function(){return xt},iWj:function(){return Wp},i_9:function(){return Dg},iiP:function(){return cr},irR:function(){return cn},j4z:function(){return Sm},j87:function(){return Vp},jAl:function(){return yo},jFi:function(){return oe},jZA:function(){return Ji},jfJ:function(){return Yl},jwo:function(){return Lp},jyi:function(){return ig},jyz:function(){return wl},k0A:function(){return ri},k74:function(){return ct},kB5:function(){return oc},kFz:function(){return Jo},kaV:function(){return Mf},knz:function(){return Mi},kqm:function(){return rh},ksN:function(){return zt},l0P:function(){return wn},l8J:function(){return Sd},lCJ:function(){return B},lDi:function(){return Of},lLk:function(){return su},lRF:function(){return nf},lRj:function(){return Do},lb7:function(){return qh},lfu:function(){return Rv},lk7:function(){return Tg},m7l:function(){return Pf},mSO:function(){return Cu},mTL:function(){return Ew},mXe:function(){return _g},m_w:function(){return rd},mzJ:function(){return nd},nls:function(){return Lo},ntZ:function(){return de},nvb:function(){return cy},o8S:function(){return Jh},oAp:function(){return z0},oa8:function(){return xf},oqc:function(){return Rc},p3g:function(){return Ru},p7A:function(){return Xv},p7y:function(){return Qr},pBf:function(){return ei},pIN:function(){return Ss},pKu:function(){return Ad},pQR:function(){return co},ptH:function(){return Ao},qhX:function(){return vn},qkB:function(){return Hi},qlB:function(){return Ur},qyh:function(){return Es},rAo:function(){return Uu},rBU:function(){return fn},rDY:function(){return j0},rOj:function(){return ae},r_:function(){return Be},rnI:function(){return Aa},rpg:function(){return Di},s4_:function(){return JA},sYA:function(){return Df},tEQ:function(){return ed},tGC:function(){return fc},tJx:function(){return Qg},tUh:function(){return Bl},tf:function(){return Ff},tm_:function(){return G},trn:function(){return gp},u37:function(){return td},u7G:function(){return lu},u9r:function(){return In},uEv:function(){return Cc},uL9:function(){return Xn},uWy:function(){return gi},uXU:function(){return Hs},ujx:function(){return py},v3W:function(){return Ri},v9Y:function(){return Cm},vBJ:function(){return Wa},vCF:function(){return be},vCx:function(){return fr},vZf:function(){return cs},vmT:function(){return WA},vpT:function(){return Zm},vxC:function(){return zi},w$m:function(){return Wt},wJv:function(){return kt},wem:function(){return nr},wk1:function(){return Nn},woe:function(){return hg},wuA:function(){return Bi},x12:function(){return lc},x5V:function(){return or},xEZ:function(){return fs},xG9:function(){return sy},xJs:function(){return Ci},xWb:function(){return sh},xeV:function(){return eg},xfE:function(){return Rr},xo$:function(){return sp},xoR:function(){return Sf},xsS:function(){return CA},y$t:function(){return tp},y2t:function(){return Si},y8_:function(){return fp},yC1:function(){return op},yGw:function(){return ti},ybr:function(){return Yd},yj7:function(){return bv},ylh:function(){return hp},yo9:function(){return qu},yt0:function(){return Yo},ywz:function(){return qr},yxD:function(){return au},z$h:function(){return Ic},z81:function(){return io},z8B:function(){return Kd},zHn:function(){return ec},zbs:function(){return If},zf8:function(){return Ma},zob:function(){return mu}});const c="144dev",C={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},O={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},F=0,G=1,X=2,te=3,ue=0,fe=1,de=2,le=3,me=0,$=1,_e=2,oe=0,ge=1,Se=2,je=3,ye=4,Ne=5,Z=100,se=101,ae=102,Be=103,we=104,tt=200,St=201,_t=202,xt=203,ct=204,Ot=205,At=206,Pt=207,Ie=208,vt=209,ft=210,jt=0,rt=1,pe=2,be=3,Xe=4,zt=5,Wt=6,qt=7,Cn=0,vn=1,Zn=2,Xn=0,Pi=1,qn=2,gt=3,mi=4,Ei=5,Rr=300,Xi=301,zi=302,Vi=303,Gi=304,Vr=306,Di=1e3,gi=1001,br=1002,ar=1003,Ki=1004,Po=1004,lr=1005,cs=1005,nr=1006,Es=1007,Do=1007,Sn=1008,Ui=1008,qr=1009,Sr=1010,no=1011,Vs=1012,_o=1013,et=1014,_r=1015,Gs=1016,ri=1017,cn=1018,kt=1020,Gn=1021,Qn=1022,Nn=1023,ir=1024,di=1025,Hi=1026,rr=1027,Qs=1028,vi=1029,Gr=1030,vo=1031,sr=1033,Bi=33776,pr=33777,Ri=33778,us=33779,ki=35840,fr=35841,wr=35842,_n=35843,ja=36196,wn=37492,Yr=37496,Ao=37808,Ji=37809,Si=37810,dl=37811,Th=37812,Ql=37813,Ec=37814,Ci=37815,Ad=37816,Sc=37817,Hl=37818,Wl=37819,cr=37820,$i=37821,pl=36492,yo=2200,yd=2201,Cc=2202,Mc=2300,Su=2301,Ss=2302,ps=2400,Wo=2401,Tc=2402,Cr=2500,bd=2501,ql=0,Em=1,Ic=2,Aa=3e3,Mi=3001,Bp=3004,Pc=3005,io=3200,Cu=3201,Cs=0,Ms=1,Dc="",Ts="srgb",Oi="srgb-linear",_s=0,or=7680,wd=7681,qo=7682,Yl=7683,Rc=34055,Lr=34056,kp=5386,Op=512,Hs=513,Lp=514,Yo=515,Xl=516,Mu=517,Sm=518,za=519,Bc=35044,Nr=35048,xd=35040,Ed=35045,fl=35049,kc=35041,Tu=35046,Sd=35050,L_=35042,Cm="100",ml="300 es",Cd=1035;class ei{addEventListener(i,l){this._listeners===void 0&&(this._listeners={});const h=this._listeners;h[i]===void 0&&(h[i]=[]),h[i].indexOf(l)===-1&&h[i].push(l)}hasEventListener(i,l){if(this._listeners===void 0)return!1;const h=this._listeners;return h[i]!==void 0&&h[i].indexOf(l)!==-1}removeEventListener(i,l){if(this._listeners===void 0)return;const h=this._listeners[i];if(h!==void 0){const d=h.indexOf(l);d!==-1&&h.splice(d,1)}}dispatchEvent(i){if(this._listeners===void 0)return;const l=this._listeners[i.type];if(l!==void 0){i.target=this;const h=l.slice(0);for(let d=0,g=h.length;d<g;d++)h[d].call(this,i);i.target=null}}}const Zr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Np=1234567;const Oc=Math.PI/180,Ih=180/Math.PI;function Ws(){const x=4294967295*Math.random()|0,i=4294967295*Math.random()|0,l=4294967295*Math.random()|0,h=4294967295*Math.random()|0;return(Zr[255&x]+Zr[x>>8&255]+Zr[x>>16&255]+Zr[x>>24&255]+"-"+Zr[255&i]+Zr[i>>8&255]+"-"+Zr[i>>16&15|64]+Zr[i>>24&255]+"-"+Zr[63&l|128]+Zr[l>>8&255]+"-"+Zr[l>>16&255]+Zr[l>>24&255]+Zr[255&h]+Zr[h>>8&255]+Zr[h>>16&255]+Zr[h>>24&255]).toLowerCase()}function Vn(x,i,l){return Math.max(i,Math.min(l,x))}function Va(x,i){return(x%i+i)%i}function Ph(x,i,l){return(1-l)*x+l*i}function Dh(x){return(x&x-1)==0&&x!==0}function Kl(x){return Math.pow(2,Math.ceil(Math.log(x)/Math.LN2))}function ro(x){return Math.pow(2,Math.floor(Math.log(x)/Math.LN2))}function gl(x,i){switch(i.constructor){case Float32Array:return x;case Uint16Array:return x/65535;case Uint8Array:return x/255;case Int16Array:return Math.max(x/32767,-1);case Int8Array:return Math.max(x/127,-1);default:throw new Error("Invalid component type.")}}function vr(x,i){switch(i.constructor){case Float32Array:return x;case Uint16Array:return Math.round(65535*x);case Uint8Array:return Math.round(255*x);case Int16Array:return Math.round(32767*x);case Int8Array:return Math.round(127*x);default:throw new Error("Invalid component type.")}}var Md=Object.freeze({__proto__:null,DEG2RAD:Oc,RAD2DEG:Ih,generateUUID:Ws,clamp:Vn,euclideanModulo:Va,mapLinear:function(x,i,l,h,d){return h+(x-i)*(d-h)/(l-i)},inverseLerp:function(x,i,l){return x!==i?(l-x)/(i-x):0},lerp:Ph,damp:function(x,i,l,h){return Ph(x,i,1-Math.exp(-l*h))},pingpong:function(x,i=1){return i-Math.abs(Va(x,2*i)-i)},smoothstep:function(x,i,l){return x<=i?0:x>=l?1:(x=(x-i)/(l-i))*x*(3-2*x)},smootherstep:function(x,i,l){return x<=i?0:x>=l?1:(x=(x-i)/(l-i))*x*x*(x*(6*x-15)+10)},randInt:function(x,i){return x+Math.floor(Math.random()*(i-x+1))},randFloat:function(x,i){return x+Math.random()*(i-x)},randFloatSpread:function(x){return x*(.5-Math.random())},seededRandom:function(x){x!==void 0&&(Np=x);let i=Np+=1831565813;return i=Math.imul(i^i>>>15,1|i),i^=i+Math.imul(i^i>>>7,61|i),((i^i>>>14)>>>0)/4294967296},degToRad:function(x){return x*Oc},radToDeg:function(x){return x*Ih},isPowerOfTwo:Dh,ceilPowerOfTwo:Kl,floorPowerOfTwo:ro,setQuaternionFromProperEuler:function(x,i,l,h,d){const g=Math.cos,v=Math.sin,b=g(l/2),T=v(l/2),I=g((i+h)/2),N=v((i+h)/2),z=g((i-h)/2),U=v((i-h)/2),Q=g((h-i)/2),Y=v((h-i)/2);switch(d){case"XYX":x.set(b*N,T*z,T*U,b*I);break;case"YZY":x.set(T*U,b*N,T*z,b*I);break;case"ZXZ":x.set(T*z,T*U,b*N,b*I);break;case"XZX":x.set(b*N,T*Y,T*Q,b*I);break;case"YXY":x.set(T*Q,b*N,T*Y,b*I);break;case"ZYZ":x.set(T*Y,T*Q,b*N,b*I);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+d)}},normalize:vr,denormalize:gl});class Xt{constructor(i=0,l=0){Xt.prototype.isVector2=!0,this.x=i,this.y=l}get width(){return this.x}set width(i){this.x=i}get height(){return this.y}set height(i){this.y=i}set(i,l){return this.x=i,this.y=l,this}setScalar(i){return this.x=i,this.y=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y)}copy(i){return this.x=i.x,this.y=i.y,this}add(i){return this.x+=i.x,this.y+=i.y,this}addScalar(i){return this.x+=i,this.y+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this}subScalar(i){return this.x-=i,this.y-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this}multiply(i){return this.x*=i.x,this.y*=i.y,this}multiplyScalar(i){return this.x*=i,this.y*=i,this}divide(i){return this.x/=i.x,this.y/=i.y,this}divideScalar(i){return this.multiplyScalar(1/i)}applyMatrix3(i){const l=this.x,h=this.y,d=i.elements;return this.x=d[0]*l+d[3]*h+d[6],this.y=d[1]*l+d[4]*h+d[7],this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this}clampLength(i,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(i,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(i){return this.x*i.x+this.y*i.y}cross(i){return this.x*i.y-this.y*i.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const l=this.x-i.x,h=this.y-i.y;return l*l+h*h}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this}lerpVectors(i,l,h){return this.x=i.x+(l.x-i.x)*h,this.y=i.y+(l.y-i.y)*h,this}equals(i){return i.x===this.x&&i.y===this.y}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this}rotateAround(i,l){const h=Math.cos(l),d=Math.sin(l),g=this.x-i.x,v=this.y-i.y;return this.x=g*h-v*d+i.x,this.y=g*d+v*h+i.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Is{constructor(){Is.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(i,l,h,d,g,v,b,T,I){const N=this.elements;return N[0]=i,N[1]=d,N[2]=b,N[3]=l,N[4]=g,N[5]=T,N[6]=h,N[7]=v,N[8]=I,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(i){const l=this.elements,h=i.elements;return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],this}extractBasis(i,l,h){return i.setFromMatrix3Column(this,0),l.setFromMatrix3Column(this,1),h.setFromMatrix3Column(this,2),this}setFromMatrix4(i){const l=i.elements;return this.set(l[0],l[4],l[8],l[1],l[5],l[9],l[2],l[6],l[10]),this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,l){const h=i.elements,d=l.elements,g=this.elements,v=h[0],b=h[3],T=h[6],I=h[1],N=h[4],z=h[7],U=h[2],Q=h[5],Y=h[8],H=d[0],ne=d[3],ie=d[6],re=d[1],ve=d[4],Ee=d[7],Me=d[2],Pe=d[5],Ye=d[8];return g[0]=v*H+b*re+T*Me,g[3]=v*ne+b*ve+T*Pe,g[6]=v*ie+b*Ee+T*Ye,g[1]=I*H+N*re+z*Me,g[4]=I*ne+N*ve+z*Pe,g[7]=I*ie+N*Ee+z*Ye,g[2]=U*H+Q*re+Y*Me,g[5]=U*ne+Q*ve+Y*Pe,g[8]=U*ie+Q*Ee+Y*Ye,this}multiplyScalar(i){const l=this.elements;return l[0]*=i,l[3]*=i,l[6]*=i,l[1]*=i,l[4]*=i,l[7]*=i,l[2]*=i,l[5]*=i,l[8]*=i,this}determinant(){const i=this.elements,l=i[0],h=i[1],d=i[2],g=i[3],v=i[4],b=i[5],T=i[6],I=i[7],N=i[8];return l*v*N-l*b*I-h*g*N+h*b*T+d*g*I-d*v*T}invert(){const i=this.elements,l=i[0],h=i[1],d=i[2],g=i[3],v=i[4],b=i[5],T=i[6],I=i[7],N=i[8],z=N*v-b*I,U=b*T-N*g,Q=I*g-v*T,Y=l*z+h*U+d*Q;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0);const H=1/Y;return i[0]=z*H,i[1]=(d*I-N*h)*H,i[2]=(b*h-d*v)*H,i[3]=U*H,i[4]=(N*l-d*T)*H,i[5]=(d*g-b*l)*H,i[6]=Q*H,i[7]=(h*T-I*l)*H,i[8]=(v*l-h*g)*H,this}transpose(){let i;const l=this.elements;return i=l[1],l[1]=l[3],l[3]=i,i=l[2],l[2]=l[6],l[6]=i,i=l[5],l[5]=l[7],l[7]=i,this}getNormalMatrix(i){return this.setFromMatrix4(i).invert().transpose()}transposeIntoArray(i){const l=this.elements;return i[0]=l[0],i[1]=l[3],i[2]=l[6],i[3]=l[1],i[4]=l[4],i[5]=l[7],i[6]=l[2],i[7]=l[5],i[8]=l[8],this}setUvTransform(i,l,h,d,g,v,b){const T=Math.cos(g),I=Math.sin(g);return this.set(h*T,h*I,-h*(T*v+I*b)+v+i,-d*I,d*T,-d*(-I*v+T*b)+b+l,0,0,1),this}scale(i,l){const h=this.elements;return h[0]*=i,h[3]*=i,h[6]*=i,h[1]*=l,h[4]*=l,h[7]*=l,this}rotate(i){const l=Math.cos(i),h=Math.sin(i),d=this.elements,g=d[0],v=d[3],b=d[6],T=d[1],I=d[4],N=d[7];return d[0]=l*g+h*T,d[3]=l*v+h*I,d[6]=l*b+h*N,d[1]=-h*g+l*T,d[4]=-h*v+l*I,d[7]=-h*b+l*N,this}translate(i,l){const h=this.elements;return h[0]+=i*h[2],h[3]+=i*h[5],h[6]+=i*h[8],h[1]+=l*h[2],h[4]+=l*h[5],h[7]+=l*h[8],this}equals(i){const l=this.elements,h=i.elements;for(let d=0;d<9;d++)if(l[d]!==h[d])return!1;return!0}fromArray(i,l=0){for(let h=0;h<9;h++)this.elements[h]=i[h+l];return this}toArray(i=[],l=0){const h=this.elements;return i[l]=h[0],i[l+1]=h[1],i[l+2]=h[2],i[l+3]=h[3],i[l+4]=h[4],i[l+5]=h[5],i[l+6]=h[6],i[l+7]=h[7],i[l+8]=h[8],i}clone(){return new this.constructor().fromArray(this.elements)}}function Mm(x){for(let i=x.length-1;i>=0;--i)if(x[i]>65535)return!0;return!1}const Fp={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function Lc(x,i){return new Fp[x](i)}function Nc(x){return document.createElementNS("http://www.w3.org/1999/xhtml",x)}function ya(x){return x<.04045?.0773993808*x:Math.pow(.9478672986*x+.0521327014,2.4)}function Rh(x){return x<.0031308?12.92*x:1.055*Math.pow(x,.41666)-.055}const Iu={[Ts]:{[Oi]:ya},[Oi]:{[Ts]:Rh}},qs={legacyMode:!0,get workingColorSpace(){return Oi},set workingColorSpace(x){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(x,i,l){if(this.legacyMode||i===l||!i||!l)return x;if(Iu[i]&&Iu[i][l]!==void 0){const h=Iu[i][l];return x.r=h(x.r),x.g=h(x.g),x.b=h(x.b),x}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(x,i){return this.convert(x,this.workingColorSpace,i)},toWorkingColorSpace:function(x,i){return this.convert(x,i,this.workingColorSpace)}},Td={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Fr={r:0,g:0,b:0},Xo={h:0,s:0,l:0},Pu={h:0,s:0,l:0};function Ro(x,i,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?x+6*(i-x)*l:l<.5?i:l<2/3?x+6*(i-x)*(2/3-l):x}function Id(x,i){return i.r=x.r,i.g=x.g,i.b=x.b,i}class bn{constructor(i,l,h){return this.isColor=!0,this.r=1,this.g=1,this.b=1,l===void 0&&h===void 0?this.set(i):this.setRGB(i,l,h)}set(i){return i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i),this}setScalar(i){return this.r=i,this.g=i,this.b=i,this}setHex(i,l=Ts){return i=Math.floor(i),this.r=(i>>16&255)/255,this.g=(i>>8&255)/255,this.b=(255&i)/255,qs.toWorkingColorSpace(this,l),this}setRGB(i,l,h,d=Oi){return this.r=i,this.g=l,this.b=h,qs.toWorkingColorSpace(this,d),this}setHSL(i,l,h,d=Oi){if(i=Va(i,1),l=Vn(l,0,1),h=Vn(h,0,1),l===0)this.r=this.g=this.b=h;else{const g=h<=.5?h*(1+l):h+l-h*l,v=2*h-g;this.r=Ro(v,g,i+1/3),this.g=Ro(v,g,i),this.b=Ro(v,g,i-1/3)}return qs.toWorkingColorSpace(this,d),this}setStyle(i,l=Ts){function h(g){g!==void 0&&parseFloat(g)<1&&console.warn("THREE.Color: Alpha component of "+i+" will be ignored.")}let d;if(d=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(i)){let g;const v=d[1],b=d[2];switch(v){case"rgb":case"rgba":if(g=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return this.r=Math.min(255,parseInt(g[1],10))/255,this.g=Math.min(255,parseInt(g[2],10))/255,this.b=Math.min(255,parseInt(g[3],10))/255,qs.toWorkingColorSpace(this,l),h(g[4]),this;if(g=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b))return this.r=Math.min(100,parseInt(g[1],10))/100,this.g=Math.min(100,parseInt(g[2],10))/100,this.b=Math.min(100,parseInt(g[3],10))/100,qs.toWorkingColorSpace(this,l),h(g[4]),this;break;case"hsl":case"hsla":if(g=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(b)){const T=parseFloat(g[1])/360,I=parseFloat(g[2])/100,N=parseFloat(g[3])/100;return h(g[4]),this.setHSL(T,I,N,l)}}}else if(d=/^\#([A-Fa-f\d]+)$/.exec(i)){const g=d[1],v=g.length;if(v===3)return this.r=parseInt(g.charAt(0)+g.charAt(0),16)/255,this.g=parseInt(g.charAt(1)+g.charAt(1),16)/255,this.b=parseInt(g.charAt(2)+g.charAt(2),16)/255,qs.toWorkingColorSpace(this,l),this;if(v===6)return this.r=parseInt(g.charAt(0)+g.charAt(1),16)/255,this.g=parseInt(g.charAt(2)+g.charAt(3),16)/255,this.b=parseInt(g.charAt(4)+g.charAt(5),16)/255,qs.toWorkingColorSpace(this,l),this}return i&&i.length>0?this.setColorName(i,l):this}setColorName(i,l=Ts){const h=Td[i.toLowerCase()];return h!==void 0?this.setHex(h,l):console.warn("THREE.Color: Unknown color "+i),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(i){return this.r=i.r,this.g=i.g,this.b=i.b,this}copySRGBToLinear(i){return this.r=ya(i.r),this.g=ya(i.g),this.b=ya(i.b),this}copyLinearToSRGB(i){return this.r=Rh(i.r),this.g=Rh(i.g),this.b=Rh(i.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(i=Ts){return qs.fromWorkingColorSpace(Id(this,Fr),i),Vn(255*Fr.r,0,255)<<16^Vn(255*Fr.g,0,255)<<8^Vn(255*Fr.b,0,255)<<0}getHexString(i=Ts){return("000000"+this.getHex(i).toString(16)).slice(-6)}getHSL(i,l=Oi){qs.fromWorkingColorSpace(Id(this,Fr),l);const h=Fr.r,d=Fr.g,g=Fr.b,v=Math.max(h,d,g),b=Math.min(h,d,g);let T,I;const N=(b+v)/2;if(b===v)T=0,I=0;else{const z=v-b;switch(I=N<=.5?z/(v+b):z/(2-v-b),v){case h:T=(d-g)/z+(d<g?6:0);break;case d:T=(g-h)/z+2;break;case g:T=(h-d)/z+4}T/=6}return i.h=T,i.s=I,i.l=N,i}getRGB(i,l=Oi){return qs.fromWorkingColorSpace(Id(this,Fr),l),i.r=Fr.r,i.g=Fr.g,i.b=Fr.b,i}getStyle(i=Ts){return qs.fromWorkingColorSpace(Id(this,Fr),i),i!==Ts?`color(${i} ${Fr.r} ${Fr.g} ${Fr.b})`:`rgb(${255*Fr.r|0},${255*Fr.g|0},${255*Fr.b|0})`}offsetHSL(i,l,h){return this.getHSL(Xo),Xo.h+=i,Xo.s+=l,Xo.l+=h,this.setHSL(Xo.h,Xo.s,Xo.l),this}add(i){return this.r+=i.r,this.g+=i.g,this.b+=i.b,this}addColors(i,l){return this.r=i.r+l.r,this.g=i.g+l.g,this.b=i.b+l.b,this}addScalar(i){return this.r+=i,this.g+=i,this.b+=i,this}sub(i){return this.r=Math.max(0,this.r-i.r),this.g=Math.max(0,this.g-i.g),this.b=Math.max(0,this.b-i.b),this}multiply(i){return this.r*=i.r,this.g*=i.g,this.b*=i.b,this}multiplyScalar(i){return this.r*=i,this.g*=i,this.b*=i,this}lerp(i,l){return this.r+=(i.r-this.r)*l,this.g+=(i.g-this.g)*l,this.b+=(i.b-this.b)*l,this}lerpColors(i,l,h){return this.r=i.r+(l.r-i.r)*h,this.g=i.g+(l.g-i.g)*h,this.b=i.b+(l.b-i.b)*h,this}lerpHSL(i,l){this.getHSL(Xo),i.getHSL(Pu);const h=Ph(Xo.h,Pu.h,l),d=Ph(Xo.s,Pu.s,l),g=Ph(Xo.l,Pu.l,l);return this.setHSL(h,d,g),this}equals(i){return i.r===this.r&&i.g===this.g&&i.b===this.b}fromArray(i,l=0){return this.r=i[l],this.g=i[l+1],this.b=i[l+2],this}toArray(i=[],l=0){return i[l]=this.r,i[l+1]=this.g,i[l+2]=this.b,i}fromBufferAttribute(i,l){return this.r=i.getX(l),this.g=i.getY(l),this.b=i.getZ(l),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}let Ko;bn.NAMES=Td;class Bh{static getDataURL(i,l=!1){if(/^data:/i.test(i.src)||typeof HTMLCanvasElement>"u")return i.src;let h;if(i instanceof HTMLCanvasElement)h=i;else{Ko===void 0&&(Ko=Nc("canvas")),Ko.width=i.width,Ko.height=i.height;const d=Ko.getContext("2d");i instanceof ImageData?d.putImageData(i,0,0):d.drawImage(i,0,0,i.width,i.height),h=Ko}return!l&&(h.width>2048||h.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",i),h.toDataURL("image/jpeg",.6)):h.toDataURL("image/png")}static sRGBToLinear(i){if(typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&i instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&i instanceof ImageBitmap){const l=Nc("canvas");l.width=i.width,l.height=i.height;const h=l.getContext("2d");h.drawImage(i,0,0,i.width,i.height);const d=h.getImageData(0,0,i.width,i.height),g=d.data;for(let v=0;v<g.length;v++)g[v]=255*ya(g[v]/255);return h.putImageData(d,0,0),l}if(i.data){const l=i.data.slice(0);for(let h=0;h<l.length;h++)l instanceof Uint8Array||l instanceof Uint8ClampedArray?l[h]=Math.floor(255*ya(l[h]/255)):l[h]=ya(l[h]);return{data:l,width:i.width,height:i.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),i}}class Fc{constructor(i=null){this.isSource=!0,this.uuid=Ws(),this.data=i,this.version=0}set needsUpdate(i){i===!0&&this.version++}toJSON(i){const l=i===void 0||typeof i=="string";if(!l&&i.images[this.uuid]!==void 0)return i.images[this.uuid];const h={uuid:this.uuid,url:""},d=this.data;if(d!==null){let g;if(Array.isArray(d)){g=[];for(let v=0,b=d.length;v<b;v++)d[v].isDataTexture?g.push(Du(d[v].image)):g.push(Du(d[v]))}else g=Du(d);h.url=g}return l||(i.images[this.uuid]=h),h}}function Du(x){if(typeof HTMLImageElement<"u"&&x instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&x instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&x instanceof ImageBitmap)return Bh.getDataURL(x);if(x.data){let i=[];try{i=Array.from(x.data)}catch(l){l.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(l),i=x.data}return{data:i,width:x.width,height:x.height,type:x.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let Up=0;class fs extends ei{constructor(i=fs.DEFAULT_IMAGE,l=fs.DEFAULT_MAPPING,h=gi,d=gi,g=nr,v=Sn,b=Nn,T=qr,I=1,N=Aa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Up++}),this.uuid=Ws(),this.name="",this.source=new Fc(i),this.mipmaps=[],this.mapping=l,this.wrapS=h,this.wrapT=d,this.magFilter=g,this.minFilter=v,this.anisotropy=I,this.format=b,this.internalFormat=null,this.type=T,this.offset=new Xt(0,0),this.repeat=new Xt(1,1),this.center=new Xt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Is,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=N,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(i){this.source.data=i}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(i){return this.name=i.name,this.source=i.source,this.mipmaps=i.mipmaps.slice(0),this.mapping=i.mapping,this.wrapS=i.wrapS,this.wrapT=i.wrapT,this.magFilter=i.magFilter,this.minFilter=i.minFilter,this.anisotropy=i.anisotropy,this.format=i.format,this.internalFormat=i.internalFormat,this.type=i.type,this.offset.copy(i.offset),this.repeat.copy(i.repeat),this.center.copy(i.center),this.rotation=i.rotation,this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrix.copy(i.matrix),this.generateMipmaps=i.generateMipmaps,this.premultiplyAlpha=i.premultiplyAlpha,this.flipY=i.flipY,this.unpackAlignment=i.unpackAlignment,this.encoding=i.encoding,this.userData=JSON.parse(JSON.stringify(i.userData)),this.needsUpdate=!0,this}toJSON(i){const l=i===void 0||typeof i=="string";if(!l&&i.textures[this.uuid]!==void 0)return i.textures[this.uuid];const h={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(i).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(h.userData=this.userData),l||(i.textures[this.uuid]=h),h}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(i){if(this.mapping!==Rr)return i;if(i.applyMatrix3(this.matrix),i.x<0||i.x>1)switch(this.wrapS){case Di:i.x=i.x-Math.floor(i.x);break;case gi:i.x=i.x<0?0:1;break;case br:Math.abs(Math.floor(i.x)%2)===1?i.x=Math.ceil(i.x)-i.x:i.x=i.x-Math.floor(i.x)}if(i.y<0||i.y>1)switch(this.wrapT){case Di:i.y=i.y-Math.floor(i.y);break;case gi:i.y=i.y<0?0:1;break;case br:Math.abs(Math.floor(i.y)%2)===1?i.y=Math.ceil(i.y)-i.y:i.y=i.y-Math.floor(i.y)}return this.flipY&&(i.y=1-i.y),i}set needsUpdate(i){i===!0&&(this.version++,this.source.needsUpdate=!0)}}fs.DEFAULT_IMAGE=null,fs.DEFAULT_MAPPING=Rr;class Zi{constructor(i=0,l=0,h=0,d=1){Zi.prototype.isVector4=!0,this.x=i,this.y=l,this.z=h,this.w=d}get width(){return this.z}set width(i){this.z=i}get height(){return this.w}set height(i){this.w=i}set(i,l,h,d){return this.x=i,this.y=l,this.z=h,this.w=d,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this.w=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setW(i){return this.w=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;case 3:this.w=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this.w=i.w!==void 0?i.w:1,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this.w+=i.w,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this.w+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this.z=i.z+l.z,this.w=i.w+l.w,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this.z+=i.z*l,this.w+=i.w*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this.w-=i.w,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this.w-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this.z=i.z-l.z,this.w=i.w-l.w,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this.w*=i.w,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this.w*=i,this}applyMatrix4(i){const l=this.x,h=this.y,d=this.z,g=this.w,v=i.elements;return this.x=v[0]*l+v[4]*h+v[8]*d+v[12]*g,this.y=v[1]*l+v[5]*h+v[9]*d+v[13]*g,this.z=v[2]*l+v[6]*h+v[10]*d+v[14]*g,this.w=v[3]*l+v[7]*h+v[11]*d+v[15]*g,this}divideScalar(i){return this.multiplyScalar(1/i)}setAxisAngleFromQuaternion(i){this.w=2*Math.acos(i.w);const l=Math.sqrt(1-i.w*i.w);return l<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=i.x/l,this.y=i.y/l,this.z=i.z/l),this}setAxisAngleFromRotationMatrix(i){let l,h,d,g;const T=i.elements,I=T[0],N=T[4],z=T[8],U=T[1],Q=T[5],Y=T[9],H=T[2],ne=T[6],ie=T[10];if(Math.abs(N-U)<.01&&Math.abs(z-H)<.01&&Math.abs(Y-ne)<.01){if(Math.abs(N+U)<.1&&Math.abs(z+H)<.1&&Math.abs(Y+ne)<.1&&Math.abs(I+Q+ie-3)<.1)return this.set(1,0,0,0),this;l=Math.PI;const ve=(I+1)/2,Ee=(Q+1)/2,Me=(ie+1)/2,Pe=(N+U)/4,Ye=(z+H)/4,Ke=(Y+ne)/4;return ve>Ee&&ve>Me?ve<.01?(h=0,d=.707106781,g=.707106781):(h=Math.sqrt(ve),d=Pe/h,g=Ye/h):Ee>Me?Ee<.01?(h=.707106781,d=0,g=.707106781):(d=Math.sqrt(Ee),h=Pe/d,g=Ke/d):Me<.01?(h=.707106781,d=.707106781,g=0):(g=Math.sqrt(Me),h=Ye/g,d=Ke/g),this.set(h,d,g,l),this}let re=Math.sqrt((ne-Y)*(ne-Y)+(z-H)*(z-H)+(U-N)*(U-N));return Math.abs(re)<.001&&(re=1),this.x=(ne-Y)/re,this.y=(z-H)/re,this.z=(U-N)/re,this.w=Math.acos((I+Q+ie-1)/2),this}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this.w=Math.min(this.w,i.w),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this.w=Math.max(this.w,i.w),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this.z=Math.max(i.z,Math.min(l.z,this.z)),this.w=Math.max(i.w,Math.min(l.w,this.w)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this.z=Math.max(i,Math.min(l,this.z)),this.w=Math.max(i,Math.min(l,this.w)),this}clampLength(i,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(i,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z+this.w*i.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this.z+=(i.z-this.z)*l,this.w+=(i.w-this.w)*l,this}lerpVectors(i,l,h){return this.x=i.x+(l.x-i.x)*h,this.y=i.y+(l.y-i.y)*h,this.z=i.z+(l.z-i.z)*h,this.w=i.w+(l.w-i.w)*h,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z&&i.w===this.w}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this.z=i[l+2],this.w=i[l+3],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i[l+2]=this.z,i[l+3]=this.w,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this.z=i.getZ(l),this.w=i.getW(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class bo extends ei{constructor(i,l,h={}){super(),this.isWebGLRenderTarget=!0,this.width=i,this.height=l,this.depth=1,this.scissor=new Zi(0,0,i,l),this.scissorTest=!1,this.viewport=new Zi(0,0,i,l);const d={width:i,height:l,depth:1};this.texture=new fs(d,h.mapping,h.wrapS,h.wrapT,h.magFilter,h.minFilter,h.format,h.type,h.anisotropy,h.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=h.generateMipmaps!==void 0&&h.generateMipmaps,this.texture.internalFormat=h.internalFormat!==void 0?h.internalFormat:null,this.texture.minFilter=h.minFilter!==void 0?h.minFilter:nr,this.depthBuffer=h.depthBuffer===void 0||h.depthBuffer,this.stencilBuffer=h.stencilBuffer!==void 0&&h.stencilBuffer,this.depthTexture=h.depthTexture!==void 0?h.depthTexture:null,this.samples=h.samples!==void 0?h.samples:0}setSize(i,l,h=1){this.width===i&&this.height===l&&this.depth===h||(this.width=i,this.height=l,this.depth=h,this.texture.image.width=i,this.texture.image.height=l,this.texture.image.depth=h,this.dispose()),this.viewport.set(0,0,i,l),this.scissor.set(0,0,i,l)}clone(){return new this.constructor().copy(this)}copy(i){this.width=i.width,this.height=i.height,this.depth=i.depth,this.viewport.copy(i.viewport),this.texture=i.texture.clone(),this.texture.isRenderTargetTexture=!0;const l=Object.assign({},i.texture.image);return this.texture.source=new Fc(l),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.samples=i.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Ru extends fs{constructor(i=null,l=1,h=1,d=1){super(null),this.isDataArrayTexture=!0,this.image={data:i,width:l,height:h,depth:d},this.magFilter=ar,this.minFilter=ar,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Tm extends bo{constructor(i,l,h){super(i,l),this.isWebGLArrayRenderTarget=!0,this.depth=h,this.texture=new Ru(null,i,l,h),this.texture.isRenderTargetTexture=!0}}class Uc extends fs{constructor(i=null,l=1,h=1,d=1){super(null),this.isData3DTexture=!0,this.image={data:i,width:l,height:h,depth:d},this.magFilter=ar,this.minFilter=ar,this.wrapR=gi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pd extends bo{constructor(i,l,h){super(i,l),this.isWebGL3DRenderTarget=!0,this.depth=h,this.texture=new Uc(null,i,l,h),this.texture.isRenderTargetTexture=!0}}class Jo extends bo{constructor(i,l,h,d={}){super(i,l,d),this.isWebGLMultipleRenderTargets=!0;const g=this.texture;this.texture=[];for(let v=0;v<h;v++)this.texture[v]=g.clone(),this.texture[v].isRenderTargetTexture=!0}setSize(i,l,h=1){if(this.width!==i||this.height!==l||this.depth!==h){this.width=i,this.height=l,this.depth=h;for(let d=0,g=this.texture.length;d<g;d++)this.texture[d].image.width=i,this.texture[d].image.height=l,this.texture[d].image.depth=h;this.dispose()}return this.viewport.set(0,0,i,l),this.scissor.set(0,0,i,l),this}copy(i){this.dispose(),this.width=i.width,this.height=i.height,this.depth=i.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,i.depthTexture!==null&&(this.depthTexture=i.depthTexture.clone()),this.texture.length=0;for(let l=0,h=i.texture.length;l<h;l++)this.texture[l]=i.texture[l].clone(),this.texture[l].isRenderTargetTexture=!0;return this}}class Ps{constructor(i=0,l=0,h=0,d=1){this.isQuaternion=!0,this._x=i,this._y=l,this._z=h,this._w=d}static slerpFlat(i,l,h,d,g,v,b){let T=h[d+0],I=h[d+1],N=h[d+2],z=h[d+3];const U=g[v+0],Q=g[v+1],Y=g[v+2],H=g[v+3];if(b===0)return i[l+0]=T,i[l+1]=I,i[l+2]=N,void(i[l+3]=z);if(b===1)return i[l+0]=U,i[l+1]=Q,i[l+2]=Y,void(i[l+3]=H);if(z!==H||T!==U||I!==Q||N!==Y){let ne=1-b;const ie=T*U+I*Q+N*Y+z*H,re=ie>=0?1:-1,ve=1-ie*ie;if(ve>Number.EPSILON){const Me=Math.sqrt(ve),Pe=Math.atan2(Me,ie*re);ne=Math.sin(ne*Pe)/Me,b=Math.sin(b*Pe)/Me}const Ee=b*re;if(T=T*ne+U*Ee,I=I*ne+Q*Ee,N=N*ne+Y*Ee,z=z*ne+H*Ee,ne===1-b){const Me=1/Math.sqrt(T*T+I*I+N*N+z*z);T*=Me,I*=Me,N*=Me,z*=Me}}i[l]=T,i[l+1]=I,i[l+2]=N,i[l+3]=z}static multiplyQuaternionsFlat(i,l,h,d,g,v){const b=h[d],T=h[d+1],I=h[d+2],N=h[d+3],z=g[v],U=g[v+1],Q=g[v+2],Y=g[v+3];return i[l]=b*Y+N*z+T*Q-I*U,i[l+1]=T*Y+N*U+I*z-b*Q,i[l+2]=I*Y+N*Q+b*U-T*z,i[l+3]=N*Y-b*z-T*U-I*Q,i}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get w(){return this._w}set w(i){this._w=i,this._onChangeCallback()}set(i,l,h,d){return this._x=i,this._y=l,this._z=h,this._w=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(i){return this._x=i.x,this._y=i.y,this._z=i.z,this._w=i.w,this._onChangeCallback(),this}setFromEuler(i,l){const h=i._x,d=i._y,g=i._z,v=i._order,b=Math.cos,T=Math.sin,I=b(h/2),N=b(d/2),z=b(g/2),U=T(h/2),Q=T(d/2),Y=T(g/2);switch(v){case"XYZ":this._x=U*N*z+I*Q*Y,this._y=I*Q*z-U*N*Y,this._z=I*N*Y+U*Q*z,this._w=I*N*z-U*Q*Y;break;case"YXZ":this._x=U*N*z+I*Q*Y,this._y=I*Q*z-U*N*Y,this._z=I*N*Y-U*Q*z,this._w=I*N*z+U*Q*Y;break;case"ZXY":this._x=U*N*z-I*Q*Y,this._y=I*Q*z+U*N*Y,this._z=I*N*Y+U*Q*z,this._w=I*N*z-U*Q*Y;break;case"ZYX":this._x=U*N*z-I*Q*Y,this._y=I*Q*z+U*N*Y,this._z=I*N*Y-U*Q*z,this._w=I*N*z+U*Q*Y;break;case"YZX":this._x=U*N*z+I*Q*Y,this._y=I*Q*z+U*N*Y,this._z=I*N*Y-U*Q*z,this._w=I*N*z-U*Q*Y;break;case"XZY":this._x=U*N*z-I*Q*Y,this._y=I*Q*z-U*N*Y,this._z=I*N*Y+U*Q*z,this._w=I*N*z+U*Q*Y;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+v)}return l!==!1&&this._onChangeCallback(),this}setFromAxisAngle(i,l){const h=l/2,d=Math.sin(h);return this._x=i.x*d,this._y=i.y*d,this._z=i.z*d,this._w=Math.cos(h),this._onChangeCallback(),this}setFromRotationMatrix(i){const l=i.elements,h=l[0],d=l[4],g=l[8],v=l[1],b=l[5],T=l[9],I=l[2],N=l[6],z=l[10],U=h+b+z;if(U>0){const Q=.5/Math.sqrt(U+1);this._w=.25/Q,this._x=(N-T)*Q,this._y=(g-I)*Q,this._z=(v-d)*Q}else if(h>b&&h>z){const Q=2*Math.sqrt(1+h-b-z);this._w=(N-T)/Q,this._x=.25*Q,this._y=(d+v)/Q,this._z=(g+I)/Q}else if(b>z){const Q=2*Math.sqrt(1+b-h-z);this._w=(g-I)/Q,this._x=(d+v)/Q,this._y=.25*Q,this._z=(T+N)/Q}else{const Q=2*Math.sqrt(1+z-h-b);this._w=(v-d)/Q,this._x=(g+I)/Q,this._y=(T+N)/Q,this._z=.25*Q}return this._onChangeCallback(),this}setFromUnitVectors(i,l){let h=i.dot(l)+1;return h<Number.EPSILON?(h=0,Math.abs(i.x)>Math.abs(i.z)?(this._x=-i.y,this._y=i.x,this._z=0,this._w=h):(this._x=0,this._y=-i.z,this._z=i.y,this._w=h)):(this._x=i.y*l.z-i.z*l.y,this._y=i.z*l.x-i.x*l.z,this._z=i.x*l.y-i.y*l.x,this._w=h),this.normalize()}angleTo(i){return 2*Math.acos(Math.abs(Vn(this.dot(i),-1,1)))}rotateTowards(i,l){const h=this.angleTo(i);if(h===0)return this;const d=Math.min(1,l/h);return this.slerp(i,d),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(i){return this._x*i._x+this._y*i._y+this._z*i._z+this._w*i._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let i=this.length();return i===0?(this._x=0,this._y=0,this._z=0,this._w=1):(i=1/i,this._x=this._x*i,this._y=this._y*i,this._z=this._z*i,this._w=this._w*i),this._onChangeCallback(),this}multiply(i){return this.multiplyQuaternions(this,i)}premultiply(i){return this.multiplyQuaternions(i,this)}multiplyQuaternions(i,l){const h=i._x,d=i._y,g=i._z,v=i._w,b=l._x,T=l._y,I=l._z,N=l._w;return this._x=h*N+v*b+d*I-g*T,this._y=d*N+v*T+g*b-h*I,this._z=g*N+v*I+h*T-d*b,this._w=v*N-h*b-d*T-g*I,this._onChangeCallback(),this}slerp(i,l){if(l===0)return this;if(l===1)return this.copy(i);const h=this._x,d=this._y,g=this._z,v=this._w;let b=v*i._w+h*i._x+d*i._y+g*i._z;if(b<0?(this._w=-i._w,this._x=-i._x,this._y=-i._y,this._z=-i._z,b=-b):this.copy(i),b>=1)return this._w=v,this._x=h,this._y=d,this._z=g,this;const T=1-b*b;if(T<=Number.EPSILON){const Q=1-l;return this._w=Q*v+l*this._w,this._x=Q*h+l*this._x,this._y=Q*d+l*this._y,this._z=Q*g+l*this._z,this.normalize(),this._onChangeCallback(),this}const I=Math.sqrt(T),N=Math.atan2(I,b),z=Math.sin((1-l)*N)/I,U=Math.sin(l*N)/I;return this._w=v*z+this._w*U,this._x=h*z+this._x*U,this._y=d*z+this._y*U,this._z=g*z+this._z*U,this._onChangeCallback(),this}slerpQuaternions(i,l,h){return this.copy(i).slerp(l,h)}random(){const i=Math.random(),l=Math.sqrt(1-i),h=Math.sqrt(i),d=2*Math.PI*Math.random(),g=2*Math.PI*Math.random();return this.set(l*Math.cos(d),h*Math.sin(g),h*Math.cos(g),l*Math.sin(d))}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._w===this._w}fromArray(i,l=0){return this._x=i[l],this._y=i[l+1],this._z=i[l+2],this._w=i[l+3],this._onChangeCallback(),this}toArray(i=[],l=0){return i[l]=this._x,i[l+1]=this._y,i[l+2]=this._z,i[l+3]=this._w,i}fromBufferAttribute(i,l){return this._x=i.getX(l),this._y=i.getY(l),this._z=i.getZ(l),this._w=i.getW(l),this}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Re{constructor(i=0,l=0,h=0){Re.prototype.isVector3=!0,this.x=i,this.y=l,this.z=h}set(i,l,h){return h===void 0&&(h=this.z),this.x=i,this.y=l,this.z=h,this}setScalar(i){return this.x=i,this.y=i,this.z=i,this}setX(i){return this.x=i,this}setY(i){return this.y=i,this}setZ(i){return this.z=i,this}setComponent(i,l){switch(i){case 0:this.x=l;break;case 1:this.y=l;break;case 2:this.z=l;break;default:throw new Error("index is out of range: "+i)}return this}getComponent(i){switch(i){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+i)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(i){return this.x=i.x,this.y=i.y,this.z=i.z,this}add(i){return this.x+=i.x,this.y+=i.y,this.z+=i.z,this}addScalar(i){return this.x+=i,this.y+=i,this.z+=i,this}addVectors(i,l){return this.x=i.x+l.x,this.y=i.y+l.y,this.z=i.z+l.z,this}addScaledVector(i,l){return this.x+=i.x*l,this.y+=i.y*l,this.z+=i.z*l,this}sub(i){return this.x-=i.x,this.y-=i.y,this.z-=i.z,this}subScalar(i){return this.x-=i,this.y-=i,this.z-=i,this}subVectors(i,l){return this.x=i.x-l.x,this.y=i.y-l.y,this.z=i.z-l.z,this}multiply(i){return this.x*=i.x,this.y*=i.y,this.z*=i.z,this}multiplyScalar(i){return this.x*=i,this.y*=i,this.z*=i,this}multiplyVectors(i,l){return this.x=i.x*l.x,this.y=i.y*l.y,this.z=i.z*l.z,this}applyEuler(i){return this.applyQuaternion($o.setFromEuler(i))}applyAxisAngle(i,l){return this.applyQuaternion($o.setFromAxisAngle(i,l))}applyMatrix3(i){const l=this.x,h=this.y,d=this.z,g=i.elements;return this.x=g[0]*l+g[3]*h+g[6]*d,this.y=g[1]*l+g[4]*h+g[7]*d,this.z=g[2]*l+g[5]*h+g[8]*d,this}applyNormalMatrix(i){return this.applyMatrix3(i).normalize()}applyMatrix4(i){const l=this.x,h=this.y,d=this.z,g=i.elements,v=1/(g[3]*l+g[7]*h+g[11]*d+g[15]);return this.x=(g[0]*l+g[4]*h+g[8]*d+g[12])*v,this.y=(g[1]*l+g[5]*h+g[9]*d+g[13])*v,this.z=(g[2]*l+g[6]*h+g[10]*d+g[14])*v,this}applyQuaternion(i){const l=this.x,h=this.y,d=this.z,g=i.x,v=i.y,b=i.z,T=i.w,I=T*l+v*d-b*h,N=T*h+b*l-g*d,z=T*d+g*h-v*l,U=-g*l-v*h-b*d;return this.x=I*T+U*-g+N*-b-z*-v,this.y=N*T+U*-v+z*-g-I*-b,this.z=z*T+U*-b+I*-v-N*-g,this}project(i){return this.applyMatrix4(i.matrixWorldInverse).applyMatrix4(i.projectionMatrix)}unproject(i){return this.applyMatrix4(i.projectionMatrixInverse).applyMatrix4(i.matrixWorld)}transformDirection(i){const l=this.x,h=this.y,d=this.z,g=i.elements;return this.x=g[0]*l+g[4]*h+g[8]*d,this.y=g[1]*l+g[5]*h+g[9]*d,this.z=g[2]*l+g[6]*h+g[10]*d,this.normalize()}divide(i){return this.x/=i.x,this.y/=i.y,this.z/=i.z,this}divideScalar(i){return this.multiplyScalar(1/i)}min(i){return this.x=Math.min(this.x,i.x),this.y=Math.min(this.y,i.y),this.z=Math.min(this.z,i.z),this}max(i){return this.x=Math.max(this.x,i.x),this.y=Math.max(this.y,i.y),this.z=Math.max(this.z,i.z),this}clamp(i,l){return this.x=Math.max(i.x,Math.min(l.x,this.x)),this.y=Math.max(i.y,Math.min(l.y,this.y)),this.z=Math.max(i.z,Math.min(l.z,this.z)),this}clampScalar(i,l){return this.x=Math.max(i,Math.min(l,this.x)),this.y=Math.max(i,Math.min(l,this.y)),this.z=Math.max(i,Math.min(l,this.z)),this}clampLength(i,l){const h=this.length();return this.divideScalar(h||1).multiplyScalar(Math.max(i,Math.min(l,h)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(i){return this.x*i.x+this.y*i.y+this.z*i.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(i){return this.normalize().multiplyScalar(i)}lerp(i,l){return this.x+=(i.x-this.x)*l,this.y+=(i.y-this.y)*l,this.z+=(i.z-this.z)*l,this}lerpVectors(i,l,h){return this.x=i.x+(l.x-i.x)*h,this.y=i.y+(l.y-i.y)*h,this.z=i.z+(l.z-i.z)*h,this}cross(i){return this.crossVectors(this,i)}crossVectors(i,l){const h=i.x,d=i.y,g=i.z,v=l.x,b=l.y,T=l.z;return this.x=d*T-g*b,this.y=g*v-h*T,this.z=h*b-d*v,this}projectOnVector(i){const l=i.lengthSq();if(l===0)return this.set(0,0,0);const h=i.dot(this)/l;return this.copy(i).multiplyScalar(h)}projectOnPlane(i){return _l.copy(this).projectOnVector(i),this.sub(_l)}reflect(i){return this.sub(_l.copy(i).multiplyScalar(2*this.dot(i)))}angleTo(i){const l=Math.sqrt(this.lengthSq()*i.lengthSq());if(l===0)return Math.PI/2;const h=this.dot(i)/l;return Math.acos(Vn(h,-1,1))}distanceTo(i){return Math.sqrt(this.distanceToSquared(i))}distanceToSquared(i){const l=this.x-i.x,h=this.y-i.y,d=this.z-i.z;return l*l+h*h+d*d}manhattanDistanceTo(i){return Math.abs(this.x-i.x)+Math.abs(this.y-i.y)+Math.abs(this.z-i.z)}setFromSpherical(i){return this.setFromSphericalCoords(i.radius,i.phi,i.theta)}setFromSphericalCoords(i,l,h){const d=Math.sin(l)*i;return this.x=d*Math.sin(h),this.y=Math.cos(l)*i,this.z=d*Math.cos(h),this}setFromCylindrical(i){return this.setFromCylindricalCoords(i.radius,i.theta,i.y)}setFromCylindricalCoords(i,l,h){return this.x=i*Math.sin(l),this.y=h,this.z=i*Math.cos(l),this}setFromMatrixPosition(i){const l=i.elements;return this.x=l[12],this.y=l[13],this.z=l[14],this}setFromMatrixScale(i){const l=this.setFromMatrixColumn(i,0).length(),h=this.setFromMatrixColumn(i,1).length(),d=this.setFromMatrixColumn(i,2).length();return this.x=l,this.y=h,this.z=d,this}setFromMatrixColumn(i,l){return this.fromArray(i.elements,4*l)}setFromMatrix3Column(i,l){return this.fromArray(i.elements,3*l)}setFromEuler(i){return this.x=i._x,this.y=i._y,this.z=i._z,this}equals(i){return i.x===this.x&&i.y===this.y&&i.z===this.z}fromArray(i,l=0){return this.x=i[l],this.y=i[l+1],this.z=i[l+2],this}toArray(i=[],l=0){return i[l]=this.x,i[l+1]=this.y,i[l+2]=this.z,i}fromBufferAttribute(i,l){return this.x=i.getX(l),this.y=i.getY(l),this.z=i.getZ(l),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const i=2*(Math.random()-.5),l=Math.random()*Math.PI*2,h=Math.sqrt(1-i**2);return this.x=h*Math.cos(l),this.y=h*Math.sin(l),this.z=i,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const _l=new Re,$o=new Ps;class jc{constructor(i=new Re(1/0,1/0,1/0),l=new Re(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=i,this.max=l}set(i,l){return this.min.copy(i),this.max.copy(l),this}setFromArray(i){let l=1/0,h=1/0,d=1/0,g=-1/0,v=-1/0,b=-1/0;for(let T=0,I=i.length;T<I;T+=3){const N=i[T],z=i[T+1],U=i[T+2];N<l&&(l=N),z<h&&(h=z),U<d&&(d=U),N>g&&(g=N),z>v&&(v=z),U>b&&(b=U)}return this.min.set(l,h,d),this.max.set(g,v,b),this}setFromBufferAttribute(i){let l=1/0,h=1/0,d=1/0,g=-1/0,v=-1/0,b=-1/0;for(let T=0,I=i.count;T<I;T++){const N=i.getX(T),z=i.getY(T),U=i.getZ(T);N<l&&(l=N),z<h&&(h=z),U<d&&(d=U),N>g&&(g=N),z>v&&(v=z),U>b&&(b=U)}return this.min.set(l,h,d),this.max.set(g,v,b),this}setFromPoints(i){this.makeEmpty();for(let l=0,h=i.length;l<h;l++)this.expandByPoint(i[l]);return this}setFromCenterAndSize(i,l){const h=zc.copy(l).multiplyScalar(.5);return this.min.copy(i).sub(h),this.max.copy(i).add(h),this}setFromObject(i,l=!1){return this.makeEmpty(),this.expandByObject(i,l)}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(i){return this.isEmpty()?i.set(0,0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}expandByObject(i,l=!1){i.updateWorldMatrix(!1,!1);const h=i.geometry;if(h!==void 0)if(l&&h.attributes!=null&&h.attributes.position!==void 0){const g=h.attributes.position;for(let v=0,b=g.count;v<b;v++)zc.fromBufferAttribute(g,v).applyMatrix4(i.matrixWorld),this.expandByPoint(zc)}else h.boundingBox===null&&h.computeBoundingBox(),Dd.copy(h.boundingBox),Dd.applyMatrix4(i.matrixWorld),this.union(Dd);const d=i.children;for(let g=0,v=d.length;g<v;g++)this.expandByObject(d[g],l);return this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y||i.z<this.min.z||i.z>this.max.z)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y&&this.min.z<=i.min.z&&i.max.z<=this.max.z}getParameter(i,l){return l.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y),(i.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y||i.max.z<this.min.z||i.min.z>this.max.z)}intersectsSphere(i){return this.clampPoint(i.center,zc),zc.distanceToSquared(i.center)<=i.radius*i.radius}intersectsPlane(i){let l,h;return i.normal.x>0?(l=i.normal.x*this.min.x,h=i.normal.x*this.max.x):(l=i.normal.x*this.max.x,h=i.normal.x*this.min.x),i.normal.y>0?(l+=i.normal.y*this.min.y,h+=i.normal.y*this.max.y):(l+=i.normal.y*this.max.y,h+=i.normal.y*this.min.y),i.normal.z>0?(l+=i.normal.z*this.min.z,h+=i.normal.z*this.max.z):(l+=i.normal.z*this.max.z,h+=i.normal.z*this.min.z),l<=-i.constant&&h>=-i.constant}intersectsTriangle(i){if(this.isEmpty())return!1;this.getCenter(Bu),Rd.subVectors(this.max,Bu),ba.subVectors(i.a,Bu),Jl.subVectors(i.b,Bu),Al.subVectors(i.c,Bu),wa.subVectors(Jl,ba),$l.subVectors(Al,Jl),wo.subVectors(ba,Al);let l=[0,-wa.z,wa.y,0,-$l.z,$l.y,0,-wo.z,wo.y,wa.z,0,-wa.x,$l.z,0,-$l.x,wo.z,0,-wo.x,-wa.y,wa.x,0,-$l.y,$l.x,0,-wo.y,wo.x,0];return!!Bd(l,ba,Jl,Al,Rd)&&(l=[1,0,0,0,1,0,0,0,1],!!Bd(l,ba,Jl,Al,Rd)&&(Vc.crossVectors(wa,$l),l=[Vc.x,Vc.y,Vc.z],Bd(l,ba,Jl,Al,Rd)))}clampPoint(i,l){return l.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return zc.copy(i).clamp(this.min,this.max).sub(i).length()}getBoundingSphere(i){return this.getCenter(i.center),i.radius=.5*this.getSize(zc).length(),i}intersect(i){return this.min.max(i.min),this.max.min(i.max),this.isEmpty()&&this.makeEmpty(),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}applyMatrix4(i){return this.isEmpty()||(vl[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(i),vl[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(i),vl[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(i),vl[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(i),vl[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(i),vl[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(i),vl[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(i),vl[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(i),this.setFromPoints(vl)),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}}const vl=[new Re,new Re,new Re,new Re,new Re,new Re,new Re,new Re],zc=new Re,Dd=new jc,ba=new Re,Jl=new Re,Al=new Re,wa=new Re,$l=new Re,wo=new Re,Bu=new Re,Rd=new Re,Vc=new Re,Zl=new Re;function Bd(x,i,l,h,d){for(let g=0,v=x.length-3;g<=v;g+=3){Zl.fromArray(x,g);const b=d.x*Math.abs(Zl.x)+d.y*Math.abs(Zl.y)+d.z*Math.abs(Zl.z),T=i.dot(Zl),I=l.dot(Zl),N=h.dot(Zl);if(Math.max(-Math.max(T,I,N),Math.min(T,I,N))>b)return!1}return!0}const Li=new jc,Mr=new Re,Zo=new Re,Bo=new Re;class ea{constructor(i=new Re,l=-1){this.center=i,this.radius=l}set(i,l){return this.center.copy(i),this.radius=l,this}setFromPoints(i,l){const h=this.center;l!==void 0?h.copy(l):Li.setFromPoints(i).getCenter(h);let d=0;for(let g=0,v=i.length;g<v;g++)d=Math.max(d,h.distanceToSquared(i[g]));return this.radius=Math.sqrt(d),this}copy(i){return this.center.copy(i.center),this.radius=i.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(i){return i.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(i){return i.distanceTo(this.center)-this.radius}intersectsSphere(i){const l=this.radius+i.radius;return i.center.distanceToSquared(this.center)<=l*l}intersectsBox(i){return i.intersectsSphere(this)}intersectsPlane(i){return Math.abs(i.distanceToPoint(this.center))<=this.radius}clampPoint(i,l){const h=this.center.distanceToSquared(i);return l.copy(i),h>this.radius*this.radius&&(l.sub(this.center).normalize(),l.multiplyScalar(this.radius).add(this.center)),l}getBoundingBox(i){return this.isEmpty()?(i.makeEmpty(),i):(i.set(this.center,this.center),i.expandByScalar(this.radius),i)}applyMatrix4(i){return this.center.applyMatrix4(i),this.radius=this.radius*i.getMaxScaleOnAxis(),this}translate(i){return this.center.add(i),this}expandByPoint(i){Bo.subVectors(i,this.center);const l=Bo.lengthSq();if(l>this.radius*this.radius){const h=Math.sqrt(l),d=.5*(h-this.radius);this.center.add(Bo.multiplyScalar(d/h)),this.radius+=d}return this}union(i){return this.center.equals(i.center)===!0?Zo.set(0,0,1).multiplyScalar(i.radius):Zo.subVectors(i.center,this.center).normalize().multiplyScalar(i.radius),this.expandByPoint(Mr.copy(i.center).add(Zo)),this.expandByPoint(Mr.copy(i.center).sub(Zo)),this}equals(i){return i.center.equals(this.center)&&i.radius===this.radius}clone(){return new this.constructor().copy(this)}}const hs=new Re,kd=new Re,ku=new Re,Ga=new Re,Ou=new Re,kh=new Re,Od=new Re;class ec{constructor(i=new Re,l=new Re(0,0,-1)){this.origin=i,this.direction=l}set(i,l){return this.origin.copy(i),this.direction.copy(l),this}copy(i){return this.origin.copy(i.origin),this.direction.copy(i.direction),this}at(i,l){return l.copy(this.direction).multiplyScalar(i).add(this.origin)}lookAt(i){return this.direction.copy(i).sub(this.origin).normalize(),this}recast(i){return this.origin.copy(this.at(i,hs)),this}closestPointToPoint(i,l){l.subVectors(i,this.origin);const h=l.dot(this.direction);return h<0?l.copy(this.origin):l.copy(this.direction).multiplyScalar(h).add(this.origin)}distanceToPoint(i){return Math.sqrt(this.distanceSqToPoint(i))}distanceSqToPoint(i){const l=hs.subVectors(i,this.origin).dot(this.direction);return l<0?this.origin.distanceToSquared(i):(hs.copy(this.direction).multiplyScalar(l).add(this.origin),hs.distanceToSquared(i))}distanceSqToSegment(i,l,h,d){kd.copy(i).add(l).multiplyScalar(.5),ku.copy(l).sub(i).normalize(),Ga.copy(this.origin).sub(kd);const g=.5*i.distanceTo(l),v=-this.direction.dot(ku),b=Ga.dot(this.direction),T=-Ga.dot(ku),I=Ga.lengthSq(),N=Math.abs(1-v*v);let z,U,Q,Y;if(N>0)if(z=v*T-b,U=v*b-T,Y=g*N,z>=0)if(U>=-Y)if(U<=Y){const H=1/N;z*=H,U*=H,Q=z*(z+v*U+2*b)+U*(v*z+U+2*T)+I}else U=g,z=Math.max(0,-(v*U+b)),Q=-z*z+U*(U+2*T)+I;else U=-g,z=Math.max(0,-(v*U+b)),Q=-z*z+U*(U+2*T)+I;else U<=-Y?(z=Math.max(0,-(-v*g+b)),U=z>0?-g:Math.min(Math.max(-g,-T),g),Q=-z*z+U*(U+2*T)+I):U<=Y?(z=0,U=Math.min(Math.max(-g,-T),g),Q=U*(U+2*T)+I):(z=Math.max(0,-(v*g+b)),U=z>0?g:Math.min(Math.max(-g,-T),g),Q=-z*z+U*(U+2*T)+I);else U=v>0?-g:g,z=Math.max(0,-(v*U+b)),Q=-z*z+U*(U+2*T)+I;return h&&h.copy(this.direction).multiplyScalar(z).add(this.origin),d&&d.copy(ku).multiplyScalar(U).add(kd),Q}intersectSphere(i,l){hs.subVectors(i.center,this.origin);const h=hs.dot(this.direction),d=hs.dot(hs)-h*h,g=i.radius*i.radius;if(d>g)return null;const v=Math.sqrt(g-d),b=h-v,T=h+v;return b<0&&T<0?null:b<0?this.at(T,l):this.at(b,l)}intersectsSphere(i){return this.distanceSqToPoint(i.center)<=i.radius*i.radius}distanceToPlane(i){const l=i.normal.dot(this.direction);if(l===0)return i.distanceToPoint(this.origin)===0?0:null;const h=-(this.origin.dot(i.normal)+i.constant)/l;return h>=0?h:null}intersectPlane(i,l){const h=this.distanceToPlane(i);return h===null?null:this.at(h,l)}intersectsPlane(i){const l=i.distanceToPoint(this.origin);return l===0||i.normal.dot(this.direction)*l<0}intersectBox(i,l){let h,d,g,v,b,T;const I=1/this.direction.x,N=1/this.direction.y,z=1/this.direction.z,U=this.origin;return I>=0?(h=(i.min.x-U.x)*I,d=(i.max.x-U.x)*I):(h=(i.max.x-U.x)*I,d=(i.min.x-U.x)*I),N>=0?(g=(i.min.y-U.y)*N,v=(i.max.y-U.y)*N):(g=(i.max.y-U.y)*N,v=(i.min.y-U.y)*N),h>v||g>d?null:((g>h||h!=h)&&(h=g),(v<d||d!=d)&&(d=v),z>=0?(b=(i.min.z-U.z)*z,T=(i.max.z-U.z)*z):(b=(i.max.z-U.z)*z,T=(i.min.z-U.z)*z),h>T||b>d?null:((b>h||h!=h)&&(h=b),(T<d||d!=d)&&(d=T),d<0?null:this.at(h>=0?h:d,l)))}intersectsBox(i){return this.intersectBox(i,hs)!==null}intersectTriangle(i,l,h,d,g){Ou.subVectors(l,i),kh.subVectors(h,i),Od.crossVectors(Ou,kh);let v,b=this.direction.dot(Od);if(b>0){if(d)return null;v=1}else{if(!(b<0))return null;v=-1,b=-b}Ga.subVectors(this.origin,i);const T=v*this.direction.dot(kh.crossVectors(Ga,kh));if(T<0)return null;const I=v*this.direction.dot(Ou.cross(Ga));if(I<0||T+I>b)return null;const N=-v*Ga.dot(Od);return N<0?null:this.at(N/b,g)}applyMatrix4(i){return this.origin.applyMatrix4(i),this.direction.transformDirection(i),this}equals(i){return i.origin.equals(this.origin)&&i.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class ti{constructor(){ti.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(i,l,h,d,g,v,b,T,I,N,z,U,Q,Y,H,ne){const ie=this.elements;return ie[0]=i,ie[4]=l,ie[8]=h,ie[12]=d,ie[1]=g,ie[5]=v,ie[9]=b,ie[13]=T,ie[2]=I,ie[6]=N,ie[10]=z,ie[14]=U,ie[3]=Q,ie[7]=Y,ie[11]=H,ie[15]=ne,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new ti().fromArray(this.elements)}copy(i){const l=this.elements,h=i.elements;return l[0]=h[0],l[1]=h[1],l[2]=h[2],l[3]=h[3],l[4]=h[4],l[5]=h[5],l[6]=h[6],l[7]=h[7],l[8]=h[8],l[9]=h[9],l[10]=h[10],l[11]=h[11],l[12]=h[12],l[13]=h[13],l[14]=h[14],l[15]=h[15],this}copyPosition(i){const l=this.elements,h=i.elements;return l[12]=h[12],l[13]=h[13],l[14]=h[14],this}setFromMatrix3(i){const l=i.elements;return this.set(l[0],l[3],l[6],0,l[1],l[4],l[7],0,l[2],l[5],l[8],0,0,0,0,1),this}extractBasis(i,l,h){return i.setFromMatrixColumn(this,0),l.setFromMatrixColumn(this,1),h.setFromMatrixColumn(this,2),this}makeBasis(i,l,h){return this.set(i.x,l.x,h.x,0,i.y,l.y,h.y,0,i.z,l.z,h.z,0,0,0,0,1),this}extractRotation(i){const l=this.elements,h=i.elements,d=1/ur.setFromMatrixColumn(i,0).length(),g=1/ur.setFromMatrixColumn(i,1).length(),v=1/ur.setFromMatrixColumn(i,2).length();return l[0]=h[0]*d,l[1]=h[1]*d,l[2]=h[2]*d,l[3]=0,l[4]=h[4]*g,l[5]=h[5]*g,l[6]=h[6]*g,l[7]=0,l[8]=h[8]*v,l[9]=h[9]*v,l[10]=h[10]*v,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromEuler(i){const l=this.elements,h=i.x,d=i.y,g=i.z,v=Math.cos(h),b=Math.sin(h),T=Math.cos(d),I=Math.sin(d),N=Math.cos(g),z=Math.sin(g);if(i.order==="XYZ"){const U=v*N,Q=v*z,Y=b*N,H=b*z;l[0]=T*N,l[4]=-T*z,l[8]=I,l[1]=Q+Y*I,l[5]=U-H*I,l[9]=-b*T,l[2]=H-U*I,l[6]=Y+Q*I,l[10]=v*T}else if(i.order==="YXZ"){const U=T*N,Q=T*z,Y=I*N,H=I*z;l[0]=U+H*b,l[4]=Y*b-Q,l[8]=v*I,l[1]=v*z,l[5]=v*N,l[9]=-b,l[2]=Q*b-Y,l[6]=H+U*b,l[10]=v*T}else if(i.order==="ZXY"){const U=T*N,Q=T*z,Y=I*N,H=I*z;l[0]=U-H*b,l[4]=-v*z,l[8]=Y+Q*b,l[1]=Q+Y*b,l[5]=v*N,l[9]=H-U*b,l[2]=-v*I,l[6]=b,l[10]=v*T}else if(i.order==="ZYX"){const U=v*N,Q=v*z,Y=b*N,H=b*z;l[0]=T*N,l[4]=Y*I-Q,l[8]=U*I+H,l[1]=T*z,l[5]=H*I+U,l[9]=Q*I-Y,l[2]=-I,l[6]=b*T,l[10]=v*T}else if(i.order==="YZX"){const U=v*T,Q=v*I,Y=b*T,H=b*I;l[0]=T*N,l[4]=H-U*z,l[8]=Y*z+Q,l[1]=z,l[5]=v*N,l[9]=-b*N,l[2]=-I*N,l[6]=Q*z+Y,l[10]=U-H*z}else if(i.order==="XZY"){const U=v*T,Q=v*I,Y=b*T,H=b*I;l[0]=T*N,l[4]=-z,l[8]=I*N,l[1]=U*z+H,l[5]=v*N,l[9]=Q*z-Y,l[2]=Y*z-Q,l[6]=b*N,l[10]=H*z+U}return l[3]=0,l[7]=0,l[11]=0,l[12]=0,l[13]=0,l[14]=0,l[15]=1,this}makeRotationFromQuaternion(i){return this.compose(ta,i,yl)}lookAt(i,l,h){const d=this.elements;return xo.subVectors(i,l),xo.lengthSq()===0&&(xo.z=1),xo.normalize(),As.crossVectors(h,xo),As.lengthSq()===0&&(Math.abs(h.z)===1?xo.x+=1e-4:xo.z+=1e-4,xo.normalize(),As.crossVectors(h,xo)),As.normalize(),Lu.crossVectors(xo,As),d[0]=As.x,d[4]=Lu.x,d[8]=xo.x,d[1]=As.y,d[5]=Lu.y,d[9]=xo.y,d[2]=As.z,d[6]=Lu.z,d[10]=xo.z,this}multiply(i){return this.multiplyMatrices(this,i)}premultiply(i){return this.multiplyMatrices(i,this)}multiplyMatrices(i,l){const h=i.elements,d=l.elements,g=this.elements,v=h[0],b=h[4],T=h[8],I=h[12],N=h[1],z=h[5],U=h[9],Q=h[13],Y=h[2],H=h[6],ne=h[10],ie=h[14],re=h[3],ve=h[7],Ee=h[11],Me=h[15],Pe=d[0],Ye=d[4],Ke=d[8],lt=d[12],ut=d[1],Ze=d[5],Ft=d[9],$t=d[13],Lt=d[2],an=d[6],ln=d[10],Ct=d[14],Dt=d[3],nn=d[7],Ut=d[11],on=d[15];return g[0]=v*Pe+b*ut+T*Lt+I*Dt,g[4]=v*Ye+b*Ze+T*an+I*nn,g[8]=v*Ke+b*Ft+T*ln+I*Ut,g[12]=v*lt+b*$t+T*Ct+I*on,g[1]=N*Pe+z*ut+U*Lt+Q*Dt,g[5]=N*Ye+z*Ze+U*an+Q*nn,g[9]=N*Ke+z*Ft+U*ln+Q*Ut,g[13]=N*lt+z*$t+U*Ct+Q*on,g[2]=Y*Pe+H*ut+ne*Lt+ie*Dt,g[6]=Y*Ye+H*Ze+ne*an+ie*nn,g[10]=Y*Ke+H*Ft+ne*ln+ie*Ut,g[14]=Y*lt+H*$t+ne*Ct+ie*on,g[3]=re*Pe+ve*ut+Ee*Lt+Me*Dt,g[7]=re*Ye+ve*Ze+Ee*an+Me*nn,g[11]=re*Ke+ve*Ft+Ee*ln+Me*Ut,g[15]=re*lt+ve*$t+Ee*Ct+Me*on,this}multiplyScalar(i){const l=this.elements;return l[0]*=i,l[4]*=i,l[8]*=i,l[12]*=i,l[1]*=i,l[5]*=i,l[9]*=i,l[13]*=i,l[2]*=i,l[6]*=i,l[10]*=i,l[14]*=i,l[3]*=i,l[7]*=i,l[11]*=i,l[15]*=i,this}determinant(){const i=this.elements,l=i[0],h=i[4],d=i[8],g=i[12],v=i[1],b=i[5],T=i[9],I=i[13],N=i[2],z=i[6],U=i[10],Q=i[14];return i[3]*(+g*T*z-d*I*z-g*b*U+h*I*U+d*b*Q-h*T*Q)+i[7]*(+l*T*Q-l*I*U+g*v*U-d*v*Q+d*I*N-g*T*N)+i[11]*(+l*I*z-l*b*Q-g*v*z+h*v*Q+g*b*N-h*I*N)+i[15]*(-d*b*N-l*T*z+l*b*U+d*v*z-h*v*U+h*T*N)}transpose(){const i=this.elements;let l;return l=i[1],i[1]=i[4],i[4]=l,l=i[2],i[2]=i[8],i[8]=l,l=i[6],i[6]=i[9],i[9]=l,l=i[3],i[3]=i[12],i[12]=l,l=i[7],i[7]=i[13],i[13]=l,l=i[11],i[11]=i[14],i[14]=l,this}setPosition(i,l,h){const d=this.elements;return i.isVector3?(d[12]=i.x,d[13]=i.y,d[14]=i.z):(d[12]=i,d[13]=l,d[14]=h),this}invert(){const i=this.elements,l=i[0],h=i[1],d=i[2],g=i[3],v=i[4],b=i[5],T=i[6],I=i[7],N=i[8],z=i[9],U=i[10],Q=i[11],Y=i[12],H=i[13],ne=i[14],ie=i[15],re=z*ne*I-H*U*I+H*T*Q-b*ne*Q-z*T*ie+b*U*ie,ve=Y*U*I-N*ne*I-Y*T*Q+v*ne*Q+N*T*ie-v*U*ie,Ee=N*H*I-Y*z*I+Y*b*Q-v*H*Q-N*b*ie+v*z*ie,Me=Y*z*T-N*H*T-Y*b*U+v*H*U+N*b*ne-v*z*ne,Pe=l*re+h*ve+d*Ee+g*Me;if(Pe===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Ye=1/Pe;return i[0]=re*Ye,i[1]=(H*U*g-z*ne*g-H*d*Q+h*ne*Q+z*d*ie-h*U*ie)*Ye,i[2]=(b*ne*g-H*T*g+H*d*I-h*ne*I-b*d*ie+h*T*ie)*Ye,i[3]=(z*T*g-b*U*g-z*d*I+h*U*I+b*d*Q-h*T*Q)*Ye,i[4]=ve*Ye,i[5]=(N*ne*g-Y*U*g+Y*d*Q-l*ne*Q-N*d*ie+l*U*ie)*Ye,i[6]=(Y*T*g-v*ne*g-Y*d*I+l*ne*I+v*d*ie-l*T*ie)*Ye,i[7]=(v*U*g-N*T*g+N*d*I-l*U*I-v*d*Q+l*T*Q)*Ye,i[8]=Ee*Ye,i[9]=(Y*z*g-N*H*g-Y*h*Q+l*H*Q+N*h*ie-l*z*ie)*Ye,i[10]=(v*H*g-Y*b*g+Y*h*I-l*H*I-v*h*ie+l*b*ie)*Ye,i[11]=(N*b*g-v*z*g-N*h*I+l*z*I+v*h*Q-l*b*Q)*Ye,i[12]=Me*Ye,i[13]=(N*H*d-Y*z*d+Y*h*U-l*H*U-N*h*ne+l*z*ne)*Ye,i[14]=(Y*b*d-v*H*d-Y*h*T+l*H*T+v*h*ne-l*b*ne)*Ye,i[15]=(v*z*d-N*b*d+N*h*T-l*z*T-v*h*U+l*b*U)*Ye,this}scale(i){const l=this.elements,h=i.x,d=i.y,g=i.z;return l[0]*=h,l[4]*=d,l[8]*=g,l[1]*=h,l[5]*=d,l[9]*=g,l[2]*=h,l[6]*=d,l[10]*=g,l[3]*=h,l[7]*=d,l[11]*=g,this}getMaxScaleOnAxis(){const i=this.elements,l=i[0]*i[0]+i[1]*i[1]+i[2]*i[2],h=i[4]*i[4]+i[5]*i[5]+i[6]*i[6],d=i[8]*i[8]+i[9]*i[9]+i[10]*i[10];return Math.sqrt(Math.max(l,h,d))}makeTranslation(i,l,h){return this.set(1,0,0,i,0,1,0,l,0,0,1,h,0,0,0,1),this}makeRotationX(i){const l=Math.cos(i),h=Math.sin(i);return this.set(1,0,0,0,0,l,-h,0,0,h,l,0,0,0,0,1),this}makeRotationY(i){const l=Math.cos(i),h=Math.sin(i);return this.set(l,0,h,0,0,1,0,0,-h,0,l,0,0,0,0,1),this}makeRotationZ(i){const l=Math.cos(i),h=Math.sin(i);return this.set(l,-h,0,0,h,l,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(i,l){const h=Math.cos(l),d=Math.sin(l),g=1-h,v=i.x,b=i.y,T=i.z,I=g*v,N=g*b;return this.set(I*v+h,I*b-d*T,I*T+d*b,0,I*b+d*T,N*b+h,N*T-d*v,0,I*T-d*b,N*T+d*v,g*T*T+h,0,0,0,0,1),this}makeScale(i,l,h){return this.set(i,0,0,0,0,l,0,0,0,0,h,0,0,0,0,1),this}makeShear(i,l,h,d,g,v){return this.set(1,h,g,0,i,1,v,0,l,d,1,0,0,0,0,1),this}compose(i,l,h){const d=this.elements,g=l._x,v=l._y,b=l._z,T=l._w,I=g+g,N=v+v,z=b+b,U=g*I,Q=g*N,Y=g*z,H=v*N,ne=v*z,ie=b*z,re=T*I,ve=T*N,Ee=T*z,Me=h.x,Pe=h.y,Ye=h.z;return d[0]=(1-(H+ie))*Me,d[1]=(Q+Ee)*Me,d[2]=(Y-ve)*Me,d[3]=0,d[4]=(Q-Ee)*Pe,d[5]=(1-(U+ie))*Pe,d[6]=(ne+re)*Pe,d[7]=0,d[8]=(Y+ve)*Ye,d[9]=(ne-re)*Ye,d[10]=(1-(U+H))*Ye,d[11]=0,d[12]=i.x,d[13]=i.y,d[14]=i.z,d[15]=1,this}decompose(i,l,h){const d=this.elements;let g=ur.set(d[0],d[1],d[2]).length();const v=ur.set(d[4],d[5],d[6]).length(),b=ur.set(d[8],d[9],d[10]).length();this.determinant()<0&&(g=-g),i.x=d[12],i.y=d[13],i.z=d[14],vs.copy(this);const T=1/g,I=1/v,N=1/b;return vs.elements[0]*=T,vs.elements[1]*=T,vs.elements[2]*=T,vs.elements[4]*=I,vs.elements[5]*=I,vs.elements[6]*=I,vs.elements[8]*=N,vs.elements[9]*=N,vs.elements[10]*=N,l.setFromRotationMatrix(vs),h.x=g,h.y=v,h.z=b,this}makePerspective(i,l,h,d,g,v){const b=this.elements,T=2*g/(l-i),I=2*g/(h-d),N=(l+i)/(l-i),z=(h+d)/(h-d),U=-(v+g)/(v-g),Q=-2*v*g/(v-g);return b[0]=T,b[4]=0,b[8]=N,b[12]=0,b[1]=0,b[5]=I,b[9]=z,b[13]=0,b[2]=0,b[6]=0,b[10]=U,b[14]=Q,b[3]=0,b[7]=0,b[11]=-1,b[15]=0,this}makeOrthographic(i,l,h,d,g,v){const b=this.elements,T=1/(l-i),I=1/(h-d),N=1/(v-g),z=(l+i)*T,U=(h+d)*I,Q=(v+g)*N;return b[0]=2*T,b[4]=0,b[8]=0,b[12]=-z,b[1]=0,b[5]=2*I,b[9]=0,b[13]=-U,b[2]=0,b[6]=0,b[10]=-2*N,b[14]=-Q,b[3]=0,b[7]=0,b[11]=0,b[15]=1,this}equals(i){const l=this.elements,h=i.elements;for(let d=0;d<16;d++)if(l[d]!==h[d])return!1;return!0}fromArray(i,l=0){for(let h=0;h<16;h++)this.elements[h]=i[h+l];return this}toArray(i=[],l=0){const h=this.elements;return i[l]=h[0],i[l+1]=h[1],i[l+2]=h[2],i[l+3]=h[3],i[l+4]=h[4],i[l+5]=h[5],i[l+6]=h[6],i[l+7]=h[7],i[l+8]=h[8],i[l+9]=h[9],i[l+10]=h[10],i[l+11]=h[11],i[l+12]=h[12],i[l+13]=h[13],i[l+14]=h[14],i[l+15]=h[15],i}}const ur=new Re,vs=new ti,ta=new Re(0,0,0),yl=new Re(1,1,1),As=new Re,Lu=new Re,xo=new Re,jp=new ti,Oh=new Ps;class xa{constructor(i=0,l=0,h=0,d=xa.DefaultOrder){this.isEuler=!0,this._x=i,this._y=l,this._z=h,this._order=d}get x(){return this._x}set x(i){this._x=i,this._onChangeCallback()}get y(){return this._y}set y(i){this._y=i,this._onChangeCallback()}get z(){return this._z}set z(i){this._z=i,this._onChangeCallback()}get order(){return this._order}set order(i){this._order=i,this._onChangeCallback()}set(i,l,h,d=this._order){return this._x=i,this._y=l,this._z=h,this._order=d,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(i){return this._x=i._x,this._y=i._y,this._z=i._z,this._order=i._order,this._onChangeCallback(),this}setFromRotationMatrix(i,l=this._order,h=!0){const d=i.elements,g=d[0],v=d[4],b=d[8],T=d[1],I=d[5],N=d[9],z=d[2],U=d[6],Q=d[10];switch(l){case"XYZ":this._y=Math.asin(Vn(b,-1,1)),Math.abs(b)<.9999999?(this._x=Math.atan2(-N,Q),this._z=Math.atan2(-v,g)):(this._x=Math.atan2(U,I),this._z=0);break;case"YXZ":this._x=Math.asin(-Vn(N,-1,1)),Math.abs(N)<.9999999?(this._y=Math.atan2(b,Q),this._z=Math.atan2(T,I)):(this._y=Math.atan2(-z,g),this._z=0);break;case"ZXY":this._x=Math.asin(Vn(U,-1,1)),Math.abs(U)<.9999999?(this._y=Math.atan2(-z,Q),this._z=Math.atan2(-v,I)):(this._y=0,this._z=Math.atan2(T,g));break;case"ZYX":this._y=Math.asin(-Vn(z,-1,1)),Math.abs(z)<.9999999?(this._x=Math.atan2(U,Q),this._z=Math.atan2(T,g)):(this._x=0,this._z=Math.atan2(-v,I));break;case"YZX":this._z=Math.asin(Vn(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(-N,I),this._y=Math.atan2(-z,g)):(this._x=0,this._y=Math.atan2(b,Q));break;case"XZY":this._z=Math.asin(-Vn(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(U,I),this._y=Math.atan2(b,g)):(this._x=Math.atan2(-N,Q),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+l)}return this._order=l,h===!0&&this._onChangeCallback(),this}setFromQuaternion(i,l,h){return jp.makeRotationFromQuaternion(i),this.setFromRotationMatrix(jp,l,h)}setFromVector3(i,l=this._order){return this.set(i.x,i.y,i.z,l)}reorder(i){return Oh.setFromEuler(this),this.setFromQuaternion(Oh,i)}equals(i){return i._x===this._x&&i._y===this._y&&i._z===this._z&&i._order===this._order}fromArray(i){return this._x=i[0],this._y=i[1],this._z=i[2],i[3]!==void 0&&(this._order=i[3]),this._onChangeCallback(),this}toArray(i=[],l=0){return i[l]=this._x,i[l+1]=this._y,i[l+2]=this._z,i[l+3]=this._order,i}_onChange(i){return this._onChangeCallback=i,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}xa.DefaultOrder="XYZ",xa.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class so{constructor(){this.mask=1}set(i){this.mask=(1<<i|0)>>>0}enable(i){this.mask|=1<<i|0}enableAll(){this.mask=-1}toggle(i){this.mask^=1<<i|0}disable(i){this.mask&=~(1<<i|0)}disableAll(){this.mask=0}test(i){return(this.mask&i.mask)!=0}isEnabled(i){return(this.mask&(1<<i|0))!=0}}let bl=0;const Gc=new Re,Ds=new Ps,ko=new ti,Ys=new Re,Qa=new Re,Ld=new Re,tc=new Ps,Lh=new Re(1,0,0),Qc=new Re(0,1,0),nc=new Re(0,0,1),Nd={type:"added"},zp={type:"removed"};class pi extends ei{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:bl++}),this.uuid=Ws(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=pi.DefaultUp.clone();const i=new Re,l=new xa,h=new Ps,d=new Re(1,1,1);l._onChange(function(){h.setFromEuler(l,!1)}),h._onChange(function(){l.setFromQuaternion(h,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:i},rotation:{configurable:!0,enumerable:!0,value:l},quaternion:{configurable:!0,enumerable:!0,value:h},scale:{configurable:!0,enumerable:!0,value:d},modelViewMatrix:{value:new ti},normalMatrix:{value:new Is}}),this.matrix=new ti,this.matrixWorld=new ti,this.matrixAutoUpdate=pi.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=pi.DefaultMatrixWorldAutoUpdate,this.layers=new so,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(i,l,h,d,g,v){this.dispatchEvent({type:"beforeRender",renderer:i,scene:l,camera:h,geometry:d,material:g,group:v})}onAfterRender(){}applyMatrix4(i){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(i),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(i){return this.quaternion.premultiply(i),this}setRotationFromAxisAngle(i,l){this.quaternion.setFromAxisAngle(i,l)}setRotationFromEuler(i){this.quaternion.setFromEuler(i,!0)}setRotationFromMatrix(i){this.quaternion.setFromRotationMatrix(i)}setRotationFromQuaternion(i){this.quaternion.copy(i)}rotateOnAxis(i,l){return Ds.setFromAxisAngle(i,l),this.quaternion.multiply(Ds),this}rotateOnWorldAxis(i,l){return Ds.setFromAxisAngle(i,l),this.quaternion.premultiply(Ds),this}rotateX(i){return this.rotateOnAxis(Lh,i)}rotateY(i){return this.rotateOnAxis(Qc,i)}rotateZ(i){return this.rotateOnAxis(nc,i)}translateOnAxis(i,l){return Gc.copy(i).applyQuaternion(this.quaternion),this.position.add(Gc.multiplyScalar(l)),this}translateX(i){return this.translateOnAxis(Lh,i)}translateY(i){return this.translateOnAxis(Qc,i)}translateZ(i){return this.translateOnAxis(nc,i)}localToWorld(i){return i.applyMatrix4(this.matrixWorld)}worldToLocal(i){return i.applyMatrix4(ko.copy(this.matrixWorld).invert())}lookAt(i,l,h){i.isVector3?Ys.copy(i):Ys.set(i,l,h);const d=this.parent;this.updateWorldMatrix(!0,!1),Qa.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ko.lookAt(Qa,Ys,this.up):ko.lookAt(Ys,Qa,this.up),this.quaternion.setFromRotationMatrix(ko),d&&(ko.extractRotation(d.matrixWorld),Ds.setFromRotationMatrix(ko),this.quaternion.premultiply(Ds.invert()))}add(i){if(arguments.length>1){for(let l=0;l<arguments.length;l++)this.add(arguments[l]);return this}return i===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",i),this):(i&&i.isObject3D?(i.parent!==null&&i.parent.remove(i),i.parent=this,this.children.push(i),i.dispatchEvent(Nd)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",i),this)}remove(i){if(arguments.length>1){for(let h=0;h<arguments.length;h++)this.remove(arguments[h]);return this}const l=this.children.indexOf(i);return l!==-1&&(i.parent=null,this.children.splice(l,1),i.dispatchEvent(zp)),this}removeFromParent(){const i=this.parent;return i!==null&&i.remove(this),this}clear(){for(let i=0;i<this.children.length;i++){const l=this.children[i];l.parent=null,l.dispatchEvent(zp)}return this.children.length=0,this}attach(i){return this.updateWorldMatrix(!0,!1),ko.copy(this.matrixWorld).invert(),i.parent!==null&&(i.parent.updateWorldMatrix(!0,!1),ko.multiply(i.parent.matrixWorld)),i.applyMatrix4(ko),this.add(i),i.updateWorldMatrix(!1,!0),this}getObjectById(i){return this.getObjectByProperty("id",i)}getObjectByName(i){return this.getObjectByProperty("name",i)}getObjectByProperty(i,l){if(this[i]===l)return this;for(let h=0,d=this.children.length;h<d;h++){const g=this.children[h].getObjectByProperty(i,l);if(g!==void 0)return g}}getWorldPosition(i){return this.updateWorldMatrix(!0,!1),i.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qa,i,Ld),i}getWorldScale(i){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qa,tc,i),i}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return i.set(l[8],l[9],l[10]).normalize()}raycast(){}traverse(i){i(this);const l=this.children;for(let h=0,d=l.length;h<d;h++)l[h].traverse(i)}traverseVisible(i){if(this.visible===!1)return;i(this);const l=this.children;for(let h=0,d=l.length;h<d;h++)l[h].traverseVisible(i)}traverseAncestors(i){const l=this.parent;l!==null&&(i(l),l.traverseAncestors(i))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(i){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||i)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,i=!0);const l=this.children;for(let h=0,d=l.length;h<d;h++){const g=l[h];g.matrixWorldAutoUpdate!==!0&&i!==!0||g.updateMatrixWorld(i)}}updateWorldMatrix(i,l){const h=this.parent;if(i===!0&&h!==null&&h.matrixWorldAutoUpdate===!0&&h.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),l===!0){const d=this.children;for(let g=0,v=d.length;g<v;g++){const b=d[g];b.matrixWorldAutoUpdate===!0&&b.updateWorldMatrix(!1,!0)}}}toJSON(i){const l=i===void 0||typeof i=="string",h={};l&&(i={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},h.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const d={};function g(b,T){return b[T.uuid]===void 0&&(b[T.uuid]=T.toJSON(i)),T.uuid}if(d.uuid=this.uuid,d.type=this.type,this.name!==""&&(d.name=this.name),this.castShadow===!0&&(d.castShadow=!0),this.receiveShadow===!0&&(d.receiveShadow=!0),this.visible===!1&&(d.visible=!1),this.frustumCulled===!1&&(d.frustumCulled=!1),this.renderOrder!==0&&(d.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(d.userData=this.userData),d.layers=this.layers.mask,d.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(d.matrixAutoUpdate=!1),this.isInstancedMesh&&(d.type="InstancedMesh",d.count=this.count,d.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(d.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?d.background=this.background.toJSON():this.background.isTexture&&(d.background=this.background.toJSON(i).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(d.environment=this.environment.toJSON(i).uuid);else if(this.isMesh||this.isLine||this.isPoints){d.geometry=g(i.geometries,this.geometry);const b=this.geometry.parameters;if(b!==void 0&&b.shapes!==void 0){const T=b.shapes;if(Array.isArray(T))for(let I=0,N=T.length;I<N;I++){const z=T[I];g(i.shapes,z)}else g(i.shapes,T)}}if(this.isSkinnedMesh&&(d.bindMode=this.bindMode,d.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(g(i.skeletons,this.skeleton),d.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const b=[];for(let T=0,I=this.material.length;T<I;T++)b.push(g(i.materials,this.material[T]));d.material=b}else d.material=g(i.materials,this.material);if(this.children.length>0){d.children=[];for(let b=0;b<this.children.length;b++)d.children.push(this.children[b].toJSON(i).object)}if(this.animations.length>0){d.animations=[];for(let b=0;b<this.animations.length;b++){const T=this.animations[b];d.animations.push(g(i.animations,T))}}if(l){const b=v(i.geometries),T=v(i.materials),I=v(i.textures),N=v(i.images),z=v(i.shapes),U=v(i.skeletons),Q=v(i.animations),Y=v(i.nodes);b.length>0&&(h.geometries=b),T.length>0&&(h.materials=T),I.length>0&&(h.textures=I),N.length>0&&(h.images=N),z.length>0&&(h.shapes=z),U.length>0&&(h.skeletons=U),Q.length>0&&(h.animations=Q),Y.length>0&&(h.nodes=Y)}return h.object=d,h;function v(b){const T=[];for(const I in b){const N=b[I];delete N.metadata,T.push(N)}return T}}clone(i){return new this.constructor().copy(this,i)}copy(i,l=!0){this.name=i.name,this.up.copy(i.up),this.position.copy(i.position),this.rotation.order=i.rotation.order,this.quaternion.copy(i.quaternion),this.scale.copy(i.scale),this.matrix.copy(i.matrix),this.matrixWorld.copy(i.matrixWorld),this.matrixAutoUpdate=i.matrixAutoUpdate,this.matrixWorldNeedsUpdate=i.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=i.matrixWorldAutoUpdate,this.layers.mask=i.layers.mask,this.visible=i.visible,this.castShadow=i.castShadow,this.receiveShadow=i.receiveShadow,this.frustumCulled=i.frustumCulled,this.renderOrder=i.renderOrder,this.userData={};for(const[h,d]of Object.entries(i.userData))this.userData[h]=!d||d&&(d.isTexture||d.isObject3D)?d:JSON.parse(JSON.stringify(d));if(l===!0)for(let h=0;h<i.children.length;h++){const d=i.children[h];this.add(d.clone())}return this}}pi.DefaultUp=new Re(0,1,0),pi.DefaultMatrixAutoUpdate=!0,pi.DefaultMatrixWorldAutoUpdate=!0;const na=new Re,Ha=new Re,oo=new Re,Ea=new Re,ia=new Re,ra=new Re,Fd=new Re,Nu=new Re,Ud=new Re,ic=new Re;class Rs{constructor(i=new Re,l=new Re,h=new Re){this.a=i,this.b=l,this.c=h}static getNormal(i,l,h,d){d.subVectors(h,l),na.subVectors(i,l),d.cross(na);const g=d.lengthSq();return g>0?d.multiplyScalar(1/Math.sqrt(g)):d.set(0,0,0)}static getBarycoord(i,l,h,d,g){na.subVectors(d,l),Ha.subVectors(h,l),oo.subVectors(i,l);const v=na.dot(na),b=na.dot(Ha),T=na.dot(oo),I=Ha.dot(Ha),N=Ha.dot(oo),z=v*I-b*b;if(z===0)return g.set(-2,-1,-1);const U=1/z,Q=(I*T-b*N)*U,Y=(v*N-b*T)*U;return g.set(1-Q-Y,Y,Q)}static containsPoint(i,l,h,d){return this.getBarycoord(i,l,h,d,Ea),Ea.x>=0&&Ea.y>=0&&Ea.x+Ea.y<=1}static getUV(i,l,h,d,g,v,b,T){return this.getBarycoord(i,l,h,d,Ea),T.set(0,0),T.addScaledVector(g,Ea.x),T.addScaledVector(v,Ea.y),T.addScaledVector(b,Ea.z),T}static isFrontFacing(i,l,h,d){return na.subVectors(h,l),Ha.subVectors(i,l),na.cross(Ha).dot(d)<0}set(i,l,h){return this.a.copy(i),this.b.copy(l),this.c.copy(h),this}setFromPointsAndIndices(i,l,h,d){return this.a.copy(i[l]),this.b.copy(i[h]),this.c.copy(i[d]),this}setFromAttributeAndIndices(i,l,h,d){return this.a.fromBufferAttribute(i,l),this.b.fromBufferAttribute(i,h),this.c.fromBufferAttribute(i,d),this}clone(){return new this.constructor().copy(this)}copy(i){return this.a.copy(i.a),this.b.copy(i.b),this.c.copy(i.c),this}getArea(){return na.subVectors(this.c,this.b),Ha.subVectors(this.a,this.b),.5*na.cross(Ha).length()}getMidpoint(i){return i.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(i){return Rs.getNormal(this.a,this.b,this.c,i)}getPlane(i){return i.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(i,l){return Rs.getBarycoord(i,this.a,this.b,this.c,l)}getUV(i,l,h,d,g){return Rs.getUV(i,this.a,this.b,this.c,l,h,d,g)}containsPoint(i){return Rs.containsPoint(i,this.a,this.b,this.c)}isFrontFacing(i){return Rs.isFrontFacing(this.a,this.b,this.c,i)}intersectsBox(i){return i.intersectsTriangle(this)}closestPointToPoint(i,l){const h=this.a,d=this.b,g=this.c;let v,b;ia.subVectors(d,h),ra.subVectors(g,h),Nu.subVectors(i,h);const T=ia.dot(Nu),I=ra.dot(Nu);if(T<=0&&I<=0)return l.copy(h);Ud.subVectors(i,d);const N=ia.dot(Ud),z=ra.dot(Ud);if(N>=0&&z<=N)return l.copy(d);const U=T*z-N*I;if(U<=0&&T>=0&&N<=0)return v=T/(T-N),l.copy(h).addScaledVector(ia,v);ic.subVectors(i,g);const Q=ia.dot(ic),Y=ra.dot(ic);if(Y>=0&&Q<=Y)return l.copy(g);const H=Q*I-T*Y;if(H<=0&&I>=0&&Y<=0)return b=I/(I-Y),l.copy(h).addScaledVector(ra,b);const ne=N*Y-Q*z;if(ne<=0&&z-N>=0&&Q-Y>=0)return Fd.subVectors(g,d),b=(z-N)/(z-N+(Q-Y)),l.copy(d).addScaledVector(Fd,b);const ie=1/(ne+H+U);return v=H*ie,b=U*ie,l.copy(h).addScaledVector(ia,v).addScaledVector(ra,b)}equals(i){return i.a.equals(this.a)&&i.b.equals(this.b)&&i.c.equals(this.c)}}let Im=0;class Bs extends ei{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Im++}),this.uuid=Ws(),this.name="",this.type="Material",this.blending=ge,this.side=me,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=ct,this.blendDst=Ot,this.blendEquation=Z,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=be,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=za,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=or,this.stencilZFail=or,this.stencilZPass=or,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(i){this._alphaTest>0!=i>0&&this.version++,this._alphaTest=i}onBuild(){}onBeforeRender(){}onAfterRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(i){if(i!==void 0)for(const l in i){const h=i[l];if(h===void 0){console.warn("THREE.Material: '"+l+"' parameter is undefined.");continue}const d=this[l];d!==void 0&&(d&&d.isColor?d.set(h):d&&d.isVector3&&h&&h.isVector3?d.copy(h):this[l]=h)}}toJSON(i){const l=i===void 0||typeof i=="string";l&&(i={textures:{},images:{}});const h={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function d(g){const v=[];for(const b in g){const T=g[b];delete T.metadata,v.push(T)}return v}if(h.uuid=this.uuid,h.type=this.type,this.name!==""&&(h.name=this.name),this.color&&this.color.isColor&&(h.color=this.color.getHex()),this.roughness!==void 0&&(h.roughness=this.roughness),this.metalness!==void 0&&(h.metalness=this.metalness),this.sheen!==void 0&&(h.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(h.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(h.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(h.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(h.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(h.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(h.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(h.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(h.shininess=this.shininess),this.clearcoat!==void 0&&(h.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(h.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(h.clearcoatMap=this.clearcoatMap.toJSON(i).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(h.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(i).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(h.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(i).uuid,h.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(h.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(h.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(h.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(h.iridescenceMap=this.iridescenceMap.toJSON(i).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(h.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(i).uuid),this.map&&this.map.isTexture&&(h.map=this.map.toJSON(i).uuid),this.matcap&&this.matcap.isTexture&&(h.matcap=this.matcap.toJSON(i).uuid),this.alphaMap&&this.alphaMap.isTexture&&(h.alphaMap=this.alphaMap.toJSON(i).uuid),this.lightMap&&this.lightMap.isTexture&&(h.lightMap=this.lightMap.toJSON(i).uuid,h.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(h.aoMap=this.aoMap.toJSON(i).uuid,h.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(h.bumpMap=this.bumpMap.toJSON(i).uuid,h.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(h.normalMap=this.normalMap.toJSON(i).uuid,h.normalMapType=this.normalMapType,h.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(h.displacementMap=this.displacementMap.toJSON(i).uuid,h.displacementScale=this.displacementScale,h.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(h.roughnessMap=this.roughnessMap.toJSON(i).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(h.metalnessMap=this.metalnessMap.toJSON(i).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(h.emissiveMap=this.emissiveMap.toJSON(i).uuid),this.specularMap&&this.specularMap.isTexture&&(h.specularMap=this.specularMap.toJSON(i).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(h.specularIntensityMap=this.specularIntensityMap.toJSON(i).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(h.specularColorMap=this.specularColorMap.toJSON(i).uuid),this.envMap&&this.envMap.isTexture&&(h.envMap=this.envMap.toJSON(i).uuid,this.combine!==void 0&&(h.combine=this.combine)),this.envMapIntensity!==void 0&&(h.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(h.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(h.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(h.gradientMap=this.gradientMap.toJSON(i).uuid),this.transmission!==void 0&&(h.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(h.transmissionMap=this.transmissionMap.toJSON(i).uuid),this.thickness!==void 0&&(h.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(h.thicknessMap=this.thicknessMap.toJSON(i).uuid),this.attenuationDistance!==void 0&&(h.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(h.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(h.size=this.size),this.shadowSide!==null&&(h.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(h.sizeAttenuation=this.sizeAttenuation),this.blending!==ge&&(h.blending=this.blending),this.side!==me&&(h.side=this.side),this.vertexColors&&(h.vertexColors=!0),this.opacity<1&&(h.opacity=this.opacity),this.transparent===!0&&(h.transparent=this.transparent),h.depthFunc=this.depthFunc,h.depthTest=this.depthTest,h.depthWrite=this.depthWrite,h.colorWrite=this.colorWrite,h.stencilWrite=this.stencilWrite,h.stencilWriteMask=this.stencilWriteMask,h.stencilFunc=this.stencilFunc,h.stencilRef=this.stencilRef,h.stencilFuncMask=this.stencilFuncMask,h.stencilFail=this.stencilFail,h.stencilZFail=this.stencilZFail,h.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(h.rotation=this.rotation),this.polygonOffset===!0&&(h.polygonOffset=!0),this.polygonOffsetFactor!==0&&(h.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(h.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(h.linewidth=this.linewidth),this.dashSize!==void 0&&(h.dashSize=this.dashSize),this.gapSize!==void 0&&(h.gapSize=this.gapSize),this.scale!==void 0&&(h.scale=this.scale),this.dithering===!0&&(h.dithering=!0),this.alphaTest>0&&(h.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(h.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(h.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(h.wireframe=this.wireframe),this.wireframeLinewidth>1&&(h.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(h.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(h.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(h.flatShading=this.flatShading),this.visible===!1&&(h.visible=!1),this.toneMapped===!1&&(h.toneMapped=!1),this.fog===!1&&(h.fog=!1),JSON.stringify(this.userData)!=="{}"&&(h.userData=this.userData),l){const g=d(i.textures),v=d(i.images);g.length>0&&(h.textures=g),v.length>0&&(h.images=v)}return h}clone(){return new this.constructor().copy(this)}copy(i){this.name=i.name,this.blending=i.blending,this.side=i.side,this.vertexColors=i.vertexColors,this.opacity=i.opacity,this.transparent=i.transparent,this.blendSrc=i.blendSrc,this.blendDst=i.blendDst,this.blendEquation=i.blendEquation,this.blendSrcAlpha=i.blendSrcAlpha,this.blendDstAlpha=i.blendDstAlpha,this.blendEquationAlpha=i.blendEquationAlpha,this.depthFunc=i.depthFunc,this.depthTest=i.depthTest,this.depthWrite=i.depthWrite,this.stencilWriteMask=i.stencilWriteMask,this.stencilFunc=i.stencilFunc,this.stencilRef=i.stencilRef,this.stencilFuncMask=i.stencilFuncMask,this.stencilFail=i.stencilFail,this.stencilZFail=i.stencilZFail,this.stencilZPass=i.stencilZPass,this.stencilWrite=i.stencilWrite;const l=i.clippingPlanes;let h=null;if(l!==null){const d=l.length;h=new Array(d);for(let g=0;g!==d;++g)h[g]=l[g].clone()}this.clippingPlanes=h,this.clipIntersection=i.clipIntersection,this.clipShadows=i.clipShadows,this.shadowSide=i.shadowSide,this.colorWrite=i.colorWrite,this.precision=i.precision,this.polygonOffset=i.polygonOffset,this.polygonOffsetFactor=i.polygonOffsetFactor,this.polygonOffsetUnits=i.polygonOffsetUnits,this.dithering=i.dithering,this.alphaTest=i.alphaTest,this.alphaToCoverage=i.alphaToCoverage,this.premultipliedAlpha=i.premultipliedAlpha,this.visible=i.visible,this.toneMapped=i.toneMapped,this.userData={};for(const[d,g]of Object.entries(i.userData))this.userData[d]=!g||g&&(g.isTexture||g.isObject3D)?g:JSON.parse(JSON.stringify(g));return this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(i){i===!0&&this.version++}}class Wa extends Bs{constructor(i){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new bn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}const Xr=new Re,sa=new Xt;class mr{constructor(i,l,h){if(Array.isArray(i))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=i,this.itemSize=l,this.count=i!==void 0?i.length/l:0,this.normalized=h===!0,this.usage=Bc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}copy(i){return this.name=i.name,this.array=new i.array.constructor(i.array),this.itemSize=i.itemSize,this.count=i.count,this.normalized=i.normalized,this.usage=i.usage,this}copyAt(i,l,h){i*=this.itemSize,h*=l.itemSize;for(let d=0,g=this.itemSize;d<g;d++)this.array[i+d]=l.array[h+d];return this}copyArray(i){return this.array.set(i),this}applyMatrix3(i){if(this.itemSize===2)for(let l=0,h=this.count;l<h;l++)sa.fromBufferAttribute(this,l),sa.applyMatrix3(i),this.setXY(l,sa.x,sa.y);else if(this.itemSize===3)for(let l=0,h=this.count;l<h;l++)Xr.fromBufferAttribute(this,l),Xr.applyMatrix3(i),this.setXYZ(l,Xr.x,Xr.y,Xr.z);return this}applyMatrix4(i){for(let l=0,h=this.count;l<h;l++)Xr.fromBufferAttribute(this,l),Xr.applyMatrix4(i),this.setXYZ(l,Xr.x,Xr.y,Xr.z);return this}applyNormalMatrix(i){for(let l=0,h=this.count;l<h;l++)Xr.fromBufferAttribute(this,l),Xr.applyNormalMatrix(i),this.setXYZ(l,Xr.x,Xr.y,Xr.z);return this}transformDirection(i){for(let l=0,h=this.count;l<h;l++)Xr.fromBufferAttribute(this,l),Xr.transformDirection(i),this.setXYZ(l,Xr.x,Xr.y,Xr.z);return this}set(i,l=0){return this.array.set(i,l),this}getX(i){let l=this.array[i*this.itemSize];return this.normalized&&(l=gl(l,this.array)),l}setX(i,l){return this.normalized&&(l=vr(l,this.array)),this.array[i*this.itemSize]=l,this}getY(i){let l=this.array[i*this.itemSize+1];return this.normalized&&(l=gl(l,this.array)),l}setY(i,l){return this.normalized&&(l=vr(l,this.array)),this.array[i*this.itemSize+1]=l,this}getZ(i){let l=this.array[i*this.itemSize+2];return this.normalized&&(l=gl(l,this.array)),l}setZ(i,l){return this.normalized&&(l=vr(l,this.array)),this.array[i*this.itemSize+2]=l,this}getW(i){let l=this.array[i*this.itemSize+3];return this.normalized&&(l=gl(l,this.array)),l}setW(i,l){return this.normalized&&(l=vr(l,this.array)),this.array[i*this.itemSize+3]=l,this}setXY(i,l,h){return i*=this.itemSize,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array)),this.array[i+0]=l,this.array[i+1]=h,this}setXYZ(i,l,h,d){return i*=this.itemSize,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array),d=vr(d,this.array)),this.array[i+0]=l,this.array[i+1]=h,this.array[i+2]=d,this}setXYZW(i,l,h,d,g){return i*=this.itemSize,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array),d=vr(d,this.array),g=vr(g,this.array)),this.array[i+0]=l,this.array[i+1]=h,this.array[i+2]=d,this.array[i+3]=g,this}onUpload(i){return this.onUploadCallback=i,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const i={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(i.name=this.name),this.usage!==Bc&&(i.usage=this.usage),this.updateRange.offset===0&&this.updateRange.count===-1||(i.updateRange=this.updateRange),i}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class Fu extends mr{constructor(i,l,h){super(new Int8Array(i),l,h)}}class oa extends mr{constructor(i,l,h){super(new Uint8Array(i),l,h)}}class Uu extends mr{constructor(i,l,h){super(new Uint8ClampedArray(i),l,h)}}class ao extends mr{constructor(i,l,h){super(new Int16Array(i),l,h)}}class Ur extends mr{constructor(i,l,h){super(new Uint16Array(i),l,h)}}class Vp extends mr{constructor(i,l,h){super(new Int32Array(i),l,h)}}class B extends mr{constructor(i,l,h){super(new Uint32Array(i),l,h)}}class _ extends mr{constructor(i,l,h){super(new Uint16Array(i),l,h),this.isFloat16BufferAttribute=!0}}class E extends mr{constructor(i,l,h){super(new Float32Array(i),l,h)}}class V extends mr{constructor(i,l,h){super(new Float64Array(i),l,h)}}let ce=0;const Le=new ti,qe=new pi,Et=new Re,Yt=new jc,kn=new jc,Hn=new Re;class In extends ei{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ce++}),this.uuid=Ws(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(i){return Array.isArray(i)?this.index=new(Mm(i)?B:Ur)(i,1):this.index=i,this}getAttribute(i){return this.attributes[i]}setAttribute(i,l){return this.attributes[i]=l,this}deleteAttribute(i){return delete this.attributes[i],this}hasAttribute(i){return this.attributes[i]!==void 0}addGroup(i,l,h=0){this.groups.push({start:i,count:l,materialIndex:h})}clearGroups(){this.groups=[]}setDrawRange(i,l){this.drawRange.start=i,this.drawRange.count=l}applyMatrix4(i){const l=this.attributes.position;l!==void 0&&(l.applyMatrix4(i),l.needsUpdate=!0);const h=this.attributes.normal;if(h!==void 0){const g=new Is().getNormalMatrix(i);h.applyNormalMatrix(g),h.needsUpdate=!0}const d=this.attributes.tangent;return d!==void 0&&(d.transformDirection(i),d.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(i){return Le.makeRotationFromQuaternion(i),this.applyMatrix4(Le),this}rotateX(i){return Le.makeRotationX(i),this.applyMatrix4(Le),this}rotateY(i){return Le.makeRotationY(i),this.applyMatrix4(Le),this}rotateZ(i){return Le.makeRotationZ(i),this.applyMatrix4(Le),this}translate(i,l,h){return Le.makeTranslation(i,l,h),this.applyMatrix4(Le),this}scale(i,l,h){return Le.makeScale(i,l,h),this.applyMatrix4(Le),this}lookAt(i){return qe.lookAt(i),qe.updateMatrix(),this.applyMatrix4(qe.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Et).negate(),this.translate(Et.x,Et.y,Et.z),this}setFromPoints(i){const l=[];for(let h=0,d=i.length;h<d;h++){const g=i[h];l.push(g.x,g.y,g.z||0)}return this.setAttribute("position",new E(l,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new jc);const i=this.attributes.position,l=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Re(-1/0,-1/0,-1/0),new Re(1/0,1/0,1/0));if(i!==void 0){if(this.boundingBox.setFromBufferAttribute(i),l)for(let h=0,d=l.length;h<d;h++){const g=l[h];Yt.setFromBufferAttribute(g),this.morphTargetsRelative?(Hn.addVectors(this.boundingBox.min,Yt.min),this.boundingBox.expandByPoint(Hn),Hn.addVectors(this.boundingBox.max,Yt.max),this.boundingBox.expandByPoint(Hn)):(this.boundingBox.expandByPoint(Yt.min),this.boundingBox.expandByPoint(Yt.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new ea);const i=this.attributes.position,l=this.morphAttributes.position;if(i&&i.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Re,1/0);if(i){const h=this.boundingSphere.center;if(Yt.setFromBufferAttribute(i),l)for(let g=0,v=l.length;g<v;g++){const b=l[g];kn.setFromBufferAttribute(b),this.morphTargetsRelative?(Hn.addVectors(Yt.min,kn.min),Yt.expandByPoint(Hn),Hn.addVectors(Yt.max,kn.max),Yt.expandByPoint(Hn)):(Yt.expandByPoint(kn.min),Yt.expandByPoint(kn.max))}Yt.getCenter(h);let d=0;for(let g=0,v=i.count;g<v;g++)Hn.fromBufferAttribute(i,g),d=Math.max(d,h.distanceToSquared(Hn));if(l)for(let g=0,v=l.length;g<v;g++){const b=l[g],T=this.morphTargetsRelative;for(let I=0,N=b.count;I<N;I++)Hn.fromBufferAttribute(b,I),T&&(Et.fromBufferAttribute(i,I),Hn.add(Et)),d=Math.max(d,h.distanceToSquared(Hn))}this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const i=this.index,l=this.attributes;if(i===null||l.position===void 0||l.normal===void 0||l.uv===void 0)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const h=i.array,d=l.position.array,g=l.normal.array,v=l.uv.array,b=d.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new mr(new Float32Array(4*b),4));const T=this.getAttribute("tangent").array,I=[],N=[];for(let ut=0;ut<b;ut++)I[ut]=new Re,N[ut]=new Re;const z=new Re,U=new Re,Q=new Re,Y=new Xt,H=new Xt,ne=new Xt,ie=new Re,re=new Re;function ve(ut,Ze,Ft){z.fromArray(d,3*ut),U.fromArray(d,3*Ze),Q.fromArray(d,3*Ft),Y.fromArray(v,2*ut),H.fromArray(v,2*Ze),ne.fromArray(v,2*Ft),U.sub(z),Q.sub(z),H.sub(Y),ne.sub(Y);const $t=1/(H.x*ne.y-ne.x*H.y);isFinite($t)&&(ie.copy(U).multiplyScalar(ne.y).addScaledVector(Q,-H.y).multiplyScalar($t),re.copy(Q).multiplyScalar(H.x).addScaledVector(U,-ne.x).multiplyScalar($t),I[ut].add(ie),I[Ze].add(ie),I[Ft].add(ie),N[ut].add(re),N[Ze].add(re),N[Ft].add(re))}let Ee=this.groups;Ee.length===0&&(Ee=[{start:0,count:h.length}]);for(let ut=0,Ze=Ee.length;ut<Ze;++ut){const Ft=Ee[ut],$t=Ft.start;for(let Lt=$t,an=$t+Ft.count;Lt<an;Lt+=3)ve(h[Lt+0],h[Lt+1],h[Lt+2])}const Me=new Re,Pe=new Re,Ye=new Re,Ke=new Re;function lt(ut){Ye.fromArray(g,3*ut),Ke.copy(Ye);const Ze=I[ut];Me.copy(Ze),Me.sub(Ye.multiplyScalar(Ye.dot(Ze))).normalize(),Pe.crossVectors(Ke,Ze);const Ft=Pe.dot(N[ut])<0?-1:1;T[4*ut]=Me.x,T[4*ut+1]=Me.y,T[4*ut+2]=Me.z,T[4*ut+3]=Ft}for(let ut=0,Ze=Ee.length;ut<Ze;++ut){const Ft=Ee[ut],$t=Ft.start;for(let Lt=$t,an=$t+Ft.count;Lt<an;Lt+=3)lt(h[Lt+0]),lt(h[Lt+1]),lt(h[Lt+2])}}computeVertexNormals(){const i=this.index,l=this.getAttribute("position");if(l!==void 0){let h=this.getAttribute("normal");if(h===void 0)h=new mr(new Float32Array(3*l.count),3),this.setAttribute("normal",h);else for(let U=0,Q=h.count;U<Q;U++)h.setXYZ(U,0,0,0);const d=new Re,g=new Re,v=new Re,b=new Re,T=new Re,I=new Re,N=new Re,z=new Re;if(i)for(let U=0,Q=i.count;U<Q;U+=3){const Y=i.getX(U+0),H=i.getX(U+1),ne=i.getX(U+2);d.fromBufferAttribute(l,Y),g.fromBufferAttribute(l,H),v.fromBufferAttribute(l,ne),N.subVectors(v,g),z.subVectors(d,g),N.cross(z),b.fromBufferAttribute(h,Y),T.fromBufferAttribute(h,H),I.fromBufferAttribute(h,ne),b.add(N),T.add(N),I.add(N),h.setXYZ(Y,b.x,b.y,b.z),h.setXYZ(H,T.x,T.y,T.z),h.setXYZ(ne,I.x,I.y,I.z)}else for(let U=0,Q=l.count;U<Q;U+=3)d.fromBufferAttribute(l,U+0),g.fromBufferAttribute(l,U+1),v.fromBufferAttribute(l,U+2),N.subVectors(v,g),z.subVectors(d,g),N.cross(z),h.setXYZ(U+0,N.x,N.y,N.z),h.setXYZ(U+1,N.x,N.y,N.z),h.setXYZ(U+2,N.x,N.y,N.z);this.normalizeNormals(),h.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const i=this.attributes.normal;for(let l=0,h=i.count;l<h;l++)Hn.fromBufferAttribute(i,l),Hn.normalize(),i.setXYZ(l,Hn.x,Hn.y,Hn.z)}toNonIndexed(){function i(b,T){const I=b.array,N=b.itemSize,z=b.normalized,U=new I.constructor(T.length*N);let Q=0,Y=0;for(let H=0,ne=T.length;H<ne;H++){Q=b.isInterleavedBufferAttribute?T[H]*b.data.stride+b.offset:T[H]*N;for(let ie=0;ie<N;ie++)U[Y++]=I[Q++]}return new mr(U,N,z)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const l=new In,h=this.index.array,d=this.attributes;for(const b in d){const T=i(d[b],h);l.setAttribute(b,T)}const g=this.morphAttributes;for(const b in g){const T=[],I=g[b];for(let N=0,z=I.length;N<z;N++){const U=i(I[N],h);T.push(U)}l.morphAttributes[b]=T}l.morphTargetsRelative=this.morphTargetsRelative;const v=this.groups;for(let b=0,T=v.length;b<T;b++){const I=v[b];l.addGroup(I.start,I.count,I.materialIndex)}return l}toJSON(){const i={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),Object.keys(this.userData).length>0&&(i.userData=this.userData),this.parameters!==void 0){const T=this.parameters;for(const I in T)T[I]!==void 0&&(i[I]=T[I]);return i}i.data={attributes:{}};const l=this.index;l!==null&&(i.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});const h=this.attributes;for(const T in h){const I=h[T];i.data.attributes[T]=I.toJSON(i.data)}const d={};let g=!1;for(const T in this.morphAttributes){const I=this.morphAttributes[T],N=[];for(let z=0,U=I.length;z<U;z++){const Q=I[z];N.push(Q.toJSON(i.data))}N.length>0&&(d[T]=N,g=!0)}g&&(i.data.morphAttributes=d,i.data.morphTargetsRelative=this.morphTargetsRelative);const v=this.groups;v.length>0&&(i.data.groups=JSON.parse(JSON.stringify(v)));const b=this.boundingSphere;return b!==null&&(i.data.boundingSphere={center:b.center.toArray(),radius:b.radius}),i}clone(){return new this.constructor().copy(this)}copy(i){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const l={};this.name=i.name;const h=i.index;h!==null&&this.setIndex(h.clone(l));const d=i.attributes;for(const I in d){const N=d[I];this.setAttribute(I,N.clone(l))}const g=i.morphAttributes;for(const I in g){const N=[],z=g[I];for(let U=0,Q=z.length;U<Q;U++)N.push(z[U].clone(l));this.morphAttributes[I]=N}this.morphTargetsRelative=i.morphTargetsRelative;const v=i.groups;for(let I=0,N=v.length;I<N;I++){const z=v[I];this.addGroup(z.start,z.count,z.materialIndex)}const b=i.boundingBox;b!==null&&(this.boundingBox=b.clone());const T=i.boundingSphere;return T!==null&&(this.boundingSphere=T.clone()),this.drawRange.start=i.drawRange.start,this.drawRange.count=i.drawRange.count,this.userData=i.userData,i.parameters!==void 0&&(this.parameters=Object.assign({},i.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const Tr=new ti,es=new ec,aa=new ea,Xs=new Re,Oo=new Re,Sa=new Re,Hc=new Re,rc=new Re,ju=new Re,Nh=new Re,Fh=new Re,Uh=new Re,jd=new Xt,Pm=new Xt,Dm=new Xt,Gp=new Re,jh=new Re;class ks extends pi{constructor(i=new In,l=new Wa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),i.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=i.morphTargetInfluences.slice()),i.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},i.morphTargetDictionary)),this.material=i.material,this.geometry=i.geometry,this}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,g=h.length;d<g;d++){const v=h[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=d}}}}raycast(i,l){const h=this.geometry,d=this.material,g=this.matrixWorld;if(d===void 0||(h.boundingSphere===null&&h.computeBoundingSphere(),aa.copy(h.boundingSphere),aa.applyMatrix4(g),i.ray.intersectsSphere(aa)===!1)||(Tr.copy(g).invert(),es.copy(i.ray).applyMatrix4(Tr),h.boundingBox!==null&&es.intersectsBox(h.boundingBox)===!1))return;let v;const b=h.index,T=h.attributes.position,I=h.morphAttributes.position,N=h.morphTargetsRelative,z=h.attributes.uv,U=h.attributes.uv2,Q=h.groups,Y=h.drawRange;if(b!==null)if(Array.isArray(d))for(let H=0,ne=Q.length;H<ne;H++){const ie=Q[H],re=d[ie.materialIndex];for(let ve=Math.max(ie.start,Y.start),Ee=Math.min(b.count,Math.min(ie.start+ie.count,Y.start+Y.count));ve<Ee;ve+=3){const Me=b.getX(ve),Pe=b.getX(ve+1),Ye=b.getX(ve+2);v=Qp(this,re,i,es,T,I,N,z,U,Me,Pe,Ye),v&&(v.faceIndex=Math.floor(ve/3),v.face.materialIndex=ie.materialIndex,l.push(v))}}else for(let H=Math.max(0,Y.start),ne=Math.min(b.count,Y.start+Y.count);H<ne;H+=3){const ie=b.getX(H),re=b.getX(H+1),ve=b.getX(H+2);v=Qp(this,d,i,es,T,I,N,z,U,ie,re,ve),v&&(v.faceIndex=Math.floor(H/3),l.push(v))}else if(T!==void 0)if(Array.isArray(d))for(let H=0,ne=Q.length;H<ne;H++){const ie=Q[H],re=d[ie.materialIndex];for(let ve=Math.max(ie.start,Y.start),Ee=Math.min(T.count,Math.min(ie.start+ie.count,Y.start+Y.count));ve<Ee;ve+=3)v=Qp(this,re,i,es,T,I,N,z,U,ve,ve+1,ve+2),v&&(v.faceIndex=Math.floor(ve/3),v.face.materialIndex=ie.materialIndex,l.push(v))}else for(let H=Math.max(0,Y.start),ne=Math.min(T.count,Y.start+Y.count);H<ne;H+=3)v=Qp(this,d,i,es,T,I,N,z,U,H,H+1,H+2),v&&(v.faceIndex=Math.floor(H/3),l.push(v))}}function Qp(x,i,l,h,d,g,v,b,T,I,N,z){Xs.fromBufferAttribute(d,I),Oo.fromBufferAttribute(d,N),Sa.fromBufferAttribute(d,z);const U=x.morphTargetInfluences;if(g&&U){Nh.set(0,0,0),Fh.set(0,0,0),Uh.set(0,0,0);for(let Y=0,H=g.length;Y<H;Y++){const ne=U[Y],ie=g[Y];ne!==0&&(Hc.fromBufferAttribute(ie,I),rc.fromBufferAttribute(ie,N),ju.fromBufferAttribute(ie,z),v?(Nh.addScaledVector(Hc,ne),Fh.addScaledVector(rc,ne),Uh.addScaledVector(ju,ne)):(Nh.addScaledVector(Hc.sub(Xs),ne),Fh.addScaledVector(rc.sub(Oo),ne),Uh.addScaledVector(ju.sub(Sa),ne)))}Xs.add(Nh),Oo.add(Fh),Sa.add(Uh)}x.isSkinnedMesh&&(x.boneTransform(I,Xs),x.boneTransform(N,Oo),x.boneTransform(z,Sa));const Q=function(Y,H,ne,ie,re,ve,Ee,Me){let Pe;if(Pe=H.side===$?ie.intersectTriangle(Ee,ve,re,!0,Me):ie.intersectTriangle(re,ve,Ee,H.side!==_e,Me),Pe===null)return null;jh.copy(Me),jh.applyMatrix4(Y.matrixWorld);const Ye=ne.ray.origin.distanceTo(jh);return Ye<ne.near||Ye>ne.far?null:{distance:Ye,point:jh.clone(),object:Y}}(x,i,l,h,Xs,Oo,Sa,Gp);if(Q){b&&(jd.fromBufferAttribute(b,I),Pm.fromBufferAttribute(b,N),Dm.fromBufferAttribute(b,z),Q.uv=Rs.getUV(Gp,Xs,Oo,Sa,jd,Pm,Dm,new Xt)),T&&(jd.fromBufferAttribute(T,I),Pm.fromBufferAttribute(T,N),Dm.fromBufferAttribute(T,z),Q.uv2=Rs.getUV(Gp,Xs,Oo,Sa,jd,Pm,Dm,new Xt));const Y={a:I,b:N,c:z,normal:new Re,materialIndex:0};Rs.getNormal(Xs,Oo,Sa,Y.normal),Q.face=Y}return Q}class qa extends In{constructor(i=1,l=1,h=1,d=1,g=1,v=1){super(),this.type="BoxGeometry",this.parameters={width:i,height:l,depth:h,widthSegments:d,heightSegments:g,depthSegments:v};const b=this;d=Math.floor(d),g=Math.floor(g),v=Math.floor(v);const T=[],I=[],N=[],z=[];let U=0,Q=0;function Y(H,ne,ie,re,ve,Ee,Me,Pe,Ye,Ke,lt){const ut=Ee/Ye,Ze=Me/Ke,Ft=Ee/2,$t=Me/2,Lt=Pe/2,an=Ye+1,ln=Ke+1;let Ct=0,Dt=0;const nn=new Re;for(let Ut=0;Ut<ln;Ut++){const on=Ut*Ze-$t;for(let On=0;On<an;On++){const Ti=On*ut-Ft;nn[H]=Ti*re,nn[ne]=on*ve,nn[ie]=Lt,I.push(nn.x,nn.y,nn.z),nn[H]=0,nn[ne]=0,nn[ie]=Pe>0?1:-1,N.push(nn.x,nn.y,nn.z),z.push(On/Ye),z.push(1-Ut/Ke),Ct+=1}}for(let Ut=0;Ut<Ke;Ut++)for(let on=0;on<Ye;on++){const On=U+on+an*Ut,Ti=U+on+an*(Ut+1),Fn=U+(on+1)+an*(Ut+1),yi=U+(on+1)+an*Ut;T.push(On,Ti,yi),T.push(Ti,Fn,yi),Dt+=6}b.addGroup(Q,Dt,lt),Q+=Dt,U+=Ct}Y("z","y","x",-1,-1,h,l,i,v,g,0),Y("z","y","x",1,-1,h,l,-i,v,g,1),Y("x","z","y",1,1,i,h,l,d,v,2),Y("x","z","y",1,-1,i,h,-l,d,v,3),Y("x","y","z",1,-1,i,l,h,d,g,4),Y("x","y","z",-1,-1,i,l,-h,d,g,5),this.setIndex(T),this.setAttribute("position",new E(I,3)),this.setAttribute("normal",new E(N,3)),this.setAttribute("uv",new E(z,2))}static fromJSON(i){return new qa(i.width,i.height,i.depth,i.widthSegments,i.heightSegments,i.depthSegments)}}function zu(x){const i={};for(const l in x){i[l]={};for(const h in x[l]){const d=x[l][h];d&&(d.isColor||d.isMatrix3||d.isMatrix4||d.isVector2||d.isVector3||d.isVector4||d.isTexture||d.isQuaternion)?i[l][h]=d.clone():Array.isArray(d)?i[l][h]=d.slice():i[l][h]=d}}return i}function Eo(x){const i={};for(let l=0;l<x.length;l++){const h=zu(x[l]);for(const d in h)i[d]=h[d]}return i}const j0={clone:zu,merge:Eo};class wl extends Bs{constructor(i){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,i!==void 0&&this.setValues(i)}copy(i){return super.copy(i),this.fragmentShader=i.fragmentShader,this.vertexShader=i.vertexShader,this.uniforms=zu(i.uniforms),this.uniformsGroups=function(l){const h=[];for(let d=0;d<l.length;d++)h.push(l[d].clone());return h}(i.uniformsGroups),this.defines=Object.assign({},i.defines),this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.fog=i.fog,this.lights=i.lights,this.clipping=i.clipping,this.extensions=Object.assign({},i.extensions),this.glslVersion=i.glslVersion,this}toJSON(i){const l=super.toJSON(i);l.glslVersion=this.glslVersion,l.uniforms={};for(const d in this.uniforms){const g=this.uniforms[d].value;g&&g.isTexture?l.uniforms[d]={type:"t",value:g.toJSON(i).uuid}:g&&g.isColor?l.uniforms[d]={type:"c",value:g.getHex()}:g&&g.isVector2?l.uniforms[d]={type:"v2",value:g.toArray()}:g&&g.isVector3?l.uniforms[d]={type:"v3",value:g.toArray()}:g&&g.isVector4?l.uniforms[d]={type:"v4",value:g.toArray()}:g&&g.isMatrix3?l.uniforms[d]={type:"m3",value:g.toArray()}:g&&g.isMatrix4?l.uniforms[d]={type:"m4",value:g.toArray()}:l.uniforms[d]={value:g}}Object.keys(this.defines).length>0&&(l.defines=this.defines),l.vertexShader=this.vertexShader,l.fragmentShader=this.fragmentShader;const h={};for(const d in this.extensions)this.extensions[d]===!0&&(h[d]=!0);return Object.keys(h).length>0&&(l.extensions=h),l}}class zd extends pi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new ti,this.projectionMatrix=new ti,this.projectionMatrixInverse=new ti}copy(i,l){return super.copy(i,l),this.matrixWorldInverse.copy(i.matrixWorldInverse),this.projectionMatrix.copy(i.projectionMatrix),this.projectionMatrixInverse.copy(i.projectionMatrixInverse),this}getWorldDirection(i){this.updateWorldMatrix(!0,!1);const l=this.matrixWorld.elements;return i.set(-l[8],-l[9],-l[10]).normalize()}updateMatrixWorld(i){super.updateMatrixWorld(i),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(i,l){super.updateWorldMatrix(i,l),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}class Ks extends zd{constructor(i=50,l=1,h=.1,d=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=i,this.zoom=1,this.near=h,this.far=d,this.focus=10,this.aspect=l,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(i,l){return super.copy(i,l),this.fov=i.fov,this.zoom=i.zoom,this.near=i.near,this.far=i.far,this.focus=i.focus,this.aspect=i.aspect,this.view=i.view===null?null:Object.assign({},i.view),this.filmGauge=i.filmGauge,this.filmOffset=i.filmOffset,this}setFocalLength(i){const l=.5*this.getFilmHeight()/i;this.fov=2*Ih*Math.atan(l),this.updateProjectionMatrix()}getFocalLength(){const i=Math.tan(.5*Oc*this.fov);return .5*this.getFilmHeight()/i}getEffectiveFOV(){return 2*Ih*Math.atan(Math.tan(.5*Oc*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(i,l,h,d,g,v){this.aspect=i/l,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=l,this.view.offsetX=h,this.view.offsetY=d,this.view.width=g,this.view.height=v,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=this.near;let l=i*Math.tan(.5*Oc*this.fov)/this.zoom,h=2*l,d=this.aspect*h,g=-.5*d;const v=this.view;if(this.view!==null&&this.view.enabled){const T=v.fullWidth,I=v.fullHeight;g+=v.offsetX*d/T,l-=v.offsetY*h/I,d*=v.width/T,h*=v.height/I}const b=this.filmOffset;b!==0&&(g+=i*b/this.getFilmWidth()),this.projectionMatrix.makePerspective(g,g+d,l,l-h,i,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const l=super.toJSON(i);return l.object.fov=this.fov,l.object.zoom=this.zoom,l.object.near=this.near,l.object.far=this.far,l.object.focus=this.focus,l.object.aspect=this.aspect,this.view!==null&&(l.object.view=Object.assign({},this.view)),l.object.filmGauge=this.filmGauge,l.object.filmOffset=this.filmOffset,l}}const Vu=90;class N_ extends pi{constructor(i,l,h){super(),this.type="CubeCamera",this.renderTarget=h;const d=new Ks(Vu,1,i,l);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new Re(1,0,0)),this.add(d);const g=new Ks(Vu,1,i,l);g.layers=this.layers,g.up.set(0,-1,0),g.lookAt(new Re(-1,0,0)),this.add(g);const v=new Ks(Vu,1,i,l);v.layers=this.layers,v.up.set(0,0,1),v.lookAt(new Re(0,1,0)),this.add(v);const b=new Ks(Vu,1,i,l);b.layers=this.layers,b.up.set(0,0,-1),b.lookAt(new Re(0,-1,0)),this.add(b);const T=new Ks(Vu,1,i,l);T.layers=this.layers,T.up.set(0,-1,0),T.lookAt(new Re(0,0,1)),this.add(T);const I=new Ks(Vu,1,i,l);I.layers=this.layers,I.up.set(0,-1,0),I.lookAt(new Re(0,0,-1)),this.add(I)}update(i,l){this.parent===null&&this.updateMatrixWorld();const h=this.renderTarget,[d,g,v,b,T,I]=this.children,N=i.getRenderTarget(),z=i.toneMapping,U=i.xr.enabled;i.toneMapping=Xn,i.xr.enabled=!1;const Q=h.texture.generateMipmaps;h.texture.generateMipmaps=!1,i.setRenderTarget(h,0),i.render(l,d),i.setRenderTarget(h,1),i.render(l,g),i.setRenderTarget(h,2),i.render(l,v),i.setRenderTarget(h,3),i.render(l,b),i.setRenderTarget(h,4),i.render(l,T),h.texture.generateMipmaps=Q,i.setRenderTarget(h,5),i.render(l,I),i.setRenderTarget(N),i.toneMapping=z,i.xr.enabled=U,h.texture.needsPMREMUpdate=!0}}class Vd extends fs{constructor(i,l,h,d,g,v,b,T,I,N){super(i=i!==void 0?i:[],l=l!==void 0?l:Xi,h,d,g,v,b,T,I,N),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(i){this.image=i}}class z0 extends bo{constructor(i,l={}){super(i,i,l),this.isWebGLCubeRenderTarget=!0;const h={width:i,height:i,depth:1},d=[h,h,h,h,h,h];this.texture=new Vd(d,l.mapping,l.wrapS,l.wrapT,l.magFilter,l.minFilter,l.format,l.type,l.anisotropy,l.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=l.generateMipmaps!==void 0&&l.generateMipmaps,this.texture.minFilter=l.minFilter!==void 0?l.minFilter:nr}fromEquirectangularTexture(i,l){this.texture.type=l.type,this.texture.encoding=l.encoding,this.texture.generateMipmaps=l.generateMipmaps,this.texture.minFilter=l.minFilter,this.texture.magFilter=l.magFilter;const h={tEquirect:{value:null}},d=`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,g=`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`,v=new qa(5,5,5),b=new wl({name:"CubemapFromEquirect",uniforms:zu(h),vertexShader:d,fragmentShader:g,side:$,blending:oe});b.uniforms.tEquirect.value=l;const T=new ks(v,b),I=l.minFilter;return l.minFilter===Sn&&(l.minFilter=nr),new N_(1,10,this).update(i,T),l.minFilter=I,T.geometry.dispose(),T.material.dispose(),this}clear(i,l,h,d){const g=i.getRenderTarget();for(let v=0;v<6;v++)i.setRenderTarget(this,v),i.clear(l,h,d);i.setRenderTarget(g)}}const F_=new Re,Gu=new Re,U_=new Is;class Wc{constructor(i=new Re(1,0,0),l=0){this.isPlane=!0,this.normal=i,this.constant=l}set(i,l){return this.normal.copy(i),this.constant=l,this}setComponents(i,l,h,d){return this.normal.set(i,l,h),this.constant=d,this}setFromNormalAndCoplanarPoint(i,l){return this.normal.copy(i),this.constant=-l.dot(this.normal),this}setFromCoplanarPoints(i,l,h){const d=F_.subVectors(h,l).cross(Gu.subVectors(i,l)).normalize();return this.setFromNormalAndCoplanarPoint(d,i),this}copy(i){return this.normal.copy(i.normal),this.constant=i.constant,this}normalize(){const i=1/this.normal.length();return this.normal.multiplyScalar(i),this.constant*=i,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(i){return this.normal.dot(i)+this.constant}distanceToSphere(i){return this.distanceToPoint(i.center)-i.radius}projectPoint(i,l){return l.copy(this.normal).multiplyScalar(-this.distanceToPoint(i)).add(i)}intersectLine(i,l){const h=i.delta(F_),d=this.normal.dot(h);if(d===0)return this.distanceToPoint(i.start)===0?l.copy(i.start):null;const g=-(i.start.dot(this.normal)+this.constant)/d;return g<0||g>1?null:l.copy(h).multiplyScalar(g).add(i.start)}intersectsLine(i){const l=this.distanceToPoint(i.start),h=this.distanceToPoint(i.end);return l<0&&h>0||h<0&&l>0}intersectsBox(i){return i.intersectsPlane(this)}intersectsSphere(i){return i.intersectsPlane(this)}coplanarPoint(i){return i.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(i,l){const h=l||U_.getNormalMatrix(i),d=this.coplanarPoint(F_).applyMatrix4(i),g=this.normal.applyMatrix3(h).normalize();return this.constant=-d.dot(g),this}translate(i){return this.constant-=i.dot(this.normal),this}equals(i){return i.normal.equals(this.normal)&&i.constant===this.constant}clone(){return new this.constructor().copy(this)}}const zh=new ea,Hp=new Re;class Wp{constructor(i=new Wc,l=new Wc,h=new Wc,d=new Wc,g=new Wc,v=new Wc){this.planes=[i,l,h,d,g,v]}set(i,l,h,d,g,v){const b=this.planes;return b[0].copy(i),b[1].copy(l),b[2].copy(h),b[3].copy(d),b[4].copy(g),b[5].copy(v),this}copy(i){const l=this.planes;for(let h=0;h<6;h++)l[h].copy(i.planes[h]);return this}setFromProjectionMatrix(i){const l=this.planes,h=i.elements,d=h[0],g=h[1],v=h[2],b=h[3],T=h[4],I=h[5],N=h[6],z=h[7],U=h[8],Q=h[9],Y=h[10],H=h[11],ne=h[12],ie=h[13],re=h[14],ve=h[15];return l[0].setComponents(b-d,z-T,H-U,ve-ne).normalize(),l[1].setComponents(b+d,z+T,H+U,ve+ne).normalize(),l[2].setComponents(b+g,z+I,H+Q,ve+ie).normalize(),l[3].setComponents(b-g,z-I,H-Q,ve-ie).normalize(),l[4].setComponents(b-v,z-N,H-Y,ve-re).normalize(),l[5].setComponents(b+v,z+N,H+Y,ve+re).normalize(),this}intersectsObject(i){const l=i.geometry;return l.boundingSphere===null&&l.computeBoundingSphere(),zh.copy(l.boundingSphere).applyMatrix4(i.matrixWorld),this.intersectsSphere(zh)}intersectsSprite(i){return zh.center.set(0,0,0),zh.radius=.7071067811865476,zh.applyMatrix4(i.matrixWorld),this.intersectsSphere(zh)}intersectsSphere(i){const l=this.planes,h=i.center,d=-i.radius;for(let g=0;g<6;g++)if(l[g].distanceToPoint(h)<d)return!1;return!0}intersectsBox(i){const l=this.planes;for(let h=0;h<6;h++){const d=l[h];if(Hp.x=d.normal.x>0?i.max.x:i.min.x,Hp.y=d.normal.y>0?i.max.y:i.min.y,Hp.z=d.normal.z>0?i.max.z:i.min.z,d.distanceToPoint(Hp)<0)return!1}return!0}containsPoint(i){const l=this.planes;for(let h=0;h<6;h++)if(l[h].distanceToPoint(i)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function qc(){let x=null,i=!1,l=null,h=null;function d(g,v){l(g,v),h=x.requestAnimationFrame(d)}return{start:function(){i!==!0&&l!==null&&(h=x.requestAnimationFrame(d),i=!0)},stop:function(){x.cancelAnimationFrame(h),i=!1},setAnimationLoop:function(g){l=g},setContext:function(g){x=g}}}function Gd(x,i){const l=i.isWebGL2,h=new WeakMap;return{get:function(d){return d.isInterleavedBufferAttribute&&(d=d.data),h.get(d)},remove:function(d){d.isInterleavedBufferAttribute&&(d=d.data);const g=h.get(d);g&&(x.deleteBuffer(g.buffer),h.delete(d))},update:function(d,g){if(d.isGLBufferAttribute){const b=h.get(d);return void((!b||b.version<d.version)&&h.set(d,{buffer:d.buffer,type:d.type,bytesPerElement:d.elementSize,version:d.version}))}d.isInterleavedBufferAttribute&&(d=d.data);const v=h.get(d);v===void 0?h.set(d,function(b,T){const I=b.array,N=b.usage,z=x.createBuffer();let U;if(x.bindBuffer(T,z),x.bufferData(T,I,N),b.onUploadCallback(),I instanceof Float32Array)U=5126;else if(I instanceof Uint16Array)if(b.isFloat16BufferAttribute){if(!l)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");U=5131}else U=5123;else if(I instanceof Int16Array)U=5122;else if(I instanceof Uint32Array)U=5125;else if(I instanceof Int32Array)U=5124;else if(I instanceof Int8Array)U=5120;else if(I instanceof Uint8Array)U=5121;else{if(!(I instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+I);U=5121}return{buffer:z,type:U,bytesPerElement:I.BYTES_PER_ELEMENT,version:b.version}}(d,g)):v.version<d.version&&(function(b,T,I){const N=T.array,z=T.updateRange;x.bindBuffer(I,b),z.count===-1?x.bufferSubData(I,0,N):(l?x.bufferSubData(I,z.offset*N.BYTES_PER_ELEMENT,N,z.offset,z.count):x.bufferSubData(I,z.offset*N.BYTES_PER_ELEMENT,N.subarray(z.offset,z.offset+z.count)),z.count=-1)}(v.buffer,d,g),v.version=d.version)}}}class Qu extends In{constructor(i=1,l=1,h=1,d=1){super(),this.type="PlaneGeometry",this.parameters={width:i,height:l,widthSegments:h,heightSegments:d};const g=i/2,v=l/2,b=Math.floor(h),T=Math.floor(d),I=b+1,N=T+1,z=i/b,U=l/T,Q=[],Y=[],H=[],ne=[];for(let ie=0;ie<N;ie++){const re=ie*U-v;for(let ve=0;ve<I;ve++){const Ee=ve*z-g;Y.push(Ee,-re,0),H.push(0,0,1),ne.push(ve/b),ne.push(1-ie/T)}}for(let ie=0;ie<T;ie++)for(let re=0;re<b;re++){const ve=re+I*ie,Ee=re+I*(ie+1),Me=re+1+I*(ie+1),Pe=re+1+I*ie;Q.push(ve,Ee,Pe),Q.push(Ee,Me,Pe)}this.setIndex(Q),this.setAttribute("position",new E(Y,3)),this.setAttribute("normal",new E(H,3)),this.setAttribute("uv",new E(ne,2))}static fromJSON(i){return new Qu(i.width,i.height,i.widthSegments,i.heightSegments)}}const Ai={alphamap_fragment:`#ifdef USE_ALPHAMAP
	#if defined(INVERSE_ALPHAMAP) && INVERSE_ALPHAMAP >= 1
	diffuseColor.a *= 1.0-texture2D( alphaMap, vUv ).g;
	#else
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
	#endif
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,alphatest_pars_fragment:`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
#ifdef USE_IRIDESCENCE
	vec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,iridescence_fragment:`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			 return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float R21 = R12;
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = dFdx( surf_pos.xyz );
		vec3 vSigmaY = dFdy( surf_pos.xyz );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,color_fragment:`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,color_pars_vertex:`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,color_vertex:`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,common:`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_v0 0.339
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_v1 0.276
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_v4 0.046
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_v5 0.016
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_v6 0.0038
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	vec3 transformDirection1( in vec3 dir, in mat4 matrix ) {
		return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
	}
	mat4 rotationMatrix(vec3 axis, float angle) {
		axis = normalize(axis);
		float s = sin(angle);
		float c = cos(angle);
		float oc = 1.0 - c;
		return mat4(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,  0.0,
					oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,  0.0,
					oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c,           0.0,
					0.0,                                0.0,                                0.0,                                1.0);
	}
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform float envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			worldNormal = transformDirection1(worldNormal, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			reflectVec = transformDirection1(reflectVec, rotationMatrix(vec3(0,1,0), envMapRotation));
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_fragment:`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,lights_lambert_pars_fragment:`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert
#define Material_LightProbeLOD( material )	(0)`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	#ifdef USE_IRIDESCENCE
		reflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );
	#else
		reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometry.viewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphcolor_vertex:`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,normal_fragment_begin:`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,normal_pars_fragment:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_pars_vertex:`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,normal_vertex:`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,clearcoat_pars_fragment:`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,iridescence_pars_fragment:`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,output_fragment:`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha + 0.1;
diffuseColor.a = min(max(diffuseColor.a, 0.), 1.);
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#if NUM_SPOT_LIGHT_COORDS > 0
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#if NUM_SPOT_LIGHT_COORDS > 0
  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	uniform int boneTextureSize;
	mat4 getBoneMatrix( const in float i ) {
		float j = i * 4.0;
		float x = mod( j, float( boneTextureSize ) );
		float y = floor( j / float( boneTextureSize ) );
		float dx = 1.0 / float( boneTextureSize );
		float dy = 1.0 / float( boneTextureSize );
		y = dy * ( y + 0.5 );
		vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
		vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
		vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
		vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
		mat4 bone = mat4( v1, v2, v3, v4 );
		return bone;
	}
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,transmission_fragment:`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
#endif`,transmission_pars_fragment:`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return transmissionSamplerMapTexelToLinear ( texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#else
			return transmissionSamplerMapTexelToLinear ( texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod ) );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
uniform bool flipX;
uniform bool flipY;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    vUv = flipX ? vec2( 1.0 - vUv.x, vUv.y ) : vUv;
    vUv = flipY ? vec2( vUv.x, 1.0 - vUv.y ) : vUv;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshnormal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,meshnormal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,shadow_vert:`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`},fn={common:{diffuse:{value:new bn(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Is},uv2Transform:{value:new Is},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},envMapRotation:{value:0},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Xt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new bn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new bn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Is}},sprite:{diffuse:{value:new bn(16777215)},opacity:{value:1},center:{value:new Xt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Is}}},la={basic:{uniforms:Eo([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.fog]),vertexShader:Ai.meshbasic_vert,fragmentShader:Ai.meshbasic_frag},lambert:{uniforms:Eo([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,fn.lights,{emissive:{value:new bn(0)}}]),vertexShader:Ai.meshlambert_vert,fragmentShader:Ai.meshlambert_frag},phong:{uniforms:Eo([fn.common,fn.specularmap,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,fn.lights,{emissive:{value:new bn(0)},specular:{value:new bn(1118481)},shininess:{value:30}}]),vertexShader:Ai.meshphong_vert,fragmentShader:Ai.meshphong_frag},standard:{uniforms:Eo([fn.common,fn.envmap,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.roughnessmap,fn.metalnessmap,fn.fog,fn.lights,{emissive:{value:new bn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ai.meshphysical_vert,fragmentShader:Ai.meshphysical_frag},toon:{uniforms:Eo([fn.common,fn.aomap,fn.lightmap,fn.emissivemap,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.gradientmap,fn.fog,fn.lights,{emissive:{value:new bn(0)}}]),vertexShader:Ai.meshtoon_vert,fragmentShader:Ai.meshtoon_frag},matcap:{uniforms:Eo([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,fn.fog,{matcap:{value:null}}]),vertexShader:Ai.meshmatcap_vert,fragmentShader:Ai.meshmatcap_frag},points:{uniforms:Eo([fn.points,fn.fog]),vertexShader:Ai.points_vert,fragmentShader:Ai.points_frag},dashed:{uniforms:Eo([fn.common,fn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ai.linedashed_vert,fragmentShader:Ai.linedashed_frag},depth:{uniforms:Eo([fn.common,fn.displacementmap]),vertexShader:Ai.depth_vert,fragmentShader:Ai.depth_frag},normal:{uniforms:Eo([fn.common,fn.bumpmap,fn.normalmap,fn.displacementmap,{opacity:{value:1}}]),vertexShader:Ai.meshnormal_vert,fragmentShader:Ai.meshnormal_frag},sprite:{uniforms:Eo([fn.sprite,fn.fog]),vertexShader:Ai.sprite_vert,fragmentShader:Ai.sprite_frag},background:{uniforms:{uvTransform:{value:new Is},t2D:{value:null},flipX:{value:!1},flipY:{value:!1}},vertexShader:Ai.background_vert,fragmentShader:Ai.background_frag},cube:{uniforms:Eo([fn.envmap,{opacity:{value:1}}]),vertexShader:Ai.cube_vert,fragmentShader:Ai.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ai.equirect_vert,fragmentShader:Ai.equirect_frag},distanceRGBA:{uniforms:Eo([fn.common,fn.displacementmap,{referencePosition:{value:new Re},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ai.distanceRGBA_vert,fragmentShader:Ai.distanceRGBA_frag},shadow:{uniforms:Eo([fn.lights,fn.fog,{color:{value:new bn(0)},opacity:{value:1}}]),vertexShader:Ai.shadow_vert,fragmentShader:Ai.shadow_frag}};function dw(x,i,l,h,d,g){const v=new bn(0);let b,T,I=d===!0?0:1,N=null,z=0,U=null;function Q(Y,H){l.buffers.color.setClear(Y.r,Y.g,Y.b,H,g)}return{getClearColor:function(){return v},setClearColor:function(Y,H=1){v.set(Y),I=H,Q(v,I)},getClearAlpha:function(){return I},setClearAlpha:function(Y){I=Y,Q(v,I)},getPlaneMesh:function(){return b},getBoxMesh:function(){return T},getBoxMesh2:function(){return T===void 0&&(T=new ks(new qa(1,1,1),new wl({name:"BackgroundCubeMaterial",uniforms:zu(la.cube.uniforms),vertexShader:la.cube.vertexShader,fragmentShader:la.cube.fragmentShader,side:$,depthTest:!1,depthWrite:!1,fog:!1})),T.geometry.deleteAttribute("normal"),T.geometry.deleteAttribute("uv"),T.onBeforeRender=function(Y,H,ne){this.matrixWorld.copyPosition(ne.matrixWorld)},Object.defineProperty(T.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),h.update(T)),T},render:function(Y,H){let ne=!1,ie=H.isScene===!0?H.background:null;ie&&ie.isTexture&&(ie=i.get(ie));const re=x.xr,ve=re.getSession&&re.getSession();ve&&ve.environmentBlendMode==="additive"&&(ie=null),ie===null?Q(v,I):ie&&ie.isColor&&(Q(ie,1),ne=!0),(x.autoClear||ne)&&x.clear(x.autoClearColor,x.autoClearDepth,x.autoClearStencil),ie&&(ie.isCubeTexture||ie.mapping===Vr)?(T===void 0&&(T=new ks(new qa(1,1,1),new wl({name:"BackgroundCubeMaterial",uniforms:zu(la.cube.uniforms),vertexShader:la.cube.vertexShader,fragmentShader:la.cube.fragmentShader,side:$,depthTest:!1,depthWrite:!1,fog:!1})),T.geometry.deleteAttribute("normal"),T.geometry.deleteAttribute("uv"),T.onBeforeRender=function(Ee,Me,Pe){this.matrixWorld.copyPosition(Pe.matrixWorld)},Object.defineProperty(T.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),h.update(T)),T.material.uniforms.envMap.value=ie,T.material.uniforms.envMapRotation.value=ie.rotation||0,T.material.uniforms.flipEnvMap.value=ie.isCubeTexture&&ie.isRenderTargetTexture===!1?-1:1,N===ie&&z===ie.version&&U===x.toneMapping||(T.material.needsUpdate=!0,N=ie,z=ie.version,U=x.toneMapping),T.layers.enableAll(),Y.unshift(T,T.geometry,T.material,0,0,null)):ie&&ie.isTexture&&(b===void 0&&(b=new ks(new Qu(2,2),new wl({name:"BackgroundMaterial",uniforms:zu(la.background.uniforms),vertexShader:la.background.vertexShader,fragmentShader:la.background.fragmentShader,side:me,depthTest:!1,depthWrite:!1,fog:!1})),b.geometry.deleteAttribute("normal"),Object.defineProperty(b.material,"map",{get:function(){return this.uniforms.t2D.value}}),h.update(b)),b.material.uniforms.t2D.value=ie,b.material.uniforms.flipX.value=ie.userData.flipX||!1,b.material.uniforms.flipY.value=ie.userData.flipY||!1,ie.matrixAutoUpdate===!0&&ie.updateMatrix(),b.material.uniforms.uvTransform.value.copy(ie.matrix),N===ie&&z===ie.version&&U===x.toneMapping||(b.material.needsUpdate=!0,N=ie,z=ie.version,U=x.toneMapping),b.layers.enableAll(),Y.unshift(b,b.geometry,b.material,0,0,null))}}}function pw(x,i,l,h){const d=x.getParameter(34921),g=h.isWebGL2?null:i.get("OES_vertex_array_object"),v=h.isWebGL2||g!==null,b={},T=Q(null);let I=T,N=!1;function z(Me){return h.isWebGL2?x.bindVertexArray(Me):g.bindVertexArrayOES(Me)}function U(Me){return h.isWebGL2?x.deleteVertexArray(Me):g.deleteVertexArrayOES(Me)}function Q(Me){const Pe=[],Ye=[],Ke=[];for(let lt=0;lt<d;lt++)Pe[lt]=0,Ye[lt]=0,Ke[lt]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Pe,enabledAttributes:Ye,attributeDivisors:Ke,object:Me,attributes:{},index:null}}function Y(){const Me=I.newAttributes;for(let Pe=0,Ye=Me.length;Pe<Ye;Pe++)Me[Pe]=0}function H(Me){ne(Me,0)}function ne(Me,Pe){const Ye=I.newAttributes,Ke=I.enabledAttributes,lt=I.attributeDivisors;Ye[Me]=1,Ke[Me]===0&&(x.enableVertexAttribArray(Me),Ke[Me]=1),lt[Me]!==Pe&&((h.isWebGL2?x:i.get("ANGLE_instanced_arrays"))[h.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Me,Pe),lt[Me]=Pe)}function ie(){const Me=I.newAttributes,Pe=I.enabledAttributes;for(let Ye=0,Ke=Pe.length;Ye<Ke;Ye++)Pe[Ye]!==Me[Ye]&&(x.disableVertexAttribArray(Ye),Pe[Ye]=0)}function re(Me,Pe,Ye,Ke,lt,ut){h.isWebGL2!==!0||Ye!==5124&&Ye!==5125?x.vertexAttribPointer(Me,Pe,Ye,Ke,lt,ut):x.vertexAttribIPointer(Me,Pe,Ye,lt,ut)}function ve(){Ee(),N=!0,I!==T&&(I=T,z(I.object))}function Ee(){T.geometry=null,T.program=null,T.wireframe=!1}return{setup:function(Me,Pe,Ye,Ke,lt){let ut=!1;if(v){const Ze=function(Ft,$t,Lt){const an=Lt.wireframe===!0;let ln=b[Ft.id];ln===void 0&&(ln={},b[Ft.id]=ln);let Ct=ln[$t.id];Ct===void 0&&(Ct={},ln[$t.id]=Ct);let Dt=Ct[an];return Dt===void 0&&(Dt=Q(h.isWebGL2?x.createVertexArray():g.createVertexArrayOES()),Ct[an]=Dt),Dt}(Ke,Ye,Pe);I!==Ze&&(I=Ze,z(I.object)),ut=function(Ft,$t,Lt,an){const ln=I.attributes,Ct=$t.attributes;let Dt=0;const nn=Lt.getAttributes();for(const Ut in nn)if(nn[Ut].location>=0){const on=ln[Ut];let On=Ct[Ut];if(On===void 0&&(Ut==="instanceMatrix"&&Ft.instanceMatrix&&(On=Ft.instanceMatrix),Ut==="instanceColor"&&Ft.instanceColor&&(On=Ft.instanceColor)),on===void 0||on.attribute!==On||On&&on.data!==On.data)return!0;Dt++}return I.attributesNum!==Dt||I.index!==an}(Me,Ke,Ye,lt),ut&&function(Ft,$t,Lt,an){const ln={},Ct=$t.attributes;let Dt=0;const nn=Lt.getAttributes();for(const Ut in nn)if(nn[Ut].location>=0){let on=Ct[Ut];on===void 0&&(Ut==="instanceMatrix"&&Ft.instanceMatrix&&(on=Ft.instanceMatrix),Ut==="instanceColor"&&Ft.instanceColor&&(on=Ft.instanceColor));const On={};On.attribute=on,on&&on.data&&(On.data=on.data),ln[Ut]=On,Dt++}I.attributes=ln,I.attributesNum=Dt,I.index=an}(Me,Ke,Ye,lt)}else{const Ze=Pe.wireframe===!0;I.geometry===Ke.id&&I.program===Ye.id&&I.wireframe===Ze||(I.geometry=Ke.id,I.program=Ye.id,I.wireframe=Ze,ut=!0)}lt!==null&&l.update(lt,34963),(ut||N)&&(N=!1,function(Ze,Ft,$t,Lt){if(h.isWebGL2===!1&&(Ze.isInstancedMesh||Lt.isInstancedBufferGeometry)&&i.get("ANGLE_instanced_arrays")===null)return;Y();const an=Lt.attributes,ln=$t.getAttributes(),Ct=Ft.defaultAttributeValues;for(const Dt in ln){const nn=ln[Dt];if(nn.location>=0){let Ut=an[Dt];if(Ut===void 0&&(Dt==="instanceMatrix"&&Ze.instanceMatrix&&(Ut=Ze.instanceMatrix),Dt==="instanceColor"&&Ze.instanceColor&&(Ut=Ze.instanceColor)),Ut!==void 0){const on=Ut.normalized,On=Ut.itemSize,Ti=l.get(Ut);if(Ti===void 0)continue;const Fn=Ti.buffer,yi=Ti.type,He=Ti.bytesPerElement;if(Ut.isInterleavedBufferAttribute){const Ue=Ut.data,mt=Ue.stride,at=Ut.offset;if(Ue.isInstancedInterleavedBuffer){for(let We=0;We<nn.locationSize;We++)ne(nn.location+We,Ue.meshPerAttribute);Ze.isInstancedMesh!==!0&&Lt._maxInstanceCount===void 0&&(Lt._maxInstanceCount=Ue.meshPerAttribute*Ue.count)}else for(let We=0;We<nn.locationSize;We++)H(nn.location+We);x.bindBuffer(34962,Fn);for(let We=0;We<nn.locationSize;We++)re(nn.location+We,On/nn.locationSize,yi,on,mt*He,(at+On/nn.locationSize*We)*He)}else{if(Ut.isInstancedBufferAttribute){for(let Ue=0;Ue<nn.locationSize;Ue++)ne(nn.location+Ue,Ut.meshPerAttribute);Ze.isInstancedMesh!==!0&&Lt._maxInstanceCount===void 0&&(Lt._maxInstanceCount=Ut.meshPerAttribute*Ut.count)}else for(let Ue=0;Ue<nn.locationSize;Ue++)H(nn.location+Ue);x.bindBuffer(34962,Fn);for(let Ue=0;Ue<nn.locationSize;Ue++)re(nn.location+Ue,On/nn.locationSize,yi,on,On*He,On/nn.locationSize*Ue*He)}}else if(Ct!==void 0){const on=Ct[Dt];if(on!==void 0)switch(on.length){case 2:x.vertexAttrib2fv(nn.location,on);break;case 3:x.vertexAttrib3fv(nn.location,on);break;case 4:x.vertexAttrib4fv(nn.location,on);break;default:x.vertexAttrib1fv(nn.location,on)}}}}ie()}(Me,Pe,Ye,Ke),lt!==null&&x.bindBuffer(34963,l.get(lt).buffer))},reset:ve,resetDefaultState:Ee,dispose:function(){ve();for(const Me in b){const Pe=b[Me];for(const Ye in Pe){const Ke=Pe[Ye];for(const lt in Ke)U(Ke[lt].object),delete Ke[lt];delete Pe[Ye]}delete b[Me]}},releaseStatesOfGeometry:function(Me){if(b[Me.id]===void 0)return;const Pe=b[Me.id];for(const Ye in Pe){const Ke=Pe[Ye];for(const lt in Ke)U(Ke[lt].object),delete Ke[lt];delete Pe[Ye]}delete b[Me.id]},releaseStatesOfProgram:function(Me){for(const Pe in b){const Ye=b[Pe];if(Ye[Me.id]===void 0)continue;const Ke=Ye[Me.id];for(const lt in Ke)U(Ke[lt].object),delete Ke[lt];delete Ye[Me.id]}},initAttributes:Y,enableAttribute:H,disableUnusedAttributes:ie}}function V0(x,i,l,h){const d=h.isWebGL2;let g;this.setMode=function(v){g=v},this.render=function(v,b){x.drawArrays(g,v,b),l.update(b,g,1)},this.renderInstances=function(v,b,T){if(T===0)return;let I,N;if(d)I=x,N="drawArraysInstanced";else if(I=i.get("ANGLE_instanced_arrays"),N="drawArraysInstancedANGLE",I===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");I[N](g,v,b,T),l.update(b,g,T)}}function G0(x,i,l){let h;function d(Ee){if(Ee==="highp"){if(x.getShaderPrecisionFormat(35633,36338).precision>0&&x.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";Ee="mediump"}return Ee==="mediump"&&x.getShaderPrecisionFormat(35633,36337).precision>0&&x.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const g=typeof WebGL2RenderingContext<"u"&&x instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&x instanceof WebGL2ComputeRenderingContext;let v=l.precision!==void 0?l.precision:"highp";const b=d(v);b!==v&&(console.warn("THREE.WebGLRenderer:",v,"not supported, using",b,"instead."),v=b);const T=g||i.has("WEBGL_draw_buffers"),I=l.logarithmicDepthBuffer===!0,N=x.getParameter(34930),z=x.getParameter(35660),U=x.getParameter(3379),Q=x.getParameter(34076),Y=x.getParameter(34921),H=x.getParameter(36347),ne=x.getParameter(36348),ie=x.getParameter(36349),re=z>0,ve=g||i.has("OES_texture_float");return{isWebGL2:g,drawBuffers:T,getMaxAnisotropy:function(){if(h!==void 0)return h;if(i.has("EXT_texture_filter_anisotropic")===!0){const Ee=i.get("EXT_texture_filter_anisotropic");h=x.getParameter(Ee.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else h=0;return h},getMaxPrecision:d,precision:v,logarithmicDepthBuffer:I,maxTextures:N,maxVertexTextures:z,maxTextureSize:U,maxCubemapSize:Q,maxAttributes:Y,maxVertexUniforms:H,maxVaryings:ne,maxFragmentUniforms:ie,vertexTextures:re,floatFragmentTextures:ve,floatVertexTextures:re&&ve,maxSamples:g?x.getParameter(36183):0}}function fw(x){const i=this;let l=null,h=0,d=!1,g=!1;const v=new Wc,b=new Is,T={value:null,needsUpdate:!1};function I(){T.value!==l&&(T.value=l,T.needsUpdate=h>0),i.numPlanes=h,i.numIntersection=0}function N(z,U,Q,Y){const H=z!==null?z.length:0;let ne=null;if(H!==0){if(ne=T.value,Y!==!0||ne===null){const ie=Q+4*H,re=U.matrixWorldInverse;b.getNormalMatrix(re),(ne===null||ne.length<ie)&&(ne=new Float32Array(ie));for(let ve=0,Ee=Q;ve!==H;++ve,Ee+=4)v.copy(z[ve]).applyMatrix4(re,b),v.normal.toArray(ne,Ee),ne[Ee+3]=v.constant}T.value=ne,T.needsUpdate=!0}return i.numPlanes=H,i.numIntersection=0,ne}this.uniform=T,this.numPlanes=0,this.numIntersection=0,this.init=function(z,U,Q){const Y=z.length!==0||U||h!==0||d;return d=U,l=N(z,Q,0),h=z.length,Y},this.beginShadows=function(){g=!0,N(null)},this.endShadows=function(){g=!1,I()},this.setState=function(z,U,Q){const Y=z.clippingPlanes,H=z.clipIntersection,ne=z.clipShadows,ie=x.get(z);if(!d||Y===null||Y.length===0||g&&!ne)g?N(null):I();else{const re=g?0:h,ve=4*re;let Ee=ie.clippingState||null;T.value=Ee,Ee=N(Y,U,ve,Q);for(let Me=0;Me!==ve;++Me)Ee[Me]=l[Me];ie.clippingState=Ee,this.numIntersection=H?this.numPlanes:0,this.numPlanes+=re}}}function mw(x){let i=new WeakMap;function l(d,g){return g===Vi?d.mapping=Xi:g===Gi&&(d.mapping=zi),d}function h(d){const g=d.target;g.removeEventListener("dispose",h);const v=i.get(g);v!==void 0&&(i.delete(g),v.dispose())}return{get:function(d){if(d&&d.isTexture&&d.isRenderTargetTexture===!1){const g=d.mapping;if(g===Vi||g===Gi){if(i.has(d)){const v=i.get(d).texture;return v.rotation=d.rotation,l(v,d.mapping)}{const v=d.image;if(v&&v.height>0){const b=new z0(v.height/2);return b.fromEquirectangularTexture(x,d),b.texture.rotation=d.rotation,i.set(d,b),d.addEventListener("dispose",h),l(b.texture,d.mapping)}return null}}}return d},dispose:function(){i=new WeakMap}}}la.physical={uniforms:Eo([la.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Xt(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new bn(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Xt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new bn(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new bn(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Ai.meshphysical_vert,fragmentShader:Ai.meshphysical_frag};class Rm extends zd{constructor(i=-1,l=1,h=1,d=-1,g=.1,v=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=i,this.right=l,this.top=h,this.bottom=d,this.near=g,this.far=v,this.updateProjectionMatrix()}copy(i,l){return super.copy(i,l),this.left=i.left,this.right=i.right,this.top=i.top,this.bottom=i.bottom,this.near=i.near,this.far=i.far,this.zoom=i.zoom,this.view=i.view===null?null:Object.assign({},i.view),this}setViewOffset(i,l,h,d,g,v){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=i,this.view.fullHeight=l,this.view.offsetX=h,this.view.offsetY=d,this.view.width=g,this.view.height=v,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const i=(this.right-this.left)/(2*this.zoom),l=(this.top-this.bottom)/(2*this.zoom),h=(this.right+this.left)/2,d=(this.top+this.bottom)/2;let g=h-i,v=h+i,b=d+l,T=d-l;if(this.view!==null&&this.view.enabled){const I=(this.right-this.left)/this.view.fullWidth/this.zoom,N=(this.top-this.bottom)/this.view.fullHeight/this.zoom;g+=I*this.view.offsetX,v=g+I*this.view.width,b-=N*this.view.offsetY,T=b-N*this.view.height}this.projectionMatrix.makeOrthographic(g,v,b,T,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(i){const l=super.toJSON(i);return l.object.zoom=this.zoom,l.object.left=this.left,l.object.right=this.right,l.object.top=this.top,l.object.bottom=this.bottom,l.object.near=this.near,l.object.far=this.far,this.view!==null&&(l.object.view=Object.assign({},this.view)),l}}const Q0=[.125,.215,.35,.446,.526,.582],Bm=new Rm,km=new bn;let Om=null;const sc=(1+Math.sqrt(5))/2,Vh=1/sc,j_=[new Re(1,1,1),new Re(-1,1,1),new Re(1,1,-1),new Re(-1,1,-1),new Re(0,sc,Vh),new Re(0,sc,-Vh),new Re(Vh,0,sc),new Re(-Vh,0,sc),new Re(sc,Vh,0),new Re(-sc,Vh,0)];class Lm{constructor(i){this._renderer=i,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(i,l=0,h=.1,d=100){Om=this._renderer.getRenderTarget(),this._setSize(256);const g=this._allocateTargets();return g.depthBuffer=!0,this._sceneToCubeUV(i,h,d,g),l>0&&this._blur(g,0,0,l),this._applyPMREM(g),this._cleanup(g),g}fromEquirectangular(i,l=null){return this._fromTexture(i,l)}fromCubemap(i,l=null){return this._fromTexture(i,l)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=z_(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Nm(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(i){this._lodMax=Math.floor(Math.log2(i)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let i=0;i<this._lodPlanes.length;i++)this._lodPlanes[i].dispose()}_cleanup(i){this._renderer.setRenderTarget(Om),i.scissorTest=!1,bi(i,0,0,i.width,i.height)}_fromTexture(i,l){i.mapping===Xi||i.mapping===zi?this._setSize(i.image.length===0?16:i.image[0].width||i.image[0].image.width):this._setSize(i.image.width/4),Om=this._renderer.getRenderTarget();const h=l||this._allocateTargets();return this._textureToCubeUV(i,h),this._applyPMREM(h),this._cleanup(h),h}_allocateTargets(){const i=3*Math.max(this._cubeSize,112),l=4*this._cubeSize,h={magFilter:nr,minFilter:nr,generateMipmaps:!1,type:Gs,format:Nn,encoding:Aa,depthBuffer:!1},d=H0(i,l,h);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==i){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=H0(i,l,h);const{_lodMax:g}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(v){const b=[],T=[],I=[];let N=v;const z=v-4+1+Q0.length;for(let U=0;U<z;U++){const Q=Math.pow(2,N);T.push(Q);let Y=1/Q;U>v-4?Y=Q0[U-v+4-1]:U===0&&(Y=0),I.push(Y);const H=1/(Q-2),ne=-H,ie=1+H,re=[ne,ne,ie,ne,ie,ie,ne,ne,ie,ie,ne,ie],ve=6,Ee=6,Me=3,Pe=2,Ye=1,Ke=new Float32Array(Me*Ee*ve),lt=new Float32Array(Pe*Ee*ve),ut=new Float32Array(Ye*Ee*ve);for(let Ft=0;Ft<ve;Ft++){const $t=Ft%3*2/3-1,Lt=Ft>2?0:-1,an=[$t,Lt,0,$t+2/3,Lt,0,$t+2/3,Lt+1,0,$t,Lt,0,$t+2/3,Lt+1,0,$t,Lt+1,0];Ke.set(an,Me*Ee*Ft),lt.set(re,Pe*Ee*Ft);const ln=[Ft,Ft,Ft,Ft,Ft,Ft];ut.set(ln,Ye*Ee*Ft)}const Ze=new In;Ze.setAttribute("position",new mr(Ke,Me)),Ze.setAttribute("uv",new mr(lt,Pe)),Ze.setAttribute("faceIndex",new mr(ut,Ye)),b.push(Ze),N>4&&N--}return{lodPlanes:b,sizeLods:T,sigmas:I}}(g)),this._blurMaterial=function(v,b,T){const I=new Float32Array(20),N=new Re(0,1,0);return new wl({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/b,CUBEUV_TEXEL_HEIGHT:1/T,CUBEUV_MAX_MIP:`${v}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:I},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:N}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:oe,depthTest:!1,depthWrite:!1})}(g,i,l)}return d}_compileMaterial(i){const l=new ks(this._lodPlanes[0],i);this._renderer.compile(l,Bm)}_sceneToCubeUV(i,l,h,d){const g=new Ks(90,1,l,h),v=[1,-1,1,1,1,1],b=[1,1,1,-1,-1,-1],T=this._renderer,I=T.autoClear,N=T.toneMapping;T.getClearColor(km),T.toneMapping=Xn,T.autoClear=!1;const z=new Wa({name:"PMREM.Background",side:$,depthWrite:!1,depthTest:!1}),U=new ks(new qa,z);let Q=!1;const Y=i.background;Y?Y.isColor&&(z.color.copy(Y),i.background=null,Q=!0):(z.color.copy(km),Q=!0);for(let H=0;H<6;H++){const ne=H%3;ne===0?(g.up.set(0,v[H],0),g.lookAt(b[H],0,0)):ne===1?(g.up.set(0,0,v[H]),g.lookAt(0,b[H],0)):(g.up.set(0,v[H],0),g.lookAt(0,0,b[H]));const ie=this._cubeSize;bi(d,ne*ie,H>2?ie:0,ie,ie),T.setRenderTarget(d),Q&&T.render(U,g),T.render(i,g)}U.geometry.dispose(),U.material.dispose(),T.toneMapping=N,T.autoClear=I,i.background=Y}_textureToCubeUV(i,l){const h=this._renderer,d=i.mapping===Xi||i.mapping===zi;d?(this._cubemapMaterial===null&&(this._cubemapMaterial=z_()),this._cubemapMaterial.uniforms.flipEnvMap.value=i.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Nm());const g=d?this._cubemapMaterial:this._equirectMaterial,v=new ks(this._lodPlanes[0],g);g.uniforms.envMap.value=i;const b=this._cubeSize;bi(l,0,0,3*b,2*b),h.setRenderTarget(l),h.render(v,Bm)}_applyPMREM(i){const l=this._renderer,h=l.autoClear;l.autoClear=!1;for(let d=1;d<this._lodPlanes.length;d++){const g=Math.sqrt(this._sigmas[d]*this._sigmas[d]-this._sigmas[d-1]*this._sigmas[d-1]),v=j_[(d-1)%j_.length];this._blur(i,d-1,d,g,v)}l.autoClear=h}_blur(i,l,h,d,g){const v=this._pingPongRenderTarget;this._halfBlur(i,v,l,h,d,"latitudinal",g),this._halfBlur(v,i,h,h,d,"longitudinal",g)}_halfBlur(i,l,h,d,g,v,b){const T=this._renderer,I=this._blurMaterial;v!=="latitudinal"&&v!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const N=new ks(this._lodPlanes[d],I),z=I.uniforms,U=this._sizeLods[h]-1,Q=isFinite(g)?Math.PI/(2*U):2*Math.PI/39,Y=g/Q,H=isFinite(g)?1+Math.floor(3*Y):20;H>20&&console.warn(`sigmaRadians, ${g}, is too large and will clip, as it requested ${H} samples when the maximum is set to 20`);const ne=[];let ie=0;for(let Ee=0;Ee<20;++Ee){const Me=Ee/Y,Pe=Math.exp(-Me*Me/2);ne.push(Pe),Ee===0?ie+=Pe:Ee<H&&(ie+=2*Pe)}for(let Ee=0;Ee<ne.length;Ee++)ne[Ee]=ne[Ee]/ie;z.envMap.value=i.texture,z.samples.value=H,z.weights.value=ne,z.latitudinal.value=v==="latitudinal",b&&(z.poleAxis.value=b);const{_lodMax:re}=this;z.dTheta.value=Q,z.mipInt.value=re-h;const ve=this._sizeLods[d];bi(l,3*ve*(d>re-4?d-re+4:0),4*(this._cubeSize-ve),3*ve,2*ve),T.setRenderTarget(l),T.render(N,Bm)}}function H0(x,i,l){const h=new bo(x,i,l);return h.texture.mapping=Vr,h.texture.name="PMREM.cubeUv",h.scissorTest=!0,h}function bi(x,i,l,h,d){x.viewport.set(i,l,h,d),x.scissor.set(i,l,h,d)}function Nm(){return new wl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:oe,depthTest:!1,depthWrite:!1})}function z_(){return new wl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`,fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:oe,depthTest:!1,depthWrite:!1})}function W0(x){let i=new WeakMap,l=null;function h(d){const g=d.target;g.removeEventListener("dispose",h);const v=i.get(g);v!==void 0&&(i.delete(g),v.dispose())}return{get:function(d){if(d&&d.isTexture){const g=d.mapping,v=g===Vi||g===Gi,b=g===Xi||g===zi;if(v||b){if(d.isRenderTargetTexture&&d.needsPMREMUpdate===!0){d.needsPMREMUpdate=!1;let T=i.get(d);return l===null&&(l=new Lm(x)),T=v?l.fromEquirectangular(d,T):l.fromCubemap(d,T),i.set(d,T),T.texture}if(i.has(d))return i.get(d).texture;{const T=d.image;if(v&&T&&T.height>0||b&&T&&function(I){let N=0;for(let z=0;z<6;z++)I[z]!==void 0&&N++;return N===6}(T)){l===null&&(l=new Lm(x));const I=v?l.fromEquirectangular(d):l.fromCubemap(d);return i.set(d,I),d.addEventListener("dispose",h),I.texture}return null}}}return d},dispose:function(){i=new WeakMap,l!==null&&(l.dispose(),l=null)}}}function dn(x){const i={};function l(h){if(i[h]!==void 0)return i[h];let d;switch(h){case"WEBGL_depth_texture":d=x.getExtension("WEBGL_depth_texture")||x.getExtension("MOZ_WEBGL_depth_texture")||x.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":d=x.getExtension("EXT_texture_filter_anisotropic")||x.getExtension("MOZ_EXT_texture_filter_anisotropic")||x.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":d=x.getExtension("WEBGL_compressed_texture_s3tc")||x.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||x.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":d=x.getExtension("WEBGL_compressed_texture_pvrtc")||x.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:d=x.getExtension(h)}return i[h]=d,d}return{has:function(h){return l(h)!==null},init:function(h){h.isWebGL2?l("EXT_color_buffer_float"):(l("WEBGL_depth_texture"),l("OES_texture_float"),l("OES_texture_half_float"),l("OES_texture_half_float_linear"),l("OES_standard_derivatives"),l("OES_element_index_uint"),l("OES_vertex_array_object"),l("ANGLE_instanced_arrays")),l("OES_texture_float_linear"),l("EXT_color_buffer_half_float"),l("WEBGL_multisampled_render_to_texture")},get:function(h){const d=l(h);return d===null&&console.warn("THREE.WebGLRenderer: "+h+" extension not supported."),d}}}function ui(x,i,l,h){const d={},g=new WeakMap;function v(T){const I=T.target;I.index!==null&&i.remove(I.index);for(const z in I.attributes)i.remove(I.attributes[z]);I.removeEventListener("dispose",v),delete d[I.id];const N=g.get(I);N&&(i.remove(N),g.delete(I)),h.releaseStatesOfGeometry(I),I.isInstancedBufferGeometry===!0&&delete I._maxInstanceCount,l.memory.geometries--}function b(T){const I=[],N=T.index,z=T.attributes.position;let U=0;if(N!==null){const H=N.array;U=N.version;for(let ne=0,ie=H.length;ne<ie;ne+=3){const re=H[ne+0],ve=H[ne+1],Ee=H[ne+2];I.push(re,ve,ve,Ee,Ee,re)}}else{const H=z.array;U=z.version;for(let ne=0,ie=H.length/3-1;ne<ie;ne+=3){const re=ne+0,ve=ne+1,Ee=ne+2;I.push(re,ve,ve,Ee,Ee,re)}}const Q=new(Mm(I)?B:Ur)(I,1);Q.version=U;const Y=g.get(T);Y&&i.remove(Y),g.set(T,Q)}return{get:function(T,I){return d[I.id]===!0||(I.addEventListener("dispose",v),d[I.id]=!0,l.memory.geometries++),I},update:function(T){const I=T.attributes;for(const z in I)i.update(I[z],34962);const N=T.morphAttributes;for(const z in N){const U=N[z];for(let Q=0,Y=U.length;Q<Y;Q++)i.update(U[Q],34962)}},getWireframeAttribute:function(T){const I=g.get(T);if(I){const N=T.index;N!==null&&I.version<N.version&&b(T)}else b(T);return g.get(T)}}}function Qd(x,i,l,h){const d=h.isWebGL2;let g,v,b;this.setMode=function(T){g=T},this.setIndex=function(T){v=T.type,b=T.bytesPerElement},this.render=function(T,I){x.drawElements(g,I,v,T*b),l.update(I,g,1)},this.renderInstances=function(T,I,N){if(N===0)return;let z,U;if(d)z=x,U="drawElementsInstanced";else if(z=i.get("ANGLE_instanced_arrays"),U="drawElementsInstancedANGLE",z===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");z[U](g,I,v,T*b,N),l.update(I,g,N)}}function xl(x){const i={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:i,programs:null,autoReset:!0,reset:function(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0},update:function(l,h,d){switch(i.calls++,h){case 4:i.triangles+=d*(l/3);break;case 1:i.lines+=d*(l/2);break;case 3:i.lines+=d*(l-1);break;case 2:i.lines+=d*l;break;case 0:i.points+=d*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h)}}}}function V_(x,i){return x[0]-i[0]}function G_(x,i){return Math.abs(i[1])-Math.abs(x[1])}function q0(x,i,l){const h={},d=new Float32Array(8),g=new WeakMap,v=new Zi,b=[];for(let T=0;T<8;T++)b[T]=[T,0];return{update:function(T,I,N,z){const U=T.morphTargetInfluences;if(i.isWebGL2===!0){const Q=I.morphAttributes.position||I.morphAttributes.normal||I.morphAttributes.color,Y=Q!==void 0?Q.length:0;let H=g.get(I);if(H===void 0||H.count!==Y){H!==void 0&&H.texture.dispose();const re=I.morphAttributes.position!==void 0,ve=I.morphAttributes.normal!==void 0,Ee=I.morphAttributes.color!==void 0,Me=I.morphAttributes.position||[],Pe=I.morphAttributes.normal||[],Ye=I.morphAttributes.color||[];let Ke=0;re===!0&&(Ke=1),ve===!0&&(Ke=2),Ee===!0&&(Ke=3);let lt=I.attributes.position.count*Ke,ut=1;lt>i.maxTextureSize&&(ut=Math.ceil(lt/i.maxTextureSize),lt=i.maxTextureSize);const Ze=new Float32Array(lt*ut*4*Y),Ft=new Ru(Ze,lt,ut,Y);Ft.type=_r,Ft.needsUpdate=!0;const $t=4*Ke;for(let Lt=0;Lt<Y;Lt++){const an=Me[Lt],ln=Pe[Lt],Ct=Ye[Lt],Dt=lt*ut*4*Lt;for(let nn=0;nn<an.count;nn++){const Ut=nn*$t;re===!0&&(v.fromBufferAttribute(an,nn),Ze[Dt+Ut+0]=v.x,Ze[Dt+Ut+1]=v.y,Ze[Dt+Ut+2]=v.z,Ze[Dt+Ut+3]=0),ve===!0&&(v.fromBufferAttribute(ln,nn),Ze[Dt+Ut+4]=v.x,Ze[Dt+Ut+5]=v.y,Ze[Dt+Ut+6]=v.z,Ze[Dt+Ut+7]=0),Ee===!0&&(v.fromBufferAttribute(Ct,nn),Ze[Dt+Ut+8]=v.x,Ze[Dt+Ut+9]=v.y,Ze[Dt+Ut+10]=v.z,Ze[Dt+Ut+11]=Ct.itemSize===4?v.w:1)}}H={count:Y,texture:Ft,size:new Xt(lt,ut)},g.set(I,H),I.addEventListener("dispose",function Lt(){Ft.dispose(),g.delete(I),I.removeEventListener("dispose",Lt)})}let ne=0;for(let re=0;re<U.length;re++)ne+=U[re];const ie=I.morphTargetsRelative?1:1-ne;z.getUniforms().setValue(x,"morphTargetBaseInfluence",ie),z.getUniforms().setValue(x,"morphTargetInfluences",U),z.getUniforms().setValue(x,"morphTargetsTexture",H.texture,l),z.getUniforms().setValue(x,"morphTargetsTextureSize",H.size)}else{const Q=U===void 0?0:U.length;let Y=h[I.id];if(Y===void 0||Y.length!==Q){Y=[];for(let ve=0;ve<Q;ve++)Y[ve]=[ve,0];h[I.id]=Y}for(let ve=0;ve<Q;ve++){const Ee=Y[ve];Ee[0]=ve,Ee[1]=U[ve]}Y.sort(G_);for(let ve=0;ve<8;ve++)ve<Q&&Y[ve][1]?(b[ve][0]=Y[ve][0],b[ve][1]=Y[ve][1]):(b[ve][0]=Number.MAX_SAFE_INTEGER,b[ve][1]=0);b.sort(V_);const H=I.morphAttributes.position,ne=I.morphAttributes.normal;let ie=0;for(let ve=0;ve<8;ve++){const Ee=b[ve],Me=Ee[0],Pe=Ee[1];Me!==Number.MAX_SAFE_INTEGER&&Pe?(H&&I.getAttribute("morphTarget"+ve)!==H[Me]&&I.setAttribute("morphTarget"+ve,H[Me]),ne&&I.getAttribute("morphNormal"+ve)!==ne[Me]&&I.setAttribute("morphNormal"+ve,ne[Me]),d[ve]=Pe,ie+=Pe):(H&&I.hasAttribute("morphTarget"+ve)===!0&&I.deleteAttribute("morphTarget"+ve),ne&&I.hasAttribute("morphNormal"+ve)===!0&&I.deleteAttribute("morphNormal"+ve),d[ve]=0)}const re=I.morphTargetsRelative?1:1-ie;z.getUniforms().setValue(x,"morphTargetBaseInfluence",re),z.getUniforms().setValue(x,"morphTargetInfluences",d)}}}}function xr(x,i,l,h){let d=new WeakMap;function g(v){const b=v.target;b.removeEventListener("dispose",g),l.remove(b.instanceMatrix),b.instanceColor!==null&&l.remove(b.instanceColor)}return{update:function(v){const b=h.render.frame,T=v.geometry,I=i.get(v,T);return d.get(I)!==b&&(i.update(I),d.set(I,b)),v.isInstancedMesh&&(v.hasEventListener("dispose",g)===!1&&v.addEventListener("dispose",g),l.update(v.instanceMatrix,34962),v.instanceColor!==null&&l.update(v.instanceColor,34962)),I},dispose:function(){d=new WeakMap}}}const Y0=new fs,Q_=new Ru,H_=new Uc,W_=new Vd,X0=[],Fm=[],q_=new Float32Array(16),Ya=new Float32Array(9),El=new Float32Array(4);function Hd(x,i,l){const h=x[0];if(h<=0||h>0)return x;const d=i*l;let g=X0[d];if(g===void 0&&(g=new Float32Array(d),X0[d]=g),i!==0){h.toArray(g,0);for(let v=1,b=0;v!==i;++v)b+=l,x[v].toArray(g,b)}return g}function Js(x,i){if(x.length!==i.length)return!1;for(let l=0,h=x.length;l<h;l++)if(x[l]!==i[l])return!1;return!0}function ts(x,i){for(let l=0,h=i.length;l<h;l++)x[l]=i[l]}function qp(x,i){let l=Fm[i];l===void 0&&(l=new Int32Array(i),Fm[i]=l);for(let h=0;h!==i;++h)l[h]=x.allocateTextureUnit();return l}function Yp(x,i){const l=this.cache;l[0]!==i&&(x.uniform1f(this.addr,i),l[0]=i)}function Y_(x,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y||(x.uniform2f(this.addr,i.x,i.y),l[0]=i.x,l[1]=i.y);else{if(Js(l,i))return;x.uniform2fv(this.addr,i),ts(l,i)}}function Xp(x,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y&&l[2]===i.z||(x.uniform3f(this.addr,i.x,i.y,i.z),l[0]=i.x,l[1]=i.y,l[2]=i.z);else if(i.r!==void 0)l[0]===i.r&&l[1]===i.g&&l[2]===i.b||(x.uniform3f(this.addr,i.r,i.g,i.b),l[0]=i.r,l[1]=i.g,l[2]=i.b);else{if(Js(l,i))return;x.uniform3fv(this.addr,i),ts(l,i)}}function K0(x,i){const l=this.cache;if(i.x!==void 0)l[0]===i.x&&l[1]===i.y&&l[2]===i.z&&l[3]===i.w||(x.uniform4f(this.addr,i.x,i.y,i.z,i.w),l[0]=i.x,l[1]=i.y,l[2]=i.z,l[3]=i.w);else{if(Js(l,i))return;x.uniform4fv(this.addr,i),ts(l,i)}}function X_(x,i){const l=this.cache,h=i.elements;if(h===void 0){if(Js(l,i))return;x.uniformMatrix2fv(this.addr,!1,i),ts(l,i)}else{if(Js(l,h))return;El.set(h),x.uniformMatrix2fv(this.addr,!1,El),ts(l,h)}}function lo(x,i){const l=this.cache,h=i.elements;if(h===void 0){if(Js(l,i))return;x.uniformMatrix3fv(this.addr,!1,i),ts(l,i)}else{if(Js(l,h))return;Ya.set(h),x.uniformMatrix3fv(this.addr,!1,Ya),ts(l,h)}}function Sl(x,i){const l=this.cache,h=i.elements;if(h===void 0){if(Js(l,i))return;x.uniformMatrix4fv(this.addr,!1,i),ts(l,i)}else{if(Js(l,h))return;q_.set(h),x.uniformMatrix4fv(this.addr,!1,q_),ts(l,h)}}function Kp(x,i){const l=this.cache;l[0]!==i&&(x.uniform1i(this.addr,i),l[0]=i)}function Um(x,i){const l=this.cache;Js(l,i)||(x.uniform2iv(this.addr,i),ts(l,i))}function Cl(x,i){const l=this.cache;Js(l,i)||(x.uniform3iv(this.addr,i),ts(l,i))}function K_(x,i){const l=this.cache;Js(l,i)||(x.uniform4iv(this.addr,i),ts(l,i))}function jm(x,i){const l=this.cache;l[0]!==i&&(x.uniform1ui(this.addr,i),l[0]=i)}function J0(x,i){const l=this.cache;Js(l,i)||(x.uniform2uiv(this.addr,i),ts(l,i))}function zm(x,i){const l=this.cache;Js(l,i)||(x.uniform3uiv(this.addr,i),ts(l,i))}function Ml(x,i){const l=this.cache;Js(l,i)||(x.uniform4uiv(this.addr,i),ts(l,i))}function Ca(x,i,l){const h=this.cache,d=l.allocateTextureUnit();h[0]!==d&&(x.uniform1i(this.addr,d),h[0]=d),l.setTexture2D(i||Y0,d)}function Vm(x,i,l){const h=this.cache,d=l.allocateTextureUnit();h[0]!==d&&(x.uniform1i(this.addr,d),h[0]=d),l.setTexture3D(i||H_,d)}function $0(x,i,l){const h=this.cache,d=l.allocateTextureUnit();h[0]!==d&&(x.uniform1i(this.addr,d),h[0]=d),l.setTextureCube(i||W_,d)}function Gm(x,i,l){const h=this.cache,d=l.allocateTextureUnit();h[0]!==d&&(x.uniform1i(this.addr,d),h[0]=d),l.setTexture2DArray(i||Q_,d)}function Z0(x,i){x.uniform1fv(this.addr,i)}function J_(x,i){const l=Hd(i,this.size,2);x.uniform2fv(this.addr,l)}function Qm(x,i){const l=Hd(i,this.size,3);x.uniform3fv(this.addr,l)}function eA(x,i){const l=Hd(i,this.size,4);x.uniform4fv(this.addr,l)}function tA(x,i){const l=Hd(i,this.size,4);x.uniformMatrix2fv(this.addr,!1,l)}function gw(x,i){const l=Hd(i,this.size,9);x.uniformMatrix3fv(this.addr,!1,l)}function nA(x,i){const l=Hd(i,this.size,16);x.uniformMatrix4fv(this.addr,!1,l)}function iA(x,i){x.uniform1iv(this.addr,i)}function rA(x,i){x.uniform2iv(this.addr,i)}function ca(x,i){x.uniform3iv(this.addr,i)}function Ir(x,i){x.uniform4iv(this.addr,i)}function sA(x,i){x.uniform1uiv(this.addr,i)}function Gh(x,i){x.uniform2uiv(this.addr,i)}function ua(x,i){x.uniform3uiv(this.addr,i)}function Hu(x,i){x.uniform4uiv(this.addr,i)}function Kr(x,i,l){const h=i.length,d=qp(l,h);x.uniform1iv(this.addr,d);for(let g=0;g!==h;++g)l.setTexture2D(i[g]||Y0,d[g])}function oA(x,i,l){const h=i.length,d=qp(l,h);x.uniform1iv(this.addr,d);for(let g=0;g!==h;++g)l.setTexture3D(i[g]||H_,d[g])}function $_(x,i,l){const h=i.length,d=qp(l,h);x.uniform1iv(this.addr,d);for(let g=0;g!==h;++g)l.setTextureCube(i[g]||W_,d[g])}function aA(x,i,l){const h=i.length,d=qp(l,h);x.uniform1iv(this.addr,d);for(let g=0;g!==h;++g)l.setTexture2DArray(i[g]||Q_,d[g])}class lA{constructor(i,l,h){this.id=i,this.addr=h,this.cache=[],this.setValue=function(d){switch(d){case 5126:return Yp;case 35664:return Y_;case 35665:return Xp;case 35666:return K0;case 35674:return X_;case 35675:return lo;case 35676:return Sl;case 5124:case 35670:return Kp;case 35667:case 35671:return Um;case 35668:case 35672:return Cl;case 35669:case 35673:return K_;case 5125:return jm;case 36294:return J0;case 36295:return zm;case 36296:return Ml;case 35678:case 36198:case 36298:case 36306:case 35682:return Ca;case 35679:case 36299:case 36307:return Vm;case 35680:case 36300:case 36308:case 36293:return $0;case 36289:case 36303:case 36311:case 36292:return Gm}}(l.type)}}class cA{constructor(i,l,h){this.id=i,this.addr=h,this.cache=[],this.size=l.size,this.setValue=function(d){switch(d){case 5126:return Z0;case 35664:return J_;case 35665:return Qm;case 35666:return eA;case 35674:return tA;case 35675:return gw;case 35676:return nA;case 5124:case 35670:return iA;case 35667:case 35671:return rA;case 35668:case 35672:return ca;case 35669:case 35673:return Ir;case 5125:return sA;case 36294:return Gh;case 36295:return ua;case 36296:return Hu;case 35678:case 36198:case 36298:case 36306:case 35682:return Kr;case 35679:case 36299:case 36307:return oA;case 35680:case 36300:case 36308:case 36293:return $_;case 36289:case 36303:case 36311:case 36292:return aA}}(l.type)}}class _w{constructor(i){this.id=i,this.seq=[],this.map={}}setValue(i,l,h){const d=this.seq;for(let g=0,v=d.length;g!==v;++g){const b=d[g];b.setValue(i,l[b.id],h)}}}const Z_=/(\w+)(\])?(\[|\.)?/g;function uA(x,i){x.seq.push(i),x.map[i.id]=i}function vw(x,i,l){const h=x.name,d=h.length;for(Z_.lastIndex=0;;){const g=Z_.exec(h),v=Z_.lastIndex;let b=g[1];const T=g[2]==="]",I=g[3];if(T&&(b|=0),I===void 0||I==="["&&v+2===d){uA(l,I===void 0?new lA(b,x,i):new cA(b,x,i));break}{let N=l.map[b];N===void 0&&(N=new _w(b),uA(l,N)),l=N}}}class Hm{constructor(i,l){this.seq=[],this.map={};const h=i.getProgramParameter(l,35718);for(let d=0;d<h;++d){const g=i.getActiveUniform(l,d);vw(g,i.getUniformLocation(l,g.name),this)}}setValue(i,l,h,d){const g=this.map[l];g!==void 0&&g.setValue(i,h,d)}setOptional(i,l,h){const d=l[h];d!==void 0&&this.setValue(i,h,d)}static upload(i,l,h,d){for(let g=0,v=l.length;g!==v;++g){const b=l[g],T=h[b.id];T.needsUpdate!==!1&&b.setValue(i,T.value,d)}}static seqWithValue(i,l){const h=[];for(let d=0,g=i.length;d!==g;++d){const v=i[d];v.id in l&&h.push(v)}return h}}function hA(x,i,l){const h=x.createShader(i);return x.shaderSource(h,l),x.compileShader(h),h}let ev=0;function Jp(x){switch(x){case Aa:return["Linear","( value )"];case Mi:return["sRGB","( value )"];case Pc:return["RGBM","( value, 16.0 )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",x),["Linear","( value )"]}}function Pr(x,i,l){const h=x.getShaderParameter(i,35713),d=x.getShaderInfoLog(i).trim();if(h&&d==="")return"";const g=/ERROR: 0:(\d+)/.exec(d);if(g){const v=parseInt(g[1]);return l.toUpperCase()+`

`+d+`

`+function(b,T){const I=b.split(`
`),N=[],z=Math.max(T-6,0),U=Math.min(T+6,I.length);for(let Q=z;Q<U;Q++){const Y=Q+1;N.push(`${Y===T?">":" "} ${Y}: ${I[Q]}`)}return N.join(`
`)}(x.getShaderSource(i),v)}return d}function dA(x,i){const l=Jp(i);return"vec4 "+x+"( vec4 value ) { return "+l[0]+"ToLinear"+l[1]+"; }"}function pA(x,i){const l=Jp(i);return"vec4 "+x+"( vec4 value ) { return LinearTo"+l[0]+l[1]+"; }"}function Wm(x,i){let l;switch(i){case Pi:l="Linear";break;case qn:l="Reinhard";break;case gt:l="OptimizedCineon";break;case mi:l="ACESFilmic";break;case Ei:l="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",i),l="Linear"}return"vec3 "+x+"( vec3 color ) { return "+l+"ToneMapping( color ); }"}function Wu(x){return x!==""}function Tl(x,i){const l=i.numSpotLightShadows+i.numSpotLightMaps-i.numSpotLightShadowsWithMaps;return x.replace(/NUM_DIR_LIGHTS/g,i.numDirLights).replace(/NUM_SPOT_LIGHTS/g,i.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,i.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,l).replace(/NUM_RECT_AREA_LIGHTS/g,i.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,i.numPointLights).replace(/NUM_HEMI_LIGHTS/g,i.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,i.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,i.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,i.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,i.numPointLightShadows)}function tv(x,i){return x.replace(/NUM_CLIPPING_PLANES/g,i.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,i.numClippingPlanes-i.numClipIntersection)}const $p=/^[ \t]*#include +<([\w\d./]+)>/gm;function Yc(x){return x.replace($p,Zp)}function Zp(x,i){const l=Ai[i];if(l===void 0)throw new Error("Can not resolve #include <"+i+">");return Yc(l)}const qm=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Wd(x){return x.replace(qm,ef)}function ef(x,i,l,h){let d="";for(let g=parseInt(i);g<parseInt(l);g++)d+=h.replace(/\[\s*i\s*\]/g,"[ "+g+" ]").replace(/UNROLLED_LOOP_INDEX/g,g);return d}function fA(x){let i="precision "+x.precision+` float;
precision `+x.precision+" int;";return x.precision==="highp"?i+=`
#define HIGH_PRECISION`:x.precision==="mediump"?i+=`
#define MEDIUM_PRECISION`:x.precision==="lowp"&&(i+=`
#define LOW_PRECISION`),i}function Aw(x,i,l,h){const d=x.getContext(),g=l.defines;let v=l.vertexShader,b=l.fragmentShader;const T=function(Ke){let lt="SHADOWMAP_TYPE_BASIC";return Ke.shadowMapType===fe?lt="SHADOWMAP_TYPE_PCF":Ke.shadowMapType===de?lt="SHADOWMAP_TYPE_PCF_SOFT":Ke.shadowMapType===le&&(lt="SHADOWMAP_TYPE_VSM"),lt}(l),I=function(Ke){let lt="ENVMAP_TYPE_CUBE";if(Ke.envMap)switch(Ke.envMapMode){case Xi:case zi:lt="ENVMAP_TYPE_CUBE";break;case Vr:lt="ENVMAP_TYPE_CUBE_UV"}return lt}(l),N=function(Ke){let lt="ENVMAP_MODE_REFLECTION";return Ke.envMap&&Ke.envMapMode===zi&&(lt="ENVMAP_MODE_REFRACTION"),lt}(l),z=function(Ke){let lt="ENVMAP_BLENDING_NONE";if(Ke.envMap)switch(Ke.combine){case Cn:lt="ENVMAP_BLENDING_MULTIPLY";break;case vn:lt="ENVMAP_BLENDING_MIX";break;case Zn:lt="ENVMAP_BLENDING_ADD"}return lt}(l),U=function(Ke){const lt=Ke.envMapCubeUVHeight;if(lt===null)return null;const ut=Math.log2(lt)-2,Ze=1/lt;return{texelWidth:1/(3*Math.max(Math.pow(2,ut),112)),texelHeight:Ze,maxMip:ut}}(l),Q=l.isWebGL2?"":function(Ke){return[Ke.extensionDerivatives||Ke.envMapCubeUVHeight||Ke.bumpMap||Ke.tangentSpaceNormalMap||Ke.clearcoatNormalMap||Ke.flatShading||Ke.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(Ke.extensionFragDepth||Ke.logarithmicDepthBuffer)&&Ke.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",Ke.extensionDrawBuffers&&Ke.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(Ke.extensionShaderTextureLOD||Ke.envMap||Ke.transmission)&&Ke.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Wu).join(`
`)}(l),Y=function(Ke){const lt=[];for(const ut in Ke){const Ze=Ke[ut];Ze!==!1&&lt.push("#define "+ut+" "+Ze)}return lt.join(`
`)}(g),H=d.createProgram();let ne,ie,re=l.glslVersion?"#version "+l.glslVersion+`
`:"";l.isRawShaderMaterial?(ne=[Y].filter(Wu).join(`
`),ne.length>0&&(ne+=`
`),ie=[Q,Y].filter(Wu).join(`
`),ie.length>0&&(ie+=`
`)):(ne=[fA(l),"#define SHADER_NAME "+l.shaderName,Y,l.instancing?"#define USE_INSTANCING":"",l.instancingColor?"#define USE_INSTANCING_COLOR":"",l.supportsVertexTextures?"#define VERTEX_TEXTURES":"",l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+N:"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.displacementMap&&l.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularColorMap?"#define USE_SPECULARCOLORMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.sheenColorMap?"#define USE_SHEENCOLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.flatShading?"#define FLAT_SHADED":"",l.skinning?"#define USE_SKINNING":"",l.morphTargets?"#define USE_MORPHTARGETS":"",l.morphNormals&&l.flatShading===!1?"#define USE_MORPHNORMALS":"",l.morphColors&&l.isWebGL2?"#define USE_MORPHCOLORS":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+l.morphTextureStride:"",l.morphTargetsCount>0&&l.isWebGL2?"#define MORPHTARGETS_COUNT "+l.morphTargetsCount:"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+T:"",l.sizeAttenuation?"#define USE_SIZEATTENUATION":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Wu).join(`
`),ie=[Q,fA(l),"#define SHADER_NAME "+l.shaderName,Y,l.useFog&&l.fog?"#define USE_FOG":"",l.useFog&&l.fogExp2?"#define FOG_EXP2":"",l.map?"#define USE_MAP":"",l.matcap?"#define USE_MATCAP":"",l.envMap?"#define USE_ENVMAP":"",l.envMap?"#define "+I:"",l.envMap?"#define "+N:"",l.envMap?"#define "+z:"",U?"#define CUBEUV_TEXEL_WIDTH "+U.texelWidth:"",U?"#define CUBEUV_TEXEL_HEIGHT "+U.texelHeight:"",U?"#define CUBEUV_MAX_MIP "+U.maxMip+".0":"",l.lightMap?"#define USE_LIGHTMAP":"",l.aoMap?"#define USE_AOMAP":"",l.emissiveMap?"#define USE_EMISSIVEMAP":"",l.bumpMap?"#define USE_BUMPMAP":"",l.normalMap?"#define USE_NORMALMAP":"",l.normalMap&&l.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",l.normalMap&&l.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",l.clearcoat?"#define USE_CLEARCOAT":"",l.clearcoatMap?"#define USE_CLEARCOATMAP":"",l.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",l.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",l.iridescence?"#define USE_IRIDESCENCE":"",l.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",l.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",l.specularMap?"#define USE_SPECULARMAP":"",l.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",l.specularColorMap?"#define USE_SPECULARCOLORMAP":"",l.roughnessMap?"#define USE_ROUGHNESSMAP":"",l.metalnessMap?"#define USE_METALNESSMAP":"",l.alphaMap?"#define USE_ALPHAMAP":"",l.alphaTest?"#define USE_ALPHATEST":"",l.sheen?"#define USE_SHEEN":"",l.sheenColorMap?"#define USE_SHEENCOLORMAP":"",l.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",l.transmission?"#define USE_TRANSMISSION":"",l.transmissionMap?"#define USE_TRANSMISSIONMAP":"",l.thicknessMap?"#define USE_THICKNESSMAP":"",l.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",l.vertexTangents?"#define USE_TANGENT":"",l.vertexColors||l.instancingColor?"#define USE_COLOR":"",l.vertexAlphas?"#define USE_COLOR_ALPHA":"",l.vertexUvs?"#define USE_UV":"",l.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",l.gradientMap?"#define USE_GRADIENTMAP":"",l.flatShading?"#define FLAT_SHADED":"",l.doubleSided?"#define DOUBLE_SIDED":"",l.flipSided?"#define FLIP_SIDED":"",l.shadowMapEnabled?"#define USE_SHADOWMAP":"",l.shadowMapEnabled?"#define "+T:"",l.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",l.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",l.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",l.logarithmicDepthBuffer&&l.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",l.toneMapping!==Xn?"#define TONE_MAPPING":"",l.toneMapping!==Xn?Ai.tonemapping_pars_fragment:"",l.toneMapping!==Xn?Wm("toneMapping",l.toneMapping):"",l.dithering?"#define DITHERING":"",l.opaque?"#define OPAQUE":"",Ai.encodings_pars_fragment,pA("linearToOutputTexel",l.outputEncoding),l.transmissionSamplerMapEncoding?dA("transmissionSamplerMapTexelToLinear",l.transmissionSamplerMapEncoding):"",l.useDepthPacking?"#define DEPTH_PACKING "+l.depthPacking:"",`
`].filter(Wu).join(`
`)),v=Yc(v),v=Tl(v,l),v=tv(v,l),b=Yc(b),b=Tl(b,l),b=tv(b,l),v=Wd(v),b=Wd(b),l.isWebGL2&&l.isRawShaderMaterial!==!0&&(re=`#version 300 es
`,ne=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+ne,ie=["#define varying in",l.glslVersion===ml?"":"layout(location = 0) out highp vec4 pc_fragColor;",l.glslVersion===ml?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+ie);const ve=re+ie+b,Ee=hA(d,35633,re+ne+v),Me=hA(d,35632,ve);if(d.attachShader(H,Ee),d.attachShader(H,Me),l.index0AttributeName!==void 0?d.bindAttribLocation(H,0,l.index0AttributeName):l.morphTargets===!0&&d.bindAttribLocation(H,0,"position"),d.linkProgram(H),x.debug.checkShaderErrors){const Ke=d.getProgramInfoLog(H).trim(),lt=d.getShaderInfoLog(Ee).trim(),ut=d.getShaderInfoLog(Me).trim();let Ze=!0,Ft=!0;if(d.getProgramParameter(H,35714)===!1){Ze=!1;const $t=Pr(d,Ee,"vertex"),Lt=Pr(d,Me,"fragment");console.error("THREE.WebGLProgram: Shader Error "+d.getError()+" - VALIDATE_STATUS "+d.getProgramParameter(H,35715)+`

Program Info Log: `+Ke+`
`+$t+`
`+Lt)}else Ke!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Ke):lt!==""&&ut!==""||(Ft=!1);Ft&&(this.diagnostics={runnable:Ze,programLog:Ke,vertexShader:{log:lt,prefix:ne},fragmentShader:{log:ut,prefix:ie}})}let Pe,Ye;return d.deleteShader(Ee),d.deleteShader(Me),this.getUniforms=function(){return Pe===void 0&&(Pe=new Hm(d,H)),Pe},this.getAttributes=function(){return Ye===void 0&&(Ye=function(Ke,lt){const ut={},Ze=Ke.getProgramParameter(lt,35721);for(let Ft=0;Ft<Ze;Ft++){const $t=Ke.getActiveAttrib(lt,Ft),Lt=$t.name;let an=1;$t.type===35674&&(an=2),$t.type===35675&&(an=3),$t.type===35676&&(an=4),ut[Lt]={type:$t.type,location:Ke.getAttribLocation(lt,Lt),locationSize:an}}return ut}(d,H)),Ye},this.destroy=function(){h.releaseStatesOfProgram(this),d.deleteProgram(H),this.program=void 0},this.name=l.shaderName,this.id=ev++,this.cacheKey=i,this.usedTimes=1,this.program=H,this.vertexShader=Ee,this.fragmentShader=Me,this}let mA=0;class Ym{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(i){const l=i.vertexShader,h=i.fragmentShader,d=this._getShaderStage(l),g=this._getShaderStage(h),v=this._getShaderCacheForMaterial(i);return v.has(d)===!1&&(v.add(d),d.usedTimes++),v.has(g)===!1&&(v.add(g),g.usedTimes++),this}remove(i){const l=this.materialCache.get(i);for(const h of l)h.usedTimes--,h.usedTimes===0&&this.shaderCache.delete(h.code);return this.materialCache.delete(i),this}getVertexShaderID(i){return this._getShaderStage(i.vertexShader).id}getFragmentShaderID(i){return this._getShaderStage(i.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(i){const l=this.materialCache;let h=l.get(i);return h===void 0&&(h=new Set,l.set(i,h)),h}_getShaderStage(i){const l=this.shaderCache;let h=l.get(i);return h===void 0&&(h=new gA(i),l.set(i,h)),h}}class gA{constructor(i){this.id=mA++,this.code=i,this.usedTimes=0}}function yw(x,i,l,h,d,g,v){const b=new so,T=new Ym,I=[],N=d.isWebGL2,z=d.logarithmicDepthBuffer,U=d.vertexTextures;let Q=d.precision;const Y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(H,ne,ie,re,ve){const Ee=re.fog,Me=ve.geometry,Pe=H.isMeshStandardMaterial?re.environment:null,Ye=(H.isMeshStandardMaterial?l:i).get(H.envMap||Pe),Ke=Ye&&Ye.mapping===Vr?Ye.image.height:null,lt=Y[H.type];H.precision!==null&&(Q=d.getMaxPrecision(H.precision),Q!==H.precision&&console.warn("THREE.WebGLProgram.getParameters:",H.precision,"not supported, using",Q,"instead."));const ut=Me.morphAttributes.position||Me.morphAttributes.normal||Me.morphAttributes.color,Ze=ut!==void 0?ut.length:0;let Ft,$t,Lt,an,ln=0;if(Me.morphAttributes.position!==void 0&&(ln=1),Me.morphAttributes.normal!==void 0&&(ln=2),Me.morphAttributes.color!==void 0&&(ln=3),lt){const On=la[lt];Ft=On.vertexShader,$t=On.fragmentShader}else Ft=H.vertexShader,$t=H.fragmentShader,T.update(H),Lt=T.getVertexShaderID(H),an=T.getFragmentShaderID(H);const Ct=x.getRenderTarget(),Dt=x.userData&&x.userData.transmissionRenderTarget,nn=H.alphaTest>0,Ut=H.clearcoat>0,on=H.iridescence>0;return{isWebGL2:N,shaderID:lt,shaderName:H.type,vertexShader:Ft,fragmentShader:$t,defines:H.defines,customVertexShaderID:Lt,customFragmentShaderID:an,isRawShaderMaterial:H.isRawShaderMaterial===!0,glslVersion:H.glslVersion,precision:Q,instancing:ve.isInstancedMesh===!0,instancingColor:ve.isInstancedMesh===!0&&ve.instanceColor!==null,supportsVertexTextures:U,outputEncoding:Ct===null?x.outputEncoding:Ct.isXRRenderTarget===!0||Ct.texture.encoding!==Mi?Ct.texture.encoding:Aa,map:!!H.map,matcap:!!H.matcap,envMap:!!Ye,envMapMode:Ye&&Ye.mapping,envMapCubeUVHeight:Ke,lightMap:!!H.lightMap,aoMap:!!H.aoMap,emissiveMap:!!H.emissiveMap,bumpMap:!!H.bumpMap,normalMap:!!H.normalMap,objectSpaceNormalMap:H.normalMapType===Ms,tangentSpaceNormalMap:H.normalMapType===Cs,decodeVideoTexture:!!H.map&&H.map.isVideoTexture===!0&&H.map.encoding===Mi,clearcoat:Ut,clearcoatMap:Ut&&!!H.clearcoatMap,clearcoatRoughnessMap:Ut&&!!H.clearcoatRoughnessMap,clearcoatNormalMap:Ut&&!!H.clearcoatNormalMap,iridescence:on,iridescenceMap:on&&!!H.iridescenceMap,iridescenceThicknessMap:on&&!!H.iridescenceThicknessMap,displacementMap:!!H.displacementMap,roughnessMap:!!H.roughnessMap,metalnessMap:!!H.metalnessMap,specularMap:!!H.specularMap,specularIntensityMap:!!H.specularIntensityMap,specularColorMap:!!H.specularColorMap,opaque:H.transparent===!1&&H.blending===ge&&!(H.transmission>0),alphaMap:!!H.alphaMap,alphaTest:nn,gradientMap:!!H.gradientMap,sheen:H.sheen>0,sheenColorMap:!!H.sheenColorMap,sheenRoughnessMap:!!H.sheenRoughnessMap,transmission:H.transmission>0,transmissionMap:!!H.transmissionMap,transmissionSamplerMapEncoding:Dt?Dt.texture.encoding:Aa,thicknessMap:!!H.thicknessMap,combine:H.combine,vertexTangents:!!H.normalMap&&!!Me.attributes.tangent,vertexColors:H.vertexColors,vertexAlphas:H.vertexColors===!0&&!!Me.attributes.color&&Me.attributes.color.itemSize===4,vertexUvs:!!(H.map||H.bumpMap||H.normalMap||H.specularMap||H.alphaMap||H.emissiveMap||H.roughnessMap||H.metalnessMap||H.clearcoatMap||H.clearcoatRoughnessMap||H.clearcoatNormalMap||H.iridescenceMap||H.iridescenceThicknessMap||H.displacementMap||H.transmissionMap||H.thicknessMap||H.specularIntensityMap||H.specularColorMap||H.sheenColorMap||H.sheenRoughnessMap),uvsVertexOnly:!(H.map||H.bumpMap||H.normalMap||H.specularMap||H.alphaMap||H.emissiveMap||H.roughnessMap||H.metalnessMap||H.clearcoatNormalMap||H.iridescenceMap||H.iridescenceThicknessMap||H.transmission>0||H.transmissionMap||H.thicknessMap||H.specularIntensityMap||H.specularColorMap||H.sheen>0||H.sheenColorMap||H.sheenRoughnessMap||!H.displacementMap),fog:!!Ee,useFog:H.fog===!0,fogExp2:Ee&&Ee.isFogExp2,flatShading:!!H.flatShading,sizeAttenuation:H.sizeAttenuation,logarithmicDepthBuffer:z,skinning:ve.isSkinnedMesh===!0,morphTargets:Me.morphAttributes.position!==void 0,morphNormals:Me.morphAttributes.normal!==void 0,morphColors:Me.morphAttributes.color!==void 0,morphTargetsCount:Ze,morphTextureStride:ln,numDirLights:ne.directional.length,numPointLights:ne.point.length,numSpotLights:ne.spot.length,numSpotLightMaps:ne.spotLightMap.length,numRectAreaLights:ne.rectArea.length,numHemiLights:ne.hemi.length,numDirLightShadows:ne.directionalShadowMap.length,numPointLightShadows:ne.pointShadowMap.length,numSpotLightShadows:ne.spotShadowMap.length,numSpotLightShadowsWithMaps:ne.numSpotLightShadowsWithMaps,numClippingPlanes:v.numPlanes,numClipIntersection:v.numIntersection,dithering:H.dithering,shadowMapEnabled:x.shadowMap.enabled&&ie.length>0,shadowMapType:x.shadowMap.type,toneMapping:H.toneMapped?x.toneMapping:Xn,physicallyCorrectLights:x.physicallyCorrectLights,premultipliedAlpha:H.premultipliedAlpha,doubleSided:H.side===_e,flipSided:H.side===$,useDepthPacking:!!H.depthPacking,depthPacking:H.depthPacking||0,index0AttributeName:H.index0AttributeName,extensionDerivatives:H.extensions&&H.extensions.derivatives,extensionFragDepth:H.extensions&&H.extensions.fragDepth,extensionDrawBuffers:H.extensions&&H.extensions.drawBuffers,extensionShaderTextureLOD:H.extensions&&H.extensions.shaderTextureLOD,rendererExtensionFragDepth:N||h.has("EXT_frag_depth"),rendererExtensionDrawBuffers:N||h.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:N||h.has("EXT_shader_texture_lod"),customProgramCacheKey:H.customProgramCacheKey()}},getProgramCacheKey:function(H){const ne=[];if(H.shaderID?ne.push(H.shaderID):(ne.push(H.customVertexShaderID),ne.push(H.customFragmentShaderID)),H.defines!==void 0)for(const ie in H.defines)ne.push(ie),ne.push(H.defines[ie]);return H.isRawShaderMaterial===!1&&(function(ie,re){ie.push(re.precision),ie.push(re.outputEncoding),ie.push(re.envMapMode),ie.push(re.envMapCubeUVHeight),ie.push(re.combine),ie.push(re.vertexUvs),ie.push(re.fogExp2),ie.push(re.sizeAttenuation),ie.push(re.morphTargetsCount),ie.push(re.morphAttributeCount),ie.push(re.numDirLights),ie.push(re.numPointLights),ie.push(re.numSpotLights),ie.push(re.numSpotLightMaps),ie.push(re.numHemiLights),ie.push(re.numRectAreaLights),ie.push(re.numDirLightShadows),ie.push(re.numPointLightShadows),ie.push(re.numSpotLightShadows),ie.push(re.numSpotLightShadowsWithMaps),ie.push(re.shadowMapType),ie.push(re.toneMapping),ie.push(re.numClippingPlanes),ie.push(re.numClipIntersection),ie.push(re.depthPacking)}(ne,H),function(ie,re){b.disableAll(),re.isWebGL2&&b.enable(0),re.supportsVertexTextures&&b.enable(1),re.instancing&&b.enable(2),re.instancingColor&&b.enable(3),re.map&&b.enable(4),re.matcap&&b.enable(5),re.envMap&&b.enable(6),re.lightMap&&b.enable(7),re.aoMap&&b.enable(8),re.emissiveMap&&b.enable(9),re.bumpMap&&b.enable(10),re.normalMap&&b.enable(11),re.objectSpaceNormalMap&&b.enable(12),re.tangentSpaceNormalMap&&b.enable(13),re.clearcoat&&b.enable(14),re.clearcoatMap&&b.enable(15),re.clearcoatRoughnessMap&&b.enable(16),re.clearcoatNormalMap&&b.enable(17),re.iridescence&&b.enable(18),re.iridescenceMap&&b.enable(19),re.iridescenceThicknessMap&&b.enable(20),re.displacementMap&&b.enable(21),re.specularMap&&b.enable(22),re.roughnessMap&&b.enable(23),re.metalnessMap&&b.enable(24),re.gradientMap&&b.enable(25),re.alphaMap&&b.enable(26),re.alphaTest&&b.enable(27),re.vertexColors&&b.enable(28),re.vertexAlphas&&b.enable(29),re.vertexUvs&&b.enable(30),re.vertexTangents&&b.enable(31),re.uvsVertexOnly&&b.enable(32),ie.push(b.mask),b.disableAll(),re.fog&&b.enable(0),re.useFog&&b.enable(1),re.flatShading&&b.enable(2),re.logarithmicDepthBuffer&&b.enable(3),re.skinning&&b.enable(4),re.morphTargets&&b.enable(5),re.morphNormals&&b.enable(6),re.morphColors&&b.enable(7),re.premultipliedAlpha&&b.enable(8),re.shadowMapEnabled&&b.enable(9),re.physicallyCorrectLights&&b.enable(10),re.doubleSided&&b.enable(11),re.flipSided&&b.enable(12),re.useDepthPacking&&b.enable(13),re.dithering&&b.enable(14),re.specularIntensityMap&&b.enable(15),re.specularColorMap&&b.enable(16),re.transmission&&b.enable(17),re.transmissionMap&&b.enable(18),re.thicknessMap&&b.enable(19),re.sheen&&b.enable(20),re.sheenColorMap&&b.enable(21),re.sheenRoughnessMap&&b.enable(22),re.decodeVideoTexture&&b.enable(23),re.opaque&&b.enable(24),ie.push(b.mask)}(ne,H),ne.push(x.outputEncoding)),ne.push(H.customProgramCacheKey),ne.join()},getUniforms:function(H){const ne=Y[H.type];let ie;if(ne){const re=la[ne];ie=j0.clone(re.uniforms)}else ie=H.uniforms;return ie},acquireProgram:function(H,ne){let ie;for(let re=0,ve=I.length;re<ve;re++){const Ee=I[re];if(Ee.cacheKey===ne){ie=Ee,++ie.usedTimes;break}}return ie===void 0&&(ie=new Aw(x,ne,H,g),I.push(ie)),ie},releaseProgram:function(H){if(--H.usedTimes==0){const ne=I.indexOf(H);I[ne]=I[I.length-1],I.pop(),H.destroy()}},releaseShaderCache:function(H){T.remove(H)},programs:I,dispose:function(){T.dispose()}}}function _A(){let x=new WeakMap;return{get:function(i){let l=x.get(i);return l===void 0&&(l={},x.set(i,l)),l},remove:function(i){x.delete(i)},update:function(i,l,h){x.get(i)[l]=h},dispose:function(){x=new WeakMap}}}function vA(x,i){return x.groupOrder!==i.groupOrder?x.groupOrder-i.groupOrder:x.renderOrder!==i.renderOrder?x.renderOrder-i.renderOrder:x.material.id!==i.material.id?x.material.id-i.material.id:x.z!==i.z?x.z-i.z:x.id-i.id}function nv(x,i){return x.groupOrder!==i.groupOrder?x.groupOrder-i.groupOrder:x.renderOrder!==i.renderOrder?x.renderOrder-i.renderOrder:x.z!==i.z?i.z-x.z:x.id-i.id}function AA(){const x=[];let i=0;const l=[],h=[],d=[];function g(v,b,T,I,N,z){let U=x[i];return U===void 0?(U={id:v.id,object:v,geometry:b,material:T,groupOrder:I,renderOrder:v.renderOrder,z:N,group:z},x[i]=U):(U.id=v.id,U.object=v,U.geometry=b,U.material=T,U.groupOrder=I,U.renderOrder=v.renderOrder,U.z=N,U.group=z),i++,U}return{opaque:l,transmissive:h,transparent:d,init:function(){i=0,l.length=0,h.length=0,d.length=0},push:function(v,b,T,I,N,z){const U=g(v,b,T,I,N,z);T.transmission>0?h.push(U):T.transparent===!0?d.push(U):l.push(U)},unshift:function(v,b,T,I,N,z){const U=g(v,b,T,I,N,z);T.transmission>0?h.unshift(U):T.transparent===!0?d.unshift(U):l.unshift(U)},finish:function(){for(let v=i,b=x.length;v<b;v++){const T=x[v];if(T.id===null)break;T.id=null,T.object=null,T.geometry=null,T.material=null,T.group=null}},sort:function(v,b){l.length>1&&l.sort(v||vA),h.length>1&&h.sort(b||nv),d.length>1&&d.sort(b||nv)}}}function iv(){let x=new WeakMap;return{get:function(i,l){const h=x.get(i);let d;return h===void 0?(d=new AA,x.set(i,[d])):l>=h.length?(d=new AA,h.push(d)):d=h[l],d},dispose:function(){x=new WeakMap}}}function rv(){const x={};return{get:function(i){if(x[i.id]!==void 0)return x[i.id];let l;switch(i.type){case"DirectionalLight":l={direction:new Re,color:new bn};break;case"SpotLight":l={position:new Re,direction:new Re,color:new bn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":l={position:new Re,color:new bn,distance:0,decay:0};break;case"HemisphereLight":l={direction:new Re,skyColor:new bn,groundColor:new bn};break;case"RectAreaLight":l={color:new bn,position:new Re,halfWidth:new Re,halfHeight:new Re}}return x[i.id]=l,l}}}let tf=0;function Xm(x,i){return(i.castShadow?2:0)-(x.castShadow?2:0)+(i.map?1:0)-(x.map?1:0)}function yA(x,i){const l=new rv,h=function(){const T={};return{get:function(I){if(T[I.id]!==void 0)return T[I.id];let N;switch(I.type){case"DirectionalLight":case"SpotLight":N={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt};break;case"PointLight":N={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xt,shadowCameraNear:1,shadowCameraFar:1e3}}return T[I.id]=N,N}}}(),d={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let T=0;T<9;T++)d.probe.push(new Re);const g=new Re,v=new ti,b=new ti;return{setup:function(T,I){let N=0,z=0,U=0;for(let lt=0;lt<9;lt++)d.probe[lt].set(0,0,0);let Q=0,Y=0,H=0,ne=0,ie=0,re=0,ve=0,Ee=0,Me=0,Pe=0;T.sort(Xm);const Ye=I!==!0?Math.PI:1;for(let lt=0,ut=T.length;lt<ut;lt++){const Ze=T[lt],Ft=Ze.color,$t=Ze.intensity,Lt=Ze.distance,an=Ze.shadow&&Ze.shadow.map?Ze.shadow.map.texture:null;if(Ze.isAmbientLight)N+=Ft.r*$t*Ye,z+=Ft.g*$t*Ye,U+=Ft.b*$t*Ye;else if(Ze.isLightProbe)for(let ln=0;ln<9;ln++)d.probe[ln].addScaledVector(Ze.sh.coefficients[ln],$t);else if(Ze.isDirectionalLight){const ln=l.get(Ze);if(ln.color.copy(Ze.color).multiplyScalar(Ze.intensity*Ye),Ze.castShadow){const Ct=Ze.shadow,Dt=h.get(Ze);Dt.shadowBias=Ct.bias,Dt.shadowNormalBias=Ct.normalBias,Dt.shadowRadius=Ct.radius,Dt.shadowMapSize=Ct.mapSize,d.directionalShadow[Q]=Dt,d.directionalShadowMap[Q]=an,d.directionalShadowMatrix[Q]=Ze.shadow.matrix,re++}d.directional[Q]=ln,Q++}else if(Ze.isSpotLight){const ln=l.get(Ze);ln.position.setFromMatrixPosition(Ze.matrixWorld),ln.color.copy(Ft).multiplyScalar($t*Ye),ln.distance=Lt,ln.coneCos=Math.cos(Ze.angle),ln.penumbraCos=Math.cos(Ze.angle*(1-Ze.penumbra)),ln.decay=Ze.decay,d.spot[H]=ln;const Ct=Ze.shadow;if(Ze.map&&(d.spotLightMap[Me]=Ze.map,Me++,Ct.updateMatrices(Ze),Ze.castShadow&&Pe++),d.spotLightMatrix[H]=Ct.matrix,Ze.castShadow){const Dt=h.get(Ze);Dt.shadowBias=Ct.bias,Dt.shadowNormalBias=Ct.normalBias,Dt.shadowRadius=Ct.radius,Dt.shadowMapSize=Ct.mapSize,d.spotShadow[H]=Dt,d.spotShadowMap[H]=an,Ee++}H++}else if(Ze.isRectAreaLight){const ln=l.get(Ze);ln.color.copy(Ft).multiplyScalar($t),ln.halfWidth.set(.5*Ze.width,0,0),ln.halfHeight.set(0,.5*Ze.height,0),d.rectArea[ne]=ln,ne++}else if(Ze.isPointLight){const ln=l.get(Ze);if(ln.color.copy(Ze.color).multiplyScalar(Ze.intensity*Ye),ln.distance=Ze.distance,ln.decay=Ze.decay,Ze.castShadow){const Ct=Ze.shadow,Dt=h.get(Ze);Dt.shadowBias=Ct.bias,Dt.shadowNormalBias=Ct.normalBias,Dt.shadowRadius=Ct.radius,Dt.shadowMapSize=Ct.mapSize,Dt.shadowCameraNear=Ct.camera.near,Dt.shadowCameraFar=Ct.camera.far,d.pointShadow[Y]=Dt,d.pointShadowMap[Y]=an,d.pointShadowMatrix[Y]=Ze.shadow.matrix,ve++}d.point[Y]=ln,Y++}else if(Ze.isHemisphereLight){const ln=l.get(Ze);ln.skyColor.copy(Ze.color).multiplyScalar($t*Ye),ln.groundColor.copy(Ze.groundColor).multiplyScalar($t*Ye),d.hemi[ie]=ln,ie++}}ne>0&&(i.isWebGL2||x.has("OES_texture_float_linear")===!0?(d.rectAreaLTC1=fn.LTC_FLOAT_1,d.rectAreaLTC2=fn.LTC_FLOAT_2):x.has("OES_texture_half_float_linear")===!0?(d.rectAreaLTC1=fn.LTC_HALF_1,d.rectAreaLTC2=fn.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),d.ambient[0]=N,d.ambient[1]=z,d.ambient[2]=U;const Ke=d.hash;Ke.directionalLength===Q&&Ke.pointLength===Y&&Ke.spotLength===H&&Ke.rectAreaLength===ne&&Ke.hemiLength===ie&&Ke.numDirectionalShadows===re&&Ke.numPointShadows===ve&&Ke.numSpotShadows===Ee&&Ke.numSpotMaps===Me||(d.directional.length=Q,d.spot.length=H,d.rectArea.length=ne,d.point.length=Y,d.hemi.length=ie,d.directionalShadow.length=re,d.directionalShadowMap.length=re,d.pointShadow.length=ve,d.pointShadowMap.length=ve,d.spotShadow.length=Ee,d.spotShadowMap.length=Ee,d.directionalShadowMatrix.length=re,d.pointShadowMatrix.length=ve,d.spotLightMatrix.length=Ee+Me-Pe,d.spotLightMap.length=Me,d.numSpotLightShadowsWithMaps=Pe,Ke.directionalLength=Q,Ke.pointLength=Y,Ke.spotLength=H,Ke.rectAreaLength=ne,Ke.hemiLength=ie,Ke.numDirectionalShadows=re,Ke.numPointShadows=ve,Ke.numSpotShadows=Ee,Ke.numSpotMaps=Me,d.version=tf++)},setupView:function(T,I){let N=0,z=0,U=0,Q=0,Y=0;const H=I.matrixWorldInverse;for(let ne=0,ie=T.length;ne<ie;ne++){const re=T[ne];if(re.isDirectionalLight){const ve=d.directional[N];ve.direction.setFromMatrixPosition(re.matrixWorld),g.setFromMatrixPosition(re.target.matrixWorld),ve.direction.sub(g),ve.direction.transformDirection(H),N++}else if(re.isSpotLight){const ve=d.spot[U];ve.position.setFromMatrixPosition(re.matrixWorld),ve.position.applyMatrix4(H),ve.direction.setFromMatrixPosition(re.matrixWorld),g.setFromMatrixPosition(re.target.matrixWorld),ve.direction.sub(g),ve.direction.transformDirection(H),U++}else if(re.isRectAreaLight){const ve=d.rectArea[Q];ve.position.setFromMatrixPosition(re.matrixWorld),ve.position.applyMatrix4(H),b.identity(),v.copy(re.matrixWorld),v.premultiply(H),b.extractRotation(v),ve.halfWidth.set(.5*re.width,0,0),ve.halfHeight.set(0,.5*re.height,0),ve.halfWidth.applyMatrix4(b),ve.halfHeight.applyMatrix4(b),Q++}else if(re.isPointLight){const ve=d.point[z];ve.position.setFromMatrixPosition(re.matrixWorld),ve.position.applyMatrix4(H),z++}else if(re.isHemisphereLight){const ve=d.hemi[Y];ve.direction.setFromMatrixPosition(re.matrixWorld),ve.direction.transformDirection(H),Y++}}},state:d}}function Km(x,i){const l=new yA(x,i),h=[],d=[];return{init:function(){h.length=0,d.length=0},state:{lightsArray:h,shadowsArray:d,lights:l},setupLights:function(g){l.setup(h,g)},setupLightsView:function(g){l.setupView(h,g)},pushLight:function(g){h.push(g)},pushShadow:function(g){d.push(g)}}}function bA(x,i){let l=new WeakMap;return{get:function(h,d=0){const g=l.get(h);let v;return g===void 0?(v=new Km(x,i),l.set(h,[v])):d>=g.length?(v=new Km(x,i),g.push(v)):v=g[d],v},dispose:function(){l=new WeakMap}}}class nf extends Bs{constructor(i){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=io,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(i)}copy(i){return super.copy(i),this.depthPacking=i.depthPacking,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this}}class qd extends Bs{constructor(i){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new Re,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(i)}copy(i){return super.copy(i),this.referencePosition.copy(i.referencePosition),this.nearDistance=i.nearDistance,this.farDistance=i.farDistance,this.map=i.map,this.alphaMap=i.alphaMap,this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this}}function wA(x,i,l){let h=new Wp;const d=new Xt,g=new Xt,v=new Zi,b=new nf({depthPacking:Cu}),T=new qd,I={},N=l.maxTextureSize,z={0:$,1:me,2:_e},U=new wl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xt},radius:{value:4}},vertexShader:`void main() {
	gl_Position = vec4( position, 1.0 );
}`,fragmentShader:`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`}),Q=U.clone();Q.defines.HORIZONTAL_PASS=1;const Y=new In;Y.setAttribute("position",new mr(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const H=new ks(Y,U),ne=this;function ie(Ee,Me){const Pe=i.update(H);U.defines.VSM_SAMPLES!==Ee.blurSamples&&(U.defines.VSM_SAMPLES=Ee.blurSamples,Q.defines.VSM_SAMPLES=Ee.blurSamples,U.needsUpdate=!0,Q.needsUpdate=!0),Ee.mapPass===null&&(Ee.mapPass=new bo(d.x,d.y)),U.uniforms.shadow_pass.value=Ee.map.texture,U.uniforms.resolution.value=Ee.mapSize,U.uniforms.radius.value=Ee.radius,x.setRenderTarget(Ee.mapPass),x.clear(),x.renderBufferDirect(Me,null,Pe,U,H,null),Q.uniforms.shadow_pass.value=Ee.mapPass.texture,Q.uniforms.resolution.value=Ee.mapSize,Q.uniforms.radius.value=Ee.radius,x.setRenderTarget(Ee.map),x.clear(),x.renderBufferDirect(Me,null,Pe,Q,H,null)}function re(Ee,Me,Pe,Ye,Ke,lt){let ut=null;const Ze=Pe.isPointLight===!0?Ee.customDistanceMaterial:Ee.customDepthMaterial;if(ut=Ze!==void 0?Ze:Pe.isPointLight===!0?T:b,x.localClippingEnabled&&Me.clipShadows===!0&&Array.isArray(Me.clippingPlanes)&&Me.clippingPlanes.length!==0||Me.displacementMap&&Me.displacementScale!==0||Me.alphaMap&&Me.alphaTest>0){const Ft=ut.uuid,$t=Me.uuid;let Lt=I[Ft];Lt===void 0&&(Lt={},I[Ft]=Lt);let an=Lt[$t];an===void 0&&(an=ut.clone(),Lt[$t]=an),ut=an}return ut.visible=Me.visible,ut.wireframe=Me.wireframe,ut.side=lt===le?Me.shadowSide!==null?Me.shadowSide:Me.side:Me.shadowSide!==null?Me.shadowSide:z[Me.side],ut.alphaMap=Me.alphaMap,ut.alphaTest=Me.alphaTest,ut.clipShadows=Me.clipShadows,ut.clippingPlanes=Me.clippingPlanes,ut.clipIntersection=Me.clipIntersection,ut.displacementMap=Me.displacementMap,ut.displacementScale=Me.displacementScale,ut.displacementBias=Me.displacementBias,ut.wireframeLinewidth=Me.wireframeLinewidth,ut.linewidth=Me.linewidth,Pe.isPointLight===!0&&ut.isMeshDistanceMaterial===!0&&(ut.referencePosition.setFromMatrixPosition(Pe.matrixWorld),ut.nearDistance=Ye,ut.farDistance=Ke),ut}function ve(Ee,Me,Pe,Ye,Ke){if(Ee.visible===!1)return;if(Ee.layers.test(Me.layers)&&(Ee.isMesh||Ee.isLine||Ee.isPoints)&&(Ee.castShadow||Ee.receiveShadow&&Ke===le)&&(!Ee.frustumCulled||h.intersectsObject(Ee))){Ee.modelViewMatrix.multiplyMatrices(Pe.matrixWorldInverse,Ee.matrixWorld);const ut=i.update(Ee),Ze=Ee.material;if(Array.isArray(Ze)){const Ft=ut.groups;for(let $t=0,Lt=Ft.length;$t<Lt;$t++){const an=Ft[$t],ln=Ze[an.materialIndex];if(ln&&ln.visible){const Ct=re(Ee,ln,Ye,Pe.near,Pe.far,Ke);x.renderBufferDirect(Pe,null,ut,Ct,Ee,an)}}}else if(Ze.visible){const Ft=re(Ee,Ze,Ye,Pe.near,Pe.far,Ke);x.renderBufferDirect(Pe,null,ut,Ft,Ee,null)}}const lt=Ee.children;for(let ut=0,Ze=lt.length;ut<Ze;ut++)ve(lt[ut],Me,Pe,Ye,Ke)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=fe,this.render=function(Ee,Me,Pe){if(ne.enabled===!1||ne.autoUpdate===!1&&ne.needsUpdate===!1||Ee.length===0)return;const Ye=x.getRenderTarget(),Ke=x.getActiveCubeFace(),lt=x.getActiveMipmapLevel(),ut=x.state;ut.setBlending(oe),ut.buffers.color.setClear(1,1,1,1),ut.buffers.depth.setTest(!0),ut.setScissorTest(!1);for(let Ze=0,Ft=Ee.length;Ze<Ft;Ze++){const $t=Ee[Ze],Lt=$t.shadow;if(Lt===void 0){console.warn("THREE.WebGLShadowMap:",$t,"has no shadow.");continue}if(Lt.autoUpdate===!1&&Lt.needsUpdate===!1)continue;d.copy(Lt.mapSize);const an=Lt.getFrameExtents();if(d.multiply(an),g.copy(Lt.mapSize),(d.x>N||d.y>N)&&(d.x>N&&(g.x=Math.floor(N/an.x),d.x=g.x*an.x,Lt.mapSize.x=g.x),d.y>N&&(g.y=Math.floor(N/an.y),d.y=g.y*an.y,Lt.mapSize.y=g.y)),Lt.map===null){const Ct=this.type!==le?{minFilter:ar,magFilter:ar}:{};Lt.map=new bo(d.x,d.y,Ct),Lt.map.texture.name=$t.name+".shadowMap",Lt.camera.updateProjectionMatrix()}x.setRenderTarget(Lt.map),x.clear();const ln=Lt.getViewportCount();for(let Ct=0;Ct<ln;Ct++){const Dt=Lt.getViewport(Ct);v.set(g.x*Dt.x,g.y*Dt.y,g.x*Dt.z,g.y*Dt.w),ut.viewport(v),Lt.updateMatrices($t,Ct),h=Lt.getFrustum(),ve(Me,Pe,Lt.camera,$t,this.type)}Lt.isPointLightShadow!==!0&&this.type===le&&ie(Lt,Pe),Lt.needsUpdate=!1}ne.needsUpdate=!1,x.setRenderTarget(Ye,Ke,lt)}}function sv(x,i,l){const h=l.isWebGL2,d=new function(){let Ae=!1;const It=new Zi;let dt=null;const Nt=new Zi(0,0,0,0);return{setMask:function(Gt){dt===Gt||Ae||(x.colorMask(Gt,Gt,Gt,Gt),dt=Gt)},setLocked:function(Gt){Ae=Gt},setClear:function(Gt,pn,Un,Jn,fi){fi===!0&&(Gt*=Jn,pn*=Jn,Un*=Jn),It.set(Gt,pn,Un,Jn),Nt.equals(It)===!1&&(x.clearColor(Gt,pn,Un,Jn),Nt.copy(It))},reset:function(){Ae=!1,dt=null,Nt.set(-1,0,0,0)}}},g=new function(){let Ae=!1,It=null,dt=null,Nt=null;return{setTest:function(Gt){Gt?Fn(2929):yi(2929)},setMask:function(Gt){It===Gt||Ae||(x.depthMask(Gt),It=Gt)},setFunc:function(Gt){if(dt!==Gt){if(Gt)switch(Gt){case jt:x.depthFunc(512);break;case rt:x.depthFunc(519);break;case pe:x.depthFunc(513);break;case be:x.depthFunc(515);break;case Xe:x.depthFunc(514);break;case zt:x.depthFunc(518);break;case Wt:x.depthFunc(516);break;case qt:x.depthFunc(517);break;default:x.depthFunc(515)}else x.depthFunc(515);dt=Gt}},setLocked:function(Gt){Ae=Gt},setClear:function(Gt){Nt!==Gt&&(x.clearDepth(Gt),Nt=Gt)},reset:function(){Ae=!1,It=null,dt=null,Nt=null}}},v=new function(){let Ae=!1,It=null,dt=null,Nt=null,Gt=null,pn=null,Un=null,Jn=null,fi=null;return{setTest:function(Yn){Ae||(Yn?Fn(2960):yi(2960))},setMask:function(Yn){It===Yn||Ae||(x.stencilMask(Yn),It=Yn)},setFunc:function(Yn,$n,hr){dt===Yn&&Nt===$n&&Gt===hr||(x.stencilFunc(Yn,$n,hr),dt=Yn,Nt=$n,Gt=hr)},setOp:function(Yn,$n,hr){pn===Yn&&Un===$n&&Jn===hr||(x.stencilOp(Yn,$n,hr),pn=Yn,Un=$n,Jn=hr)},setLocked:function(Yn){Ae=Yn},setClear:function(Yn){fi!==Yn&&(x.clearStencil(Yn),fi=Yn)},reset:function(){Ae=!1,It=null,dt=null,Nt=null,Gt=null,pn=null,Un=null,Jn=null,fi=null}}},b=new WeakMap,T=new WeakMap;let I={},N={},z=new WeakMap,U=[],Q=null,Y=!1,H=null,ne=null,ie=null,re=null,ve=null,Ee=null,Me=null,Pe=!1,Ye=null,Ke=null,lt=null,ut=null,Ze=null;const Ft=x.getParameter(35661);let $t=!1,Lt=0;const an=x.getParameter(7938);an.indexOf("WebGL")!==-1?(Lt=parseFloat(/^WebGL (\d)/.exec(an)[1]),$t=Lt>=1):an.indexOf("OpenGL ES")!==-1&&(Lt=parseFloat(/^OpenGL ES (\d)/.exec(an)[1]),$t=Lt>=2);let ln=null,Ct={};const Dt=x.getParameter(3088),nn=x.getParameter(2978),Ut=new Zi().fromArray(Dt),on=new Zi().fromArray(nn);function On(Ae,It,dt){const Nt=new Uint8Array(4),Gt=x.createTexture();x.bindTexture(Ae,Gt),x.texParameteri(Ae,10241,9728),x.texParameteri(Ae,10240,9728);for(let pn=0;pn<dt;pn++)x.texImage2D(It+pn,0,6408,1,1,0,6408,5121,Nt);return Gt}const Ti={};function Fn(Ae){I[Ae]!==!0&&(x.enable(Ae),I[Ae]=!0)}function yi(Ae){I[Ae]!==!1&&(x.disable(Ae),I[Ae]=!1)}Ti[3553]=On(3553,3553,1),Ti[34067]=On(34067,34069,6),d.setClear(0,0,0,1),g.setClear(1),v.setClear(0),Fn(2929),g.setFunc(be),at(!1),We(G),Fn(2884),mt(oe);const He={[Z]:32774,[se]:32778,[ae]:32779};if(h)He[Be]=32775,He[we]=32776;else{const Ae=i.get("EXT_blend_minmax");Ae!==null&&(He[Be]=Ae.MIN_EXT,He[we]=Ae.MAX_EXT)}const Ue={[tt]:0,[St]:1,[_t]:768,[ct]:770,[ft]:776,[Ie]:774,[At]:772,[xt]:769,[Ot]:771,[vt]:775,[Pt]:773};function mt(Ae,It,dt,Nt,Gt,pn,Un,Jn){if(Ae!==oe){if(Y===!1&&(Fn(3042),Y=!0),Ae===Ne)Gt=Gt||It,pn=pn||dt,Un=Un||Nt,It===ne&&Gt===ve||(x.blendEquationSeparate(He[It],He[Gt]),ne=It,ve=Gt),dt===ie&&Nt===re&&pn===Ee&&Un===Me||(x.blendFuncSeparate(Ue[dt],Ue[Nt],Ue[pn],Ue[Un]),ie=dt,re=Nt,Ee=pn,Me=Un),H=Ae,Pe=null;else if(Ae!==H||Jn!==Pe){if(ne===Z&&ve===Z||(x.blendEquation(32774),ne=Z,ve=Z),Jn)switch(Ae){case ge:x.blendFuncSeparate(1,771,1,771);break;case Se:x.blendFunc(1,1);break;case je:x.blendFuncSeparate(0,769,0,1);break;case ye:x.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae)}else switch(Ae){case ge:x.blendFuncSeparate(770,771,1,771);break;case Se:x.blendFunc(770,1);break;case je:x.blendFuncSeparate(0,769,0,1);break;case ye:x.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ae)}ie=null,re=null,Ee=null,Me=null,H=Ae,Pe=Jn}}else Y===!0&&(yi(3042),Y=!1)}function at(Ae){Ye!==Ae&&(Ae?x.frontFace(2304):x.frontFace(2305),Ye=Ae)}function We(Ae){Ae!==F?(Fn(2884),Ae!==Ke&&(Ae===G?x.cullFace(1029):Ae===X?x.cullFace(1028):x.cullFace(1032))):yi(2884),Ke=Ae}function st(Ae,It,dt){Ae?(Fn(32823),ut===It&&Ze===dt||(x.polygonOffset(It,dt),ut=It,Ze=dt)):yi(32823)}function Tt(Ae){Ae===void 0&&(Ae=33984+Ft-1),ln!==Ae&&(x.activeTexture(Ae),ln=Ae)}return{buffers:{color:d,depth:g,stencil:v},enable:Fn,disable:yi,bindFramebuffer:function(Ae,It){return N[Ae]!==It&&(x.bindFramebuffer(Ae,It),N[Ae]=It,h&&(Ae===36009&&(N[36160]=It),Ae===36160&&(N[36009]=It)),!0)},drawBuffers:function(Ae,It){let dt=U,Nt=!1;if(Ae)if(dt=z.get(It),dt===void 0&&(dt=[],z.set(It,dt)),Ae.isWebGLMultipleRenderTargets){const Gt=Ae.texture;if(dt.length!==Gt.length||dt[0]!==36064){for(let pn=0,Un=Gt.length;pn<Un;pn++)dt[pn]=36064+pn;dt.length=Gt.length,Nt=!0}}else dt[0]!==36064&&(dt[0]=36064,Nt=!0);else dt[0]!==1029&&(dt[0]=1029,Nt=!0);Nt&&(l.isWebGL2?x.drawBuffers(dt):i.get("WEBGL_draw_buffers").drawBuffersWEBGL(dt))},useProgram:function(Ae){return Q!==Ae&&(x.useProgram(Ae),Q=Ae,!0)},setBlending:mt,setMaterial:function(Ae,It){Ae.side===_e?yi(2884):Fn(2884);let dt=Ae.side===$;It&&(dt=!dt),at(dt),Ae.blending===ge&&Ae.transparent===!1?mt(oe):mt(Ae.blending,Ae.blendEquation,Ae.blendSrc,Ae.blendDst,Ae.blendEquationAlpha,Ae.blendSrcAlpha,Ae.blendDstAlpha,Ae.premultipliedAlpha),g.setFunc(Ae.depthFunc),g.setTest(Ae.depthTest),g.setMask(Ae.depthWrite),d.setMask(Ae.colorWrite);const Nt=Ae.stencilWrite;v.setTest(Nt),Nt&&(v.setMask(Ae.stencilWriteMask),v.setFunc(Ae.stencilFunc,Ae.stencilRef,Ae.stencilFuncMask),v.setOp(Ae.stencilFail,Ae.stencilZFail,Ae.stencilZPass)),st(Ae.polygonOffset,Ae.polygonOffsetFactor,Ae.polygonOffsetUnits),Ae.alphaToCoverage===!0?Fn(32926):yi(32926)},setFlipSided:at,setCullFace:We,setLineWidth:function(Ae){Ae!==lt&&($t&&x.lineWidth(Ae),lt=Ae)},setPolygonOffset:st,setScissorTest:function(Ae){Ae?Fn(3089):yi(3089)},activeTexture:Tt,bindTexture:function(Ae,It){ln===null&&Tt();let dt=Ct[ln];dt===void 0&&(dt={type:void 0,texture:void 0},Ct[ln]=dt),dt.type===Ae&&dt.texture===It||(x.bindTexture(Ae,It||Ti[Ae]),dt.type=Ae,dt.texture=It)},unbindTexture:function(){const Ae=Ct[ln];Ae!==void 0&&Ae.type!==void 0&&(x.bindTexture(Ae.type,null),Ae.type=void 0,Ae.texture=void 0)},compressedTexImage2D:function(){try{x.compressedTexImage2D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},texImage2D:function(){try{x.texImage2D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},texImage3D:function(){try{x.texImage3D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},updateUBOMapping:function(Ae,It){let dt=T.get(It);dt===void 0&&(dt=new WeakMap,T.set(It,dt));let Nt=dt.get(Ae);Nt===void 0&&(Nt=x.getUniformBlockIndex(It,Ae.name),dt.set(Ae,Nt))},uniformBlockBinding:function(Ae,It){const dt=T.get(It).get(Ae);b.get(Ae)!==dt&&(x.uniformBlockBinding(It,dt,Ae.__bindingPointIndex),b.set(Ae,dt))},texStorage2D:function(){try{x.texStorage2D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},texStorage3D:function(){try{x.texStorage3D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},texSubImage2D:function(){try{x.texSubImage2D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},texSubImage3D:function(){try{x.texSubImage3D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},compressedTexSubImage2D:function(){try{x.compressedTexSubImage2D.apply(x,arguments)}catch(Ae){console.error("THREE.WebGLState:",Ae)}},scissor:function(Ae){Ut.equals(Ae)===!1&&(x.scissor(Ae.x,Ae.y,Ae.z,Ae.w),Ut.copy(Ae))},viewport:function(Ae){on.equals(Ae)===!1&&(x.viewport(Ae.x,Ae.y,Ae.z,Ae.w),on.copy(Ae))},reset:function(){x.disable(3042),x.disable(2884),x.disable(2929),x.disable(32823),x.disable(3089),x.disable(2960),x.disable(32926),x.blendEquation(32774),x.blendFunc(1,0),x.blendFuncSeparate(1,0,1,0),x.colorMask(!0,!0,!0,!0),x.clearColor(0,0,0,0),x.depthMask(!0),x.depthFunc(513),x.clearDepth(1),x.stencilMask(4294967295),x.stencilFunc(519,0,4294967295),x.stencilOp(7680,7680,7680),x.clearStencil(0),x.cullFace(1029),x.frontFace(2305),x.polygonOffset(0,0),x.activeTexture(33984),x.bindFramebuffer(36160,null),h===!0&&(x.bindFramebuffer(36009,null),x.bindFramebuffer(36008,null)),x.useProgram(null),x.lineWidth(1),x.scissor(0,0,x.canvas.width,x.canvas.height),x.viewport(0,0,x.canvas.width,x.canvas.height),I={},ln=null,Ct={},N={},z=new WeakMap,U=[],Q=null,Y=!1,H=null,ne=null,ie=null,re=null,ve=null,Ee=null,Me=null,Pe=!1,Ye=null,Ke=null,lt=null,ut=null,Ze=null,Ut.set(0,0,x.canvas.width,x.canvas.height),on.set(0,0,x.canvas.width,x.canvas.height),d.reset(),g.reset(),v.reset()}}}function ov(x,i,l,h,d,g,v){const b=d.isWebGL2,T=d.maxTextures,I=d.maxCubemapSize,N=d.maxTextureSize,z=d.maxSamples,U=i.has("WEBGL_multisampled_render_to_texture")?i.get("WEBGL_multisampled_render_to_texture"):null,Q=/OculusBrowser/g.test(navigator.userAgent),Y=new WeakMap;let H;const ne=new WeakMap;let ie=!1;try{ie=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function re(He,Ue){return ie?new OffscreenCanvas(He,Ue):Nc("canvas")}function ve(He,Ue,mt,at){let We=1;if((He.width>at||He.height>at)&&(We=at/Math.max(He.width,He.height)),We<1||Ue===!0){if(typeof HTMLImageElement<"u"&&He instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&He instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&He instanceof ImageBitmap){const st=Ue?ro:Math.floor,Tt=st(We*He.width),Ae=st(We*He.height);H===void 0&&(H=re(Tt,Ae));const It=mt?re(Tt,Ae):H;return It.width=Tt,It.height=Ae,It.getContext("2d").drawImage(He,0,0,Tt,Ae),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+He.width+"x"+He.height+") to ("+Tt+"x"+Ae+")."),It}return"data"in He&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+He.width+"x"+He.height+")."),He}return He}function Ee(He){return Dh(He.width)&&Dh(He.height)}function Me(He,Ue){return He.generateMipmaps&&Ue&&He.minFilter!==ar&&He.minFilter!==nr}function Pe(He){x.generateMipmap(He)}function Ye(He,Ue,mt,at,We=!1){if(b===!1)return Ue;if(He!==null){if(x[He]!==void 0)return x[He];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+He+"'")}let st=Ue;return Ue===6403&&(mt===5126&&(st=33326),mt===5131&&(st=33325),mt===5121&&(st=33321)),Ue===33319&&(mt===5126&&(st=33328),mt===5131&&(st=33327),mt===5121&&(st=33323)),Ue===6408&&(mt===5126&&(st=34836),mt===5131&&(st=34842),mt===5121&&(st=at===Mi&&We===!1?35907:32856),mt===32819&&(st=32854),mt===32820&&(st=32855)),st!==33325&&st!==33326&&st!==33327&&st!==33328&&st!==34842&&st!==34836||i.get("EXT_color_buffer_float"),st}function Ke(He,Ue,mt){return Me(He,mt)===!0||He.isFramebufferTexture&&He.minFilter!==ar&&He.minFilter!==nr?Math.log2(Math.max(Ue.width,Ue.height))+1:He.mipmaps!==void 0&&He.mipmaps.length>0?He.mipmaps.length:He.isCompressedTexture&&Array.isArray(He.image)?Ue.mipmaps.length:1}function lt(He){return He===ar||He===Ki||He===lr?9728:9729}function ut(He){const Ue=He.target;Ue.removeEventListener("dispose",ut),function(mt){const at=h.get(mt);if(at.__webglInit===void 0)return;const We=mt.source,st=ne.get(We);if(st){const Tt=st[at.__cacheKey];Tt.usedTimes--,Tt.usedTimes===0&&Ft(mt),Object.keys(st).length===0&&ne.delete(We)}h.remove(mt)}(Ue),Ue.isVideoTexture&&Y.delete(Ue)}function Ze(He){const Ue=He.target;Ue.removeEventListener("dispose",Ze),function(mt){const at=mt.texture,We=h.get(mt),st=h.get(at);if(st.__webglTexture!==void 0&&(x.deleteTexture(st.__webglTexture),v.memory.textures--),mt.depthTexture&&mt.depthTexture.dispose(),mt.isWebGLCubeRenderTarget)for(let Tt=0;Tt<6;Tt++)x.deleteFramebuffer(We.__webglFramebuffer[Tt]),We.__webglDepthbuffer&&x.deleteRenderbuffer(We.__webglDepthbuffer[Tt]);else{if(x.deleteFramebuffer(We.__webglFramebuffer),We.__webglDepthbuffer&&x.deleteRenderbuffer(We.__webglDepthbuffer),We.__webglMultisampledFramebuffer&&x.deleteFramebuffer(We.__webglMultisampledFramebuffer),We.__webglColorRenderbuffer)for(let Tt=0;Tt<We.__webglColorRenderbuffer.length;Tt++)We.__webglColorRenderbuffer[Tt]&&x.deleteRenderbuffer(We.__webglColorRenderbuffer[Tt]);We.__webglDepthRenderbuffer&&x.deleteRenderbuffer(We.__webglDepthRenderbuffer)}if(mt.isWebGLMultipleRenderTargets)for(let Tt=0,Ae=at.length;Tt<Ae;Tt++){const It=h.get(at[Tt]);It.__webglTexture&&(x.deleteTexture(It.__webglTexture),v.memory.textures--),h.remove(at[Tt])}h.remove(at),h.remove(mt)}(Ue)}function Ft(He){const Ue=h.get(He);x.deleteTexture(Ue.__webglTexture);const mt=He.source;delete ne.get(mt)[Ue.__cacheKey],v.memory.textures--}let $t=0;function Lt(He,Ue){const mt=h.get(He);if(He.isVideoTexture&&function(at){const We=v.render.frame;Y.get(at)!==We&&(Y.set(at,We),at.update())}(He),He.isRenderTargetTexture===!1&&He.version>0&&mt.__version!==He.version){const at=He.image;if(at===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(at.complete!==!1)return void nn(mt,He,Ue);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}l.activeTexture(33984+Ue),l.bindTexture(3553,mt.__webglTexture)}const an={[Di]:10497,[gi]:33071,[br]:33648},ln={[ar]:9728,[Ki]:9984,[lr]:9986,[nr]:9729,[Es]:9985,[Sn]:9987};function Ct(He,Ue,mt){if(mt?(x.texParameteri(He,10242,an[Ue.wrapS]),x.texParameteri(He,10243,an[Ue.wrapT]),He!==32879&&He!==35866||x.texParameteri(He,32882,an[Ue.wrapR]),x.texParameteri(He,10240,ln[Ue.magFilter]),x.texParameteri(He,10241,ln[Ue.minFilter])):(x.texParameteri(He,10242,33071),x.texParameteri(He,10243,33071),He!==32879&&He!==35866||x.texParameteri(He,32882,33071),Ue.wrapS===gi&&Ue.wrapT===gi||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),x.texParameteri(He,10240,lt(Ue.magFilter)),x.texParameteri(He,10241,lt(Ue.minFilter)),Ue.minFilter!==ar&&Ue.minFilter!==nr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),i.has("EXT_texture_filter_anisotropic")===!0){const at=i.get("EXT_texture_filter_anisotropic");if(Ue.type===_r&&i.has("OES_texture_float_linear")===!1||b===!1&&Ue.type===Gs&&i.has("OES_texture_half_float_linear")===!1)return;(Ue.anisotropy>1||h.get(Ue).__currentAnisotropy)&&(x.texParameterf(He,at.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(Ue.anisotropy,d.getMaxAnisotropy())),h.get(Ue).__currentAnisotropy=Ue.anisotropy)}}function Dt(He,Ue){let mt=!1;He.__webglInit===void 0&&(He.__webglInit=!0,Ue.addEventListener("dispose",ut));const at=Ue.source;let We=ne.get(at);We===void 0&&(We={},ne.set(at,We));const st=function(Tt){const Ae=[];return Ae.push(Tt.wrapS),Ae.push(Tt.wrapT),Ae.push(Tt.magFilter),Ae.push(Tt.minFilter),Ae.push(Tt.anisotropy),Ae.push(Tt.internalFormat),Ae.push(Tt.format),Ae.push(Tt.type),Ae.push(Tt.generateMipmaps),Ae.push(Tt.premultiplyAlpha),Ae.push(Tt.flipY),Ae.push(Tt.unpackAlignment),Ae.push(Tt.encoding),Ae.join()}(Ue);if(st!==He.__cacheKey){We[st]===void 0&&(We[st]={texture:x.createTexture(),usedTimes:0},v.memory.textures++,mt=!0),We[st].usedTimes++;const Tt=We[He.__cacheKey];Tt!==void 0&&(We[He.__cacheKey].usedTimes--,Tt.usedTimes===0&&Ft(Ue)),He.__cacheKey=st,He.__webglTexture=We[st].texture}return mt}function nn(He,Ue,mt){let at=3553;Ue.isDataArrayTexture&&(at=35866),Ue.isData3DTexture&&(at=32879);const We=Dt(He,Ue),st=Ue.source;if(l.activeTexture(33984+mt),l.bindTexture(at,He.__webglTexture),st.version!==st.__currentVersion||We===!0){x.pixelStorei(37440,Ue.flipY),x.pixelStorei(37441,Ue.premultiplyAlpha),x.pixelStorei(3317,Ue.unpackAlignment),x.pixelStorei(37443,0);const Tt=function($n){return!b&&($n.wrapS!==gi||$n.wrapT!==gi||$n.minFilter!==ar&&$n.minFilter!==nr)}(Ue)&&Ee(Ue.image)===!1;let Ae=ve(Ue.image,Tt,!1,N);Ae=yi(Ue,Ae);const It=Ee(Ae)||b,dt=g.convert(Ue.format,Ue.encoding);let Nt,Gt=g.convert(Ue.type),pn=Ye(Ue.internalFormat,dt,Gt,Ue.encoding,Ue.isVideoTexture);Ct(at,Ue,It);const Un=Ue.mipmaps,Jn=b&&Ue.isVideoTexture!==!0,fi=st.__currentVersion===void 0||We===!0,Yn=Ke(Ue,Ae,It);if(Ue.isDepthTexture)pn=6402,b?pn=Ue.type===_r?36012:Ue.type===et?33190:Ue.type===kt?35056:33189:Ue.type===_r&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),Ue.format===Hi&&pn===6402&&Ue.type!==Vs&&Ue.type!==et&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),Ue.type=et,Gt=g.convert(Ue.type)),Ue.format===rr&&pn===6402&&(pn=34041,Ue.type!==kt&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),Ue.type=kt,Gt=g.convert(Ue.type))),fi&&(Jn?l.texStorage2D(3553,1,pn,Ae.width,Ae.height):l.texImage2D(3553,0,pn,Ae.width,Ae.height,0,dt,Gt,null));else if(Ue.isDataTexture)if(Un.length>0&&It){Jn&&fi&&l.texStorage2D(3553,Yn,pn,Un[0].width,Un[0].height);for(let $n=0,hr=Un.length;$n<hr;$n++)Nt=Un[$n],Jn?l.texSubImage2D(3553,$n,0,0,Nt.width,Nt.height,dt,Gt,Nt.data):l.texImage2D(3553,$n,pn,Nt.width,Nt.height,0,dt,Gt,Nt.data);Ue.generateMipmaps=!1}else Jn?(fi&&l.texStorage2D(3553,Yn,pn,Ae.width,Ae.height),l.texSubImage2D(3553,0,0,0,Ae.width,Ae.height,dt,Gt,Ae.data)):l.texImage2D(3553,0,pn,Ae.width,Ae.height,0,dt,Gt,Ae.data);else if(Ue.isCompressedTexture){Jn&&fi&&l.texStorage2D(3553,Yn,pn,Un[0].width,Un[0].height);for(let $n=0,hr=Un.length;$n<hr;$n++)Nt=Un[$n],Ue.format!==Nn?dt!==null?Jn?l.compressedTexSubImage2D(3553,$n,0,0,Nt.width,Nt.height,dt,Nt.data):l.compressedTexImage2D(3553,$n,pn,Nt.width,Nt.height,0,Nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Jn?l.texSubImage2D(3553,$n,0,0,Nt.width,Nt.height,dt,Gt,Nt.data):l.texImage2D(3553,$n,pn,Nt.width,Nt.height,0,dt,Gt,Nt.data)}else if(Ue.isDataArrayTexture)Jn?(fi&&l.texStorage3D(35866,Yn,pn,Ae.width,Ae.height,Ae.depth),l.texSubImage3D(35866,0,0,0,0,Ae.width,Ae.height,Ae.depth,dt,Gt,Ae.data)):l.texImage3D(35866,0,pn,Ae.width,Ae.height,Ae.depth,0,dt,Gt,Ae.data);else if(Ue.isData3DTexture)Jn?(fi&&l.texStorage3D(32879,Yn,pn,Ae.width,Ae.height,Ae.depth),l.texSubImage3D(32879,0,0,0,0,Ae.width,Ae.height,Ae.depth,dt,Gt,Ae.data)):l.texImage3D(32879,0,pn,Ae.width,Ae.height,Ae.depth,0,dt,Gt,Ae.data);else if(Ue.isFramebufferTexture){if(fi)if(Jn)l.texStorage2D(3553,Yn,pn,Ae.width,Ae.height);else{let $n=Ae.width,hr=Ae.height;for(let Da=0;Da<Yn;Da++)l.texImage2D(3553,Da,pn,$n,hr,0,dt,Gt,null),$n>>=1,hr>>=1}}else if(Un.length>0&&It){Jn&&fi&&l.texStorage2D(3553,Yn,pn,Un[0].width,Un[0].height);for(let $n=0,hr=Un.length;$n<hr;$n++)Nt=Un[$n],Jn?l.texSubImage2D(3553,$n,0,0,dt,Gt,Nt):l.texImage2D(3553,$n,pn,dt,Gt,Nt);Ue.generateMipmaps=!1}else Jn?(fi&&l.texStorage2D(3553,Yn,pn,Ae.width,Ae.height),l.texSubImage2D(3553,0,0,0,dt,Gt,Ae)):l.texImage2D(3553,0,pn,dt,Gt,Ae);Me(Ue,It)&&Pe(at),st.__currentVersion=st.version,Ue.onUpdate&&Ue.onUpdate(Ue)}He.__version=Ue.version}function Ut(He,Ue,mt,at,We){const st=g.convert(mt.format,mt.encoding),Tt=g.convert(mt.type),Ae=Ye(mt.internalFormat,st,Tt,mt.encoding);h.get(Ue).__hasExternalTextures||(We===32879||We===35866?l.texImage3D(We,0,Ae,Ue.width,Ue.height,Ue.depth,0,st,Tt,null):l.texImage2D(We,0,Ae,Ue.width,Ue.height,0,st,Tt,null)),l.bindFramebuffer(36160,He),Fn(Ue)?U.framebufferTexture2DMultisampleEXT(36160,at,We,h.get(mt).__webglTexture,0,Ti(Ue)):x.framebufferTexture2D(36160,at,We,h.get(mt).__webglTexture,0),l.bindFramebuffer(36160,null)}function on(He,Ue,mt){if(x.bindRenderbuffer(36161,He),Ue.depthBuffer&&!Ue.stencilBuffer){let at=33189;if(mt||Fn(Ue)){const We=Ue.depthTexture;We&&We.isDepthTexture&&(We.type===_r?at=36012:We.type===et&&(at=33190));const st=Ti(Ue);Fn(Ue)?U.renderbufferStorageMultisampleEXT(36161,st,at,Ue.width,Ue.height):x.renderbufferStorageMultisample(36161,st,at,Ue.width,Ue.height)}else x.renderbufferStorage(36161,at,Ue.width,Ue.height);x.framebufferRenderbuffer(36160,36096,36161,He)}else if(Ue.depthBuffer&&Ue.stencilBuffer){const at=Ti(Ue);mt&&Fn(Ue)===!1?x.renderbufferStorageMultisample(36161,at,35056,Ue.width,Ue.height):Fn(Ue)?U.renderbufferStorageMultisampleEXT(36161,at,35056,Ue.width,Ue.height):x.renderbufferStorage(36161,34041,Ue.width,Ue.height),x.framebufferRenderbuffer(36160,33306,36161,He)}else{const at=Ue.isWebGLMultipleRenderTargets===!0?Ue.texture:[Ue.texture];for(let We=0;We<at.length;We++){const st=at[We],Tt=g.convert(st.format,st.encoding),Ae=g.convert(st.type),It=Ye(st.internalFormat,Tt,Ae,st.encoding),dt=Ti(Ue);mt&&Fn(Ue)===!1?x.renderbufferStorageMultisample(36161,dt,It,Ue.width,Ue.height):Fn(Ue)?U.renderbufferStorageMultisampleEXT(36161,dt,It,Ue.width,Ue.height):x.renderbufferStorage(36161,It,Ue.width,Ue.height)}}x.bindRenderbuffer(36161,null)}function On(He){const Ue=h.get(He),mt=He.isWebGLCubeRenderTarget===!0;if(He.depthTexture&&!Ue.__autoAllocateDepthBuffer){if(mt)throw new Error("target.depthTexture not supported in Cube render targets");(function(at,We){if(We&&We.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(l.bindFramebuffer(36160,at),!We.depthTexture||!We.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");h.get(We.depthTexture).__webglTexture&&We.depthTexture.image.width===We.width&&We.depthTexture.image.height===We.height||(We.depthTexture.image.width=We.width,We.depthTexture.image.height=We.height,We.depthTexture.needsUpdate=!0),Lt(We.depthTexture,0);const st=h.get(We.depthTexture).__webglTexture,Tt=Ti(We);if(We.depthTexture.format===Hi)Fn(We)?U.framebufferTexture2DMultisampleEXT(36160,36096,3553,st,0,Tt):x.framebufferTexture2D(36160,36096,3553,st,0);else{if(We.depthTexture.format!==rr)throw new Error("Unknown depthTexture format");Fn(We)?U.framebufferTexture2DMultisampleEXT(36160,33306,3553,st,0,Tt):x.framebufferTexture2D(36160,33306,3553,st,0)}})(Ue.__webglFramebuffer,He)}else if(mt){Ue.__webglDepthbuffer=[];for(let at=0;at<6;at++)l.bindFramebuffer(36160,Ue.__webglFramebuffer[at]),Ue.__webglDepthbuffer[at]=x.createRenderbuffer(),on(Ue.__webglDepthbuffer[at],He,!1)}else l.bindFramebuffer(36160,Ue.__webglFramebuffer),Ue.__webglDepthbuffer=x.createRenderbuffer(),on(Ue.__webglDepthbuffer,He,!1);l.bindFramebuffer(36160,null)}function Ti(He){return Math.min(z,He.samples)}function Fn(He){const Ue=h.get(He);return b&&He.samples>0&&i.has("WEBGL_multisampled_render_to_texture")===!0&&Ue.__useRenderToTexture!==!1}function yi(He,Ue){const mt=He.encoding,at=He.format,We=He.type;return He.isCompressedTexture===!0||He.isVideoTexture===!0||He.format===Cd||mt!==Aa&&(mt===Mi?b===!1?i.has("EXT_sRGB")===!0&&at===Nn?(He.format=Cd,He.minFilter=nr,He.generateMipmaps=!1):Ue=Bh.sRGBToLinear(Ue):at===Nn&&We===qr||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):mt===RGBM16Encoding||console.error("THREE.WebGLTextures: Unsupported texture encoding:",mt)),Ue}this.allocateTextureUnit=function(){const He=$t;return He>=T&&console.warn("THREE.WebGLTextures: Trying to use "+He+" texture units while this GPU supports only "+T),$t+=1,He},this.resetTextureUnits=function(){$t=0},this.setTexture2D=Lt,this.setTexture2DArray=function(He,Ue){const mt=h.get(He);He.version>0&&mt.__version!==He.version?nn(mt,He,Ue):(l.activeTexture(33984+Ue),l.bindTexture(35866,mt.__webglTexture))},this.setTexture3D=function(He,Ue){const mt=h.get(He);He.version>0&&mt.__version!==He.version?nn(mt,He,Ue):(l.activeTexture(33984+Ue),l.bindTexture(32879,mt.__webglTexture))},this.setTextureCube=function(He,Ue){const mt=h.get(He);He.version>0&&mt.__version!==He.version?function(at,We,st){if(We.image.length!==6)return;const Tt=Dt(at,We),Ae=We.source;if(l.activeTexture(33984+st),l.bindTexture(34067,at.__webglTexture),Ae.version!==Ae.__currentVersion||Tt===!0){x.pixelStorei(37440,We.flipY),x.pixelStorei(37441,We.premultiplyAlpha),x.pixelStorei(3317,We.unpackAlignment),x.pixelStorei(37443,0);const It=We.isCompressedTexture||We.image[0].isCompressedTexture,dt=We.image[0]&&We.image[0].isDataTexture,Nt=[];for(let hi=0;hi<6;hi++)Nt[hi]=It||dt?dt?We.image[hi].image:We.image[hi]:ve(We.image[hi],!1,!0,I),Nt[hi]=yi(We,Nt[hi]);const Gt=Nt[0],pn=Ee(Gt)||b,Un=g.convert(We.format,We.encoding),Jn=g.convert(We.type),fi=Ye(We.internalFormat,Un,Jn,We.encoding),Yn=b&&We.isVideoTexture!==!0,$n=Ae.__currentVersion===void 0||Tt===!0;let hr,Da=Ke(We,Gt,pn);if(Ct(34067,We,pn),It){Yn&&$n&&l.texStorage2D(34067,Da,fi,Gt.width,Gt.height);for(let hi=0;hi<6;hi++){hr=Nt[hi].mipmaps;for(let Ar=0;Ar<hr.length;Ar++){const yr=hr[Ar];We.format!==Nn?Un!==null?Yn?l.compressedTexSubImage2D(34069+hi,Ar,0,0,yr.width,yr.height,Un,yr.data):l.compressedTexImage2D(34069+hi,Ar,fi,yr.width,yr.height,0,yr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Yn?l.texSubImage2D(34069+hi,Ar,0,0,yr.width,yr.height,Un,Jn,yr.data):l.texImage2D(34069+hi,Ar,fi,yr.width,yr.height,0,Un,Jn,yr.data)}}}else{hr=We.mipmaps,Yn&&$n&&(hr.length>0&&Da++,l.texStorage2D(34067,Da,fi,Nt[0].width,Nt[0].height));for(let hi=0;hi<6;hi++)if(dt){Yn?l.texSubImage2D(34069+hi,0,0,0,Nt[hi].width,Nt[hi].height,Un,Jn,Nt[hi].data):l.texImage2D(34069+hi,0,fi,Nt[hi].width,Nt[hi].height,0,Un,Jn,Nt[hi].data);for(let Ar=0;Ar<hr.length;Ar++){const yr=hr[Ar].image[hi].image;Yn?l.texSubImage2D(34069+hi,Ar+1,0,0,yr.width,yr.height,Un,Jn,yr.data):l.texImage2D(34069+hi,Ar+1,fi,yr.width,yr.height,0,Un,Jn,yr.data)}}else{Yn?l.texSubImage2D(34069+hi,0,0,0,Un,Jn,Nt[hi]):l.texImage2D(34069+hi,0,fi,Un,Jn,Nt[hi]);for(let Ar=0;Ar<hr.length;Ar++){const yr=hr[Ar];Yn?l.texSubImage2D(34069+hi,Ar+1,0,0,Un,Jn,yr.image[hi]):l.texImage2D(34069+hi,Ar+1,fi,Un,Jn,yr.image[hi])}}}Me(We,pn)&&Pe(34067),Ae.__currentVersion=Ae.version,We.onUpdate&&We.onUpdate(We)}at.__version=We.version}(mt,He,Ue):(l.activeTexture(33984+Ue),l.bindTexture(34067,mt.__webglTexture))},this.rebindTextures=function(He,Ue,mt){const at=h.get(He);Ue!==void 0&&Ut(at.__webglFramebuffer,He,He.texture,36064,3553),mt!==void 0&&On(He)},this.setupRenderTarget=function(He){const Ue=He.texture,mt=h.get(He),at=h.get(Ue);He.addEventListener("dispose",Ze),He.isWebGLMultipleRenderTargets!==!0&&(at.__webglTexture===void 0&&(at.__webglTexture=x.createTexture()),at.__version=Ue.version,v.memory.textures++);const We=He.isWebGLCubeRenderTarget===!0,st=He.isWebGLMultipleRenderTargets===!0,Tt=Ee(He)||b;if(We){mt.__webglFramebuffer=[];for(let Ae=0;Ae<6;Ae++)mt.__webglFramebuffer[Ae]=x.createFramebuffer()}else{if(mt.__webglFramebuffer=x.createFramebuffer(),st)if(d.drawBuffers){const Ae=He.texture;for(let It=0,dt=Ae.length;It<dt;It++){const Nt=h.get(Ae[It]);Nt.__webglTexture===void 0&&(Nt.__webglTexture=x.createTexture(),v.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(b&&He.samples>0&&Fn(He)===!1){const Ae=st?Ue:[Ue];mt.__webglMultisampledFramebuffer=x.createFramebuffer(),mt.__webglColorRenderbuffer=[],l.bindFramebuffer(36160,mt.__webglMultisampledFramebuffer);for(let It=0;It<Ae.length;It++){const dt=Ae[It];mt.__webglColorRenderbuffer[It]=x.createRenderbuffer(),x.bindRenderbuffer(36161,mt.__webglColorRenderbuffer[It]);const Nt=g.convert(dt.format,dt.encoding),Gt=g.convert(dt.type),pn=Ye(dt.internalFormat,Nt,Gt,dt.encoding),Un=Ti(He);x.renderbufferStorageMultisample(36161,Un,pn,He.width,He.height),x.framebufferRenderbuffer(36160,36064+It,36161,mt.__webglColorRenderbuffer[It])}x.bindRenderbuffer(36161,null),He.depthBuffer&&(mt.__webglDepthRenderbuffer=x.createRenderbuffer(),on(mt.__webglDepthRenderbuffer,He,!0)),l.bindFramebuffer(36160,null)}}if(We){l.bindTexture(34067,at.__webglTexture),Ct(34067,Ue,Tt);for(let Ae=0;Ae<6;Ae++)Ut(mt.__webglFramebuffer[Ae],He,Ue,36064,34069+Ae);Me(Ue,Tt)&&Pe(34067),l.unbindTexture()}else if(st){const Ae=He.texture;for(let It=0,dt=Ae.length;It<dt;It++){const Nt=Ae[It],Gt=h.get(Nt);l.bindTexture(3553,Gt.__webglTexture),Ct(3553,Nt,Tt),Ut(mt.__webglFramebuffer,He,Nt,36064+It,3553),Me(Nt,Tt)&&Pe(3553)}l.unbindTexture()}else{let Ae=3553;(He.isWebGL3DRenderTarget||He.isWebGLArrayRenderTarget)&&(b?Ae=He.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),l.bindTexture(Ae,at.__webglTexture),Ct(Ae,Ue,Tt),Ut(mt.__webglFramebuffer,He,Ue,36064,Ae),Me(Ue,Tt)&&Pe(Ae),l.unbindTexture()}He.depthBuffer&&On(He)},this.updateRenderTargetMipmap=function(He){const Ue=Ee(He)||b,mt=He.isWebGLMultipleRenderTargets===!0?He.texture:[He.texture],at=He.isWebGLCubeRenderTarget?34067:3553;for(let We=0,st=mt.length;We<st;We++){const Tt=mt[We],Ae=h.get(Tt),It=Ae.__webglTexture;Ae.__version!==Tt.version&&(l.bindTexture(at,It),Ct(at,Tt,Ue),l.unbindTexture(),Ae.__version=Tt.version),Me(Tt,Ue)&&(l.bindTexture(at,It),Pe(at),l.unbindTexture())}},this.updateMultisampleRenderTarget=function(He){if(b&&He.samples>0&&Fn(He)===!1){const Ue=He.isWebGLMultipleRenderTargets?He.texture:[He.texture],mt=He.width,at=He.height;let We=16384;const st=[],Tt=He.stencilBuffer?33306:36096,Ae=h.get(He),It=He.isWebGLMultipleRenderTargets===!0;if(It)for(let dt=0;dt<Ue.length;dt++)l.bindFramebuffer(36160,Ae.__webglMultisampledFramebuffer),x.framebufferRenderbuffer(36160,36064+dt,36161,null),l.bindFramebuffer(36160,Ae.__webglFramebuffer),x.framebufferTexture2D(36009,36064+dt,3553,null,0);l.bindFramebuffer(36008,Ae.__webglMultisampledFramebuffer),l.bindFramebuffer(36009,Ae.__webglFramebuffer);for(let dt=0;dt<Ue.length;dt++){st.push(36064+dt),He.depthBuffer&&st.push(Tt);const Nt=Ae.__ignoreDepthValues!==void 0&&Ae.__ignoreDepthValues;if(Nt===!1&&(He.depthBuffer&&(We|=256),He.stencilBuffer&&(We|=1024)),It&&x.framebufferRenderbuffer(36008,36064,36161,Ae.__webglColorRenderbuffer[dt]),Nt===!0&&(x.invalidateFramebuffer(36008,[Tt]),x.invalidateFramebuffer(36009,[Tt])),It){const Gt=h.get(Ue[dt]).__webglTexture;x.framebufferTexture2D(36009,36064,3553,Gt,0)}x.blitFramebuffer(0,0,mt,at,0,0,mt,at,We,9728),Q&&x.invalidateFramebuffer(36008,st)}if(l.bindFramebuffer(36008,null),l.bindFramebuffer(36009,null),It)for(let dt=0;dt<Ue.length;dt++){l.bindFramebuffer(36160,Ae.__webglMultisampledFramebuffer),x.framebufferRenderbuffer(36160,36064+dt,36161,Ae.__webglColorRenderbuffer[dt]);const Nt=h.get(Ue[dt]).__webglTexture;l.bindFramebuffer(36160,Ae.__webglFramebuffer),x.framebufferTexture2D(36009,36064+dt,3553,Nt,0)}l.bindFramebuffer(36009,Ae.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=On,this.setupFrameBufferTexture=Ut,this.useMultisampledRTT=Fn}function Jm(x,i,l){const h=l.isWebGL2;return{convert:function(d,g=null){let v;if(d===qr)return 5121;if(d===ri)return 32819;if(d===cn)return 32820;if(d===Sr)return 5120;if(d===no)return 5122;if(d===Vs)return 5123;if(d===_o)return 5124;if(d===et)return 5125;if(d===_r)return 5126;if(d===Gs)return h?5131:(v=i.get("OES_texture_half_float"),v!==null?v.HALF_FLOAT_OES:null);if(d===Gn)return 6406;if(d===Nn)return 6408;if(d===ir)return 6409;if(d===di)return 6410;if(d===Hi)return 6402;if(d===rr)return 34041;if(d===Qs)return 6403;if(d===Qn)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(d===Cd)return v=i.get("EXT_sRGB"),v!==null?v.SRGB_ALPHA_EXT:null;if(d===vi)return 36244;if(d===Gr)return 33319;if(d===vo)return 33320;if(d===sr)return 36249;if(d===Bi||d===pr||d===Ri||d===us)if(g===Mi){if(v=i.get("WEBGL_compressed_texture_s3tc_srgb"),v===null)return null;if(d===Bi)return v.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(d===pr)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(d===Ri)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(d===us)return v.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(v=i.get("WEBGL_compressed_texture_s3tc"),v===null)return null;if(d===Bi)return v.COMPRESSED_RGB_S3TC_DXT1_EXT;if(d===pr)return v.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(d===Ri)return v.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(d===us)return v.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(d===ki||d===fr||d===wr||d===_n){if(v=i.get("WEBGL_compressed_texture_pvrtc"),v===null)return null;if(d===ki)return v.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(d===fr)return v.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(d===wr)return v.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(d===_n)return v.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(d===ja)return v=i.get("WEBGL_compressed_texture_etc1"),v!==null?v.COMPRESSED_RGB_ETC1_WEBGL:null;if(d===wn||d===Yr){if(v=i.get("WEBGL_compressed_texture_etc"),v===null)return null;if(d===wn)return g===Mi?v.COMPRESSED_SRGB8_ETC2:v.COMPRESSED_RGB8_ETC2;if(d===Yr)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:v.COMPRESSED_RGBA8_ETC2_EAC}if(d===Ao||d===Ji||d===Si||d===dl||d===Th||d===Ql||d===Ec||d===Ci||d===Ad||d===Sc||d===Hl||d===Wl||d===cr||d===$i){if(v=i.get("WEBGL_compressed_texture_astc"),v===null)return null;if(d===Ao)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:v.COMPRESSED_RGBA_ASTC_4x4_KHR;if(d===Ji)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:v.COMPRESSED_RGBA_ASTC_5x4_KHR;if(d===Si)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:v.COMPRESSED_RGBA_ASTC_5x5_KHR;if(d===dl)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:v.COMPRESSED_RGBA_ASTC_6x5_KHR;if(d===Th)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:v.COMPRESSED_RGBA_ASTC_6x6_KHR;if(d===Ql)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:v.COMPRESSED_RGBA_ASTC_8x5_KHR;if(d===Ec)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:v.COMPRESSED_RGBA_ASTC_8x6_KHR;if(d===Ci)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:v.COMPRESSED_RGBA_ASTC_8x8_KHR;if(d===Ad)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:v.COMPRESSED_RGBA_ASTC_10x5_KHR;if(d===Sc)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:v.COMPRESSED_RGBA_ASTC_10x6_KHR;if(d===Hl)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:v.COMPRESSED_RGBA_ASTC_10x8_KHR;if(d===Wl)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:v.COMPRESSED_RGBA_ASTC_10x10_KHR;if(d===cr)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:v.COMPRESSED_RGBA_ASTC_12x10_KHR;if(d===$i)return g===Mi?v.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:v.COMPRESSED_RGBA_ASTC_12x12_KHR}if(d===pl){if(v=i.get("EXT_texture_compression_bptc"),v===null)return null;if(d===pl)return g===Mi?v.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:v.COMPRESSED_RGBA_BPTC_UNORM_EXT}return d===kt?h?34042:(v=i.get("WEBGL_depth_texture"),v!==null?v.UNSIGNED_INT_24_8_WEBGL:null):x[d]!==void 0?x[d]:null}}}class av extends Ks{constructor(i=[]){super(),this.isArrayCamera=!0,this.cameras=i}}class Xc extends pi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const xA={type:"move"};class $m{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Xc,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Xc,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Re,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Re),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Xc,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Re,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Re),this._grip}dispatchEvent(i){return this._targetRay!==null&&this._targetRay.dispatchEvent(i),this._grip!==null&&this._grip.dispatchEvent(i),this._hand!==null&&this._hand.dispatchEvent(i),this}disconnect(i){return this.dispatchEvent({type:"disconnected",data:i}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(i,l,h){let d=null,g=null,v=null;const b=this._targetRay,T=this._grip,I=this._hand;if(i&&l.session.visibilityState!=="visible-blurred"){if(I&&i.hand){v=!0;for(const H of i.hand.values()){const ne=l.getJointPose(H,h);if(I.joints[H.jointName]===void 0){const re=new Xc;re.matrixAutoUpdate=!1,re.visible=!1,I.joints[H.jointName]=re,I.add(re)}const ie=I.joints[H.jointName];ne!==null&&(ie.matrix.fromArray(ne.transform.matrix),ie.matrix.decompose(ie.position,ie.rotation,ie.scale),ie.jointRadius=ne.radius),ie.visible=ne!==null}const N=I.joints["index-finger-tip"],z=I.joints["thumb-tip"],U=N.position.distanceTo(z.position),Q=.02,Y=.005;I.inputState.pinching&&U>Q+Y?(I.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:i.handedness,target:this})):!I.inputState.pinching&&U<=Q-Y&&(I.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:i.handedness,target:this}))}else T!==null&&i.gripSpace&&(g=l.getPose(i.gripSpace,h),g!==null&&(T.matrix.fromArray(g.transform.matrix),T.matrix.decompose(T.position,T.rotation,T.scale),g.linearVelocity?(T.hasLinearVelocity=!0,T.linearVelocity.copy(g.linearVelocity)):T.hasLinearVelocity=!1,g.angularVelocity?(T.hasAngularVelocity=!0,T.angularVelocity.copy(g.angularVelocity)):T.hasAngularVelocity=!1));b!==null&&(d=l.getPose(i.targetRaySpace,h),d===null&&g!==null&&(d=g),d!==null&&(b.matrix.fromArray(d.transform.matrix),b.matrix.decompose(b.position,b.rotation,b.scale),d.linearVelocity?(b.hasLinearVelocity=!0,b.linearVelocity.copy(d.linearVelocity)):b.hasLinearVelocity=!1,d.angularVelocity?(b.hasAngularVelocity=!0,b.angularVelocity.copy(d.angularVelocity)):b.hasAngularVelocity=!1,this.dispatchEvent(xA)))}return b!==null&&(b.visible=d!==null),T!==null&&(T.visible=g!==null),I!==null&&(I.visible=v!==null),this}}class lv extends fs{constructor(i,l,h,d,g,v,b,T,I,N){if((N=N!==void 0?N:Hi)!==Hi&&N!==rr)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");h===void 0&&N===Hi&&(h=et),h===void 0&&N===rr&&(h=kt),super(null,d,g,v,b,T,N,h,I),this.isDepthTexture=!0,this.image={width:i,height:l},this.magFilter=b!==void 0?b:ar,this.minFilter=T!==void 0?T:ar,this.flipY=!1,this.generateMipmaps=!1}}class rf extends ei{constructor(i,l){super();const h=this;let d=null,g=1,v=null,b="local-floor",T=null,I=null,N=null,z=null,U=null,Q=null;const Y=l.getContextAttributes();let H=null,ne=null;const ie=[],re=[],ve=new Ks;ve.layers.enable(1),ve.viewport=new Zi;const Ee=new Ks;Ee.layers.enable(2),Ee.viewport=new Zi;const Me=[ve,Ee],Pe=new av;Pe.layers.enable(1),Pe.layers.enable(2);let Ye=null,Ke=null;function lt(Ct){const Dt=re.indexOf(Ct.inputSource);if(Dt===-1)return;const nn=ie[Dt];nn!==void 0&&nn.dispatchEvent({type:Ct.type,data:Ct.inputSource})}function ut(){d.removeEventListener("select",lt),d.removeEventListener("selectstart",lt),d.removeEventListener("selectend",lt),d.removeEventListener("squeeze",lt),d.removeEventListener("squeezestart",lt),d.removeEventListener("squeezeend",lt),d.removeEventListener("end",ut),d.removeEventListener("inputsourceschange",Ze);for(let Ct=0;Ct<ie.length;Ct++){const Dt=re[Ct];Dt!==null&&(re[Ct]=null,ie[Ct].disconnect(Dt))}Ye=null,Ke=null,i.setRenderTarget(H),U=null,z=null,N=null,d=null,ne=null,ln.stop(),h.isPresenting=!1,h.dispatchEvent({type:"sessionend"})}function Ze(Ct){for(let Dt=0;Dt<Ct.removed.length;Dt++){const nn=Ct.removed[Dt],Ut=re.indexOf(nn);Ut>=0&&(re[Ut]=null,ie[Ut].dispatchEvent({type:"disconnected",data:nn}))}for(let Dt=0;Dt<Ct.added.length;Dt++){const nn=Ct.added[Dt];let Ut=re.indexOf(nn);if(Ut===-1){for(let On=0;On<ie.length;On++){if(On>=re.length){re.push(nn),Ut=On;break}if(re[On]===null){re[On]=nn,Ut=On;break}}if(Ut===-1)break}const on=ie[Ut];on&&on.dispatchEvent({type:"connected",data:nn})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ct){let Dt=ie[Ct];return Dt===void 0&&(Dt=new $m,ie[Ct]=Dt),Dt.getTargetRaySpace()},this.getControllerGrip=function(Ct){let Dt=ie[Ct];return Dt===void 0&&(Dt=new $m,ie[Ct]=Dt),Dt.getGripSpace()},this.getHand=function(Ct){let Dt=ie[Ct];return Dt===void 0&&(Dt=new $m,ie[Ct]=Dt),Dt.getHandSpace()},this.setFramebufferScaleFactor=function(Ct){g=Ct,h.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ct){b=Ct,h.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return T||v},this.setReferenceSpace=function(Ct){T=Ct},this.getBaseLayer=function(){return z!==null?z:U},this.getBinding=function(){return N},this.getFrame=function(){return Q},this.getSession=function(){return d},this.setSession=async function(Ct){if(d=Ct,d!==null){if(H=i.getRenderTarget(),d.addEventListener("select",lt),d.addEventListener("selectstart",lt),d.addEventListener("selectend",lt),d.addEventListener("squeeze",lt),d.addEventListener("squeezestart",lt),d.addEventListener("squeezeend",lt),d.addEventListener("end",ut),d.addEventListener("inputsourceschange",Ze),Y.xrCompatible!==!0&&await l.makeXRCompatible(),d.renderState.layers===void 0||i.capabilities.isWebGL2===!1){const Dt={antialias:d.renderState.layers!==void 0||Y.antialias,alpha:Y.alpha,depth:Y.depth,stencil:Y.stencil,framebufferScaleFactor:g};U=new XRWebGLLayer(d,l,Dt),d.updateRenderState({baseLayer:U}),ne=new bo(U.framebufferWidth,U.framebufferHeight,{format:Nn,type:qr,encoding:i.outputEncoding,stencilBuffer:Y.stencil})}else{let Dt=null,nn=null,Ut=null;Y.depth&&(Ut=Y.stencil?35056:33190,Dt=Y.stencil?rr:Hi,nn=Y.stencil?kt:et);const on={colorFormat:32856,depthFormat:Ut,scaleFactor:g};N=new XRWebGLBinding(d,l),z=N.createProjectionLayer(on),d.updateRenderState({layers:[z]}),ne=new bo(z.textureWidth,z.textureHeight,{format:Nn,type:qr,depthTexture:new lv(z.textureWidth,z.textureHeight,nn,void 0,void 0,void 0,void 0,void 0,void 0,Dt),stencilBuffer:Y.stencil,encoding:i.outputEncoding,samples:Y.antialias?4:0}),i.properties.get(ne).__ignoreDepthValues=z.ignoreDepthValues}ne.isXRRenderTarget=!0,this.setFoveation(1),T=null,v=await d.requestReferenceSpace(b),ln.setContext(d),ln.start(),h.isPresenting=!0,h.dispatchEvent({type:"sessionstart"})}};const Ft=new Re,$t=new Re;function Lt(Ct,Dt){Dt===null?Ct.matrixWorld.copy(Ct.matrix):Ct.matrixWorld.multiplyMatrices(Dt.matrixWorld,Ct.matrix),Ct.matrixWorldInverse.copy(Ct.matrixWorld).invert()}this.updateCamera=function(Ct){if(d===null)return;Pe.near=Ee.near=ve.near=Ct.near,Pe.far=Ee.far=ve.far=Ct.far,Ye===Pe.near&&Ke===Pe.far||(d.updateRenderState({depthNear:Pe.near,depthFar:Pe.far}),Ye=Pe.near,Ke=Pe.far);const Dt=Ct.parent,nn=Pe.cameras;Lt(Pe,Dt);for(let on=0;on<nn.length;on++)Lt(nn[on],Dt);Pe.matrixWorld.decompose(Pe.position,Pe.quaternion,Pe.scale),Ct.matrix.copy(Pe.matrix),Ct.matrix.decompose(Ct.position,Ct.quaternion,Ct.scale);const Ut=Ct.children;for(let on=0,On=Ut.length;on<On;on++)Ut[on].updateMatrixWorld(!0);nn.length===2?function(on,On,Ti){Ft.setFromMatrixPosition(On.matrixWorld),$t.setFromMatrixPosition(Ti.matrixWorld);const Fn=Ft.distanceTo($t),yi=On.projectionMatrix.elements,He=Ti.projectionMatrix.elements,Ue=yi[14]/(yi[10]-1),mt=yi[14]/(yi[10]+1),at=(yi[9]+1)/yi[5],We=(yi[9]-1)/yi[5],st=(yi[8]-1)/yi[0],Tt=(He[8]+1)/He[0],Ae=Ue*st,It=Ue*Tt,dt=Fn/(-st+Tt),Nt=dt*-st;On.matrixWorld.decompose(on.position,on.quaternion,on.scale),on.translateX(Nt),on.translateZ(dt),on.matrixWorld.compose(on.position,on.quaternion,on.scale),on.matrixWorldInverse.copy(on.matrixWorld).invert();const Gt=Ue+dt,pn=mt+dt,Un=Ae-Nt,Jn=It+(Fn-Nt),fi=at*mt/pn*Gt,Yn=We*mt/pn*Gt;on.projectionMatrix.makePerspective(Un,Jn,fi,Yn,Gt,pn)}(Pe,ve,Ee):Pe.projectionMatrix.copy(ve.projectionMatrix)},this.getCamera=function(){return Pe},this.getFoveation=function(){return z!==null?z.fixedFoveation:U!==null?U.fixedFoveation:void 0},this.setFoveation=function(Ct){z!==null&&(z.fixedFoveation=Ct),U!==null&&U.fixedFoveation!==void 0&&(U.fixedFoveation=Ct)};let an=null;this.onPreAnimationFrameCallback=null;const ln=new qc;ln.setAnimationLoop(function(Ct,Dt){if(h.onPreAnimationFrameCallback&&h.onPreAnimationFrameCallback(Ct,Dt),I=Dt.getViewerPose(T||v),Q=Dt,I!==null){const nn=I.views;U!==null&&(i.setRenderTargetFramebuffer(ne,U.framebuffer),i.setRenderTarget(ne));let Ut=!1;nn.length!==Pe.cameras.length&&(Pe.cameras.length=0,Ut=!0);for(let on=0;on<nn.length;on++){const On=nn[on];let Ti=null;if(U!==null)Ti=U.getViewport(On);else{const yi=N.getViewSubImage(z,On);Ti=yi.viewport,on===0&&(i.setRenderTargetTextures(ne,yi.colorTexture,z.ignoreDepthValues?void 0:yi.depthStencilTexture),i.setRenderTarget(ne))}let Fn=Me[on];Fn===void 0&&(Fn=new Ks,Fn.layers.enable(on),Fn.viewport=new Zi,Me[on]=Fn),Fn.matrix.fromArray(On.transform.matrix),Fn.projectionMatrix.fromArray(On.projectionMatrix),Fn.viewport.set(Ti.x,Ti.y,Ti.width,Ti.height),on===0&&Pe.matrix.copy(Fn.matrix),Ut===!0&&Pe.cameras.push(Fn)}}for(let nn=0;nn<ie.length;nn++){const Ut=re[nn],on=ie[nn];Ut!==null&&on!==void 0&&on.update(Ut,Dt,T||v)}an&&an(Ct,Dt),Q=null}),this.setAnimationLoop=function(Ct){an=Ct},this.dispose=function(){}}}function EA(x,i){function l(h,d){h.opacity.value=d.opacity,d.color&&h.diffuse.value.copy(d.color),d.emissive&&h.emissive.value.copy(d.emissive).multiplyScalar(d.emissiveIntensity),d.map&&(h.map.value=d.map),d.alphaMap&&(h.alphaMap.value=d.alphaMap),d.bumpMap&&(h.bumpMap.value=d.bumpMap,h.bumpScale.value=d.bumpScale,d.side===$&&(h.bumpScale.value*=-1)),d.displacementMap&&(h.displacementMap.value=d.displacementMap,h.displacementScale.value=d.displacementScale,h.displacementBias.value=d.displacementBias),d.emissiveMap&&(h.emissiveMap.value=d.emissiveMap),d.normalMap&&(h.normalMap.value=d.normalMap,h.normalScale.value.copy(d.normalScale),d.side===$&&h.normalScale.value.negate()),d.specularMap&&(h.specularMap.value=d.specularMap),d.alphaTest>0&&(h.alphaTest.value=d.alphaTest);const g=i.get(d).envMap;if(g){h.envMap.value=g;const T=i.get(d).environment||g;h.envMapRotation.value=T?T.rotation:0,h.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,h.reflectivity.value=d.reflectivity,h.ior.value=d.ior,h.refractionRatio.value=d.refractionRatio}if(d.lightMap){h.lightMap.value=d.lightMap;const T=x.physicallyCorrectLights!==!0?Math.PI:1;h.lightMapIntensity.value=d.lightMapIntensity*T}let v,b;d.aoMap&&(h.aoMap.value=d.aoMap,h.aoMapIntensity.value=d.aoMapIntensity),d.map?v=d.map:d.specularMap?v=d.specularMap:d.displacementMap?v=d.displacementMap:d.normalMap?v=d.normalMap:d.bumpMap?v=d.bumpMap:d.roughnessMap?v=d.roughnessMap:d.metalnessMap?v=d.metalnessMap:d.alphaMap?v=d.alphaMap:d.emissiveMap?v=d.emissiveMap:d.clearcoatMap?v=d.clearcoatMap:d.clearcoatNormalMap?v=d.clearcoatNormalMap:d.clearcoatRoughnessMap?v=d.clearcoatRoughnessMap:d.iridescenceMap?v=d.iridescenceMap:d.iridescenceThicknessMap?v=d.iridescenceThicknessMap:d.specularIntensityMap?v=d.specularIntensityMap:d.specularColorMap?v=d.specularColorMap:d.transmissionMap?v=d.transmissionMap:d.thicknessMap?v=d.thicknessMap:d.sheenColorMap?v=d.sheenColorMap:d.sheenRoughnessMap&&(v=d.sheenRoughnessMap),v!==void 0&&(v.isWebGLRenderTarget&&(v=v.texture),v.matrixAutoUpdate===!0&&v.updateMatrix(),h.uvTransform.value.copy(v.matrix)),d.aoMap?b=d.aoMap:d.lightMap&&(b=d.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),h.uv2Transform.value.copy(b.matrix))}return{refreshFogUniforms:function(h,d){h.fogColor.value.copy(d.color),d.isFog?(h.fogNear.value=d.near,h.fogFar.value=d.far):d.isFogExp2&&(h.fogDensity.value=d.density)},refreshMaterialUniforms:function(h,d,g,v,b){d.isMeshBasicMaterial||d.isMeshLambertMaterial?l(h,d):d.isMeshToonMaterial?(l(h,d),function(T,I){I.gradientMap&&(T.gradientMap.value=I.gradientMap)}(h,d)):d.isMeshPhongMaterial?(l(h,d),function(T,I){T.specular.value.copy(I.specular),T.shininess.value=Math.max(I.shininess,1e-4)}(h,d)):d.isMeshStandardMaterial?(l(h,d),function(T,I){T.roughness.value=I.roughness,T.metalness.value=I.metalness,I.roughnessMap&&(T.roughnessMap.value=I.roughnessMap),I.metalnessMap&&(T.metalnessMap.value=I.metalnessMap),i.get(I).envMap&&(T.envMapIntensity.value=I.envMapIntensity)}(h,d),d.isMeshPhysicalMaterial&&function(T,I,N){T.ior.value=I.ior,I.sheen>0&&(T.sheenColor.value.copy(I.sheenColor).multiplyScalar(I.sheen),T.sheenRoughness.value=I.sheenRoughness,I.sheenColorMap&&(T.sheenColorMap.value=I.sheenColorMap),I.sheenRoughnessMap&&(T.sheenRoughnessMap.value=I.sheenRoughnessMap)),I.clearcoat>0&&(T.clearcoat.value=I.clearcoat,T.clearcoatRoughness.value=I.clearcoatRoughness,I.clearcoatMap&&(T.clearcoatMap.value=I.clearcoatMap),I.clearcoatRoughnessMap&&(T.clearcoatRoughnessMap.value=I.clearcoatRoughnessMap),I.clearcoatNormalMap&&(T.clearcoatNormalScale.value.copy(I.clearcoatNormalScale),T.clearcoatNormalMap.value=I.clearcoatNormalMap,I.side===$&&T.clearcoatNormalScale.value.negate())),I.iridescence>0&&(T.iridescence.value=I.iridescence,T.iridescenceIOR.value=I.iridescenceIOR,T.iridescenceThicknessMinimum.value=I.iridescenceThicknessRange[0],T.iridescenceThicknessMaximum.value=I.iridescenceThicknessRange[1],I.iridescenceMap&&(T.iridescenceMap.value=I.iridescenceMap),I.iridescenceThicknessMap&&(T.iridescenceThicknessMap.value=I.iridescenceThicknessMap)),I.transmission>0&&(T.transmission.value=I.transmission,T.transmissionSamplerMap.value=N.texture,T.transmissionSamplerSize.value.set(N.width,N.height),I.transmissionMap&&(T.transmissionMap.value=I.transmissionMap),T.thickness.value=I.thickness,I.thicknessMap&&(T.thicknessMap.value=I.thicknessMap),T.attenuationDistance.value=I.attenuationDistance,T.attenuationColor.value.copy(I.attenuationColor)),T.specularIntensity.value=I.specularIntensity,T.specularColor.value.copy(I.specularColor),I.specularIntensityMap&&(T.specularIntensityMap.value=I.specularIntensityMap),I.specularColorMap&&(T.specularColorMap.value=I.specularColorMap)}(h,d,b)):d.isMeshMatcapMaterial?(l(h,d),function(T,I){I.matcap&&(T.matcap.value=I.matcap)}(h,d)):d.isMeshDepthMaterial?l(h,d):d.isMeshDistanceMaterial?(l(h,d),function(T,I){T.referencePosition.value.copy(I.referencePosition),T.nearDistance.value=I.nearDistance,T.farDistance.value=I.farDistance}(h,d)):d.isMeshNormalMaterial?l(h,d):d.isLineBasicMaterial?(function(T,I){T.diffuse.value.copy(I.color),T.opacity.value=I.opacity}(h,d),d.isLineDashedMaterial&&function(T,I){T.dashSize.value=I.dashSize,T.totalSize.value=I.dashSize+I.gapSize,T.scale.value=I.scale}(h,d)):d.isPointsMaterial?function(T,I,N,z){let U;T.diffuse.value.copy(I.color),T.opacity.value=I.opacity,T.size.value=I.size*N,T.scale.value=.5*z,I.map&&(T.map.value=I.map),I.alphaMap&&(T.alphaMap.value=I.alphaMap),I.alphaTest>0&&(T.alphaTest.value=I.alphaTest),I.map?U=I.map:I.alphaMap&&(U=I.alphaMap),U!==void 0&&(U.matrixAutoUpdate===!0&&U.updateMatrix(),T.uvTransform.value.copy(U.matrix))}(h,d,g,v):d.isSpriteMaterial?function(T,I){let N;T.diffuse.value.copy(I.color),T.opacity.value=I.opacity,T.rotation.value=I.rotation,I.map&&(T.map.value=I.map),I.alphaMap&&(T.alphaMap.value=I.alphaMap),I.alphaTest>0&&(T.alphaTest.value=I.alphaTest),I.map?N=I.map:I.alphaMap&&(N=I.alphaMap),N!==void 0&&(N.matrixAutoUpdate===!0&&N.updateMatrix(),T.uvTransform.value.copy(N.matrix))}(h,d):d.isShadowMaterial?(h.color.value.copy(d.color),h.opacity.value=d.opacity):d.isShaderMaterial&&(d.transmission!==void 0&&(h.transmission&&(h.transmission.value=d.transmission),h.transmissionSamplerMap&&b&&(h.transmissionSamplerMap.value=b?b.texture:null),h.transmissionSamplerSize&&b&&h.transmissionSamplerSize.value.set(b.width,b.height)),d.uniformsNeedUpdate=!1)}}}function SA(x,i,l,h){let d={},g={},v=[];const b=l.isWebGL2?x.getParameter(35375):0;function T(z,U,Q){const Y=z.value;if(Q[U]===void 0)return Q[U]=typeof Y=="number"?Y:Y.clone(),!0;if(typeof Y=="number"){if(Q[U]!==Y)return Q[U]=Y,!0}else{const H=Q[U];if(H.equals(Y)===!1)return H.copy(Y),!0}return!1}function I(z){const U=z.value,Q={boundary:0,storage:0};return typeof U=="number"?(Q.boundary=4,Q.storage=4):U.isVector2?(Q.boundary=8,Q.storage=8):U.isVector3||U.isColor?(Q.boundary=16,Q.storage=12):U.isVector4?(Q.boundary=16,Q.storage=16):U.isMatrix3?(Q.boundary=48,Q.storage=48):U.isMatrix4?(Q.boundary=64,Q.storage=64):U.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",U),Q}function N(z){const U=z.target;U.removeEventListener("dispose",N);const Q=v.indexOf(U.__bindingPointIndex);v.splice(Q,1),x.deleteBuffer(d[U.id]),delete d[U.id],delete g[U.id]}return{bind:function(z,U){const Q=U.program;h.uniformBlockBinding(z,Q)},update:function(z,U){let Q=d[z.id];Q===void 0&&(function(ne){const ie=ne.uniforms;let re=0,ve=0;for(let Ee=0,Me=ie.length;Ee<Me;Ee++){const Pe=ie[Ee],Ye=I(Pe);if(Pe.__data=new Float32Array(Ye.storage/Float32Array.BYTES_PER_ELEMENT),Pe.__offset=re,Ee>0){ve=re%16;const Ke=16-ve;ve!==0&&Ke-Ye.boundary<0&&(re+=16-ve,Pe.__offset=re)}re+=Ye.storage}ve=re%16,ve>0&&(re+=16-ve),ne.__size=re,ne.__cache={}}(z),Q=function(ne){const ie=function(){for(let Me=0;Me<b;Me++)if(v.indexOf(Me)===-1)return v.push(Me),Me;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();ne.__bindingPointIndex=ie;const re=x.createBuffer(),ve=ne.__size,Ee=ne.usage;return x.bindBuffer(35345,re),x.bufferData(35345,ve,Ee),x.bindBuffer(35345,null),x.bindBufferBase(35345,ie,re),re}(z),d[z.id]=Q,z.addEventListener("dispose",N));const Y=U.program;h.updateUBOMapping(z,Y);const H=i.render.frame;g[z.id]!==H&&(function(ne){const ie=d[ne.id],re=ne.uniforms,ve=ne.__cache;x.bindBuffer(35345,ie);for(let Ee=0,Me=re.length;Ee<Me;Ee++){const Pe=re[Ee];if(T(Pe,Ee,ve)===!0){const Ye=Pe.value,Ke=Pe.__offset;typeof Ye=="number"?(Pe.__data[0]=Ye,x.bufferSubData(35345,Ke,Pe.__data)):(Pe.value.isMatrix3?(Pe.__data[0]=Pe.value.elements[0],Pe.__data[1]=Pe.value.elements[1],Pe.__data[2]=Pe.value.elements[2],Pe.__data[3]=Pe.value.elements[0],Pe.__data[4]=Pe.value.elements[3],Pe.__data[5]=Pe.value.elements[4],Pe.__data[6]=Pe.value.elements[5],Pe.__data[7]=Pe.value.elements[0],Pe.__data[8]=Pe.value.elements[6],Pe.__data[9]=Pe.value.elements[7],Pe.__data[10]=Pe.value.elements[8],Pe.__data[11]=Pe.value.elements[0]):Ye.toArray(Pe.__data),x.bufferSubData(35345,Ke,Pe.__data))}}x.bindBuffer(35345,null)}(z),g[z.id]=H)},dispose:function(){for(const z in d)x.deleteBuffer(d[z]);v=[],d={},g={}}}}function ns(x={}){this.isWebGLRenderer=!0;const i=x.canvas!==void 0?x.canvas:function(){const Ve=Nc("canvas");return Ve.style.display="block",Ve}(),l=x.context!==void 0?x.context:null,h=x.depth===void 0||x.depth,d=x.stencil===void 0||x.stencil,g=x.antialias!==void 0&&x.antialias,v=x.premultipliedAlpha===void 0||x.premultipliedAlpha,b=x.preserveDrawingBuffer!==void 0&&x.preserveDrawingBuffer,T=x.powerPreference!==void 0?x.powerPreference:"default",I=x.failIfMajorPerformanceCaveat!==void 0&&x.failIfMajorPerformanceCaveat;let N;N=l!==null?l.getContextAttributes().alpha:x.alpha!==void 0&&x.alpha;let z=null,U=null;const Q=[],Y=[];this.domElement=i,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Aa,this.physicallyCorrectLights=!1,this.toneMapping=Xn,this.toneMappingExposure=1,this.userData={},Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});const H=this;let ne=!1,ie=0,re=0,ve=null,Ee=-1,Me=null;const Pe=new Zi,Ye=new Zi;let Ke=null,lt=i.width,ut=i.height,Ze=1,Ft=null,$t=null;const Lt=new Zi(0,0,lt,ut),an=new Zi(0,0,lt,ut);let ln=!1;const Ct=new Wp;let Dt=!1,nn=!1,Ut=null;const on=new ti,On=new Xt,Ti=new Re,Fn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function yi(){return ve===null?Ze:1}let He,Ue,mt,at,We,st,Tt,Ae,It,dt,Nt,Gt,pn,Un,Jn,fi,Yn,$n,hr,Da,hi,Ar,yr,qg,An=l;function _y(Ve,Bt){for(let Ht=0;Ht<Ve.length;Ht++){const Vt=Ve[Ht],rn=i.getContext(Vt,Bt);if(rn!==null)return rn}return null}try{const Ve={alpha:!0,depth:h,stencil:d,antialias:g,premultipliedAlpha:v,preserveDrawingBuffer:b,powerPreference:T,failIfMajorPerformanceCaveat:I};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${c}`),i.addEventListener("webglcontextlost",$v,!1),i.addEventListener("webglcontextrestored",Ay,!1),i.addEventListener("webglcontextcreationerror",Zv,!1),An===null){const Bt=["webgl2","webgl","experimental-webgl"];if(H.isWebGL1Renderer===!0&&Bt.shift(),An=_y(Bt,Ve),An===null)throw _y(Bt)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}An.getShaderPrecisionFormat===void 0&&(An.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Ve){throw console.error("THREE.WebGLRenderer: "+Ve.message),Ve}function vy(){He=new dn(An),Ue=new G0(An,He,x),He.init(Ue),Ar=new Jm(An,He,Ue),mt=new sv(An,He,Ue),at=new xl,We=new _A,st=new ov(An,He,mt,We,Ue,Ar,at),Tt=new mw(H),Ae=new W0(H),It=new Gd(An,Ue),yr=new pw(An,He,It,Ue),dt=new ui(An,It,at,yr),Nt=new xr(An,dt,It,at),hr=new q0(An,Ue,st),fi=new fw(We),Gt=new yw(H,Tt,Ae,He,Ue,yr,fi),pn=new EA(H,We),Un=new iv,Jn=new bA(He,Ue),$n=new dw(H,Tt,mt,Nt,N,v),Yn=new wA(H,Nt,Ue),qg=new SA(An,at,Ue,mt),Da=new V0(An,He,at,Ue),hi=new Qd(An,He,at,Ue),at.programs=Gt.programs,H.capabilities=Ue,H.extensions=He,H.properties=We,H.renderLists=Un,H.shadowMap=Yn,H.state=mt,H.info=at,H.background=$n,H.cubeuvmaps=Ae}vy();const jo=new rf(H,An);function $v(Ve){Ve.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ne=!0}function Ay(){console.log("THREE.WebGLRenderer: Context Restored."),ne=!1;const Ve=at.autoReset,Bt=Yn.enabled,Ht=Yn.autoUpdate,Vt=Yn.needsUpdate,rn=Yn.type;vy(),at.autoReset=Ve,Yn.enabled=Bt,Yn.autoUpdate=Ht,Yn.needsUpdate=Vt,Yn.type=rn}function Zv(Ve){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",Ve.statusMessage)}function Ni(Ve){const Bt=Ve.target;Bt.removeEventListener("dispose",Ni),function(Ht){(function(Vt){const rn=We.get(Vt).programs;rn!==void 0&&(rn.forEach(function(Pn){Gt.releaseProgram(Pn)}),Vt.isShaderMaterial&&Gt.releaseShaderCache(Vt))})(Ht),We.remove(Ht)}(Bt)}this.xr=jo,this.getContext=function(){return An},this.getContextAttributes=function(){return An.getContextAttributes()},this.forceContextLoss=function(){const Ve=He.get("WEBGL_lose_context");Ve&&Ve.loseContext()},this.forceContextRestore=function(){const Ve=He.get("WEBGL_lose_context");Ve&&Ve.restoreContext()},this.getPixelRatio=function(){return Ze},this.setPixelRatio=function(Ve){Ve!==void 0&&(Ze=Ve,this.setSize(lt,ut,!1))},this.getSize=function(Ve){return Ve.set(lt,ut)},this.setSize=function(Ve,Bt,Ht){jo.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(lt=Ve,ut=Bt,i.width=Math.floor(Ve*Ze),i.height=Math.floor(Bt*Ze),Ht!==!1&&(i.style.width=Ve+"px",i.style.height=Bt+"px"),this.setViewport(0,0,Ve,Bt))},this.getDrawingBufferSize=function(Ve){return Ve.set(lt*Ze,ut*Ze).floor()},this.setDrawingBufferSize=function(Ve,Bt,Ht){lt=Ve,ut=Bt,Ze=Ht,i.width=Math.floor(Ve*Ht),i.height=Math.floor(Bt*Ht),this.setViewport(0,0,Ve,Bt)},this.getCurrentViewport=function(Ve){return Ve.copy(Pe)},this.getViewport=function(Ve){return Ve.copy(Lt)},this.setViewport=function(Ve,Bt,Ht,Vt){Ve.isVector4?Lt.set(Ve.x,Ve.y,Ve.z,Ve.w):Lt.set(Ve,Bt,Ht,Vt),mt.viewport(Pe.copy(Lt).multiplyScalar(Ze).floor())},this.getScissor=function(Ve){return Ve.copy(an)},this.setScissor=function(Ve,Bt,Ht,Vt){Ve.isVector4?an.set(Ve.x,Ve.y,Ve.z,Ve.w):an.set(Ve,Bt,Ht,Vt),mt.scissor(Ye.copy(an).multiplyScalar(Ze).floor())},this.getScissorTest=function(){return ln},this.setScissorTest=function(Ve){mt.setScissorTest(ln=Ve)},this.setOpaqueSort=function(Ve){Ft=Ve},this.setTransparentSort=function(Ve){$t=Ve},this.getClearColor=function(Ve){return Ve.copy($n.getClearColor())},this.setClearColor=function(){$n.setClearColor.apply($n,arguments)},this.getClearAlpha=function(){return $n.getClearAlpha()},this.setClearAlpha=function(){$n.setClearAlpha.apply($n,arguments)},this.clear=function(Ve=!0,Bt=!0,Ht=!0){let Vt=0;Ve&&(Vt|=16384),Bt&&(Vt|=256),Ht&&(Vt|=1024),An.clear(Vt)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",$v,!1),i.removeEventListener("webglcontextrestored",Ay,!1),i.removeEventListener("webglcontextcreationerror",Zv,!1),Un.dispose(),Jn.dispose(),We.dispose(),Tt.dispose(),Ae.dispose(),Nt.dispose(),yr.dispose(),qg.dispose(),Gt.dispose(),jo.dispose(),jo.removeEventListener("sessionstart",zo),jo.removeEventListener("sessionend",yy),Ut&&(Ut.dispose(),Ut=null),sd.stop()},this.renderBufferDirect=function(Ve,Bt,Ht,Vt,rn,Pn){Bt===null&&(Bt=Fn);const Wi=rn.isMesh&&rn.matrixWorld.determinant()<0,Kn=function(uo,Jf,Ol,si,eo){Jf.isScene!==!0&&(Jf=Fn),st.resetTextureUnits();const Jg=Jf.fog,i0=si.isMeshStandardMaterial?Jf.environment:null,xy=ve===null?H.outputEncoding:ve.isXRRenderTarget===!0||ve.texture.encoding&&ve.texture.encoding!==Mi?ve.texture.encoding:Aa,$f=(si.isMeshStandardMaterial?Ae:Tt).get(si.envMap||i0),il=si.vertexColors===!0&&!!Ol.attributes.color&&Ol.attributes.color.itemSize===4,Iw=!!si.normalMap&&!!Ol.attributes.tangent,Ey=!!Ol.morphAttributes.position,r0=!!Ol.morphAttributes.normal,Pw=!!Ol.morphAttributes.color,Dw=si.toneMapped?H.toneMapping:Xn,$g=Ol.morphAttributes.position||Ol.morphAttributes.normal||Ol.morphAttributes.color,Rw=$g!==void 0?$g.length:0,Er=We.get(si),Sy=U.state.lights;if(Dt===!0&&(nn===!0||uo!==Me)){const Go=uo===Me&&si.id===Ee;fi.setState(si,uo,Go)}let gc=!1;si.version===Er.__version?Er.needsLights&&Er.lightsStateVersion!==Sy.state.version||Er.outputEncoding!==xy||eo.isInstancedMesh&&Er.instancing===!1?gc=!0:eo.isInstancedMesh||Er.instancing!==!0?eo.isSkinnedMesh&&Er.skinning===!1?gc=!0:eo.isSkinnedMesh||Er.skinning!==!0?Er.envMap!==$f||si.fog===!0&&Er.fog!==Jg?gc=!0:Er.numClippingPlanes===void 0||Er.numClippingPlanes===fi.numPlanes&&Er.numIntersection===fi.numIntersection?(Er.vertexAlphas!==il||Er.vertexTangents!==Iw||Er.morphTargets!==Ey||Er.morphNormals!==r0||Er.morphColors!==Pw||Er.toneMapping!==Dw||Ue.isWebGL2===!0&&Er.morphTargetsCount!==Rw)&&(gc=!0):gc=!0:gc=!0:gc=!0:(gc=!0,Er.__version=si.version);let _c=Er.currentProgram;gc===!0&&(_c=Yf(si,Jf,eo));let Zg=!1,od=!1,Vo=!1;const ho=_c.getUniforms(),Ll=Er.uniforms;if(mt.useProgram(_c.program)&&(Zg=!0,od=!0,Vo=!0),si.id!==Ee&&(Ee=si.id,od=!0),Zg||Me!==uo){if(ho.setValue(An,"projectionMatrix",uo.projectionMatrix),Ue.logarithmicDepthBuffer&&ho.setValue(An,"logDepthBufFC",2/(Math.log(uo.far+1)/Math.LN2)),Me!==uo&&(Me=uo,od=!0,Vo=!0),si.isShaderMaterial||si.isMeshPhongMaterial||si.isMeshToonMaterial||si.isMeshStandardMaterial||si.envMap){const Go=ho.map.cameraPosition;Go!==void 0&&Go.setValue(An,Ti.setFromMatrixPosition(uo.matrixWorld))}(si.isMeshPhongMaterial||si.isMeshToonMaterial||si.isMeshLambertMaterial||si.isMeshBasicMaterial||si.isMeshStandardMaterial||si.isShaderMaterial)&&ho.setValue(An,"isOrthographic",uo.isOrthographicCamera===!0),(si.isMeshPhongMaterial||si.isMeshToonMaterial||si.isMeshLambertMaterial||si.isMeshBasicMaterial||si.isMeshStandardMaterial||si.isShaderMaterial||si.isShadowMaterial||eo.isSkinnedMesh)&&ho.setValue(An,"viewMatrix",uo.matrixWorldInverse)}if(eo.isSkinnedMesh){ho.setOptional(An,eo,"bindMatrix"),ho.setOptional(An,eo,"bindMatrixInverse");const Go=eo.skeleton;Go&&(Ue.floatVertexTextures?(Go.boneTexture===null&&Go.computeBoneTexture(),ho.setValue(An,"boneTexture",Go.boneTexture,st),ho.setValue(An,"boneTextureSize",Go.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const e_=Ol.morphAttributes;var rl,sl;(e_.position!==void 0||e_.normal!==void 0||e_.color!==void 0&&Ue.isWebGL2===!0)&&hr.update(eo,Ol,si,_c),(od||Er.receiveShadow!==eo.receiveShadow)&&(Er.receiveShadow=eo.receiveShadow,ho.setValue(An,"receiveShadow",eo.receiveShadow)),si.isMeshGouraudMaterial&&si.envMap!==null&&(Ll.envMap.value=$f,Ll.flipEnvMap.value=$f.isCubeTexture&&$f.isRenderTargetTexture===!1?-1:1),od&&(ho.setValue(An,"toneMappingExposure",H.toneMappingExposure),Er.needsLights&&(sl=Vo,(rl=Ll).ambientLightColor.needsUpdate=sl,rl.lightProbe.needsUpdate=sl,rl.directionalLights.needsUpdate=sl,rl.directionalLightShadows.needsUpdate=sl,rl.pointLights.needsUpdate=sl,rl.pointLightShadows.needsUpdate=sl,rl.spotLights.needsUpdate=sl,rl.spotLightShadows.needsUpdate=sl,rl.rectAreaLights.needsUpdate=sl,rl.hemisphereLights.needsUpdate=sl),Jg&&si.fog===!0&&pn.refreshFogUniforms(Ll,Jg),pn.refreshMaterialUniforms(Ll,si,Ze,ut,H.userData.transmissionRenderTarget||Ut),Hm.upload(An,Er.uniformsList,Ll,st)),si.isShaderMaterial&&si.uniformsNeedUpdate===!0&&(Hm.upload(An,Er.uniformsList,Ll,st),si.uniformsNeedUpdate=!1),si.isSpriteMaterial&&ho.setValue(An,"center",eo.center),ho.setValue(An,"modelViewMatrix",eo.modelViewMatrix),ho.setValue(An,"normalMatrix",eo.normalMatrix),ho.setValue(An,"modelMatrix",eo.matrixWorld);const s0=si.extraUniformsToUpload;if(s0&&Object.entries(s0).forEach(([Go,Zf])=>ho.setValue(An,Go,Zf.value,st)),si.isShaderMaterial||si.isRawShaderMaterial){const Go=si.uniformsGroups;for(let Zf=0,Bw=Go.length;Zf<Bw;Zf++)if(Ue.isWebGL2){const Cy=Go[Zf];qg.update(Cy,_c),qg.bind(Cy,_c)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return _c}(Ve,Bt,Ht,Vt,rn);mt.setMaterial(Vt,Wi);let Ii=Ht.index;const Hr=Ht.attributes.position;if(Ii===null){if(Hr===void 0||Hr.count===0)return}else if(Ii.count===0)return;let qi,wi=1;Vt.wireframe===!0&&(Ii=dt.getWireframeAttribute(Ht),wi=2),yr.setup(rn,Vt,Kn,Ht,Ii);let bs=Da;Ii!==null&&(qi=It.get(Ii),bs=hi,bs.setIndex(qi));const Xf=Ii!==null?Ii.count:Hr.count,nl=Ht.drawRange.start*wi,Xg=Ht.drawRange.count*wi,mc=Pn!==null?Pn.start*wi:0,t0=Pn!==null?Pn.count*wi:1/0,Kg=Math.max(nl,mc),n0=Math.min(Xf,nl+Xg,mc+t0)-1,Kf=Math.max(0,n0-Kg+1);if(Kf!==0){if(rn.isMesh)Vt.wireframe===!0?(mt.setLineWidth(Vt.wireframeLinewidth*yi()),bs.setMode(1)):bs.setMode(4);else if(rn.isLine){let uo=Vt.linewidth;uo===void 0&&(uo=1),mt.setLineWidth(uo*yi()),rn.isLineSegments?bs.setMode(1):rn.isLineLoop?bs.setMode(2):bs.setMode(3)}else rn.isPoints?bs.setMode(0):rn.isSprite&&bs.setMode(4);if(rn.isInstancedMesh)bs.renderInstances(Kg,Kf,rn.count);else if(Ht.isInstancedBufferGeometry){const uo=Math.min(Ht.instanceCount,Ht._maxInstanceCount);bs.renderInstances(Kg,Kf,uo)}else bs.render(Kg,Kf)}},this.compile=function(Ve,Bt){function Ht(Vt,rn,Pn){Vt.transparent===!0&&Vt.side===_e?(Vt.side=$,Vt.needsUpdate=!0,Yf(Vt,rn,Pn),Vt.side=me,Vt.needsUpdate=!0,Yf(Vt,rn,Pn),Vt.side=_e):Yf(Vt,rn,Pn)}U=Jn.get(Ve),U.init(),Y.push(U),Ve.traverseVisible(function(Vt){Vt.isLight&&Vt.layers.test(Bt.layers)&&(U.pushLight(Vt),Vt.castShadow&&U.pushShadow(Vt))}),U.setupLights(H.physicallyCorrectLights),Ve.traverse(function(Vt){const rn=Vt.material;if(rn)if(Array.isArray(rn))for(let Pn=0;Pn<rn.length;Pn++)Ht(rn[Pn],Ve,Vt);else Ht(rn,Ve,Vt)}),Y.pop(),U=null};let os=null;function zo(){sd.stop()}function yy(){sd.start()}const sd=new qc;function by(Ve,Bt,Ht,Vt){if(Ve.visible===!1)return;if(Ve.layers.test(Bt.layers)){if(Ve.isGroup)Ht=Ve.renderOrder;else if(Ve.isLOD)Ve.autoUpdate===!0&&Ve.update(Bt);else if(Ve.isLight)U.pushLight(Ve),Ve.castShadow&&U.pushShadow(Ve);else if(Ve.isSprite){if(!Ve.frustumCulled||Ct.intersectsSprite(Ve)){Vt&&Ti.setFromMatrixPosition(Ve.matrixWorld).applyMatrix4(on);const Pn=Nt.update(Ve),Wi=Ve.material;Wi.visible&&z.push(Ve,Pn,Wi,Ht,Ti.z,null)}}else if((Ve.isMesh||Ve.isLine||Ve.isPoints)&&(Ve.isSkinnedMesh&&Ve.skeleton.frame!==at.render.frame&&(Ve.skeleton.update(),Ve.skeleton.frame=at.render.frame),!Ve.frustumCulled||Ct.intersectsObject(Ve))){Vt&&Ti.setFromMatrixPosition(Ve.matrixWorld).applyMatrix4(on);const Pn=Nt.update(Ve),Wi=Ve.material;if(Array.isArray(Wi)){const Kn=Pn.groups;for(let Ii=0,Hr=Kn.length;Ii<Hr;Ii++){const qi=Kn[Ii],wi=Wi[qi.materialIndex];wi&&wi.visible&&z.push(Ve,Pn,wi,Ht,Ti.z,qi)}}else Wi.visible&&z.push(Ve,Pn,Wi,Ht,Ti.z,null)}}const rn=Ve.children;for(let Pn=0,Wi=rn.length;Pn<Wi;Pn++)by(rn[Pn],Bt,Ht,Vt)}function wy(Ve,Bt,Ht,Vt){const rn=Ve.opaque,Pn=Ve.transmissive,Wi=Ve.transparent;if(U.setupLightsView(Ht),H.userData.transmissionRender===void 0&&H.userData.renderTransmissionPass!==!1&&Pn.length>0&&function(Kn,Ii,Hr){console.error("three.js internal render transmission pass should not be called");const qi=Ue.isWebGL2;Ut===null&&(Ut=new bo(1,1,{generateMipmaps:!0,type:He.has("EXT_color_buffer_half_float")?Gs:qr,minFilter:Sn,samples:qi&&g===!0?4:0})),H.getDrawingBufferSize(On),qi?Ut.setSize(On.x,On.y):Ut.setSize(ro(On.x),ro(On.y));const wi=H.getRenderTarget();H.setRenderTarget(Ut),H.clear();const bs=H.toneMapping;H.toneMapping=Xn,Yg(Kn,Ii,Hr),H.toneMapping=bs,st.updateMultisampleRenderTarget(Ut),st.updateRenderTargetMipmap(Ut),H.setRenderTarget(wi)}([...rn,...Wi],Bt,Ht),Vt&&mt.viewport(Pe.copy(Vt)),H.userData.opaqueRender!==!1&&rn.length>0&&Yg(rn,Bt,Ht),H.userData.transparentRender!==!1&&Wi.length>0&&Yg(Wi,Bt,Ht),H.userData.transmissionRender!==!1&&Pn.length>0){Ut||(Ut=new bo(1,1));const Kn=H.userData.transmissionRenderTarget.texture,Ii=Ue.isWebGL2,Hr=Kn.generateMipmaps,qi=Kn.minFilter;Ii&&H.userData.blurTransmissionTarget&&(Kn.generateMipmaps=!0,Kn.minFilter=Sn,Kn.needsUpdate=!0,st.updateRenderTargetMipmap(H.userData.transmissionRenderTarget)),Yg(Pn,Bt,Ht),Ii&&H.userData.blurTransmissionTarget&&(Kn.generateMipmaps=Hr,Kn.minFilter=qi,Kn.needsUpdate=!0,st.updateRenderTargetMipmap(H.userData.transmissionRenderTarget))}mt.buffers.depth.setTest(!0),mt.buffers.depth.setMask(!0),mt.buffers.color.setMask(!0),mt.setPolygonOffset(!1)}function Yg(Ve,Bt,Ht){const Vt={...H.userData};H.userData.opaqueRender=void 0,H.userData.transparentRender=void 0,H.userData.transmissionRender=void 0,H.userData.backgroundRender=void 0;const rn=Bt.isScene===!0?Bt.overrideMaterial:null;for(let Pn=0,Wi=Ve.length;Pn<Wi;Pn++){const Kn=Ve[Pn],Ii=Kn.object,Hr=Kn.geometry,qi=rn===null?Kn.material:rn,wi=Kn.group;Ii.layers.test(Ht.layers)&&Tw(Ii,Bt,Ht,Hr,qi,wi)}Object.assign(H.userData,Vt)}function Tw(Ve,Bt,Ht,Vt,rn,Pn){Ve.onBeforeRender(H,Bt,Ht,Vt,rn,Pn),Ve.modelViewMatrix.multiplyMatrices(Ht.matrixWorldInverse,Ve.matrixWorld),Ve.normalMatrix.getNormalMatrix(Ve.modelViewMatrix),rn.onBeforeRender(H,Bt,Ht,Vt,Ve,Pn),rn.transparent===!0&&rn.side===_e?(rn.side=$,rn.needsUpdate=!0,H.renderBufferDirect(Ht,Bt,Vt,rn,Ve,Pn),rn.side=me,rn.needsUpdate=!0,H.renderBufferDirect(Ht,Bt,Vt,rn,Ve,Pn),rn.side=_e):H.renderBufferDirect(Ht,Bt,Vt,rn,Ve,Pn),Ve.onAfterRender(H,Bt,Ht,Vt,rn,Pn),rn.onAfterRender(H,Bt,Ht,Vt,Ve,Pn)}function Yf(Ve,Bt,Ht){Bt.isScene!==!0&&(Bt=Fn);const Vt=We.get(Ve),rn=U.state.lights,Pn=U.state.shadowsArray,Wi=rn.state.version,Kn=Gt.getParameters(Ve,rn.state,Pn,Bt,Ht),Ii=Gt.getProgramCacheKey(Kn);let Hr=Vt.programs;Vt.environment=Ve.isMeshStandardMaterial?Bt.environment:null,Vt.fog=Bt.fog,Vt.envMap=(Ve.isMeshStandardMaterial?Ae:Tt).get(Ve.envMap||Vt.environment),Hr===void 0&&(Ve.addEventListener("dispose",Ni),Hr=new Map,Vt.programs=Hr);let qi=Hr.get(Ii);if(qi!==void 0){if(Vt.currentProgram===qi&&Vt.lightsStateVersion===Wi)return e0(Ve,Kn),qi}else Kn.uniforms=Gt.getUniforms(Ve),Ve.onBuild(Ht,Kn,H),Ve.onBeforeCompile(Kn,H),qi=Gt.acquireProgram(Kn,Ii),Hr.set(Ii,qi),Vt.uniforms=Kn.uniforms;const wi=Vt.uniforms;(Ve.isShaderMaterial||Ve.isRawShaderMaterial)&&Ve.clipping!==!0||(wi.clippingPlanes=fi.uniform),e0(Ve,Kn),Vt.needsLights=function(nl){return nl.isMeshLambertMaterial||nl.isMeshToonMaterial||nl.isMeshPhongMaterial||nl.isMeshStandardMaterial||nl.isShadowMaterial||nl.isShaderMaterial&&nl.lights===!0}(Ve),Vt.lightsStateVersion=Wi,Vt.needsLights&&(wi.ambientLightColor.value=rn.state.ambient,wi.lightProbe.value=rn.state.probe,wi.directionalLights.value=rn.state.directional,wi.directionalLightShadows.value=rn.state.directionalShadow,wi.spotLights.value=rn.state.spot,wi.spotLightShadows.value=rn.state.spotShadow,wi.rectAreaLights.value=rn.state.rectArea,wi.ltc_1.value=rn.state.rectAreaLTC1,wi.ltc_2.value=rn.state.rectAreaLTC2,wi.pointLights.value=rn.state.point,wi.pointLightShadows.value=rn.state.pointShadow,wi.hemisphereLights.value=rn.state.hemi,wi.directionalShadowMap.value=rn.state.directionalShadowMap,wi.directionalShadowMatrix.value=rn.state.directionalShadowMatrix,wi.spotShadowMap.value=rn.state.spotShadowMap,wi.spotLightMatrix.value=rn.state.spotLightMatrix,wi.spotLightMap.value=rn.state.spotLightMap,wi.pointShadowMap.value=rn.state.pointShadowMap,wi.pointShadowMatrix.value=rn.state.pointShadowMatrix);const bs=qi.getUniforms(),Xf=Hm.seqWithValue(bs.seq,wi);return Vt.currentProgram=qi,Vt.uniformsList=Xf,qi}function e0(Ve,Bt){const Ht=We.get(Ve);Ht.outputEncoding=Bt.outputEncoding,Ht.instancing=Bt.instancing,Ht.skinning=Bt.skinning,Ht.morphTargets=Bt.morphTargets,Ht.morphNormals=Bt.morphNormals,Ht.morphColors=Bt.morphColors,Ht.morphTargetsCount=Bt.morphTargetsCount,Ht.numClippingPlanes=Bt.numClippingPlanes,Ht.numIntersection=Bt.numClipIntersection,Ht.vertexAlphas=Bt.vertexAlphas,Ht.vertexTangents=Bt.vertexTangents,Ht.toneMapping=Bt.toneMapping}sd.setAnimationLoop(function(Ve){os&&os(Ve)}),typeof self<"u"&&sd.setContext(self),this.setAnimationLoop=function(Ve){os=Ve,jo.setAnimationLoop(Ve),Ve===null?sd.stop():sd.start()},jo.addEventListener("sessionstart",zo),jo.addEventListener("sessionend",yy),this.render=function(Ve,Bt){if(Bt===void 0||Bt.isCamera===!0){if(ne!==!0){if(Ve.matrixWorldAutoUpdate===!0&&Ve.updateMatrixWorld(),Bt.parent===null&&Bt.matrixWorldAutoUpdate===!0&&Bt.updateMatrixWorld(),jo.enabled===!0&&jo.isPresenting===!0&&(jo.cameraAutoUpdate===!0&&jo.updateCamera(Bt),Bt=jo.getCamera()),Ve.isScene===!0&&Ve.onBeforeRender(H,Ve,Bt,ve),U=Jn.get(Ve,Y.length),U.init(),Y.push(U),on.multiplyMatrices(Bt.projectionMatrix,Bt.matrixWorldInverse),Ct.setFromProjectionMatrix(on),nn=this.localClippingEnabled,Dt=fi.init(this.clippingPlanes,nn,Bt),z=Un.get(Ve,Q.length),z.init(),Q.push(z),by(Ve,Bt,0,H.sortObjects),z.finish(),H.sortObjects===!0&&z.sort(Ft,$t),H.userData.shadowMapRender){Dt===!0&&fi.beginShadows();const Ht=U.state.shadowsArray;Ht.length>0&&Yn.render(Ht,Ve,Bt),Dt===!0&&fi.endShadows()}if(this.info.autoReset===!0&&this.info.reset(),H.userData.backgroundRender!==!1&&$n.render(z,Ve),H.userData.sceneRender!==!1)if(U.setupLights(H.physicallyCorrectLights),Bt.isArrayCamera){const Ht=Bt.cameras;for(let Vt=0,rn=Ht.length;Vt<rn;Vt++){const Pn=Ht[Vt];wy(z,Ve,Pn,Pn.viewport)}}else wy(z,Ve,Bt);ve!==null&&(st.updateMultisampleRenderTarget(ve),st.updateRenderTargetMipmap(ve)),Ve.isScene===!0&&Ve.onAfterRender(H,Ve,Bt),yr.resetDefaultState(),Ee=-1,Me=null,Y.pop(),U=Y.length>0?Y[Y.length-1]:null,Q.pop(),z=Q.length>0?Q[Q.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return ie},this.getActiveMipmapLevel=function(){return re},this.getRenderTarget=function(){return ve},this.setRenderTargetTextures=function(Ve,Bt,Ht){We.get(Ve.texture).__webglTexture=Bt,We.get(Ve.depthTexture).__webglTexture=Ht;const Vt=We.get(Ve);Vt.__hasExternalTextures=!0,Vt.__hasExternalTextures&&(Vt.__autoAllocateDepthBuffer=Ht===void 0,Vt.__autoAllocateDepthBuffer||He.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Vt.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(Ve,Bt){const Ht=We.get(Ve);Ht.__webglFramebuffer=Bt,Ht.__useDefaultFramebuffer=Bt===void 0},this.setRenderTarget=function(Ve,Bt=0,Ht=0){ve=Ve,ie=Bt,re=Ht;let Vt=!0;if(Ve){const Kn=We.get(Ve);Kn.__useDefaultFramebuffer!==void 0?(mt.bindFramebuffer(36160,null),Vt=!1):Kn.__webglFramebuffer===void 0?st.setupRenderTarget(Ve):Kn.__hasExternalTextures&&st.rebindTextures(Ve,We.get(Ve.texture).__webglTexture,We.get(Ve.depthTexture).__webglTexture)}let rn=null,Pn=!1,Wi=!1;if(Ve){const Kn=Ve.texture;(Kn.isData3DTexture||Kn.isDataArrayTexture)&&(Wi=!0);const Ii=We.get(Ve).__webglFramebuffer;Ve.isWebGLCubeRenderTarget?(rn=Ii[Bt],Pn=!0):rn=Ue.isWebGL2&&Ve.samples>0&&st.useMultisampledRTT(Ve)===!1?We.get(Ve).__webglMultisampledFramebuffer:Ii,Pe.copy(Ve.viewport),Ye.copy(Ve.scissor),Ke=Ve.scissorTest}else Pe.copy(Lt).multiplyScalar(Ze).floor(),Ye.copy(an).multiplyScalar(Ze).floor(),Ke=ln;if(mt.bindFramebuffer(36160,rn)&&Ue.drawBuffers&&Vt&&mt.drawBuffers(Ve,rn),mt.viewport(Pe),mt.scissor(Ye),mt.setScissorTest(Ke),Pn){const Kn=We.get(Ve.texture);An.framebufferTexture2D(36160,36064,34069+Bt,Kn.__webglTexture,Ht)}else if(Wi){const Kn=We.get(Ve.texture),Ii=Bt||0;An.framebufferTextureLayer(36160,36064,Kn.__webglTexture,Ht||0,Ii)}Ee=-1},this.readRenderTargetPixels=function(Ve,Bt,Ht,Vt,rn,Pn,Wi){if(!Ve||!Ve.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let Kn=We.get(Ve).__webglFramebuffer;if(Ve.isWebGLCubeRenderTarget&&Wi!==void 0&&(Kn=Kn[Wi]),Kn){mt.bindFramebuffer(36160,Kn);try{const Ii=Ve.texture,Hr=Ii.format,qi=Ii.type;if(Hr!==Nn&&Ar.convert(Hr)!==An.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const wi=qi===Gs&&(He.has("EXT_color_buffer_half_float")||Ue.isWebGL2&&He.has("EXT_color_buffer_float"));if(!(qi===qr||Ar.convert(qi)===An.getParameter(35738)||qi===_r&&(Ue.isWebGL2||He.has("OES_texture_float")||He.has("WEBGL_color_buffer_float"))||wi))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Bt>=0&&Bt<=Ve.width-Vt&&Ht>=0&&Ht<=Ve.height-rn&&An.readPixels(Bt,Ht,Vt,rn,Ar.convert(Hr),Ar.convert(qi),Pn)}finally{const Ii=ve!==null?We.get(ve).__webglFramebuffer:null;mt.bindFramebuffer(36160,Ii)}}},this.copyFramebufferToTexture=function(Ve,Bt,Ht=0){const Vt=Math.pow(2,-Ht),rn=Math.floor(Bt.image.width*Vt),Pn=Math.floor(Bt.image.height*Vt);st.setTexture2D(Bt,0),An.copyTexSubImage2D(3553,Ht,0,0,Ve.x,Ve.y,rn,Pn),mt.unbindTexture()},this.copyTextureToTexture=function(Ve,Bt,Ht,Vt=0){const rn=Bt.image.width,Pn=Bt.image.height,Wi=Ar.convert(Ht.format),Kn=Ar.convert(Ht.type);st.setTexture2D(Ht,0),An.pixelStorei(37440,Ht.flipY),An.pixelStorei(37441,Ht.premultiplyAlpha),An.pixelStorei(3317,Ht.unpackAlignment),Bt.isDataTexture?An.texSubImage2D(3553,Vt,Ve.x,Ve.y,rn,Pn,Wi,Kn,Bt.image.data):Bt.isCompressedTexture?An.compressedTexSubImage2D(3553,Vt,Ve.x,Ve.y,Bt.mipmaps[0].width,Bt.mipmaps[0].height,Wi,Bt.mipmaps[0].data):An.texSubImage2D(3553,Vt,Ve.x,Ve.y,Wi,Kn,Bt.image),Vt===0&&Ht.generateMipmaps&&An.generateMipmap(3553),mt.unbindTexture()},this.copyTextureToTexture3D=function(Ve,Bt,Ht,Vt,rn=0){if(H.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Pn=Ve.max.x-Ve.min.x+1,Wi=Ve.max.y-Ve.min.y+1,Kn=Ve.max.z-Ve.min.z+1,Ii=Ar.convert(Vt.format),Hr=Ar.convert(Vt.type);let qi;if(Vt.isData3DTexture)st.setTexture3D(Vt,0),qi=32879;else{if(!Vt.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");st.setTexture2DArray(Vt,0),qi=35866}An.pixelStorei(37440,Vt.flipY),An.pixelStorei(37441,Vt.premultiplyAlpha),An.pixelStorei(3317,Vt.unpackAlignment);const wi=An.getParameter(3314),bs=An.getParameter(32878),Xf=An.getParameter(3316),nl=An.getParameter(3315),Xg=An.getParameter(32877),mc=Ht.isCompressedTexture?Ht.mipmaps[0]:Ht.image;An.pixelStorei(3314,mc.width),An.pixelStorei(32878,mc.height),An.pixelStorei(3316,Ve.min.x),An.pixelStorei(3315,Ve.min.y),An.pixelStorei(32877,Ve.min.z),Ht.isDataTexture||Ht.isData3DTexture?An.texSubImage3D(qi,rn,Bt.x,Bt.y,Bt.z,Pn,Wi,Kn,Ii,Hr,mc.data):Ht.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),An.compressedTexSubImage3D(qi,rn,Bt.x,Bt.y,Bt.z,Pn,Wi,Kn,Ii,mc.data)):An.texSubImage3D(qi,rn,Bt.x,Bt.y,Bt.z,Pn,Wi,Kn,Ii,Hr,mc),An.pixelStorei(3314,wi),An.pixelStorei(32878,bs),An.pixelStorei(3316,Xf),An.pixelStorei(3315,nl),An.pixelStorei(32877,Xg),rn===0&&Vt.generateMipmaps&&An.generateMipmap(qi),mt.unbindTexture()},this.initTexture=function(Ve){Ve.isCubeTexture?st.setTextureCube(Ve,0):Ve.isData3DTexture?st.setTexture3D(Ve,0):Ve.isDataArrayTexture?st.setTexture2DArray(Ve,0):st.setTexture2D(Ve,0),mt.unbindTexture()},this.resetState=function(){ie=0,re=0,ve=null,mt.reset(),yr.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}class cv extends ns{}cv.prototype.isWebGL1Renderer=!0;class qu{constructor(i,l=25e-5){this.isFogExp2=!0,this.name="",this.color=new bn(i),this.density=l}clone(){return new qu(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}class Yd{constructor(i,l=1,h=1e3){this.isFog=!0,this.name="",this.color=new bn(i),this.near=l,this.far=h}clone(){return new Yd(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}class CA extends pi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(i,l){return super.copy(i,l),i.background!==null&&(this.background=i.background.clone()),i.environment!==null&&(this.environment=i.environment.clone()),i.fog!==null&&(this.fog=i.fog.clone()),i.overrideMaterial!==null&&(this.overrideMaterial=i.overrideMaterial.clone()),this.matrixAutoUpdate=i.matrixAutoUpdate,this}toJSON(i){const l=super.toJSON(i);return this.fog!==null&&(l.object.fog=this.fog.toJSON()),l}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(i){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=i}}class Zm{constructor(i,l){this.isInterleavedBuffer=!0,this.array=i,this.stride=l,this.count=i!==void 0?i.length/l:0,this.usage=Bc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Ws()}onUploadCallback(){}set needsUpdate(i){i===!0&&this.version++}setUsage(i){return this.usage=i,this}copy(i){return this.array=new i.array.constructor(i.array),this.count=i.count,this.stride=i.stride,this.usage=i.usage,this}copyAt(i,l,h){i*=this.stride,h*=l.stride;for(let d=0,g=this.stride;d<g;d++)this.array[i+d]=l.array[h+d];return this}set(i,l=0){return this.array.set(i,l),this}clone(i){i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const l=new this.array.constructor(i.arrayBuffers[this.array.buffer._uuid]),h=new this.constructor(l,this.stride);return h.setUsage(this.usage),h}onUpload(i){return this.onUploadCallback=i,this}toJSON(i){return i.arrayBuffers===void 0&&(i.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ws()),i.arrayBuffers[this.array.buffer._uuid]===void 0&&(i.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const So=new Re;class oc{constructor(i,l,h,d=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=i,this.itemSize=l,this.offset=h,this.normalized=d===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(i){this.data.needsUpdate=i}applyMatrix4(i){for(let l=0,h=this.data.count;l<h;l++)So.fromBufferAttribute(this,l),So.applyMatrix4(i),this.setXYZ(l,So.x,So.y,So.z);return this}applyNormalMatrix(i){for(let l=0,h=this.count;l<h;l++)So.fromBufferAttribute(this,l),So.applyNormalMatrix(i),this.setXYZ(l,So.x,So.y,So.z);return this}transformDirection(i){for(let l=0,h=this.count;l<h;l++)So.fromBufferAttribute(this,l),So.transformDirection(i),this.setXYZ(l,So.x,So.y,So.z);return this}setX(i,l){return this.normalized&&(l=vr(l,this.array)),this.data.array[i*this.data.stride+this.offset]=l,this}setY(i,l){return this.normalized&&(l=vr(l,this.array)),this.data.array[i*this.data.stride+this.offset+1]=l,this}setZ(i,l){return this.normalized&&(l=vr(l,this.array)),this.data.array[i*this.data.stride+this.offset+2]=l,this}setW(i,l){return this.normalized&&(l=vr(l,this.array)),this.data.array[i*this.data.stride+this.offset+3]=l,this}getX(i){let l=this.data.array[i*this.data.stride+this.offset];return this.normalized&&(l=gl(l,this.array)),l}getY(i){let l=this.data.array[i*this.data.stride+this.offset+1];return this.normalized&&(l=gl(l,this.array)),l}getZ(i){let l=this.data.array[i*this.data.stride+this.offset+2];return this.normalized&&(l=gl(l,this.array)),l}getW(i){let l=this.data.array[i*this.data.stride+this.offset+3];return this.normalized&&(l=gl(l,this.array)),l}setXY(i,l,h){return i=i*this.data.stride+this.offset,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=h,this}setXYZ(i,l,h,d){return i=i*this.data.stride+this.offset,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array),d=vr(d,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=h,this.data.array[i+2]=d,this}setXYZW(i,l,h,d,g){return i=i*this.data.stride+this.offset,this.normalized&&(l=vr(l,this.array),h=vr(h,this.array),d=vr(d,this.array),g=vr(g,this.array)),this.data.array[i+0]=l,this.data.array[i+1]=h,this.data.array[i+2]=d,this.data.array[i+3]=g,this}clone(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");const l=[];for(let h=0;h<this.count;h++){const d=h*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)l.push(this.data.array[d+g])}return new mr(new this.array.constructor(l),this.itemSize,this.normalized)}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.clone(i)),new oc(i.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(i){if(i===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");const l=[];for(let h=0;h<this.count;h++){const d=h*this.data.stride+this.offset;for(let g=0;g<this.itemSize;g++)l.push(this.data.array[d+g])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:l,normalized:this.normalized}}return i.interleavedBuffers===void 0&&(i.interleavedBuffers={}),i.interleavedBuffers[this.data.uuid]===void 0&&(i.interleavedBuffers[this.data.uuid]=this.data.toJSON(i)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class eg extends Bs{constructor(i){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new bn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.rotation=i.rotation,this.sizeAttenuation=i.sizeAttenuation,this.fog=i.fog,this}}let Yu;const Kc=new Re,Qh=new Re,ac=new Re,Jc=new Xt,Hh=new Xt,MA=new ti,Xu=new Re,Ku=new Re,sf=new Re,tg=new Xt,ng=new Xt,TA=new Xt;class ig extends pi{constructor(i){if(super(),this.isSprite=!0,this.type="Sprite",Yu===void 0){Yu=new In;const l=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),h=new Zm(l,5);Yu.setIndex([0,1,2,0,2,3]),Yu.setAttribute("position",new oc(h,3,0,!1)),Yu.setAttribute("uv",new oc(h,2,3,!1))}this.geometry=Yu,this.material=i!==void 0?i:new eg,this.center=new Xt(.5,.5)}raycast(i,l){i.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Qh.setFromMatrixScale(this.matrixWorld),MA.copy(i.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(i.camera.matrixWorldInverse,this.matrixWorld),ac.setFromMatrixPosition(this.modelViewMatrix),i.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Qh.multiplyScalar(-ac.z);const h=this.material.rotation;let d,g;h!==0&&(g=Math.cos(h),d=Math.sin(h));const v=this.center;$c(Xu.set(-.5,-.5,0),ac,v,Qh,d,g),$c(Ku.set(.5,-.5,0),ac,v,Qh,d,g),$c(sf.set(.5,.5,0),ac,v,Qh,d,g),tg.set(0,0),ng.set(1,0),TA.set(1,1);let b=i.ray.intersectTriangle(Xu,Ku,sf,!1,Kc);if(b===null&&($c(Ku.set(-.5,.5,0),ac,v,Qh,d,g),ng.set(0,1),b=i.ray.intersectTriangle(Xu,sf,Ku,!1,Kc),b===null))return;const T=i.ray.origin.distanceTo(Kc);T<i.near||T>i.far||l.push({distance:T,point:Kc.clone(),uv:Rs.getUV(Kc,Xu,Ku,sf,tg,ng,TA,new Xt),face:null,object:this})}copy(i,l){return super.copy(i,l),i.center!==void 0&&this.center.copy(i.center),this.material=i.material,this}}function $c(x,i,l,h,d,g){Jc.subVectors(x,l).addScalar(.5).multiply(h),d!==void 0?(Hh.x=g*Jc.x-d*Jc.y,Hh.y=d*Jc.x+g*Jc.y):Hh.copy(Jc),x.copy(i),x.x+=Hh.x,x.y+=Hh.y,x.applyMatrix4(MA)}const Xd=new Re,IA=new Re;class Kd extends pi{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(i){super.copy(i,!1);const l=i.levels;for(let h=0,d=l.length;h<d;h++){const g=l[h];this.addLevel(g.object.clone(),g.distance)}return this.autoUpdate=i.autoUpdate,this}addLevel(i,l=0){l=Math.abs(l);const h=this.levels;let d;for(d=0;d<h.length&&!(l<h[d].distance);d++);return h.splice(d,0,{distance:l,object:i}),this.add(i),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(i){const l=this.levels;if(l.length>0){let h,d;for(h=1,d=l.length;h<d&&!(i<l[h].distance);h++);return l[h-1].object}return null}raycast(i,l){if(this.levels.length>0){Xd.setFromMatrixPosition(this.matrixWorld);const h=i.ray.origin.distanceTo(Xd);this.getObjectForDistance(h).raycast(i,l)}}update(i){const l=this.levels;if(l.length>1){Xd.setFromMatrixPosition(i.matrixWorld),IA.setFromMatrixPosition(this.matrixWorld);const h=Xd.distanceTo(IA)/i.zoom;let d,g;for(l[0].object.visible=!0,d=1,g=l.length;d<g&&h>=l[d].distance;d++)l[d-1].object.visible=!1,l[d].object.visible=!0;for(this._currentLevel=d-1;d<g;d++)l[d].object.visible=!1}}toJSON(i){const l=super.toJSON(i);this.autoUpdate===!1&&(l.object.autoUpdate=!1),l.object.levels=[];const h=this.levels;for(let d=0,g=h.length;d<g;d++){const v=h[d];l.object.levels.push({object:v.object.uuid,distance:v.distance})}return l}}const Wh=new Re,PA=new Zi,DA=new Zi,RA=new Re,rg=new ti;class uv extends ks{constructor(i,l){super(i,l),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ti,this.bindMatrixInverse=new ti}copy(i,l){return super.copy(i,l),this.bindMode=i.bindMode,this.bindMatrix.copy(i.bindMatrix),this.bindMatrixInverse.copy(i.bindMatrixInverse),this.skeleton=i.skeleton,this}bind(i,l){this.skeleton=i,l===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),l=this.matrixWorld),this.bindMatrix.copy(l),this.bindMatrixInverse.copy(l).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const i=new Zi,l=this.geometry.attributes.skinWeight;for(let h=0,d=l.count;h<d;h++){i.fromBufferAttribute(l,h);const g=1/i.manhattanLength();g!==1/0?i.multiplyScalar(g):i.set(1,0,0,0),l.setXYZW(h,i.x,i.y,i.z,i.w)}}updateMatrixWorld(i){super.updateMatrixWorld(i),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(i,l){const h=this.skeleton,d=this.geometry;PA.fromBufferAttribute(d.attributes.skinIndex,i),DA.fromBufferAttribute(d.attributes.skinWeight,i),Wh.copy(l).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let g=0;g<4;g++){const v=DA.getComponent(g);if(v!==0){const b=PA.getComponent(g);rg.multiplyMatrices(h.bones[b].matrixWorld,h.boneInverses[b]),l.addScaledVector(RA.copy(Wh).applyMatrix4(rg),v)}}return l.applyMatrix4(this.bindMatrixInverse)}}class hv extends pi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Jd extends fs{constructor(i=null,l=1,h=1,d,g,v,b,T,I=ar,N=ar,z,U){super(null,v,b,T,I,N,d,g,z,U),this.isDataTexture=!0,this.image={data:i,width:l,height:h},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const dv=new ti,BA=new ti;class of{constructor(i=[],l=[]){this.uuid=Ws(),this.bones=i.slice(0),this.boneInverses=l,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const i=this.bones,l=this.boneInverses;if(this.boneMatrices=new Float32Array(16*i.length),l.length===0)this.calculateInverses();else if(i.length!==l.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let h=0,d=this.bones.length;h<d;h++)this.boneInverses.push(new ti)}}calculateInverses(){this.boneInverses.length=0;for(let i=0,l=this.bones.length;i<l;i++){const h=new ti;this.bones[i]&&h.copy(this.bones[i].matrixWorld).invert(),this.boneInverses.push(h)}}pose(){for(let i=0,l=this.bones.length;i<l;i++){const h=this.bones[i];h&&h.matrixWorld.copy(this.boneInverses[i]).invert()}for(let i=0,l=this.bones.length;i<l;i++){const h=this.bones[i];h&&(h.parent&&h.parent.isBone?(h.matrix.copy(h.parent.matrixWorld).invert(),h.matrix.multiply(h.matrixWorld)):h.matrix.copy(h.matrixWorld),h.matrix.decompose(h.position,h.quaternion,h.scale))}}update(){const i=this.bones,l=this.boneInverses,h=this.boneMatrices,d=this.boneTexture;for(let g=0,v=i.length;g<v;g++){const b=i[g]?i[g].matrixWorld:BA;dv.multiplyMatrices(b,l[g]),dv.toArray(h,16*g)}d!==null&&(d.needsUpdate=!0)}clone(){return new of(this.bones,this.boneInverses)}computeBoneTexture(){let i=Math.sqrt(4*this.bones.length);i=Kl(i),i=Math.max(i,4);const l=new Float32Array(i*i*4);l.set(this.boneMatrices);const h=new Jd(l,i,i,Nn,_r);return h.needsUpdate=!0,this.boneMatrices=l,this.boneTexture=h,this.boneTextureSize=i,this}getBoneByName(i){for(let l=0,h=this.bones.length;l<h;l++){const d=this.bones[l];if(d.name===i)return d}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(i,l){this.uuid=i.uuid;for(let h=0,d=i.bones.length;h<d;h++){const g=i.bones[h];let v=l[g];v===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",g),v=new hv),this.bones.push(v),this.boneInverses.push(new ti().fromArray(i.boneInverses[h]))}return this.init(),this}toJSON(){const i={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};i.uuid=this.uuid;const l=this.bones,h=this.boneInverses;for(let d=0,g=l.length;d<g;d++){const v=l[d];i.bones.push(v.uuid);const b=h[d];i.boneInverses.push(b.toArray())}return i}}class qh extends mr{constructor(i,l,h,d=1){super(i,l,h),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=d}copy(i){return super.copy(i),this.meshPerAttribute=i.meshPerAttribute,this}toJSON(){const i=super.toJSON();return i.meshPerAttribute=this.meshPerAttribute,i.isInstancedBufferAttribute=!0,i}}const pv=new ti,kA=new ti,af=[],lf=new ks;class sg extends ks{constructor(i,l,h){super(i,l),this.isInstancedMesh=!0,this.instanceMatrix=new qh(new Float32Array(16*h),16),this.instanceColor=null,this.count=h,this.frustumCulled=!1}copy(i,l){return super.copy(i,l),this.instanceMatrix.copy(i.instanceMatrix),i.instanceColor!==null&&(this.instanceColor=i.instanceColor.clone()),this.count=i.count,this}getColorAt(i,l){l.fromArray(this.instanceColor.array,3*i)}getMatrixAt(i,l){l.fromArray(this.instanceMatrix.array,16*i)}raycast(i,l){const h=this.matrixWorld,d=this.count;if(lf.geometry=this.geometry,lf.material=this.material,lf.material!==void 0)for(let g=0;g<d;g++){this.getMatrixAt(g,pv),kA.multiplyMatrices(h,pv),lf.matrixWorld=kA,lf.raycast(i,af);for(let v=0,b=af.length;v<b;v++){const T=af[v];T.instanceId=g,T.object=this,l.push(T)}af.length=0}}setColorAt(i,l){this.instanceColor===null&&(this.instanceColor=new qh(new Float32Array(3*this.instanceMatrix.count),3)),l.toArray(this.instanceColor.array,3*i)}setMatrixAt(i,l){l.toArray(this.instanceMatrix.array,16*i)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}class Lo extends Bs{constructor(i){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new bn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.linewidth=i.linewidth,this.linecap=i.linecap,this.linejoin=i.linejoin,this.fog=i.fog,this}}const og=new Re,fv=new Re,mv=new ti,gv=new ec,cf=new ea;class lc extends pi{constructor(i=new In,l=new Lo){super(),this.isLine=!0,this.type="Line",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),this.material=i.material,this.geometry=i.geometry,this}computeLineDistances(){const i=this.geometry;if(i.index===null){const l=i.attributes.position,h=[0];for(let d=1,g=l.count;d<g;d++)og.fromBufferAttribute(l,d-1),fv.fromBufferAttribute(l,d),h[d]=h[d-1],h[d]+=og.distanceTo(fv);i.setAttribute("lineDistance",new E(h,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(i,l){const h=this.geometry,d=this.matrixWorld,g=i.params.Line.threshold,v=h.drawRange;if(h.boundingSphere===null&&h.computeBoundingSphere(),cf.copy(h.boundingSphere),cf.applyMatrix4(d),cf.radius+=g,i.ray.intersectsSphere(cf)===!1)return;mv.copy(d).invert(),gv.copy(i.ray).applyMatrix4(mv);const b=g/((this.scale.x+this.scale.y+this.scale.z)/3),T=b*b,I=new Re,N=new Re,z=new Re,U=new Re,Q=this.isLineSegments?2:1,Y=h.index,H=h.attributes.position;if(Y!==null)for(let ne=Math.max(0,v.start),ie=Math.min(Y.count,v.start+v.count)-1;ne<ie;ne+=Q){const re=Y.getX(ne),ve=Y.getX(ne+1);if(I.fromBufferAttribute(H,re),N.fromBufferAttribute(H,ve),gv.distanceSqToSegment(I,N,U,z)>T)continue;U.applyMatrix4(this.matrixWorld);const Ee=i.ray.origin.distanceTo(U);Ee<i.near||Ee>i.far||l.push({distance:Ee,point:z.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}else for(let ne=Math.max(0,v.start),ie=Math.min(H.count,v.start+v.count)-1;ne<ie;ne+=Q){if(I.fromBufferAttribute(H,ne),N.fromBufferAttribute(H,ne+1),gv.distanceSqToSegment(I,N,U,z)>T)continue;U.applyMatrix4(this.matrixWorld);const re=i.ray.origin.distanceTo(U);re<i.near||re>i.far||l.push({distance:re,point:z.clone().applyMatrix4(this.matrixWorld),index:ne,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,g=h.length;d<g;d++){const v=h[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=d}}}}}const OA=new Re,ag=new Re;class cc extends lc{constructor(i,l){super(i,l),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const i=this.geometry;if(i.index===null){const l=i.attributes.position,h=[];for(let d=0,g=l.count;d<g;d+=2)OA.fromBufferAttribute(l,d),ag.fromBufferAttribute(l,d+1),h[d]=d===0?0:h[d-1],h[d+1]=h[d]+OA.distanceTo(ag);i.setAttribute("lineDistance",new E(h,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class $d extends lc{constructor(i,l){super(i,l),this.isLineLoop=!0,this.type="LineLoop"}}class lg extends Bs{constructor(i){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new bn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.alphaMap=i.alphaMap,this.size=i.size,this.sizeAttenuation=i.sizeAttenuation,this.fog=i.fog,this}}const _v=new ti,cg=new ec,ug=new ea,uf=new Re;class hg extends pi{constructor(i=new In,l=new lg){super(),this.isPoints=!0,this.type="Points",this.geometry=i,this.material=l,this.updateMorphTargets()}copy(i,l){return super.copy(i,l),this.material=i.material,this.geometry=i.geometry,this}raycast(i,l){const h=this.geometry,d=this.matrixWorld,g=i.params.Points.threshold,v=h.drawRange;if(h.boundingSphere===null&&h.computeBoundingSphere(),ug.copy(h.boundingSphere),ug.applyMatrix4(d),ug.radius+=g,i.ray.intersectsSphere(ug)===!1)return;_v.copy(d).invert(),cg.copy(i.ray).applyMatrix4(_v);const b=g/((this.scale.x+this.scale.y+this.scale.z)/3),T=b*b,I=h.index,N=h.attributes.position;if(I!==null)for(let z=Math.max(0,v.start),U=Math.min(I.count,v.start+v.count);z<U;z++){const Q=I.getX(z);uf.fromBufferAttribute(N,Q),Zd(uf,Q,T,d,i,l,this)}else for(let z=Math.max(0,v.start),U=Math.min(N.count,v.start+v.count);z<U;z++)uf.fromBufferAttribute(N,z),Zd(uf,z,T,d,i,l,this)}updateMorphTargets(){const i=this.geometry.morphAttributes,l=Object.keys(i);if(l.length>0){const h=i[l[0]];if(h!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let d=0,g=h.length;d<g;d++){const v=h[d].name||String(d);this.morphTargetInfluences.push(0),this.morphTargetDictionary[v]=d}}}}}function Zd(x,i,l,h,d,g,v){const b=cg.distanceSqToPoint(x);if(b<l){const T=new Re;cg.closestPointToPoint(x,T),T.applyMatrix4(h);const I=d.ray.origin.distanceTo(T);if(I<d.near||I>d.far)return;g.push({distance:I,distanceToRay:Math.sqrt(b),point:T,index:i,face:null,object:v})}}class vv extends fs{constructor(i,l,h,d,g,v,b,T,I){super(i,l,h,d,g,v,b,T,I),this.isVideoTexture=!0,this.minFilter=v!==void 0?v:nr,this.magFilter=g!==void 0?g:nr,this.generateMipmaps=!1;const N=this;"requestVideoFrameCallback"in i&&i.requestVideoFrameCallback(function z(){N.needsUpdate=!0,i.requestVideoFrameCallback(z)})}clone(){return new this.constructor(this.image).copy(this)}update(){const i=this.image;!("requestVideoFrameCallback"in i)&&i.readyState>=i.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class hf extends fs{constructor(i,l,h){super({width:i,height:l}),this.isFramebufferTexture=!0,this.format=h,this.magFilter=ar,this.minFilter=ar,this.generateMipmaps=!1,this.needsUpdate=!0}}class df extends fs{constructor(i,l,h,d,g,v,b,T,I,N,z,U){super(null,v,b,T,I,N,d,g,z,U),this.isCompressedTexture=!0,this.image={width:l,height:h},this.mipmaps=i,this.flipY=!1,this.generateMipmaps=!1}}class Av extends fs{constructor(i,l,h,d,g,v,b,T,I){super(i,l,h,d,g,v,b,T,I),this.isCanvasTexture=!0,this.needsUpdate=!0}}class Il{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(i,l){const h=this.getUtoTmapping(i);return this.getPoint(h,l)}getPoints(i=5){const l=[];for(let h=0;h<=i;h++)l.push(this.getPoint(h/i));return l}getSpacedPoints(i=5){const l=[];for(let h=0;h<=i;h++)l.push(this.getPointAt(h/i));return l}getLength(){const i=this.getLengths();return i[i.length-1]}getLengths(i=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===i+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const l=[];let h,d=this.getPoint(0),g=0;l.push(0);for(let v=1;v<=i;v++)h=this.getPoint(v/i),g+=h.distanceTo(d),l.push(g),d=h;return this.cacheArcLengths=l,l}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(i,l){const h=this.getLengths();let d=0;const g=h.length;let v;v=l||i*h[g-1];let b,T=0,I=g-1;for(;T<=I;)if(d=Math.floor(T+(I-T)/2),b=h[d]-v,b<0)T=d+1;else{if(!(b>0)){I=d;break}I=d-1}if(d=I,h[d]===v)return d/(g-1);const N=h[d];return(d+(v-N)/(h[d+1]-N))/(g-1)}getTangent(i,l){let d=i-1e-4,g=i+1e-4;d<0&&(d=0),g>1&&(g=1);const v=this.getPoint(d),b=this.getPoint(g),T=l||(v.isVector2?new Xt:new Re);return T.copy(b).sub(v).normalize(),T}getTangentAt(i,l){const h=this.getUtoTmapping(i);return this.getTangent(h,l)}computeFrenetFrames(i,l){const h=new Re,d=[],g=[],v=[],b=new Re,T=new ti;for(let Q=0;Q<=i;Q++){const Y=Q/i;d[Q]=this.getTangentAt(Y,new Re)}g[0]=new Re,v[0]=new Re;let I=Number.MAX_VALUE;const N=Math.abs(d[0].x),z=Math.abs(d[0].y),U=Math.abs(d[0].z);N<=I&&(I=N,h.set(1,0,0)),z<=I&&(I=z,h.set(0,1,0)),U<=I&&h.set(0,0,1),b.crossVectors(d[0],h).normalize(),g[0].crossVectors(d[0],b),v[0].crossVectors(d[0],g[0]);for(let Q=1;Q<=i;Q++){if(g[Q]=g[Q-1].clone(),v[Q]=v[Q-1].clone(),b.crossVectors(d[Q-1],d[Q]),b.length()>Number.EPSILON){b.normalize();const Y=Math.acos(Vn(d[Q-1].dot(d[Q]),-1,1));g[Q].applyMatrix4(T.makeRotationAxis(b,Y))}v[Q].crossVectors(d[Q],g[Q])}if(l===!0){let Q=Math.acos(Vn(g[0].dot(g[i]),-1,1));Q/=i,d[0].dot(b.crossVectors(g[0],g[i]))>0&&(Q=-Q);for(let Y=1;Y<=i;Y++)g[Y].applyMatrix4(T.makeRotationAxis(d[Y],Q*Y)),v[Y].crossVectors(d[Y],g[Y])}return{tangents:d,normals:g,binormals:v}}clone(){return new this.constructor().copy(this)}copy(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}toJSON(){const i={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return i.arcLengthDivisions=this.arcLengthDivisions,i.type=this.type,i}fromJSON(i){return this.arcLengthDivisions=i.arcLengthDivisions,this}}class dg extends Il{constructor(i=0,l=0,h=1,d=1,g=0,v=2*Math.PI,b=!1,T=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=i,this.aY=l,this.xRadius=h,this.yRadius=d,this.aStartAngle=g,this.aEndAngle=v,this.aClockwise=b,this.aRotation=T}getPoint(i,l){const h=l||new Xt,d=2*Math.PI;let g=this.aEndAngle-this.aStartAngle;const v=Math.abs(g)<Number.EPSILON;for(;g<0;)g+=d;for(;g>d;)g-=d;g<Number.EPSILON&&(g=v?0:d),this.aClockwise!==!0||v||(g===d?g=-d:g-=d);const b=this.aStartAngle+i*g;let T=this.aX+this.xRadius*Math.cos(b),I=this.aY+this.yRadius*Math.sin(b);if(this.aRotation!==0){const N=Math.cos(this.aRotation),z=Math.sin(this.aRotation),U=T-this.aX,Q=I-this.aY;T=U*N-Q*z+this.aX,I=U*z+Q*N+this.aY}return h.set(T,I)}copy(i){return super.copy(i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this}toJSON(){const i=super.toJSON();return i.aX=this.aX,i.aY=this.aY,i.xRadius=this.xRadius,i.yRadius=this.yRadius,i.aStartAngle=this.aStartAngle,i.aEndAngle=this.aEndAngle,i.aClockwise=this.aClockwise,i.aRotation=this.aRotation,i}fromJSON(i){return super.fromJSON(i),this.aX=i.aX,this.aY=i.aY,this.xRadius=i.xRadius,this.yRadius=i.yRadius,this.aStartAngle=i.aStartAngle,this.aEndAngle=i.aEndAngle,this.aClockwise=i.aClockwise,this.aRotation=i.aRotation,this}}class LA extends dg{constructor(i,l,h,d,g,v){super(i,l,h,h,d,g,v),this.isArcCurve=!0,this.type="ArcCurve"}}function pg(){let x=0,i=0,l=0,h=0;function d(g,v,b,T){x=g,i=b,l=-3*g+3*v-2*b-T,h=2*g-2*v+b+T}return{initCatmullRom:function(g,v,b,T,I){d(v,b,I*(b-g),I*(T-v))},initNonuniformCatmullRom:function(g,v,b,T,I,N,z){let U=(v-g)/I-(b-g)/(I+N)+(b-v)/N,Q=(b-v)/N-(T-v)/(N+z)+(T-b)/z;U*=N,Q*=N,d(v,b,U,Q)},calc:function(g){const v=g*g;return x+i*g+l*v+h*(v*g)}}}const fg=new Re,mg=new pg,yv=new pg,gg=new pg;class NA extends Il{constructor(i=[],l=!1,h="centripetal",d=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=i,this.closed=l,this.curveType=h,this.tension=d}getPoint(i,l=new Re){const h=l,d=this.points,g=d.length,v=(g-(this.closed?0:1))*i;let b,T,I=Math.floor(v),N=v-I;this.closed?I+=I>0?0:(Math.floor(Math.abs(I)/g)+1)*g:N===0&&I===g-1&&(I=g-2,N=1),this.closed||I>0?b=d[(I-1)%g]:(fg.subVectors(d[0],d[1]).add(d[0]),b=fg);const z=d[I%g],U=d[(I+1)%g];if(this.closed||I+2<g?T=d[(I+2)%g]:(fg.subVectors(d[g-1],d[g-2]).add(d[g-1]),T=fg),this.curveType==="centripetal"||this.curveType==="chordal"){const Q=this.curveType==="chordal"?.5:.25;let Y=Math.pow(b.distanceToSquared(z),Q),H=Math.pow(z.distanceToSquared(U),Q),ne=Math.pow(U.distanceToSquared(T),Q);H<1e-4&&(H=1),Y<1e-4&&(Y=H),ne<1e-4&&(ne=H),mg.initNonuniformCatmullRom(b.x,z.x,U.x,T.x,Y,H,ne),yv.initNonuniformCatmullRom(b.y,z.y,U.y,T.y,Y,H,ne),gg.initNonuniformCatmullRom(b.z,z.z,U.z,T.z,Y,H,ne)}else this.curveType==="catmullrom"&&(mg.initCatmullRom(b.x,z.x,U.x,T.x,this.tension),yv.initCatmullRom(b.y,z.y,U.y,T.y,this.tension),gg.initCatmullRom(b.z,z.z,U.z,T.z,this.tension));return h.set(mg.calc(N),yv.calc(N),gg.calc(N)),h}copy(i){super.copy(i),this.points=[];for(let l=0,h=i.points.length;l<h;l++){const d=i.points[l];this.points.push(d.clone())}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}toJSON(){const i=super.toJSON();i.points=[];for(let l=0,h=this.points.length;l<h;l++){const d=this.points[l];i.points.push(d.toArray())}return i.closed=this.closed,i.curveType=this.curveType,i.tension=this.tension,i}fromJSON(i){super.fromJSON(i),this.points=[];for(let l=0,h=i.points.length;l<h;l++){const d=i.points[l];this.points.push(new Re().fromArray(d))}return this.closed=i.closed,this.curveType=i.curveType,this.tension=i.tension,this}}function ep(x,i,l,h,d){const g=.5*(h-i),v=.5*(d-l),b=x*x;return(2*l-2*h+g+v)*(x*b)+(-3*l+3*h-2*g-v)*b+g*x+l}function Yh(x,i,l,h){return function(d,g){const v=1-d;return v*v*g}(x,i)+function(d,g){return 2*(1-d)*d*g}(x,l)+function(d,g){return d*d*g}(x,h)}function is(x,i,l,h,d){return function(g,v){const b=1-g;return b*b*b*v}(x,i)+function(g,v){const b=1-g;return 3*b*b*g*v}(x,l)+function(g,v){return 3*(1-g)*g*g*v}(x,h)+function(g,v){return g*g*g*v}(x,d)}class pf extends Il{constructor(i=new Xt,l=new Xt,h=new Xt,d=new Xt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=i,this.v1=l,this.v2=h,this.v3=d}getPoint(i,l=new Xt){const h=l,d=this.v0,g=this.v1,v=this.v2,b=this.v3;return h.set(is(i,d.x,g.x,v.x,b.x),is(i,d.y,g.y,v.y,b.y)),h}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this}}class bv extends Il{constructor(i=new Re,l=new Re,h=new Re,d=new Re){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=i,this.v1=l,this.v2=h,this.v3=d}getPoint(i,l=new Re){const h=l,d=this.v0,g=this.v1,v=this.v2,b=this.v3;return h.set(is(i,d.x,g.x,v.x,b.x),is(i,d.y,g.y,v.y,b.y),is(i,d.z,g.z,v.z,b.z)),h}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this.v3.copy(i.v3),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i.v3=this.v3.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this.v3.fromArray(i.v3),this}}class ff extends Il{constructor(i=new Xt,l=new Xt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=i,this.v2=l}getPoint(i,l=new Xt){const h=l;return i===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(i).add(this.v1)),h}getPointAt(i,l){return this.getPoint(i,l)}getTangent(i,l){const h=l||new Xt;return h.copy(this.v2).sub(this.v1).normalize(),h}copy(i){return super.copy(i),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class wv extends Il{constructor(i=new Re,l=new Re){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=i,this.v2=l}getPoint(i,l=new Re){const h=l;return i===1?h.copy(this.v2):(h.copy(this.v2).sub(this.v1),h.multiplyScalar(i).add(this.v1)),h}getPointAt(i,l){return this.getPoint(i,l)}copy(i){return super.copy(i),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class Zc extends Il{constructor(i=new Xt,l=new Xt,h=new Xt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=i,this.v1=l,this.v2=h}getPoint(i,l=new Xt){const h=l,d=this.v0,g=this.v1,v=this.v2;return h.set(Yh(i,d.x,g.x,v.x),Yh(i,d.y,g.y,v.y)),h}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class _g extends Il{constructor(i=new Re,l=new Re,h=new Re){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=i,this.v1=l,this.v2=h}getPoint(i,l=new Re){const h=l,d=this.v0,g=this.v1,v=this.v2;return h.set(Yh(i,d.x,g.x,v.x),Yh(i,d.y,g.y,v.y),Yh(i,d.z,g.z,v.z)),h}copy(i){return super.copy(i),this.v0.copy(i.v0),this.v1.copy(i.v1),this.v2.copy(i.v2),this}toJSON(){const i=super.toJSON();return i.v0=this.v0.toArray(),i.v1=this.v1.toArray(),i.v2=this.v2.toArray(),i}fromJSON(i){return super.fromJSON(i),this.v0.fromArray(i.v0),this.v1.fromArray(i.v1),this.v2.fromArray(i.v2),this}}class xv extends Il{constructor(i=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=i}getPoint(i,l=new Xt){const h=l,d=this.points,g=(d.length-1)*i,v=Math.floor(g),b=g-v,T=d[v===0?v:v-1],I=d[v],N=d[v>d.length-2?d.length-1:v+1],z=d[v>d.length-3?d.length-1:v+2];return h.set(ep(b,T.x,I.x,N.x,z.x),ep(b,T.y,I.y,N.y,z.y)),h}copy(i){super.copy(i),this.points=[];for(let l=0,h=i.points.length;l<h;l++){const d=i.points[l];this.points.push(d.clone())}return this}toJSON(){const i=super.toJSON();i.points=[];for(let l=0,h=this.points.length;l<h;l++){const d=this.points[l];i.points.push(d.toArray())}return i}fromJSON(i){super.fromJSON(i),this.points=[];for(let l=0,h=i.points.length;l<h;l++){const d=i.points[l];this.points.push(new Xt().fromArray(d))}return this}}var er=Object.freeze({__proto__:null,ArcCurve:LA,CatmullRomCurve3:NA,CubicBezierCurve:pf,CubicBezierCurve3:bv,EllipseCurve:dg,LineCurve:ff,LineCurve3:wv,QuadraticBezierCurve:Zc,QuadraticBezierCurve3:_g,SplineCurve:xv});class Ev extends Il{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(i){this.curves.push(i)}closePath(){const i=this.curves[0].getPoint(0),l=this.curves[this.curves.length-1].getPoint(1);i.equals(l)||this.curves.push(new ff(l,i))}getPoint(i,l){const h=i*this.getLength(),d=this.getCurveLengths();let g=0;for(;g<d.length;){if(d[g]>=h){const v=d[g]-h,b=this.curves[g],T=b.getLength(),I=T===0?0:1-v/T;return b.getPointAt(I,l)}g++}return null}getLength(){const i=this.getCurveLengths();return i[i.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const i=[];let l=0;for(let h=0,d=this.curves.length;h<d;h++)l+=this.curves[h].getLength(),i.push(l);return this.cacheLengths=i,i}getSpacedPoints(i=40){const l=[];for(let h=0;h<=i;h++)l.push(this.getPoint(h/i));return this.autoClose&&l.push(l[0]),l}getPoints(i=12){const l=[];let h;for(let d=0,g=this.curves;d<g.length;d++){const v=g[d],b=v.isEllipseCurve?2*i:v.isLineCurve||v.isLineCurve3?1:v.isSplineCurve?i*v.points.length:i,T=v.getPoints(b);for(let I=0;I<T.length;I++){const N=T[I];h&&h.equals(N)||(l.push(N),h=N)}}return this.autoClose&&l.length>1&&!l[l.length-1].equals(l[0])&&l.push(l[0]),l}copy(i){super.copy(i),this.curves=[];for(let l=0,h=i.curves.length;l<h;l++){const d=i.curves[l];this.curves.push(d.clone())}return this.autoClose=i.autoClose,this}toJSON(){const i=super.toJSON();i.autoClose=this.autoClose,i.curves=[];for(let l=0,h=this.curves.length;l<h;l++){const d=this.curves[l];i.curves.push(d.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.autoClose=i.autoClose,this.curves=[];for(let l=0,h=i.curves.length;l<h;l++){const d=i.curves[l];this.curves.push(new er[d.type]().fromJSON(d))}return this}}class tp extends Ev{constructor(i){super(),this.type="Path",this.currentPoint=new Xt,i&&this.setFromPoints(i)}setFromPoints(i){this.moveTo(i[0].x,i[0].y);for(let l=1,h=i.length;l<h;l++)this.lineTo(i[l].x,i[l].y);return this}moveTo(i,l){return this.currentPoint.set(i,l),this}lineTo(i,l){const h=new ff(this.currentPoint.clone(),new Xt(i,l));return this.curves.push(h),this.currentPoint.set(i,l),this}quadraticCurveTo(i,l,h,d){const g=new Zc(this.currentPoint.clone(),new Xt(i,l),new Xt(h,d));return this.curves.push(g),this.currentPoint.set(h,d),this}bezierCurveTo(i,l,h,d,g,v){const b=new pf(this.currentPoint.clone(),new Xt(i,l),new Xt(h,d),new Xt(g,v));return this.curves.push(b),this.currentPoint.set(g,v),this}splineThru(i){const l=[this.currentPoint.clone()].concat(i),h=new xv(l);return this.curves.push(h),this.currentPoint.copy(i[i.length-1]),this}arc(i,l,h,d,g,v){const b=this.currentPoint.x,T=this.currentPoint.y;return this.absarc(i+b,l+T,h,d,g,v),this}absarc(i,l,h,d,g,v){return this.absellipse(i,l,h,h,d,g,v),this}ellipse(i,l,h,d,g,v,b,T){const I=this.currentPoint.x,N=this.currentPoint.y;return this.absellipse(i+I,l+N,h,d,g,v,b,T),this}absellipse(i,l,h,d,g,v,b,T){const I=new dg(i,l,h,d,g,v,b,T);if(this.curves.length>0){const z=I.getPoint(0);z.equals(this.currentPoint)||this.lineTo(z.x,z.y)}this.curves.push(I);const N=I.getPoint(1);return this.currentPoint.copy(N),this}copy(i){return super.copy(i),this.currentPoint.copy(i.currentPoint),this}toJSON(){const i=super.toJSON();return i.currentPoint=this.currentPoint.toArray(),i}fromJSON(i){return super.fromJSON(i),this.currentPoint.fromArray(i.currentPoint),this}}class Qr extends In{constructor(i=[new Xt(0,-.5),new Xt(.5,0),new Xt(0,.5)],l=12,h=0,d=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:i,segments:l,phiStart:h,phiLength:d},l=Math.floor(l),d=Vn(d,0,2*Math.PI);const g=[],v=[],b=[],T=[],I=[],N=1/l,z=new Re,U=new Xt,Q=new Re,Y=new Re,H=new Re;let ne=0,ie=0;for(let re=0;re<=i.length-1;re++)switch(re){case 0:ne=i[re+1].x-i[re].x,ie=i[re+1].y-i[re].y,Q.x=1*ie,Q.y=-ne,Q.z=0*ie,H.copy(Q),Q.normalize(),T.push(Q.x,Q.y,Q.z);break;case i.length-1:T.push(H.x,H.y,H.z);break;default:ne=i[re+1].x-i[re].x,ie=i[re+1].y-i[re].y,Q.x=1*ie,Q.y=-ne,Q.z=0*ie,Y.copy(Q),Q.x+=H.x,Q.y+=H.y,Q.z+=H.z,Q.normalize(),T.push(Q.x,Q.y,Q.z),H.copy(Y)}for(let re=0;re<=l;re++){const ve=h+re*N*d,Ee=Math.sin(ve),Me=Math.cos(ve);for(let Pe=0;Pe<=i.length-1;Pe++){z.x=i[Pe].x*Ee,z.y=i[Pe].y,z.z=i[Pe].x*Me,v.push(z.x,z.y,z.z),U.x=re/l,U.y=Pe/(i.length-1),b.push(U.x,U.y);const Ye=T[3*Pe+0]*Ee,Ke=T[3*Pe+1],lt=T[3*Pe+0]*Me;I.push(Ye,Ke,lt)}}for(let re=0;re<l;re++)for(let ve=0;ve<i.length-1;ve++){const Ee=ve+re*i.length,Me=Ee,Pe=Ee+i.length,Ye=Ee+i.length+1,Ke=Ee+1;g.push(Me,Pe,Ke),g.push(Ye,Ke,Pe)}this.setIndex(g),this.setAttribute("position",new E(v,3)),this.setAttribute("uv",new E(b,2)),this.setAttribute("normal",new E(I,3))}static fromJSON(i){return new Qr(i.points,i.segments,i.phiStart,i.phiLength)}}class mf extends Qr{constructor(i=1,l=1,h=4,d=8){const g=new tp;g.absarc(0,-l/2,i,1.5*Math.PI,0),g.absarc(0,l/2,i,0,.5*Math.PI),super(g.getPoints(h),d),this.type="CapsuleGeometry",this.parameters={radius:i,height:l,capSegments:h,radialSegments:d}}static fromJSON(i){return new mf(i.radius,i.length,i.capSegments,i.radialSegments)}}class Ma extends In{constructor(i=1,l=8,h=0,d=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:i,segments:l,thetaStart:h,thetaLength:d},l=Math.max(3,l);const g=[],v=[],b=[],T=[],I=new Re,N=new Xt;v.push(0,0,0),b.push(0,0,1),T.push(.5,.5);for(let z=0,U=3;z<=l;z++,U+=3){const Q=h+z/l*d;I.x=i*Math.cos(Q),I.y=i*Math.sin(Q),v.push(I.x,I.y,I.z),b.push(0,0,1),N.x=(v[U]/i+1)/2,N.y=(v[U+1]/i+1)/2,T.push(N.x,N.y)}for(let z=1;z<=l;z++)g.push(z,z+1,0);this.setIndex(g),this.setAttribute("position",new E(v,3)),this.setAttribute("normal",new E(b,3)),this.setAttribute("uv",new E(T,2))}static fromJSON(i){return new Ma(i.radius,i.segments,i.thetaStart,i.thetaLength)}}class Os extends In{constructor(i=1,l=1,h=1,d=8,g=1,v=!1,b=0,T=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:i,radiusBottom:l,height:h,radialSegments:d,heightSegments:g,openEnded:v,thetaStart:b,thetaLength:T};const I=this;d=Math.floor(d),g=Math.floor(g);const N=[],z=[],U=[],Q=[];let Y=0;const H=[],ne=h/2;let ie=0;function re(ve){const Ee=Y,Me=new Xt,Pe=new Re;let Ye=0;const Ke=ve===!0?i:l,lt=ve===!0?1:-1;for(let Ze=1;Ze<=d;Ze++)z.push(0,ne*lt,0),U.push(0,lt,0),Q.push(.5,.5),Y++;const ut=Y;for(let Ze=0;Ze<=d;Ze++){const Ft=Ze/d*T+b,$t=Math.cos(Ft),Lt=Math.sin(Ft);Pe.x=Ke*Lt,Pe.y=ne*lt,Pe.z=Ke*$t,z.push(Pe.x,Pe.y,Pe.z),U.push(0,lt,0),Me.x=.5*$t+.5,Me.y=.5*Lt*lt+.5,Q.push(Me.x,Me.y),Y++}for(let Ze=0;Ze<d;Ze++){const Ft=Ee+Ze,$t=ut+Ze;ve===!0?N.push($t,$t+1,Ft):N.push($t+1,$t,Ft),Ye+=3}I.addGroup(ie,Ye,ve===!0?1:2),ie+=Ye}(function(){const ve=new Re,Ee=new Re;let Me=0;const Pe=(l-i)/h;for(let Ye=0;Ye<=g;Ye++){const Ke=[],lt=Ye/g,ut=lt*(l-i)+i;for(let Ze=0;Ze<=d;Ze++){const Ft=Ze/d,$t=Ft*T+b,Lt=Math.sin($t),an=Math.cos($t);Ee.x=ut*Lt,Ee.y=-lt*h+ne,Ee.z=ut*an,z.push(Ee.x,Ee.y,Ee.z),ve.set(Lt,Pe,an).normalize(),U.push(ve.x,ve.y,ve.z),Q.push(Ft,1-lt),Ke.push(Y++)}H.push(Ke)}for(let Ye=0;Ye<d;Ye++)for(let Ke=0;Ke<g;Ke++){const lt=H[Ke][Ye],ut=H[Ke+1][Ye],Ze=H[Ke+1][Ye+1],Ft=H[Ke][Ye+1];N.push(lt,ut,Ft),N.push(ut,Ze,Ft),Me+=6}I.addGroup(ie,Me,0),ie+=Me})(),v===!1&&(i>0&&re(!0),l>0&&re(!1)),this.setIndex(N),this.setAttribute("position",new E(z,3)),this.setAttribute("normal",new E(U,3)),this.setAttribute("uv",new E(Q,2))}static fromJSON(i){return new Os(i.radiusTop,i.radiusBottom,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength)}}class Br extends Os{constructor(i=1,l=1,h=8,d=1,g=!1,v=0,b=2*Math.PI){super(0,i,l,h,d,g,v,b),this.type="ConeGeometry",this.parameters={radius:i,height:l,radialSegments:h,heightSegments:d,openEnded:g,thetaStart:v,thetaLength:b}}static fromJSON(i){return new Br(i.radius,i.height,i.radialSegments,i.heightSegments,i.openEnded,i.thetaStart,i.thetaLength)}}class eu extends In{constructor(i=[],l=[],h=1,d=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:i,indices:l,radius:h,detail:d};const g=[],v=[];function b(U,Q,Y,H){const ne=H+1,ie=[];for(let re=0;re<=ne;re++){ie[re]=[];const ve=U.clone().lerp(Y,re/ne),Ee=Q.clone().lerp(Y,re/ne),Me=ne-re;for(let Pe=0;Pe<=Me;Pe++)ie[re][Pe]=Pe===0&&re===ne?ve:ve.clone().lerp(Ee,Pe/Me)}for(let re=0;re<ne;re++)for(let ve=0;ve<2*(ne-re)-1;ve++){const Ee=Math.floor(ve/2);ve%2==0?(T(ie[re][Ee+1]),T(ie[re+1][Ee]),T(ie[re][Ee])):(T(ie[re][Ee+1]),T(ie[re+1][Ee+1]),T(ie[re+1][Ee]))}}function T(U){g.push(U.x,U.y,U.z)}function I(U,Q){const Y=3*U;Q.x=i[Y+0],Q.y=i[Y+1],Q.z=i[Y+2]}function N(U,Q,Y,H){H<0&&U.x===1&&(v[Q]=U.x-1),Y.x===0&&Y.z===0&&(v[Q]=H/2/Math.PI+.5)}function z(U){return Math.atan2(U.z,-U.x)}(function(U){const Q=new Re,Y=new Re,H=new Re;for(let ne=0;ne<l.length;ne+=3)I(l[ne+0],Q),I(l[ne+1],Y),I(l[ne+2],H),b(Q,Y,H,U)})(d),function(U){const Q=new Re;for(let Y=0;Y<g.length;Y+=3)Q.x=g[Y+0],Q.y=g[Y+1],Q.z=g[Y+2],Q.normalize().multiplyScalar(U),g[Y+0]=Q.x,g[Y+1]=Q.y,g[Y+2]=Q.z}(h),function(){const U=new Re;for(let Y=0;Y<g.length;Y+=3){U.x=g[Y+0],U.y=g[Y+1],U.z=g[Y+2];const H=z(U)/2/Math.PI+.5,ne=(Q=U,Math.atan2(-Q.y,Math.sqrt(Q.x*Q.x+Q.z*Q.z))/Math.PI+.5);v.push(H,1-ne)}var Q;(function(){const Y=new Re,H=new Re,ne=new Re,ie=new Re,re=new Xt,ve=new Xt,Ee=new Xt;for(let Me=0,Pe=0;Me<g.length;Me+=9,Pe+=6){Y.set(g[Me+0],g[Me+1],g[Me+2]),H.set(g[Me+3],g[Me+4],g[Me+5]),ne.set(g[Me+6],g[Me+7],g[Me+8]),re.set(v[Pe+0],v[Pe+1]),ve.set(v[Pe+2],v[Pe+3]),Ee.set(v[Pe+4],v[Pe+5]),ie.copy(Y).add(H).add(ne).divideScalar(3);const Ye=z(ie);N(re,Pe+0,Y,Ye),N(ve,Pe+2,H,Ye),N(Ee,Pe+4,ne,Ye)}})(),function(){for(let Y=0;Y<v.length;Y+=6){const H=v[Y+0],ne=v[Y+2],ie=v[Y+4],re=Math.max(H,ne,ie),ve=Math.min(H,ne,ie);re>.9&&ve<.1&&(H<.2&&(v[Y+0]+=1),ne<.2&&(v[Y+2]+=1),ie<.2&&(v[Y+4]+=1))}}()}(),this.setAttribute("position",new E(g,3)),this.setAttribute("normal",new E(g.slice(),3)),this.setAttribute("uv",new E(v,2)),d===0?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(i){return new eu(i.vertices,i.indices,i.radius,i.details)}}class gf extends eu{constructor(i=1,l=0){const h=(1+Math.sqrt(5))/2,d=1/h;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-d,-h,0,-d,h,0,d,-h,0,d,h,-d,-h,0,-d,h,0,d,-h,0,d,h,0,-h,0,-d,h,0,-d,-h,0,d,h,0,d],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],i,l),this.type="DodecahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new gf(i.radius,i.detail)}}const Pl=new Re,np=new Re,_f=new Re,ip=new Rs;class vg extends In{constructor(i=null,l=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:i,thresholdAngle:l},i!==null){const d=Math.pow(10,4),g=Math.cos(Oc*l),v=i.getIndex(),b=i.getAttribute("position"),T=v?v.count:b.count,I=[0,0,0],N=["a","b","c"],z=new Array(3),U={},Q=[];for(let Y=0;Y<T;Y+=3){v?(I[0]=v.getX(Y),I[1]=v.getX(Y+1),I[2]=v.getX(Y+2)):(I[0]=Y,I[1]=Y+1,I[2]=Y+2);const{a:H,b:ne,c:ie}=ip;if(H.fromBufferAttribute(b,I[0]),ne.fromBufferAttribute(b,I[1]),ie.fromBufferAttribute(b,I[2]),ip.getNormal(_f),z[0]=`${Math.round(H.x*d)},${Math.round(H.y*d)},${Math.round(H.z*d)}`,z[1]=`${Math.round(ne.x*d)},${Math.round(ne.y*d)},${Math.round(ne.z*d)}`,z[2]=`${Math.round(ie.x*d)},${Math.round(ie.y*d)},${Math.round(ie.z*d)}`,z[0]!==z[1]&&z[1]!==z[2]&&z[2]!==z[0])for(let re=0;re<3;re++){const ve=(re+1)%3,Ee=z[re],Me=z[ve],Pe=ip[N[re]],Ye=ip[N[ve]],Ke=`${Ee}_${Me}`,lt=`${Me}_${Ee}`;lt in U&&U[lt]?(_f.dot(U[lt].normal)<=g&&(Q.push(Pe.x,Pe.y,Pe.z),Q.push(Ye.x,Ye.y,Ye.z)),U[lt]=null):Ke in U||(U[Ke]={index0:I[re],index1:I[ve],normal:_f.clone()})}}for(const Y in U)if(U[Y]){const{index0:H,index1:ne}=U[Y];Pl.fromBufferAttribute(b,H),np.fromBufferAttribute(b,ne),Q.push(Pl.x,Pl.y,Pl.z),Q.push(np.x,np.y,np.z)}this.setAttribute("position",new E(Q,3))}}}class Xh extends tp{constructor(i){super(i),this.uuid=Ws(),this.type="Shape",this.holes=[]}getPointsHoles(i){const l=[];for(let h=0,d=this.holes.length;h<d;h++)l[h]=this.holes[h].getPoints(i);return l}extractPoints(i){return{shape:this.getPoints(i),holes:this.getPointsHoles(i)}}copy(i){super.copy(i),this.holes=[];for(let l=0,h=i.holes.length;l<h;l++){const d=i.holes[l];this.holes.push(d.clone())}return this}toJSON(){const i=super.toJSON();i.uuid=this.uuid,i.holes=[];for(let l=0,h=this.holes.length;l<h;l++){const d=this.holes[l];i.holes.push(d.toJSON())}return i}fromJSON(i){super.fromJSON(i),this.uuid=i.uuid,this.holes=[];for(let l=0,h=i.holes.length;l<h;l++){const d=i.holes[l];this.holes.push(new tp().fromJSON(d))}return this}}function FA(x,i,l,h,d){let g,v;if(d===function(b,T,I,N){let z=0;for(let U=T,Q=I-N;U<I;U+=N)z+=(b[Q]-b[U])*(b[U+1]+b[Q+1]),Q=U;return z}(x,i,l,h)>0)for(g=i;g<l;g+=h)v=pa(g,x[g],x[g+1],v);else for(g=l-h;g>=i;g-=h)v=pa(g,x[g],x[g+1],v);return v&&ha(v,v.next)&&(bf(v),v=v.next),v}function Ju(x,i){if(!x)return x;i||(i=x);let l,h=x;do if(l=!1,h.steiner||!ha(h,h.next)&&jr(h.prev,h,h.next)!==0)h=h.next;else{if(bf(h),h=i=h.prev,h===h.next)break;l=!0}while(l||h!==i);return i}function vf(x,i,l,h,d,g,v){if(!x)return;!v&&g&&function(N,z,U,Q){let Y=N;do Y.z===null&&(Y.z=Ag(Y.x,Y.y,z,U,Q)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==N);Y.prevZ.nextZ=null,Y.prevZ=null,function(H){let ne,ie,re,ve,Ee,Me,Pe,Ye,Ke=1;do{for(ie=H,H=null,Ee=null,Me=0;ie;){for(Me++,re=ie,Pe=0,ne=0;ne<Ke&&(Pe++,re=re.nextZ,re);ne++);for(Ye=Ke;Pe>0||Ye>0&&re;)Pe!==0&&(Ye===0||!re||ie.z<=re.z)?(ve=ie,ie=ie.nextZ,Pe--):(ve=re,re=re.nextZ,Ye--),Ee?Ee.nextZ=ve:H=ve,ve.prevZ=Ee,Ee=ve;ie=re}Ee.nextZ=null,Ke*=2}while(Me>1)}(Y)}(x,h,d,g);let b,T,I=x;for(;x.prev!==x.next;)if(b=x.prev,T=x.next,g?Af(x,h,d,g):UA(x))i.push(b.i/l),i.push(x.i/l),i.push(T.i/l),bf(x),x=T.next,I=T.next;else if((x=T)===I){v?v===1?vf(x=jA(Ju(x),i,l),i,l,h,d,g,2):v===2&&Sv(x,i,l,h,d,g):vf(Ju(x),i,l,h,d,g,1);break}}function UA(x){const i=x.prev,l=x,h=x.next;if(jr(i,l,h)>=0)return!1;let d=x.next.next;for(;d!==x.prev;){if(Xa(i.x,i.y,l.x,l.y,h.x,h.y,d.x,d.y)&&jr(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Af(x,i,l,h){const d=x.prev,g=x,v=x.next;if(jr(d,g,v)>=0)return!1;const b=d.x<g.x?d.x<v.x?d.x:v.x:g.x<v.x?g.x:v.x,T=d.y<g.y?d.y<v.y?d.y:v.y:g.y<v.y?g.y:v.y,I=d.x>g.x?d.x>v.x?d.x:v.x:g.x>v.x?g.x:v.x,N=d.y>g.y?d.y>v.y?d.y:v.y:g.y>v.y?g.y:v.y,z=Ag(b,T,i,l,h),U=Ag(I,N,i,l,h);let Q=x.prevZ,Y=x.nextZ;for(;Q&&Q.z>=z&&Y&&Y.z<=U;){if(Q!==x.prev&&Q!==x.next&&Xa(d.x,d.y,g.x,g.y,v.x,v.y,Q.x,Q.y)&&jr(Q.prev,Q,Q.next)>=0||(Q=Q.prevZ,Y!==x.prev&&Y!==x.next&&Xa(d.x,d.y,g.x,g.y,v.x,v.y,Y.x,Y.y)&&jr(Y.prev,Y,Y.next)>=0))return!1;Y=Y.nextZ}for(;Q&&Q.z>=z;){if(Q!==x.prev&&Q!==x.next&&Xa(d.x,d.y,g.x,g.y,v.x,v.y,Q.x,Q.y)&&jr(Q.prev,Q,Q.next)>=0)return!1;Q=Q.prevZ}for(;Y&&Y.z<=U;){if(Y!==x.prev&&Y!==x.next&&Xa(d.x,d.y,g.x,g.y,v.x,v.y,Y.x,Y.y)&&jr(Y.prev,Y,Y.next)>=0)return!1;Y=Y.nextZ}return!0}function jA(x,i,l){let h=x;do{const d=h.prev,g=h.next.next;!ha(d,g)&&$u(d,h,h.next,g)&&Zu(d,g)&&Zu(g,d)&&(i.push(d.i/l),i.push(h.i/l),i.push(g.i/l),bf(h),bf(h.next),h=x=g),h=h.next}while(h!==x);return Ju(h)}function Sv(x,i,l,h,d,g){let v=x;do{let b=v.next.next;for(;b!==v.prev;){if(v.i!==b.i&&Co(v,b)){let T=yg(v,b);return v=Ju(v,v.next),T=Ju(T,T.next),vf(v,i,l,h,d,g),void vf(T,i,l,h,d,g)}b=b.next}v=v.next}while(v!==x)}function yf(x,i){return x.x-i.x}function Dl(x,i){if(i=function(l,h){let d=h;const g=l.x,v=l.y;let b,T=-1/0;do{if(v<=d.y&&v>=d.next.y&&d.next.y!==d.y){const Y=d.x+(v-d.y)*(d.next.x-d.x)/(d.next.y-d.y);if(Y<=g&&Y>T){if(T=Y,Y===g){if(v===d.y)return d;if(v===d.next.y)return d.next}b=d.x<d.next.x?d:d.next}}d=d.next}while(d!==h);if(!b)return null;if(g===T)return b;const I=b,N=b.x,z=b.y;let U,Q=1/0;d=b;do g>=d.x&&d.x>=N&&g!==d.x&&Xa(v<z?g:T,v,N,z,v<z?T:g,v,d.x,d.y)&&(U=Math.abs(v-d.y)/(g-d.x),Zu(d,l)&&(U<Q||U===Q&&(d.x>b.x||d.x===b.x&&zA(b,d)))&&(b=d,Q=U)),d=d.next;while(d!==I);return b}(x,i),i){const l=yg(i,x);Ju(i,i.next),Ju(l,l.next)}}function zA(x,i){return jr(x.prev,x,i.prev)<0&&jr(i.next,x,x.next)<0}function Ag(x,i,l,h,d){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=32767*(x-l)*d)|x<<8))|x<<4))|x<<2))|x<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=32767*(i-h)*d)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Kh(x){let i=x,l=x;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==x);return l}function Xa(x,i,l,h,d,g,v,b){return(d-v)*(i-b)-(x-v)*(g-b)>=0&&(x-v)*(h-b)-(l-v)*(i-b)>=0&&(l-v)*(g-b)-(d-v)*(h-b)>=0}function Co(x,i){return x.next.i!==i.i&&x.prev.i!==i.i&&!function(l,h){let d=l;do{if(d.i!==l.i&&d.next.i!==l.i&&d.i!==h.i&&d.next.i!==h.i&&$u(d,d.next,l,h))return!0;d=d.next}while(d!==l);return!1}(x,i)&&(Zu(x,i)&&Zu(i,x)&&function(l,h){let d=l,g=!1;const v=(l.x+h.x)/2,b=(l.y+h.y)/2;do d.y>b!=d.next.y>b&&d.next.y!==d.y&&v<(d.next.x-d.x)*(b-d.y)/(d.next.y-d.y)+d.x&&(g=!g),d=d.next;while(d!==l);return g}(x,i)&&(jr(x.prev,x,i.prev)||jr(x,i.prev,i))||ha(x,i)&&jr(x.prev,x,x.next)>0&&jr(i.prev,i,i.next)>0)}function jr(x,i,l){return(i.y-x.y)*(l.x-i.x)-(i.x-x.x)*(l.y-i.y)}function ha(x,i){return x.x===i.x&&x.y===i.y}function $u(x,i,l,h){const d=da(jr(x,i,l)),g=da(jr(x,i,h)),v=da(jr(l,h,x)),b=da(jr(l,h,i));return d!==g&&v!==b||!(d!==0||!Ka(x,l,i))||!(g!==0||!Ka(x,h,i))||!(v!==0||!Ka(l,x,h))||!(b!==0||!Ka(l,i,h))}function Ka(x,i,l){return i.x<=Math.max(x.x,l.x)&&i.x>=Math.min(x.x,l.x)&&i.y<=Math.max(x.y,l.y)&&i.y>=Math.min(x.y,l.y)}function da(x){return x>0?1:x<0?-1:0}function Zu(x,i){return jr(x.prev,x,x.next)<0?jr(x,i,x.next)>=0&&jr(x,x.prev,i)>=0:jr(x,i,x.prev)<0||jr(x,x.next,i)<0}function yg(x,i){const l=new Cv(x.i,x.x,x.y),h=new Cv(i.i,i.x,i.y),d=x.next,g=i.prev;return x.next=i,i.prev=x,l.next=d,d.prev=l,h.next=l,l.prev=h,g.next=h,h.prev=g,h}function pa(x,i,l,h){const d=new Cv(x,i,l);return h?(d.next=h.next,d.prev=h,h.next.prev=d,h.next=d):(d.prev=d,d.next=d),d}function bf(x){x.next.prev=x.prev,x.prev.next=x.next,x.prevZ&&(x.prevZ.nextZ=x.nextZ),x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function Cv(x,i,l){this.i=x,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Rl{static area(i){const l=i.length;let h=0;for(let d=l-1,g=0;g<l;d=g++)h+=i[d].x*i[g].y-i[g].x*i[d].y;return .5*h}static isClockWise(i){return Rl.area(i)<0}static triangulateShape(i,l){const h=[],d=[],g=[];Ta(i),bg(h,i);let v=i.length;l.forEach(Ta);for(let T=0;T<l.length;T++)d.push(v),v+=l[T].length,bg(h,l[T]);const b=function(T,I,N=2){const z=I&&I.length,U=z?I[0]*N:T.length;let Q=FA(T,0,U,N,!0);const Y=[];if(!Q||Q.next===Q.prev)return Y;let H,ne,ie,re,ve,Ee,Me;if(z&&(Q=function(Pe,Ye,Ke,lt){const ut=[];let Ze,Ft,$t,Lt,an;for(Ze=0,Ft=Ye.length;Ze<Ft;Ze++)$t=Ye[Ze]*lt,Lt=Ze<Ft-1?Ye[Ze+1]*lt:Pe.length,an=FA(Pe,$t,Lt,lt,!1),an===an.next&&(an.steiner=!0),ut.push(Kh(an));for(ut.sort(yf),Ze=0;Ze<ut.length;Ze++)Dl(ut[Ze],Ke),Ke=Ju(Ke,Ke.next);return Ke}(T,I,Q,N)),T.length>80*N){H=ie=T[0],ne=re=T[1];for(let Pe=N;Pe<U;Pe+=N)ve=T[Pe],Ee=T[Pe+1],ve<H&&(H=ve),Ee<ne&&(ne=Ee),ve>ie&&(ie=ve),Ee>re&&(re=Ee);Me=Math.max(ie-H,re-ne),Me=Me!==0?1/Me:0}return vf(Q,Y,N,H,ne,Me),Y}(h,d);for(let T=0;T<b.length;T+=3)g.push(b.slice(T,T+3));return g}}function Ta(x){const i=x.length;i>2&&x[i-1].equals(x[0])&&x.pop()}function bg(x,i){for(let l=0;l<i.length;l++)x.push(i[l].x),x.push(i[l].y)}class wf extends In{constructor(i=new Xh([new Xt(.5,.5),new Xt(-.5,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),l={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:i,options:l},i=Array.isArray(i)?i:[i];const h=this,d=[],g=[];for(let b=0,T=i.length;b<T;b++)v(i[b]);function v(b){const T=[],I=l.curveSegments!==void 0?l.curveSegments:12,N=l.steps!==void 0?l.steps:1,z=l.depth!==void 0?l.depth:1;let U=l.bevelEnabled===void 0||l.bevelEnabled,Q=l.bevelThickness!==void 0?l.bevelThickness:.2,Y=l.bevelSize!==void 0?l.bevelSize:Q-.1,H=l.bevelOffset!==void 0?l.bevelOffset:0,ne=l.bevelSegments!==void 0?l.bevelSegments:3;const ie=l.extrudePath,re=l.UVGenerator!==void 0?l.UVGenerator:bw;let ve,Ee,Me,Pe,Ye,Ke=!1;ie&&(ve=ie.getSpacedPoints(N),Ke=!0,U=!1,Ee=ie.computeFrenetFrames(N,!1),Me=new Re,Pe=new Re,Ye=new Re),U||(ne=0,Q=0,Y=0,H=0);const lt=b.extractPoints(I);let ut=lt.shape;const Ze=lt.holes;if(!Rl.isClockWise(ut)){ut=ut.reverse();for(let at=0,We=Ze.length;at<We;at++){const st=Ze[at];Rl.isClockWise(st)&&(Ze[at]=st.reverse())}}const Ft=Rl.triangulateShape(ut,Ze),$t=ut;for(let at=0,We=Ze.length;at<We;at++){const st=Ze[at];ut=ut.concat(st)}function Lt(at,We,st){return We||console.error("THREE.ExtrudeGeometry: vec does not exist"),We.clone().multiplyScalar(st).add(at)}const an=ut.length,ln=Ft.length;function Ct(at,We,st){let Tt,Ae,It;const dt=at.x-We.x,Nt=at.y-We.y,Gt=st.x-at.x,pn=st.y-at.y,Un=dt*dt+Nt*Nt,Jn=dt*pn-Nt*Gt;if(Math.abs(Jn)>Number.EPSILON){const fi=Math.sqrt(Un),Yn=Math.sqrt(Gt*Gt+pn*pn),$n=We.x-Nt/fi,hr=We.y+dt/fi,Da=((st.x-pn/Yn-$n)*pn-(st.y+Gt/Yn-hr)*Gt)/(dt*pn-Nt*Gt);Tt=$n+dt*Da-at.x,Ae=hr+Nt*Da-at.y;const hi=Tt*Tt+Ae*Ae;if(hi<=2)return new Xt(Tt,Ae);It=Math.sqrt(hi/2)}else{let fi=!1;dt>Number.EPSILON?Gt>Number.EPSILON&&(fi=!0):dt<-Number.EPSILON?Gt<-Number.EPSILON&&(fi=!0):Math.sign(Nt)===Math.sign(pn)&&(fi=!0),fi?(Tt=-Nt,Ae=dt,It=Math.sqrt(Un)):(Tt=dt,Ae=Nt,It=Math.sqrt(Un/2))}return new Xt(Tt/It,Ae/It)}const Dt=[];for(let at=0,We=$t.length,st=We-1,Tt=at+1;at<We;at++,st++,Tt++)st===We&&(st=0),Tt===We&&(Tt=0),Dt[at]=Ct($t[at],$t[st],$t[Tt]);const nn=[];let Ut,on=Dt.concat();for(let at=0,We=Ze.length;at<We;at++){const st=Ze[at];Ut=[];for(let Tt=0,Ae=st.length,It=Ae-1,dt=Tt+1;Tt<Ae;Tt++,It++,dt++)It===Ae&&(It=0),dt===Ae&&(dt=0),Ut[Tt]=Ct(st[Tt],st[It],st[dt]);nn.push(Ut),on=on.concat(Ut)}for(let at=0;at<ne;at++){const We=at/ne,st=Q*Math.cos(We*Math.PI/2),Tt=Y*Math.sin(We*Math.PI/2)+H;for(let Ae=0,It=$t.length;Ae<It;Ae++){const dt=Lt($t[Ae],Dt[Ae],Tt);Fn(dt.x,dt.y,-st)}for(let Ae=0,It=Ze.length;Ae<It;Ae++){const dt=Ze[Ae];Ut=nn[Ae];for(let Nt=0,Gt=dt.length;Nt<Gt;Nt++){const pn=Lt(dt[Nt],Ut[Nt],Tt);Fn(pn.x,pn.y,-st)}}}const On=Y+H;for(let at=0;at<an;at++){const We=U?Lt(ut[at],on[at],On):ut[at];Ke?(Pe.copy(Ee.normals[0]).multiplyScalar(We.x),Me.copy(Ee.binormals[0]).multiplyScalar(We.y),Ye.copy(ve[0]).add(Pe).add(Me),Fn(Ye.x,Ye.y,Ye.z)):Fn(We.x,We.y,0)}for(let at=1;at<=N;at++)for(let We=0;We<an;We++){const st=U?Lt(ut[We],on[We],On):ut[We];Ke?(Pe.copy(Ee.normals[at]).multiplyScalar(st.x),Me.copy(Ee.binormals[at]).multiplyScalar(st.y),Ye.copy(ve[at]).add(Pe).add(Me),Fn(Ye.x,Ye.y,Ye.z)):Fn(st.x,st.y,z/N*at)}for(let at=ne-1;at>=0;at--){const We=at/ne,st=Q*Math.cos(We*Math.PI/2),Tt=Y*Math.sin(We*Math.PI/2)+H;for(let Ae=0,It=$t.length;Ae<It;Ae++){const dt=Lt($t[Ae],Dt[Ae],Tt);Fn(dt.x,dt.y,z+st)}for(let Ae=0,It=Ze.length;Ae<It;Ae++){const dt=Ze[Ae];Ut=nn[Ae];for(let Nt=0,Gt=dt.length;Nt<Gt;Nt++){const pn=Lt(dt[Nt],Ut[Nt],Tt);Ke?Fn(pn.x,pn.y+ve[N-1].y,ve[N-1].x+st):Fn(pn.x,pn.y,z+st)}}}function Ti(at,We){let st=at.length;for(;--st>=0;){const Tt=st;let Ae=st-1;Ae<0&&(Ae=at.length-1);for(let It=0,dt=N+2*ne;It<dt;It++){const Nt=an*It,Gt=an*(It+1);He(We+Tt+Nt,We+Ae+Nt,We+Ae+Gt,We+Tt+Gt)}}}function Fn(at,We,st){T.push(at),T.push(We),T.push(st)}function yi(at,We,st){Ue(at),Ue(We),Ue(st);const Tt=d.length/3,Ae=re.generateTopUV(h,d,Tt-3,Tt-2,Tt-1);mt(Ae[0]),mt(Ae[1]),mt(Ae[2])}function He(at,We,st,Tt){Ue(at),Ue(We),Ue(Tt),Ue(We),Ue(st),Ue(Tt);const Ae=d.length/3,It=re.generateSideWallUV(h,d,Ae-6,Ae-3,Ae-2,Ae-1);mt(It[0]),mt(It[1]),mt(It[3]),mt(It[1]),mt(It[2]),mt(It[3])}function Ue(at){d.push(T[3*at+0]),d.push(T[3*at+1]),d.push(T[3*at+2])}function mt(at){g.push(at.x),g.push(at.y)}(function(){const at=d.length/3;if(U){let We=0,st=an*We;for(let Tt=0;Tt<ln;Tt++){const Ae=Ft[Tt];yi(Ae[2]+st,Ae[1]+st,Ae[0]+st)}We=N+2*ne,st=an*We;for(let Tt=0;Tt<ln;Tt++){const Ae=Ft[Tt];yi(Ae[0]+st,Ae[1]+st,Ae[2]+st)}}else{for(let We=0;We<ln;We++){const st=Ft[We];yi(st[2],st[1],st[0])}for(let We=0;We<ln;We++){const st=Ft[We];yi(st[0]+an*N,st[1]+an*N,st[2]+an*N)}}h.addGroup(at,d.length/3-at,0)})(),function(){const at=d.length/3;let We=0;Ti($t,We),We+=$t.length;for(let st=0,Tt=Ze.length;st<Tt;st++){const Ae=Ze[st];Ti(Ae,We),We+=Ae.length}h.addGroup(at,d.length/3-at,1)}()}this.setAttribute("position",new E(d,3)),this.setAttribute("uv",new E(g,2)),this.computeVertexNormals()}toJSON(){const i=super.toJSON();return function(l,h,d){if(d.shapes=[],Array.isArray(l))for(let g=0,v=l.length;g<v;g++){const b=l[g];d.shapes.push(b.uuid)}else d.shapes.push(l.uuid);return d.options=Object.assign({},h),h.extrudePath!==void 0&&(d.options.extrudePath=h.extrudePath.toJSON()),d}(this.parameters.shapes,this.parameters.options,i)}static fromJSON(i,l){const h=[];for(let g=0,v=i.shapes.length;g<v;g++){const b=l[i.shapes[g]];h.push(b)}const d=i.options.extrudePath;return d!==void 0&&(i.options.extrudePath=new er[d.type]().fromJSON(d)),new wf(h,i.options)}}const bw={generateTopUV:function(x,i,l,h,d){const g=i[3*l],v=i[3*l+1],b=i[3*h],T=i[3*h+1],I=i[3*d],N=i[3*d+1];return[new Xt(g,v),new Xt(b,T),new Xt(I,N)]},generateSideWallUV:function(x,i,l,h,d,g){const v=i[3*l],b=i[3*l+1],T=i[3*l+2],I=i[3*h],N=i[3*h+1],z=i[3*h+2],U=i[3*d],Q=i[3*d+1],Y=i[3*d+2],H=i[3*g],ne=i[3*g+1],ie=i[3*g+2];return Math.abs(b-N)<Math.abs(v-I)?[new Xt(v,1-T),new Xt(I,1-z),new Xt(U,1-Y),new Xt(H,1-ie)]:[new Xt(b,1-T),new Xt(N,1-z),new Xt(Q,1-Y),new Xt(ne,1-ie)]}};class rp extends eu{constructor(i=1,l=0){const h=(1+Math.sqrt(5))/2;super([-1,h,0,1,h,0,-1,-h,0,1,-h,0,0,-1,h,0,1,h,0,-1,-h,0,1,-h,h,0,-1,h,0,1,-h,0,-1,-h,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],i,l),this.type="IcosahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new rp(i.radius,i.detail)}}class co extends eu{constructor(i=1,l=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],i,l),this.type="OctahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new co(i.radius,i.detail)}}class Jh extends In{constructor(i=.5,l=1,h=8,d=1,g=0,v=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:i,outerRadius:l,thetaSegments:h,phiSegments:d,thetaStart:g,thetaLength:v},h=Math.max(3,h);const b=[],T=[],I=[],N=[];let z=i;const U=(l-i)/(d=Math.max(1,d)),Q=new Re,Y=new Xt;for(let H=0;H<=d;H++){for(let ne=0;ne<=h;ne++){const ie=g+ne/h*v;Q.x=z*Math.cos(ie),Q.y=z*Math.sin(ie),T.push(Q.x,Q.y,Q.z),I.push(0,0,1),Y.x=(Q.x/l+1)/2,Y.y=(Q.y/l+1)/2,N.push(Y.x,Y.y)}z+=U}for(let H=0;H<d;H++){const ne=H*(h+1);for(let ie=0;ie<h;ie++){const re=ie+ne,ve=re,Ee=re+h+1,Me=re+h+2,Pe=re+1;b.push(ve,Ee,Pe),b.push(Ee,Me,Pe)}}this.setIndex(b),this.setAttribute("position",new E(T,3)),this.setAttribute("normal",new E(I,3)),this.setAttribute("uv",new E(N,2))}static fromJSON(i){return new Jh(i.innerRadius,i.outerRadius,i.thetaSegments,i.phiSegments,i.thetaStart,i.thetaLength)}}class xf extends In{constructor(i=new Xh([new Xt(0,.5),new Xt(-.5,-.5),new Xt(.5,-.5)]),l=12){super(),this.type="ShapeGeometry",this.parameters={shapes:i,curveSegments:l};const h=[],d=[],g=[],v=[];let b=0,T=0;if(Array.isArray(i)===!1)I(i);else for(let N=0;N<i.length;N++)I(i[N]),this.addGroup(b,T,N),b+=T,T=0;function I(N){const z=d.length/3,U=N.extractPoints(l);let Q=U.shape;const Y=U.holes;Rl.isClockWise(Q)===!1&&(Q=Q.reverse());for(let ne=0,ie=Y.length;ne<ie;ne++){const re=Y[ne];Rl.isClockWise(re)===!0&&(Y[ne]=re.reverse())}const H=Rl.triangulateShape(Q,Y);for(let ne=0,ie=Y.length;ne<ie;ne++){const re=Y[ne];Q=Q.concat(re)}for(let ne=0,ie=Q.length;ne<ie;ne++){const re=Q[ne];d.push(re.x,re.y,0),g.push(0,0,1),v.push(re.x,re.y)}for(let ne=0,ie=H.length;ne<ie;ne++){const re=H[ne],ve=re[0]+z,Ee=re[1]+z,Me=re[2]+z;h.push(ve,Ee,Me),T+=3}}this.setIndex(h),this.setAttribute("position",new E(d,3)),this.setAttribute("normal",new E(g,3)),this.setAttribute("uv",new E(v,2))}toJSON(){const i=super.toJSON();return function(l,h){if(h.shapes=[],Array.isArray(l))for(let d=0,g=l.length;d<g;d++){const v=l[d];h.shapes.push(v.uuid)}else h.shapes.push(l.uuid);return h}(this.parameters.shapes,i)}static fromJSON(i,l){const h=[];for(let d=0,g=i.shapes.length;d<g;d++){const v=l[i.shapes[d]];h.push(v)}return new xf(h,i.curveSegments)}}class sp extends In{constructor(i=1,l=32,h=16,d=0,g=2*Math.PI,v=0,b=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:i,widthSegments:l,heightSegments:h,phiStart:d,phiLength:g,thetaStart:v,thetaLength:b},l=Math.max(3,Math.floor(l)),h=Math.max(2,Math.floor(h));const T=Math.min(v+b,Math.PI);let I=0;const N=[],z=new Re,U=new Re,Q=[],Y=[],H=[],ne=[];for(let ie=0;ie<=h;ie++){const re=[],ve=ie/h;let Ee=0;ie==0&&v==0?Ee=.5/l:ie==h&&T==Math.PI&&(Ee=-.5/l);for(let Me=0;Me<=l;Me++){const Pe=Me/l;z.x=-i*Math.cos(d+Pe*g)*Math.sin(v+ve*b),z.y=i*Math.cos(v+ve*b),z.z=i*Math.sin(d+Pe*g)*Math.sin(v+ve*b),Y.push(z.x,z.y,z.z),U.copy(z).normalize(),H.push(U.x,U.y,U.z),ne.push(Pe+Ee,1-ve),re.push(I++)}N.push(re)}for(let ie=0;ie<h;ie++)for(let re=0;re<l;re++){const ve=N[ie][re+1],Ee=N[ie][re],Me=N[ie+1][re],Pe=N[ie+1][re+1];(ie!==0||v>0)&&Q.push(ve,Ee,Pe),(ie!==h-1||T<Math.PI)&&Q.push(Ee,Me,Pe)}this.setIndex(Q),this.setAttribute("position",new E(Y,3)),this.setAttribute("normal",new E(H,3)),this.setAttribute("uv",new E(ne,2))}static fromJSON(i){return new sp(i.radius,i.widthSegments,i.heightSegments,i.phiStart,i.phiLength,i.thetaStart,i.thetaLength)}}class $h extends eu{constructor(i=1,l=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],i,l),this.type="TetrahedronGeometry",this.parameters={radius:i,detail:l}}static fromJSON(i){return new $h(i.radius,i.detail)}}class eh extends In{constructor(i=1,l=.4,h=8,d=6,g=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:i,tube:l,radialSegments:h,tubularSegments:d,arc:g},h=Math.floor(h),d=Math.floor(d);const v=[],b=[],T=[],I=[],N=new Re,z=new Re,U=new Re;for(let Q=0;Q<=h;Q++)for(let Y=0;Y<=d;Y++){const H=Y/d*g,ne=Q/h*Math.PI*2;z.x=(i+l*Math.cos(ne))*Math.cos(H),z.y=(i+l*Math.cos(ne))*Math.sin(H),z.z=l*Math.sin(ne),b.push(z.x,z.y,z.z),N.x=i*Math.cos(H),N.y=i*Math.sin(H),U.subVectors(z,N).normalize(),T.push(U.x,U.y,U.z),I.push(Y/d),I.push(Q/h)}for(let Q=1;Q<=h;Q++)for(let Y=1;Y<=d;Y++){const H=(d+1)*Q+Y-1,ne=(d+1)*(Q-1)+Y-1,ie=(d+1)*(Q-1)+Y,re=(d+1)*Q+Y;v.push(H,ne,re),v.push(ne,ie,re)}this.setIndex(v),this.setAttribute("position",new E(b,3)),this.setAttribute("normal",new E(T,3)),this.setAttribute("uv",new E(I,2))}static fromJSON(i){return new eh(i.radius,i.tube,i.radialSegments,i.tubularSegments,i.arc)}}class $s extends In{constructor(i=1,l=.4,h=64,d=8,g=2,v=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:i,tube:l,tubularSegments:h,radialSegments:d,p:g,q:v},h=Math.floor(h),d=Math.floor(d);const b=[],T=[],I=[],N=[],z=new Re,U=new Re,Q=new Re,Y=new Re,H=new Re,ne=new Re,ie=new Re;for(let ve=0;ve<=h;++ve){const Ee=ve/h*g*Math.PI*2;re(Ee,g,v,i,Q),re(Ee+.01,g,v,i,Y),ne.subVectors(Y,Q),ie.addVectors(Y,Q),H.crossVectors(ne,ie),ie.crossVectors(H,ne),H.normalize(),ie.normalize();for(let Me=0;Me<=d;++Me){const Pe=Me/d*Math.PI*2,Ye=-l*Math.cos(Pe),Ke=l*Math.sin(Pe);z.x=Q.x+(Ye*ie.x+Ke*H.x),z.y=Q.y+(Ye*ie.y+Ke*H.y),z.z=Q.z+(Ye*ie.z+Ke*H.z),T.push(z.x,z.y,z.z),U.subVectors(z,Q).normalize(),I.push(U.x,U.y,U.z),N.push(ve/h),N.push(Me/d)}}for(let ve=1;ve<=h;ve++)for(let Ee=1;Ee<=d;Ee++){const Me=(d+1)*(ve-1)+(Ee-1),Pe=(d+1)*ve+(Ee-1),Ye=(d+1)*ve+Ee,Ke=(d+1)*(ve-1)+Ee;b.push(Me,Pe,Ke),b.push(Pe,Ye,Ke)}function re(ve,Ee,Me,Pe,Ye){const Ke=Math.cos(ve),lt=Math.sin(ve),ut=Me/Ee*ve,Ze=Math.cos(ut);Ye.x=Pe*(2+Ze)*.5*Ke,Ye.y=Pe*(2+Ze)*lt*.5,Ye.z=Pe*Math.sin(ut)*.5}this.setIndex(b),this.setAttribute("position",new E(T,3)),this.setAttribute("normal",new E(I,3)),this.setAttribute("uv",new E(N,2))}static fromJSON(i){return new $s(i.radius,i.tube,i.tubularSegments,i.radialSegments,i.p,i.q)}}class Ef extends In{constructor(i=new _g(new Re(-1,-1,0),new Re(-1,1,0),new Re(1,1,0)),l=64,h=1,d=8,g=!1){super(),this.type="TubeGeometry",this.parameters={path:i,tubularSegments:l,radius:h,radialSegments:d,closed:g};const v=i.computeFrenetFrames(l,g);this.tangents=v.tangents,this.normals=v.normals,this.binormals=v.binormals;const b=new Re,T=new Re,I=new Xt;let N=new Re;const z=[],U=[],Q=[],Y=[];function H(ne){N=i.getPointAt(ne/l,N);const ie=v.normals[ne],re=v.binormals[ne];for(let ve=0;ve<=d;ve++){const Ee=ve/d*Math.PI*2,Me=Math.sin(Ee),Pe=-Math.cos(Ee);T.x=Pe*ie.x+Me*re.x,T.y=Pe*ie.y+Me*re.y,T.z=Pe*ie.z+Me*re.z,T.normalize(),U.push(T.x,T.y,T.z),b.x=N.x+h*T.x,b.y=N.y+h*T.y,b.z=N.z+h*T.z,z.push(b.x,b.y,b.z)}}(function(){for(let ne=0;ne<l;ne++)H(ne);H(g===!1?l:0),function(){for(let ne=0;ne<=l;ne++)for(let ie=0;ie<=d;ie++)I.x=ne/l,I.y=ie/d,Q.push(I.x,I.y)}(),function(){for(let ne=1;ne<=l;ne++)for(let ie=1;ie<=d;ie++){const re=(d+1)*(ne-1)+(ie-1),ve=(d+1)*ne+(ie-1),Ee=(d+1)*ne+ie,Me=(d+1)*(ne-1)+ie;Y.push(re,ve,Me),Y.push(ve,Ee,Me)}}()})(),this.setIndex(Y),this.setAttribute("position",new E(z,3)),this.setAttribute("normal",new E(U,3)),this.setAttribute("uv",new E(Q,2))}toJSON(){const i=super.toJSON();return i.path=this.parameters.path.toJSON(),i}static fromJSON(i){return new Ef(new er[i.path.type]().fromJSON(i.path),i.tubularSegments,i.radius,i.radialSegments,i.closed)}}class VA extends In{constructor(i=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:i},i!==null){const l=[],h=new Set,d=new Re,g=new Re;if(i.index!==null){const v=i.attributes.position,b=i.index;let T=i.groups;T.length===0&&(T=[{start:0,count:b.count,materialIndex:0}]);for(let I=0,N=T.length;I<N;++I){const z=T[I],U=z.start;for(let Q=U,Y=U+z.count;Q<Y;Q+=3)for(let H=0;H<3;H++){const ne=b.getX(Q+H),ie=b.getX(Q+(H+1)%3);d.fromBufferAttribute(v,ne),g.fromBufferAttribute(v,ie),Mv(d,g,h)===!0&&(l.push(d.x,d.y,d.z),l.push(g.x,g.y,g.z))}}}else{const v=i.attributes.position;for(let b=0,T=v.count/3;b<T;b++)for(let I=0;I<3;I++){const N=3*b+I,z=3*b+(I+1)%3;d.fromBufferAttribute(v,N),g.fromBufferAttribute(v,z),Mv(d,g,h)===!0&&(l.push(d.x,d.y,d.z),l.push(g.x,g.y,g.z))}}this.setAttribute("position",new E(l,3))}}}function Mv(x,i,l){const h=`${x.x},${x.y},${x.z}-${i.x},${i.y},${i.z}`,d=`${i.x},${i.y},${i.z}-${x.x},${x.y},${x.z}`;return l.has(h)!==!0&&l.has(d)!==!0&&(l.add(h),l.add(d),!0)}var Ja=Object.freeze({__proto__:null,BoxGeometry:qa,CapsuleGeometry:mf,CircleGeometry:Ma,ConeGeometry:Br,CylinderGeometry:Os,DodecahedronGeometry:gf,EdgesGeometry:vg,ExtrudeGeometry:wf,IcosahedronGeometry:rp,LatheGeometry:Qr,OctahedronGeometry:co,PlaneGeometry:Qu,PolyhedronGeometry:eu,RingGeometry:Jh,ShapeGeometry:xf,SphereGeometry:sp,TetrahedronGeometry:$h,TorusGeometry:eh,TorusKnotGeometry:$s,TubeGeometry:Ef,WireframeGeometry:VA});class wg extends Bs{constructor(i){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new bn(0),this.transparent=!0,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.fog=i.fog,this}}class GA extends wl{constructor(i){super(i),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Tv extends Bs{constructor(i){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new bn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.defines={STANDARD:""},this.color.copy(i.color),this.roughness=i.roughness,this.metalness=i.metalness,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.roughnessMap=i.roughnessMap,this.metalnessMap=i.metalnessMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.envMapIntensity=i.envMapIntensity,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class Iv extends Tv{constructor(i){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Vn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(l){this.ior=(1+.4*l)/(1-.4*l)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new bn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new bn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new bn(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._iridescence=0,this._transmission=0,this.setValues(i)}get sheen(){return this._sheen}set sheen(i){this._sheen>0!=i>0&&this.version++,this._sheen=i}get clearcoat(){return this._clearcoat}set clearcoat(i){this._clearcoat>0!=i>0&&this.version++,this._clearcoat=i}get iridescence(){return this._iridescence}set iridescence(i){this._iridescence>0!=i>0&&this.version++,this._iridescence=i}get transmission(){return this._transmission}set transmission(i){this._transmission>0!=i>0&&this.version++,this._transmission=i}copy(i){return super.copy(i),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=i.clearcoat,this.clearcoatMap=i.clearcoatMap,this.clearcoatRoughness=i.clearcoatRoughness,this.clearcoatRoughnessMap=i.clearcoatRoughnessMap,this.clearcoatNormalMap=i.clearcoatNormalMap,this.clearcoatNormalScale.copy(i.clearcoatNormalScale),this.ior=i.ior,this.iridescence=i.iridescence,this.iridescenceMap=i.iridescenceMap,this.iridescenceIOR=i.iridescenceIOR,this.iridescenceThicknessRange=[...i.iridescenceThicknessRange],this.iridescenceThicknessMap=i.iridescenceThicknessMap,this.sheen=i.sheen,this.sheenColor.copy(i.sheenColor),this.sheenColorMap=i.sheenColorMap,this.sheenRoughness=i.sheenRoughness,this.sheenRoughnessMap=i.sheenRoughnessMap,this.transmission=i.transmission,this.transmissionMap=i.transmissionMap,this.thickness=i.thickness,this.thicknessMap=i.thicknessMap,this.attenuationDistance=i.attenuationDistance,this.attenuationColor.copy(i.attenuationColor),this.specularIntensity=i.specularIntensity,this.specularIntensityMap=i.specularIntensityMap,this.specularColor.copy(i.specularColor),this.specularColorMap=i.specularColorMap,this}}class Sf extends Bs{constructor(i){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new bn(16777215),this.specular=new bn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.specular.copy(i.specular),this.shininess=i.shininess,this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class QA extends Bs{constructor(i){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new bn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.gradientMap=i.gradientMap,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.fog=i.fog,this}}class Cf extends Bs{constructor(i){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(i)}copy(i){return super.copy(i),this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.flatShading=i.flatShading,this}}class Pv extends Bs{constructor(i){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new bn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new bn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Cn,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.color.copy(i.color),this.map=i.map,this.lightMap=i.lightMap,this.lightMapIntensity=i.lightMapIntensity,this.aoMap=i.aoMap,this.aoMapIntensity=i.aoMapIntensity,this.emissive.copy(i.emissive),this.emissiveMap=i.emissiveMap,this.emissiveIntensity=i.emissiveIntensity,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.specularMap=i.specularMap,this.alphaMap=i.alphaMap,this.envMap=i.envMap,this.combine=i.combine,this.reflectivity=i.reflectivity,this.refractionRatio=i.refractionRatio,this.wireframe=i.wireframe,this.wireframeLinewidth=i.wireframeLinewidth,this.wireframeLinecap=i.wireframeLinecap,this.wireframeLinejoin=i.wireframeLinejoin,this.flatShading=i.flatShading,this.fog=i.fog,this}}class Mf extends Bs{constructor(i){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new bn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Cs,this.normalScale=new Xt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(i)}copy(i){return super.copy(i),this.defines={MATCAP:""},this.color.copy(i.color),this.matcap=i.matcap,this.map=i.map,this.bumpMap=i.bumpMap,this.bumpScale=i.bumpScale,this.normalMap=i.normalMap,this.normalMapType=i.normalMapType,this.normalScale.copy(i.normalScale),this.displacementMap=i.displacementMap,this.displacementScale=i.displacementScale,this.displacementBias=i.displacementBias,this.alphaMap=i.alphaMap,this.flatShading=i.flatShading,this.fog=i.fog,this}}class Dv extends Lo{constructor(i){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(i)}copy(i){return super.copy(i),this.scale=i.scale,this.dashSize=i.dashSize,this.gapSize=i.gapSize,this}}function Ia(x,i,l){return Jr(x)?new x.constructor(x.subarray(i,l!==void 0?l:x.length)):x.slice(i,l)}function fa(x,i,l){return!x||!l&&x.constructor===i?x:typeof i.BYTES_PER_ELEMENT=="number"?new i(x):Array.prototype.slice.call(x)}function Jr(x){return ArrayBuffer.isView(x)&&!(x instanceof DataView)}function HA(x){const i=x.length,l=new Array(i);for(let h=0;h!==i;++h)l[h]=h;return l.sort(function(h,d){return x[h]-x[d]}),l}function No(x,i,l){const h=x.length,d=new x.constructor(h);for(let g=0,v=0;v!==h;++g){const b=l[g]*i;for(let T=0;T!==i;++T)d[v++]=x[b+T]}return d}function rs(x,i,l,h){let d=1,g=x[0];for(;g!==void 0&&g[h]===void 0;)g=x[d++];if(g===void 0)return;let v=g[h];if(v!==void 0)if(Array.isArray(v))do v=g[h],v!==void 0&&(i.push(g.time),l.push.apply(l,v)),g=x[d++];while(g!==void 0);else if(v.toArray!==void 0)do v=g[h],v!==void 0&&(i.push(g.time),v.toArray(l,l.length)),g=x[d++];while(g!==void 0);else do v=g[h],v!==void 0&&(i.push(g.time),l.push(v)),g=x[d++];while(g!==void 0)}var Tf=Object.freeze({__proto__:null,arraySlice:Ia,convertArray:fa,isTypedArray:Jr,getKeyframeOrder:HA,sortedArray:No,flattenJSON:rs,subclip:function(x,i,l,h,d=30){const g=x.clone();g.name=i;const v=[];for(let T=0;T<g.tracks.length;++T){const I=g.tracks[T],N=I.getValueSize(),z=[],U=[];for(let Q=0;Q<I.times.length;++Q){const Y=I.times[Q]*d;if(!(Y<l||Y>=h)){z.push(I.times[Q]);for(let H=0;H<N;++H)U.push(I.values[Q*N+H])}}z.length!==0&&(I.times=fa(z,I.times.constructor),I.values=fa(U,I.values.constructor),v.push(I))}g.tracks=v;let b=1/0;for(let T=0;T<g.tracks.length;++T)b>g.tracks[T].times[0]&&(b=g.tracks[T].times[0]);for(let T=0;T<g.tracks.length;++T)g.tracks[T].shift(-1*b);return g.resetDuration(),g},makeClipAdditive:function(x,i=0,l=x,h=30){h<=0&&(h=30);const d=l.tracks.length,g=i/h;for(let v=0;v<d;++v){const b=l.tracks[v],T=b.ValueTypeName;if(T==="bool"||T==="string")continue;const I=x.tracks.find(function(ie){return ie.name===b.name&&ie.ValueTypeName===T});if(I===void 0)continue;let N=0;const z=b.getValueSize();b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(N=z/3);let U=0;const Q=I.getValueSize();I.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(U=Q/3);const Y=b.times.length-1;let H;if(g<=b.times[0]){const ie=N,re=z-N;H=Ia(b.values,ie,re)}else if(g>=b.times[Y]){const ie=Y*z+N,re=ie+z-N;H=Ia(b.values,ie,re)}else{const ie=b.createInterpolant(),re=N,ve=z-N;ie.evaluate(g),H=Ia(ie.resultBuffer,re,ve)}T==="quaternion"&&new Ps().fromArray(H).normalize().conjugate().toArray(H);const ne=I.times.length;for(let ie=0;ie<ne;++ie){const re=ie*Q+U;if(T==="quaternion")Ps.multiplyQuaternionsFlat(I.values,re,H,0,I.values,re);else{const ve=Q-2*U;for(let Ee=0;Ee<ve;++Ee)I.values[re+Ee]-=H[Ee]}}}return x.blendMode=bd,x}});class Zh{constructor(i,l,h,d){this.parameterPositions=i,this._cachedIndex=0,this.resultBuffer=d!==void 0?d:new l.constructor(h),this.sampleValues=l,this.valueSize=h,this.settings=null,this.DefaultSettings_={}}evaluate(i){const l=this.parameterPositions;let h=this._cachedIndex,d=l[h],g=l[h-1];e:{t:{let v;n:{i:if(!(i<d)){for(let b=h+2;;){if(d===void 0){if(i<g)break i;return h=l.length,this._cachedIndex=h,this.copySampleValue_(h-1)}if(h===b)break;if(g=d,d=l[++h],i<d)break t}v=l.length;break n}if(i>=g)break e;{const b=l[1];i<b&&(h=2,g=b);for(let T=h-2;;){if(g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(h===T)break;if(d=g,g=l[--h-1],i>=g)break t}v=h,h=0}}for(;h<v;){const b=h+v>>>1;i<l[b]?v=b:h=b+1}if(d=l[h],g=l[h-1],g===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(d===void 0)return h=l.length,this._cachedIndex=h,this.copySampleValue_(h-1)}this._cachedIndex=h,this.intervalChanged_(h,g,d)}return this.interpolate_(h,g,i,d)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(i){const l=this.resultBuffer,h=this.sampleValues,d=this.valueSize,g=i*d;for(let v=0;v!==d;++v)l[v]=h[g+v];return l}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class xg extends Zh{constructor(i,l,h,d){super(i,l,h,d),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ps,endingEnd:ps}}intervalChanged_(i,l,h){const d=this.parameterPositions;let g=i-2,v=i+1,b=d[g],T=d[v];if(b===void 0)switch(this.getSettings_().endingStart){case Wo:g=i,b=2*l-h;break;case Tc:g=d.length-2,b=l+d[g]-d[g+1];break;default:g=i,b=h}if(T===void 0)switch(this.getSettings_().endingEnd){case Wo:v=i,T=2*h-l;break;case Tc:v=1,T=h+d[1]-d[0];break;default:v=i-1,T=l}const I=.5*(h-l),N=this.valueSize;this._weightPrev=I/(l-b),this._weightNext=I/(T-h),this._offsetPrev=g*N,this._offsetNext=v*N}interpolate_(i,l,h,d){const g=this.resultBuffer,v=this.sampleValues,b=this.valueSize,T=i*b,I=T-b,N=this._offsetPrev,z=this._offsetNext,U=this._weightPrev,Q=this._weightNext,Y=(h-l)/(d-l),H=Y*Y,ne=H*Y,ie=-U*ne+2*U*H-U*Y,re=(1+U)*ne+(-1.5-2*U)*H+(-.5+U)*Y+1,ve=(-1-Q)*ne+(1.5+Q)*H+.5*Y,Ee=Q*ne-Q*H;for(let Me=0;Me!==b;++Me)g[Me]=ie*v[N+Me]+re*v[I+Me]+ve*v[T+Me]+Ee*v[z+Me];return g}}class Rv extends Zh{constructor(i,l,h,d){super(i,l,h,d)}interpolate_(i,l,h,d){const g=this.resultBuffer,v=this.sampleValues,b=this.valueSize,T=i*b,I=T-b,N=(h-l)/(d-l),z=1-N;for(let U=0;U!==b;++U)g[U]=v[I+U]*z+v[T+U]*N;return g}}class Bv extends Zh{constructor(i,l,h,d){super(i,l,h,d)}interpolate_(i){return this.copySampleValue_(i-1)}}class Bl{constructor(i,l,h,d){if(i===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(l===void 0||l.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+i);this.name=i,this.times=fa(l,this.TimeBufferType),this.values=fa(h,this.ValueBufferType),this.setInterpolation(d||this.DefaultInterpolation)}static toJSON(i){const l=i.constructor;let h;if(l.toJSON!==this.toJSON)h=l.toJSON(i);else{h={name:i.name,times:fa(i.times,Array),values:fa(i.values,Array)};const d=i.getInterpolation();d!==i.DefaultInterpolation&&(h.interpolation=d)}return h.type=i.ValueTypeName,h}InterpolantFactoryMethodDiscrete(i){return new Bv(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodLinear(i){return new Rv(this.times,this.values,this.getValueSize(),i)}InterpolantFactoryMethodSmooth(i){return new xg(this.times,this.values,this.getValueSize(),i)}setInterpolation(i){let l;switch(i){case Mc:l=this.InterpolantFactoryMethodDiscrete;break;case Su:l=this.InterpolantFactoryMethodLinear;break;case Ss:l=this.InterpolantFactoryMethodSmooth}if(l===void 0){const h="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(i===this.DefaultInterpolation)throw new Error(h);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",h),this}return this.createInterpolant=l,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Mc;case this.InterpolantFactoryMethodLinear:return Su;case this.InterpolantFactoryMethodSmooth:return Ss}}getValueSize(){return this.values.length/this.times.length}shift(i){if(i!==0){const l=this.times;for(let h=0,d=l.length;h!==d;++h)l[h]+=i}return this}scale(i){if(i!==1){const l=this.times;for(let h=0,d=l.length;h!==d;++h)l[h]*=i}return this}trim(i,l){const h=this.times,d=h.length;let g=0,v=d-1;for(;g!==d&&h[g]<i;)++g;for(;v!==-1&&h[v]>l;)--v;if(++v,g!==0||v!==d){g>=v&&(v=Math.max(v,1),g=v-1);const b=this.getValueSize();this.times=Ia(h,g,v),this.values=Ia(this.values,g*b,v*b)}return this}validate(){let i=!0;const l=this.getValueSize();l-Math.floor(l)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),i=!1);const h=this.times,d=this.values,g=h.length;g===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),i=!1);let v=null;for(let b=0;b!==g;b++){const T=h[b];if(typeof T=="number"&&isNaN(T)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,b,T),i=!1;break}if(v!==null&&v>T){console.error("THREE.KeyframeTrack: Out of order keys.",this,b,T,v),i=!1;break}v=T}if(d!==void 0&&Jr(d))for(let b=0,T=d.length;b!==T;++b){const I=d[b];if(isNaN(I)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,b,I),i=!1;break}}return i}optimize(){const i=Ia(this.times),l=Ia(this.values),h=this.getValueSize(),d=this.getInterpolation()===Ss,g=i.length-1;let v=1;for(let b=1;b<g;++b){let T=!1;const I=i[b];if(I!==i[b+1]&&(b!==1||I!==i[0]))if(d)T=!0;else{const N=b*h,z=N-h,U=N+h;for(let Q=0;Q!==h;++Q){const Y=l[N+Q];if(Y!==l[z+Q]||Y!==l[U+Q]){T=!0;break}}}if(T){if(b!==v){i[v]=i[b];const N=b*h,z=v*h;for(let U=0;U!==h;++U)l[z+U]=l[N+U]}++v}}if(g>0){i[v]=i[g];for(let b=g*h,T=v*h,I=0;I!==h;++I)l[T+I]=l[b+I];++v}return v!==i.length?(this.times=Ia(i,0,v),this.values=Ia(l,0,v*h)):(this.times=i,this.values=l),this}clone(){const i=Ia(this.times,0),l=Ia(this.values,0),h=new this.constructor(this.name,i,l);return h.createInterpolant=this.createInterpolant,h}}Bl.prototype.TimeBufferType=Float32Array,Bl.prototype.ValueBufferType=Float32Array,Bl.prototype.DefaultInterpolation=Su;class tu extends Bl{}tu.prototype.ValueTypeName="bool",tu.prototype.ValueBufferType=Array,tu.prototype.DefaultInterpolation=Mc,tu.prototype.InterpolantFactoryMethodLinear=void 0,tu.prototype.InterpolantFactoryMethodSmooth=void 0;class nu extends Bl{}nu.prototype.ValueTypeName="color";class iu extends Bl{}iu.prototype.ValueTypeName="number";class If extends Zh{constructor(i,l,h,d){super(i,l,h,d)}interpolate_(i,l,h,d){const g=this.resultBuffer,v=this.sampleValues,b=this.valueSize,T=(h-l)/(d-l);let I=i*b;for(let N=I+b;I!==N;I+=4)Ps.slerpFlat(g,0,v,I-b,v,I,T);return g}}class ma extends Bl{InterpolantFactoryMethodLinear(i){return new If(this.times,this.values,this.getValueSize(),i)}}ma.prototype.ValueTypeName="quaternion",ma.prototype.DefaultInterpolation=Su,ma.prototype.InterpolantFactoryMethodSmooth=void 0;class $a extends Bl{}$a.prototype.ValueTypeName="string",$a.prototype.ValueBufferType=Array,$a.prototype.DefaultInterpolation=Mc,$a.prototype.InterpolantFactoryMethodLinear=void 0,$a.prototype.InterpolantFactoryMethodSmooth=void 0;class op extends Bl{}op.prototype.ValueTypeName="vector";class Pf{constructor(i,l=-1,h,d=Cr){this.name=i,this.tracks=h,this.duration=l,this.blendMode=d,this.uuid=Ws(),this.duration<0&&this.resetDuration()}static parse(i){const l=[],h=i.tracks,d=1/(i.fps||1);for(let v=0,b=h.length;v!==b;++v)l.push(th(h[v]).scale(d));const g=new this(i.name,i.duration,l,i.blendMode);return g.uuid=i.uuid,g}static toJSON(i){const l=[],h=i.tracks,d={name:i.name,duration:i.duration,tracks:l,uuid:i.uuid,blendMode:i.blendMode};for(let g=0,v=h.length;g!==v;++g)l.push(Bl.toJSON(h[g]));return d}static CreateFromMorphTargetSequence(i,l,h,d){const g=l.length,v=[];for(let b=0;b<g;b++){let T=[],I=[];T.push((b+g-1)%g,b,(b+1)%g),I.push(0,1,0);const N=HA(T);T=No(T,1,N),I=No(I,1,N),d||T[0]!==0||(T.push(g),I.push(I[0])),v.push(new iu(".morphTargetInfluences["+l[b].name+"]",T,I).scale(1/h))}return new this(i,-1,v)}static findByName(i,l){let h=i;if(!Array.isArray(i)){const d=i;h=d.geometry&&d.geometry.animations||d.animations}for(let d=0;d<h.length;d++)if(h[d].name===l)return h[d];return null}static CreateClipsFromMorphTargetSequences(i,l,h){const d={},g=/^([\w-]*?)([\d]+)$/;for(let b=0,T=i.length;b<T;b++){const I=i[b],N=I.name.match(g);if(N&&N.length>1){const z=N[1];let U=d[z];U||(d[z]=U=[]),U.push(I)}}const v=[];for(const b in d)v.push(this.CreateFromMorphTargetSequence(b,d[b],l,h));return v}static parseAnimation(i,l){if(!i)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const h=function(N,z,U,Q,Y){if(U.length!==0){const H=[],ne=[];rs(U,H,ne,Q),H.length!==0&&Y.push(new N(z,H,ne))}},d=[],g=i.name||"default",v=i.fps||30,b=i.blendMode;let T=i.length||-1;const I=i.hierarchy||[];for(let N=0;N<I.length;N++){const z=I[N].keys;if(z&&z.length!==0)if(z[0].morphTargets){const U={};let Q;for(Q=0;Q<z.length;Q++)if(z[Q].morphTargets)for(let Y=0;Y<z[Q].morphTargets.length;Y++)U[z[Q].morphTargets[Y]]=-1;for(const Y in U){const H=[],ne=[];for(let ie=0;ie!==z[Q].morphTargets.length;++ie){const re=z[Q];H.push(re.time),ne.push(re.morphTarget===Y?1:0)}d.push(new iu(".morphTargetInfluence["+Y+"]",H,ne))}T=U.length*v}else{const U=".bones["+l[N].name+"]";h(op,U+".position",z,"pos",d),h(ma,U+".quaternion",z,"rot",d),h(op,U+".scale",z,"scl",d)}}return d.length===0?null:new this(g,T,d,b)}resetDuration(){let i=0;for(let l=0,h=this.tracks.length;l!==h;++l){const d=this.tracks[l];i=Math.max(i,d.times[d.times.length-1])}return this.duration=i,this}trim(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this}validate(){let i=!0;for(let l=0;l<this.tracks.length;l++)i=i&&this.tracks[l].validate();return i}optimize(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this}clone(){const i=[];for(let l=0;l<this.tracks.length;l++)i.push(this.tracks[l].clone());return new this.constructor(this.name,this.duration,i,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function th(x){if(x.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const i=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return iu;case"vector":case"vector2":case"vector3":case"vector4":return op;case"color":return nu;case"quaternion":return ma;case"bool":case"boolean":return tu;case"string":return $a}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(x.type);if(x.times===void 0){const l=[],h=[];rs(x.keys,l,h,"value"),x.times=l,x.values=h}return i.parse!==void 0?i.parse(x):new i(x.name,x.times,x.values,x.interpolation)}const ru={enabled:!1,files:{},add:function(x,i){this.enabled!==!1&&(this.files[x]=i)},get:function(x,i){return this.enabled===!1?i?Promise.resolve():void 0:i?Promise.resolve(this.files[x]):this.files[x]},remove:function(x){delete this.files[x]},clear:function(){this.files={}}};class su{constructor(i,l,h){const d=this;let g,v=!1,b=0,T=0;const I=[];this.onStart=void 0,this.onLoad=i,this.onProgress=l,this.onError=h,this.itemStart=function(N){T++,v===!1&&d.onStart!==void 0&&d.onStart(N,b,T),v=!0},this.itemEnd=function(N){b++,d.onProgress!==void 0&&d.onProgress(N,b,T),b===T&&(v=!1,d.onLoad!==void 0&&d.onLoad())},this.itemError=function(N){d.onError!==void 0&&d.onError(N)},this.resolveURL=function(N){return g?g(N):N},this.setURLModifier=function(N){return g=N,this},this.addHandler=function(N,z){return I.push(N,z),this},this.removeHandler=function(N){const z=I.indexOf(N);return z!==-1&&I.splice(z,2),this},this.getHandler=function(N){for(let z=0,U=I.length;z<U;z+=2){const Q=I[z],Y=I[z+1];if(Q.global&&(Q.lastIndex=0),Q.test(N))return Y}return null}}}const ed=new su;class Ls{constructor(i){this.manager=i!==void 0?i:ed,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(i,l){const h=this;return new Promise(function(d,g){h.load(i,d,l,g)})}parse(){}setCrossOrigin(i){return this.crossOrigin=i,this}setWithCredentials(i){return this.withCredentials=i,this}setPath(i){return this.path=i,this}setResourcePath(i){return this.resourcePath=i,this}setRequestHeader(i){return this.requestHeader=i,this}}const ys={};class ww extends Error{constructor(i,l){super(i),this.response=l}}class ou extends Ls{constructor(i){super(i),this.responseType="text"}load(i,l,h,d){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i),ru.get(i,this.responseType,this.mimeType).then(g=>{if(g!==void 0)return this.manager.itemStart(i),setTimeout(()=>{l&&l(g),this.manager.itemEnd(i)},0),g;if(ys[i]!==void 0)return void ys[i].push({onLoad:l,onProgress:h,onError:d});ys[i]=[],ys[i].push({onLoad:l,onProgress:h,onError:d});const v=new Request(i,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),b=this.mimeType,T=this.responseType;fetch(v).then(I=>{if(I.status===200||I.status===0){if(I.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||I.body===void 0||I.body.getReader===void 0)return I;const N=ys[i],z=I.body.getReader(),U=I.headers.get("Content-Length"),Q=U?parseInt(U):0,Y=Q!==0;let H=0;const ne=new ReadableStream({start(ie){(function re(){z.read().then(({done:ve,value:Ee})=>{if(ve)ie.close();else{H+=Ee.byteLength;const Me=new ProgressEvent("progress",{lengthComputable:Y,loaded:H,total:Q});for(let Pe=0,Ye=N.length;Pe<Ye;Pe++){const Ke=N[Pe];Ke.onProgress&&Ke.onProgress(Me)}ie.enqueue(Ee),re()}})})()}});return new Response(ne)}throw new ww(`fetch for "${I.url}" responded with ${I.status}: ${I.statusText}`,I)}).then(I=>{switch(T){case"arraybuffer":return I.arrayBuffer();case"blob":return I.blob();case"document":return I.text().then(N=>new DOMParser().parseFromString(N,b));case"json":return I.json();default:if(b===void 0)return I.text();{const N=/charset="?([^;"\s]*)"?/i.exec(b),z=N&&N[1]?N[1].toLowerCase():void 0,U=new TextDecoder(z);return I.arrayBuffer().then(Q=>U.decode(Q))}}}).then(I=>{ru.add(i,I,this.responseType);const N=ys[i];delete ys[i];for(let z=0,U=N.length;z<U;z++){const Q=N[z];Q.onLoad&&Q.onLoad(I)}}).catch(I=>{const N=ys[i];if(N===void 0)throw this.manager.itemError(i),I;delete ys[i];for(let z=0,U=N.length;z<U;z++){const Q=N[z];Q.onError&&Q.onError(I)}this.manager.itemError(i)}).finally(()=>{this.manager.itemEnd(i)}),this.manager.itemStart(i)})}setResponseType(i){return this.responseType=i,this}setMimeType(i){return this.mimeType=i,this}}class Df extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=new ou(this.manager);v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(i,function(b){try{l(g.parse(JSON.parse(b)))}catch(T){d?d(T):console.error(T),g.manager.itemError(i)}},h,d)}parse(i){const l=[];for(let h=0;h<i.length;h++){const d=Pf.parse(i[h]);l.push(d)}return l}}class Fo extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=[],b=new df,T=new ou(this.manager);T.setPath(this.path),T.setResponseType("arraybuffer"),T.setRequestHeader(this.requestHeader),T.setWithCredentials(g.withCredentials);let I=0;function N(z){T.load(i[z],function(U){const Q=g.parse(U,!0);v[z]={width:Q.width,height:Q.height,format:Q.format,mipmaps:Q.mipmaps},I+=1,I===6&&(Q.mipmapCount===1&&(b.minFilter=nr),b.image=v,b.format=Q.format,b.needsUpdate=!0,l&&l(b))},h,d)}if(Array.isArray(i))for(let z=0,U=i.length;z<U;++z)N(z);else T.load(i,function(z){const U=g.parse(z,!0);if(U.isCubemap){const Q=U.mipmaps.length/U.mipmapCount;for(let Y=0;Y<Q;Y++){v[Y]={mipmaps:[]};for(let H=0;H<U.mipmapCount;H++)v[Y].mipmaps.push(U.mipmaps[Y*U.mipmapCount+H]),v[Y].format=U.format,v[Y].width=U.width,v[Y].height=U.height}b.image=v}else b.image.width=U.width,b.image.height=U.height,b.mipmaps=U.mipmaps;U.mipmapCount===1&&(b.minFilter=nr),b.format=U.format,b.needsUpdate=!0,l&&l(b)},h,d);return b}}class ap extends Ls{constructor(i){super(i)}load(i,l,h,d){this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const g=this,v=ru.get(i);if(v!==void 0)return g.manager.itemStart(i),setTimeout(function(){l&&l(v),g.manager.itemEnd(i)},0),v;const b=Nc("img");function T(){N(),ru.add(i,this),l&&l(this),g.manager.itemEnd(i)}function I(z){N(),d&&d(z),g.manager.itemError(i),g.manager.itemEnd(i)}function N(){b.removeEventListener("load",T,!1),b.removeEventListener("error",I,!1)}return b.addEventListener("load",T,!1),b.addEventListener("error",I,!1),i.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(b.crossOrigin=this.crossOrigin),g.manager.itemStart(i),b.src=i,b}}class kv extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=new Vd,v=new ap(this.manager);v.setCrossOrigin(this.crossOrigin),v.setPath(this.path);let b=0;function T(I){v.load(i[I],function(N){g.images[I]=N,b++,b===6&&(g.needsUpdate=!0,l&&l(g))},void 0,d)}for(let I=0;I<i.length;++I)T(I);return g}}class au extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=new Jd,b=new ou(this.manager);return b.setResponseType("arraybuffer"),b.setRequestHeader(this.requestHeader),b.setPath(this.path),b.setWithCredentials(g.withCredentials),b.load(i,function(T){const I=g.parse(T);I&&(I.image!==void 0?v.image=I.image:I.data!==void 0&&(v.image.width=I.width,v.image.height=I.height,v.image.data=I.data,v.image.complete=!0),v.wrapS=I.wrapS!==void 0?I.wrapS:gi,v.wrapT=I.wrapT!==void 0?I.wrapT:gi,v.magFilter=I.magFilter!==void 0?I.magFilter:nr,v.minFilter=I.minFilter!==void 0?I.minFilter:nr,v.anisotropy=I.anisotropy!==void 0?I.anisotropy:1,I.encoding!==void 0&&(v.encoding=I.encoding),I.flipY!==void 0&&(v.flipY=I.flipY),I.format!==void 0&&(v.format=I.format),I.type!==void 0&&(v.type=I.type),I.mipmaps!==void 0&&(v.mipmaps=I.mipmaps,v.minFilter=Sn),I.mipmapCount===1&&(v.minFilter=nr),I.generateMipmaps!==void 0&&(v.generateMipmaps=I.generateMipmaps),v.needsUpdate=!0,l&&l(v,I))},h,d),v}}class Ov extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=new fs,v=new ap(this.manager);return v.setCrossOrigin(this.crossOrigin),v.setPath(this.path),v.load(i,function(b){g.image=b,g.needsUpdate=!0,l!==void 0&&l(g)},h,d),g}}class uc extends pi{constructor(i,l=1){super(),this.isLight=!0,this.type="Light",this.color=new bn(i),this.intensity=l}dispose(){}copy(i,l){return super.copy(i,l),this.color.copy(i.color),this.intensity=i.intensity,this}toJSON(i){const l=super.toJSON(i);return l.object.color=this.color.getHex(),l.object.intensity=this.intensity,this.groundColor!==void 0&&(l.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(l.object.distance=this.distance),this.angle!==void 0&&(l.object.angle=this.angle),this.decay!==void 0&&(l.object.decay=this.decay),this.penumbra!==void 0&&(l.object.penumbra=this.penumbra),this.shadow!==void 0&&(l.object.shadow=this.shadow.toJSON()),l}}class WA extends uc{constructor(i,l,h){super(i,h),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(pi.DefaultUp),this.updateMatrix(),this.groundColor=new bn(l)}copy(i,l){return super.copy(i,l),this.groundColor.copy(i.groundColor),this}}const Lv=new ti,Eg=new Re,Sg=new Re;class Rf{constructor(i){this.camera=i,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xt(512,512),this.map=null,this.mapPass=null,this.matrix=new ti,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Wp,this._frameExtents=new Xt(1,1),this._viewportCount=1,this._viewports=[new Zi(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(i){const l=this.camera,h=this.matrix;Eg.setFromMatrixPosition(i.matrixWorld),l.position.copy(Eg),Sg.setFromMatrixPosition(i.target.matrixWorld),l.lookAt(Sg),l.updateMatrixWorld(),Lv.multiplyMatrices(l.projectionMatrix,l.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Lv),h.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),h.multiply(l.projectionMatrix),h.multiply(l.matrixWorldInverse)}getViewport(i){return this._viewports[i]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(i){return this.camera=i.camera.clone(),this.bias=i.bias,this.normalBias=i.normalBias,this.radius=i.radius,this.mapSize.copy(i.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const i={};return this.bias!==0&&(i.bias=this.bias),this.normalBias!==0&&(i.normalBias=this.normalBias),this.radius!==1&&(i.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(i.mapSize=this.mapSize.toArray()),i.camera=this.camera.toJSON(!1).object,delete i.camera.matrix,i}}class hc extends Rf{constructor(){super(new Ks(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(i){const l=this.camera,h=2*Ih*i.angle*this.focus,d=this.mapSize.width/this.mapSize.height,g=i.distance||l.far;h===l.fov&&d===l.aspect&&g===l.far||(l.fov=h,l.aspect=d,l.far=g,l.updateProjectionMatrix()),super.updateMatrices(i)}copy(i){return super.copy(i),this.focus=i.focus,this}}class Nv extends uc{constructor(i,l,h=0,d=Math.PI/3,g=0,v=1){super(i,l),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(pi.DefaultUp),this.updateMatrix(),this.target=new pi,this.distance=h,this.angle=d,this.penumbra=g,this.decay=v,this.map=null,this.shadow=new hc}get power(){return this.intensity*Math.PI}set power(i){this.intensity=i/Math.PI}dispose(){this.shadow.dispose()}copy(i,l){return super.copy(i,l),this.distance=i.distance,this.angle=i.angle,this.penumbra=i.penumbra,this.decay=i.decay,this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}const Cg=new ti,Bf=new Re,kf=new Re;class Fv extends Rf{constructor(){super(new Ks(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xt(4,2),this._viewportCount=6,this._viewports=[new Zi(2,1,1,1),new Zi(0,1,1,1),new Zi(3,1,1,1),new Zi(1,1,1,1),new Zi(3,0,1,1),new Zi(1,0,1,1)],this._cubeDirections=[new Re(1,0,0),new Re(-1,0,0),new Re(0,0,1),new Re(0,0,-1),new Re(0,1,0),new Re(0,-1,0)],this._cubeUps=[new Re(0,1,0),new Re(0,1,0),new Re(0,1,0),new Re(0,1,0),new Re(0,0,1),new Re(0,0,-1)]}updateMatrices(i,l=0){const h=this.camera,d=this.matrix,g=i.distance||h.far;g!==h.far&&(h.far=g,h.updateProjectionMatrix()),Bf.setFromMatrixPosition(i.matrixWorld),h.position.copy(Bf),kf.copy(h.position),kf.add(this._cubeDirections[l]),h.up.copy(this._cubeUps[l]),h.lookAt(kf),h.updateMatrixWorld(),d.makeTranslation(-Bf.x,-Bf.y,-Bf.z),Cg.multiplyMatrices(h.projectionMatrix,h.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cg)}}class qA extends uc{constructor(i,l,h=0,d=1){super(i,l),this.isPointLight=!0,this.type="PointLight",this.distance=h,this.decay=d,this.shadow=new Fv}get power(){return 4*this.intensity*Math.PI}set power(i){this.intensity=i/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(i,l){return super.copy(i,l),this.distance=i.distance,this.decay=i.decay,this.shadow=i.shadow.clone(),this}}class Mg extends Rf{constructor(){super(new Rm(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class YA extends uc{constructor(i,l){super(i,l),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(pi.DefaultUp),this.updateMatrix(),this.target=new pi,this.shadow=new Mg}dispose(){this.shadow.dispose()}copy(i){return super.copy(i),this.target=i.target.clone(),this.shadow=i.shadow.clone(),this}}class XA extends uc{constructor(i,l){super(i,l),this.isAmbientLight=!0,this.type="AmbientLight"}}class KA extends uc{constructor(i,l,h=10,d=10){super(i,l),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=h,this.height=d}get power(){return this.intensity*this.width*this.height*Math.PI}set power(i){this.intensity=i/(this.width*this.height*Math.PI)}copy(i){return super.copy(i),this.width=i.width,this.height=i.height,this}toJSON(i){const l=super.toJSON(i);return l.object.width=this.width,l.object.height=this.height,l}}class Of{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let i=0;i<9;i++)this.coefficients.push(new Re)}set(i){for(let l=0;l<9;l++)this.coefficients[l].copy(i[l]);return this}zero(){for(let i=0;i<9;i++)this.coefficients[i].set(0,0,0);return this}getAt(i,l){const h=i.x,d=i.y,g=i.z,v=this.coefficients;return l.copy(v[0]).multiplyScalar(.282095),l.addScaledVector(v[1],.488603*d),l.addScaledVector(v[2],.488603*g),l.addScaledVector(v[3],.488603*h),l.addScaledVector(v[4],h*d*1.092548),l.addScaledVector(v[5],d*g*1.092548),l.addScaledVector(v[6],.315392*(3*g*g-1)),l.addScaledVector(v[7],h*g*1.092548),l.addScaledVector(v[8],.546274*(h*h-d*d)),l}getIrradianceAt(i,l){const h=i.x,d=i.y,g=i.z,v=this.coefficients;return l.copy(v[0]).multiplyScalar(.886227),l.addScaledVector(v[1],1.023328*d),l.addScaledVector(v[2],1.023328*g),l.addScaledVector(v[3],1.023328*h),l.addScaledVector(v[4],.858086*h*d),l.addScaledVector(v[5],.858086*d*g),l.addScaledVector(v[6],.743125*g*g-.247708),l.addScaledVector(v[7],.858086*h*g),l.addScaledVector(v[8],.429043*(h*h-d*d)),l}add(i){for(let l=0;l<9;l++)this.coefficients[l].add(i.coefficients[l]);return this}addScaledSH(i,l){for(let h=0;h<9;h++)this.coefficients[h].addScaledVector(i.coefficients[h],l);return this}scale(i){for(let l=0;l<9;l++)this.coefficients[l].multiplyScalar(i);return this}lerp(i,l){for(let h=0;h<9;h++)this.coefficients[h].lerp(i.coefficients[h],l);return this}equals(i){for(let l=0;l<9;l++)if(!this.coefficients[l].equals(i.coefficients[l]))return!1;return!0}copy(i){return this.set(i.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(i,l=0){const h=this.coefficients;for(let d=0;d<9;d++)h[d].fromArray(i,l+3*d);return this}toArray(i=[],l=0){const h=this.coefficients;for(let d=0;d<9;d++)h[d].toArray(i,l+3*d);return i}static getBasisAt(i,l){const h=i.x,d=i.y,g=i.z;l[0]=.282095,l[1]=.488603*d,l[2]=.488603*g,l[3]=.488603*h,l[4]=1.092548*h*d,l[5]=1.092548*d*g,l[6]=.315392*(3*g*g-1),l[7]=1.092548*h*g,l[8]=.546274*(h*h-d*d)}}class Tg extends uc{constructor(i=new Of,l=1){super(void 0,l),this.isLightProbe=!0,this.sh=i}copy(i){return super.copy(i),this.sh.copy(i.sh),this}fromJSON(i){return this.intensity=i.intensity,this.sh.fromArray(i.sh),this}toJSON(i){const l=super.toJSON(i);return l.object.sh=this.sh.toArray(),l}}class lu extends Ls{constructor(i){super(i),this.textures={}}load(i,l,h,d){const g=this,v=new ou(g.manager);v.setPath(g.path),v.setRequestHeader(g.requestHeader),v.setWithCredentials(g.withCredentials),v.load(i,function(b){try{l(g.parse(JSON.parse(b)))}catch(T){d?d(T):console.error(T),g.manager.itemError(i)}},h,d)}parse(i){const l=this.textures;function h(g){return l[g]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",g),l[g]}const d=lu.createMaterialFromType(i.type);if(i.uuid!==void 0&&(d.uuid=i.uuid),i.name!==void 0&&(d.name=i.name),i.color!==void 0&&d.color!==void 0&&d.color.setHex(i.color),i.roughness!==void 0&&(d.roughness=i.roughness),i.metalness!==void 0&&(d.metalness=i.metalness),i.sheen!==void 0&&(d.sheen=i.sheen),i.sheenColor!==void 0&&(d.sheenColor=new bn().setHex(i.sheenColor)),i.sheenRoughness!==void 0&&(d.sheenRoughness=i.sheenRoughness),i.emissive!==void 0&&d.emissive!==void 0&&d.emissive.setHex(i.emissive),i.specular!==void 0&&d.specular!==void 0&&d.specular.setHex(i.specular),i.specularIntensity!==void 0&&(d.specularIntensity=i.specularIntensity),i.specularColor!==void 0&&d.specularColor!==void 0&&d.specularColor.setHex(i.specularColor),i.shininess!==void 0&&(d.shininess=i.shininess),i.clearcoat!==void 0&&(d.clearcoat=i.clearcoat),i.clearcoatRoughness!==void 0&&(d.clearcoatRoughness=i.clearcoatRoughness),i.iridescence!==void 0&&(d.iridescence=i.iridescence),i.iridescenceIOR!==void 0&&(d.iridescenceIOR=i.iridescenceIOR),i.iridescenceThicknessRange!==void 0&&(d.iridescenceThicknessRange=i.iridescenceThicknessRange),i.transmission!==void 0&&(d.transmission=i.transmission),i.thickness!==void 0&&(d.thickness=i.thickness),i.attenuationDistance!==void 0&&(d.attenuationDistance=i.attenuationDistance),i.attenuationColor!==void 0&&d.attenuationColor!==void 0&&d.attenuationColor.setHex(i.attenuationColor),i.fog!==void 0&&(d.fog=i.fog),i.flatShading!==void 0&&(d.flatShading=i.flatShading),i.blending!==void 0&&(d.blending=i.blending),i.combine!==void 0&&(d.combine=i.combine),i.side!==void 0&&(d.side=i.side),i.shadowSide!==void 0&&(d.shadowSide=i.shadowSide),i.opacity!==void 0&&(d.opacity=i.opacity),i.transparent!==void 0&&(d.transparent=i.transparent),i.alphaTest!==void 0&&(d.alphaTest=i.alphaTest),i.depthTest!==void 0&&(d.depthTest=i.depthTest),i.depthWrite!==void 0&&(d.depthWrite=i.depthWrite),i.colorWrite!==void 0&&(d.colorWrite=i.colorWrite),i.stencilWrite!==void 0&&(d.stencilWrite=i.stencilWrite),i.stencilWriteMask!==void 0&&(d.stencilWriteMask=i.stencilWriteMask),i.stencilFunc!==void 0&&(d.stencilFunc=i.stencilFunc),i.stencilRef!==void 0&&(d.stencilRef=i.stencilRef),i.stencilFuncMask!==void 0&&(d.stencilFuncMask=i.stencilFuncMask),i.stencilFail!==void 0&&(d.stencilFail=i.stencilFail),i.stencilZFail!==void 0&&(d.stencilZFail=i.stencilZFail),i.stencilZPass!==void 0&&(d.stencilZPass=i.stencilZPass),i.wireframe!==void 0&&(d.wireframe=i.wireframe),i.wireframeLinewidth!==void 0&&(d.wireframeLinewidth=i.wireframeLinewidth),i.wireframeLinecap!==void 0&&(d.wireframeLinecap=i.wireframeLinecap),i.wireframeLinejoin!==void 0&&(d.wireframeLinejoin=i.wireframeLinejoin),i.rotation!==void 0&&(d.rotation=i.rotation),i.linewidth!==1&&(d.linewidth=i.linewidth),i.dashSize!==void 0&&(d.dashSize=i.dashSize),i.gapSize!==void 0&&(d.gapSize=i.gapSize),i.scale!==void 0&&(d.scale=i.scale),i.polygonOffset!==void 0&&(d.polygonOffset=i.polygonOffset),i.polygonOffsetFactor!==void 0&&(d.polygonOffsetFactor=i.polygonOffsetFactor),i.polygonOffsetUnits!==void 0&&(d.polygonOffsetUnits=i.polygonOffsetUnits),i.dithering!==void 0&&(d.dithering=i.dithering),i.alphaToCoverage!==void 0&&(d.alphaToCoverage=i.alphaToCoverage),i.premultipliedAlpha!==void 0&&(d.premultipliedAlpha=i.premultipliedAlpha),i.visible!==void 0&&(d.visible=i.visible),i.toneMapped!==void 0&&(d.toneMapped=i.toneMapped),i.userData!==void 0&&(d.userData=i.userData),i.vertexColors!==void 0&&(typeof i.vertexColors=="number"?d.vertexColors=i.vertexColors>0:d.vertexColors=i.vertexColors),i.uniforms!==void 0)for(const g in i.uniforms){const v=i.uniforms[g];switch(d.uniforms[g]={},v.type){case"t":d.uniforms[g].value=h(v.value);break;case"c":d.uniforms[g].value=new bn().setHex(v.value);break;case"v2":d.uniforms[g].value=new Xt().fromArray(v.value);break;case"v3":d.uniforms[g].value=new Re().fromArray(v.value);break;case"v4":d.uniforms[g].value=new Zi().fromArray(v.value);break;case"m3":d.uniforms[g].value=new Is().fromArray(v.value);break;case"m4":d.uniforms[g].value=new ti().fromArray(v.value);break;default:d.uniforms[g].value=v.value}}if(i.defines!==void 0&&(d.defines=i.defines),i.vertexShader!==void 0&&(d.vertexShader=i.vertexShader),i.fragmentShader!==void 0&&(d.fragmentShader=i.fragmentShader),i.glslVersion!==void 0&&(d.glslVersion=i.glslVersion),i.extensions!==void 0)for(const g in i.extensions)d.extensions[g]=i.extensions[g];if(i.size!==void 0&&(d.size=i.size),i.sizeAttenuation!==void 0&&(d.sizeAttenuation=i.sizeAttenuation),i.map!==void 0&&(d.map=h(i.map)),i.matcap!==void 0&&(d.matcap=h(i.matcap)),i.alphaMap!==void 0&&(d.alphaMap=h(i.alphaMap)),i.bumpMap!==void 0&&(d.bumpMap=h(i.bumpMap)),i.bumpScale!==void 0&&(d.bumpScale=i.bumpScale),i.normalMap!==void 0&&(d.normalMap=h(i.normalMap)),i.normalMapType!==void 0&&(d.normalMapType=i.normalMapType),i.normalScale!==void 0){let g=i.normalScale;Array.isArray(g)===!1&&(g=[g,g]),d.normalScale=new Xt().fromArray(g)}return i.displacementMap!==void 0&&(d.displacementMap=h(i.displacementMap)),i.displacementScale!==void 0&&(d.displacementScale=i.displacementScale),i.displacementBias!==void 0&&(d.displacementBias=i.displacementBias),i.roughnessMap!==void 0&&(d.roughnessMap=h(i.roughnessMap)),i.metalnessMap!==void 0&&(d.metalnessMap=h(i.metalnessMap)),i.emissiveMap!==void 0&&(d.emissiveMap=h(i.emissiveMap)),i.emissiveIntensity!==void 0&&(d.emissiveIntensity=i.emissiveIntensity),i.specularMap!==void 0&&(d.specularMap=h(i.specularMap)),i.specularIntensityMap!==void 0&&(d.specularIntensityMap=h(i.specularIntensityMap)),i.specularColorMap!==void 0&&(d.specularColorMap=h(i.specularColorMap)),i.envMap!==void 0&&(d.envMap=h(i.envMap)),i.envMapIntensity!==void 0&&(d.envMapIntensity=i.envMapIntensity),i.reflectivity!==void 0&&(d.reflectivity=i.reflectivity),i.refractionRatio!==void 0&&(d.refractionRatio=i.refractionRatio),i.lightMap!==void 0&&(d.lightMap=h(i.lightMap)),i.lightMapIntensity!==void 0&&(d.lightMapIntensity=i.lightMapIntensity),i.aoMap!==void 0&&(d.aoMap=h(i.aoMap)),i.aoMapIntensity!==void 0&&(d.aoMapIntensity=i.aoMapIntensity),i.gradientMap!==void 0&&(d.gradientMap=h(i.gradientMap)),i.clearcoatMap!==void 0&&(d.clearcoatMap=h(i.clearcoatMap)),i.clearcoatRoughnessMap!==void 0&&(d.clearcoatRoughnessMap=h(i.clearcoatRoughnessMap)),i.clearcoatNormalMap!==void 0&&(d.clearcoatNormalMap=h(i.clearcoatNormalMap)),i.clearcoatNormalScale!==void 0&&(d.clearcoatNormalScale=new Xt().fromArray(i.clearcoatNormalScale)),i.iridescenceMap!==void 0&&(d.iridescenceMap=h(i.iridescenceMap)),i.iridescenceThicknessMap!==void 0&&(d.iridescenceThicknessMap=h(i.iridescenceThicknessMap)),i.transmissionMap!==void 0&&(d.transmissionMap=h(i.transmissionMap)),i.thicknessMap!==void 0&&(d.thicknessMap=h(i.thicknessMap)),i.sheenColorMap!==void 0&&(d.sheenColorMap=h(i.sheenColorMap)),i.sheenRoughnessMap!==void 0&&(d.sheenRoughnessMap=h(i.sheenRoughnessMap)),d}setTextures(i){return this.textures=i,this}static createMaterialFromType(i){return new{ShadowMaterial:wg,SpriteMaterial:eg,RawShaderMaterial:GA,ShaderMaterial:wl,PointsMaterial:lg,MeshPhysicalMaterial:Iv,MeshStandardMaterial:Tv,MeshPhongMaterial:Sf,MeshToonMaterial:QA,MeshNormalMaterial:Cf,MeshLambertMaterial:Pv,MeshDepthMaterial:nf,MeshDistanceMaterial:qd,MeshBasicMaterial:Wa,MeshMatcapMaterial:Mf,LineDashedMaterial:Dv,LineBasicMaterial:Lo,Material:Bs}[i]}}class dc{static decodeText(i){if(typeof TextDecoder<"u")return new TextDecoder().decode(i);let l="";for(let h=0,d=i.length;h<d;h++)l+=String.fromCharCode(i[h]);try{return decodeURIComponent(escape(l))}catch{return l}}static extractUrlBase(i){const l=i.lastIndexOf("/");return l===-1?"./":i.slice(0,l+1)}static resolveURL(i,l){return typeof i!="string"||i===""?"":(/^https?:\/\//i.test(l)&&/^\//.test(i)&&(l=l.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(i)||/^data:.*,.*$/i.test(i)||/^blob:.*$/i.test(i)?i:l+i)}}class ga extends In{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(i){return super.copy(i),this.instanceCount=i.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){const i=super.toJSON(this);return i.instanceCount=this.instanceCount,i.isInstancedBufferGeometry=!0,i}}class JA extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=new ou(g.manager);v.setPath(g.path),v.setRequestHeader(g.requestHeader),v.setWithCredentials(g.withCredentials),v.load(i,function(b){try{l(g.parse(JSON.parse(b)))}catch(T){d?d(T):console.error(T),g.manager.itemError(i)}},h,d)}parse(i){const l={},h={};function d(z,U){if(l[U]!==void 0)return l[U];const Q=z.interleavedBuffers[U],Y=function(ie,re){if(h[re]!==void 0)return h[re];const ve=ie.arrayBuffers[re],Ee=new Uint32Array(ve).buffer;return h[re]=Ee,Ee}(z,Q.buffer),H=Lc(Q.type,Y),ne=new Zm(H,Q.stride);return ne.uuid=Q.uuid,l[U]=ne,ne}const g=i.isInstancedBufferGeometry?new ga:new In,v=i.data.index;if(v!==void 0){const z=Lc(v.type,v.array);g.setIndex(new mr(z,1))}const b=i.data.attributes;for(const z in b){const U=b[z];let Q;if(U.isInterleavedBufferAttribute){const Y=d(i.data,U.data);Q=new oc(Y,U.itemSize,U.offset,U.normalized)}else{const Y=Lc(U.type,U.array);Q=new(U.isInstancedBufferAttribute?qh:mr)(Y,U.itemSize,U.normalized)}U.name!==void 0&&(Q.name=U.name),U.usage!==void 0&&Q.setUsage(U.usage),U.updateRange!==void 0&&(Q.updateRange.offset=U.updateRange.offset,Q.updateRange.count=U.updateRange.count),g.setAttribute(z,Q)}const T=i.data.morphAttributes;if(T)for(const z in T){const U=T[z],Q=[];for(let Y=0,H=U.length;Y<H;Y++){const ne=U[Y];let ie;if(ne.isInterleavedBufferAttribute){const re=d(i.data,ne.data);ie=new oc(re,ne.itemSize,ne.offset,ne.normalized)}else{const re=Lc(ne.type,ne.array);ie=new mr(re,ne.itemSize,ne.normalized)}ne.name!==void 0&&(ie.name=ne.name),Q.push(ie)}g.morphAttributes[z]=Q}i.data.morphTargetsRelative&&(g.morphTargetsRelative=!0);const I=i.data.groups||i.data.drawcalls||i.data.offsets;if(I!==void 0)for(let z=0,U=I.length;z!==U;++z){const Q=I[z];g.addGroup(Q.start,Q.count,Q.materialIndex)}const N=i.data.boundingSphere;if(N!==void 0){const z=new Re;N.center!==void 0&&z.fromArray(N.center),g.boundingSphere=new ea(z,N.radius)}return i.name&&(g.name=i.name),i.userData&&(g.userData=i.userData),g}}class Uv extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=this.path===""?dc.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||v;const b=new ou(this.manager);b.setPath(this.path),b.setRequestHeader(this.requestHeader),b.setWithCredentials(this.withCredentials),b.load(i,function(T){let I=null;try{I=JSON.parse(T)}catch(z){return d!==void 0&&d(z),void console.error("THREE:ObjectLoader: Can't parse "+i+".",z.message)}const N=I.metadata;N!==void 0&&N.type!==void 0&&N.type.toLowerCase()!=="geometry"?g.parse(I,l):console.error("THREE.ObjectLoader: Can't load "+i)},h,d)}async loadAsync(i,l){const h=this.path===""?dc.extractUrlBase(i):this.path;this.resourcePath=this.resourcePath||h;const d=new ou(this.manager);d.setPath(this.path),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials);const g=await d.loadAsync(i,l),v=JSON.parse(g),b=v.metadata;if(b===void 0||b.type===void 0||b.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+i);return await this.parseAsync(v)}parse(i,l){const h=this.parseAnimations(i.animations),d=this.parseShapes(i.shapes),g=this.parseGeometries(i.geometries,d),v=this.parseImages(i.images,function(){l!==void 0&&l(I)}),b=this.parseTextures(i.textures,v),T=this.parseMaterials(i.materials,b),I=this.parseObject(i.object,g,T,b,h),N=this.parseSkeletons(i.skeletons,I);if(this.bindSkeletons(I,N),l!==void 0){let z=!1;for(const U in v)if(v[U].data instanceof HTMLImageElement){z=!0;break}z===!1&&l(I)}return I}async parseAsync(i){const l=this.parseAnimations(i.animations),h=this.parseShapes(i.shapes),d=this.parseGeometries(i.geometries,h),g=await this.parseImagesAsync(i.images),v=this.parseTextures(i.textures,g),b=this.parseMaterials(i.materials,v),T=this.parseObject(i.object,d,b,v,l),I=this.parseSkeletons(i.skeletons,T);return this.bindSkeletons(T,I),T}parseShapes(i){const l={};if(i!==void 0)for(let h=0,d=i.length;h<d;h++){const g=new Xh().fromJSON(i[h]);l[g.uuid]=g}return l}parseSkeletons(i,l){const h={},d={};if(l.traverse(function(g){g.isBone&&(d[g.uuid]=g)}),i!==void 0)for(let g=0,v=i.length;g<v;g++){const b=new of().fromJSON(i[g],d);h[b.uuid]=b}return h}parseGeometries(i,l){const h={};if(i!==void 0){const d=new JA;for(let g=0,v=i.length;g<v;g++){let b;const T=i[g];switch(T.type){case"BufferGeometry":case"InstancedBufferGeometry":b=d.parse(T);break;default:T.type in Ja?b=Ja[T.type].fromJSON(T,l):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${T.type}"`)}b.uuid=T.uuid,T.name!==void 0&&(b.name=T.name),b.isBufferGeometry===!0&&T.userData!==void 0&&(b.userData=T.userData),h[T.uuid]=b}}return h}parseMaterials(i,l){const h={},d={};if(i!==void 0){const g=new lu;g.setTextures(l);for(let v=0,b=i.length;v<b;v++){const T=i[v];h[T.uuid]===void 0&&(h[T.uuid]=g.parse(T)),d[T.uuid]=h[T.uuid]}}return d}parseAnimations(i){const l={};if(i!==void 0)for(let h=0;h<i.length;h++){const d=i[h],g=Pf.parse(d);l[g.uuid]=g}return l}parseImages(i,l){const h=this,d={};let g;function v(b){if(typeof b=="string"){const T=b;return function(I){return h.manager.itemStart(I),g.load(I,function(){h.manager.itemEnd(I)},void 0,function(){h.manager.itemError(I),h.manager.itemEnd(I)})}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(T)?T:h.resourcePath+T)}return b.data?{data:Lc(b.type,b.data),width:b.width,height:b.height,complete:!0}:null}if(i!==void 0&&i.length>0){const b=new su(l);g=new ap(b),g.setCrossOrigin(this.crossOrigin);for(let T=0,I=i.length;T<I;T++){const N=i[T],z=N.url;if(Array.isArray(z)){const U=[];for(let Q=0,Y=z.length;Q<Y;Q++){const H=v(z[Q]);H!==null&&(H instanceof HTMLImageElement?U.push(H):U.push(new Jd(H.data,H.width,H.height)))}d[N.uuid]=new Fc(U)}else{const U=v(N.url);d[N.uuid]=new Fc(U)}}}return d}async parseImagesAsync(i){const l=this,h={};let d;async function g(v){if(typeof v=="string"){const b=v,T=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(b)?b:l.resourcePath+b;return await d.loadAsync(T)}return v.data?{data:Lc(v.type,v.data),width:v.width,height:v.height,complete:!0}:null}if(i!==void 0&&i.length>0){d=new ap(this.manager),d.setCrossOrigin(this.crossOrigin);for(let v=0,b=i.length;v<b;v++){const T=i[v],I=T.url;if(Array.isArray(I)){const N=[];for(let z=0,U=I.length;z<U;z++){const Q=I[z],Y=await g(Q);Y!==null&&(Y instanceof HTMLImageElement?N.push(Y):N.push(new Jd(Y.data,Y.width,Y.height)))}h[T.uuid]=new Fc(N)}else{const N=await g(T.url);h[T.uuid]=new Fc(N)}}}return h}parseTextures(i,l){function h(g,v){return typeof g=="number"?g:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",g),v[g])}const d={};if(i!==void 0)for(let g=0,v=i.length;g<v;g++){const b=i[g];b.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',b.uuid),l[b.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",b.image);const T=l[b.image],I=T?T.data:void 0;let N;Array.isArray(I)?(N=new Vd,I.length===6&&(N.needsUpdate=!0)):(N=I&&I.data?new Jd:new fs,I&&I.complete&&(N.needsUpdate=!0)),N.source=T,N.uuid=b.uuid,b.name!==void 0&&(N.name=b.name),b.mapping!==void 0&&(N.mapping=h(b.mapping,xw)),b.offset!==void 0&&N.offset.fromArray(b.offset),b.repeat!==void 0&&N.repeat.fromArray(b.repeat),b.center!==void 0&&N.center.fromArray(b.center),b.rotation!==void 0&&(N.rotation=b.rotation),b.wrap!==void 0&&(N.wrapS=h(b.wrap[0],Ig),N.wrapT=h(b.wrap[1],Ig)),b.format!==void 0&&(N.format=b.format),b.type!==void 0&&(N.type=b.type),b.encoding!==void 0&&(N.encoding=b.encoding),b.minFilter!==void 0&&(N.minFilter=h(b.minFilter,$A)),b.magFilter!==void 0&&(N.magFilter=h(b.magFilter,$A)),b.anisotropy!==void 0&&(N.anisotropy=b.anisotropy),b.flipY!==void 0&&(N.flipY=b.flipY),b.premultiplyAlpha!==void 0&&(N.premultiplyAlpha=b.premultiplyAlpha),b.unpackAlignment!==void 0&&(N.unpackAlignment=b.unpackAlignment),b.userData!==void 0&&(N.userData=b.userData),d[b.uuid]=N}return d}parseObject(i,l,h,d,g){let v,b,T;function I(U){return l[U]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",U),l[U]}function N(U){if(U!==void 0){if(Array.isArray(U)){const Q=[];for(let Y=0,H=U.length;Y<H;Y++){const ne=U[Y];h[ne]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ne),Q.push(h[ne])}return Q}return h[U]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",U),h[U]}}function z(U){return d[U]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",U),d[U]}switch(i.type){case"Scene":v=new CA,i.background!==void 0&&(Number.isInteger(i.background)?v.background=new bn(i.background):v.background=z(i.background)),i.environment!==void 0&&(v.environment=z(i.environment)),i.fog!==void 0&&(i.fog.type==="Fog"?v.fog=new Yd(i.fog.color,i.fog.near,i.fog.far):i.fog.type==="FogExp2"&&(v.fog=new qu(i.fog.color,i.fog.density)));break;case"PerspectiveCamera":v=new Ks(i.fov,i.aspect,i.near,i.far),i.focus!==void 0&&(v.focus=i.focus),i.zoom!==void 0&&(v.zoom=i.zoom),i.filmGauge!==void 0&&(v.filmGauge=i.filmGauge),i.filmOffset!==void 0&&(v.filmOffset=i.filmOffset),i.view!==void 0&&(v.view=Object.assign({},i.view));break;case"OrthographicCamera":v=new Rm(i.left,i.right,i.top,i.bottom,i.near,i.far),i.zoom!==void 0&&(v.zoom=i.zoom),i.view!==void 0&&(v.view=Object.assign({},i.view));break;case"AmbientLight":v=new XA(i.color,i.intensity);break;case"DirectionalLight":v=new YA(i.color,i.intensity);break;case"PointLight":v=new qA(i.color,i.intensity,i.distance,i.decay);break;case"RectAreaLight":v=new KA(i.color,i.intensity,i.width,i.height);break;case"SpotLight":v=new Nv(i.color,i.intensity,i.distance,i.angle,i.penumbra,i.decay);break;case"HemisphereLight":v=new WA(i.color,i.groundColor,i.intensity);break;case"LightProbe":v=new Tg().fromJSON(i);break;case"SkinnedMesh":b=I(i.geometry),T=N(i.material),v=new uv(b,T),i.bindMode!==void 0&&(v.bindMode=i.bindMode),i.bindMatrix!==void 0&&v.bindMatrix.fromArray(i.bindMatrix),i.skeleton!==void 0&&(v.skeleton=i.skeleton);break;case"Mesh":b=I(i.geometry),T=N(i.material),v=new ks(b,T);break;case"InstancedMesh":b=I(i.geometry),T=N(i.material);const U=i.count,Q=i.instanceMatrix,Y=i.instanceColor;v=new sg(b,T,U),v.instanceMatrix=new qh(new Float32Array(Q.array),16),Y!==void 0&&(v.instanceColor=new qh(new Float32Array(Y.array),Y.itemSize));break;case"LOD":v=new Kd;break;case"Line":v=new lc(I(i.geometry),N(i.material));break;case"LineLoop":v=new $d(I(i.geometry),N(i.material));break;case"LineSegments":v=new cc(I(i.geometry),N(i.material));break;case"PointCloud":case"Points":v=new hg(I(i.geometry),N(i.material));break;case"Sprite":v=new ig(N(i.material));break;case"Group":v=new Xc;break;case"Bone":v=new hv;break;default:v=new pi}if(v.uuid=i.uuid,i.name!==void 0&&(v.name=i.name),i.matrix!==void 0?(v.matrix.fromArray(i.matrix),i.matrixAutoUpdate!==void 0&&(v.matrixAutoUpdate=i.matrixAutoUpdate),v.matrixAutoUpdate&&v.matrix.decompose(v.position,v.quaternion,v.scale)):(i.position!==void 0&&v.position.fromArray(i.position),i.rotation!==void 0&&v.rotation.fromArray(i.rotation),i.quaternion!==void 0&&v.quaternion.fromArray(i.quaternion),i.scale!==void 0&&v.scale.fromArray(i.scale)),i.castShadow!==void 0&&(v.castShadow=i.castShadow),i.receiveShadow!==void 0&&(v.receiveShadow=i.receiveShadow),i.shadow&&(i.shadow.bias!==void 0&&(v.shadow.bias=i.shadow.bias),i.shadow.normalBias!==void 0&&(v.shadow.normalBias=i.shadow.normalBias),i.shadow.radius!==void 0&&(v.shadow.radius=i.shadow.radius),i.shadow.mapSize!==void 0&&v.shadow.mapSize.fromArray(i.shadow.mapSize),i.shadow.camera!==void 0&&(v.shadow.camera=this.parseObject(i.shadow.camera))),i.visible!==void 0&&(v.visible=i.visible),i.frustumCulled!==void 0&&(v.frustumCulled=i.frustumCulled),i.renderOrder!==void 0&&(v.renderOrder=i.renderOrder),i.userData!==void 0&&(v.userData=i.userData),i.layers!==void 0&&(v.layers.mask=i.layers),i.children!==void 0){const U=i.children;for(let Q=0;Q<U.length;Q++)v.add(this.parseObject(U[Q],l,h,d,g))}if(i.animations!==void 0){const U=i.animations;for(let Q=0;Q<U.length;Q++){const Y=U[Q];v.animations.push(g[Y])}}if(i.type==="LOD"){i.autoUpdate!==void 0&&(v.autoUpdate=i.autoUpdate);const U=i.levels;for(let Q=0;Q<U.length;Q++){const Y=U[Q],H=v.getObjectByProperty("uuid",Y.object);H!==void 0&&v.addLevel(H,Y.distance)}}return v}bindSkeletons(i,l){Object.keys(l).length!==0&&i.traverse(function(h){if(h.isSkinnedMesh===!0&&h.skeleton!==void 0){const d=l[h.skeleton];d===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",h.skeleton):h.bind(d,h.bindMatrix)}})}}const xw={UVMapping:Rr,CubeReflectionMapping:Xi,CubeRefractionMapping:zi,EquirectangularReflectionMapping:Vi,EquirectangularRefractionMapping:Gi,CubeUVReflectionMapping:Vr},Ig={RepeatWrapping:Di,ClampToEdgeWrapping:gi,MirroredRepeatWrapping:br},$A={NearestFilter:ar,NearestMipmapNearestFilter:Ki,NearestMipmapLinearFilter:lr,LinearFilter:nr,LinearMipmapNearestFilter:Es,LinearMipmapLinearFilter:Sn};class jv extends Ls{constructor(i){super(i),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(i){return this.options=i,this}load(i,l,h,d){i===void 0&&(i=""),this.path!==void 0&&(i=this.path+i),i=this.manager.resolveURL(i);const g=this,v=ru.get(i);if(v!==void 0)return g.manager.itemStart(i),setTimeout(function(){l&&l(v),g.manager.itemEnd(i)},0),v;const b={};b.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",b.headers=this.requestHeader,fetch(i,b).then(function(T){return T.blob()}).then(function(T){return createImageBitmap(T,Object.assign(g.options,{colorSpaceConversion:"none"}))}).then(function(T){ru.add(i,T),l&&l(T),g.manager.itemEnd(i)}).catch(function(T){d&&d(T),g.manager.itemError(i),g.manager.itemEnd(i)}),g.manager.itemStart(i)}}let Pg;const Lf={getContext:function(){return Pg===void 0&&(Pg=new(window.AudioContext||window.webkitAudioContext)),Pg},setContext:function(x){Pg=x}};class Ew extends Ls{constructor(i){super(i)}load(i,l,h,d){const g=this,v=new ou(this.manager);v.setResponseType("arraybuffer"),v.setPath(this.path),v.setRequestHeader(this.requestHeader),v.setWithCredentials(this.withCredentials),v.load(i,function(b){try{const T=b.slice(0);Lf.getContext().decodeAudioData(T,function(I){l(I)})}catch(T){d?d(T):console.error(T),g.manager.itemError(i)}},h,d)}}class zv extends Tg{constructor(i,l,h=1){super(void 0,h),this.isHemisphereLightProbe=!0;const d=new bn().set(i),g=new bn().set(l),v=new Re(d.r,d.g,d.b),b=new Re(g.r,g.g,g.b),T=Math.sqrt(Math.PI),I=T*Math.sqrt(.75);this.sh.coefficients[0].copy(v).add(b).multiplyScalar(T),this.sh.coefficients[1].copy(v).sub(b).multiplyScalar(I)}}class Dg extends Tg{constructor(i,l=1){super(void 0,l),this.isAmbientLightProbe=!0;const h=new bn().set(i);this.sh.coefficients[0].set(h.r,h.g,h.b).multiplyScalar(2*Math.sqrt(Math.PI))}}const lp=new ti,Rg=new ti,cu=new ti;class td{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ks,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ks,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(i){const l=this._cache;if(l.focus!==i.focus||l.fov!==i.fov||l.aspect!==i.aspect*this.aspect||l.near!==i.near||l.far!==i.far||l.zoom!==i.zoom||l.eyeSep!==this.eyeSep){l.focus=i.focus,l.fov=i.fov,l.aspect=i.aspect*this.aspect,l.near=i.near,l.far=i.far,l.zoom=i.zoom,l.eyeSep=this.eyeSep,cu.copy(i.projectionMatrix);const h=l.eyeSep/2,d=h*l.near/l.focus,g=l.near*Math.tan(Oc*l.fov*.5)/l.zoom;let v,b;Rg.elements[12]=-h,lp.elements[12]=h,v=-g*l.aspect+d,b=g*l.aspect+d,cu.elements[0]=2*l.near/(b-v),cu.elements[8]=(b+v)/(b-v),this.cameraL.projectionMatrix.copy(cu),v=-g*l.aspect-d,b=g*l.aspect-d,cu.elements[0]=2*l.near/(b-v),cu.elements[8]=(b+v)/(b-v),this.cameraR.projectionMatrix.copy(cu)}this.cameraL.matrixWorld.copy(i.matrixWorld).multiply(Rg),this.cameraR.matrixWorld.copy(i.matrixWorld).multiply(lp)}}class Bg{constructor(i=!0){this.autoStart=i,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=ZA(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let i=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const l=ZA();i=(l-this.oldTime)/1e3,this.oldTime=l,this.elapsedTime+=i}return i}}function ZA(){return(typeof performance>"u"?Date:performance).now()}const nh=new Re,uu=new Ps,Sw=new Re,Mo=new Re;class ey extends pi{constructor(){super(),this.type="AudioListener",this.context=Lf.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Bg}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(i){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=i,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}updateMatrixWorld(i){super.updateMatrixWorld(i);const l=this.context.listener,h=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(nh,uu,Sw),Mo.set(0,0,-1).applyQuaternion(uu),l.positionX){const d=this.context.currentTime+this.timeDelta;l.positionX.linearRampToValueAtTime(nh.x,d),l.positionY.linearRampToValueAtTime(nh.y,d),l.positionZ.linearRampToValueAtTime(nh.z,d),l.forwardX.linearRampToValueAtTime(Mo.x,d),l.forwardY.linearRampToValueAtTime(Mo.y,d),l.forwardZ.linearRampToValueAtTime(Mo.z,d),l.upX.linearRampToValueAtTime(h.x,d),l.upY.linearRampToValueAtTime(h.y,d),l.upZ.linearRampToValueAtTime(h.z,d)}else l.setPosition(nh.x,nh.y,nh.z),l.setOrientation(Mo.x,Mo.y,Mo.z,h.x,h.y,h.z)}}class hu extends pi{constructor(i){super(),this.type="Audio",this.listener=i,this.context=i.context,this.gain=this.context.createGain(),this.gain.connect(i.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(i){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=i,this.connect(),this}setMediaElementSource(i){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(i),this.connect(),this}setMediaStreamSource(i){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(i),this.connect(),this}setBuffer(i){return this.buffer=i,this.sourceType="buffer",this.autoplay&&this.play(),this}play(i=0){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+i;const l=this.context.createBufferSource();return l.buffer=this.buffer,l.loop=this.loop,l.loopStart=this.loopStart,l.loopEnd=this.loopEnd,l.onended=this.onEnded.bind(this),l.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=l,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(this.hasPlaybackControl!==!1)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let i=1,l=this.filters.length;i<l;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let i=1,l=this.filters.length;i<l;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(i){return i||(i=[]),this._connected===!0?(this.disconnect(),this.filters=i.slice(),this.connect()):this.filters=i.slice(),this}setDetune(i){if(this.detune=i,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(i){return this.setFilters(i?[i]:[])}setPlaybackRate(i){if(this.hasPlaybackControl!==!1)return this.playbackRate=i,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(i){if(this.hasPlaybackControl!==!1)return this.loop=i,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(i){return this.loopStart=i,this}setLoopEnd(i){return this.loopEnd=i,this}getVolume(){return this.gain.gain.value}setVolume(i){return this.gain.gain.setTargetAtTime(i,this.context.currentTime,.01),this}}const ih=new Re,kg=new Ps,Nf=new Re,kl=new Re;class ty extends hu{constructor(i){super(i),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}disconnect(){super.disconnect(),this.panner.disconnect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(i){return this.panner.refDistance=i,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(i){return this.panner.rolloffFactor=i,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(i){return this.panner.distanceModel=i,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(i){return this.panner.maxDistance=i,this}setDirectionalCone(i,l,h){return this.panner.coneInnerAngle=i,this.panner.coneOuterAngle=l,this.panner.coneOuterGain=h,this}updateMatrixWorld(i){if(super.updateMatrixWorld(i),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(ih,kg,Nf),kl.set(0,0,1).applyQuaternion(kg);const l=this.panner;if(l.positionX){const h=this.context.currentTime+this.listener.timeDelta;l.positionX.linearRampToValueAtTime(ih.x,h),l.positionY.linearRampToValueAtTime(ih.y,h),l.positionZ.linearRampToValueAtTime(ih.z,h),l.orientationX.linearRampToValueAtTime(kl.x,h),l.orientationY.linearRampToValueAtTime(kl.y,h),l.orientationZ.linearRampToValueAtTime(kl.z,h)}else l.setPosition(ih.x,ih.y,ih.z),l.setOrientation(kl.x,kl.y,kl.z)}}class rh{constructor(i,l=2048){this.analyser=i.context.createAnalyser(),this.analyser.fftSize=l,this.data=new Uint8Array(this.analyser.frequencyBinCount),i.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let i=0;const l=this.getFrequencyData();for(let h=0;h<l.length;h++)i+=l[h];return i/l.length}}class Ff{constructor(i,l,h){let d,g,v;switch(this.binding=i,this.valueSize=h,l){case"quaternion":d=this._slerp,g=this._slerpAdditive,v=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*h),this._workIndex=5;break;case"string":case"bool":d=this._select,g=this._select,v=this._setAdditiveIdentityOther,this.buffer=new Array(5*h);break;default:d=this._lerp,g=this._lerpAdditive,v=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*h)}this._mixBufferRegion=d,this._mixBufferRegionAdditive=g,this._setIdentity=v,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(i,l){const h=this.buffer,d=this.valueSize,g=i*d+d;let v=this.cumulativeWeight;if(v===0){for(let b=0;b!==d;++b)h[g+b]=h[b];v=l}else{v+=l;const b=l/v;this._mixBufferRegion(h,g,0,b,d)}this.cumulativeWeight=v}accumulateAdditive(i){const l=this.buffer,h=this.valueSize,d=h*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(l,d,0,i,h),this.cumulativeWeightAdditive+=i}apply(i){const l=this.valueSize,h=this.buffer,d=i*l+l,g=this.cumulativeWeight,v=this.cumulativeWeightAdditive,b=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,g<1){const T=l*this._origIndex;this._mixBufferRegion(h,d,T,1-g,l)}v>0&&this._mixBufferRegionAdditive(h,d,this._addIndex*l,1,l);for(let T=l,I=l+l;T!==I;++T)if(h[T]!==h[T+l]){b.setValue(h,d);break}}saveOriginalState(){const i=this.binding,l=this.buffer,h=this.valueSize,d=h*this._origIndex;i.getValue(l,d);for(let g=h,v=d;g!==v;++g)l[g]=l[d+g%h];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const i=3*this.valueSize;this.binding.setValue(this.buffer,i)}_setAdditiveIdentityNumeric(){const i=this._addIndex*this.valueSize,l=i+this.valueSize;for(let h=i;h<l;h++)this.buffer[h]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const i=this._origIndex*this.valueSize,l=this._addIndex*this.valueSize;for(let h=0;h<this.valueSize;h++)this.buffer[l+h]=this.buffer[i+h]}_select(i,l,h,d,g){if(d>=.5)for(let v=0;v!==g;++v)i[l+v]=i[h+v]}_slerp(i,l,h,d){Ps.slerpFlat(i,l,i,l,i,h,d)}_slerpAdditive(i,l,h,d,g){const v=this._workIndex*g;Ps.multiplyQuaternionsFlat(i,v,i,l,i,h),Ps.slerpFlat(i,l,i,l,i,v,d)}_lerp(i,l,h,d,g){const v=1-d;for(let b=0;b!==g;++b){const T=l+b;i[T]=i[T]*v+i[h+b]*d}}_lerpAdditive(i,l,h,d,g){for(let v=0;v!==g;++v){const b=l+v;i[b]=i[b]+i[h+v]*d}}}const Uf=new RegExp("[\\[\\]\\.:\\/]","g"),cp="[^\\[\\]\\.:\\/]",up="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",Og=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",cp)+/(WCOD+)?/.source.replace("WCOD",up)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",cp)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",cp)+"$"),jf=["material","materials","bones","map"];class Qi{constructor(i,l,h){this.path=l,this.parsedPath=h||Qi.parseTrackName(l),this.node=Qi.findNode(i,this.parsedPath.nodeName)||i,this.rootNode=i,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(i,l,h){return i&&i.isAnimationObjectGroup?new Qi.Composite(i,l,h):new Qi(i,l,h)}static sanitizeNodeName(i){return i.replace(/\s/g,"_").replace(Uf,"")}static parseTrackName(i){const l=Og.exec(i);if(l===null)throw new Error("PropertyBinding: Cannot parse trackName: "+i);const h={nodeName:l[2],objectName:l[3],objectIndex:l[4],propertyName:l[5],propertyIndex:l[6]},d=h.nodeName&&h.nodeName.lastIndexOf(".");if(d!==void 0&&d!==-1){const g=h.nodeName.substring(d+1);jf.indexOf(g)!==-1&&(h.nodeName=h.nodeName.substring(0,d),h.objectName=g)}if(h.propertyName===null||h.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+i);return h}static findNode(i,l){if(l===void 0||l===""||l==="."||l===-1||l===i.name||l===i.uuid)return i;if(i.skeleton){const h=i.skeleton.getBoneByName(l);if(h!==void 0)return h}if(i.children){const h=function(g){for(let v=0;v<g.length;v++){const b=g[v];if(b.name===l||b.uuid===l)return b;const T=h(b.children);if(T)return T}return null},d=h(i.children);if(d)return d}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(i,l){i[l]=this.targetObject[this.propertyName]}_getValue_array(i,l){const h=this.resolvedProperty;for(let d=0,g=h.length;d!==g;++d)i[l++]=h[d]}_getValue_arrayElement(i,l){i[l]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(i,l){this.resolvedProperty.toArray(i,l)}_setValue_direct(i,l){this.targetObject[this.propertyName]=i[l]}_setValue_direct_setNeedsUpdate(i,l){this.targetObject[this.propertyName]=i[l],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(i,l){this.targetObject[this.propertyName]=i[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(i,l){const h=this.resolvedProperty;for(let d=0,g=h.length;d!==g;++d)h[d]=i[l++]}_setValue_array_setNeedsUpdate(i,l){const h=this.resolvedProperty;for(let d=0,g=h.length;d!==g;++d)h[d]=i[l++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(i,l){const h=this.resolvedProperty;for(let d=0,g=h.length;d!==g;++d)h[d]=i[l++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(i,l){this.resolvedProperty[this.propertyIndex]=i[l]}_setValue_arrayElement_setNeedsUpdate(i,l){this.resolvedProperty[this.propertyIndex]=i[l],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(i,l){this.resolvedProperty[this.propertyIndex]=i[l],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(i,l){this.resolvedProperty.fromArray(i,l)}_setValue_fromArray_setNeedsUpdate(i,l){this.resolvedProperty.fromArray(i,l),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(i,l){this.resolvedProperty.fromArray(i,l),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(i,l){this.bind(),this.getValue(i,l)}_setValue_unbound(i,l){this.bind(),this.setValue(i,l)}bind(){let i=this.node;const l=this.parsedPath,h=l.objectName,d=l.propertyName;let g=l.propertyIndex;if(i||(i=Qi.findNode(this.rootNode,l.nodeName)||this.rootNode,this.node=i),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!i)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(h){let I=l.objectIndex;switch(h){case"materials":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);i=i.material.materials;break;case"bones":if(!i.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);i=i.skeleton.bones;for(let N=0;N<i.length;N++)if(i[N].name===I){I=N;break}break;case"map":if(!i.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!i.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);i=i.material.map;break;default:if(i[h]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);i=i[h]}if(I!==void 0){if(i[I]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,i);i=i[I]}}const v=i[d];if(v===void 0){const I=l.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+I+"."+d+" but it wasn't found.",i)}let b=this.Versioning.None;this.targetObject=i,i.needsUpdate!==void 0?b=this.Versioning.NeedsUpdate:i.matrixWorldNeedsUpdate!==void 0&&(b=this.Versioning.MatrixWorldNeedsUpdate);let T=this.BindingType.Direct;if(g!==void 0){if(d==="morphTargetInfluences"){if(!i.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!i.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);i.morphTargetDictionary[g]!==void 0&&(g=i.morphTargetDictionary[g])}T=this.BindingType.ArrayElement,this.resolvedProperty=v,this.propertyIndex=g}else v.fromArray!==void 0&&v.toArray!==void 0?(T=this.BindingType.HasFromToArray,this.resolvedProperty=v):Array.isArray(v)?(T=this.BindingType.EntireArray,this.resolvedProperty=v):this.propertyName=d;this.getValue=this.GetterByBindingType[T],this.setValue=this.SetterByBindingTypeAndVersioning[T][b]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Qi.Composite=class{constructor(x,i,l){const h=l||Qi.parseTrackName(i);this._targetGroup=x,this._bindings=x.subscribe_(i,h)}getValue(x,i){this.bind();const l=this._targetGroup.nCachedObjects_,h=this._bindings[l];h!==void 0&&h.getValue(x,i)}setValue(x,i){const l=this._bindings;for(let h=this._targetGroup.nCachedObjects_,d=l.length;h!==d;++h)l[h].setValue(x,i)}bind(){const x=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=x.length;i!==l;++i)x[i].bind()}unbind(){const x=this._bindings;for(let i=this._targetGroup.nCachedObjects_,l=x.length;i!==l;++i)x[i].unbind()}},Qi.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Qi.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Qi.prototype.GetterByBindingType=[Qi.prototype._getValue_direct,Qi.prototype._getValue_array,Qi.prototype._getValue_arrayElement,Qi.prototype._getValue_toArray],Qi.prototype.SetterByBindingTypeAndVersioning=[[Qi.prototype._setValue_direct,Qi.prototype._setValue_direct_setNeedsUpdate,Qi.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Qi.prototype._setValue_array,Qi.prototype._setValue_array_setNeedsUpdate,Qi.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Qi.prototype._setValue_arrayElement,Qi.prototype._setValue_arrayElement_setNeedsUpdate,Qi.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Qi.prototype._setValue_fromArray,Qi.prototype._setValue_fromArray_setNeedsUpdate,Qi.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class nd{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Ws(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const i={};this._indicesByUUID=i;for(let h=0,d=arguments.length;h!==d;++h)i[arguments[h].uuid]=h;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}add(){const i=this._objects,l=this._indicesByUUID,h=this._paths,d=this._parsedPaths,g=this._bindings,v=g.length;let b,T=i.length,I=this.nCachedObjects_;for(let N=0,z=arguments.length;N!==z;++N){const U=arguments[N],Q=U.uuid;let Y=l[Q];if(Y===void 0){Y=T++,l[Q]=Y,i.push(U);for(let H=0,ne=v;H!==ne;++H)g[H].push(new Qi(U,h[H],d[H]))}else if(Y<I){b=i[Y];const H=--I,ne=i[H];l[ne.uuid]=Y,i[Y]=ne,l[Q]=H,i[H]=U;for(let ie=0,re=v;ie!==re;++ie){const ve=g[ie],Ee=ve[H];let Me=ve[Y];ve[Y]=Ee,Me===void 0&&(Me=new Qi(U,h[ie],d[ie])),ve[H]=Me}}else i[Y]!==b&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=I}remove(){const i=this._objects,l=this._indicesByUUID,h=this._bindings,d=h.length;let g=this.nCachedObjects_;for(let v=0,b=arguments.length;v!==b;++v){const T=arguments[v],I=T.uuid,N=l[I];if(N!==void 0&&N>=g){const z=g++,U=i[z];l[U.uuid]=N,i[N]=U,l[I]=z,i[z]=T;for(let Q=0,Y=d;Q!==Y;++Q){const H=h[Q],ne=H[z],ie=H[N];H[N]=ne,H[z]=ie}}}this.nCachedObjects_=g}uncache(){const i=this._objects,l=this._indicesByUUID,h=this._bindings,d=h.length;let g=this.nCachedObjects_,v=i.length;for(let b=0,T=arguments.length;b!==T;++b){const I=arguments[b].uuid,N=l[I];if(N!==void 0)if(delete l[I],N<g){const z=--g,U=i[z],Q=--v,Y=i[Q];l[U.uuid]=N,i[N]=U,l[Y.uuid]=z,i[z]=Y,i.pop();for(let H=0,ne=d;H!==ne;++H){const ie=h[H],re=ie[z],ve=ie[Q];ie[N]=re,ie[z]=ve,ie.pop()}}else{const z=--v,U=i[z];z>0&&(l[U.uuid]=N),i[N]=U,i.pop();for(let Q=0,Y=d;Q!==Y;++Q){const H=h[Q];H[N]=H[z],H.pop()}}}this.nCachedObjects_=g}subscribe_(i,l){const h=this._bindingsIndicesByPath;let d=h[i];const g=this._bindings;if(d!==void 0)return g[d];const v=this._paths,b=this._parsedPaths,T=this._objects,I=T.length,N=this.nCachedObjects_,z=new Array(I);d=g.length,h[i]=d,v.push(i),b.push(l),g.push(z);for(let U=N,Q=T.length;U!==Q;++U){const Y=T[U];z[U]=new Qi(Y,i,l)}return z}unsubscribe_(i){const l=this._bindingsIndicesByPath,h=l[i];if(h!==void 0){const d=this._paths,g=this._parsedPaths,v=this._bindings,b=v.length-1,T=v[b];l[i[b]]=h,v[h]=T,v.pop(),g[h]=g[b],g.pop(),d[h]=d[b],d.pop()}}}class Lg{constructor(i,l,h=null,d=l.blendMode){this._mixer=i,this._clip=l,this._localRoot=h,this.blendMode=d;const g=l.tracks,v=g.length,b=new Array(v),T={endingStart:ps,endingEnd:ps};for(let I=0;I!==v;++I){const N=g[I].createInterpolant(null);b[I]=N,N.settings=T}this._interpolantSettings=T,this._interpolants=b,this._propertyBindings=new Array(v),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=yd,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(i){return this._startTime=i,this}setLoop(i,l){return this.loop=i,this.repetitions=l,this}setEffectiveWeight(i){return this.weight=i,this._effectiveWeight=this.enabled?i:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(i){return this._scheduleFading(i,0,1)}fadeOut(i){return this._scheduleFading(i,1,0)}crossFadeFrom(i,l,h){if(i.fadeOut(l),this.fadeIn(l),h){const d=this._clip.duration,g=i._clip.duration,v=g/d,b=d/g;i.warp(1,v,l),this.warp(b,1,l)}return this}crossFadeTo(i,l,h){return i.crossFadeFrom(this,l,h)}stopFading(){const i=this._weightInterpolant;return i!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(i)),this}setEffectiveTimeScale(i){return this.timeScale=i,this._effectiveTimeScale=this.paused?0:i,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(i){return this.timeScale=this._clip.duration/i,this.stopWarping()}syncWith(i){return this.time=i.time,this.timeScale=i.timeScale,this.stopWarping()}halt(i){return this.warp(this._effectiveTimeScale,0,i)}warp(i,l,h){const d=this._mixer,g=d.time,v=this.timeScale;let b=this._timeScaleInterpolant;b===null&&(b=d._lendControlInterpolant(),this._timeScaleInterpolant=b);const T=b.parameterPositions,I=b.sampleValues;return T[0]=g,T[1]=g+h,I[0]=i/v,I[1]=l/v,this}stopWarping(){const i=this._timeScaleInterpolant;return i!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(i)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(i,l,h,d){if(!this.enabled)return void this._updateWeight(i);const g=this._startTime;if(g!==null){const T=(i-g)*h;T<0||h===0?l=0:(this._startTime=null,l=h*T)}l*=this._updateTimeScale(i);const v=this._updateTime(l),b=this._updateWeight(i);if(b>0){const T=this._interpolants,I=this._propertyBindings;if(this.blendMode===bd)for(let N=0,z=T.length;N!==z;++N)T[N].evaluate(v),I[N].accumulateAdditive(b);else for(let N=0,z=T.length;N!==z;++N)T[N].evaluate(v),I[N].accumulate(d,b)}}_updateWeight(i){let l=0;if(this.enabled){l=this.weight;const h=this._weightInterpolant;if(h!==null){const d=h.evaluate(i)[0];l*=d,i>h.parameterPositions[1]&&(this.stopFading(),d===0&&(this.enabled=!1))}}return this._effectiveWeight=l,l}_updateTimeScale(i){let l=0;if(!this.paused){l=this.timeScale;const h=this._timeScaleInterpolant;h!==null&&(l*=h.evaluate(i)[0],i>h.parameterPositions[1]&&(this.stopWarping(),l===0?this.paused=!0:this.timeScale=l))}return this._effectiveTimeScale=l,l}_updateTime(i){const l=this._clip.duration,h=this.loop;let d=this.time+i,g=this._loopCount;const v=h===Cc;if(i===0)return g===-1?d:v&&(1&g)==1?l-d:d;if(h===yo){g===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(d>=l)d=l;else{if(!(d<0)){this.time=d;break e}d=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:i<0?-1:1})}}else{if(g===-1&&(i>=0?(g=0,this._setEndings(!0,this.repetitions===0,v)):this._setEndings(this.repetitions===0,!0,v)),d>=l||d<0){const b=Math.floor(d/l);d-=l*b,g+=Math.abs(b);const T=this.repetitions-g;if(T<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,d=i>0?l:0,this.time=d,this._mixer.dispatchEvent({type:"finished",action:this,direction:i>0?1:-1});else{if(T===1){const I=i<0;this._setEndings(I,!I,v)}else this._setEndings(!1,!1,v);this._loopCount=g,this.time=d,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:b})}}else this.time=d;if(v&&(1&g)==1)return l-d}return d}_setEndings(i,l,h){const d=this._interpolantSettings;h?(d.endingStart=Wo,d.endingEnd=Wo):(d.endingStart=i?this.zeroSlopeAtStart?Wo:ps:Tc,d.endingEnd=l?this.zeroSlopeAtEnd?Wo:ps:Tc)}_scheduleFading(i,l,h){const d=this._mixer,g=d.time;let v=this._weightInterpolant;v===null&&(v=d._lendControlInterpolant(),this._weightInterpolant=v);const b=v.parameterPositions,T=v.sampleValues;return b[0]=g,T[0]=l,b[1]=g+i,T[1]=h,this}}const Ng=new Float32Array(1);class Vv extends ei{constructor(i){super(),this._root=i,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(i,l){const h=i._localRoot||this._root,d=i._clip.tracks,g=d.length,v=i._propertyBindings,b=i._interpolants,T=h.uuid,I=this._bindingsByRootAndName;let N=I[T];N===void 0&&(N={},I[T]=N);for(let z=0;z!==g;++z){const U=d[z],Q=U.name;let Y=N[Q];if(Y!==void 0)++Y.referenceCount,v[z]=Y;else{if(Y=v[z],Y!==void 0){Y._cacheIndex===null&&(++Y.referenceCount,this._addInactiveBinding(Y,T,Q));continue}const H=l&&l._propertyBindings[z].binding.parsedPath;Y=new Ff(Qi.create(h,Q,H),U.ValueTypeName,U.getValueSize()),++Y.referenceCount,this._addInactiveBinding(Y,T,Q),v[z]=Y}b[z].resultBuffer=Y.buffer}}_activateAction(i){if(!this._isActiveAction(i)){if(i._cacheIndex===null){const h=(i._localRoot||this._root).uuid,d=i._clip.uuid,g=this._actionsByClip[d];this._bindAction(i,g&&g.knownActions[0]),this._addInactiveAction(i,d,h)}const l=i._propertyBindings;for(let h=0,d=l.length;h!==d;++h){const g=l[h];g.useCount++==0&&(this._lendBinding(g),g.saveOriginalState())}this._lendAction(i)}}_deactivateAction(i){if(this._isActiveAction(i)){const l=i._propertyBindings;for(let h=0,d=l.length;h!==d;++h){const g=l[h];--g.useCount==0&&(g.restoreOriginalState(),this._takeBackBinding(g))}this._takeBackAction(i)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const i=this;this.stats={actions:{get total(){return i._actions.length},get inUse(){return i._nActiveActions}},bindings:{get total(){return i._bindings.length},get inUse(){return i._nActiveBindings}},controlInterpolants:{get total(){return i._controlInterpolants.length},get inUse(){return i._nActiveControlInterpolants}}}}_isActiveAction(i){const l=i._cacheIndex;return l!==null&&l<this._nActiveActions}_addInactiveAction(i,l,h){const d=this._actions,g=this._actionsByClip;let v=g[l];if(v===void 0)v={knownActions:[i],actionByRoot:{}},i._byClipCacheIndex=0,g[l]=v;else{const b=v.knownActions;i._byClipCacheIndex=b.length,b.push(i)}i._cacheIndex=d.length,d.push(i),v.actionByRoot[h]=i}_removeInactiveAction(i){const l=this._actions,h=l[l.length-1],d=i._cacheIndex;h._cacheIndex=d,l[d]=h,l.pop(),i._cacheIndex=null;const g=i._clip.uuid,v=this._actionsByClip,b=v[g],T=b.knownActions,I=T[T.length-1],N=i._byClipCacheIndex;I._byClipCacheIndex=N,T[N]=I,T.pop(),i._byClipCacheIndex=null,delete b.actionByRoot[(i._localRoot||this._root).uuid],T.length===0&&delete v[g],this._removeInactiveBindingsForAction(i)}_removeInactiveBindingsForAction(i){const l=i._propertyBindings;for(let h=0,d=l.length;h!==d;++h){const g=l[h];--g.referenceCount==0&&this._removeInactiveBinding(g)}}_lendAction(i){const l=this._actions,h=i._cacheIndex,d=this._nActiveActions++,g=l[d];i._cacheIndex=d,l[d]=i,g._cacheIndex=h,l[h]=g}_takeBackAction(i){const l=this._actions,h=i._cacheIndex,d=--this._nActiveActions,g=l[d];i._cacheIndex=d,l[d]=i,g._cacheIndex=h,l[h]=g}_addInactiveBinding(i,l,h){const d=this._bindingsByRootAndName,g=this._bindings;let v=d[l];v===void 0&&(v={},d[l]=v),v[h]=i,i._cacheIndex=g.length,g.push(i)}_removeInactiveBinding(i){const l=this._bindings,h=i.binding,d=h.rootNode.uuid,g=h.path,v=this._bindingsByRootAndName,b=v[d],T=l[l.length-1],I=i._cacheIndex;T._cacheIndex=I,l[I]=T,l.pop(),delete b[g],Object.keys(b).length===0&&delete v[d]}_lendBinding(i){const l=this._bindings,h=i._cacheIndex,d=this._nActiveBindings++,g=l[d];i._cacheIndex=d,l[d]=i,g._cacheIndex=h,l[h]=g}_takeBackBinding(i){const l=this._bindings,h=i._cacheIndex,d=--this._nActiveBindings,g=l[d];i._cacheIndex=d,l[d]=i,g._cacheIndex=h,l[h]=g}_lendControlInterpolant(){const i=this._controlInterpolants,l=this._nActiveControlInterpolants++;let h=i[l];return h===void 0&&(h=new Rv(new Float32Array(2),new Float32Array(2),1,Ng),h.__cacheIndex=l,i[l]=h),h}_takeBackControlInterpolant(i){const l=this._controlInterpolants,h=i.__cacheIndex,d=--this._nActiveControlInterpolants,g=l[d];i.__cacheIndex=d,l[d]=i,g.__cacheIndex=h,l[h]=g}clipAction(i,l,h){const d=l||this._root,g=d.uuid;let v=typeof i=="string"?Pf.findByName(d,i):i;const b=v!==null?v.uuid:i,T=this._actionsByClip[b];let I=null;if(h===void 0&&(h=v!==null?v.blendMode:Cr),T!==void 0){const z=T.actionByRoot[g];if(z!==void 0&&z.blendMode===h)return z;I=T.knownActions[0],v===null&&(v=I._clip)}if(v===null)return null;const N=new Lg(this,v,l,h);return this._bindAction(N,I),this._addInactiveAction(N,b,g),N}existingAction(i,l){const h=l||this._root,d=h.uuid,g=typeof i=="string"?Pf.findByName(h,i):i,v=g?g.uuid:i,b=this._actionsByClip[v];return b!==void 0&&b.actionByRoot[d]||null}stopAllAction(){const i=this._actions;for(let l=this._nActiveActions-1;l>=0;--l)i[l].stop();return this}update(i){i*=this.timeScale;const l=this._actions,h=this._nActiveActions,d=this.time+=i,g=Math.sign(i),v=this._accuIndex^=1;for(let I=0;I!==h;++I)l[I]._update(d,i,g,v);const b=this._bindings,T=this._nActiveBindings;for(let I=0;I!==T;++I)b[I].apply(v);return this}setTime(i){this.time=0;for(let l=0;l<this._actions.length;l++)this._actions[l].time=0;return this.update(i)}getRoot(){return this._root}uncacheClip(i){const l=this._actions,h=i.uuid,d=this._actionsByClip,g=d[h];if(g!==void 0){const v=g.knownActions;for(let b=0,T=v.length;b!==T;++b){const I=v[b];this._deactivateAction(I);const N=I._cacheIndex,z=l[l.length-1];I._cacheIndex=null,I._byClipCacheIndex=null,z._cacheIndex=N,l[N]=z,l.pop(),this._removeInactiveBindingsForAction(I)}delete d[h]}}uncacheRoot(i){const l=i.uuid,h=this._actionsByClip;for(const g in h){const v=h[g].actionByRoot[l];v!==void 0&&(this._deactivateAction(v),this._removeInactiveAction(v))}const d=this._bindingsByRootAndName[l];if(d!==void 0)for(const g in d){const v=d[g];v.restoreOriginalState(),this._removeInactiveBinding(v)}}uncacheAction(i,l){const h=this.existingAction(i,l);h!==null&&(this._deactivateAction(h),this._removeInactiveAction(h))}}class sh{constructor(i){this.value=i}clone(){return new sh(this.value.clone===void 0?this.value:this.value.clone())}}let Fg=0;class zf extends ei{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:Fg++}),this.name="",this.usage=Bc,this.uniforms=[]}add(i){return this.uniforms.push(i),this}remove(i){const l=this.uniforms.indexOf(i);return l!==-1&&this.uniforms.splice(l,1),this}setName(i){return this.name=i,this}setUsage(i){return this.usage=i,this}dispose(){return this.dispatchEvent({type:"dispose"}),this}copy(i){this.name=i.name,this.usage=i.usage;const l=i.uniforms;this.uniforms.length=0;for(let h=0,d=l.length;h<d;h++)this.uniforms.push(l[h].clone());return this}clone(){return new this.constructor().copy(this)}}class Ug extends Zm{constructor(i,l,h=1){super(i,l),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=h}copy(i){return super.copy(i),this.meshPerAttribute=i.meshPerAttribute,this}clone(i){const l=super.clone(i);return l.meshPerAttribute=this.meshPerAttribute,l}toJSON(i){const l=super.toJSON(i);return l.isInstancedInterleavedBuffer=!0,l.meshPerAttribute=this.meshPerAttribute,l}}class hp{constructor(i,l,h,d,g){this.isGLBufferAttribute=!0,this.buffer=i,this.type=l,this.itemSize=h,this.elementSize=d,this.count=g,this.version=0}set needsUpdate(i){i===!0&&this.version++}setBuffer(i){return this.buffer=i,this}setType(i,l){return this.type=i,this.elementSize=l,this}setItemSize(i){return this.itemSize=i,this}setCount(i){return this.count=i,this}}class jg{constructor(i,l,h=0,d=1/0){this.ray=new ec(i,l),this.near=h,this.far=d,this.camera=null,this.layers=new so,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(i,l){this.ray.set(i,l)}setFromCamera(i,l){l.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(l.matrixWorld),this.ray.direction.set(i.x,i.y,.5).unproject(l).sub(this.ray.origin).normalize(),this.camera=l):l.isOrthographicCamera?(this.ray.origin.set(i.x,i.y,(l.near+l.far)/(l.near-l.far)).unproject(l),this.ray.direction.set(0,0,-1).transformDirection(l.matrixWorld),this.camera=l):console.error("THREE.Raycaster: Unsupported camera type: "+l.type)}intersectObject(i,l=!0,h=[]){return Vg(i,this,h,l),h.sort(zg),h}intersectObjects(i,l=!0,h=[]){for(let d=0,g=i.length;d<g;d++)Vg(i[d],this,h,l);return h.sort(zg),h}}function zg(x,i){return x.distance-i.distance}function Vg(x,i,l,h){if(x.layers.test(i.layers)&&x.raycast(i,l),h===!0){const d=x.children;for(let g=0,v=d.length;g<v;g++)Vg(d[g],i,l,!0)}}class Cw{constructor(i=1,l=0,h=0){return this.radius=i,this.phi=l,this.theta=h,this}set(i,l,h){return this.radius=i,this.phi=l,this.theta=h,this}copy(i){return this.radius=i.radius,this.phi=i.phi,this.theta=i.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,l,h){return this.radius=Math.sqrt(i*i+l*l+h*h),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(i,h),this.phi=Math.acos(Vn(l/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class ny{constructor(i=1,l=0,h=0){return this.radius=i,this.theta=l,this.y=h,this}set(i,l,h){return this.radius=i,this.theta=l,this.y=h,this}copy(i){return this.radius=i.radius,this.theta=i.theta,this.y=i.y,this}setFromVector3(i){return this.setFromCartesianCoords(i.x,i.y,i.z)}setFromCartesianCoords(i,l,h){return this.radius=Math.sqrt(i*i+h*h),this.theta=Math.atan2(i,h),this.y=l,this}clone(){return new this.constructor().copy(this)}}const iy=new Xt;class Mw{constructor(i=new Xt(1/0,1/0),l=new Xt(-1/0,-1/0)){this.isBox2=!0,this.min=i,this.max=l}set(i,l){return this.min.copy(i),this.max.copy(l),this}setFromPoints(i){this.makeEmpty();for(let l=0,h=i.length;l<h;l++)this.expandByPoint(i[l]);return this}setFromCenterAndSize(i,l){const h=iy.copy(l).multiplyScalar(.5);return this.min.copy(i).sub(h),this.max.copy(i).add(h),this}clone(){return new this.constructor().copy(this)}copy(i){return this.min.copy(i.min),this.max.copy(i.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(i){return this.isEmpty()?i.set(0,0):i.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(i){return this.isEmpty()?i.set(0,0):i.subVectors(this.max,this.min)}expandByPoint(i){return this.min.min(i),this.max.max(i),this}expandByVector(i){return this.min.sub(i),this.max.add(i),this}expandByScalar(i){return this.min.addScalar(-i),this.max.addScalar(i),this}containsPoint(i){return!(i.x<this.min.x||i.x>this.max.x||i.y<this.min.y||i.y>this.max.y)}containsBox(i){return this.min.x<=i.min.x&&i.max.x<=this.max.x&&this.min.y<=i.min.y&&i.max.y<=this.max.y}getParameter(i,l){return l.set((i.x-this.min.x)/(this.max.x-this.min.x),(i.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(i){return!(i.max.x<this.min.x||i.min.x>this.max.x||i.max.y<this.min.y||i.min.y>this.max.y)}clampPoint(i,l){return l.copy(i).clamp(this.min,this.max)}distanceToPoint(i){return iy.copy(i).clamp(this.min,this.max).sub(i).length()}intersect(i){return this.min.max(i.min),this.max.min(i.max),this}union(i){return this.min.min(i.min),this.max.max(i.max),this}translate(i){return this.min.add(i),this.max.add(i),this}equals(i){return i.min.equals(this.min)&&i.max.equals(this.max)}}const Gv=new Re,dp=new Re;class ry{constructor(i=new Re,l=new Re){this.start=i,this.end=l}set(i,l){return this.start.copy(i),this.end.copy(l),this}copy(i){return this.start.copy(i.start),this.end.copy(i.end),this}getCenter(i){return i.addVectors(this.start,this.end).multiplyScalar(.5)}delta(i){return i.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(i,l){return this.delta(l).multiplyScalar(i).add(this.start)}closestPointToPointParameter(i,l){Gv.subVectors(i,this.start),dp.subVectors(this.end,this.start);const h=dp.dot(dp);let d=dp.dot(Gv)/h;return l&&(d=Vn(d,0,1)),d}closestPointToPoint(i,l,h){const d=this.closestPointToPointParameter(i,l);return this.delta(h).multiplyScalar(d).add(this.start)}applyMatrix4(i){return this.start.applyMatrix4(i),this.end.applyMatrix4(i),this}equals(i){return i.start.equals(this.start)&&i.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ji=new Re;class Zs extends pi{constructor(i,l){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=l;const h=new In,d=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let v=0,b=1,T=32;v<T;v++,b++){const I=v/T*Math.PI*2,N=b/T*Math.PI*2;d.push(Math.cos(I),Math.sin(I),1,Math.cos(N),Math.sin(N),1)}h.setAttribute("position",new E(d,3));const g=new Lo({fog:!1,toneMapped:!1});this.cone=new cc(h,g),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const i=this.light.distance?this.light.distance:1e3,l=i*Math.tan(this.light.angle);this.cone.scale.set(l,l,i),ji.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ji),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const To=new Re,du=new ti,oh=new ti;class Vf extends cc{constructor(i){const l=Qv(i),h=new In,d=[],g=[],v=new bn(0,0,1),b=new bn(0,1,0);for(let T=0;T<l.length;T++){const I=l[T];I.parent&&I.parent.isBone&&(d.push(0,0,0),d.push(0,0,0),g.push(v.r,v.g,v.b),g.push(b.r,b.g,b.b))}h.setAttribute("position",new E(d,3)),h.setAttribute("color",new E(g,3)),super(h,new Lo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=i,this.bones=l,this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(i){const l=this.bones,h=this.geometry,d=h.getAttribute("position");oh.copy(this.root.matrixWorld).invert();for(let g=0,v=0;g<l.length;g++){const b=l[g];b.parent&&b.parent.isBone&&(du.multiplyMatrices(oh,b.matrixWorld),To.setFromMatrixPosition(du),d.setXYZ(v,To.x,To.y,To.z),du.multiplyMatrices(oh,b.parent.matrixWorld),To.setFromMatrixPosition(du),d.setXYZ(v+1,To.x,To.y,To.z),v+=2)}h.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(i)}}function Qv(x){const i=[];x.isBone===!0&&i.push(x);for(let l=0;l<x.children.length;l++)i.push.apply(i,Qv(x.children[l]));return i}class sy extends ks{constructor(i,l,h){super(new sp(l,4,2),new Wa({wireframe:!0,fog:!1,toneMapped:!1})),this.light=i,this.light.updateMatrixWorld(),this.color=h,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Hv=new Re,Gf=new bn,Wv=new bn;class oy extends pi{constructor(i,l,h){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=h;const d=new co(l);d.rotateY(.5*Math.PI),this.material=new Wa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const g=d.getAttribute("position"),v=new Float32Array(3*g.count);d.setAttribute("color",new mr(v,3)),this.add(new ks(d,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const i=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const l=i.geometry.getAttribute("color");Gf.copy(this.light.color),Wv.copy(this.light.groundColor);for(let h=0,d=l.count;h<d;h++){const g=h<d/2?Gf:Wv;l.setXYZ(h,g.r,g.g,g.b)}l.needsUpdate=!0}i.lookAt(Hv.setFromMatrixPosition(this.light.matrixWorld).negate())}}class qv extends cc{constructor(i=10,l=10,h=4473924,d=8947848){h=new bn(h),d=new bn(d);const g=l/2,v=i/l,b=i/2,T=[],I=[];for(let z=0,U=0,Q=-b;z<=l;z++,Q+=v){T.push(-b,0,Q,b,0,Q),T.push(Q,0,-b,Q,0,b);const Y=z===g?h:d;Y.toArray(I,U),U+=3,Y.toArray(I,U),U+=3,Y.toArray(I,U),U+=3,Y.toArray(I,U),U+=3}const N=new In;N.setAttribute("position",new E(T,3)),N.setAttribute("color",new E(I,3)),super(N,new Lo({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class Qf extends cc{constructor(i=10,l=16,h=8,d=64,g=4473924,v=8947848){g=new bn(g),v=new bn(v);const b=[],T=[];if(l>1)for(let N=0;N<l;N++){const z=N/l*(2*Math.PI),U=Math.sin(z)*i,Q=Math.cos(z)*i;b.push(0,0,0),b.push(U,0,Q);const Y=1&N?g:v;T.push(Y.r,Y.g,Y.b),T.push(Y.r,Y.g,Y.b)}for(let N=0;N<h;N++){const z=1&N?g:v,U=i-i/h*N;for(let Q=0;Q<d;Q++){let Y=Q/d*(2*Math.PI),H=Math.sin(Y)*U,ne=Math.cos(Y)*U;b.push(H,0,ne),T.push(z.r,z.g,z.b),Y=(Q+1)/d*(2*Math.PI),H=Math.sin(Y)*U,ne=Math.cos(Y)*U,b.push(H,0,ne),T.push(z.r,z.g,z.b)}}const I=new In;I.setAttribute("position",new E(b,3)),I.setAttribute("color",new E(T,3)),super(I,new Lo({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const zr=new Re,pc=new Re,Pa=new Re;class pu extends pi{constructor(i,l,h){super(),this.light=i,this.light.updateMatrixWorld(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.color=h,l===void 0&&(l=1);let d=new In;d.setAttribute("position",new E([-l,l,0,l,l,0,l,-l,0,-l,-l,0,-l,l,0],3));const g=new Lo({fog:!1,toneMapped:!1});this.lightPlane=new lc(d,g),this.add(this.lightPlane),d=new In,d.setAttribute("position",new E([0,0,0,0,0,1],3)),this.targetLine=new lc(d,g),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){zr.setFromMatrixPosition(this.light.matrixWorld),pc.setFromMatrixPosition(this.light.target.matrixWorld),Pa.subVectors(pc,zr),this.lightPlane.lookAt(pc),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(pc),this.targetLine.scale.z=Pa.length()}}const fu=new Re,ss=new zd;class ay extends cc{constructor(i){const l=new In,h=new Lo({color:16777215,vertexColors:!0,toneMapped:!1}),d=[],g=[],v={};function b(Y,H){T(Y),T(H)}function T(Y){d.push(0,0,0),g.push(0,0,0),v[Y]===void 0&&(v[Y]=[]),v[Y].push(d.length/3-1)}b("n1","n2"),b("n2","n4"),b("n4","n3"),b("n3","n1"),b("f1","f2"),b("f2","f4"),b("f4","f3"),b("f3","f1"),b("n1","f1"),b("n2","f2"),b("n3","f3"),b("n4","f4"),b("p","n1"),b("p","n2"),b("p","n3"),b("p","n4"),b("u1","u2"),b("u2","u3"),b("u3","u1"),b("c","t"),b("p","c"),b("cn1","cn2"),b("cn3","cn4"),b("cf1","cf2"),b("cf3","cf4"),l.setAttribute("position",new E(d,3)),l.setAttribute("color",new E(g,3)),super(l,h),this.type="CameraHelper",this.camera=i,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=i.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=v,this.update();const I=new bn(16755200),N=new bn(16711680),z=new bn(43775),U=new bn(16777215),Q=new bn(3355443);this.setColors(I,N,z,U,Q)}setColors(i,l,h,d,g){const v=this.geometry.getAttribute("color");v.setXYZ(0,i.r,i.g,i.b),v.setXYZ(1,i.r,i.g,i.b),v.setXYZ(2,i.r,i.g,i.b),v.setXYZ(3,i.r,i.g,i.b),v.setXYZ(4,i.r,i.g,i.b),v.setXYZ(5,i.r,i.g,i.b),v.setXYZ(6,i.r,i.g,i.b),v.setXYZ(7,i.r,i.g,i.b),v.setXYZ(8,i.r,i.g,i.b),v.setXYZ(9,i.r,i.g,i.b),v.setXYZ(10,i.r,i.g,i.b),v.setXYZ(11,i.r,i.g,i.b),v.setXYZ(12,i.r,i.g,i.b),v.setXYZ(13,i.r,i.g,i.b),v.setXYZ(14,i.r,i.g,i.b),v.setXYZ(15,i.r,i.g,i.b),v.setXYZ(16,i.r,i.g,i.b),v.setXYZ(17,i.r,i.g,i.b),v.setXYZ(18,i.r,i.g,i.b),v.setXYZ(19,i.r,i.g,i.b),v.setXYZ(20,i.r,i.g,i.b),v.setXYZ(21,i.r,i.g,i.b),v.setXYZ(22,i.r,i.g,i.b),v.setXYZ(23,i.r,i.g,i.b),v.setXYZ(24,l.r,l.g,l.b),v.setXYZ(25,l.r,l.g,l.b),v.setXYZ(26,l.r,l.g,l.b),v.setXYZ(27,l.r,l.g,l.b),v.setXYZ(28,l.r,l.g,l.b),v.setXYZ(29,l.r,l.g,l.b),v.setXYZ(30,l.r,l.g,l.b),v.setXYZ(31,l.r,l.g,l.b),v.setXYZ(32,h.r,h.g,h.b),v.setXYZ(33,h.r,h.g,h.b),v.setXYZ(34,h.r,h.g,h.b),v.setXYZ(35,h.r,h.g,h.b),v.setXYZ(36,h.r,h.g,h.b),v.setXYZ(37,h.r,h.g,h.b),v.setXYZ(38,d.r,d.g,d.b),v.setXYZ(39,d.r,d.g,d.b),v.setXYZ(40,g.r,g.g,g.b),v.setXYZ(41,g.r,g.g,g.b),v.setXYZ(42,g.r,g.g,g.b),v.setXYZ(43,g.r,g.g,g.b),v.setXYZ(44,g.r,g.g,g.b),v.setXYZ(45,g.r,g.g,g.b),v.setXYZ(46,g.r,g.g,g.b),v.setXYZ(47,g.r,g.g,g.b),v.setXYZ(48,g.r,g.g,g.b),v.setXYZ(49,g.r,g.g,g.b),v.needsUpdate=!0}update(){const i=this.geometry,l=this.pointMap;ss.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),ds("c",l,i,ss,0,0,-1),ds("t",l,i,ss,0,0,1),ds("n1",l,i,ss,-1,-1,-1),ds("n2",l,i,ss,1,-1,-1),ds("n3",l,i,ss,-1,1,-1),ds("n4",l,i,ss,1,1,-1),ds("f1",l,i,ss,-1,-1,1),ds("f2",l,i,ss,1,-1,1),ds("f3",l,i,ss,-1,1,1),ds("f4",l,i,ss,1,1,1),ds("u1",l,i,ss,.7,1.1,-1),ds("u2",l,i,ss,-.7,1.1,-1),ds("u3",l,i,ss,0,2,-1),ds("cf1",l,i,ss,-1,0,1),ds("cf2",l,i,ss,1,0,1),ds("cf3",l,i,ss,0,-1,1),ds("cf4",l,i,ss,0,1,1),ds("cn1",l,i,ss,-1,0,-1),ds("cn2",l,i,ss,1,0,-1),ds("cn3",l,i,ss,0,-1,-1),ds("cn4",l,i,ss,0,1,-1),i.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function ds(x,i,l,h,d,g,v){fu.set(d,g,v).unproject(h);const b=i[x];if(b!==void 0){const T=l.getAttribute("position");for(let I=0,N=b.length;I<N;I++)T.setXYZ(b[I],fu.x,fu.y,fu.z)}}const Hf=new jc;class Gg extends cc{constructor(i,l=16776960){const h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new Float32Array(24),g=new In;g.setIndex(new mr(h,1)),g.setAttribute("position",new mr(d,3)),super(g,new Lo({color:l,toneMapped:!1})),this.object=i,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(i){if(i!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Hf.setFromObject(this.object),Hf.isEmpty())return;const l=Hf.min,h=Hf.max,d=this.geometry.attributes.position,g=d.array;g[0]=h.x,g[1]=h.y,g[2]=h.z,g[3]=l.x,g[4]=h.y,g[5]=h.z,g[6]=l.x,g[7]=l.y,g[8]=h.z,g[9]=h.x,g[10]=l.y,g[11]=h.z,g[12]=h.x,g[13]=h.y,g[14]=l.z,g[15]=l.x,g[16]=h.y,g[17]=l.z,g[18]=l.x,g[19]=l.y,g[20]=l.z,g[21]=h.x,g[22]=l.y,g[23]=l.z,d.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(i){return this.object=i,this.update(),this}copy(i,l){return super.copy(i,l),this.object=i.object,this}}class Za extends cc{constructor(i,l=16776960){const h=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),d=new In;d.setIndex(new mr(h,1)),d.setAttribute("position",new E([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(d,new Lo({color:l,toneMapped:!1})),this.box=i,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(i){const l=this.box;l.isEmpty()||(l.getCenter(this.position),l.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(i))}}class Qg extends lc{constructor(i,l=1,h=16776960){const d=h,g=new In;g.setAttribute("position",new E([1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],3)),g.computeBoundingSphere(),super(g,new Lo({color:d,toneMapped:!1})),this.type="PlaneHelper",this.plane=i,this.size=l;const v=new In;v.setAttribute("position",new E([1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],3)),v.computeBoundingSphere(),this.add(new ks(v,new Wa({color:d,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(i){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(i)}}const pp=new Re;let Uo,id;class fc extends pi{constructor(i=new Re(0,0,1),l=new Re(0,0,0),h=1,d=16776960,g=.2*h,v=.2*g){super(),this.type="ArrowHelper",Uo===void 0&&(Uo=new In,Uo.setAttribute("position",new E([0,0,0,0,1,0],3)),id=new Os(0,.5,1,5,1),id.translate(0,-.5,0)),this.position.copy(l),this.line=new lc(Uo,new Lo({color:d,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new ks(id,new Wa({color:d,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(i),this.setLength(h,g,v)}setDirection(i){if(i.y>.99999)this.quaternion.set(0,0,0,1);else if(i.y<-.99999)this.quaternion.set(1,0,0,0);else{pp.set(i.z,0,-i.x).normalize();const l=Math.acos(i.y);this.quaternion.setFromAxisAngle(pp,l)}}setLength(i,l=.2*i,h=.2*l){this.line.scale.set(1,Math.max(1e-4,i-l),1),this.line.updateMatrix(),this.cone.scale.set(h,l,h),this.cone.position.y=i,this.cone.updateMatrix()}setColor(i){this.line.material.color.set(i),this.cone.material.color.set(i)}copy(i){return super.copy(i,!1),this.line.copy(i.line),this.cone.copy(i.cone),this}}class fp extends cc{constructor(i=1){const l=[0,0,0,i,0,0,0,0,0,0,i,0,0,0,0,0,0,i],h=new In;h.setAttribute("position",new E(l,3)),h.setAttribute("color",new E([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3)),super(h,new Lo({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(i,l,h){const d=new bn,g=this.geometry.attributes.color.array;return d.set(i),d.toArray(g,0),d.toArray(g,3),d.set(l),d.toArray(g,6),d.toArray(g,9),d.set(h),d.toArray(g,12),d.toArray(g,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class Hg{constructor(){this.type="ShapePath",this.color=new bn,this.subPaths=[],this.currentPath=null}moveTo(i,l){return this.currentPath=new tp,this.subPaths.push(this.currentPath),this.currentPath.moveTo(i,l),this}lineTo(i,l){return this.currentPath.lineTo(i,l),this}quadraticCurveTo(i,l,h,d){return this.currentPath.quadraticCurveTo(i,l,h,d),this}bezierCurveTo(i,l,h,d,g,v){return this.currentPath.bezierCurveTo(i,l,h,d,g,v),this}splineThru(i){return this.currentPath.splineThru(i),this}toShapes(i,l){function h(re){const ve=[];for(let Ee=0,Me=re.length;Ee<Me;Ee++){const Pe=re[Ee],Ye=new Xh;Ye.curves=Pe.curves,ve.push(Ye)}return ve}function d(re,ve){const Ee=ve.length;let Me=!1;for(let Pe=Ee-1,Ye=0;Ye<Ee;Pe=Ye++){let Ke=ve[Pe],lt=ve[Ye],ut=lt.x-Ke.x,Ze=lt.y-Ke.y;if(Math.abs(Ze)>Number.EPSILON){if(Ze<0&&(Ke=ve[Ye],ut=-ut,lt=ve[Pe],Ze=-Ze),re.y<Ke.y||re.y>lt.y)continue;if(re.y===Ke.y){if(re.x===Ke.x)return!0}else{const Ft=Ze*(re.x-Ke.x)-ut*(re.y-Ke.y);if(Ft===0)return!0;if(Ft<0)continue;Me=!Me}}else{if(re.y!==Ke.y)continue;if(lt.x<=re.x&&re.x<=Ke.x||Ke.x<=re.x&&re.x<=lt.x)return!0}}return Me}const g=Rl.isClockWise,v=this.subPaths;if(v.length===0)return[];if(l===!0)return h(v);let b,T,I;const N=[];if(v.length===1)return T=v[0],I=new Xh,I.curves=T.curves,N.push(I),N;let z=!g(v[0].getPoints());z=i?!z:z;const U=[],Q=[];let Y,H,ne=[],ie=0;Q[ie]=void 0,ne[ie]=[];for(let re=0,ve=v.length;re<ve;re++)T=v[re],Y=T.getPoints(),b=g(Y),b=i?!b:b,b?(!z&&Q[ie]&&ie++,Q[ie]={s:new Xh,p:Y},Q[ie].s.curves=T.curves,z&&ie++,ne[ie]=[]):ne[ie].push({h:T,p:Y[0]});if(!Q[0])return h(v);if(Q.length>1){let re=!1,ve=0;for(let Ee=0,Me=Q.length;Ee<Me;Ee++)U[Ee]=[];for(let Ee=0,Me=Q.length;Ee<Me;Ee++){const Pe=ne[Ee];for(let Ye=0;Ye<Pe.length;Ye++){const Ke=Pe[Ye];let lt=!0;for(let ut=0;ut<Q.length;ut++)d(Ke.p,Q[ut].p)&&(Ee!==ut&&ve++,lt?(lt=!1,U[ut].push(Ke)):re=!0);lt&&U[Ee].push(Ke)}}ve>0&&re===!1&&(ne=U)}for(let re=0,ve=Q.length;re<ve;re++){I=Q[re].s,N.push(I),H=ne[re];for(let Ee=0,Me=H.length;Ee<Me;Ee++)I.holes.push(H[Ee].h)}return N}}const el=Yv();function Yv(){const x=new ArrayBuffer(4),i=new Float32Array(x),l=new Uint32Array(x),h=new Uint32Array(512),d=new Uint32Array(512);for(let T=0;T<256;++T){const I=T-127;I<-27?(h[T]=0,h[256|T]=32768,d[T]=24,d[256|T]=24):I<-14?(h[T]=1024>>-I-14,h[256|T]=1024>>-I-14|32768,d[T]=-I-1,d[256|T]=-I-1):I<=15?(h[T]=I+15<<10,h[256|T]=I+15<<10|32768,d[T]=13,d[256|T]=13):I<128?(h[T]=31744,h[256|T]=64512,d[T]=24,d[256|T]=24):(h[T]=31744,h[256|T]=64512,d[T]=13,d[256|T]=13)}const g=new Uint32Array(2048),v=new Uint32Array(64),b=new Uint32Array(64);for(let T=1;T<1024;++T){let I=T<<13,N=0;for(;!(8388608&I);)I<<=1,N-=8388608;I&=-8388609,N+=947912704,g[T]=I|N}for(let T=1024;T<2048;++T)g[T]=939524096+(T-1024<<13);for(let T=1;T<31;++T)v[T]=T<<23;v[31]=1199570944,v[32]=2147483648;for(let T=33;T<63;++T)v[T]=2147483648+(T-32<<23);v[63]=3347054592;for(let T=1;T<64;++T)T!==32&&(b[T]=1024);return{floatView:i,uint32View:l,baseTable:h,shiftTable:d,mantissaTable:g,exponentTable:v,offsetTable:b}}var mp=Object.freeze({__proto__:null,toHalfFloat:function(x){Math.abs(x)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),x=Vn(x,-65504,65504),el.floatView[0]=x;const i=el.uint32View[0],l=i>>23&511;return el.baseTable[l]+((8388607&i)>>el.shiftTable[l])},fromHalfFloat:function(x){const i=x>>10;return el.uint32View[0]=el.mantissaTable[el.offsetTable[i]+(1023&x)]+el.exponentTable[i],el.floatView[0]}});function Wf(){console.error("THREE.ImmediateRenderObject has been removed.")}class Xv extends bo{constructor(i,l,h){console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),super(i,l,h),this.samples=4}}class ly extends Ru{constructor(i,l,h,d){console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),super(i,l,h,d)}}class mu extends Uc{constructor(i,l,h,d){console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),super(i,l,h,d)}}class cy extends qa{constructor(i,l,h,d,g,v){console.warn("THREE.BoxBufferGeometry has been renamed to THREE.BoxGeometry."),super(i,l,h,d,g,v)}}class uy extends mf{constructor(i,l,h,d){console.warn("THREE.CapsuleBufferGeometry has been renamed to THREE.CapsuleGeometry."),super(i,l,h,d)}}class gp extends Ma{constructor(i,l,h,d){console.warn("THREE.CircleBufferGeometry has been renamed to THREE.CircleGeometry."),super(i,l,h,d)}}class Kv extends Br{constructor(i,l,h,d,g,v,b){console.warn("THREE.ConeBufferGeometry has been renamed to THREE.ConeGeometry."),super(i,l,h,d,g,v,b)}}class rd extends Os{constructor(i,l,h,d,g,v,b,T){console.warn("THREE.CylinderBufferGeometry has been renamed to THREE.CylinderGeometry."),super(i,l,h,d,g,v,b,T)}}class qf extends gf{constructor(i,l){console.warn("THREE.DodecahedronBufferGeometry has been renamed to THREE.DodecahedronGeometry."),super(i,l)}}class hy extends wf{constructor(i,l){console.warn("THREE.ExtrudeBufferGeometry has been renamed to THREE.ExtrudeGeometry."),super(i,l)}}class Wg extends rp{constructor(i,l){console.warn("THREE.IcosahedronBufferGeometry has been renamed to THREE.IcosahedronGeometry."),super(i,l)}}class dy extends Qr{constructor(i,l,h,d){console.warn("THREE.LatheBufferGeometry has been renamed to THREE.LatheGeometry."),super(i,l,h,d)}}class _p extends co{constructor(i,l){console.warn("THREE.OctahedronBufferGeometry has been renamed to THREE.OctahedronGeometry."),super(i,l)}}class vp extends Qu{constructor(i,l,h,d){console.warn("THREE.PlaneBufferGeometry has been renamed to THREE.PlaneGeometry."),super(i,l,h,d)}}class py extends eu{constructor(i,l,h,d){console.warn("THREE.PolyhedronBufferGeometry has been renamed to THREE.PolyhedronGeometry."),super(i,l,h,d)}}class fy extends Jh{constructor(i,l,h,d,g,v){console.warn("THREE.RingBufferGeometry has been renamed to THREE.RingGeometry."),super(i,l,h,d,g,v)}}class my extends xf{constructor(i,l){console.warn("THREE.ShapeBufferGeometry has been renamed to THREE.ShapeGeometry."),super(i,l)}}class gy extends sp{constructor(i,l,h,d,g,v,b){console.warn("THREE.SphereBufferGeometry has been renamed to THREE.SphereGeometry."),super(i,l,h,d,g,v,b)}}class ah extends $h{constructor(i,l){console.warn("THREE.TetrahedronBufferGeometry has been renamed to THREE.TetrahedronGeometry."),super(i,l)}}class Jv extends eh{constructor(i,l,h,d,g){console.warn("THREE.TorusBufferGeometry has been renamed to THREE.TorusGeometry."),super(i,l,h,d,g)}}class Ap extends $s{constructor(i,l,h,d,g,v){console.warn("THREE.TorusKnotBufferGeometry has been renamed to THREE.TorusKnotGeometry."),super(i,l,h,d,g,v)}}class tl extends Ef{constructor(i,l,h,d,g){console.warn("THREE.TubeBufferGeometry has been renamed to THREE.TubeGeometry."),super(i,l,h,d,g)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:c}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=c)},553:function(K,A,w){w.d(A,{_:function(){return O}});var c=w(988);const C=new WeakMap;class O extends c.aNw{constructor(X){super(X),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(X){return this.decoderPath=X,this}setDecoderConfig(X){return this.decoderConfig=X,this}setWorkerLimit(X){return this.workerLimit=X,this}load(X,te,ue,fe){const de=new c.hH6(this.manager);de.setPath(this.path),de.setResponseType("arraybuffer"),de.setRequestHeader(this.requestHeader),de.setWithCredentials(this.withCredentials),de.load(X,le=>{this.decodeDracoFile(le,te).catch(fe)},ue,fe)}decodeDracoFile(X,te,ue,fe){const de={attributeIDs:ue||this.defaultAttributeIDs,attributeTypes:fe||this.defaultAttributeTypes,useUniqueIDs:!!ue};return this.decodeGeometry(X,de).then(te)}decodeGeometry(X,te){const ue=JSON.stringify(te);if(C.has(X)){const $=C.get(X);if($.key===ue)return $.promise;if(X.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let fe;const de=this.workerNextTaskID++,le=X.byteLength,me=this._getWorker(de,le).then($=>(fe=$,new Promise((_e,oe)=>{fe._callbacks[de]={resolve:_e,reject:oe},fe.postMessage({type:"decode",id:de,taskConfig:te,buffer:X},[X])}))).then($=>this._createGeometry($.geometry));return me.catch(()=>!0).then(()=>{fe&&de&&this._releaseTask(fe,de)}),C.set(X,{key:ue,promise:me}),me}_createGeometry(X){const te=new c.u9r;X.index&&te.setIndex(new c.TlE(X.index.array,1));for(let ue=0;ue<X.attributes.length;ue++){const fe=X.attributes[ue],de=fe.name,le=fe.array,me=fe.itemSize;te.setAttribute(de,new c.TlE(le,me))}return te}_loadLibrary(X,te){const ue=new c.hH6(this.manager);return ue.setPath(this.decoderPath),ue.setResponseType(te),ue.setWithCredentials(this.withCredentials),new Promise((fe,de)=>{ue.load(X,fe,void 0,de)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const X=typeof WebAssembly!="object"||this.decoderConfig.type==="js",te=[];return X?te.push(this._loadLibrary("draco_decoder.js","text")):(te.push(this._loadLibrary("draco_wasm_wrapper.js","text")),te.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(te).then(ue=>{const fe=ue[0];X||(this.decoderConfig.wasmBinary=ue[1]);const de=F.toString(),le=["/* draco decoder */",fe,"","/* worker */",de.substring(de.indexOf("{")+1,de.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([le]))}),this.decoderPending}_getWorker(X,te){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const fe=new Worker(this.workerSourceURL);fe._callbacks={},fe._taskCosts={},fe._taskLoad=0,fe.postMessage({type:"init",decoderConfig:this.decoderConfig}),fe.onmessage=function(de){const le=de.data;switch(le.type){case"decode":fe._callbacks[le.id].resolve(le);break;case"error":fe._callbacks[le.id].reject(le);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+le.type+'"')}},this.workerPool.push(fe)}else this.workerPool.sort(function(fe,de){return fe._taskLoad>de._taskLoad?-1:1});const ue=this.workerPool[this.workerPool.length-1];return ue._taskCosts[X]=te,ue._taskLoad+=te,ue})}_releaseTask(X,te){X._taskLoad-=X._taskCosts[te],delete X._callbacks[te],delete X._taskCosts[te]}debug(){console.log("Task load: ",this.workerPool.map(X=>X._taskLoad))}dispose(){for(let X=0;X<this.workerPool.length;++X)this.workerPool[X].terminate();return this.workerPool.length=0,this}}function F(){let G,X;function te(ue,fe,de,le,me,$){const _e=$.num_components(),oe=de.num_points()*_e,ge=oe*me.BYTES_PER_ELEMENT,Se=function(Ne,Z){switch(Z){case Float32Array:return Ne.DT_FLOAT32;case Int8Array:return Ne.DT_INT8;case Int16Array:return Ne.DT_INT16;case Int32Array:return Ne.DT_INT32;case Uint8Array:return Ne.DT_UINT8;case Uint16Array:return Ne.DT_UINT16;case Uint32Array:return Ne.DT_UINT32}}(ue,me),je=ue._malloc(ge);fe.GetAttributeDataArrayForAllPoints(de,$,Se,ge,je);const ye=new me(ue.HEAPF32.buffer,je,oe).slice();return ue._free(je),{name:le,array:ye,itemSize:_e}}onmessage=function(ue){const fe=ue.data;switch(fe.type){case"init":G=fe.decoderConfig,X=new Promise(function(me){G.onModuleLoaded=function($){me({draco:$})},DracoDecoderModule(G)});break;case"decode":const de=fe.buffer,le=fe.taskConfig;X.then(me=>{const $=me.draco,_e=new $.Decoder,oe=new $.DecoderBuffer;oe.Init(new Int8Array(de),de.byteLength);try{const ge=function(je,ye,Ne,Z){const se=Z.attributeIDs,ae=Z.attributeTypes;let Be,we;const tt=ye.GetEncodedGeometryType(Ne);if(tt===je.TRIANGULAR_MESH)Be=new je.Mesh,we=ye.DecodeBufferToMesh(Ne,Be);else{if(tt!==je.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");Be=new je.PointCloud,we=ye.DecodeBufferToPointCloud(Ne,Be)}if(!we.ok()||Be.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+we.error_msg());const St={index:null,attributes:[]};for(const _t in se){const xt=self[ae[_t]];let ct,Ot;if(Z.useUniqueIDs)Ot=se[_t],ct=ye.GetAttributeByUniqueId(Be,Ot);else{if(Ot=ye.GetAttributeId(Be,je[se[_t]]),Ot===-1)continue;ct=ye.GetAttribute(Be,Ot)}St.attributes.push(te(je,ye,Be,_t,xt,ct))}return tt===je.TRIANGULAR_MESH&&(St.index=function(_t,xt,ct){const Ot=3*ct.num_faces(),At=4*Ot,Pt=_t._malloc(At);xt.GetTrianglesUInt32Array(ct,At,Pt);const Ie=new Uint32Array(_t.HEAPF32.buffer,Pt,Ot).slice();return _t._free(Pt),{array:Ie,itemSize:1}}(je,ye,Be)),je.destroy(Be),St}($,_e,oe,le),Se=ge.attributes.map(je=>je.array.buffer);ge.index&&Se.push(ge.index.array.buffer),self.postMessage({type:"decode",id:fe.id,geometry:ge},Se)}catch(ge){console.error(ge),self.postMessage({type:"error",id:fe.id,error:ge.message})}finally{$.destroy(oe),$.destroy(_e)}})}}}}},__webpackgi_module_cache__={};function __webpackgi_require__(K){var A=__webpackgi_module_cache__[K];if(A!==void 0)return A.exports;var w=__webpackgi_module_cache__[K]={id:K,exports:{}};return __webpackgi_modules__[K].call(w.exports,w,w.exports,__webpackgi_require__),w.exports}__webpackgi_require__.n=function(K){var A=K&&K.__esModule?function(){return K.default}:function(){return K};return __webpackgi_require__.d(A,{a:A}),A},__webpackgi_require__.d=function(K,A){for(var w in A)__webpackgi_require__.o(A,w)&&!__webpackgi_require__.o(K,w)&&Object.defineProperty(K,w,{enumerable:!0,get:A[w]})},__webpackgi_require__.o=function(K,A){return Object.prototype.hasOwnProperty.call(K,A)},__webpackgi_require__.r=function(K){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(K,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(K,"__esModule",{value:!0})},__webpackgi_require__.nc=void 0;var __webpackgi_exports__={};(function(){__webpackgi_require__.d(__webpackgi_exports__,{LY2:function(){return c.LY2},HRj:function(){return za},li4:function(){return KE},FO5:function(){return JE},Nlh:function(){return YE},QvI:function(){return ui},JHp:function(){return Y_},bGH:function(){return c.bGH},NDo:function(){return c.NDo},gSk:function(){return c.gSk},WMw:function(){return c.WMw},OTo:function(){return c.OTo},Se2:function(){return c.Se2},cum:function(){return c.cum},Mig:function(){return c.Mig},B$7:function(){return Lm},i_9:function(){return c.i_9},m7l:function(){return c.m7l},sYA:function(){return c.sYA},Xcj:function(){return c.Xcj},mzJ:function(){return c.mzJ},ZZA:function(){return c.ZZA},$Ph:function(){return pa},T__:function(){return c.T__},HkE:function(){return c.HkE},tGC:function(){return c.tGC},g1S:function(){return lh},I$C:function(){return o0},QIH:function(){return bi},_JE:function(){return uu},ksm:function(){return dn},jl_:function(){return Sa},b7R:function(){return Eo},BDV:function(){return kn},Ea_:function(){return Nh},qff:function(){return Sa},tmC:function(){return es},BON:function(){return mw},P40:function(){return ks},wLL:function(){return la},iHO:function(){return Pm},BbS:function(){return c.BbS},kqm:function(){return c.kqm},Hmr:function(){return c.Hmr},SJI:function(){return c.SJI},mTL:function(){return c.mTL},y8_:function(){return c.y8_},_Li:function(){return c._Li},g56:function(){return Co},bj3:function(){return Xn},z81:function(){return c.z81},_MY:function(){return c._MY},yEv:function(){return Rw},dFZ:function(){return Zu},N$j:function(){return c.N$j},_YM:function(){return c._YM},TUj:function(){return c.TUj},ZzF:function(){return c.ZzF},qzb:function(){return _t},GQ:function(){return c.GQ},nvb:function(){return c.nvb},DvJ:function(){return c.DvJ},fQA:function(){return c.fQA},cPz:function(){return rv},TlE:function(){return c.TlE},u9r:function(){return c.u9r},s4_:function(){return c.s4_},T95:function(){return c.T95},F5w:function(){return Cb},NlP:function(){return Hb},$8Z:function(){return hd},YYN:function(){return cd},CtF:function(){return c.CtF},V1s:function(){return c.V1s},jOv:function(){return yo},Rki:function(){return c.Rki},pzV:function(){return ew},itZ:function(){return No},qKx:function(){return rs},vlJ:function(){return p0},nPO:function(){return ph},zcQ:function(){return Dv},GH1:function(){return fa},ROQ:function(){return c.ROQ},YN5:function(){return c.YN5},BVQ:function(){return c.BVQ},YT8:function(){return c.YT8},_DE:function(){return Fg},YGz:function(){return c.YGz},trn:function(){return c.trn},zf8:function(){return c.zf8},uWy:function(){return c.uWy},wYQ:function(){return Ja},SUY:function(){return c.SUY},Ilk:function(){return c.Ilk},R2R:function(){return c.R2R},epp:function(){return c.epp},xmJ:function(){return Mo},GD$:function(){return Oo},EB7:function(){return c.EB7},DqL:function(){return c.DqL},_3:function(){return c._3},b_z:function(){return c.b_z},OCn:function(){return fh},_am:function(){return c._am},kB7:function(){return eA},fY$:function(){return c.fY$},vxC:function(){return c.vxC},BtG:function(){return c.BtG},cBK:function(){return c.cBK},g8_:function(){return c.g8_},AXT:function(){return c.AXT},yj7:function(){return c.yj7},dYG:function(){return c.dYG},tm_:function(){return c.tm_},S2y:function(){return c.S2y},B02:function(){return c.B02},PeU:function(){return c.PeU},Hyl:function(){return c.Hyl},Wqd:function(){return c.Wqd},Xaj:function(){return c.Xaj},DUb:function(){return $s},dZ3:function(){return c.dZ3},m_w:function(){return c.m_w},fHI:function(){return c.fHI},LBq:function(){return c.LBq},dHf:function(){return qE},Qww:function(){return Vc.Q},CGV:function(){return o_},JUT:function(){return c.JUT},p3g:function(){return c.p3g},IEO:function(){return c.IEO},CN8:function(){return c.CN8},zob:function(){return c.zob},yxD:function(){return c.yxD},CUS:function(){return Er},A5E:function(){return c.A5E},zqG:function(){return Pl},PfX:function(){return z0},Q1o:function(){return zu},jfJ:function(){return c.jfJ},T_J:function(){return c.T_J},tEQ:function(){return c.tEQ},gb4:function(){return Yt},qkB:function(){return c.qkB},cvk:function(){return th},HWo:function(){return su},brP:function(){return c.brP},$YQ:function(){return c.$YQ},X8d:function(){return B0},Zdt:function(){return i1},yNB:function(){return Ir},h7x:function(){return Qr},Ox3:function(){return c.Ox3},qtn:function(){return sc},cBI:function(){return c.cBI},cU9:function(){return c.cU9},DT1:function(){return c.DT1},Kgo:function(){return c.Kgo},ehD:function(){return c.ehD},fhJ:function(){return qp},y1s:function(){return Yp},fSK:function(){return c.fSK},Vdb:function(){return c.Vdb},l8J:function(){return c.l8J},dj0:function(){return c.dj0},QM0:function(){return c.QM0},OIS:function(){return jo},q8b:function(){return Yh},TOt:function(){return c.TOt},xaN:function(){return le},Ny0:function(){return c.Ny0},NeD:function(){return kx},Zof:function(){return F_},eD:function(){return c.eD},jwo:function(){return c.jwo},dSO:function(){return c.dSO},Bf4:function(){return c.Bf4},USm:function(){return c.USm},pBf:function(){return c.pBf},$Vf:function(){return c.$Vf},O7d:function(){return c.O7d},ksq:function(){return wi},gXf:function(){return Sv},hH6:function(){return c.hH6},kpi:function(){return jg},DwZ:function(){return mo},kN3:function(){return o1},e62:function(){return c.e62},a$l:function(){return c.a$l},OM3:function(){return c.OM3},VzW:function(){return c.VzW},ybr:function(){return c.ybr},yo9:function(){return c.yo9},$Bt:function(){return Zc},Wzm:function(){return c.Wzm},Wl3:function(){return c.Wl3},iWj:function(){return c.iWj},DNz:function(){return ts},m1M:function(){return xr},ylh:function(){return c.ylh},v9Y:function(){return c.v9Y},LSk:function(){return c.LSk},LHE:function(){return Br},KE0:function(){return nx},KCF:function(){return zE},a4n:function(){return kw},zIH:function(){return Tm},Hfk:function(){return Al},png:function(){return ba},tAj:function(){return Jl},Eb_:function(){return wa},BT2:function(){return t0},_8p:function(){return C1},V5Z:function(){return ih},s5b:function(){return kg},hkn:function(){return wd},GFY:function(){return xl},w$m:function(){return c.w$m},ksN:function(){return c.ksN},j4z:function(){return c.j4z},OAl:function(){return c.OAl},VLJ:function(){return c.VLJ},C73:function(){return ha},ZAu:function(){return c.ZAu},ibP:function(){return ju},_fI:function(){return Oo},hUN:function(){return ma},cLu:function(){return c.cLu},vmT:function(){return c.vmT},Qpg:function(){return c.Qpg},So8:function(){return c.So8},eOv:function(){return Kb},Wjw:function(){return c.Wjw},cJO:function(){return c.cJO},QRU:function(){return c.QRU},S3k:function(){return c.S3k},PpQ:function(){return c.PpQ},AHu:function(){return c.AHu},q_9:function(){return Nr},ZRs:function(){return c.ZRs},oqc:function(){return c.oqc},T_x:function(){return Tr},lb7:function(){return c.lb7},L5s:function(){return c.L5s},$TI:function(){return c.$TI},SPe:function(){return c.SPe},aVm:function(){return c.aVm},j87:function(){return c.j87},RNb:function(){return c.RNb},Kz5:function(){return c.Kz5},vpT:function(){return c.vpT},kB5:function(){return c.kB5},_C8:function(){return c._C8},Syv:function(){return c.Syv},NMF:function(){return c.NMF},pIN:function(){return c.pIN},eMJ:function(){return c.eMJ},rN7:function(){return kf},iUp:function(){return Fv},GFd:function(){return $g},x5V:function(){return c.x5V},tUh:function(){return c.tUh},z8B:function(){return c.z8B},vcl:function(){return Og},GZb:function(){return c.GZb},p7y:function(){return c.p7y},S9g:function(){return c.S9g},Zr5:function(){return c.Zr5},vCF:function(){return c.vCF},yt0:function(){return c.yt0},uXU:function(){return c.uXU},_kC:function(){return c._kC},lk7:function(){return c.lk7},USc:function(){return Jb},x12:function(){return c.x12},Zzh:function(){return c.Zzh},nls:function(){return c.nls},g_z:function(){return c.g_z},U7:function(){return c.U7},FT0:function(){return c.FT0},blk:function(){return c.blk},ejS:function(){return c.ejS},rnI:function(){return c.rnI},wem:function(){return c.wem},lfu:function(){return c.lfu},FDw:function(){return c.FDw},lRj:function(){return c.lRj},D1R:function(){return c.D1R},qyh:function(){return c.qyh},GUF:function(){return c.GUF},EoG:function(){return c.EoG},aNw:function(){return c.aNw},Zp0:function(){return c.Zp0},lLk:function(){return c.lLk},jAl:function(){return c.jAl},uEv:function(){return c.uEv},YKA:function(){return c.YKA},cRx:function(){return c.cRx},Y8D:function(){return c.Y8D},RsA:function(){return c.RsA},Y0m:function(){return Kf},F5T:function(){return c.F5T},EDU:function(){return db},z$Q:function(){return fm},KA8:function(){return Ms},XUj:function(){return xb},Me$:function(){return Ep},u7G:function(){return c.u7G},PEk:function(){return Bc},BG4:function(){return cx},M8C:function(){return c.M8C},Vkp:function(){return c.Vkp},yGw:function(){return c.yGw},Sm8:function(){return c.Sm8},Kj0:function(){return c.Kj0},vBJ:function(){return c.vBJ},QfV:function(){return Yo},lRF:function(){return c.lRF},Lun:function(){return c.Lun},YBo:function(){return c.YBo},kaV:function(){return c.kaV},RSm:function(){return c.RSm},xoR:function(){return c.xoR},EJi:function(){return c.EJi},Wid:function(){return c.Wid},iuj:function(){return Hs},IKL:function(){return c.IKL},r_:function(){return c.r_},OoA:function(){return c.OoA},qhX:function(){return c.qhX},qPT:function(){return Xp},M5h:function(){return c.M5h},Ns1:function(){return c.Ns1},TyD:function(){return c.TyD},vZf:function(){return c.vZf},HTd:function(){return c.HTd},aH4:function(){return c.aH4},YLQ:function(){return c.YLQ},BVF:function(){return c.BVF},MyG:function(){return c.MyG},jFi:function(){return c.jFi},aCh:function(){return c.aCh},uL9:function(){return c.uL9},TNj:function(){return co},IFH:function(){return c.IFH},bdR:function(){return c.bdR},kM_:function(){return tA},M6v:function(){return c.M6v},RvT:function(){return c.RvT},dUE:function(){return c.dUE},oe_:function(){return Ey},BuN:function(){return r0},Tme:function(){return c.Tme},N9P:function(){return fl},Gql:function(){return c.Gql},$XY:function(){return Pd},O9d:function(){return sA},zEO:function(){return Tu},qfx:function(){return vh},PA7:function(){return c.PA7},REq:function(){return c.REq},pQR:function(){return c.pQR},ghN:function(){return c.ghN},Hy8:function(){return c.Hy8},Wpd:function(){return c.Wpd},LgZ:function(){return c.LgZ},iWC:function(){return c.iWC},mqn:function(){return RI},SKe:function(){return $i},iKG:function(){return c.iKG},_iA:function(){return c._iA},ntZ:function(){return c.ntZ},anP:function(){return c.anP},X2e:function(){return GE},FCo:function(){return yu},y$t:function(){return c.y$t},cPb:function(){return c.cPb},lmx:function(){return er},JOQ:function(){return c.JOQ},BKK:function(){return c.BKK},_12:function(){return c._12},tJx:function(){return c.tJx},cek:function(){return c.cek},qD0:function(){return j_},xG9:function(){return c.xG9},wI8:function(){return fd},Sgv:function(){return a1},woe:function(){return c.woe},UY4:function(){return c.UY4},aq0:function(){return c.aq0},ujx:function(){return c.ujx},Uol:function(){return c.Uol},JiH:function(){return b0},VYz:function(){return c.VYz},_Pm:function(){return lu},EsW:function(){return lo},iUV:function(){return c.iUV},tf:function(){return c.tf},ZQ6:function(){return c.ZQ6},mXe:function(){return c.mXe},_fP:function(){return c._fP},iLg:function(){return c.iLg},zbs:function(){return c.zbs},UZH:function(){return c.UZH},mSO:function(){return c.mSO},wk1:function(){return c.wk1},E2K:function(){return c.E2K},FUD:function(){return c.FUD},pKu:function(){return c.pKu},GG6:function(){return c.GG6},Gih:function(){return c.Gih},iiP:function(){return c.iiP},SvJ:function(){return c.SvJ},ptH:function(){return c.ptH},jZA:function(){return c.jZA},y2t:function(){return c.y2t},gi4:function(){return c.gi4},Djp:function(){return c.Djp},BG$:function(){return c.BG$},NYV:function(){return c.NYV},xJs:function(){return c.xJs},bsb:function(){return c.bsb},ekQ:function(){return c.ekQ},CaW:function(){return c.CaW},eaV:function(){return c.eaV},BFQ:function(){return c.BFQ},v3W:function(){return c.v3W},ILR:function(){return c.ILR},UCm:function(){return c.UCm},Inb:function(){return c.Inb},U1$:function(){return At},LgE:function(){return c.LgE},fto:function(){return c.fto},l0P:function(){return c.l0P},vCx:function(){return c.vCx},_AM:function(){return c._AM},wuA:function(){return c.wuA},av9:function(){return c.av9},CtA:function(){return c.CtA},BvQ:function(){return Af},FZJ:function(){return nu},FIo:function(){return c.FIo},zHn:function(){return c.zHn},iMs:function(){return c.iMs},T_f:function(){return c.T_f},hEm:function(){return c.hEm},D9w:function(){return c.D9w},sHH:function(){return Kh},CdI:function(){return c.CdI},rkc:function(){return md},rpg:function(){return c.rpg},ce8:function(){return c.ce8},rOj:function(){return c.rOj},P6m:function(){return mc},JA6:function(){return Xg},V4E:function(){return c.V4E},o8S:function(){return c.o8S},flB:function(){return Cc},DUH:function(){return pT},KI_:function(){return c.KI_},iLN:function(){return Qm},jsw:function(){return ys},srG:function(){return Eb},i6Z:function(){return Vm},vfv:function(){return n0},xsS:function(){return c.xsS},or:function(){return $b},EQj:function(){return ga},ov0:function(){return iv},WdD:function(){return c.WdD},Vj0:function(){return c.Vj0},jyz:function(){return c.jyz},mTM:function(){return Dc},Mn1:function(){return Ts},Hlq:function(){return _s},Fi7:function(){return Dl},Tn7:function(){return c.Tn7},bnF:function(){return c.bnF},HW6:function(){return c.HW6},oa8:function(){return c.oa8},T_1:function(){return c.T_1},zHJ:function(){return zl},iDF:function(){return c.iDF},iAb:function(){return c.iAb},d4E:function(){return iy},lBg:function(){return Yb},JeJ:function(){return Mw},FKY:function(){return w},zlZ:function(){return Sy},vkg:function(){return Sd},brh:function(){return gc},kZK:function(){return Vl},puG:function(){return Xb},OdW:function(){return c.OdW},_YX:function(){return c._YX},TUv:function(){return c.TUv},Hw6:function(){return c.Hw6},aLr:function(){return c.aLr},Aip:function(){return c.Aip},xo$:function(){return c.xo$},bIn:function(){return BI},$V:function(){return c.$V},lDi:function(){return c.lDi},gti:function(){return c.gti},PMe:function(){return c.PMe},iwP:function(){return Vh},FvO:function(){return c.FvO},jyi:function(){return c.jyi},xeV:function(){return c.xeV},k74:function(){return c.k74},RlZ:function(){return c.RlZ},KhW:function(){return c.KhW},HgB:function(){return c.HgB},W2J:function(){return c.W2J},JWc:function(){return c.JWc},u37:function(){return c.u37},Z6B:function(){return c.Z6B},QZ1:function(){return c.QZ1},Ir4:function(){return c.Ir4},NwF:function(){return c.NwF},Wbm:function(){return c.Wbm},N4l:function(){return c.N4l},ej9:function(){return Sp},QmN:function(){return c.QmN},IOt:function(){return c.IOt},NOD:function(){return Mf},L5g:function(){return c.L5g},H$k:function(){return c.H$k},cuP:function(){return fo},xEZ:function(){return c.xEZ},dpR:function(){return c.dpR},wOD:function(){return Ta},KNb:function(){return W0},IiN:function(){return Ff},Cne:function(){return c.Cne},XvJ:function(){return c.XvJ},XZw:function(){return c.XZw},FE5:function(){return c.FE5},lVp:function(){return Ev},CJI:function(){return c.CJI},z$h:function(){return c.z$h},UlW:function(){return c.UlW},WwZ:function(){return c.WwZ},Lcc:function(){return c.Lcc},WXh:function(){return c.WXh},Vjr:function(){return Rx},LuM:function(){return p1},LP5:function(){return VC},xfE:function(){return c.xfE},qlB:function(){return c.qlB},lCJ:function(){return c.lCJ},WTc:function(){return c.WTc},rAo:function(){return c.rAo},LZj:function(){return ty},xWb:function(){return c.xWb},gH0:function(){return c.gH0},rBU:function(){return c.rBU},rDY:function(){return c.rDY},ywz:function(){return c.ywz},wJv:function(){return c.wJv},JQ4:function(){return c.JQ4},k0A:function(){return c.k0A},irR:function(){return c.irR},LsT:function(){return c.LsT},q5h:function(){return Rm},TKh:function(){return fw},tyg:function(){return G0},Ro5:function(){return jh},dwk:function(){return c.dwk},FM8:function(){return c.FM8},Pa4:function(){return c.Pa4},Ltg:function(){return c.Ltg},yC1:function(){return c.yC1},lHq:function(){return Cf},fO1:function(){return c.fO1},oMA:function(){return Ya},JzW:function(){return K},QEt:function(){return Lg},b5g:function(){return c.b5g},Ywn:function(){return c.Ywn},GVz:function(){return c.GVz},oAp:function(){return c.oAp},kFz:function(){return c.kFz},p7A:function(){return c.p7A},dd2:function(){return c.dd2},CP7:function(){return c.CP7},fQK:function(){return c.fQK},Wd$:function(){return ny},t1_:function(){return v1},Uk6:function(){return c.Uk6},_sL:function(){return c._sL},Pnf:function(){return c.Pnf},c8b:function(){return c.c8b},_lf:function(){return c._lf},ad5:function(){return c.ad5},sZV:function(){return dw},TfA:function(){return fn},sKX:function(){return km},UdM:function(){return Ai},P0y:function(){return jd},L_r:function(){return c.L_r},Bve:function(){return zg},UeO:function(){return Zl},$nx:function(){return Ow},Bk6:function(){return Ps},y4l:function(){return Cm},pQ0:function(){return Om},wXW:function(){return hS},r5x:function(){return lS},MSI:function(){return fS},EUu:function(){return OI},jtH:function(){return ep},T0T:function(){return wv},gAb:function(){return sw},iwT:function(){return Tf},je_:function(){return HC},wBP:function(){return ff},LU2:function(){return lv},wQL:function(){return LI},Zs7:function(){return vb},x7s:function(){return TS},Mnd:function(){return FI},A0_:function(){return UI},d73:function(){return mb},HCD:function(){return Cn},RG9:function(){return vn},G2P:function(){return Xc},XLf:function(){return $m},CGN:function(){return xA},mvg:function(){return h_},Hiy:function(){return Lp},XMc:function(){return cS},N7M:function(){return oS},iv:function(){return dS},n55:function(){return ps},IaC:function(){return Fl},h9t:function(){return EA},yDW:function(){return SA},gJv:function(){return rf},l$g:function(){return eC},vQi:function(){return NC},$MY:function(){return X0},wJl:function(){return H_},Z7Y:function(){return ov},X7D:function(){return av},BnX:function(){return Jm},uZ5:function(){return qu},zVI:function(){return rS},DpF:function(){return op},nNb:function(){return Hc},cqZ:function(){return rc},pKN:function(){return ob},d_$:function(){return iA},DdI:function(){return ix},rrX:function(){return ab},KlC:function(){return nA},KVn:function(){return Ot},oau:function(){return wx},aw9:function(){return Sr},Aap:function(){return vi},Dxg:function(){return je},MjT:function(){return Vs},F7Q:function(){return bA},IFq:function(){return x1},IJl:function(){return Km},O5A:function(){return Mc},wCn:function(){return Cr},gGT:function(){return yA},pEc:function(){return WE},Bi6:function(){return bd},fi_:function(){return RS},TT:function(){return AT},q2Z:function(){return MI},NyK:function(){return Pi},bgu:function(){return Em},kcS:function(){return ql},rRN:function(){return Fx},ivY:function(){return se},_s1:function(){return WI},_HO:function(){return zt},tpL:function(){return Wt},DMK:function(){return lg},LjN:function(){return j0},iFs:function(){return wl},qTg:function(){return oe},Wtl:function(){return Hn},DmK:function(){return In},Htt:function(){return XC},Hx7:function(){return kt},imt:function(){return ri},US6:function(){return m_},vZs:function(){return rA},TE$:function(){return jI},lmu:function(){return Ss},SvO:function(){return Wo},YQY:function(){return qd},mZN:function(){return sv},VvG:function(){return wA},omp:function(){return $S},utz:function(){return d_},TFV:function(){return El},hrz:function(){return ye},JKM:function(){return Ax},jZf:function(){return b1},RjL:function(){return l1},RRI:function(){return CS},RUq:function(){return ZS},_t4:function(){return Ql},YHh:function(){return Ec},R8g:function(){return Pt},Bbl:function(){return Ed},V9r:function(){return ge},PZ2:function(){return Se},w7A:function(){return me},N6S:function(){return ft},Uxp:function(){return jt},tAz:function(){return vt},R$F:function(){return pe},N33:function(){return rt},gw2:function(){return Nm},KlU:function(){return Ie},wo6:function(){return Pc},H4P:function(){return Z},swA:function(){return Fh},_Z3:function(){return Uh},ivc:function(){return Hc},rZ1:function(){return rc},CpZ:function(){return DS},dyc:function(){return ae},MxZ:function(){return PT},btp:function(){return DT},mXy:function(){return Ox},Ej0:function(){return rr},ep4:function(){return qr},DQP:function(){return Qs},VNr:function(){return no},V7q:function(){return Ic},zEk:function(){return Cs},qfq:function(){return Aa},piB:function(){return tt},IIc:function(){return kI},rrF:function(){return aa},naq:function(){return Xs},sXR:function(){return ag},p5I:function(){return bv},wps:function(){return ow},wuo:function(){return E1},GpE:function(){return $},F4b:function(){return $d},t$v:function(){return La},tdn:function(){return xg},Y9t:function(){return Rv},GEo:function(){return nf},DH3:function(){return uS},uxM:function(){return ZE},zH3:function(){return eS},MLs:function(){return Qd},xXG:function(){return Ui},YM4:function(){return pf},B3r:function(){return w1},iAx:function(){return f0},lDn:function(){return Xe},oaQ:function(){return Xm},CD7:function(){return Kc},Rc0:function(){return rg},iPG:function(){return lc},TIc:function(){return Bp},xsC:function(){return mS},zOc:function(){return Mi},r46:function(){return yS},z2C:function(){return we},_X$:function(){return xd},_yn:function(){return Oi},Dyg:function(){return Su},cUc:function(){return Op},zGw:function(){return og},Ctq:function(){return vx},$ch:function(){return zI},k5b:function(){return p_},kZl:function(){return gb},OCg:function(){return bx},YjH:function(){return MS},Ui8:function(){return M1},YD2:function(){return Yu},vi9:function(){return YC},ij3:function(){return aS},YPW:function(){return sS},Bg1:function(){return PI},kon:function(){return Ne},M3g:function(){return tf},F2z:function(){return Ul},pJF:function(){return JS},knz:function(){return c.knz},Ejo:function(){return _e},BgY:function(){return Qn},qCG:function(){return et},HD9:function(){return cn},fEB:function(){return _r},Udc:function(){return Hi},ZQg:function(){return di},ofC:function(){return qt},yRy:function(){return io},_NL:function(){return Vg},LCA:function(){return ir},j1w:function(){return kc},i8J:function(){return YI},p7C:function(){return Lr},ZAS:function(){return Bl},ipH:function(){return VI},$TF:function(){return JC},uZI:function(){return GI},VWG:function(){return lx},pQ7:function(){return Zh},STw:function(){return oc},jc8:function(){return kp},BL_:function(){return dm},S6:function(){return qI},T8U:function(){return U_},TD6:function(){return Gu},akS:function(){return ux},QKE:function(){return tS},dKx:function(){return Be},OvX:function(){return WC},VsW:function(){return is},YMc:function(){return KC},aPg:function(){return Zn},LFn:function(){return Cu},wey:function(){return Oa},MaE:function(){return Ji},s4x:function(){return dl},FJA:function(){return wr},vIA:function(){return Ao},Spv:function(){return Ci},w8l:function(){return Th},riG:function(){return Si},Kbh:function(){return ja},t8K:function(){return wn},Q7n:function(){return _n},KGF:function(){return Yr},e5:function(){return be},Rik:function(){return Q0},GZo:function(){return Bm},Bds:function(){return Qp},HTu:function(){return qa},cTq:function(){return Tc},X_Y:function(){return W_},dA8:function(){return Q_},bwS:function(){return _x},Lks:function(){return QI},Rvq:function(){return qC},P4F:function(){return mT},Pd0:function(){return Jo},Pjo:function(){return gx},Tum:function(){return Re},dRH:function(){return $o},RX0:function(){return _l},reQ:function(){return HI},cWm:function(){return pS},NC9:function(){return $E},$Re:function(){return pw},Xo9:function(){return V0},LNO:function(){return Dm},iZP:function(){return Gp}});var K,A={};__webpackgi_require__.r(A),__webpackgi_require__.d(A,{AsyncCompress:function(){return Me},AsyncDecompress:function(){return on},AsyncDeflate:function(){return Q},AsyncGunzip:function(){return lt},AsyncGzip:function(){return Me},AsyncInflate:function(){return ie},AsyncUnzipInflate:function(){return yr},AsyncUnzlib:function(){return Ct},AsyncZipDeflate:function(){return Yn},AsyncZlib:function(){return $t},Compress:function(){return Ee},DecodeUTF8:function(){return at},Decompress:function(){return Ut},Deflate:function(){return U},EncodeUTF8:function(){return We},Gunzip:function(){return Ke},Gzip:function(){return Ee},Inflate:function(){return ne},Unzip:function(){return qg},UnzipInflate:function(){return Ar},UnzipPassThrough:function(){return hi},Unzlib:function(){return ln},Zip:function(){return $n},ZipDeflate:function(){return fi},ZipPassThrough:function(){return Jn},Zlib:function(){return Ft},compress:function(){return Pe},compressSync:function(){return Ye},decompress:function(){return On},decompressSync:function(){return Ti},deflate:function(){return Y},deflateSync:function(){return H},gunzip:function(){return ut},gunzipSync:function(){return Ze},gzip:function(){return Pe},gzipSync:function(){return Ye},inflate:function(){return re},inflateSync:function(){return ve},strFromU8:function(){return Tt},strToU8:function(){return st},unzip:function(){return An},unzipSync:function(){return _y},unzlib:function(){return Dt},unzlibSync:function(){return nn},zip:function(){return hr},zipSync:function(){return Da},zlib:function(){return Lt},zlibSync:function(){return an}}),function(s){s[s.Error=-2]="Error",s[s.Destroyed=-1]="Destroyed",s[s.None=0]="None",s[s.Running=1]="Running",s[s.Paused=2]="Paused"}(K||(K={}));class w{constructor(){this._eventListeners={},this.dispatchEvent=this.dispatchEvent.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.hasEventListener=this.hasEventListener.bind(this)}addEventListener(e,t){const n=this._eventListeners;n[e]===void 0&&(n[e]=[]),n[e].includes(t)||n[e].push(t)}hasEventListener(e,t){const n=this._eventListeners;return n[e]!==void 0&&n[e].includes(t)}removeEventListener(e,t){const n=this._eventListeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){const t=this._eventListeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}}}var c=__webpackgi_require__(988);const C={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class O{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const F=new c.iKG(-1,1,1,-1,0,1),G=new c.u9r;G.setAttribute("position",new c.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),G.setAttribute("uv",new c.a$l([0,2,0,0,2,0],2));class X{constructor(e){this._mesh=new c.Kj0(G,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,F)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class te extends O{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof c.jyz?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=c.rDY.clone(e.uniforms),this.material=new c.jyz({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new X(this.material),this.useExistingRenderTarget=!1}render(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(this.useExistingRenderTarget||e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class ue extends O{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,n){const r=e.getContext(),o=e.state;let a,u;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(a=0,u=1):(a=1,u=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(r.REPLACE,r.REPLACE,r.REPLACE),o.buffers.stencil.setFunc(r.ALWAYS,a,4294967295),o.buffers.stencil.setClear(u),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(r.EQUAL,1,4294967295),o.buffers.stencil.setOp(r.KEEP,r.KEEP,r.KEEP),o.buffers.stencil.setLocked(!0)}}class fe extends O{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}new c.iKG(-1,1,1,-1,0,1);const de=new c.u9r;de.setAttribute("position",new c.a$l([-1,3,0,-1,-1,0,3,-1,0],3)),de.setAttribute("uv",new c.a$l([0,2,0,0,2,0],2));class le extends class{constructor(e,t){if(this.renderer=e,t===void 0){const n=e.getSize(new c.FM8);this._pixelRatio=e.getPixelRatio(),this._width=n.width,this._height=n.height,(t=new c.dd2(this._width*this._pixelRatio,this._height*this._pixelRatio)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],C===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),te===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new te(C),this.clock=new c.SUY}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let n=!1;for(let r=0,o=this.passes.length;r<o;r++){const a=this.passes[r];if(a.enabled!==!1){if(a.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(r),a.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),a.needsSwap){if(n){const u=this.renderer.getContext(),p=this.renderer.state.buffers.stencil;p.setFunc(u.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),p.setFunc(u.EQUAL,1,4294967295)}this.swapBuffers()}ue!==void 0&&(a instanceof ue?n=!0:a instanceof fe&&(n=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new c.FM8);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(let o=0;o<this.passes.length;o++)this.passes[o].setSize(n,r)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}{constructor(e,t){super(e,t)}setPixelRatio(e,t=!0){const n=this.setSize;t||(this.setSize=()=>{}),super.setPixelRatio(e),t||(this.setSize=n)}}function me(s,e){let t;do t=Object.getOwnPropertyDescriptor(s,e);while(!t&&(s=Object.getPrototypeOf(s)));return t}function $(s,e,t=!1,n=!1){const r=me(s,e);return!!(r!=null&&r.set)||t&&(r==null?void 0:r.writable)!==!1&&(r==null?void 0:r.get)===void 0||n&&!r}function _e(s,e,t,n=!1,r=!1){return!(!s||!$(s,e,n,r)||(s[e]=t,0))}function oe(s,e){for(;s.length>0;){if(!e)return;const t=s.splice(0,1)[0];if(!(t.length<1)){if(!(t in e))return console.error("invalid access, check",t,e),e;e=e[t]}}return e}function ge(s,e){return Object.keys(s).find(t=>s[t]===e)}function Se(s,...e){return typeof s=="function"&&(s=s(...e)),s}function je(s,e,t){for(const n of t){const r=s[n];r!==void 0&&_e(e,n,r,!0)}}function ye(s){return s.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}function Ne(s,e,t){return s.replace(new RegExp(ye(e),"g"),t)}const Z=(s,...e)=>String.raw({raw:s},...e),se=(s,...e)=>String.raw({raw:s},...e),ae=(s,...e)=>String.raw({raw:s},...e),Be=(s,...e)=>{let t=String.raw({raw:s},...e);return t=Ne(t,"%","%25"),t=Ne(t,"> <","><"),t=Ne(t,"; }",";}"),t=Ne(t,"<","%3c"),t=Ne(t,">","%3e"),t=Ne(t,'"',"'"),t=Ne(t,"#","%23"),t=Ne(t,"{","%7b"),t=Ne(t,"}","%7d"),t=Ne(t,"|","%7c"),t=Ne(t,"^","%5e"),t=Ne(t,"`","%60"),t=Ne(t,"@","%40"),t=Ne(t,"&","&amp;"),t=Ne(t,`
`,"%0A"),"data:image/svg+xml;charset=UTF-8,"+t};function we(s){if(!s)throw new Error("onChange: fnKey is undefined, make sure the function exists or provide a string");return(e,t)=>{let n=e[t];Object.defineProperty(e,t,{get:()=>n,set(r){var o;if(n===r)return;n=r;const a=[t,r];if(typeof s=="string")(o=this[s])===null||o===void 0||o.call(this,...a);else if(typeof s=="function"){let u=!1;if(s.name){let p=this;for(;p;){if(p[s.name]===s){s.call(this,...a),u=!0;break}p=Object.getPrototypeOf(p)}}u||(s.name&&this[s.name].name===`bound ${s.name}`?this[s.name](...a):s(...a))}}})}}function tt(s,e){for(const t of e)if(!s.includes(t))return!1;return!0}String.prototype.replaceAll||(String.prototype.replaceAll=function(s,e){return Object.prototype.toString.call(s).toLowerCase()==="[object regexp]"?this.replace(s,e):this.replace(new RegExp(s,"g"),e)});class St{constructor(e=0,t=0){St.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),r=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*n-a*r+e.x,this.y=o*r+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class _t extends c.ZzF{expandByObject(e,t=!1,n=!1){var r;if(((r=e.userData)===null||r===void 0?void 0:r.bboxVisible)===!1)return this;if(!e.visible&&n)return this;e.updateWorldMatrix(!1,!1);const o=e.geometry;if(o!==void 0)if(t&&o.attributes!=null&&o.attributes.position!==void 0){const u=o.attributes.position;for(let p=0,f=u.count;p<f;p++)ct.fromBufferAttribute(u,p).applyMatrix4(e.matrixWorld),this.expandByPoint(ct)}else o.boundingBox===null&&o.computeBoundingBox(),xt.copy(o.boundingBox),xt.applyMatrix4(e.matrixWorld),this.union(xt);const a=e.children;for(let u=0,p=a.length;u<p;u++)this.expandByObject(a[u],t,n);return this}expandByObjects(e,t=!1,n=!1){for(let r=0,o=e.length;r<o;r++)this.expandByObject(e[r],t,n);return this}getPoints(){return[new c.Pa4(this.min.x,this.min.y,this.min.z),new c.Pa4(this.min.x,this.min.y,this.max.z),new c.Pa4(this.min.x,this.max.y,this.min.z),new c.Pa4(this.min.x,this.max.y,this.max.z),new c.Pa4(this.max.x,this.min.y,this.min.z),new c.Pa4(this.max.x,this.min.y,this.max.z),new c.Pa4(this.max.x,this.max.y,this.min.z),new c.Pa4(this.max.x,this.max.y,this.max.z)]}getScreenSpaceBounds(e){const t=this.getPoints(),n=new c.TUj;for(const r of t){const o=r.project(e);n.min.min(o),n.max.max(o)}return n}}const xt=new _t,ct=new c.Pa4;function Ot(s,e){let t,n;if(Array.isArray(s))for(const o of s){const a=Ot(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}const r=s;if(r.geometry!==void 0){const o=r.geometry.vertices;if(o===void 0&&r.geometry.attributes!==void 0&&"position"in r.geometry.attributes){const a=new c.Pa4,u=r.geometry.attributes.position;for(let p=0;p<u.count*u.itemSize;p+=u.itemSize){a.set(u.array[p],u.array[p+1],u.array[3]);const f=a.applyMatrix4(s.matrixWorld).project(e),m=new St(f.x,f.y);t===void 0||n===void 0?(t=m.clone(),n=m.clone()):(t.min(m),n.max(m))}}else for(const a of o){const u=a.clone().applyMatrix4(s.matrixWorld).project(e),p=new St(u.x,u.y);t===void 0||n===void 0?(t=p.clone(),n=p.clone()):(t.min(p),n.max(p))}}if(s.children!==void 0)for(const o of s.children){const a=Ot(o,e);t===void 0||n===void 0?(t=a.min.clone(),n=a.max.clone()):(t.min(a.min),n.max(a.max))}return new c.TUj(t,n)}const At=3005;function Pt(s){switch(s){case c.rnI:return["Linear","( value )"];case c.knz:return["sRGB","( value )"];case At:return["RGBM","( value, 16.0 )"];default:return console.warn("utils: Unsupported encoding:",s),["Linear","( value )"]}}function Ie(s,e){let t;return s&&s.isTexture?t=s.encoding:s&&s.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=s.texture.encoding):t=c.rnI,e&&s&&s.isTexture&&s.format===c.wk1&&s.type===c.ywz&&s.encoding===c.knz&&(t=c.rnI),t}function vt(s,e){const t=Pt(e);return"vec4 "+s+"( vec4 value ) { return "+t[0]+"ToLinear"+t[1]+"; }"}function ft(s,e,t){return vt(s+"TexelToLinear",Ie(e,t))+`
`}function jt(s,e){return vt(s+"TexelToLinear",e)+`
`}function rt(s,e){const t=Pt(e);return"vec4 "+s+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function pe(s,e,t){return rt(s,Ie(e,t))}function be({uniforms:s,propKey:e,thisTarget:t=!1}={}){const n=!!s,r=!!e,o=t;return(a,u)=>{const p=f=>{const m=o?f:n?s:f.uniforms||f._uniforms;let y=r?e:u;o&&(y="_"+y);let S=m[y];return S||(S={value:null},m[y]=S),S};Object.defineProperty(a,u,{get(){return p(this).value},set(f){p(this).value=f,_e(this,"uniformsNeedUpdate",!0,!0)}})}}function Xe(s,e,t=!1,n){const r=!!e,o=!!s;return(a,u)=>{const p=f=>({t:r?e:f.defines||f._defines,p:o?s:u});Object.defineProperty(a,u,{get(){const{t:f,p:m}=p(t?this:this.material);return f[m]},set(f){const{t:m,p:y}=p(t?this:this.material);if(_e(m,y,f,!0),typeof n=="function"){const S=[y,f];if(n.name){const M=this[n.name];M===n?n.call(this,...S):M.name===`bound ${n.name}`?M(...S):n(...S)}else n(...S)}else _e(t?this:this.material,"needsUpdate",!0,!0)}})}}function zt(s){const e=new c.IEO(new Uint8Array([Math.floor(255*s.r),Math.floor(255*s.g),Math.floor(255*s.b),255]),1,1,c.wk1,c.ywz);return e.needsUpdate=!0,e.encoding=c.rnI,e}function Wt(s){const e=new c.IEO(new Uint8Array([Math.floor(255*s.x),Math.floor(255*s.y),Math.floor(255*s.z),Math.floor(255*s.w)]),1,1,c.wk1,c.ywz);return e.needsUpdate=!0,e}function qt(s,e,t){const n=s.userData,{backgroundRender:r,transparentRender:o,shadowMapRender:a,mainRenderPass:u,opaqueRender:p,transmissionRender:f,sceneRender:m,screenSpaceRendering:y}=n;e.backgroundRender!==void 0&&(n.backgroundRender=e.backgroundRender),e.transparentRender!==void 0&&(n.transparentRender=e.transparentRender),e.shadowMapRender!==void 0&&(n.shadowMapRender=e.shadowMapRender),e.mainRenderPass!==void 0&&(n.mainRenderPass=e.mainRenderPass),e.opaqueRender!==void 0&&(n.opaqueRender=e.opaqueRender),e.sceneRender!==void 0&&(n.sceneRender=e.sceneRender),e.transmissionRender!==void 0&&(n.transmissionRender=e.transmissionRender),e.screenSpaceRendering!==void 0&&(n.screenSpaceRendering=e.screenSpaceRendering),t(),n.backgroundRender=r,n.transparentRender=o,n.shadowMapRender=a,n.mainRenderPass=u,n.opaqueRender=p,n.sceneRender=m,n.transmissionRender=f,n.screenSpaceRendering=y}function Cn(s){const e=new _t().expandByObject(s,!0,!0).getCenter(new c.Pa4);s.position.sub(e),s.updateMatrix(),s.userData.autoCentered=!0}function vn(s,e){const t=.5*new _t().expandByObject(s,!0,!0).getSize(new c.Pa4).length();e===void 0&&(e=s.userData.autoScaleRadius||1);const n=e/t;return isFinite(n)&&(s.userData.pseudoCentered?s.children.forEach(r=>{r.scale.multiplyScalar(n)}):s.scale.multiplyScalar(n)),s.traverse(r=>{var o,a;r.isLight&&(!((a=(o=r.shadow)===null||o===void 0?void 0:o.camera)===null||a===void 0)&&a.right)&&(r.shadow.camera.right*=n,r.shadow.camera.left*=n,r.shadow.camera.top*=n,r.shadow.camera.bottom*=n),r.isCamera&&r.right&&(r.right*=n,r.left*=n,r.top*=n,r.bottom*=n)}),s.userData.autoScaled=!0,s.userData.autoScaleRadius=e,s.dispatchEvent({type:"objectUpdate"}),s}function Zn(s,e=-1){return function(t,n=1e-4){const r=n>0;n=Math.max(n,Number.EPSILON);const o={},a=t.getIndex(),u=t.getAttribute("position"),p=a?a.count:u.count;let f=0;const m=Object.keys(t.attributes),y={},S={},M=[],P=["getX","getY","getZ","getW"];for(let L=0,R=m.length;L<R;L++){const W=m[L];y[W]=[];const q=t.morphAttributes[W];q&&(S[W]=new Array(q.length).fill().map(()=>[]))}const D=Math.log10(1/n),j=Math.pow(10,D);for(let L=0;L<p;L++){const R=a?a.getX(L):L;let W="";for(let q=0,J=m.length;q<J&&r;q++){const ee=m[q],he=t.getAttribute(ee),xe=he.itemSize;for(let De=0;De<xe;De++)W+=~~(he[P[De]](R)*j)+","}if(r&&W in o)M.push(o[W]);else{for(let q=0,J=m.length;q<J;q++){const ee=m[q],he=t.getAttribute(ee),xe=t.morphAttributes[ee],De=he.itemSize,Fe=y[ee],ke=S[ee];for(let Qe=0;Qe<De;Qe++){const Oe=P[Qe];if(Fe.push(he[Oe](R)),xe)for(let ze=0,$e=xe.length;ze<$e;ze++)ke[ze].push(xe[ze][Oe](R))}}r&&(o[W]=f),M.push(f),f++}}const k=t.clone();for(let L=0,R=m.length;L<R;L++){const W=m[L],q=t.getAttribute(W),J=new q.array.constructor(y[W]),ee=new c.TlE(J,q.itemSize,q.normalized);if(k.setAttribute(W,ee),W in S)for(let he=0;he<S[W].length;he++){const xe=t.morphAttributes[W][he],De=new xe.array.constructor(S[W][he]),Fe=new c.TlE(De,xe.itemSize,xe.normalized);k.morphAttributes[W][he]=Fe}}return k.setIndex(M),k}(s,e)}class Xn extends w{constructor({animationLoop:e,canvas:t,alpha:n=!0,targetOptions:r}){super(),this._isWebGL2=!1,this._trackedTargets=[],this.dirty=!0,this._lastTime=0,this.frameWaitTime=0,this._passes=[],this._pipeline=[],this._passesNeedsUpdate=!0,this._displayCanvasScaling=1,this._renderSize=new c.FM8(512,512),this._frameCount=0,this._tempTargets={},this.maxTempPerKey=5,this._animationLoop=this._animationLoop.bind(this),this._processNewTarget=this._processNewTarget.bind(this),this._processNewTempTarget=this._processNewTempTarget.bind(this),this.trackTarget=this.trackTarget.bind(this),this.disposeTarget=this.disposeTarget.bind(this),this.createTarget=this.createTarget.bind(this),this.createTargetCustom=this.createTargetCustom.bind(this),this._renderer=new c.CP7({canvas:t,antialias:!0,alpha:n,premultipliedAlpha:!1,preserveDrawingBuffer:!0}),this._renderer.baseRenderer=this,this._renderer.setAnimationLoop(this._animationLoop),this._context=this._renderer.getContext(),this._isWebGL2=this._renderer.capabilities.isWebGL2,this._renderSize=new c.FM8(t.clientWidth,t.clientHeight),this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling),this._renderer.toneMapping=c.uL9,this._renderer.toneMappingExposure=1,this._renderer.outputEncoding=c.rnI,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=c._iA,this._renderer.shadowMap.autoUpdate=!1,this.resetShadows(),this._composerTarget=this.createTarget(r,!1),this._composerTarget.texture.name="EffectComposer.rt1",this._composer=new le(this._renderer,this._composerTarget),e&&this.addEventListener("animationLoop",e)}get composer(){return this._composer}get passes(){return this._passes}get isWebGL2(){return this._isWebGL2}get composerTarget(){return this._composerTarget}get renderSize(){return this._renderSize}get displayCanvasScaling(){return this._displayCanvasScaling}set displayCanvasScaling(e){e!==this._displayCanvasScaling&&(this._displayCanvasScaling=e,this.setSize(void 0,void 0,!0))}get frameCount(){return this._frameCount}set pipeline(e){this._pipeline=e,this._passesNeedsUpdate=!0}get pipeline(){return this._pipeline}refreshPipeline(){var e,t,n;const r=this._passes,o=[],a={};for(const u of r){if(u.enabled===!1)continue;const p={after:(e=u.after)!==null&&e!==void 0?e:[],before:(t=u.before)!==null&&t!==void 0?t:[],dependencies:new Set((n=u.required)!==null&&n!==void 0?n:[])};a[u.passId]=p}for(const[u,p]of Object.entries(a)){const f=new Set([...p.after,...p.before]);p.dependencies.forEach(m=>f.has(m)&&f.delete(m)),f.forEach(m=>{const y=a[m];if(y){if(y.dependencies.has(u))throw console.error("cyclic",u,m),"Cyclic dependency";p.dependencies.add(m)}})}for(;;){let u=!1;const p=[...Object.entries(a)];for(const[f,m]of p)if(!o.includes(f)&&tt(o,m.dependencies.values())){const y=Math.max(-1,...m.after.map(M=>o.indexOf(M))),S=Math.min(o.length,...m.before.map(M=>{const P=o.indexOf(M);return P<0?o.length:P}));if(y>=S)throw console.error(m,r,o,y,S),"Not possible";o.splice(m.after.length>0?y+1:S,0,f),u=!0,delete a[f]}if(Object.keys(a).length<1)break;if(!u)throw console.log(p,a,o),"Not possible 2"}return this.pipeline=o,this.pipeline}get context(){return this._context}get rendererObject(){return this._renderer}_animationLoop(e,t){const n=e-this._lastTime;this._lastTime=e,this.frameWaitTime-=n,this.frameWaitTime>0||(this.frameWaitTime=0,this.dispatchEvent({type:"animationLoop",deltaTime:n,time:e,renderer:this,xrFrame:t}))}get clock(){return this._composer.clock}registerPass(e,t=!0){var n;if(t)for(const r of[...this._passes])e.passId===r.passId&&this.unregisterPass(r);this._passes.push(e),(n=e.onRegister)===null||n===void 0||n.call(e,this),this._passesNeedsUpdate=!0,this._updated()}unregisterPass(e){var t;const n=this._passes.indexOf(e);n>=0&&((t=e.onUnregister)===null||t===void 0||t.call(e,this),this._passes.splice(n,1),this._passesNeedsUpdate=!0,this._updated())}setSize(e,t,n=!1){!n&&(e?Math.abs(e-this._renderSize.width):0)+(t?Math.abs(t-this._renderSize.height):0)<.1||(e&&(this._renderSize.width=e),t&&(this._renderSize.height=t),this.rendererObject.xr.enabled||(this._renderer.setSize(this._renderSize.width,this._renderSize.height,!1),this._renderer.setPixelRatio(this._displayCanvasScaling)),this._composer.setPixelRatio(this._displayCanvasScaling,!1),this._composer.setSize(this._renderSize.width,this._renderSize.height),this._trackedTargets.forEach(r=>{const o=r,a=o.sizeMultiplier;if(a){const u=this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*a);o.setSize(u.width,u.height)}}),this.dispatchEvent({type:"resize"}),this._updated(),this.reset())}blit(e,t,{viewport:n,material:r,shader:o,pass:a,clear:u=!0}={}){const p=this._composer.copyPass,{renderToScreen:f,material:m,uniforms:y,clear:S}=p;r&&(p.material=r);const M=this._renderer.getViewport(new c.Ltg),P=this._renderer.autoClear,D=this._renderer.getRenderTarget();n&&this._renderer.setViewport(new c.Ltg().fromArray(n)),this._renderer.autoClear=!1,p.uniforms=p.material.uniforms,p.renderToScreen=!1,p.clear=u,qt(this._renderer,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!0,transmissionRender:!1},()=>{p.render(this._renderer,t??null,{texture:e},0,!1)}),p.renderToScreen=f,p.clear=S,p.material=m,p.uniforms=y,this._renderer.autoClear=P,n&&this._renderer.setViewport(M),this._renderer.setRenderTarget(D)}clearColor({r:e,g:t,b:n,a:r,target:o,depth:a=!0,stencil:u=!0}){var p;const f=this._renderer.getClearColor(new c.Ilk),m=this._renderer.getClearAlpha();this._renderer.setClearAlpha(r??m),this._renderer.setClearColor(new c.Ilk(e??f.r,t??f.g,n??f.b));const y=this._renderer.getRenderTarget(),S=this._renderer.getActiveCubeFace(),M=this._renderer.getActiveMipmapLevel();this._renderer.setRenderTarget((p=o)!==null&&p!==void 0?p:null),this._renderer.clear(!0,a,u),this._renderer.setRenderTarget(y,S,M),this._renderer.setClearColor(f),this._renderer.setClearAlpha(m)}renderModel(e,t){this._renderer.render(e.modelObject,t.cameraObject)}renderScene(e){const t=e.activeCamera;t&&this.renderModel(e,t)}_updated(){this.dispatchEvent({type:"update"})}render(){var e;this._passesNeedsUpdate&&this.refreshPasses();for(const t of this._passes)t.passObject.enabled&&((e=t.update)===null||e===void 0||e.call(t));this._composer.render(),this._frameCount+=1,this.dirty=!1}updateDirty(){this.dirty=this.dirty||this._passes.findIndex(e=>e.dirty)>=0}reset(){this._frameCount=0,this.dirty=!0}resetShadows(){this._renderer.shadowMap.needsUpdate=!0}refreshPasses(){if(!this._passesNeedsUpdate)return;this._passesNeedsUpdate=!1;const e=[];for(const t of this._pipeline){const n=this._passes.find(r=>r.passId===t);n?e.push(n.passObject):console.warn("Unable to find pass: ",t)}[...this._composer.passes].forEach(t=>this._composer.removePass(t)),e.forEach(t=>this._composer.addPass(t)),this._updated()}dispose(){this._renderer.dispose()}trackTarget(e){this._trackedTargets.push(e)}removeTrackedTarget(e){const t=this._trackedTargets.indexOf(e);t>=0&&this._trackedTargets.splice(t,1)}createTarget({sizeMultiplier:e,samples:t=0,encoding:n=c.rnI,type:r=c.ywz,format:o=c.wk1,depthBuffer:a=!0,depthTexture:u=!1,size:p,textureCount:f=1,...m}={},y=!0){this.isWebGL2||(t=0),e!==void 0&&p!==void 0&&console.error("Both sizeMultiplier and size are defined. sizeMultiplier will be ignored."),p=p||this._renderSize.clone().multiplyScalar(this._displayCanvasScaling*(e=e||1));const S=u?new c.$YQ(p.width,p.height,c.ywz):void 0,M=this.createTargetCustom(f>1?{width:p.width,height:p.height,count:f}:p,{samples:t,encoding:n,type:r,format:o,depthBuffer:a,depthTexture:S},f>1?c.kFz:c.dd2);return this._processNewTarget(M,e,y),this._setTargetOptions(M,m),M}_processNewTarget(e,t,n){return t!==void 0&&(e.sizeMultiplier=t),n&&this.trackTarget(e),e}disposeTarget(e){if(e){if(e.isTemporary)return this.releaseTempTarget(e);this.removeTrackedTarget(e),e.dispose()}}createTargetCustom({width:e,height:t,count:n},r={},o){var a;const u=this._processNewTarget;let p=[e,t];if(n&&n>1&&p.push(n),(o==null?void 0:o.prototype)===c.oAp.prototype){if(e!==t)throw"Width and height of cube render target must be equal";p=[e]}r={format:c.wk1,minFilter:c.wem,magFilter:c.wem,generateMipmaps:!1,type:c.ywz,encoding:c.rnI,...r};const f=[...p,r];return new class extends((a=o)!==null&&a!==void 0?a:c.dd2){constructor(...m){super(...m),Array.isArray(this.texture)?this.texture.forEach(y=>{y.encoding=r.encoding,y.toJSON=()=>({})}):this.texture.toJSON=()=>({})}clone(m=!0){if(this.isTemporary)throw"Cloning temporary render targets not supported";if(Array.isArray(this.texture))throw"Cloning multiple render targets not supported";const y=super.clone();return y.texture.isRenderTargetTexture=!0,u(y,this.sizeMultiplier||1,m)}}(...f)}getTempTarget(e={}){var t;const n=Pi(e);let r;return!((t=this._tempTargets[n])===null||t===void 0)&&t.length&&(r=this._tempTargets[n].pop()),r?this._setTargetOptions(r,e):(r=this.createTarget(e),this._processNewTempTarget(r,n)),r}_processNewTempTarget(e,t){return e.isTemporary=!0,e.targetKey=t,this._tempTargets[t]===void 0&&(this._tempTargets[t]=[]),e}releaseTempTarget(e){const t=e.targetKey;if(!t||!e.isTemporary)throw"Not a temp target";this._tempTargets[t].length>this.maxTempPerKey?e.dispose():this._tempTargets[t].push(e)}updateShaderProperties(e){return e.uniforms.frameCount?e.uniforms.frameCount.value=this.frameCount:console.warn("BaseRenderer: no uniform: frameCount"),this}_setTargetOptions(e,t){var n,r,o;e.texture.minFilter=(n=t.minFilter)!==null&&n!==void 0?n:c.wem,e.texture.magFilter=(r=t.magFilter)!==null&&r!==void 0?r:c.wem,e.texture.generateMipmaps=(o=t.generateMipmaps)!==null&&o!==void 0&&o,e.texture.generateMipmaps&&e.texture.minFilter===c.wem&&(e.texture.minFilter=c.FDw),e.texture.generateMipmaps||e.texture.minFilter!==c.FDw||(e.texture.minFilter=c.wem)}}function Pi(s={}){var e,t;return[s.sizeMultiplier,s.samples,s.encoding,s.type,s.format,s.depthBuffer,s.depthTexture,(e=s.size)===null||e===void 0?void 0:e.width,(t=s.size)===null||t===void 0?void 0:t.height].join(";")}const qn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function gt(){const s=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(qn[255&s]+qn[s>>8&255]+qn[s>>16&255]+qn[s>>24&255]+"-"+qn[255&e]+qn[e>>8&255]+"-"+qn[e>>16&15|64]+qn[e>>24&255]+"-"+qn[63&t|128]+qn[t>>8&255]+"-"+qn[t>>16&255]+qn[t>>24&255]+qn[255&n]+qn[n>>8&255]+qn[n>>16&255]+qn[n>>24&255]).toLowerCase()}function mi(s,e,t){return Math.max(e,Math.min(t,s))}function Ei(s,e,t){return(1-t)*s+t*e}const Rr=0,Xi=1,zi=3,Vi=4,Gi=1006,Vr="srgb",Di="srgb-linear";function gi(s){return s<.04045?.0773993808*s:Math.pow(.9478672986*s+.0521327014,2.4)}function br(s){return s<.0031308?12.92*s:1.055*Math.pow(s,.41666)-.055}const ar={[Vr]:{[Di]:gi},[Di]:{[Vr]:br}},Ki={legacyMode:!0,get workingColorSpace(){return Di},set workingColorSpace(s){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(s,e,t){if(this.legacyMode||e===t||!e||!t)return s;if(ar[e]&&ar[e][t]!==void 0){const n=ar[e][t];return s.r=n(s.r),s.g=n(s.g),s.b=n(s.b),s}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(s,e){return this.convert(s,this.workingColorSpace,e)},toWorkingColorSpace:function(s,e){return this.convert(s,e,this.workingColorSpace)}},Po={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},lr={r:0,g:0,b:0},cs={h:0,s:0,l:0},nr={h:0,s:0,l:0};function Es(s,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?s+6*(e-s)*t:t<.5?e:t<2/3?s+6*(e-s)*(2/3-t):s}function Do(s,e){return e.r=s.r,e.g=s.g,e.b=s.b,e}class Sn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t="srgb"){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Ki.toWorkingColorSpace(this,t),this}setRGB(e,t,n,r="srgb-linear"){return this.r=e,this.g=t,this.b=n,Ki.toWorkingColorSpace(this,r),this}setHSL(e,t,n,r="srgb-linear"){if(e=function(o,a){return(o%a+a)%a}(e,1),t=mi(t,0,1),n=mi(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o;this.r=Es(a,o,e+1/3),this.g=Es(a,o,e),this.b=Es(a,o,e-1/3)}return Ki.toWorkingColorSpace(this,r),this}setStyle(e,t="srgb"){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let o;const a=r[1],u=r[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Ki.toWorkingColorSpace(this,t),n(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Ki.toWorkingColorSpace(this,t),n(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(u)){const p=parseFloat(o[1])/360,f=parseFloat(o[2])/100,m=parseFloat(o[3])/100;return n(o[4]),this.setHSL(p,f,m,t)}}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=r[1],a=o.length;if(a===3)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Ki.toWorkingColorSpace(this,t),this;if(a===6)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Ki.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t="srgb"){const n=Po[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=gi(e.r),this.g=gi(e.g),this.b=gi(e.b),this}copyLinearToSRGB(e){return this.r=br(e.r),this.g=br(e.g),this.b=br(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e="srgb"){return Ki.fromWorkingColorSpace(Do(this,lr),e),mi(255*lr.r,0,255)<<16^mi(255*lr.g,0,255)<<8^mi(255*lr.b,0,255)<<0}getHexString(e="srgb"){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t="srgb-linear"){Ki.fromWorkingColorSpace(Do(this,lr),t);const n=lr.r,r=lr.g,o=lr.b,a=Math.max(n,r,o),u=Math.min(n,r,o);let p,f;const m=(u+a)/2;if(u===a)p=0,f=0;else{const y=a-u;switch(f=m<=.5?y/(a+u):y/(2-a-u),a){case n:p=(r-o)/y+(r<o?6:0);break;case r:p=(o-n)/y+2;break;case o:p=(n-r)/y+4}p/=6}return e.h=p,e.s=f,e.l=m,e}getRGB(e,t="srgb-linear"){return Ki.fromWorkingColorSpace(Do(this,lr),t),e.r=lr.r,e.g=lr.g,e.b=lr.b,e}getStyle(e="srgb"){return Ki.fromWorkingColorSpace(Do(this,lr),e),e!==Vr?`color(${e} ${lr.r} ${lr.g} ${lr.b})`:`rgb(${255*lr.r|0},${255*lr.g|0},${255*lr.b|0})`}offsetHSL(e,t,n){return this.getHSL(cs),cs.h+=e,cs.s+=t,cs.l+=n,this.setHSL(cs.h,cs.s,cs.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(cs),e.getHSL(nr);const n=Ei(cs.h,nr.h,t),r=Ei(cs.s,nr.s,t),o=Ei(cs.l,nr.l,t);return this.setHSL(n,r,o),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}function Ui(s,e){const t=e==="map";return{type:"folder",label:e+" Sampler",hidden:()=>!s[e],children:[()=>({type:"vec2",label:"Repeat",hidden:()=>!t&&s.map,bounds:[-100,100],stepSize:.001,property:[s[e],"repeat"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Offset",hidden:()=>!t&&s.map,bounds:[-2,2],property:[s[e],"offset"],onChange:s==null?void 0:s.setDirty}),()=>({type:"vec2",label:"Center",hidden:()=>!t&&s.map,bounds:[-2,2],property:[s[e],"center"],onChange:s==null?void 0:s.setDirty}),()=>({type:"input",label:"Rotation",hidden:()=>!t&&s.map,bounds:[-Math.PI,Math.PI],property:[s[e],"rotation"],onChange:s==null?void 0:s.setDirty}),()=>({type:"dropdown",label:"Encoding",property:[s[e],"encoding"],children:[["Linear",c.rnI],["sRGB",c.knz]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{const n=s[e];n&&(n.needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"checkbox",label:"Flip Y",getValue:()=>{var n,r;return(r=(n=s[e])===null||n===void 0?void 0:n.flipY)!==null&&r!==void 0&&r},setValue:n=>{var r;const o=s[e];if(o&&o.flipY!==n)if(o.image&&ImageBitmap&&o.image instanceof ImageBitmap){const a=o,u=o.source.data;createImageBitmap(u,{imageOrientation:"flipY"}).then(p=>{var f;u.close&&u.close(),a.flipY=n,a.source.data=p,a.source.needsUpdate=!0,a.needsUpdate=!0,(f=s==null?void 0:s.setDirty)===null||f===void 0||f.call(s)})}else o.flipY=n,o.needsUpdate=!0,(r=s==null?void 0:s.setDirty)===null||r===void 0||r.call(s)}}),()=>({type:"dropdown",label:"Wrap S",property:[s[e],"wrapS"],children:[["ClampToEdge",c.uWy],["MirroredRepeat",c.OoA],["Repeat",c.rpg]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Wrap T",property:[s[e],"wrapT"],children:[["ClampToEdge",c.uWy],["MirroredRepeat",c.OoA],["Repeat",c.rpg]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"input",label:"Anisotropy",bounds:[1,6],stepSize:1,property:[s[e],"anisotropy"],onChange:[()=>{s[e]&&(s[e].needsUpdate=!0),s.needsUpdate=!0},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Min Filter",property:[s[e],"minFilter"],children:[["Linear",Gi],["Nearest",c.TyD],["NearestMipmapNearest",c.YLQ],["NearestMipmapLinear",c.vZf],["LinearMipmapNearest",c.qyh],["LinearMipmapLinear",c.D1R]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]}),()=>({type:"dropdown",label:"Mag Filter",property:[s[e],"magFilter"],children:[["Linear",Gi],["Nearest",c.TyD]].map(n=>({label:n[0],value:n[1]})),onChange:[()=>{s[e]&&(s[e].needsUpdate=!0)},s==null?void 0:s.setDirty]})]}}Sn.NAMES=Po;const qr=["appliedMeshes","imageLoadAwaiter","inverseModelMatrix","uvTransform","uuid","iMaterial"];function Sr(s,e){if(e)for(const t of Object.keys(e))qr.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}const no=["appliedMaterials","uuid"];function Vs(s,e){if(e)for(const t of Object.keys(e))no.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}const _o=new Map;function et(s){return(e,t)=>{const n=e.constructor;if(n===Object)throw new Error("All properties in an object are serialized by default");_o.has(n)||_o.set(n,[]),_o.get(n).push([s||t,t])}}const _r={obj:(s,e)=>Object.fromEntries(Object.entries(s).map(([t,n])=>[t,cn(n,!1,e)])),vec4:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isVector4:!0}),vec3:s=>({x:s.x,y:s.y,z:s.z,isVector3:!0}),vec2:s=>({x:s.x,y:s.y,isVector2:!0}),color:s=>({r:s.r,g:s.g,b:s.b,isColor:!0}),quat:s=>({x:s.x,y:s.y,z:s.z,w:s.w,isQuaternion:!0}),texture:(s,e)=>{if(!(s!=null&&s.isTexture))throw new Error("Expected a texture");if(s.isRenderTargetTexture)return;if(e!=null&&e.textures[s.uuid])return{uuid:s.uuid,resource:"textures"};const t=s.source.data;s.userData.rootPath&&(s.source.data=null);const n=s.userData;s.userData={};let r=s.toJSON(e);return s.userData=n,r.userData=cn(Vs({},n),!1,e),s.userData.rootPath&&(delete e.images[s.source.uuid],s.source.data=t),e!=null&&e.textures&&(e.textures[r.uuid]||(e.textures[r.uuid]=r),r={uuid:r.uuid,resource:"textures"}),r},material:(s,e)=>{var t;if(!(s!=null&&s.isMaterial))throw new Error("Expected a material");if(e!=null&&e.materials[s.uuid])return{uuid:s.uuid,resource:"materials"};s.userData.rootPath&&console.error("TODO: handle material with root path with material inheritance/hierarchy");const n=e??{textures:{},images:{}},r={},o={};for(const[u,p]of Object.entries(s))if(!((t=p)===null||t===void 0)&&t.isTexture&&!u.startsWith("__")){const f=_r.texture(p,n);r[u]=f,o[u]=p,s[u]=f?{isTexture:!0,toJSON:()=>f}:null}let a=s.toJSON(e);for(const[u,p]of Object.entries(o))s[u]=p,delete o[u];if(e){for(const[u,p]of Object.entries(r))p&&(a[u]=p);e!=null&&e.materials&&(e.materials[a.uuid]||(e.materials[a.uuid]=a),a={uuid:a.uuid,resource:"materials"})}else{for(const[u,p]of Object.entries(r))a[u]=p.uuid;a.textures=Object.values(n.textures),a.images=Object.values(n.images)}return a}},Gs=s=>(e,t)=>{var n,r;return(r=(n=t==null?void 0:t.copy)===null||n===void 0?void 0:n.call(t,e))!==null&&r!==void 0?r:new s().copy(e)},ri={obj:(s,e,t)=>Object.assign(e,Object.fromEntries(Object.entries(s).map(([n,r])=>[n,kt(r,e==null?void 0:e[n],!1,t)]))),vec4:Gs(c.Ltg),vec3:Gs(c.Pa4),vec2:Gs(St),color:Gs(Sn),quat:Gs(c._fP)};function cn(s,e,t){var n,r;if(typeof s=="function")return;if(Array.isArray(s))return s.map(u=>cn(u,!1,t));if(typeof s!="object"){if(typeof s=="number"){if(s===1/0)return"Infinity";if(s===-1/0)return"-Infinity";if(isNaN(s))return"NaN"}return s}if(!s)return s;let o=(n=s.constructor)!==null&&n!==void 0?n:Object;if(o===Object)return _r.obj(s,t);if(s.isVector2)return _r.vec2(s);if(s.isVector3)return _r.vec3(s);if(s.isVector4)return _r.vec4(s);if(s.isColor)return _r.color(s);if(s.isQuaternion)return _r.quat(s);if(s.isTexture)return _r.texture(s,t);if(s.isMaterial)return _r.material(s,t);if(!e&&typeof s.toJSON=="function")return s.toJSON(t);const a={};for(;o&&o!==Object;)(r=_o.get(o))===null||r===void 0||r.forEach(([u,p])=>{const f=s[p];a[u]=cn(f,!1,t)}),o=Object.getPrototypeOf(o);return s.serializableClassId&&(a.serializableClassId=s.serializableClassId),a}function kt(s,e,t,n){var r,o,a;let u=e;if(s===void 0)return u;if(typeof e=="number"){if(s==="Infinity")return 1/0;if(s==="-Infinity")return-1/0;if(s==="NaN")return NaN;if(typeof s=="number"||!s)return s}if(Array.isArray(s)){const m=s.length;Array.isArray(u)||(u=[]);for(let y=0;y<m;y++){const S=s[y],M=u.length>y?kt(S,u[y],!1,n):kt(S,void 0,!1,n);u.length<=y?u.push(M):u[y]=M}return u}let p=!1;if(s&&s.resource&&typeof s.resource=="string"&&(s=(r=n[s.resource])===null||r===void 0?void 0:r[s.uuid],p=!0),!u&&s&&!p)if(s.serializableClassId){const m=Gn.get(s.serializableClassId);m&&(u=new m)}else typeof s!="object"||s.constructor&&s.constructor!==Object||(u={});if(typeof u=="function")return console.error("cannot deserialize over function",u,s),u;if(s&&typeof s=="object"&&!p){if(s.isVector2)return ri.vec2(s,u);if(s.isVector3)return ri.vec3(s,u);if(s.isVector4)return ri.vec4(s,u);if(s.isColor)return ri.color(s,u);if(s.isQuaternion)return ri.quat(s,u)}if(s==null||u==null||typeof u!="object"||u.isTexture)return p&&(s?s.__useCount=s.__useCount?s.__useCount+1:1:console.warn("probable error deserialize: resource not found.")),s;let f=(o=u.constructor)!==null&&o!==void 0?o:Object;if(f===Object)return ri.obj(s,u,n);if(!t&&typeof u.fromJSON=="function")return u.isMaterial&&(Object.entries(s).forEach(([m,y])=>{var S;if(!y||!y.resource||typeof y.resource!="string")return;const M=(S=n[y.resource])===null||S===void 0?void 0:S[y.uuid];s[m]=M||null}),s.userData&&(s.userData=kt(s.userData,void 0,!1,n))),u.fromJSON(s,n),u;for(;f&&f!==Object;)(a=_o.get(f))===null||a===void 0||a.forEach(([m,y])=>{const S=u[y],M=kt(s[m],S,!1,n);M!==S&&_e(u,y,M,!0)}),f=Object.getPrototypeOf(f);return u}const Gn=new Map;function Qn(s){return e=>(e=class extends e{constructor(){super(...arguments),this.serializableClassId=s}},Gn.set(s,e),e)}function Nn(s,e){if(s.uiConfig)return s.uiConfig;const t={type:"folder",label:s.name||"unnamed",expanded:!0,limitedUi:!0,children:[{type:"checkbox",label:"Visible",property:[s,"visible"],limitedUi:!0},{type:"button",label:"Pick/Focus",value:()=>{s.dispatchEvent({type:"select",ui:!0,value:s,focusCamera:!0})}},{type:"button",label:"Pick Parent",hidden:()=>!s.parent,value:()=>{const r=s.parent;r&&r.dispatchEvent({type:"select",ui:!0,value:r})}},{type:"input",label:"Name",property:[s,"name"]},{type:"checkbox",label:"Casts Shadow",hidden:()=>!s.isMesh,property:[s,"castShadow"]},{type:"checkbox",label:"Receive Shadow",hidden:()=>!s.isMesh,property:[s,"receiveShadow"]},{type:"vec3",label:"Position",property:[s,"position"],limitedUi:!0},{type:"vec3",label:"Rotation",property:[s,"rotation"],limitedUi:!0},{type:"vec3",label:"Scale",property:[s,"scale"]},{type:"button",label:"Auto Scale",prompt:["Auto Scale Radius: Object will be scaled to the given radius",s.userData.autoScaleRadius||"2",!0],value:r=>{if(!r)return;const o=parseFloat(r);Math.abs(o)>0&&vn(s,o)}},s.userData.license!==void 0?{type:"input",label:"License/Credits",property:[s.userData,"license"],limitedUi:!0}:{}]},n=s;if(n!=null&&n.isMesh&&e!==!1){const r=[()=>{var o;return(o=n.geometry)===null||o===void 0?void 0:o.uiConfig},()=>{var o;return Array.isArray(n.material)?n.material.length<1?void 0:{label:"Materials",type:"folder",children:n.material.map(a=>a==null?void 0:a.uiConfig).filter(a=>a)}:(o=n.material)===null||o===void 0?void 0:o.uiConfig}];t.children.push(...r)}if(s!=null&&s.isCamera){const r=[{type:"button",label:"Set View",value:()=>{s.dispatchEvent({type:"setView",ui:!0,camera:s})}},{type:"button",label:"Activate main",hidden:()=>{var o;return(o=s.userData.iCamera)===null||o===void 0?void 0:o.isActiveCamera},value:()=>{s.dispatchEvent({type:"activateMain",ui:!0,camera:s})}},{type:"button",label:"Deactivate main",hidden:()=>{var o;return!(!((o=s.userData.iCamera)===null||o===void 0)&&o.isActiveCamera)},value:()=>{s.dispatchEvent({type:"activateMain",ui:!0,camera:void 0})}}];t.children.push(...r)}return s.uiConfig=t,t}function ir(s,e,t){var n;if(!s)return void console.warn("setupIModel: object is undefined");if(s.__disposed&&(console.warn("re-init/re-add disposed object, things might not work as intended",s),delete s.__disposed),s.userData||(s.userData={}),s.userData.__iModelSetup&&s.modelObject)return s;s.userData.__iModelSetup=!0;let r=[];r.push(()=>{[...s.children].forEach(P=>{var D;(D=P==null?void 0:P.dispose)===null||D===void 0||D.call(P)}),s.children=[],s.parent&&s.removeFromParent()}),s.isLight&&!s.assetType?(s.assetType="light",s.lightObject=s):s.isCamera?(s.assetType="camera",s.cameraObject=s):s.assetType||(s.assetType="model"),s.modelObject||(s.modelObject=s),s.setDirty||(s.setDirty=(P={})=>{s.dispatchEvent({...P,type:"objectUpdate",object:s})},s.userData.setDirty&&console.warn("userData.setDirty already defined",s.userData.setDirty,s),s.userData.setDirty=P=>{var D;console.warn("userData.setDirty is deprecated, use setDirty directly"),(D=s.setDirty)===null||D===void 0||D.call(s,P)});const o=P=>{var D,j,k;const L=(j=(D=s.parent)===null||D===void 0?void 0:D.userData.parentRoot)!==null&&j!==void 0?j:s.parent;L!==s.userData.parentRoot&&s.traverse(R=>{R.userData.parentRoot=L}),(k=s.setDirty)===null||k===void 0||k.call(s,{change:"addedToParent"})},a=()=>{var P;(P=s.setDirty)===null||P===void 0||P.call(s,{change:"removedFromParent"}),s.userData.parentRoot!==void 0&&s.traverse(D=>{D.userData.parentRoot=void 0})};s.addEventListener("added",o),s.addEventListener("removed",a),r.push(()=>{s.removeEventListener("added",o),s.removeEventListener("removed",a)});const u=s.dispose;s.dispose=()=>{s.dispatchEvent({type:"dispose"}),u==null||u.call(s)},s.userData.dispose&&console.warn("userData.dispose already defined"),s.userData.dispose=()=>{var P;console.warn("userData.dispose is deprecated, use dispose directly"),(P=s.dispose)===null||P===void 0||P.call(s)};const p=s;!p.isMesh&&!p.isLine||p.userData.__meshSetup||(p.userData.__meshSetup=!0,p.setMaterial||(p.setMaterial=P=>di(p,P)),p.setGeometry||(p.setGeometry=(P,D=!1)=>Hi(p,P,D),p.setGeometry(p.geometry,!0)),s.userData.setMaterial&&console.warn("userData.setMaterial already defined"),s.userData.setMaterial=P=>{var D;console.warn("userData.setMaterial is deprecated, use setMaterial directly"),(D=s.setMaterial)===null||D===void 0||D.call(s,P)},s.userData.setGeometry&&console.warn("userData.setGeometry already defined"),s.userData.setGeometry=(P,...D)=>{var j;console.warn("userData.setGeometry is deprecated, use setGeometry directly"),(j=s.setGeometry)===null||j===void 0||j.call(s,P,...D)},s.userData.__keepShadowDef||(s.castShadow=!0,s.receiveShadow=!0,s.userData.__keepShadowDef=!0),r.push(()=>{var P,D;const j=((P=p.setMaterial)===null||P===void 0?void 0:P.call(p,void 0))||[],k=(D=p.setGeometry)===null||D===void 0?void 0:D.call(p,void 0);for(const L of j)L&&L.userData.__appliedMeshes.size===0&&L.userData.disposeOnIdle!==!1&&L.dispose();k&&k.userData.__appliedMeshes.size===0&&k.userData.disposeOnIdle!==!1&&k.dispose()})),s.uiConfig||s.assetType!=="model"&&s.assetType!=="camera"||(Nn(s),r.push(()=>{s.uiConfig=void 0}));const f=()=>{var P,D;return(D=(P=s.uiConfig)===null||P===void 0?void 0:P.uiRefresh)===null||D===void 0?void 0:D.call(P,"postFrame",!0,1)};s.addEventListener("objectUpdate",f),r.push(()=>s.removeEventListener("objectUpdate",f)),s.userData.__autoParentDispatchEvents?console.warn("object.userData.__autoParentDispatchEvents already set"):(s.userData.__autoParentDispatchEvents=s.userData.__autoParentDispatchEvents||["objectUpdate","materialUpdate","select"],s.isCamera&&s.userData.__autoParentDispatchEvents.push("activateMain","setView")),e&&(s.userData.parentRoot=e),r.push(()=>{delete s.userData.parentRoot});const m=s.dispatchEvent;s.dispatchEvent=P=>{var D;!((D=s.userData.__autoParentDispatchEvents)===null||D===void 0)&&D.includes(P.type)&&(P.parentDispatch=!0),P.parentDispatch&&(j=>{var k;const L=(k=s.userData.parentRoot)!==null&&k!==void 0?k:s.parent;L!=null&&L.modelObject&&L.dispatchEvent(j)})(P),m.call(s,P)},r.push(()=>{s.dispatchEvent=m});const y=s.clone;s.clone=(...P)=>{const D=s.userData;s.userData={};let j=y.call(s,...P);s.userData=D,vi(j.userData,D);const k=s.userData.parentRoot;return k&&k.assetType!=="model"&&console.warn("Cloning an object with a parent that is not an IModel is not supported"),j=ir(j,k,t),j.userData.cloneParent=s.uuid,j},r.push(()=>{s.clone=y});const S=s.copy;s.copy=(P,...D)=>{const j=P.userData;P.userData={};const k=S.call(s,P,...D);return P.userData=j,vi(s.userData,P),k},r.push(()=>{s.copy=S});const M=s.add;return s.add=(...P)=>(P.forEach(D=>ir(D,s.userData.parentRoot||s,t)),M.call(s,...P)),r.push(()=>{s.add=M}),s=(n=t==null?void 0:t(s))!==null&&n!==void 0?n:s,r.push(()=>{_e(s,"modelObject",void 0,!0),s.userData={}}),s.addEventListener("dispose",()=>{s.__disposed?console.warn("Object already disposed",s):(s.__disposed=!0,r.forEach(P=>P()),r=[])}),[...s.children].forEach(P=>ir(P,s,t)),s}function di(s,e){var t,n,r,o,a;const u=(Array.isArray(e)?e:[e]).map(m=>m==null?void 0:m.materialObject).filter(m=>m);if(s.material==u||u.length===1&&s.material===u[0])return[];s.userData.__materialUpdater||(s.userData.__materialUpdater=()=>{s.dispatchEvent({type:"materialUpdate"})});const p=Array.isArray(s.material)?[...s.material]:[s.material];for(const m of p)m&&(m.removeEventListener("materialUpdate",s.userData.__materialUpdater),(n=(t=m.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||n===void 0||n.delete(s));const f=[];for(const m of u)m.userData.__appliedMeshes||(m.userData.__appliedMeshes=new Set),f.push(m),m&&(m.addEventListener("materialUpdate",s.userData.__materialUpdater),m.userData.__appliedMeshes.add(s));return s.material=f.length!==1?f:(r=f[0])!==null&&r!==void 0?r:void 0,s.traverseAncestors(m=>{m.isRootScene&&m.refreshEnvMapIntensity(s)}),s.dispatchEvent({type:"materialChanged",material:e}),(a=(o=s.uiConfig)===null||o===void 0?void 0:o.uiRefresh)===null||a===void 0||a.call(o,"postFrame",!0),p}function Hi(s,e,t=!1){var n,r,o,a,u,p,f;s.userData.__objectUpdater||(s.userData.__objectUpdater=S=>{s.dispatchEvent({...S,type:"objectUpdate"})});let m=s.geometry;const y=m;return(m!==e||t)&&(m&&(m.removeEventListener("geometryUpdate",s.userData.__objectUpdater),(r=(n=m.userData)===null||n===void 0?void 0:n.__appliedMeshes)===null||r===void 0||r.delete(s)),m=e,m&&!m.userData.__appliedMeshes&&(m.userData.__appliedMeshes=new Set),s.geometry=(o=m)!==null&&o!==void 0?o:void 0,m&&(m.addEventListener("geometryUpdate",s.userData.__objectUpdater),(u=(a=m.userData)===null||a===void 0?void 0:a.__appliedMeshes)===null||u===void 0||u.add(s))),e&&!e.uiConfig&&(e.uiConfig=function(S){return{label:"Geometry",type:"folder",children:[{type:"input",property:[S,"uuid"],disabled:!0},{type:"button",label:"Create uv2 from uv",value:()=>{S.hasAttribute("uv2")&&!confirm("uv2 already exists, replace with uv data?")||S.setAttribute("uv2",S.getAttribute("uv"))}},{type:"input",label:"Mesh count",get value(){var M,P,D;return(D=(P=(M=S.userData)===null||M===void 0?void 0:M.__appliedMeshes)===null||P===void 0?void 0:P.size)!==null&&D!==void 0?D:0},set value(M){},disabled:!0}]}}(s.geometry)),s.dispatchEvent({type:"geometryChanged",geometry:e}),(f=(p=s.uiConfig)===null||p===void 0?void 0:p.uiRefresh)===null||f===void 0||f.call(p,"postFrame",!0),y===m?void 0:y||void 0}const rr=["appliedMeshes"],Qs=["parentRoot","iCamera","iModel"];function vi(s,e){if(e)for(const t of Object.keys(e))Qs.includes(t)||t.startsWith("__")||typeof s[t]!="function"&&typeof e[t]!="function"&&(s[t]=e[t]);return s}var Gr,vo=new Uint8Array(16);function sr(){if(!Gr&&!(Gr=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Gr(vo)}for(var Bi=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,pr=function(s){return typeof s=="string"&&Bi.test(s)},Ri=[],us=0;us<256;++us)Ri.push((us+256).toString(16).substr(1));var ki=function(s,e,t){var n=(s=s||{}).random||(s.rng||sr)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){t=t||0;for(var r=0;r<16;++r)e[t+r]=n[r];return e}return function(o){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=(Ri[o[a+0]]+Ri[o[a+1]]+Ri[o[a+2]]+Ri[o[a+3]]+"-"+Ri[o[a+4]]+Ri[o[a+5]]+"-"+Ri[o[a+6]]+Ri[o[a+7]]+"-"+Ri[o[a+8]]+Ri[o[a+9]]+"-"+Ri[o[a+10]]+Ri[o[a+11]]+Ri[o[a+12]]+Ri[o[a+13]]+Ri[o[a+14]]+Ri[o[a+15]]).toLowerCase();if(!pr(u))throw TypeError("Stringified UUID is invalid");return u}(n)};const fr=new Map;function wr(s,e){return(t,n)=>{const r=t.constructor;if(r===Object)throw new Error("All properties in an object are serialized by default");fr.has(r)||fr.set(r,[]);const o=fr.get(r);if(!(o.findIndex(a=>a.propKey===n)<0))throw new Error(`Property ${n} already has a uiConfig decorator`);o.push({params:e||{},propKey:n,uiType:s})}}function _n(s,e){return wr("checkbox",{label:s,params:e})}function ja(s,e){return wr("monitor",{label:s,params:e})}function wn(s,e,t,n){return wr("slider",{label:s,bounds:e,stepSize:t,params:n})}function Yr(s,e,t,n){return wr("vec",{label:s,bounds:e,stepSize:t,params:n})}function Ao(s,e,t){return wr("dropdown",{label:s,children:e,params:t})}function Ji(s,e){return wr("button",{label:s,params:e})}function Si(s,e){return wr("input",{label:s,params:e})}function dl(s,e){return wr("color",{label:s,params:e})}function Th(s,e){return wr("image",{label:s,params:e})}function Ql(s){let e=s==null?void 0:s.constructor;if(!s||!e)return[];const t=[],n=[];for(;e&&e!==Object;)n.push(e),e=Object.getPrototypeOf(e);return n.reverse().forEach(r=>{var o;(o=fr.get(r))===null||o===void 0||o.forEach(({params:a,propKey:u,uiType:p})=>{var f;let m;if(p||(m=(f=s[u])===null||f===void 0?void 0:f.uiConfig),m||(m={property:[s,u],type:p||"input"}),a){const y=typeof a.params=="function"?a.params(s):a.params||{};delete a.params,Object.assign(m,{...a,...y})}t.push(m)})}),t}function Ec(s,e,t={}){return{type:"folder",label:s,children:Ql(e),uuid:ki(),...t}}function Ci(s,e){return t=>class extends t{constructor(){super(...arguments),this.uiConfig=Ec(s,this,e||{})}}}const Ad={type:"change"},Sc={type:"start"},Hl={type:"end"};class Wl extends c.pBf{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new c.Pa4,this.minDistance=.01,this.maxDistance=1/0,this.autoPushTarget=!0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.maxZoomSpeed=1,this.dollyZoom=!1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:c.RsA.ROTATE,MIDDLE:c.RsA.DOLLY,RIGHT:c.RsA.PAN},this.touches={ONE:c.QmN.ROTATE,TWO:c.QmN.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return u.phi},this.getAzimuthalAngle=function(){return u.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(wt){wt.addEventListener("keydown",oi),this._domElementKeyEvents=wt},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(Ad),n.update(),o=r.NONE},this.update=function(){const wt=new c.Pa4,Zt=new c._fP().setFromUnitVectors(e.up,new c.Pa4(0,1,0)),en=Zt.clone().invert(),li=new c.Pa4,dr=new c._fP,Ce=2*Math.PI;return function(){const Je=n.object.position;wt.copy(Je).sub(n.target),wt.applyQuaternion(Zt),u.setFromVector3(wt),n.autoRotate&&o===r.NONE&&he(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(u.theta+=p.theta*n.dampingFactor,u.phi+=p.phi*n.dampingFactor):(u.theta+=p.theta,u.phi+=p.phi);let Te=n.minAzimuthAngle,it=n.maxAzimuthAngle;isFinite(Te)&&isFinite(it)&&(Te<-Math.PI?Te+=Ce:Te>Math.PI&&(Te-=Ce),it<-Math.PI?it+=Ce:it>Math.PI&&(it-=Ce),u.theta=Te<=it?Math.max(Te,Math.min(it,u.theta)):u.theta>(Te+it)/2?Math.max(Te,u.theta):Math.min(it,u.theta)),u.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,u.phi)),u.makeSafe(),Math.abs(p.radius)>0&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*(1+p.radius*(n.enableDamping?n.dampingFactor:1)))),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(p.radius=0)),u.radius*=1+p.radius*(n.enableDamping?n.dampingFactor:1)),Math.abs(f-1)>1e-5&&(n.dollyZoom&&(n.object.zoom=Math.max(Math.max(n.minZoom,.1),Math.min(Math.min(n.maxZoom,20),n.object.zoom*f)),n.object.updateProjectionMatrix(),(n.object.zoom>=Math.min(n.maxZoom,20)||n.object.zoom<=Math.max(n.minZoom,.1))&&(f=1)),u.radius*=f);let ht=0;n.autoPushTarget&&u.radius<n.minDistance&&(ht=n.minDistance-u.radius),u.radius=Math.max(n.minDistance,Math.min(n.maxDistance,u.radius)),n.enableDamping===!0?n.target.addScaledVector(m,n.dampingFactor):n.target.add(m),wt.setFromSpherical(u),wt.applyQuaternion(en),Je.copy(n.target).add(wt),n.target.add(wt.normalize().multiplyScalar(-ht)),n.object.lookAt(n.target);let nt=!1;return n.enableDamping===!0&&Math.abs(p.theta)+Math.abs(p.phi)+Math.abs(p.radius)+m.length()>.001?(p.theta*=1-n.dampingFactor,p.phi*=1-n.dampingFactor,p.radius*=1-n.dampingFactor,m.multiplyScalar(1-n.dampingFactor),nt=!0):(p.set(0,0,0),m.set(0,0,0)),f=1,!!(y||nt||li.distanceToSquared(n.object.position)>a||8*(1-dr.dot(n.object.quaternion))>a)&&(n.dispatchEvent(Ad),li.copy(n.object.position),dr.copy(n.object.quaternion),y=!1,!0)}}(),this.stopDamping=function(){p.set(0,0,0),m.set(0,0,0)},this.dispose=function(){n.domElement.removeEventListener("contextmenu",xi),n.domElement.removeEventListener("pointerdown",Kt),n.domElement.removeEventListener("pointercancel",Mn),n.domElement.removeEventListener("wheel",Rt),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",tn),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",oi)};const n=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=r.NONE;const a=1e-6,u=new c.$V,p=new c.$V(0,0,0);let f=1;const m=new c.Pa4;let y=!1;const S=new c.FM8,M=new c.FM8,P=new c.FM8,D=new c.FM8,j=new c.FM8,k=new c.FM8,L=new c.FM8,R=new c.FM8,W=new c.FM8,q=[],J={};function ee(){return n.enableDamping?1:Math.pow(.95,n.zoomSpeed)}function he(wt){p.theta-=wt}function xe(wt){p.phi-=wt}this.rotateUp=xe,this.rotateLeft=he;const De=function(){const wt=new c.Pa4;return function(Zt,en){wt.setFromMatrixColumn(en,0),wt.multiplyScalar(-Zt),m.add(wt)}}(),Fe=function(){const wt=new c.Pa4;return function(Zt,en){n.screenSpacePanning===!0?wt.setFromMatrixColumn(en,1):(wt.setFromMatrixColumn(en,0),wt.crossVectors(n.object.up,wt)),wt.multiplyScalar(Zt),m.add(wt)}}(),ke=function(){const wt=new c.Pa4;return function(Zt,en){const li=n.domElement;if(n.object.isPerspectiveCamera){const dr=n.object.position;wt.copy(dr).sub(n.target);let Ce=wt.length();Ce*=Math.tan(n.object.fov/2*Math.PI/180),De(2*Zt*Ce/li.clientHeight,n.object.matrix),Fe(2*en*Ce/li.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(De(Zt*(n.object.right-n.object.left)/n.object.zoom/li.clientWidth,n.object.matrix),Fe(en*(n.object.top-n.object.bottom)/n.object.zoom/li.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function Qe(wt,Zt=0){n.object.isPerspectiveCamera?(f/=wt,p.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,p.radius-Zt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*wt)),n.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function Oe(wt,Zt=0){n.object.isPerspectiveCamera?(f*=wt,p.radius=Math.max(-n.maxZoomSpeed,Math.min(n.maxZoomSpeed,p.radius+Zt))):n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/wt)),n.object.updateProjectionMatrix(),y=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function ze(wt){S.set(wt.clientX,wt.clientY)}function $e(wt){D.set(wt.clientX,wt.clientY)}function Ge(){if(q.length===1)S.set(q[0].pageX,q[0].pageY);else{const wt=.5*(q[0].pageX+q[1].pageX),Zt=.5*(q[0].pageY+q[1].pageY);S.set(wt,Zt)}}function ot(){if(q.length===1)D.set(q[0].pageX,q[0].pageY);else{const wt=.5*(q[0].pageX+q[1].pageX),Zt=.5*(q[0].pageY+q[1].pageY);D.set(wt,Zt)}}function yt(){const wt=q[0].pageX-q[1].pageX,Zt=q[0].pageY-q[1].pageY,en=Math.sqrt(wt*wt+Zt*Zt);L.set(0,en)}function Mt(wt){if(q.length==1)M.set(wt.pageX,wt.pageY);else{const en=gr(wt),li=.5*(wt.pageX+en.x),dr=.5*(wt.pageY+en.y);M.set(li,dr)}P.subVectors(M,S).multiplyScalar(n.rotateSpeed);const Zt=n.domElement;he(2*Math.PI*P.x/Zt.clientHeight),xe(2*Math.PI*P.y/Zt.clientHeight),S.copy(M)}function pt(wt){if(q.length===1)j.set(wt.pageX,wt.pageY);else{const Zt=gr(wt),en=.5*(wt.pageX+Zt.x),li=.5*(wt.pageY+Zt.y);j.set(en,li)}k.subVectors(j,D).multiplyScalar(n.panSpeed),ke(k.x,k.y),D.copy(j)}function Qt(wt){const Zt=gr(wt),en=wt.pageX-Zt.x,li=wt.pageY-Zt.y,dr=Math.sqrt(en*en+li*li);R.set(0,dr),W.set(0,Math.pow(R.y/L.y,n.zoomSpeed)),Qe(W.y),L.copy(R)}function Kt(wt){n.enabled!==!1&&(q.length===0&&(n.domElement.setPointerCapture(wt.pointerId),n.domElement.addEventListener("pointermove",Jt),n.domElement.addEventListener("pointerup",tn)),function(Zt){q.push(Zt)}(wt),wt.pointerType==="touch"?function(Zt){switch(Yi(Zt),q.length){case 1:switch(n.touches.ONE){case c.QmN.ROTATE:if(n.enableRotate===!1)return;Ge(),o=r.TOUCH_ROTATE;break;case c.QmN.PAN:if(n.enablePan===!1)return;ot(),o=r.TOUCH_PAN;break;default:o=r.NONE}break;case 2:switch(n.touches.TWO){case c.QmN.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;n.enableZoom&&yt(),n.enablePan&&ot(),o=r.TOUCH_DOLLY_PAN;break;case c.QmN.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;n.enableZoom&&yt(),n.enableRotate&&Ge(),o=r.TOUCH_DOLLY_ROTATE;break;default:o=r.NONE}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(Sc)}(wt):function(Zt){let en;switch(Zt.button){case 0:en=n.mouseButtons.LEFT;break;case 1:en=n.mouseButtons.MIDDLE;break;case 2:en=n.mouseButtons.RIGHT;break;default:en=-1}switch(en){case c.RsA.DOLLY:if(n.enableZoom===!1)return;(function(li){L.set(li.clientX,li.clientY)})(Zt),o=r.DOLLY;break;case c.RsA.ROTATE:if(Zt.ctrlKey||Zt.metaKey||Zt.shiftKey){if(n.enablePan===!1)return;$e(Zt),o=r.PAN}else{if(n.enableRotate===!1)return;ze(Zt),o=r.ROTATE}break;case c.RsA.PAN:if(Zt.ctrlKey||Zt.metaKey||Zt.shiftKey){if(n.enableRotate===!1)return;ze(Zt),o=r.ROTATE}else{if(n.enablePan===!1)return;$e(Zt),o=r.PAN}break;default:o=r.NONE}o!==r.NONE&&n.dispatchEvent(Sc)}(wt))}function Jt(wt){n.enabled!==!1&&(wt.pointerType==="touch"?function(Zt){switch(Yi(Zt),o){case r.TOUCH_ROTATE:if(n.enableRotate===!1)return;Mt(Zt),n.update();break;case r.TOUCH_PAN:if(n.enablePan===!1)return;pt(Zt),n.update();break;case r.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;(function(en){n.enableZoom&&Qt(en),n.enablePan&&pt(en)})(Zt),n.update();break;case r.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;(function(en){n.enableZoom&&Qt(en),n.enableRotate&&Mt(en)})(Zt),n.update();break;default:o=r.NONE}}(wt):function(Zt){switch(o){case r.ROTATE:if(n.enableRotate===!1)return;(function(en){M.set(en.clientX,en.clientY),P.subVectors(M,S).multiplyScalar(n.rotateSpeed);const li=n.domElement;he(2*Math.PI*P.x/li.clientHeight),xe(2*Math.PI*P.y/li.clientHeight),S.copy(M),n.update()})(Zt);break;case r.DOLLY:if(n.enableZoom===!1)return;(function(en){R.set(en.clientX,en.clientY),W.subVectors(R,L),W.y>0?Qe(ee()):W.y<0&&Oe(ee()),L.copy(R),n.update()})(Zt);break;case r.PAN:if(n.enablePan===!1)return;(function(en){j.set(en.clientX,en.clientY),k.subVectors(j,D).multiplyScalar(n.panSpeed),ke(k.x,k.y),D.copy(j),n.update()})(Zt)}}(wt))}function tn(wt){ai(wt),q.length===0&&(n.domElement.releasePointerCapture(wt.pointerId),n.domElement.removeEventListener("pointermove",Jt),n.domElement.removeEventListener("pointerup",tn)),n.dispatchEvent(Hl),o=r.NONE}function Mn(wt){ai(wt)}function Rt(wt){n.enabled!==!1&&n.enableZoom!==!1&&o===r.NONE&&(wt.preventDefault(),n.dispatchEvent(Sc),function(Zt){let en=0;switch(Zt.deltaMode){case 2:en+=1*Zt.deltaY;break;case 1:en+=.4*Zt.deltaY;break;default:en+=.01*Zt.deltaY}Zt.deltaY<0?Oe(1,en*n.zoomSpeed):Zt.deltaY>0&&Qe(1,-en*n.zoomSpeed),n.update()}(wt),n.dispatchEvent(Hl))}function oi(wt){n.enabled!==!1&&n.enablePan!==!1&&function(Zt){let en=!1;switch(Zt.code){case n.keys.UP:ke(0,n.keyPanSpeed),en=!0;break;case n.keys.BOTTOM:ke(0,-n.keyPanSpeed),en=!0;break;case n.keys.LEFT:ke(n.keyPanSpeed,0),en=!0;break;case n.keys.RIGHT:ke(-n.keyPanSpeed,0),en=!0}en&&(Zt.preventDefault(),n.update())}(wt)}function xi(wt){n.enabled!==!1&&wt.preventDefault()}function ai(wt){delete J[wt.pointerId];for(let Zt=0;Zt<q.length;Zt++)if(q[Zt].pointerId==wt.pointerId)return void q.splice(Zt,1)}function Yi(wt){let Zt=J[wt.pointerId];Zt===void 0&&(Zt=new c.FM8,J[wt.pointerId]=Zt),Zt.set(wt.pageX,wt.pageY)}function gr(wt){const Zt=wt.pointerId===q[0].pointerId?q[1]:q[0];return J[Zt.pointerId]}this.zoomIn=function(wt){Qe(1,wt*n.zoomSpeed)},this.zoomOut=function(wt){Oe(1,wt*n.zoomSpeed)},n.domElement.addEventListener("contextmenu",xi),n.domElement.addEventListener("pointerdown",Kt),n.domElement.addEventListener("pointercancel",Mn),n.domElement.addEventListener("wheel",Rt,{passive:!1}),this.update()}}var cr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let $i=class extends Wl{constructor(){super(...arguments),this.type="OrbitControls",this.enabled=!0,this.dollyZoom=!1,this.enableDamping=!0,this.dampingFactor=.08,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableZoom=!0,this.zoomSpeed=.15,this.maxZoomSpeed=.2,this.enableRotate=!0,this.rotateSpeed=2,this.enablePan=!0,this.panSpeed=1,this.autoPushTarget=!1,this.minDistance=.35,this.maxDistance=1e3,this.minZoom=.01,this.maxZoom=1e3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1e4,this.maxAzimuthAngle=1e4,this.screenSpacePanning=!0,this.keyPanSpeed=7}zoomIn(s){super.zoomIn(s)}zoomOut(s){super.zoomOut(s)}dispatchEvent(s){super.dispatchEvent(s)}};cr([et()],$i.prototype,"type",void 0),cr([_n()],$i.prototype,"enabled",void 0),cr([_n(),et()],$i.prototype,"dollyZoom",void 0),cr([_n(),et()],$i.prototype,"enableDamping",void 0),cr([Si(),et()],$i.prototype,"dampingFactor",void 0),cr([_n(),et()],$i.prototype,"autoRotate",void 0),cr([Si(),et()],$i.prototype,"autoRotateSpeed",void 0),cr([_n(),et()],$i.prototype,"enableZoom",void 0),cr([Si(),et()],$i.prototype,"zoomSpeed",void 0),cr([Si(),et()],$i.prototype,"maxZoomSpeed",void 0),cr([_n(),et()],$i.prototype,"enableRotate",void 0),cr([Si(),et()],$i.prototype,"rotateSpeed",void 0),cr([_n(),et()],$i.prototype,"enablePan",void 0),cr([Si(),et()],$i.prototype,"panSpeed",void 0),cr([Si(),et()],$i.prototype,"autoPushTarget",void 0),cr([Si(),et()],$i.prototype,"minDistance",void 0),cr([Si(),et()],$i.prototype,"maxDistance",void 0),cr([Si(),et()],$i.prototype,"minZoom",void 0),cr([Si(),et()],$i.prototype,"maxZoom",void 0),cr([Si(),et()],$i.prototype,"minPolarAngle",void 0),cr([Si(),et()],$i.prototype,"maxPolarAngle",void 0),cr([Si(),et()],$i.prototype,"minAzimuthAngle",void 0),cr([Si(),et()],$i.prototype,"maxAzimuthAngle",void 0),cr([et()],$i.prototype,"screenSpacePanning",void 0),cr([et()],$i.prototype,"keyPanSpeed",void 0),$i=cr([Ci("Orbit Controls")],$i);var pl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class yo extends w{constructor(e,t,n){super(),this._controlsMode="",this._isActiveCamera=!1,this.userData={},this._cameraObjectUpdate=a=>{this.setDirty(a)},this._interactionsEnabled=!0,this.autoLookAtTarget=!0,this.near=.01,this.far=50,this._options={type:"PerspectiveCamera",aspect:"auto",focus:10,fov:25,zoom:1,frustumSize:1,top:1,bottom:-1,left:-1,right:1,controlsMode:"orbit",controlsEnabled:!0},this._position=new c.Pa4(0,0,10),this._target=new c.Pa4(0,0,0),this._controlsCtors=new Map([["orbit",(a,u)=>{const p=new $i(a,u.ownerDocument?u:u.documentElement);return p.screenSpacePanning=!0,p}]]),this._camUi=[{type:"vec3",label:"Position",property:[this,"position"],onChange:()=>this.positionUpdated(!0)},{type:"vec3",label:"Target",property:[this,"target"],onChange:()=>this.targetUpdated(!0)},{type:"slider",bounds:[1,180],label:"Field Of View",hidden:()=>!this._camera.modelObject.isPerspectiveCamera,property:[this._options,"fov"],onChange:()=>{this.refreshCameraOptions()},limitedUi:!0},{type:"slider",bounds:[.001,20],label:"Zoom",property:[this._options,"zoom"],onChange:()=>{this.refreshCameraOptions()}},()=>({type:"dropdown",label:"Controls Mode",property:[this._options,"controlsMode"],children:["","orbit","firstPerson","pointerLock",...this._controlsCtors.keys()].map(a=>({label:a===""?"none":a,value:a})),onChange:()=>{this.refreshCameraOptions()}})],this.uiConfig={type:"folder",label:"Camera",limitedUi:!0,children:[...this._camUi,()=>{var a;return(a=this._controls)===null||a===void 0?void 0:a.uiConfig},()=>{var a;return!((a=this._controls)===null||a===void 0)&&a.zoomIn?{type:"button",label:"Zoom in",value:()=>{var u;(u=this._controls)===null||u===void 0||u.zoomIn(1)}}:{}},()=>{var a;return!((a=this._controls)===null||a===void 0)&&a.zoomOut?{type:"button",label:"Zoom out",value:()=>{var u;(u=this._controls)===null||u===void 0||u.zoomOut(1)}}:{}}]},this.assetType="model",this.uuid=gt(),this.setDirty=this.setDirty.bind(this),this.targetUpdated=this.targetUpdated.bind(this),this._refreshCameraOptions=this._refreshCameraOptions.bind(this),this._container=n??document.body;const r=t??this._options;this._camera=this._setCameraObject(e??(r.type==="OrthographicCamera"?new c.iKG(-1,1,1,-1):new c.cPb)),this._camera.modelObject.userData.iCamera=this;const o=e;e&&(o.isPerspectiveCamera?(r.fov=o.fov,r.focus=o.focus,r.aspect=o.aspect<=0||o.userData.autoAspect?"auto":o.aspect,r.zoom=o.zoom):o.isOrthographicCamera&&(r.left=o.left,r.right=o.right,r.top=o.top,r.bottom=o.bottom,r.zoom=o.zoom),r.near=o.near,r.far=o.far,this._position.copy(e.position),this.refreshTarget()),this.positionUpdated(!1),e||this.targetUpdated(!1),this.setCameraOptions(r)}get controls(){return this._controls}getControls(){return this._controls}get isActiveCamera(){return this._isActiveCamera}get target(){return this._target}set target(e){const t=this._target.sub(e).length()>1e-5;this._target.copy(e),t&&this.targetUpdated()}get position(){return this._position}set position(e){const t=this._position.sub(e).length()>1e-5;this._position.copy(e),t&&this.positionUpdated()}get name(){return this._camera.name}set name(e){this._camera.name=e}getCameraOptions(){return{...this._options,position:this._position.toArray(),target:this._target.toArray()}}setCameraOptions(e,t=!0){var n,r;const o={...e};!((n=o.position)===null||n===void 0)&&n.isVector3&&(o.position=[o.position.x,o.position.y,o.position.z]),!((r=o.target)===null||r===void 0)&&r.isVector3&&(o.target=[o.target.x,o.target.y,o.target.z]),Object.keys(o).forEach(a=>a!=="frustumSize"&&o[a]===void 0&&delete o[a]),Object.assign(this._options,o),this._refreshCameraOptions(!1),this.refreshCameraControls(!1),t&&this.setDirty()}_refreshCameraOptions(e=!0){let t=this._camera.modelObject;if(this._options.type!==t.type){const r=this._options.type==="PerspectiveCamera"?new c.cPb:new c.iKG;r.name=this._camera.name,r.near=this._camera.modelObject.near,r.far=this._camera.modelObject.far,r.zoom=this._camera.modelObject.zoom,r.scale.copy(this._camera.modelObject.scale);const o=this._isActiveCamera;o&&this.deactivateMain(),this._camera=this._setCameraObject(r),t=this._camera.modelObject,o&&this.activateMain(),this._camera.modelObject.updateProjectionMatrix()}let n=this._options.aspect;if(n==="auto"&&(n=this._container.clientWidth/this._container.clientHeight),this._options.position&&(this.position.set(...this._options.position),delete this._options.position),this._options.target&&(this.target.set(...this._options.target),delete this._options.target),this.positionTargetUpdated(!1),this._options.type==="PerspectiveCamera"&&(t.fov=this._options.fov,t.focus=this._options.focus,t.aspect=n),this._options.type==="OrthographicCamera"){const r=this._options.frustumSize;r!==void 0?(t.top=r/2,t.bottom=-r/2,t.left=n*r/2,t.right=-n*r/2):(t.top=this._options.top,t.bottom=this._options.bottom,t.left=this._options.left,t.right=this._options.right)}t.zoom=this._options.zoom,this._nearFarChanged(),e&&this.setDirty()}_setCameraObject(e){return this._camera&&this._camera.removeEventListener("objectUpdate",this._cameraObjectUpdate),this._camera=ir(e),this._camera.addEventListener("objectUpdate",this._cameraObjectUpdate),this._camera}get interactionsEnabled(){return this._interactionsEnabled&&this._isActiveCamera&&this._options.controlsEnabled}set interactionsEnabled(e){this._interactionsEnabled!==e&&(this._interactionsEnabled=e,this.refreshCameraControls(!0))}_nearFarChanged(){this._camera&&(this._camera.modelObject.near=this.near,this._camera.modelObject.far=this.far,this._camera.modelObject.updateProjectionMatrix())}refreshAspect(e=!0){this._options.aspect==="auto"&&this._refreshCameraOptions(e)}refreshTarget(){var e;!((e=this._controls)===null||e===void 0)&&e.enabled&&this._controls.target?this._target.copy(this._controls.target):this._target.set(0,0,-1).applyQuaternion(this._camera.modelObject.getWorldQuaternion(new c._fP))}setControlsCtor(e,t,n=!1){n||!this._controlsCtors.has(e)?this._controlsCtors.set(e,t):console.error(e+" already exists.")}removeControlsCtor(e){this._controlsCtors.delete(e)}_initCameraControls(){var e,t,n;const r=this._options.controlsMode;this._controls=(t=(e=this._controlsCtors.get(r))===null||e===void 0?void 0:e(this._camera.modelObject,this._container))!==null&&t!==void 0?t:void 0,this._controls||console.error("Unable to create controls with mode "+r+". Are you missing a plugin?"),(n=this._controls)===null||n===void 0||n.addEventListener("change",this.setDirty),this._controlsMode=this._controls?r:""}_disposeCameraControls(){var e,t;this._controlsMode,(e=this._controls)===null||e===void 0||e.removeEventListener("change",this.setDirty),(t=this._controls)===null||t===void 0||t.dispose(),this._controlsMode="",this._controls=void 0}refreshCameraControls(e=!0){var t,n;if(this._options.controlsEnabled){const r=this._options.controlsMode;this._controls?this._controlsMode===r&&this._camera.modelObject===this._controls.object||(this._disposeCameraControls(),this._initCameraControls()):this._initCameraControls(),this._controlsMode=r}if(this._controls){const r=this.interactionsEnabled;this._controls.enabled=r,r&&this._camera.modelObject.up.copy(c.Tme.DefaultUp)}e&&this.setDirty(),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}setDirty(e){this._position.copy(this._camera.modelObject.position),this._controls&&this._controls.enabled&&this._controls.target&&this._target.copy(this._controls.target),this._camera.modelObject.fov!==void 0&&(this._options.fov=this._camera.modelObject.fov),this._camera.modelObject.focus!==void 0&&(this._options.focus=this._camera.modelObject.focus),this._camera.modelObject.zoom!==void 0&&(this._options.zoom=this._camera.modelObject.zoom),this.dispatchEvent({...e,type:"update"}),this._camUi.forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)===null||n===void 0?void 0:n.call(t,"postFrame",!1,1)})}activateMain(e=!0){var t,n;this._isActiveCamera||(this._isActiveCamera=!0,this._camera.modelObject.userData.__lastScale=this._camera.modelObject.scale.clone(),this._camera.modelObject.scale.divide(this._camera.modelObject.getWorldScale(new c.Pa4)),e&&(this.refreshCameraControls(!0),this.refreshAspect()),(n=(t=this._camera).setDirty)===null||n===void 0||n.call(t,{change:"activateMain"}))}deactivateMain(e=!0){this._isActiveCamera&&(this._isActiveCamera=!1,this._camera.modelObject.userData.__lastScale&&(this._camera.modelObject.scale.copy(this._camera.modelObject.userData.__lastScale),delete this._camera.modelObject.userData.__lastScale),e&&this.refreshCameraControls(!0))}get cameraObject(){return this._camera.modelObject}get modelObject(){return this._camera.modelObject}dispose(){this._disposeCameraControls()}targetUpdated(e=!0){var t,n;const r=this.target;(n=(t=this._controls)===null||t===void 0?void 0:t.target)===null||n===void 0||n.set(r.x,r.y,r.z),this._controls&&this._controls.enabled&&this._controls.target?e&&this.setDirty():this._camera&&(this.autoLookAtTarget&&this._camera.modelObject.lookAt(r),e&&this.setDirty())}positionUpdated(e=!0){const t=this.position;this._camera.modelObject.position.set(t.x,t.y,t.z),e&&this.setDirty()}positionTargetUpdated(e=!0){this.positionUpdated(!1),this.targetUpdated(e)}copyFromCamera(e,t=4){e.getWorldPosition(this._position),e.getWorldDirection(this._target).multiplyScalar(t).add(this._position),this.positionTargetUpdated(!1),this.setCameraOptions({fov:e.fov,focus:e.focus,zoom:e.zoom,type:e.type},!0)}updateShaderProperties(e){var t;return!((t=e.uniforms.cameraPositionWorld)===null||t===void 0)&&t.value&&this._camera.modelObject.getWorldPosition(e.uniforms.cameraPositionWorld.value),e.uniforms.cameraNearFar?e.uniforms.cameraNearFar.value.set(this._camera.modelObject.near,this._camera.modelObject.far):console.warn("BaseRenderer: no uniform: cameraNearFar"),e.uniforms.projection&&(e.uniforms.projection.value=this._camera.modelObject.projectionMatrix),e.defines.PERSPECTIVE_CAMERA=this._camera.modelObject.type==="PerspectiveCamera"?"1":"0",e.defines.ORTHOGRAPHIC_CAMERA=this._camera.modelObject.type==="OrthographicCamera"?"1":"0",this}toJSON(e){return Object.assign({},cn(this,!0,e))}fromJSON(e,t){return kt(e,this,!0,t),this.positionTargetUpdated(!1),this.refreshCameraOptions(),this.setDirty(),this}refreshCameraOptions(e=!0){this.setCameraOptions(this._options,e)}get visible(){return!0}set visible(e){console.error("Cannot set visible on camera",e)}}pl([et("camControls")],yo.prototype,"_controls",void 0),pl([et()],yo.prototype,"userData",void 0),pl([we(yo.prototype._nearFarChanged)],yo.prototype,"near",void 0),pl([we(yo.prototype._nearFarChanged)],yo.prototype,"far",void 0),pl([et("camOptions")],yo.prototype,"_options",void 0),pl([et("position")],yo.prototype,"_position",void 0),pl([et("target")],yo.prototype,"_target",void 0);var yd=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Cc extends c.xsS{constructor(e){super(),this.isRootScene=!0,this.assetType="model",this._sceneBounds=new _t,this._sceneBoundingRadius=0,this._cameras=[],this._activeCamera=-1,this.envMapIntensity=1,this._dummyCam=new yo(new c.cPb,{controlsMode:"",controlsEnabled:!1}),this.environment=null,this.background=null,this.minNearDistance=.2,this.setDirty=this.setDirty.bind(this),this.updateScene=this.updateScene.bind(this),this.refreshActiveCameraNearFar=this.refreshActiveCameraNearFar.bind(this),this._activeCameraUpdate=this._activeCameraUpdate.bind(this),this._onSceneMaterialUpdate=this._onSceneMaterialUpdate.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this.addEventListener("materialUpdate",this._onSceneMaterialUpdate),this.addEventListener("objectUpdate",this._onSceneUpdate),this.defaultCamera=e,this.modelRoot=ir(new c.ZAu,void 0),this.modelRoot.userData.rootSceneModelRoot=!0,this.modelRoot.name="Scene",this.modelRoot.addEventListener("update",this.setDirty),this.addSceneObject(this.modelRoot,{addToRoot:!0,autoScale:!1}),this.addSceneObject(this.defaultCamera,{addToRoot:!0}),this.activeCamera=this.defaultCamera,this.boxHelper=new c.GQ(this.getBounds())}refreshEnvMapIntensity(e){return e!=null&&e.isObject3D||(e=this),(e??this).traverse(t=>{(Array.isArray(t.material)?t.material:[t.material]).forEach(n=>{n&&n.envMapIntensity!==void 0&&!n.userData.separateEnvMapIntensity&&(n.envMapIntensity=this.envMapIntensity,n.needsUpdate=!0)})}),this.setDirty(),this}get activeCamera(){return this._activeCamera>=0?this._cameras[this._activeCamera]:this._dummyCam}set activeCamera(e){const t=this.activeCamera;if(e||(e=this.defaultCamera),t!==e){if(t&&(t.deactivateMain(),t.removeEventListener("update",this._activeCameraUpdate)),e){e.activateMain(),e.addEventListener("update",this._activeCameraUpdate);let n=this._cameras.indexOf(e);n<0&&(this._cameras.push(e),n=this._cameras.length-1),this._activeCamera=n}else this._activeCamera=-1;this.dispatchEvent({type:"activeCameraChange",lastCamera:t,camera:e}),this.setDirty()}}get modelObject(){return this}addModel(e,t={}){return e.assetType!=="model"&&console.error("Invalid asset type for ",e,", adding anyway"),this.addSceneObject(e,t)}addWidget(e,t={}){e.assetType!=="widget"&&console.warn("Invalid asset type for ",e,", adding anyway"),this.add(e.modelObject)}_addModel(e,t={}){return this._addObject3D(e==null?void 0:e.modelObject,t)}addSceneObject(e,t){if(!e)return e;const n=e.assetType;let r=!1;switch(n){case"model":r=e.modelObject.isCamera,r&&(t={...t,autoScale:!1}),this._addModel(e,t);break;case"material":break;case"texture":this.dispatchEvent({type:"textureAdded",texture:e});break;case"light":this._addLight(e,t);break;default:console.warn("Unknown asset imported",e,n)}return this.dispatchEvent({type:"addSceneObject",object:e}),e}_addObject3D(e,{autoScale:t=!0,autoScaleRadius:n=2,addToRoot:r=!1}={}){const o=e;o?(t&&!o.userData.autoScaled&&vn(o,o.userData.autoScaleRadius||n),o.traverse(a=>{a.isMesh&&!a.userData.__keepShadowDef&&(a.castShadow=!0,a.receiveShadow=!0,a.userData.__keepShadowDef=!0)}),this.refreshEnvMapIntensity(o),r?this.modelObject.add(o):this.modelRoot.add(o),this.setDirty()):console.error("Invalid Model, cannot add.")}removeSceneModels(){this.modelRoot.clear(),this.modelRoot.children=[],this.setDirty({sceneUpdate:!0})}disposeSceneModels(){this.modelRoot.children.forEach(e=>{var t,n;((t=e.dispose)!==null&&t!==void 0?t:(n=e.modelObject)===null||n===void 0?void 0:n.removeFromParent)()}),this.setDirty({sceneUpdate:!0})}_onEnvironmentChange(){this.dispatchEvent({type:"environmentChanged",environment:this.getEnvironment()}),this._onSceneUpdate()}add(...e){return super.add(...e.map(t=>ir(t))),this._onSceneUpdate(),this}setEnvironment(e){if(!e)return this.environment=null,this.dispatchEvent({type:"environmentChanged"}),void this._onSceneUpdate();if((e==null?void 0:e.assetType)!=="texture")return void console.error("Unknown Environment type",e);e.mapping===c.xfE&&(e.mapping=c.dSO,e.needsUpdate=!0);const t=e.textureObject||e;this.environment=t,this._onEnvironmentChange()}getEnvironment(){return this.environment}setBackground(e){var t;let n;if(!e||e.assetType==="texture"||e.isColor||e.isVector4)n=((t=e)===null||t===void 0?void 0:t.assetType)==="texture"&&e.textureObject||e;else{if(typeof e!="string"&&typeof e!="number")return void console.error("Unknown Background type",e);n=new c.Ilk(e)}this.background=n,this._onSceneUpdate({geometryChanged:!1})}getBackground(){return this.background}setDirty(e){return e!=null&&e.sceneUpdate?this._onSceneUpdate(e):this.dispatchEvent({type:"update"}),this}updateScene(e){return this._onSceneUpdate(e)}_activeCameraUpdate(){this.setDirty(),this.refreshActiveCameraNearFar(),this.dispatchEvent({type:"activeCameraUpdate"})}_onSceneUpdate(e={}){var t,n,r;return e.sceneUpdate===!1?this.setDirty(e):(this.refreshActiveCameraNearFar(),this._sceneBounds=this.getBounds(!1,!0),(r=(n=(t=this.boxHelper)===null||t===void 0?void 0:t.box)===null||n===void 0?void 0:n.copy)===null||r===void 0||r.call(n,this._sceneBounds),this._sceneBoundingRadius=this._sceneBounds.getSize(new c.Pa4).length()/2,this.dispatchEvent({...e,type:"sceneUpdate",hierarchyChanged:["addedToParent","removedFromParent"].includes(e.change||"")}),this)}_onSceneMaterialUpdate(){this.dispatchEvent({type:"sceneMaterialUpdate"})}dispose(){this.clear()}findObjectsByName(e,t){const n=[];return(t??this.modelObject).traverse(r=>{r.name===e&&n.push(r)}),n}addLight(e,t={}){this.addSceneObject(e,t)}_addLight(e,{addToRoot:t=!1}={}){var n;const r=e.lightObject;r&&((n=r.children)===null||n===void 0||n.length,t?this.add(r):this.modelRoot.add(r))}getBounds(e=!1,t=!0){return new _t().expandByObject(this.modelObject,e,t)}refreshActiveCameraNearFar(){const e=this.activeCamera;if(!e)return;const t=this.getBounds(!1),n=e.cameraObject.getWorldPosition(new c.Pa4).sub(t.getCenter(new c.Pa4)),r=1.5*t.getSize(new c.Pa4).length()/2,o=n.length(),a=Math.max(this.minNearDistance,o-r),u=Math.max(a+1,o+r);e.near=a,e.far=u}updateShaderProperties(e){return e.uniforms.sceneBoundingRadius?e.uniforms.sceneBoundingRadius.value=this._sceneBoundingRadius:console.warn("BaseRenderer: no uniform: frameCount"),this}toJSON(e){return cn(this,!0,e)}fromJSON(e,t){const n=e.environment;return n!==void 0&&(this.setEnvironment(kt(n,this.getEnvironment(),!1,t)),delete e.environment),kt(e,this,!0,t),e.environment=n,this}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}}function Mc(){const s=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return s.style.display="block",s}function Su(s,e){const t=e||"/";return s.join(t)}function Ss(s,e){const t=window.URL.createObjectURL(s),n=document.createElement("a");n.style.display="none",n.href=t,n.download=e,document.body.appendChild(n),n.click(),setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(t)},1e3)}async function ps(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=r=>e(n.result),n.onerror=r=>t(n.error),n.onabort=r=>t(new Error("Read aborted")),n.readAsDataURL(s)})}function Wo(s,e){return Ss(s,e??s.name)}async function Tc(s=!1,e=!1,t){const n=document.createElement("input");n.type="file",n.multiple=s,n.accept=t||"*",n.webkitdirectory=e,n.style.display="none",document.body.appendChild(n),n.click();const r=await new Promise(o=>{n.onchange=a=>{o(Array.from(n.files||[]))}});return document.body.removeChild(n),r}function Cr({innerHTML:s="",id:e,classList:t,addToBody:n=!0,elementTag:r="div"}){const o=document.createElement(r);return e&&(o.id=e),o.innerHTML=s,t&&o.classList.add(...t),n&&document.body.appendChild(o),o}async function bd(s){return new Promise((e,t)=>{const n=new Image;n.onload=()=>e(n),n.onerror=t,n.crossOrigin="anonymous",n.decoding="sync",n.src=s})}function ql(s){const e=document.createElement("style");return e.type="text/css",e.innerText=s,document.head.appendChild(e),e}async function Em(s){return new Promise((e,t)=>{const n=document.createElement("script");n.setAttribute("src",s),n.addEventListener("load",e),n.addEventListener("error",t),document.body.appendChild(n)})}function Ic(s,e=8192,t=!1){var n;if(!s.width||!s.height)return"";const r=document.createElement("canvas");r.width=Math.min(e,s.width),r.height=Math.floor(1+r.width*s.height/s.width);const o=s instanceof ImageBitmap,a=o&&t&&Math.abs(r.width-s.width)<.5?r.getContext("bitmaprenderer"):void 0;a?a.transferFromImageBitmap(s):(n=r.getContext("2d"))===null||n===void 0||n.drawImage(s,0,0,r.width,r.height);const u=r.toDataURL("image/png");return r.remove(),o&&t&&s.close(),u}async function Aa(s){return new Promise((e,t)=>{const n=new Image;n.addEventListener("load",()=>{const r=document.createElement("canvas");r.width=n.width,r.height=n.height;const o=r.getContext("2d");if(!o)return void t(new Error("Could not get 2d context"));o.drawImage(n,0,0,r.width,r.height);const a=o.getImageData(0,0,r.width,r.height);e(a),r.remove(),n.remove()},!1),n.addEventListener("error",r=>{n.remove(),t(r)},!1),n.src=s})}function Mi(){return(typeof performance>"u"?Date:performance).now()}function Bp(){let s=!1;return e=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(s=!0),s;var e}function Pc(s,e=null){var t;return(t=new URL(window.location.href).searchParams.get(s))!==null&&t!==void 0?t:e}function io(s,e,t=!1){const n=new URLSearchParams(location.search);e==null?n.has(s)&&n.delete(s):n.set(s,e),t?window.location.search=n.toString():window.history.replaceState({},"","?"+n.toString())}function Cu(s){return s.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})}function Cs(s,{backgroundColor:e="",displayPixelRatio:t=1,width:n=512,height:r=512}){const o=document.createElement("canvas"),a=o.getContext("2d"),u=t,p=n,f=r;return o.width=p*u,o.height=f*u,o.style.width=`${p}`,o.style.height=`${f}`,(e==null?void 0:e.length)>0&&(a.fillStyle=e,a.fillRect(0,0,o.width,o.height)),a.drawImage(s,0,0,o.width,o.height),o}yd([et()],Cc.prototype,"defaultCamera",void 0),yd([we(Cc.prototype.refreshEnvMapIntensity),et()],Cc.prototype,"envMapIntensity",void 0),yd([et()],Cc.prototype,"environment",void 0),ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=function(s,e){const t=new Uint8Array(this);e==null&&(e=t.length);const n=new ArrayBuffer(e-s),r=new Uint8Array(n);for(let o=0;o<r.length;o++)r[o]=t[o+s];return n});class Ms{static ApplyMaterialExtensions(e,t,n,r){for(const o of n)this.ApplyMaterialExtension(e,t,o,r)}static ApplyMaterialExtension(e,t,n,r){var o,a;let u=(o=Se(n.parsFragmentSnippet,r,e))!==null&&o!==void 0?o:"";u.length&&(t.fragmentShader=t.fragmentShader.replace(this.FragVoidMain,`
${u}
${this.FragVoidMain}`)),u=(a=Se(n.parsVertexSnippet,r,e))!==null&&a!==void 0?a:"",u.length&&(t.vertexShader=t.vertexShader.replace(this.VertVoidMain,`
${u}
${this.VertVoidMain}`)),n.extraUniforms&&(t.uniforms=Object.assign(t.uniforms,n.extraUniforms)),n.shaderExtender&&n.shaderExtender(t,e,r),e.lastShader=t}static CacheKeyForExtensions(e,t){let n="";for(const r of t)n+=this.CacheKeyForExtension(e,r);return n}static CacheKeyForExtension(e,t){let n="";return t.customCacheKey&&(n+=t.customCacheKey),t.computeCacheKey&&(n+=t.computeCacheKey(e)),n}static RegisterExtensions(e,t){const n=[];if(t)for(const r of t)r.isCompatible&&r.isCompatible(e)&&(n.push(r),r.uuid||(r.uuid=ki()),r.setDirty||(r.setDirty=()=>{r.updateVersion||(r.updateVersion=0),r.updateVersion++}));return e.materialExtensions=n,e.__ext_beforeRenderListen||(e.__ext_beforeRenderListen=!0,e.addEventListener("beforeRender",r=>function(o,{object:a,renderer:u}){var p;(p=o.materialExtensions)===null||p===void 0||p.forEach(f=>{var m,y;(m=f.onObjectRender)===null||m===void 0||m.call(f,a,o,u),o.lastShader&&((y=Se(f.updaters))===null||y===void 0||y.forEach(S=>S==null?void 0:S.updateShaderProperties(o.lastShader))),f.updateVersion!==o.materialObject.userData["_"+f.uuid+"_version"]&&(o.materialObject.userData["_"+f.uuid+"_version"]=f.updateVersion,o.materialObject.needsUpdate=!0)})}(e,r))),e.__ext_afterRenderListen||(e.__ext_afterRenderListen=!0,e.addEventListener("afterRender",r=>function(o,{object:a,renderer:u}){var p;(p=o.materialExtensions)===null||p===void 0||p.forEach(f=>{var m;(m=f.onAfterRender)===null||m===void 0||m.call(f,a,o,u)})}(e,r))),n}}Ms.FragVoidMain="void main() {",Ms.VertVoidMain="void main() {";class Dc extends c.jyz{constructor(e){var t;super(e),this.typeSlug="shaderMat",this.assetType="material",this.materialObject=this,this.materialExtensions=[],this.extraUniformsToUpload={},this.materialExtensions=Ms.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ms.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}onBeforeCompile(e,t){Ms.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),this.dispatchEvent({type:"beforeCompile",shader:e,renderer:t}),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ms.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}onAfterRender(e,t,n,r,o){super.onAfterRender(e,t,n,r,o),this.dispatchEvent({type:"afterRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){}}class Ts extends Dc{constructor(e,t){super(e),this.typeSlug="shaderMat",this.textures=[],this.setTextureIds(t)}setTextureIds(e){this.textures.map(t=>t.id).join(";")!==e.join(";")&&(this.textures=e.map(t=>({id:t,encoding:c.rnI})),this.setDirty())}_setUniformTexSize(e,t){var n,r,o,a;if(!t||!e)return;const u=(r=(n=t.image)===null||n===void 0?void 0:n.width)!==null&&r!==void 0?r:512,p=(a=(o=t.image)===null||o===void 0?void 0:o.height)!==null&&a!==void 0?a:512,f=e.value;f.isVector2||console.warn("uniform is not a Vector2"),f&&Math.abs(f.x-u)+Math.abs(f.y-p)>.1&&(f.x=u,f.y=p,this.uniformsNeedUpdate=!0)}onBeforeRender(e,t,n,r,o){var a,u;this._setUniformTexSize(this.uniforms.screenSize,(a=e.getRenderTarget())===null||a===void 0?void 0:a.texture);for(const p of this.textures){const f=p.id,m=(u=this.uniforms[f])===null||u===void 0?void 0:u.value;m&&(this._setUniformTexSize(this.uniforms[f+"Size"],m),m.encoding!==p.encoding&&(p.encoding=m.encoding,this.needsUpdate=!0))}super.onBeforeRender(e,t,n,r,o)}onBeforeCompile(e,t){e.fragmentShader=this.textures.map(n=>{var r,o;return`uniform sampler2D ${n.id}; 
`+jt((r=n.id)!==null&&r!==void 0?r:"input",(o=n.encoding)!==null&&o!==void 0?o:c.rnI)}).join(`
`)+e.fragmentShader,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+this.textures.map(e=>e.id+e.encoding).join(";")}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}function Oi(s,...e){const t=s.fragmentShader;return new Ts({defines:Object.assign({},s.defines),uniforms:s.uniforms,vertexShader:s.vertexShader,fragmentShader:t},e)}class _s extends te{constructor(e,...t){super(e.isMaterial?e:Oi(e,...t),t.length<1?_s.DEFAULT_TEX_ID:t[0]),this.onDirty=[],this.isShaderPass2=!0,this.enabled=!0,this.setDirty=this.setDirty.bind(this)}dispose(){var e,t,n,r;(t=(e=this.material)===null||e===void 0?void 0:e.dispose)===null||t===void 0||t.call(e),(r=(n=this.fsQuad)===null||n===void 0?void 0:n.dispose)===null||r===void 0||r.call(n),this.onDirty=[]}setDirty(){this.onDirty.forEach(e=>e())}updateShaderProperties(e){e&&(Array.isArray(e)||(e=[e]),e.forEach(t=>t==null?void 0:t.updateShaderProperties(this.material)))}render(e,t,n,r,o){this.enabled&&super.render(e,t,n,r,o)}}_s.DEFAULT_TEX_ID="tDiffuse",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([_n("Enabled"),et()],_s.prototype,"enabled",void 0);class or extends O{constructor(e,t,n,r,o){super(),this.scene=e,this.camera=t,this.overrideMaterial=n,this.clearColor=r,this.clearAlpha=o!==void 0?o:0,this.clear=!0,this.clearDepth=!1,this.needsSwap=!1,this._oldClearColor=new c.Ilk}render(e,t,n,r,o,a){const u=e.autoClear;let p,f;if(e.autoClear=!1,this.overrideMaterial!==void 0&&(f=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),p=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,a)}if(this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),a){const m=e.getContext();m.framebufferRenderbuffer(m.FRAMEBUFFER,m.DEPTH_ATTACHMENT,m.RENDERBUFFER,null)}this.clearColor&&e.setClearColor(this._oldClearColor,p),this.overrideMaterial!==void 0&&(this.scene.overrideMaterial=f),e.autoClear=u}}class wd extends _s{constructor(e,t="c = a + b;",n="",r){super({vertexShader:C.vertexShader,fragmentShader:Z`
                varying vec2 vUv;
                
                ${n}
                
                void blend(in vec4 a, in vec4 b, inout vec4 c){
                
                ${t}
                
                }
                void main() {
                    vec4 texel = vec4(0);
                    blend(tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ), tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), texel);
                    texel = clamp(texel, vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:r},...e}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}}class qo extends c.jyz{constructor(e=!0){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
out vec3 vViewPosition;void main(){
#include <uv_vertex>
#include <beginnormal_vertex>
#include <morphnormal_vertex>
#include <skinbase_vertex>
#include <skinnormal_vertex>
#include <defaultnormal_vertex>
#include <normal_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
#include <project_vertex>
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
vViewPosition=-mvPosition.xyz;}`,fragmentShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#include <packing>
uniform float alphaTest;
#endif
#ifndef gl_FragColor 
layout(location=0)out vec4 A;layout(location=1)out vec4 B;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <alphamap_pars_fragment>
uniform vec2 cameraNearFar;uniform vec4 flags;in vec3 vViewPosition;vec2 pack16(float value){float sMax=65535.;int v=int(clamp(value,0.,1.)*sMax+0.5);int digit0=v/256;int digit1=v-digit0*256;return vec2(float(digit0)/255.,float(digit1)/255.);}vec2 packNormal(vec3 n){float p=sqrt(n.z*8.+8.);return vec2(n.xy/p+0.5);}float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}void main(){
#ifdef USE_ALPHAMAP
#ifdef ALPHA_I_RGBA_PACKING
if(1.-unpackRGBAToDepth(texture2D(alphaMap,vUv))<alphaTest)
#else
if(texture2D(alphaMap,vUv).g<alphaTest)
#endif
discard;
#endif
#include <normal_fragment_begin>
#ifdef FORCED_LINEAR_DEPTH
float linearZ=float(FORCED_LINEAR_DEPTH);
#else
float linearZ=linstep(-cameraNearFar.x,-cameraNearFar.y,-vViewPosition.z);
#endif
vec2 packedZ=pack16(pow(linearZ,0.5));vec2 packedNormal=packNormal(normal);
#ifndef gl_FragColor 
A=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);B=flags;
#else
gl_FragColor=vec4(packedZ.x,packedZ.y,packedNormal.x,packedNormal.y);
#endif
}`,uniforms:{cameraNearFar:{value:new c.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},flags:{value:new c.Ltg(1,1,1,1)}},glslVersion:e?c.LSk:c.v9Y})}onBeforeRender(e,t,n,r,o){var a,u,p;let f=o.material;Array.isArray(f)&&(f=f[0]),this.uniforms.alphaMap.value=(a=f==null?void 0:f.alphaMap)!==null&&a!==void 0?a:null,this.uniforms.alphaTest.value=!f||!f.alphaTest||f.alphaTest<1e-7?.001:f.alphaTest,this.uniforms.flags.value.x=(f==null?void 0:f.userData.postTonemap)===!1?0:1,this.uniforms.flags.value.y=f!=null&&f.userData._ssBevel?(f==null?void 0:f.userData._ssBevel.radius)/255:0,this.uniforms.flags.value.z=(f!=null&&f.userData.matId?f==null?void 0:f.userData.matId:0)/255,this.uniforms.flags.value.w=f!=null&&f.userData.enableLUT?f==null?void 0:f.userData.enableLUT:0,this.uniformsNeedUpdate=!0;let m=this.uniforms.alphaMap.value?1:void 0;m!==this.defines.USE_ALPHAMAP&&(m===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=m,this.needsUpdate=!0),m=f.userData.ALPHA_I_RGBA_PACKING?1:void 0,m!==this.defines.ALPHA_I_RGBA_PACKING&&(m===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=m,this.needsUpdate=!0),m=(u=f.userData.forcedLinearDepth)!==null&&u!==void 0?u:void 0,m!==this.defines.FORCED_LINEAR_DEPTH&&(m===void 0?delete this.defines.FORCED_LINEAR_DEPTH:this.defines.FORCED_LINEAR_DEPTH=m,this.needsUpdate=!0),this.side=(p=f.side)!==null&&p!==void 0?p:c.ehD}}var Yl=`#ifndef UNPACK_GBUFFER_SNIPPET
#define UNPACK_GBUFFER_SNIPPET 
uniform sampler2D tNormalDepth;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}float unpackDepth(vec2 uncodedDepth){float x=unpack16(uncodedDepth.xy);return x*x;}float getDepth(vec2 uv){vec4 uncodedDepth=texture2D(tNormalDepth,uv);return unpackDepth(uncodedDepth.xy);}void getDepthNormal(const in vec2 uv,out float depth,out vec3 normal){vec4 uncodedDepth=texture2D(tNormalDepth,uv);depth=unpackDepth(uncodedDepth.xy);normal=unpackNormal(uncodedDepth.zw);}vec3 getViewNormal(const in vec2 uv){return unpackNormal(texture2D(tNormalDepth,uv).zw);}
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
uniform sampler2D tGBufferFlags;
#endif
vec4 getGBufferFlags(const in vec2 uv){
#if defined(GBUFFER_HAS_FLAGS) && GBUFFER_HAS_FLAGS == 1
return texture2D(tGBufferFlags,uv);
#else
return vec4(1.);
#endif
}
#endif
`;const Rc={name:"",fog:!0,blending:c.bdR,side:c.Wl3,vertexColors:!1,opacity:1,transparent:!1,blendSrc:c.k74,blendDst:c.LgZ,blendEquation:c.bGH,blendSrcAlpha:null,blendDstAlpha:null,blendEquationAlpha:null,depthFunc:c.vCF,depthTest:!0,depthWrite:!0,stencilWriteMask:255,stencilFunc:c.cum,stencilRef:0,stencilFuncMask:255,stencilFail:c.x5V,stencilZFail:c.x5V,stencilZPass:c.x5V,stencilWrite:!1,clippingPlanes:null,clipIntersection:!1,clipShadows:!1,shadowSide:null,colorWrite:!0,precision:null,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,dithering:!1,alphaTest:0,alphaToCoverage:!1,premultipliedAlpha:!1,visible:!0,toneMapped:!0,userData:{},wireframeLinecap:"round",wireframeLinejoin:"round"};function Lr(s,e,t,{replaceAll:n=!1,prepend:r=!1,append:o=!1}={}){if(!s.includes(e))return console.error(`${e} not found in shader`),s;let a=t;return r?a=t+e:o&&(a=e+t),n?s.replaceAll(e,a):s.replace(e,a)}const kp={...Rc,color:"#000000",roughness:0,metalness:0,map:null,lightMap:null,lightMapIntensity:0,aoMap:null,aoMapIntensity:0,emissive:"#000000",emissiveIntensity:0,emissiveMap:null,bumpMap:null,bumpScale:0,normalMap:null,normalMapType:c.IOt,normalScale:new c.FM8(1,1),displacementMap:null,displacementScale:0,displacementBias:0,roughnessMap:null,metalnessMap:null,alphaMap:null,envMap:null,envMapIntensity:0,refractionRatio:0,wireframe:!1,wireframeLinewidth:0,skinning:!1,morphTargets:!1,morphNormals:!1,flatShading:!1,glossiness:0,glossinessMap:null,specularColor:new Sn(0),specularColorMap:null},Op={...kp,clearcoat:0,clearcoatMap:null,clearcoatRoughness:0,clearcoatRoughnessMap:null,clearcoatNormalScale:new c.FM8(1,1),clearcoatNormalMap:null,reflectivity:.5,sheen:0,sheenColor:new Sn(0),sheenColorMap:null,sheenRoughness:1,sheenRoughnessMap:null,specularIntensity:1,specularIntensityMap:null,specularColor:new Sn(1,1,1),specularColorMap:null,transmission:0,transmissionMap:null,thickness:0,thicknessMap:null,attenuationDistance:0,attenuationColor:new Sn(1,1,1),iridescenceMap:null,iridescenceIOR:1.3,iridescenceThicknessRange:[100,400],iridescenceThicknessMap:null};class Hs extends c.EJi{constructor(e){var t;super(e),this.typeSlug=Hs.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshStandardMaterial2=!0,this.extraUniformsToUpload={},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=n=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(n)},this.fog=!1,this.userData.enableLUT=!0,this.materialExtensions=Ms.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ms.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ui(this,"map"),{type:"folder",label:"Rough/Metal",limitedUi:!0,children:[{type:"slider",bounds:[0,1],property:[this,"roughness"],limitedUi:!0},{type:"slider",bounds:[0,1],property:[this,"metalness"],limitedUi:!0},{type:"image",property:[this,"roughnessMap"]},Ui(this,"roughnessMap"),{type:"image",property:[this,"metalnessMap"]},Ui(this,"metalnessMap")]},{type:"folder",label:"Bump/Normal",limitedUi:!0,children:[{type:"slider",bounds:[0,.2],stepSize:.001,property:[this,"bumpScale"],hidden:()=>!this.bumpMap},{type:"image",property:[this,"bumpMap"]},Ui(this,"bumpMap"),{type:"image",property:[this,"normalMap"]},{type:"vec2",property:[this,"normalScale"],hidden:()=>!this.normalMap},{type:"dropdown",hidden:()=>!this.normalMap,property:[this,"normalMapType"],children:[["TangentSpace",c.IOt],["ObjectSpace",c.PA7]].map(e=>({label:e[0],value:e[1]}))},Ui(this,"normalMap"),{type:"input",property:[this,"displacementScale"],hidden:()=>!this.displacementMap},{type:"image",property:[this,"displacementMap"]},Ui(this,"displacementMap")]},{type:"folder",label:"Sheen",children:[{type:"slider",bounds:[0,1],property:[this,"sheen"]},{type:"color",hidden:()=>this.sheen<.001,property:[this,"sheenColor"]},{type:"image",property:[this,"sheenColorMap"]},Ui(this,"sheenColorMap"),{type:"slider",bounds:[0,1],property:[this,"sheenRoughness"]},{type:"image",property:[this,"sheenRoughnessMap"]},Ui(this,"sheenRoughnessMap")]},{type:"folder",label:"Clearcoat",children:[{type:"slider",bounds:[0,1],property:[this,"clearcoat"]},{type:"slider",bounds:[0,1],hidden:()=>this.clearcoat<.001,property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatMap"]},Ui(this,"clearcoatMap"),{type:"slider",bounds:[0,1],property:[this,"clearcoatRoughness"]},{type:"image",property:[this,"clearcoatRoughnessMap"]},Ui(this,"clearcoatRoughnessMap"),{type:"image",property:[this,"clearcoatNormalMap"]},{type:"vec2",property:[this,"clearcoatNormalScale"],hidden:()=>!this.clearcoatNormalMap},Ui(this,"clearcoatNormalMap")]},{type:"folder",label:"Emission",children:[{type:"color",property:[this,"emissive"]},{type:"slider",bounds:[0,10],property:[this,"emissiveIntensity"]},{type:"image",property:[this,"emissiveMap"]},Ui(this,"emissiveMap")]},{type:"folder",label:"Refraction",children:[{type:"slider",bounds:[0,1],property:[this,"reflectivity"]},{type:"slider",bounds:[0,1],property:[this,"transmission"],limitedUi:!0},{type:"slider",bounds:[0,1],stepSize:.001,property:[this,"thickness"]},{type:"image",property:[this,"transmissionMap"]},Ui(this,"transmissionMap"),{type:"image",property:[this,"thicknessMap"]},Ui(this,"thicknessMap")]},{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"dropdown",property:[this,"depthFunc"],children:[["Never",c.BVF],["Always",c.Se2],["Less",c.Zr5],["LessEqual",c.vCF],["Equal",c.eD],["GreaterEqual",c.ksN],["Greater",c.w$m],["NotEqual",c.M6v]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"depthTest"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Rr],["Normal",Xi],["Additive",c.WMw],["Subtractive",zi],["Multiply",Vi]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ui(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}},{type:"checkbox",label:"Inverse AlphaMap",hidden:()=>!this.transparent,getValue:()=>this.userData.inverseAlphaMap===!0,setValue:e=>{this.userData.inverseAlphaMap=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ui(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ui(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",c.Wl3],["Back",c._Li],["Double",c.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"checkbox",property:[this,"flatShading"]},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:e=>{this.userData.enableLUT=e||void 0,this.setDirty()}},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return(n=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&n!==void 0?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Ss(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`physical-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Physical Material",expanded:!0,children:this._uiConfigChildren,uuid:"MSM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 totalDiffuse = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["#include <lights_physical_fragment>","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const o of r)e.vertexShader=Lr(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=Lr(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);Ms.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),e.defines.INVERSE_ALPHAMAP=this.userData.inverseAlphaMap?1:0,super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ms.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o});const a=this.userData.inverseAlphaMap?1:0;a!==this.defines.INVERSE_ALPHAMAP&&(this.defines.INVERSE_ALPHAMAP=a,this.needsUpdate=!0)}copyProps(e,t=!1){if(!t&&!["MeshStandardMaterial",Hs.TYPE,"MeshPhysicalMaterial"].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={};je(e,n,Array.from(Object.keys(Op)));const r=n.userData;delete n.userData;for(const o of Object.keys(n))n[o]===void 0&&delete n[o];return this.setValues(n),r&&Sr(this.userData,r),this.setDirty(),this}toJSON(e){var t,n;const r=this.userData;this.userData={};const o=super.toJSON(e);this.userData=r,o.userData={},Sr(o.userData,r),o.userData.uuid=this.userData.uuid;const a=e||{textures:Object.fromEntries(((t=o.textures)===null||t===void 0?void 0:t.map(u=>[u.uuid,u]))||[]),images:Object.fromEntries(((n=o.images)===null||n===void 0?void 0:n.map(u=>[u.uuid,u]))||[])};o.userData=cn(o.userData,!1,a),e||(Object.keys(a.textures).length>0&&(o.textures=Object.values(a.textures)),Object.keys(a.images).length>0&&(o.images=Object.values(a.images))),o.type=Hs.TYPE;for(const u of Object.keys(o))o[u]===void 0&&delete o[u];return o}fromJSON(e,t,n=!1){return Array.isArray(e.normalScale)&&(e.normalScale=new c.FM8().fromArray(e.normalScale)),Array.isArray(e.clearcoatNormalScale)&&(e.clearcoatNormalScale=new c.FM8().fromArray(e.clearcoatNormalScale)),this.copyProps(e,n)}clone(){return super.clone()}}Hs.TypeSlug="pmat",Hs.TYPE="MeshStandardMaterial2";const Lp={...Rc,color:"#000000",map:null,lightMap:null,lightMapIntensity:1,aoMap:null,aoMapIntensity:1,alphaMap:null,envMap:null,combine:c.Ns1,reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinewidth:0,skinning:!1};class Yo extends c.vBJ{constructor(e){var t;super(e),this.typeSlug=Yo.TypeSlug,this.assetType="material",this.materialObject=this,this.isMeshBasicMaterial2=!0,this.extraUniformsToUpload={},this.fog=!1,this.setDirty=this.setDirty.bind(this),this.userData.setDirty=n=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(n)},this.materialExtensions=Ms.RegisterExtensions(this,(t=e==null?void 0:e.customMaterialExtensions)!==null&&t!==void 0?t:[])}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}registerMaterialExtensions(e){this.materialExtensions=[...this.materialExtensions,...Ms.RegisterExtensions(this,e)]}unregisterMaterialExtensions(e){}get uiConfig(){return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},{type:"color",property:[this,"color"],limitedUi:!0},{type:"image",property:[this,"map"]},Ui(this,"map"),{type:"folder",label:"Blending",children:[{type:"slider",bounds:[0,1],property:[this,"opacity"]},{type:"checkbox",property:[this,"transparent"],onChange:this.setDirty},{type:"checkbox",property:[this,"depthWrite"],onChange:this.setDirty},{type:"slider",bounds:[0,1],property:[this,"alphaTest"]},{type:"checkbox",property:[this,"dithering"]},{type:"dropdown",label:"Blending",property:[this,"blending"],children:[["None",Rr],["Normal",Xi],["Additive",c.WMw],["Subtractive",zi],["Multiply",Vi]].map(e=>({label:e[0],value:e[1]}))},{type:"image",property:[this,"alphaMap"]},Ui(this,"alphaMap"),{type:"checkbox",label:"Render to Depth",getValue:()=>this.userData.renderToDepth===!0,setValue:e=>{this.userData.renderToDepth=e||void 0,this.setDirty()}}]},{type:"folder",label:"AO/Lightmap",children:[{type:"slider",bounds:[0,2],property:[this,"aoMapIntensity"]},{type:"image",property:[this,"aoMap"]},Ui(this,"aoMap"),{type:"slider",bounds:[0,2],property:[this,"lightMapIntensity"]},{type:"image",property:[this,"lightMap"]},Ui(this,"lightMap")]},{type:"dropdown",label:"Side",property:[this,"side"],children:[["Front",c.Wl3],["Back",c._Li],["Double",c.ehD]].map(e=>({label:e[0],value:e[1]}))},{type:"input",label:"Mesh count",getValue:()=>{var e,t,n;return(n=(t=(e=this.userData)===null||e===void 0?void 0:e.__appliedMeshes)===null||t===void 0?void 0:t.size)!==null&&n!==void 0?n:0},setValue:e=>{},disabled:!0},{type:"button",label:`Download ${this.typeSlug}`,value:()=>{Ss(new Blob([JSON.stringify(this.toJSON(),null,2)],{type:"application/json"}),`unlit-material.${this.typeSlug}`)}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Unlit Material",expanded:!0,children:this._uiConfigChildren,uuid:"MBM2_"+this.uuid,limitedUi:!0}),this._uiConfig.children=[...this._uiConfigChildren,...this.materialExtensions.map(e=>{var t;return(t=e.getUiConfig)===null||t===void 0?void 0:t.call(e,this)})].filter(e=>e),this._uiConfig}onBeforeCompile(e,t){const n=[["vec3 outgoingLight = ","afterModulation"],["#include <aomap_fragment>","beforeModulation"],["ReflectedLight reflectedLight = ","beforeAccumulation"],["#include <clipping_planes_fragment>","mainStart"]],r=[["#include <uv_vertex>","mainStart"]];for(const o of r)e.vertexShader=Lr(e.vertexShader,o[0],"#glMarker "+o[1]+`
`+o[0]);for(const o of n)e.fragmentShader=Lr(e.fragmentShader,o[0],"#glMarker "+o[1]+`
`+o[0]);Ms.ApplyMaterialExtensions(this,e,this.materialExtensions,t),e.fragmentShader=e.fragmentShader.replaceAll("#glMarker","// "),e.vertexShader=e.vertexShader.replaceAll("#glMarker","// "),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()+Ms.CacheKeyForExtensions(this,this.materialExtensions)+this.userData.inverseAlphaMap}onBeforeRender(e,t,n,r,o){super.onBeforeRender(e,t,n,r,o),this.dispatchEvent({type:"beforeRender",renderer:e,scene:t,camera:n,geometry:r,object:o})}copyProps(e,t=!1){if(!t&&!["MeshBasicMaterial",Yo.TYPE].includes(e.type))return console.error("Material type is not supported:",e.type),this;const n={};je(e,n,Array.from(Object.keys(Lp)));const r=n.userData;delete n.userData;for(const o of Object.keys(n))n[o]===void 0&&delete n[o];return this.setValues(n),r&&Sr(this.userData,r),this.setDirty(),this}toJSON(e){var t,n;const r=this.userData;this.userData={};const o=super.toJSON(e);this.userData=r,o.userData={},Sr(o.userData,r),o.userData.uuid=this.userData.uuid;const a=e||{textures:Object.fromEntries(((t=o.textures)===null||t===void 0?void 0:t.map(u=>[u.uuid,u]))||[]),images:Object.fromEntries(((n=o.images)===null||n===void 0?void 0:n.map(u=>[u.uuid,u]))||[])};o.userData=cn(o.userData,!1,a),e||(Object.keys(a.textures).length>0&&(o.textures=Object.values(a.textures)),Object.keys(a.images).length>0&&(o.images=Object.values(a.images))),o.type=Yo.TYPE;for(const u of Object.keys(o))o[u]===void 0&&delete o[u];return o}fromJSON(e,t,n=!1){return this.copyProps(e,n)}clone(){return super.clone()}}Yo.TypeSlug="bmat",Yo.TYPE="MeshBasicMaterial2";const Xl={materialType:Hs.TYPE,name:"standard",color:"#ffffff"},Mu={materialType:Yo.TYPE,name:"basic",color:"#ffffff"},Sm={[Hs.TYPE]:Xl.name,MeshStandardMaterial:Xl.name,MeshPhysicalMaterial:Xl.name,[Yo.TYPE]:Mu.name,MeshBasicMaterial:Mu.name};class za extends w{constructor(){super(),this._templates=[Xl,Mu],this._materials=[],this._disposeMaterial=e=>{const t=e.target;if(!t||t.assetType!=="material")return;this._refreshTextureRefs();const n=this._getMapsForMaterial(t),r=[];n.forEach(o=>{const a=o.userData.__appliedMaterials;a==null||a.delete(t),a&&o.userData.disposeOnIdle!==!1&&a.size===0&&r.push(o)}),r.forEach(o=>{o.dispose()}),this.unregisterMaterial(t)},this._materialExtensions=[],this.processModel=this.processModel.bind(this),this.processMaterial=this.processMaterial.bind(this)}findOrCreate(e,t){let n=this.findMaterial(e);return n||(n=this.generateFromTemplate(e,t)),n}generateFromTemplate(e,t){const n=this.findTemplate(e);if(n)return this._generateFromTemplate(n,t??{})}generateFromTemplateType(e,t){const n=this._templates.find(r=>r.materialType===e);if(n)return this._generateFromTemplate(n,t??{})}findTemplate(e){return this._templates.find(t=>t.name===e)}_refreshTextureRefs(){this.getAllMaterials().forEach(e=>{this._getMapsForMaterial(e).forEach(t=>{let n=t.userData.__appliedMaterials;n||(t.userData.__appliedMaterials=n=new Set),n.add(e)})})}_getMapsForMaterial(e){var t;const n=new Set;for(const r of Object.values(e))r&&r.isTexture&&n.add(r);for(const r of Object.values((t=e.userData)!==null&&t!==void 0?t:{}))r&&r.isTexture&&n.add(r);return n}registerMaterial(e){if(this._materials.includes(e))return;const t=this.findMaterial(e.uuid);t?console.warn("Material UUID already exists",e,t):(e.addEventListener("dispose",this._disposeMaterial),this._materials.push(e))}registerMaterialObject(e){const t=e.materialObject?e:Object.assign(e,{assetType:"material",materialObject:e});return this.registerMaterial(t),t}unregisterMaterial(e){this._materials=this._materials.filter(t=>t.uuid!==e.uuid),e.removeEventListener("dispose",this._disposeMaterial)}registerMaterialTemplate(e){e.templateUUID||(e.templateUUID=ki());const t=this._templates.find(n=>n.templateUUID===e.templateUUID);t?console.warn("MaterialTemplate already exists",e,t):this._templates.push(e)}unregisterMaterialTemplate(e){this._templates=this._templates.filter(t=>t.templateUUID!==e.templateUUID)}dispose(){}findMaterial(e){return e?this._materials.find(t=>t.uuid===e):void 0}findMaterialsByName(e){return this._materials.filter(t=>t.name===e)}getMaterialsOfType(e){return e?this._materials.filter(t=>t.typeSlug===e):[]}getAllMaterials(){return[...this._materials]}processModel(e,t){return _e(e,"modelObject",this._processModel(e,t)),e}_processMaterial(e,t){var n,r,o;if(!e)return;if(!((n=e.materialObject)===null||n===void 0)&&n.isMaterial)return e;let a=e.mmMaterial;if(!a){const u=((r=e.userData)===null||r===void 0?void 0:r.uuid)||e.uuid;if(a=this.findMaterial(u),a)a.copyProps(e);else{const p=t.useSourceMaterial===!1||!e.isMaterial,f=(o=t.materialTemplate)!==null&&o!==void 0?o:p?"standard":Sm[e.type]||"standard";a=this.generateFromTemplate(f,p?{}:e)}e.mmMaterial=a}return a}processMaterial(e,t){return t.register!==!1&&this.registerMaterial(e),e.materialObject||(e=this._processMaterial(e,{...t,register:!1})),e}registerMaterialExtension(e){this._materialExtensions.includes(e)||this._materialExtensions.push(e)}unregisterMaterialExtension(e){const t=this._materialExtensions.indexOf(e);t>=0&&this._materialExtensions.splice(t,1)}exportMaterial(e,t,n=!0,r=!1){const o=cn(e,!1),a=JSON.stringify(o,null,n?0:2),u=(t||e.name||"physical_material")+"."+e.typeSlug,p=new File([a],u,{type:"application/json"});return r&&Wo(p),p}}class Bc extends za{_generateFromTemplate(e,t){var n,r,o,a,u,p;let f;const m={...e};m.customMaterialExtensions=[...(n=m.customMaterialExtensions)!==null&&n!==void 0?n:[],...this._materialExtensions];let y={};switch(e.materialType){case"MeshStandardMaterial2":case"standard":t&&je(t,m,Array.from(Object.keys(Op))),(t==null?void 0:t.type)==="MeshBasicMaterial"&&(m.roughness=.9,m.metalness=0,!((r=m.userData)===null||r===void 0)&&r.uuid&&delete m.userData.uuid),y=(o=m.userData)===null||o===void 0?void 0:o.uuid,y&&delete m.userData.uuid,f=new Hs({customMaterialExtensions:m.customMaterialExtensions}).fromJSON(m,void 0,!0),y&&(f.uuid=y),f.userData.uuid=f.uuid,f.setDirty(),t!=null&&t.isMaterial&&t.userData!==void 0&&(t.userData.iMaterial=f);break;case"MeshBasicMaterial2":case"basic":case"unlit":t&&je(t,m,Array.from(Object.keys(Lp))),y=(a=m.userData)===null||a===void 0?void 0:a.uuid,y&&delete m.userData.uuid,f=new Yo({customMaterialExtensions:m.customMaterialExtensions}).fromJSON(m,void 0,!0),y&&(f.uuid=y),f.userData.uuid=f.uuid,f.setDirty();break;case"shadow":throw"TODO: Not implemented shadow material";default:y=null,t&&t.userData&&(y=t.userData,delete t.userData),f=((u=e.generator)===null||u===void 0?void 0:u.call(e,m,t))||void 0,t&&y&&(t.userData=y),y&&f&&(Sr(f.userData,y),y!=null&&y.uuid&&(f.uuid=y.uuid),y=null),f&&(f.userData.uuid=f.uuid)}if(f){t.runtimeMaterial&&(f.userData.__runtimeMaterial=!0);const S=f;if(f.clone=()=>{S.userData.cloneId||(S.userData.cloneId="0",S.userData.cloneCount=0),S.userData.cloneCount+=1;const M=this.generateFromTemplate(e.name);return M&&(M.copyProps(S),M.userData.cloneId=M.userData.cloneId+"_"+S.userData.cloneCount,M.userData.cloneCount=0,M.name=M.name+"_"+M.userData.cloneId),M==null?void 0:M.materialObject},t){let M=this.findMaterial(t==null?void 0:t.uuid);M&&this.unregisterMaterial(M),M=this.findMaterial((p=t==null?void 0:t.materialObject)===null||p===void 0?void 0:p.uuid),M&&this.unregisterMaterial(M)}return this.registerMaterialObject(S)}}_processModel(e,t){if(!e.modelObject)return console.error("MaterialManager: No modelObject found for ",e),e;let n=e.material;if(!n&&e.geometry&&(this._defaultMaterial||(this._defaultMaterial=this.generateFromTemplate("standard")),n=this._defaultMaterial,e.material=n),n){let r=!0;Array.isArray(n)||(n=[n],r=!1);const o=[];for(const a of n){const u=this._processMaterial(a,t);o.push(u==null?void 0:u.materialObject)}e.setMaterial&&(e.modelObject.material=null,e.setMaterial(r?o:o[0]))}if(t.recursive!==!1)for(let r=0;r<e.modelObject.children.length;r++)e.modelObject.children[r]=this._processModel(e.modelObject.children[r],t);return e}}class Nr{constructor(e,t,n,r){this.cls=e,this.ext=t,this.root=n,this.onCtor=r}ctor(e){const t=this.cls&&new this.cls(e.loadingManager);return typeof this.onCtor=="function"?this.onCtor(t,e):t}}function xd(s){var e;if(!s||s===""||s.match(/__MACOSX\/.*\._/))return"";const t=(e=(s=s.replace(/\?.*$/,"")).split(/[\\/]/).pop())!==null&&e!==void 0?e:"",n=t.lastIndexOf(".");return t===""||n<1?"":t.slice(n+1)}function Ed(s){return s.substring(s.lastIndexOf("/")+1)}class fl{constructor(e,{pseudoCenter:t=!1,autoCenter:n=!1,autoScale:r=!1,autoScaleRadius:o=2,license:a=""}={}){if(this.assetType="model",this._modelObject=ir(new c.Tme),this.setDirty=this.setDirty.bind(this),this.updateBounds=this.updateBounds.bind(this),e||(e=this._modelObject),!t||e.userData.pseudoCentered||e.userData.isCentered)!n||e.userData.autoCentered||e.userData.isCentered||e.userData.pseudoCentered?t||n||(e.userData.isCentered=!0):Cn(e),this._modelObject=e;else{n&&console.error("cannot use pseudoCenter and autoCenter at the same time");const u=new _t().expandByObject(e,!0,!0).getCenter(new c.Pa4);this._modelObject.position.copy(u).negate(),this._modelObject.updateMatrix(),this._modelObject.add(e),this._modelObject.name=e.name+"-centered",this._modelObject.userData.pseudoCentered=!0,e.userData.iModel=this}r&&!this._modelObject.userData.autoScaled?vn(this._modelObject,e.userData.autoScaleRadius||o):this._modelObject.userData.autoScaled=!0,this._modelObject.addEventListener("dispose",()=>{this.__disposed=!0}),this._modelObject.userData.iModel=this,this.license=a}get visible(){return this._modelObject.visible}set visible(e){this._modelObject.visible=e}get uuid(){return this._modelObject.uuid}get modelObject(){return this._modelObject}get name(){return this._modelObject.name}set name(e){this._modelObject.name=e}get license(){return this._modelObject.userData.license}set license(e){this._modelObject.userData.license=e}addEventListener(e,t){this._modelObject.addEventListener(e,t)}dispatchEvent(e){this._modelObject.dispatchEvent(e)}hasEventListener(e,t){return this._modelObject.hasEventListener(e,t)}removeEventListener(e,t){this._modelObject.removeEventListener(e,t)}traverse(e){this._modelObject.traverse(e)}dispose(){const e=this._modelObject.dispose;e&&typeof e=="function"?e():(console.warn("no dispose in modelObject"),this._modelObject.removeFromParent())}setDirty(e){var t,n,r,o;(n=(t=this._modelObject)===null||t===void 0?void 0:t.setDirty)===null||n===void 0||n.call(t,e),(o=(r=this._uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0)}setMaterial(e){var t,n;return this._modelObject.isMesh?((n=(t=this._modelObject).setMaterial)===null||n===void 0?void 0:n.call(t,e))||[]:(console.error("setMaterial only works on meshes"),[])}get material(){return this._modelObject.material}get geometry(){return this._modelObject.geometry}setGeometry(e,t=!1){var n,r;if(this._modelObject.isMesh)return(r=(n=this._modelObject).setGeometry)===null||r===void 0?void 0:r.call(n,e,t);console.error("setGeometry only works on meshes")}get userData(){return this._modelObject.userData}set userData(e){this._modelObject.userData=e}updateBounds(){console.warn("updateBounds: NOT IMPLEMENTED"),this.setDirty()}get uiConfig(){return this._uiConfig||(this._uiConfig=Nn(this._modelObject,!1)),this._uiConfig}clone(){return new fl(this._modelObject.clone(),{pseudoCenter:!1,autoScale:!1,autoCenter:!1,license:this.license})}}function kc(s,e){return[s.modelObject,...s.modelObject.children].forEach(t=>{ir(t,t!==s.modelObject?s:void 0,e)}),s}class Tu{constructor(){this._processors=new Map}add(e,t){var n;this._processors.has(e)||this._processors.set(e,[]),(n=this._processors.get(e))===null||n===void 0||n.push(t)}remove(e,t){const n=this._processors.get(e),r=(n==null?void 0:n.indexOf(t))||(n==null?void 0:n.findIndex(o=>o.process&&o.process===t.process||o.processAsync&&o.processAsync===t.processAsync));!n||!r||r<0||n.splice(r,1)}get(e){var t;return(t=this._processors.get(e))!==null&&t!==void 0?t:[]}async process(e,t,n){var r,o,a,u;const p=this.get(e),f=t.assetType;for(const m of p)m.forAssetType===f&&(t=(o=(r=m.process)===null||r===void 0?void 0:r.call(m,t,n))!==null&&o!==void 0?o:t,t=(u=await((a=m.processAsync)===null||a===void 0?void 0:a.call(m,t,n)))!==null&&u!==void 0?u:t);return t}dispose(){this._processors.clear()}}class Sd extends c.hH6{load(e,t,n,r){return super.load(e,o=>{try{if(typeof o!="string")throw new Error("Invalid JSON");t==null||t(JSON.parse(o))}catch(a){r==null||r(a)}},n,r)}}class L_ extends c.yxD{constructor(e){super(e),this.type=c.cLu}parse(e){const t=function(p,f){switch(p){case 1:console.error("THREE.RGBELoader Read Error: "+(f||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(f||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(f||""));break;default:console.error("THREE.RGBELoader: Error: "+(f||""))}return-1},n=function(p,f,m){f=f||1024;let y=p.pos,S=-1,M=0,P="",D=String.fromCharCode.apply(null,new Uint16Array(p.subarray(y,y+128)));for(;0>(S=D.indexOf(`
`))&&M<f&&y<p.byteLength;)P+=D,M+=D.length,y+=128,D+=String.fromCharCode.apply(null,new Uint16Array(p.subarray(y,y+128)));return-1<S&&(m!==!1&&(p.pos+=M+S+1),P+D.slice(0,S))},r=function(p,f,m,y){const S=p[f+3],M=Math.pow(2,S-128)/255;m[y+0]=p[f+0]*M,m[y+1]=p[f+1]*M,m[y+2]=p[f+2]*M,m[y+3]=1},o=function(p,f,m,y){const S=p[f+3],M=Math.pow(2,S-128)/255;m[y+0]=c.A5E.toHalfFloat(Math.min(p[f+0]*M,65504)),m[y+1]=c.A5E.toHalfFloat(Math.min(p[f+1]*M,65504)),m[y+2]=c.A5E.toHalfFloat(Math.min(p[f+2]*M,65504)),m[y+3]=c.A5E.toHalfFloat(1)},a=new Uint8Array(e);a.pos=0;const u=function(p){const f=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,m=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,y=/^\s*FORMAT=(\S+)\s*$/,S=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,M={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let P,D;if(p.pos>=p.byteLength||!(P=n(p)))return t(1,"no header found");if(!(D=P.match(/^#\?(\S+)/)))return t(3,"bad initial token");for(M.valid|=1,M.programtype=D[1],M.string+=P+`
`;P=n(p),P!==!1;)if(M.string+=P+`
`,P.charAt(0)!=="#"){if((D=P.match(f))&&(M.gamma=parseFloat(D[1])),(D=P.match(m))&&(M.exposure=parseFloat(D[1])),(D=P.match(y))&&(M.valid|=2,M.format=D[1]),(D=P.match(S))&&(M.valid|=4,M.height=parseInt(D[1],10),M.width=parseInt(D[2],10)),2&M.valid&&4&M.valid)break}else M.comments+=P+`
`;return 2&M.valid?4&M.valid?M:t(3,"missing image size specifier"):t(3,"missing format specifier")}(a);if(u!==-1){const p=u.width,f=u.height,m=function(y,S,M){const P=S;if(P<8||P>32767||y[0]!==2||y[1]!==2||128&y[2])return new Uint8Array(y);if(P!==(y[2]<<8|y[3]))return t(3,"wrong scanline width");const D=new Uint8Array(4*S*M);if(!D.length)return t(4,"unable to allocate buffer space");let j=0,k=0;const L=4*P,R=new Uint8Array(4),W=new Uint8Array(L);let q=M;for(;q>0&&k<y.byteLength;){if(k+4>y.byteLength)return t(1);if(R[0]=y[k++],R[1]=y[k++],R[2]=y[k++],R[3]=y[k++],R[0]!=2||R[1]!=2||(R[2]<<8|R[3])!=P)return t(3,"bad rgbe scanline format");let J,ee=0;for(;ee<L&&k<y.byteLength;){J=y[k++];const xe=J>128;if(xe&&(J-=128),J===0||ee+J>L)return t(3,"bad scanline data");if(xe){const De=y[k++];for(let Fe=0;Fe<J;Fe++)W[ee++]=De}else W.set(y.subarray(k,k+J),ee),ee+=J,k+=J}const he=P;for(let xe=0;xe<he;xe++){let De=0;D[j]=W[xe+De],De+=P,D[j+1]=W[xe+De],De+=P,D[j+2]=W[xe+De],De+=P,D[j+3]=W[xe+De],j+=4}q--}return D}(a.subarray(a.pos),p,f);if(m!==-1){let y,S,M;switch(this.type){case c.VzW:M=m.length/4;const P=new Float32Array(4*M);for(let j=0;j<M;j++)r(m,4*j,P,4*j);y=P,S=c.VzW;break;case c.cLu:M=m.length/4;const D=new Uint16Array(4*M);for(let j=0;j<M;j++)o(m,4*j,D,4*j);y=D,S=c.cLu;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:p,height:f,data:y,header:u.string,gamma:u.gamma,exposure:u.exposure,type:S}}}return null}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(o,a){switch(o.type){case c.VzW:case c.cLu:o.encoding=c.rnI,o.minFilter=c.wem,o.magFilter=c.wem,o.generateMipmaps=!1,o.flipY=!0}t&&t(o,a)},n,r)}}function Cm(s){bi.Importers.push(new Nr(class extends L_{constructor(e){super(e),this.setDataType(Nm(s))}},["hdr"],!1))}class ml extends c.aNw{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Ih(t)}),this.register(function(t){return new ro(t)}),this.register(function(t){return new gl(t)}),this.register(function(t){return new Vn(t)}),this.register(function(t){return new Va(t)}),this.register(function(t){return new Ph(t)}),this.register(function(t){return new Dh(t)}),this.register(function(t){return new Oc(t)}),this.register(function(t){return new Kl(t)}),this.register(function(t){return new Ws(t)}),this.register(function(t){return new Zr(t)}),this.register(function(t){return new vr(t)})}load(e,t,n,r){const o=this;let a;a=this.resourcePath!==""?this.resourcePath:this.path!==""?this.path:c.Zp0.extractUrlBase(e),this.manager.itemStart(e);const u=function(f){r?r(f):console.error(f),o.manager.itemError(e),o.manager.itemEnd(e)},p=new c.hH6(this.manager);p.setPath(this.path),p.setResponseType("arraybuffer"),p.setRequestHeader(this.requestHeader),p.setWithCredentials(this.withCredentials),p.load(e,function(f){try{o.parse(f,a,function(m){t(m),o.manager.itemEnd(e)},u)}catch(m){u(m)}},n,u)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r){let o;const a={},u={};if(typeof e=="string")o=e;else if(c.Zp0.decodeText(new Uint8Array(e,0,4))===Md){try{a[ei.KHR_BINARY_GLTF]=new Xt(e)}catch(m){return void(r&&r(m))}o=a[ei.KHR_BINARY_GLTF].content}else o=c.Zp0.decodeText(new Uint8Array(e));const p=JSON.parse(o);if(p.asset===void 0||p.asset.version[0]<2)return void(r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const f=new fs(p,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){const y=this.pluginCallbacks[m](f);u[y.name]=y,a[y.name]=!0}if(p.extensionsUsed)for(let m=0;m<p.extensionsUsed.length;++m){const y=p.extensionsUsed[m],S=p.extensionsRequired||[];switch(y){case ei.KHR_MATERIALS_UNLIT:a[y]=new Np;break;case ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:a[y]=new Lc;break;case ei.KHR_DRACO_MESH_COMPRESSION:a[y]=new Is(p,this.dracoLoader);break;case ei.KHR_TEXTURE_TRANSFORM:a[y]=new Mm;break;case ei.KHR_MESH_QUANTIZATION:a[y]=new Nc;break;default:S.indexOf(y)>=0&&u[y]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+y+'".')}}f.setExtensions(a),f.setPlugins(u),f.parse(n,r)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,t,r,o)})}}function Cd(){let s={};return{get:function(e){return s[e]},add:function(e,t){s[e]=t},remove:function(e){delete s[e]},removeAll:function(){s={}}}}const ei={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Zr{constructor(e){this.parser=e,this.name=ei.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let n=0,r=t.length;n<r;n++){const o=t[n];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,n="light:"+e;let r=t.cache.get(n);if(r)return r;const o=t.json,a=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let u;const p=new c.Ilk(16777215);a.color!==void 0&&p.fromArray(a.color);const f=a.range!==void 0?a.range:0;switch(a.type){case"directional":u=new c.Ox3(p),u.target.position.set(0,0,-1),u.add(u.target);break;case"point":u=new c.cek(p),u.distance=f;break;case"spot":u=new c.PMe(p),u.distance=f,a.spot=a.spot||{},a.spot.innerConeAngle=a.spot.innerConeAngle!==void 0?a.spot.innerConeAngle:0,a.spot.outerConeAngle=a.spot.outerConeAngle!==void 0?a.spot.outerConeAngle:Math.PI/4,u.angle=a.spot.outerConeAngle,u.penumbra=1-a.spot.innerConeAngle/a.spot.outerConeAngle,u.target.position.set(0,0,-1),u.add(u.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+a.type)}return u.position.set(0,0,0),u.decay=2,a.intensity!==void 0&&(u.intensity=a.intensity),u.name=t.createUniqueName(a.name||"light_"+e),r=Promise.resolve(u),t.cache.add(n,r),r}createNodeAttachment(e){const t=this,n=this.parser,r=n.json.nodes[e],o=(r.extensions&&r.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(a){return n._getNodeRef(t.cache,o,a)})}}class Np{constructor(){this.name=ei.KHR_MATERIALS_UNLIT}getMaterialType(){return c.vBJ}extendParams(e,t,n){const r=[];e.color=new c.Ilk(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const a=o.baseColorFactor;e.color.fromArray(a),e.opacity=a[3]}o.baseColorTexture!==void 0&&r.push(n.assignTexture(e,"map",o.baseColorTexture,c.knz))}return Promise.all(r)}}class Oc{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name].emissiveStrength;return r!==void 0&&(t.emissiveIntensity=r),Promise.resolve()}}class Ih{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];if(a.clearcoatFactor!==void 0&&(t.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(o.push(n.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const u=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new c.FM8(u,u)}return Promise.all(o)}}class Ws{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.iridescenceFactor!==void 0&&(t.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(t.iridescenceIOR=a.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&o.push(n.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(o)}}class Vn{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_SHEEN}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new c.Ilk(0,0,0),t.sheenRoughness=0,t.sheen=1;const a=r.extensions[this.name];return a.sheenColorFactor!==void 0&&t.sheenColor.fromArray(a.sheenColorFactor),a.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&o.push(n.assignTexture(t,"sheenColorMap",a.sheenColorTexture,c.knz)),a.sheenRoughnessTexture!==void 0&&o.push(n.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),r.extras&&r.extras.sheenFactor!==void 0&&(t.sheen=r.extras.sheenFactor,delete r.extras.sheenFactor),Promise.all(o)}}class Va{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.transmissionFactor!==void 0&&(t.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&o.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(o)}}class Ph{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_VOLUME}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&o.push(n.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||0;const u=a.attenuationColor||[1,1,1];return t.attenuationColor=new c.Ilk(u[0],u[1],u[2]),Promise.all(o)}}class Dh{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_IOR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.ior=r.ior!==void 0?r.ior:1.5,Promise.resolve()}}class Kl{constructor(e){this.parser=e,this.name=ei.KHR_MATERIALS_SPECULAR}getMaterialType(e){const t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?c.EJi:null}extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];t.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&o.push(n.assignTexture(t,"specularIntensityMap",a.specularTexture));const u=a.specularColorFactor||[1,1,1];return t.specularColor=new c.Ilk(u[0],u[1],u[2]),a.specularColorTexture!==void 0&&o.push(n.assignTexture(t,"specularColorMap",a.specularColorTexture,c.knz)),Promise.all(o)}}class ro{constructor(e){this.parser=e,this.name=ei.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const o=r.extensions[this.name],a=t.options.ktx2Loader;if(!a){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,a)}}class gl{constructor(e){this.parser=e,this.name=ei.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,n=this.parser,r=n.json,o=r.textures[e];if(!o.extensions||!o.extensions[t])return null;const a=o.extensions[t],u=r.images[a.source];let p=n.textureLoader;if(u.uri){const f=n.options.manager.getHandler(u.uri);f!==null&&(p=f)}return this.detectSupport().then(function(f){if(f)return n.loadTextureImage(e,a.source,p);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class vr{constructor(e){this.name=ei.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){const r=n.extensions[this.name],o=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(u){const p=r.byteOffset||0,f=r.byteLength||0,m=r.count,y=r.byteStride,S=new Uint8Array(u,p,f);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(m,y,S,r.mode,r.filter).then(function(M){return M.buffer}):a.ready.then(function(){const M=new ArrayBuffer(m*y);return a.decodeGltfBuffer(new Uint8Array(M),m,y,S,r.mode,r.filter),M})})}return null}}const Md="glTF";class Xt{constructor(e){this.name=ei.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:c.Zp0.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Md)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,r=new DataView(e,12);let o=0;for(;o<n;){const a=r.getUint32(o,!0);o+=4;const u=r.getUint32(o,!0);if(o+=4,u===1313821514){const p=new Uint8Array(e,12+o,a);this.content=c.Zp0.decodeText(p)}else if(u===5130562){const p=12+o;this.body=e.slice(p,p+a)}o+=a}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Is{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=ei.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const n=this.json,r=this.dracoLoader,o=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,u={},p={},f={};for(const m in a){const y=Pu[m]||m.toLowerCase();u[y]=a[m]}for(const m in e.attributes){const y=Pu[m]||m.toLowerCase();if(a[m]!==void 0){const S=n.accessors[e.attributes[m]],M=qs[S.componentType];f[y]=M.name,p[y]=S.normalized===!0}}return t.getDependency("bufferView",o).then(function(m){return new Promise(function(y){r.decodeDracoFile(m,function(S){for(const M in S.attributes){const P=S.attributes[M],D=p[M];D!==void 0&&(P.normalized=D)}y(S)},u,f)})})}}class Mm{constructor(){this.name=ei.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Fp extends c.Wid{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),n=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),o=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),a=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),u={specular:{value:new c.Ilk().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=u,this.onBeforeCompile=function(p){for(const f in u)p.uniforms[f]=u[f];p.fragmentShader=p.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",o).replace("#include <lights_physical_fragment>",a)},Object.defineProperties(this,{specular:{get:function(){return u.specular.value},set:function(p){u.specular.value=p}},specularMap:{get:function(){return u.specularMap.value},set:function(p){u.specularMap.value=p,p?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return u.glossiness.value},set:function(p){u.glossiness.value=p}},glossinessMap:{get:function(){return u.glossinessMap.value},set:function(p){u.glossinessMap.value=p,p?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Lc{constructor(){this.name=ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Fp}extendParams(e,t,n){const r=t.extensions[this.name];e.color=new c.Ilk(1,1,1),e.opacity=1;const o=[];if(Array.isArray(r.diffuseFactor)){const a=r.diffuseFactor;e.color.fromArray(a),e.opacity=a[3]}if(r.diffuseTexture!==void 0&&o.push(n.assignTexture(e,"map",r.diffuseTexture,c.knz)),e.emissive=new c.Ilk(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new c.Ilk(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const a=r.specularGlossinessTexture;o.push(n.assignTexture(e,"glossinessMap",a)),o.push(n.assignTexture(e,"specularMap",a,c.knz))}return Promise.all(o)}createMaterial(e){const t=new Fp(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=c.IOt,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Nc{constructor(){this.name=ei.KHR_MESH_QUANTIZATION}}class ya extends c._C8{constructor(e,t,n,r){super(e,t,n,r)}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=e*r*3+r;for(let a=0;a!==r;a++)t[a]=n[o+a];return t}interpolate_(e,t,n,r){const o=this.resultBuffer,a=this.sampleValues,u=this.valueSize,p=2*u,f=3*u,m=r-t,y=(n-t)/m,S=y*y,M=S*y,P=e*f,D=P-f,j=-2*M+3*S,k=M-S,L=1-j,R=k-S+y;for(let W=0;W!==u;W++){const q=a[D+W+u],J=a[D+W+p]*m,ee=a[P+W+u],he=a[P+W]*m;o[W]=L*q+R*J+j*ee+k*he}return o}}const Rh=new c._fP;class Iu extends ya{interpolate_(e,t,n,r){const o=super.interpolate_(e,t,n,r);return Rh.fromArray(o).normalize().toArray(o),o}}const qs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Td={9728:c.TyD,9729:c.wem,9984:c.YLQ,9985:c.qyh,9986:c.aH4,9987:c.D1R},Fr={33071:c.uWy,33648:c.OoA,10497:c.rpg},Xo={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Pu={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ro={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Id={CUBICSPLINE:void 0,LINEAR:c.NMF,STEP:c.Syv};function bn(s,e,t){for(const n in t.extensions)s[n]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=t.extensions[n])}function Ko(s,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(s.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Bh(s,e){if(s.updateMorphTargets(),e.weights!==void 0)for(let t=0,n=e.weights.length;t<n;t++)s.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(s.morphTargetInfluences.length===t.length){s.morphTargetDictionary={};for(let n=0,r=t.length;n<r;n++)s.morphTargetDictionary[t[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Fc(s){const e=s.extensions&&s.extensions[ei.KHR_DRACO_MESH_COMPRESSION];let t;return t=e?"draco:"+e.bufferView+":"+e.indices+":"+Du(e.attributes):s.indices+":"+Du(s.attributes)+":"+s.mode,t}function Du(s){let e="";const t=Object.keys(s).sort();for(let n=0,r=t.length;n<r;n++)e+=t[n]+":"+s[t[n]]+";";return e}function Up(s){switch(s){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}class fs{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Cd,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const n=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,r=navigator.userAgent.indexOf("Firefox")>-1,o=r?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||n||r&&o<98?this.textureLoader=new c.dpR(this.options.manager):this.textureLoader=new c.QRU(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new c.hH6(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([n.getDependencies("scene"),n.getDependencies("animation"),n.getDependencies("camera")])}).then(function(a){const u={scene:a[0][r.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:r.asset,parser:n,userData:{}};bn(o,u,r),Ko(u,r),Promise.all(n._invokeAll(function(p){return p.afterRoot&&p.afterRoot(u)})).then(function(){e(u)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[];for(let r=0,o=t.length;r<o;r++){const a=t[r].joints;for(let u=0,p=a.length;u<p;u++)e[a[u]].isBone=!0}for(let r=0,o=e.length;r<o;r++){const a=e[r];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(n[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,n){if(e.refs[t]<=1)return n;const r=n.clone(),o=(a,u)=>{const p=this.associations.get(a);p!=null&&this.associations.set(u,p);for(const[f,m]of a.children.entries())o(m,u.children[f])};return o(n,r),r.name+="_instance_"+e.uses[t]++,r}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let n=0;n<t.length;n++){const r=e(t[n]);if(r)return r}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const n=[];for(let r=0;r<t.length;r++){const o=e(t[r]);o&&n.push(o)}return n}getDependency(e,t){const n=e+":"+t;let r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":r=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":r=this.loadSkin(t);break;case"animation":r=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r}getDependencies(e){let t=this.cache.get(e);if(!t){const n=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(r.map(function(o,a){return n.getDependency(e,a)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],n=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[ei.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(o,a){n.load(c.Zp0.resolveURL(t.uri,r.path),o,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(n){const r=t.byteLength||0,o=t.byteOffset||0;return n.slice(o,o+r)})}loadAccessor(e){const t=this,n=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const o=[];return r.bufferView!==void 0?o.push(this.getDependency("bufferView",r.bufferView)):o.push(null),r.sparse!==void 0&&(o.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(o).then(function(a){const u=a[0],p=Xo[r.type],f=qs[r.componentType],m=f.BYTES_PER_ELEMENT,y=m*p,S=r.byteOffset||0,M=r.bufferView!==void 0?n.bufferViews[r.bufferView].byteStride:void 0,P=r.normalized===!0;let D,j;if(M&&M!==y){const k=Math.floor(S/M),L="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+k+":"+r.count;let R=t.cache.get(L);R||(D=new f(u,k*M,r.count*M/m),R=new c.vpT(D,M/m),t.cache.add(L,R)),j=new c.kB5(R,p,S%M/m,P)}else D=u===null?new f(r.count*p):new f(u,S,r.count*p),j=new c.TlE(D,p,P);if(r.sparse!==void 0){const k=Xo.SCALAR,L=qs[r.sparse.indices.componentType],R=r.sparse.indices.byteOffset||0,W=r.sparse.values.byteOffset||0,q=new L(a[1],R,r.sparse.count*k),J=new f(a[2],W,r.sparse.count*p);u!==null&&(j=new c.TlE(j.array.slice(),j.itemSize,j.normalized));for(let ee=0,he=q.length;ee<he;ee++){const xe=q[ee];if(j.setX(xe,J[ee*p]),p>=2&&j.setY(xe,J[ee*p+1]),p>=3&&j.setZ(xe,J[ee*p+2]),p>=4&&j.setW(xe,J[ee*p+3]),p>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return j})}loadTexture(e){const t=this.json,n=this.options,r=t.textures[e].source,o=t.images[r];let a=this.textureLoader;if(o.uri){const u=n.manager.getHandler(o.uri);u!==null&&(a=u)}return this.loadTextureImage(e,r,a)}loadTextureImage(e,t,n){const r=this,o=this.json,a=o.textures[e],u=o.images[t],p=(u.uri||u.bufferView)+":"+a.sampler;if(this.textureCache[p])return this.textureCache[p];const f=this.loadImageSource(t,n).then(function(m){a.name&&(m.name=a.name);const y=(o.samplers||{})[a.sampler]||{};return m.magFilter=Td[y.magFilter]||c.wem,m.minFilter=Td[y.minFilter]||c.D1R,m.wrapS=Fr[y.wrapS]||c.rpg,m.wrapT=Fr[y.wrapT]||c.rpg,y.extras&&y.extras.uuid!==void 0&&(m.uuid=y.extras.uuid),r.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[p]=f,f}loadImageSource(e,t){const n=this,r=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(y=>y.clone());const a=r.images[e],u=self.URL||self.webkitURL;let p=a.uri||"",f=!1;if(a.bufferView!==void 0)p=n.getDependency("bufferView",a.bufferView).then(function(y){f=!0;const S=new Blob([y],{type:a.mimeType});return p=u.createObjectURL(S),p});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const m=Promise.resolve(p).then(function(y){return new Promise(function(S,M){let P=S;t.isImageBitmapLoader===!0&&(P=function(D){const j=new c.xEZ(D);j.needsUpdate=!0,S(j)}),t.load(c.Zp0.resolveURL(y,o.path),P,void 0,function(D){t.isImageBitmapLoader===!0?(t=new c.dpR(n.options.manager),P=S,t.setCrossOrigin(n.options.crossOrigin),t.setRequestHeader(n.options.requestHeader),t.load(c.Zp0.resolveURL(y,o.path),P,void 0,M)):M(D)})})}).then(function(y){var S;if(f===!0&&u.revokeObjectURL(p),y.userData.mimeType=a.mimeType||((S=a.uri).search(/\.jpe?g($|\?)/i)>0||S.search(/^data\:image\/jpeg/)===0?"image/jpeg":S.search(/\.webp($|\?)/i)>0||S.search(/^data\:image\/webp/)===0?"image/webp":"image/png"),y.flipY=!1,a.extras){if(a.extras.flipY!==void 0){if(t.isImageBitmapLoader===!0&&typeof createImageBitmap!==void 0){const M=y,P=a.extras.flipY&&!M.flipY;createImageBitmap(M.source.data,{imageOrientation:P?"flipY":"none"}).then(function(D){M.source.data.close&&M.source.data.close(),M.source.data=D,M.source.needsUpdate=!0,M.needsUpdate=!0})}y.flipY=a.extras.flipY,y.needsUpdate=!0,delete a.extras.flipY}a.extras.uuid!==void 0&&(y.source.uuid=a.extras.uuid),a.extras.t_uuid!==void 0&&(y.uuid=a.extras.t_uuid)}return a.uri&&typeof a.uri=="string"&&(y.userData.rootPath=a.uri),y}).catch(function(y){throw console.error("THREE.GLTFLoader: Couldn't load texture",p),y});return this.sourceCache[e]=m,m}assignTexture(e,t,n,r){const o=this;return this.getDependency("texture",n.index).then(function(a){if(n.texCoord===void 0||n.texCoord==0||t==="aoMap"&&n.texCoord==1||console.warn("THREE.GLTFLoader: Custom UV set "+n.texCoord+" for texture "+t+" not yet supported."),o.extensions[ei.KHR_TEXTURE_TRANSFORM]){const u=n.extensions!==void 0?n.extensions[ei.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const p=o.associations.get(a);a=o.extensions[ei.KHR_TEXTURE_TRANSFORM].extendTexture(a,u),o.associations.set(a,p)}}return r!==void 0&&(a.encoding=r),e[t]=a,a})}assignFinalMaterial(e){const t=e.geometry;let n=e.material;const r=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,a=t.attributes.normal===void 0;if(e.isPoints){const u="PointsMaterial:"+n.uuid;let p=this.cache.get(u);p||(p=new c.UY4,c.F5T.prototype.copy.call(p,n),p.color.copy(n.color),p.map=n.map,p.sizeAttenuation=!1,this.cache.add(u,p)),n=p}else if(e.isLine){const u="LineBasicMaterial:"+n.uuid;let p=this.cache.get(u);p||(p=new c.nls,c.F5T.prototype.copy.call(p,n),p.color.copy(n.color),this.cache.add(u,p)),n=p}if(r||o||a){let u="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(u+="specular-glossiness:"),r&&(u+="derivative-tangents:"),o&&(u+="vertex-colors:"),a&&(u+="flat-shading:");let p=this.cache.get(u);p||(p=n.clone(),o&&(p.vertexColors=!0),a&&(p.flatShading=!0),r&&(p.normalScale&&(p.normalScale.y*=-1),p.clearcoatNormalScale&&(p.clearcoatNormalScale.y*=-1)),this.cache.add(u,p),this.associations.set(p,this.associations.get(n))),n=p}n.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=n}getMaterialType(){return c.Wid}loadMaterial(e){const t=this,n=this.json,r=this.extensions,o=n.materials[e];let a;const u={},p=o.extensions||{},f=[];if(p[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const y=r[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];a=y.getMaterialType(),f.push(y.extendParams(u,o,t))}else if(p[ei.KHR_MATERIALS_UNLIT]){const y=r[ei.KHR_MATERIALS_UNLIT];a=y.getMaterialType(),f.push(y.extendParams(u,o,t))}else{const y=o.pbrMetallicRoughness||{};if(u.color=new c.Ilk(1,1,1),u.opacity=1,Array.isArray(y.baseColorFactor)){const S=y.baseColorFactor;u.color.fromArray(S),u.opacity=S[3]}y.baseColorTexture!==void 0&&f.push(t.assignTexture(u,"map",y.baseColorTexture,c.knz)),u.metalness=y.metallicFactor!==void 0?y.metallicFactor:1,u.roughness=y.roughnessFactor!==void 0?y.roughnessFactor:1,y.metallicRoughnessTexture!==void 0&&(f.push(t.assignTexture(u,"metalnessMap",y.metallicRoughnessTexture)),f.push(t.assignTexture(u,"roughnessMap",y.metallicRoughnessTexture))),a=this._invokeOne(function(S){return S.getMaterialType&&S.getMaterialType(e)}),f.push(Promise.all(this._invokeAll(function(S){return S.extendMaterialParams&&S.extendMaterialParams(e,u)})))}o.doubleSided===!0&&(u.side=c.ehD);const m=o.alphaMode||"OPAQUE";if(m==="BLEND"?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,m==="MASK"&&(u.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&a!==c.vBJ&&(f.push(t.assignTexture(u,"normalMap",o.normalTexture)),u.normalScale=new c.FM8(1,1),o.normalTexture.scale!==void 0)){const y=o.normalTexture.scale;u.normalScale.set(y,y)}return o.occlusionTexture!==void 0&&a!==c.vBJ&&(f.push(t.assignTexture(u,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&a!==c.vBJ&&(u.emissive=new c.Ilk().fromArray(o.emissiveFactor)),o.emissiveTexture!==void 0&&a!==c.vBJ&&f.push(t.assignTexture(u,"emissiveMap",o.emissiveTexture,c.knz)),Promise.all(f).then(function(){let y;return y=a===Fp?r[ei.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(u):new a(u),o.name&&(y.name=o.name),Ko(y,o),t.associations.set(y,{materials:e}),o.extensions&&bn(r,y,o),y})}createUniqueName(e){const t=c.iUV.sanitizeNodeName(e||"");let n=t;for(let r=1;this.nodeNamesUsed[n];++r)n=t+"_"+r;return this.nodeNamesUsed[n]=!0,n}loadGeometries(e){const t=this,n=this.extensions,r=this.primitiveCache;function o(u){return n[ei.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,t).then(function(p){return bo(p,u,t)})}const a=[];for(let u=0,p=e.length;u<p;u++){const f=e[u],m=Fc(f),y=r[m];if(y)a.push(y.promise);else{let S;S=f.extensions&&f.extensions[ei.KHR_DRACO_MESH_COMPRESSION]?o(f):bo(new c.u9r,f,t),r[m]={primitive:f,promise:S},a.push(S)}}return Promise.all(a)}loadMesh(e){const t=this,n=this.json,r=this.extensions,o=n.meshes[e],a=o.primitives,u=[];for(let f=0,m=a.length;f<m;f++){const y=a[f].material===void 0?((p=this.cache).DefaultMaterial===void 0&&(p.DefaultMaterial=new c.Wid({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:c.Wl3})),p.DefaultMaterial):this.getDependency("material",a[f].material);u.push(y)}var p;return u.push(t.loadGeometries(a)),Promise.all(u).then(function(f){const m=f.slice(0,f.length-1),y=f[f.length-1],S=[];for(let P=0,D=y.length;P<D;P++){const j=y[P],k=a[P];let L;const R=m[P];if(k.mode===4||k.mode===5||k.mode===6||k.mode===void 0)L=o.isSkinnedMesh===!0?new c.TUv(j,R):new c.Kj0(j,R),L.isSkinnedMesh!==!0||L.geometry.attributes.skinWeight.normalized||L.normalizeSkinWeights(),k.mode===5?L.geometry=Ru(L.geometry,c.UlW):k.mode===6&&(L.geometry=Ru(L.geometry,c.z$h));else if(k.mode===1)L=new c.ejS(j,R);else if(k.mode===3)L=new c.x12(j,R);else if(k.mode===2)L=new c.blk(j,R);else{if(k.mode!==0)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+k.mode);L=new c.woe(j,R)}Object.keys(L.geometry.morphAttributes).length>0&&Bh(L,o),L.name=t.createUniqueName(o.name||"mesh_"+e),Ko(L,o),k.extensions&&bn(r,L,k),t.assignFinalMaterial(L),S.push(L)}o.extensions&&S.forEach(P=>bn(r,P,o));for(let P=0,D=S.length;P<D;P++)t.associations.set(S[P],{meshes:e,primitives:P});if(S.length===1)return S[0];const M=new c.ZAu;t.associations.set(M,{meshes:e});for(let P=0,D=S.length;P<D;P++)M.add(S[P]);return M})}loadCamera(e){let t;const n=this.json.cameras[e],r=n[n.type];if(r)return n.type==="perspective"?t=new c.cPb(c.M8C.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):n.type==="orthographic"&&(t=new c.iKG(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),Ko(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){const t=this.json.skins[e],n={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then(function(r){return n.inverseBindMatrices=r,n})}loadAnimation(e){const t=this.json.animations[e],n=[],r=[],o=[],a=[],u=[];for(let p=0,f=t.channels.length;p<f;p++){const m=t.channels[p],y=t.samplers[m.sampler],S=m.target,M=S.node,P=t.parameters!==void 0?t.parameters[y.input]:y.input,D=t.parameters!==void 0?t.parameters[y.output]:y.output;n.push(this.getDependency("node",M)),r.push(this.getDependency("accessor",P)),o.push(this.getDependency("accessor",D)),a.push(y),u.push(S)}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(u)]).then(function(p){const f=p[0],m=p[1],y=p[2],S=p[3],M=p[4],P=[];for(let j=0,k=f.length;j<k;j++){const L=f[j],R=m[j],W=y[j],q=S[j],J=M[j];if(L===void 0)continue;let ee;switch(L.updateMatrix(),Ro[J.path]){case Ro.weights:ee=c.dUE;break;case Ro.rotation:ee=c.iLg;break;default:ee=c.yC1}const he=L.name?L.name:L.uuid,xe=q.interpolation!==void 0?Id[q.interpolation]:c.NMF,De=[];Ro[J.path]===Ro.weights?L.traverse(function(ke){ke.morphTargetInfluences&&De.push(ke.name?ke.name:ke.uuid)}):De.push(he);let Fe=W.array;if(W.normalized){const ke=Up(Fe.constructor),Qe=new Float32Array(Fe.length);for(let Oe=0,ze=Fe.length;Oe<ze;Oe++)Qe[Oe]=Fe[Oe]*ke;Fe=Qe}for(let ke=0,Qe=De.length;ke<Qe;ke++){const Oe=new ee(De[ke]+"."+Ro[J.path],R.array,Fe,xe);q.interpolation==="CUBICSPLINE"&&(Oe.createInterpolant=function(ze){return new(this instanceof c.iLg?Iu:ya)(this.times,this.values,this.getValueSize()/3,ze)},Oe.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),P.push(Oe)}}const D=t.name?t.name:"animation_"+e;return new c.m7l(D,void 0,P)})}createNodeMesh(e){const t=this.json,n=this,r=t.nodes[e];return r.mesh===void 0?null:n.getDependency("mesh",r.mesh).then(function(o){const a=n._getNodeRef(n.meshCache,r.mesh,o);return r.weights!==void 0&&a.traverse(function(u){if(u.isMesh)for(let p=0,f=r.weights.length;p<f;p++)u.morphTargetInfluences[p]=r.weights[p]}),a})}loadNode(e){const t=this.json,n=this.extensions,r=this,o=t.nodes[e],a=o.name?r.createUniqueName(o.name):"";return function(){const u=[],p=r._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(e)});return p&&u.push(p),o.camera!==void 0&&u.push(r.getDependency("camera",o.camera).then(function(f){return r._getNodeRef(r.cameraCache,o.camera,f)})),r._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(e)}).forEach(function(f){u.push(f)}),Promise.all(u)}().then(function(u){let p;if(p=o.isBone===!0?new c.N$j:u.length>1?new c.ZAu:u.length===1?u[0]:new c.Tme,p!==u[0])for(let f=0,m=u.length;f<m;f++)p.add(u[f]);if(o.name&&(p.userData.name=o.name,p.name=a),Ko(p,o),o.extensions&&bn(n,p,o),o.matrix!==void 0){const f=new c.yGw;f.fromArray(o.matrix),p.applyMatrix4(f)}else o.translation!==void 0&&p.position.fromArray(o.translation),o.rotation!==void 0&&p.quaternion.fromArray(o.rotation),o.scale!==void 0&&p.scale.fromArray(o.scale);return r.associations.has(p)||r.associations.set(p,{}),r.associations.get(p).nodes=e,p})}loadScene(e){const t=this.json,n=this.extensions,r=this.json.scenes[e],o=this,a=new c.ZAu;r.name&&(a.name=o.createUniqueName(r.name)),Ko(a,r),r.extensions&&bn(n,a,r);const u=r.nodes||[],p=[];for(let f=0,m=u.length;f<m;f++)p.push(Zi(u[f],a,t,o));return Promise.all(p).then(function(){return o.associations=(f=>{const m=new Map;for(const[y,S]of o.associations)(y instanceof c.F5T||y instanceof c.xEZ)&&m.set(y,S);return f.traverse(y=>{const S=o.associations.get(y);S!=null&&m.set(y,S)}),m})(a),a})}}function Zi(s,e,t,n){const r=t.nodes[s];return n.getDependency("node",s).then(function(o){if(r.skin===void 0)return o;let a;return n.getDependency("skin",r.skin).then(function(u){a=u;const p=[];for(let f=0,m=a.joints.length;f<m;f++)p.push(n.getDependency("node",a.joints[f]));return Promise.all(p)}).then(function(u){return o.traverse(function(p){if(!p.isMesh)return;const f=[],m=[];for(let y=0,S=u.length;y<S;y++){const M=u[y];if(M){f.push(M);const P=new c.yGw;a.inverseBindMatrices!==void 0&&P.fromArray(a.inverseBindMatrices.array,16*y),m.push(P)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',a.joints[y])}p.bind(new c.OdW(f,m),p.matrixWorld)}),o})}).then(function(o){e.add(o);const a=[];if(r.children){const u=r.children;for(let p=0,f=u.length;p<f;p++){const m=u[p];a.push(Zi(m,o,t,n))}}return Promise.all(a)})}function bo(s,e,t){const n=e.attributes,r=[];function o(a,u){return t.getDependency("accessor",a).then(function(p){s.setAttribute(u,p)})}for(const a in n){const u=Pu[a]||a.toLowerCase();u in s.attributes||r.push(o(n[a],u))}if(e.indices!==void 0&&!s.index){const a=t.getDependency("accessor",e.indices).then(function(u){s.setIndex(u)});r.push(a)}return Ko(s,e),function(a,u,p){const f=u.attributes,m=new c.ZzF;if(f.POSITION===void 0)return;{const M=p.json.accessors[f.POSITION],P=M.min,D=M.max;if(P===void 0||D===void 0)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(m.set(new c.Pa4(P[0],P[1],P[2]),new c.Pa4(D[0],D[1],D[2])),M.normalized){const j=Up(qs[M.componentType]);m.min.multiplyScalar(j),m.max.multiplyScalar(j)}}const y=u.targets;if(y!==void 0){const M=new c.Pa4,P=new c.Pa4;for(let D=0,j=y.length;D<j;D++){const k=y[D];if(k.POSITION!==void 0){const L=p.json.accessors[k.POSITION],R=L.min,W=L.max;if(R!==void 0&&W!==void 0){if(P.setX(Math.max(Math.abs(R[0]),Math.abs(W[0]))),P.setY(Math.max(Math.abs(R[1]),Math.abs(W[1]))),P.setZ(Math.max(Math.abs(R[2]),Math.abs(W[2]))),L.normalized){const q=Up(qs[L.componentType]);P.multiplyScalar(q)}M.max(P)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}m.expandByVector(M)}a.boundingBox=m;const S=new c.aLr;m.getCenter(S.center),S.radius=m.min.distanceTo(m.max)/2,a.boundingSphere=S}(s,e,t),Promise.all(r).then(function(){return e.targets!==void 0?function(a,u,p){let f=!1,m=!1,y=!1;for(let D=0,j=u.length;D<j;D++){const k=u[D];if(k.POSITION!==void 0&&(f=!0),k.NORMAL!==void 0&&(m=!0),k.COLOR_0!==void 0&&(y=!0),f&&m&&y)break}if(!f&&!m&&!y)return Promise.resolve(a);const S=[],M=[],P=[];for(let D=0,j=u.length;D<j;D++){const k=u[D];if(f){const L=k.POSITION!==void 0?p.getDependency("accessor",k.POSITION):a.attributes.position;S.push(L)}if(m){const L=k.NORMAL!==void 0?p.getDependency("accessor",k.NORMAL):a.attributes.normal;M.push(L)}if(y){const L=k.COLOR_0!==void 0?p.getDependency("accessor",k.COLOR_0):a.attributes.color;P.push(L)}}return Promise.all([Promise.all(S),Promise.all(M),Promise.all(P)]).then(function(D){const j=D[0],k=D[1],L=D[2];return f&&(a.morphAttributes.position=j),m&&(a.morphAttributes.normal=k),y&&(a.morphAttributes.color=L),a.morphTargetsRelative=!0,a})}(s,e.targets,t):s})}function Ru(s,e){let t=s.getIndex();if(t===null){const a=[],u=s.getAttribute("position");if(u===void 0)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),s;for(let p=0;p<u.count;p++)a.push(p);s.setIndex(a),t=s.getIndex()}const n=t.count-2,r=[];if(e===c.z$h)for(let a=1;a<=n;a++)r.push(t.getX(0)),r.push(t.getX(a)),r.push(t.getX(a+1));else for(let a=0;a<n;a++)a%2==0?(r.push(t.getX(a)),r.push(t.getX(a+1)),r.push(t.getX(a+2))):(r.push(t.getX(a+2)),r.push(t.getX(a+1)),r.push(t.getX(a)));r.length/3!==n&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=s.clone();return o.setIndex(r),o}class Tm extends ml{constructor(e){super(e),this.isGLTFLoader2=!0}async loadAsync(e,t){const n=await super.loadAsync(e,t),r=n?n.scene||n.scenes&&n.scenes.length>0&&n.scenes[0]:void 0;return r&&n.animations.length>0&&(r.animations=n.animations),r.traverse(o=>{o.userData.gltfUUID&&(o.uuid=o.userData.gltfUUID,delete o.userData.gltfUUID)}),r}register(e){return super.register(e)}}class Uc extends c.hH6{constructor(e){super(e),this.type=c.cLu}async loadAsync(e,t){const n=await this.parseAsync(e,t,!1),r=new c.IEO(n.data,n.width,n.height,c.wk1,this.type);return r.needsUpdate=!0,r.flipY=!0,r.encoding=c.rnI,r.minFilter=c.wem,r.magFilter=c.wem,r.source.data.complete=!0,r}async parseAsync(e,t,n=!1){if(!e.startsWith("data:")){this.responseType="blob";const u=await super.loadAsync(e,t);e=(e=await ps(u)).replace("application/octet-stream","image/png")}const r=await Aa(e);let o=Uint8Array;return this.type===c.cLu?o=Uint16Array:this.type===c.VzW&&(o=Uint32Array),{data:function(u,p=3,f=Uint16Array,m=!1){let y;const S=u.byteLength>>2,M=new f(S*p);for(let P=0;P<S;P++)y=Math.pow(2,u[4*P+3]-136),m?(M[P*p]=Math.min(u[4*P]*y,65504),M[P*p+1]=Math.min(u[4*P+1]*y,65504),M[P*p+2]=Math.min(u[4*P+2]*y,65504)):(M[P*p]=c.A5E.toHalfFloat(Math.min(u[4*P]*y,65504)),M[P*p+1]=c.A5E.toHalfFloat(Math.min(u[4*P+1]*y,65504)),M[P*p+2]=c.A5E.toHalfFloat(Math.min(u[4*P+2]*y,65504))),p===4&&(M[P*p+3]=c.A5E.toHalfFloat(1));return M}(r.data,4,o,n),width:r.width,height:r.height}}setDataType(e){return this.type=e,this}}class Pd extends c.Gql{constructor(e){super(e),this._imageLoader=new c.S3k(e)}parseTextures2(e,t,n){var r;for(const o of e){const a=(r=o==null?void 0:o.userData)===null||r===void 0?void 0:r.rootPath;if(a&&(!o.image||!t[o.image])){const u=new c.Hw6(this._imageLoader.load(a,n));if(!u)continue;o.image&&(u.uuid=o.image),t[u.uuid]=u,o.image=u.uuid}o.userData=kt(o.userData,void 0,!1,{images:t})}return super.parseTextures(e,t)}parseMaterials2(e,t,n){const r={};return e.forEach(o=>{if(!o)return;const a={...o},u=Object.keys(a);for(const f of u)if(f==="map"||f.endsWith("Map")){const m=a[f];typeof m=="string"&&(t[m]?a[f]=t[m]:(console.warn(`Texture ${m} not found`),delete a[f]))}a.userData&&(a.userData=kt(a.userData,void 0,!1,{textures:t}));const p=n.generateFromTemplateType(a.type,a);p&&(r[o.uuid]=p)}),r}}const Jo="WEBGI_viewer";function Ps(s){bi.Importers.push(new Nr(Tm,["gltf","glb","data:model/gltf"],!0,(e,t)=>{if(!e)return e;const n=e,r=new Pd(t.loadingManager);return n.register(vl(r,s)),n.register(jc()),n.register(zc(r)),n.register(o=>new $l(o)),n.register(o=>new wo(o)),n.register(o=>new Bu(o)),n.register(o=>new Rd(o)),n.register(o=>{var a,u,p,f,m,y,S,M,P;const D=ki()+".drc",j=ki()+".ktx2",k=(p=(u=(a=o.json)===null||a===void 0?void 0:a.extensionsRequired)===null||u===void 0?void 0:u.includes)===null||p===void 0?void 0:p.call(u,"KHR_draco_mesh_compression");if(k){const R=t.registerFile(D);R&&n.setDRACOLoader(R)}!((y=(m=(f=o.json)===null||f===void 0?void 0:f.extensionsUsed)===null||m===void 0?void 0:m.includes)===null||y===void 0)&&y.call(m,"EXT_meshopt_compression")&&(window.MeshoptDecoder?(n.setMeshoptDecoder(window.MeshoptDecoder),o.options.meshoptDecoder=window.MeshoptDecoder):console.error("Add GLTFMeshOptPlugin to viewer to enable EXT_meshopt_compression decode"));const L=(P=(M=(S=o.json)===null||S===void 0?void 0:S.extensionsUsed)===null||M===void 0?void 0:M.includes)===null||P===void 0?void 0:P.call(M,"KHR_texture_basisu");if(L){const R=t.registerFile(j);R&&(n.setKTX2Loader(R),o.options.ktx2Loader=R)}return{name:"GLTF2_HELPER_PLUGIN",afterRoot:async R=>{k&&t.unregisterFile(D),L&&t.unregisterFile(j);const W=await Dd(o,s,r);R.scene.__importedViewerConfig=W}}}),n}))}const Re="WEBGI_light_extras",_l="WEBGI_object3d_extras",$o="WEBGI_material_extras",jc=s=>e=>({name:"__"+_l,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(r=>{var o,a;if(!r.isObject3D)return;const u=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[_l];if(!u)return void(r.isLight&&!r.isAmbientLight&&(r.castShadow=!0));const p=u.castShadow!==void 0||u.receiveShadow!==void 0;u.castShadow!==void 0&&(r.castShadow=u.castShadow),u.receiveShadow!==void 0&&(r.receiveShadow=u.receiveShadow),u.visible!==void 0&&(r.visible=u.visible),u.frustumCulled!==void 0&&(r.frustumCulled=u.frustumCulled),u.renderOrder!==void 0&&(r.renderOrder=u.renderOrder),u.layers!==void 0&&(r.layers.mask=u.layers),p&&(r.userData.__keepShadowDef=!0),delete r.userData.gltfExtensions[_l]})})}}),vl=(s,e)=>t=>({name:"__"+$o,afterRoot:async n=>{var r,o,a;const u=n.scenes||(n.scene?[n.scene]:[]);for(const p of u){const f=(o=(r=p.userData)===null||r===void 0?void 0:r.gltfExtensions)===null||o===void 0?void 0:o[$o],m=f&&await((a=e.getPlugin(dn))===null||a===void 0?void 0:a.importConfigResources(f.resources||{}))||{};p.traverse(y=>{var S,M;const P=y==null?void 0:y.material;if(!(P!=null&&P.isMaterial))return;const D=(M=(S=P.userData)===null||S===void 0?void 0:S.gltfExtensions)===null||M===void 0?void 0:M[$o];D&&(D.emissiveIntensity!==void 0&&(P.emissiveIntensity=D.emissiveIntensity),D.fog!==void 0&&(P.fog=D.fog),D.flatShading!==void 0&&(P.flatShading=D.flatShading),D.blending!==void 0&&(P.blending=D.blending),D.side!==void 0&&(P.side=D.side),D.shadowSide!==void 0&&(P.shadowSide=D.shadowSide),D.depthFunc!==void 0&&(P.depthFunc=D.depthFunc),D.depthTest!==void 0&&(P.depthTest=D.depthTest),D.depthWrite!==void 0&&(P.depthWrite=D.depthWrite),D.colorWrite!==void 0&&(P.colorWrite=D.colorWrite),D.wireframe!==void 0&&(P.wireframe=D.wireframe),D.wireframeLinewidth!==void 0&&(P.wireframeLinewidth=D.wireframeLinewidth),D.wireframeLinecap!==void 0&&(P.wireframeLinecap=D.wireframeLinecap),D.wireframeLinejoin!==void 0&&(P.wireframeLinejoin=D.wireframeLinejoin),D.rotation!==void 0&&(P.rotation=D.rotation),D.polygonOffset!==void 0&&(P.polygonOffset=D.polygonOffset),D.polygonOffsetFactor!==void 0&&(P.polygonOffsetFactor=D.polygonOffsetFactor),D.polygonOffsetUnits!==void 0&&(P.polygonOffsetUnits=D.polygonOffsetUnits),D.dithering!==void 0&&(P.dithering=D.dithering),D.alphaToCoverage!==void 0&&(P.alphaToCoverage=D.alphaToCoverage),D.premultipliedAlpha!==void 0&&(P.premultipliedAlpha=D.premultipliedAlpha),D.toneMapped!==void 0&&(P.toneMapped=D.toneMapped),D.reflectivity!==void 0&&(P.reflectivity=D.reflectivity),Object.entries(D).forEach(([j,k])=>{j.startsWith("_")||k&&k.resource&&typeof k.resource=="string"&&(P[j]=kt(k,P[j],!1,m))}),delete P.userData.gltfExtensions[$o])}),f&&delete p.userData.gltfExtensions[$o]}}}),zc=s=>e=>({name:"__"+Re,afterRoot:async t=>{(t.scenes||(t.scene?[t.scene]:[])).forEach(n=>{n.traverse(r=>{var o,a;if(!r.isLight)return;const u=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[Re];u&&(!r.shadow&&u.shadow&&console.error("Light has no shadow, cannot import",r,u),u.shadow&&r.shadow&&(u.shadow.bias!==void 0&&(r.shadow.bias=u.shadow.bias),u.shadow.normalBias!==void 0&&(r.shadow.normalBias=u.shadow.normalBias),u.shadow.radius!==void 0&&(r.shadow.radius=u.shadow.radius),u.shadow.mapSize!==void 0&&r.shadow.mapSize.fromArray(u.shadow.mapSize),u.shadow.camera!==void 0&&(r.shadow.camera=s.parseObject(u.shadow.camera))),delete r.userData.gltfExtensions[Re])})})}});async function Dd(s,e,t,n){var r;if(!n){const p=s.json.scenes||[];if(p.length!==1){for(const f of p)await Dd(s,e,f);return}n=p[0]}const o=(r=n.extensions)===null||r===void 0?void 0:r[Jo];if(!o)return;const a=[];Object.values(o.resources).forEach(p=>{Object.values(p).forEach(f=>{f.url&&(f.url.type==="Uint16Array"&&f.url.data&&a.push(f.url),f.url.type==="Uint8Array"&&f.url.data&&a.push(f.url))})});for(const p of a){const f=p.data.image,m=s.json.images[f],y=await s.getDependency("bufferView",m.bufferView);if(m.mimeType.startsWith("image/")&&p.type==="Uint16Array"&&p.encoding==="rgbe"){const S=new Blob([y],{type:m.mimeType}),M="data:image/png;base64,"+btoa(await S.text());p.data=(await new Uc().parseAsync(M,void 0,!0)).data,delete p.encoding}else p.data=y}const u={textures:{}};if(o.resources.textures&&s.json.textures)for(const[p,f]of Object.entries(o.resources.textures)){if(f.uuid||!p)continue;delete o.resources.textures[p];const m=s.json.textures.findIndex(y=>{var S,M,P,D,j,k,L;return((S=y.extras)===null||S===void 0?void 0:S.uuid)===p||((D=(P=(M=s.json.samplers)===null||M===void 0?void 0:M[y.sampler])===null||P===void 0?void 0:P.extras)===null||D===void 0?void 0:D.uuid)===p||((L=(k=(j=s.json.images)===null||j===void 0?void 0:j[y.source])===null||k===void 0?void 0:k.extras)===null||L===void 0?void 0:L.t_uuid)===p});m>=0&&(u.textures[p]=await s.getDependency("texture",m))}if(o.resources.materials&&s.json.materials)for(const[p,f]of Object.entries(o.resources.materials)){if(f.uuid||!p)continue;delete o.resources.materials[p];const m=s.json.materials.findIndex(y=>{var S;return((S=y.extras)===null||S===void 0?void 0:S.uuid)===p});m>=0&&(u.materials[p]=await s.getDependency("material",m))}return o.resources=await e.getPlugin(dn).importConfigResources(o.resources||{},t,u),o}const ba="WEBGI_materials_bumpmap",Jl="WEBGI_materials_displacementmap",Al="WEBGI_materials_alphamap",wa="WEBGI_materials_lightmap";class $l{constructor(e){this.parser=e,this.name=ba}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.bumpScale!==void 0&&(t.bumpScale=a.bumpScale),a.bumpTexture!==void 0&&o.push(n.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(o)}}class wo{constructor(e){this.parser=e,this.name=Jl}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.displacementScale!==void 0&&(t.displacementScale=a.displacementScale),a.displacementBias!==void 0&&(t.displacementBias=a.displacementBias),a.displacementTexture!==void 0&&o.push(n.assignTexture(t,"displacementMap",a.displacementTexture)),Promise.all(o)}}class Bu{constructor(e){this.parser=e,this.name=wa}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.lightMapIntensity!==void 0&&(t.lightMapIntensity=a.lightMapIntensity),a.lightMapTexture!==void 0&&o.push(n.assignTexture(t,"lightMap",a.lightMapTexture)),Promise.all(o)}}class Rd{constructor(e){this.parser=e,this.name=Al}async extendMaterialParams(e,t){const n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const o=[],a=r.extensions[this.name];return a.alphaTexture!==void 0&&o.push(n.assignTexture(t,"alphaMap",a.alphaTexture)),Promise.all(o)}}var Vc=__webpackgi_require__(23);function Zl(){bi.Importers.push(new Nr(Vc.Q,["drc"],!0))}var Bd={},Li=Uint8Array,Mr=Uint16Array,Zo=Uint32Array,Bo=new Li([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ea=new Li([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hs=new Li([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),kd=function(s,e){for(var t=new Mr(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var r=new Zo(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return[t,r]},ku=kd(Bo,2),Ga=ku[0],Ou=ku[1];Ga[28]=258,Ou[258]=28;for(var kh=kd(ea,0),Od=kh[0],ec=kh[1],ti=new Mr(32768),ur=0;ur<32768;++ur){var vs=(43690&ur)>>>1|(21845&ur)<<1;vs=(61680&(vs=(52428&vs)>>>2|(13107&vs)<<2))>>>4|(3855&vs)<<4,ti[ur]=((65280&vs)>>>8|(255&vs)<<8)>>>1}var ta=function(s,e,t){for(var n=s.length,r=0,o=new Mr(e);r<n;++r)++o[s[r]-1];var a,u=new Mr(e);for(r=0;r<e;++r)u[r]=u[r-1]+o[r-1]<<1;if(t){a=new Mr(1<<e);var p=15-e;for(r=0;r<n;++r)if(s[r])for(var f=r<<4|s[r],m=e-s[r],y=u[s[r]-1]++<<m,S=y|(1<<m)-1;y<=S;++y)a[ti[y]>>>p]=f}else for(a=new Mr(n),r=0;r<n;++r)s[r]&&(a[r]=ti[u[s[r]-1]++]>>>15-s[r]);return a},yl=new Li(288);for(ur=0;ur<144;++ur)yl[ur]=8;for(ur=144;ur<256;++ur)yl[ur]=9;for(ur=256;ur<280;++ur)yl[ur]=7;for(ur=280;ur<288;++ur)yl[ur]=8;var As=new Li(32);for(ur=0;ur<32;++ur)As[ur]=5;var Lu=ta(yl,9,0),xo=ta(yl,9,1),jp=ta(As,5,0),Oh=ta(As,5,1),xa=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},so=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},bl=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},Gc=function(s){return(s/8|0)+(7&s&&1)},Ds=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Mr?Mr:s instanceof Zo?Zo:Li)(t-e);return n.set(s.subarray(e,t)),n},ko=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new Li(0);var r=!e||t,o=!t||t.i;t||(t={}),e||(e=new Li(3*n));var a=function(Mn){var Rt=e.length;if(Mn>Rt){var oi=new Li(Math.max(2*Rt,Mn));oi.set(e),e=oi}},u=t.f||0,p=t.p||0,f=t.b||0,m=t.l,y=t.d,S=t.m,M=t.n,P=8*n;do{if(!m){t.f=u=so(s,p,1);var D=so(s,p+1,3);if(p+=3,!D){var j=s[(Fe=Gc(p)+4)-4]|s[Fe-3]<<8,k=Fe+j;if(k>n){if(o)throw"unexpected EOF";break}r&&a(f+j),e.set(s.subarray(Fe,k),f),t.b=f+=j,t.p=p=8*k;continue}if(D==1)m=xo,y=Oh,S=9,M=5;else{if(D!=2)throw"invalid block type";var L=so(s,p,31)+257,R=so(s,p+10,15)+4,W=L+so(s,p+5,31)+1;p+=14;for(var q=new Li(W),J=new Li(19),ee=0;ee<R;++ee)J[hs[ee]]=so(s,p+3*ee,7);p+=3*R;var he=xa(J),xe=(1<<he)-1,De=ta(J,he,1);for(ee=0;ee<W;){var Fe,ke=De[so(s,p,xe)];if(p+=15&ke,(Fe=ke>>>4)<16)q[ee++]=Fe;else{var Qe=0,Oe=0;for(Fe==16?(Oe=3+so(s,p,3),p+=2,Qe=q[ee-1]):Fe==17?(Oe=3+so(s,p,7),p+=3):Fe==18&&(Oe=11+so(s,p,127),p+=7);Oe--;)q[ee++]=Qe}}var ze=q.subarray(0,L),$e=q.subarray(L);S=xa(ze),M=xa($e),m=ta(ze,S,1),y=ta($e,M,1)}if(p>P){if(o)throw"unexpected EOF";break}}r&&a(f+131072);for(var Ge=(1<<S)-1,ot=(1<<M)-1,yt=p;;yt=p){var Mt=(Qe=m[bl(s,p)&Ge])>>>4;if((p+=15&Qe)>P){if(o)throw"unexpected EOF";break}if(!Qe)throw"invalid length/literal";if(Mt<256)e[f++]=Mt;else{if(Mt==256){yt=p,m=null;break}var pt=Mt-254;if(Mt>264){var Qt=Bo[ee=Mt-257];pt=so(s,p,(1<<Qt)-1)+Ga[ee],p+=Qt}var Kt=y[bl(s,p)&ot],Jt=Kt>>>4;if(!Kt)throw"invalid distance";if(p+=15&Kt,$e=Od[Jt],Jt>3&&(Qt=ea[Jt],$e+=bl(s,p)&(1<<Qt)-1,p+=Qt),p>P){if(o)throw"unexpected EOF";break}r&&a(f+131072);for(var tn=f+pt;f<tn;f+=4)e[f]=e[f-$e],e[f+1]=e[f+1-$e],e[f+2]=e[f+2-$e],e[f+3]=e[f+3-$e];f=tn}}t.l=m,t.p=yt,t.b=f,m&&(u=1,t.m=S,t.d=y,t.n=M)}while(!u);return f==e.length?e:Ds(e,0,f)},Ys=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},Qa=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},Ld=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return[pi,0];if(r==1){var a=new Li(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(q,J){return q.f-J.f}),t.push({s:-1,f:25001});var u=t[0],p=t[1],f=0,m=1,y=2;for(t[0]={s:-1,f:u.f+p.f,l:u,r:p};m!=r-1;)u=t[t[f].f<t[y].f?f++:y++],p=t[f!=m&&t[f].f<t[y].f?f++:y++],t[m++]={s:-1,f:u.f+p.f,l:u,r:p};var S=o[0].s;for(n=1;n<r;++n)o[n].s>S&&(S=o[n].s);var M=new Mr(S+1),P=tc(t[m-1],M,0);if(P>e){n=0;var D=0,j=P-e,k=1<<j;for(o.sort(function(q,J){return M[J.s]-M[q.s]||q.f-J.f});n<r;++n){var L=o[n].s;if(!(M[L]>e))break;D+=k-(1<<P-M[L]),M[L]=e}for(D>>>=j;D>0;){var R=o[n].s;M[R]<e?D-=1<<e-M[R]++-1:++n}for(;n>=0&&D;--n){var W=o[n].s;M[W]==e&&(--M[W],++D)}P=e}return[new Li(M),P]},tc=function(s,e,t){return s.s==-1?Math.max(tc(s.l,e,t+1),tc(s.r,e,t+1)):e[s.s]=t},Lh=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Mr(++e),n=0,r=s[0],o=1,a=function(p){t[n++]=p},u=1;u<=e;++u)if(s[u]==r&&u!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=s[u]}return[t.subarray(0,n),e]},Qc=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},nc=function(s,e,t){var n=t.length,r=Gc(e+2);s[r]=255&n,s[r+1]=n>>>8,s[r+2]=255^s[r],s[r+3]=255^s[r+1];for(var o=0;o<n;++o)s[r+o+4]=t[o];return 8*(r+4+n)},Nd=function(s,e,t,n,r,o,a,u,p,f,m){Ys(e,m++,t),++r[256];for(var y=Ld(r,15),S=y[0],M=y[1],P=Ld(o,15),D=P[0],j=P[1],k=Lh(S),L=k[0],R=k[1],W=Lh(D),q=W[0],J=W[1],ee=new Mr(19),he=0;he<L.length;++he)ee[31&L[he]]++;for(he=0;he<q.length;++he)ee[31&q[he]]++;for(var xe=Ld(ee,7),De=xe[0],Fe=xe[1],ke=19;ke>4&&!De[hs[ke-1]];--ke);var Qe,Oe,ze,$e,Ge=f+5<<3,ot=Qc(r,yl)+Qc(o,As)+a,yt=Qc(r,S)+Qc(o,D)+a+14+3*ke+Qc(ee,De)+(2*ee[16]+3*ee[17]+7*ee[18]);if(Ge<=ot&&Ge<=yt)return nc(e,m,s.subarray(p,p+f));if(Ys(e,m,1+(yt<ot)),m+=2,yt<ot){Qe=ta(S,M,0),Oe=S,ze=ta(D,j,0),$e=D;var Mt=ta(De,Fe,0);for(Ys(e,m,R-257),Ys(e,m+5,J-1),Ys(e,m+10,ke-4),m+=14,he=0;he<ke;++he)Ys(e,m+3*he,De[hs[he]]);m+=3*ke;for(var pt=[L,q],Qt=0;Qt<2;++Qt){var Kt=pt[Qt];for(he=0;he<Kt.length;++he){var Jt=31&Kt[he];Ys(e,m,Mt[Jt]),m+=De[Jt],Jt>15&&(Ys(e,m,Kt[he]>>>5&127),m+=Kt[he]>>>12)}}}else Qe=Lu,Oe=yl,ze=jp,$e=As;for(he=0;he<u;++he)if(n[he]>255){Jt=n[he]>>>18&31,Qa(e,m,Qe[Jt+257]),m+=Oe[Jt+257],Jt>7&&(Ys(e,m,n[he]>>>23&31),m+=Bo[Jt]);var tn=31&n[he];Qa(e,m,ze[tn]),m+=$e[tn],tn>3&&(Qa(e,m,n[he]>>>5&8191),m+=ea[tn])}else Qa(e,m,Qe[n[he]]),m+=Oe[n[he]];return Qa(e,m,Qe[256]),m+Oe[256]},zp=new Zo([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),pi=new Li(0),na=function(s,e,t,n,r,o){var a=s.length,u=new Li(n+a+5*(1+Math.ceil(a/7e3))+r),p=u.subarray(n,u.length-r),f=0;if(!e||a<8)for(var m=0;m<=a;m+=65535){var y=m+65535;y<a?f=nc(p,f,s.subarray(m,y)):(p[m]=o,f=nc(p,f,s.subarray(m,a)))}else{for(var S=zp[e-1],M=S>>>13,P=8191&S,D=(1<<t)-1,j=new Mr(32768),k=new Mr(D+1),L=Math.ceil(t/3),R=2*L,W=function(gr){return(s[gr]^s[gr+1]<<L^s[gr+2]<<R)&D},q=new Zo(25e3),J=new Mr(288),ee=new Mr(32),he=0,xe=0,De=(m=0,0),Fe=0,ke=0;m<a;++m){var Qe=W(m),Oe=32767&m,ze=k[Qe];if(j[Oe]=ze,k[Qe]=Oe,Fe<=m){var $e=a-m;if((he>7e3||De>24576)&&$e>423){f=Nd(s,p,0,q,J,ee,xe,De,ke,m-ke,f),De=he=xe=0,ke=m;for(var Ge=0;Ge<286;++Ge)J[Ge]=0;for(Ge=0;Ge<30;++Ge)ee[Ge]=0}var ot=2,yt=0,Mt=P,pt=Oe-ze&32767;if($e>2&&Qe==W(m-pt))for(var Qt=Math.min(M,$e)-1,Kt=Math.min(32767,m),Jt=Math.min(258,$e);pt<=Kt&&--Mt&&Oe!=ze;){if(s[m+ot]==s[m+ot-pt]){for(var tn=0;tn<Jt&&s[m+tn]==s[m+tn-pt];++tn);if(tn>ot){if(ot=tn,yt=pt,tn>Qt)break;var Mn=Math.min(pt,tn-2),Rt=0;for(Ge=0;Ge<Mn;++Ge){var oi=m-pt+Ge+32768&32767,xi=oi-j[oi]+32768&32767;xi>Rt&&(Rt=xi,ze=oi)}}}pt+=(Oe=ze)-(ze=j[Oe])+32768&32767}if(yt){q[De++]=268435456|Ou[ot]<<18|ec[yt];var ai=31&Ou[ot],Yi=31&ec[yt];xe+=Bo[ai]+ea[Yi],++J[257+ai],++ee[Yi],Fe=m+ot,++he}else q[De++]=s[m],++J[s[m]]}}f=Nd(s,p,o,q,J,ee,xe,De,ke,m-ke,f),!o&&7&f&&(f=nc(p,f+1,pi))}return Ds(u,0,n+Gc(f)+r)},Ha=function(){for(var s=new Int32Array(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&-306674912)^t>>>1;s[e]=t}return s}(),oo=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=Ha[255&t^e[n]]^t>>>8;s=t},d:function(){return~s}}},Ea=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,o=t.length,a=0;a!=o;){for(var u=Math.min(a+2655,o);a<u;++a)r+=n+=t[a];n=(65535&n)+15*(n>>16),r=(65535&r)+15*(r>>16)}s=n,e=r},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},ia=function(s,e,t,n,r){return na(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!r)},ra=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},Fd=function(s,e,t){for(var n=s(),r=s.toString(),o=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var u=n[a],p=o[a];if(typeof u=="function"){e+=";"+p+"=";var f=u.toString();if(u.prototype)if(f.indexOf("[native code]")!=-1){var m=f.indexOf(" ",8)+1;e+=f.slice(m,f.indexOf("(",m))}else for(var y in e+=f,u.prototype)e+=";"+p+".prototype."+y+"="+u.prototype[y].toString();else e+=f}else t[p]=u}return[e,t]},Nu=[],Ud=function(s,e,t,n){var r;if(!Nu[t]){for(var o="",a={},u=s.length-1,p=0;p<u;++p)o=(r=Fd(s[p],o,a))[0],a=r[1];Nu[t]=Fd(s[u],o,a)}var f=ra({},Nu[t][1]);return function(m,y,S,M,P){var D=new Worker(Bd[y]||(Bd[y]=URL.createObjectURL(new Blob([m],{type:"text/javascript"}))));return D.onerror=function(j){return P(j.error,null)},D.onmessage=function(j){return P(null,j.data)},D.postMessage(S,M),D}(Nu[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,f,function(m){var y=[];for(var S in m)(m[S]instanceof Li||m[S]instanceof Mr||m[S]instanceof Zo)&&y.push((m[S]=new m[S].constructor(m[S])).buffer);return y}(f),n)},ic=function(){return[Li,Mr,Zo,Bo,ea,hs,Ga,Od,xo,Oh,ti,ta,xa,so,bl,Gc,Ds,ko,Xs,sa,mr]},Rs=function(){return[Li,Mr,Zo,Bo,ea,hs,Ou,ec,Lu,yl,jp,As,ti,zp,pi,ta,Ys,Qa,Ld,tc,Lh,Qc,nc,Nd,Gc,Ds,na,ia,In,sa]},Im=function(){return[_,ce,B,oo,Ha]},Bs=function(){return[E,V]},Wa=function(){return[Le,B,Ea]},Xr=function(){return[qe]},sa=function(s){return postMessage(s,[s.buffer])},mr=function(s){return s&&s.size&&new Li(s.size)},Fu=function(s,e,t,n,r,o){var a=Ud(t,n,r,function(u,p){a.terminate(),o(u,p)});return a.postMessage([s,e],e.consume?[s.buffer]:[]),function(){a.terminate()}},oa=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},Uu=function(s,e,t,n,r){var o,a=Ud(s,n,r,function(u,p){u?(a.terminate(),e.ondata.call(e,u)):(p[1]&&a.terminate(),e.ondata.call(e,u,p[0],p[1]))});a.postMessage(t),e.push=function(u,p){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([u,o=p],[u.buffer])},e.terminate=function(){a.terminate()}},ao=function(s,e){return s[e]|s[e+1]<<8},Ur=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},Vp=function(s,e){return Ur(s,e)+4294967296*Ur(s,e+4)},B=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},_=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&B(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},E=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;4&e&&(t+=s[10]|2+(s[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(2&e)},V=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},ce=function(s){return 10+(s.filename&&s.filename.length+1||0)},Le=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},qe=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function Et(s,e){return e||typeof s!="function"||(e=s,s={}),this.ondata=e,s}var Yt=function(){function s(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(ia(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),kn=function(){return function(s,e){Uu([Rs,function(){return[oa,Yt]}],this,Et.call(this,s,e),function(t){var n=new Yt(t.data);onmessage=oa(n)},6)}}();function Hn(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[Rs],function(n){return sa(In(n.data[0],n.data[1]))},0,t)}function In(s,e){return ia(s,e||{},0,0)}var Tr=function(){function s(e){this.s={},this.p=new Li(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new Li(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=ko(this.p,this.o,this.s);this.ondata(Ds(n,t,this.s.b),this.d),this.o=Ds(n,this.s.b-32768),this.s.b=this.o.length,this.p=Ds(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),es=function(){return function(s){this.ondata=s,Uu([ic,function(){return[oa,Tr]}],this,0,function(){var e=new Tr;onmessage=oa(e)},7)}}();function aa(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[ic],function(n){return sa(Xs(n.data[0],mr(n.data[1])))},1,t)}function Xs(s,e){return ko(s,e)}var Oo=function(){function s(e,t){this.c=oo(),this.l=0,this.v=1,Yt.call(this,e,t)}return s.prototype.push=function(e,t){Yt.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=ia(e,this.o,this.v&&ce(this.o),t&&8,!t);this.v&&(_(n,this.o),this.v=0),t&&(B(n,n.length-8,this.c.d()),B(n,n.length-4,this.l)),this.ondata(n,t)},s}(),Sa=function(){return function(s,e){Uu([Rs,Im,function(){return[oa,Yt,Oo]}],this,Et.call(this,s,e),function(t){var n=new Oo(t.data);onmessage=oa(n)},8)}}();function Hc(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[Rs,Im,function(){return[rc]}],function(n){return sa(rc(n.data[0],n.data[1]))},2,t)}function rc(s,e){e||(e={});var t=oo(),n=s.length;t.p(s);var r=ia(s,e,ce(e),8),o=r.length;return _(r,e),B(r,o-8,t.d()),B(r,o-4,n),r}var ju=function(){function s(e){this.v=1,Tr.call(this,e)}return s.prototype.push=function(e,t){if(Tr.prototype.e.call(this,e),this.v){var n=this.p.length>3?E(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}Tr.prototype.c.call(this,t)},s}(),Nh=function(){return function(s){this.ondata=s,Uu([ic,Bs,function(){return[oa,Tr,ju]}],this,0,function(){var e=new ju;onmessage=oa(e)},9)}}();function Fh(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[ic,Bs,function(){return[Uh]}],function(n){return sa(Uh(n.data[0]))},3,t)}function Uh(s,e){return ko(s.subarray(E(s),-8),e||new Li(V(s)))}var jd=function(){function s(e,t){this.c=Ea(),this.v=1,Yt.call(this,e,t)}return s.prototype.push=function(e,t){Yt.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=ia(e,this.o,this.v&&2,t&&4,!t);this.v&&(Le(n,this.o),this.v=0),t&&B(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),Pm=function(){return function(s,e){Uu([Rs,Wa,function(){return[oa,Yt,jd]}],this,Et.call(this,s,e),function(t){var n=new jd(t.data);onmessage=oa(n)},10)}}();function Dm(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[Rs,Wa,function(){return[Gp]}],function(n){return sa(Gp(n.data[0],n.data[1]))},4,t)}function Gp(s,e){e||(e={});var t=Ea();t.p(s);var n=ia(s,e,2,4);return Le(n,e),B(n,n.length-4,t.d()),n}var jh=function(){function s(e){this.v=1,Tr.call(this,e)}return s.prototype.push=function(e,t){if(Tr.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}Tr.prototype.c.call(this,t)},s}(),ks=function(){return function(s){this.ondata=s,Uu([ic,Xr,function(){return[oa,Tr,jh]}],this,0,function(){var e=new jh;onmessage=oa(e)},11)}}();function Qp(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Fu(s,e,[ic,Xr,function(){return[qa]}],function(n){return sa(qa(n.data[0],mr(n.data[1])))},5,t)}function qa(s,e){return ko((qe(s),s.subarray(2,-4)),e)}var zu=function(){function s(e){this.G=ju,this.I=Tr,this.Z=jh,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new Li(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},s}(),Eo=function(){function s(e){this.G=Nh,this.I=es,this.Z=ks,this.ondata=e}return s.prototype.push=function(e,t){zu.prototype.push.call(this,e,t)},s}();function j0(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?Fh(s,e,t):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?aa(s,e,t):Qp(s,e,t)}function wl(s,e){return s[0]==31&&s[1]==139&&s[2]==8?Uh(s,e):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?Xs(s,e):qa(s,e)}var zd=function(s,e,t,n){for(var r in s){var o=s[r],a=e+r;o instanceof Li?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],ra(n,o[1])]:zd(o,a+"/",t,n)}},Ks=typeof TextEncoder<"u"&&new TextEncoder,Vu=typeof TextDecoder<"u"&&new TextDecoder,N_=0;try{Vu.decode(pi,{stream:!0}),N_=1}catch{}var Vd=function(s){for(var e="",t=0;;){var n=s[t++],r=(n>127)+(n>223)+(n>239);if(t+r>s.length)return[e,Ds(s,t-1)];r?r==3?(n=((15&n)<<18|(63&s[t++])<<12|(63&s[t++])<<6|63&s[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&r?String.fromCharCode((31&n)<<6|63&s[t++]):String.fromCharCode((15&n)<<12|(63&s[t++])<<6|63&s[t++]):e+=String.fromCharCode(n)}},z0=function(){function s(e){this.ondata=e,N_?this.t=new TextDecoder:this.p=pi}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new Li(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=Vd(n),o=r[0],a=r[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,t)}},s}(),F_=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(Gu(e),this.d=t||!1)},s}();function Gu(s,e){if(e){for(var t=new Li(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(Ks)return Ks.encode(s);var r=s.length,o=new Li(s.length+(s.length>>1)),a=0,u=function(m){o[a++]=m};for(n=0;n<r;++n){if(a+5>o.length){var p=new Li(a+8+(r-n<<1));p.set(o),o=p}var f=s.charCodeAt(n);f<128||e?u(f):f<2048?(u(192|f>>6),u(128|63&f)):f>55295&&f<57344?(u(240|(f=65536+(1047552&f)|1023&s.charCodeAt(++n))>>18),u(128|f>>12&63),u(128|f>>6&63),u(128|63&f)):(u(224|f>>12),u(128|f>>6&63),u(128|63&f))}return Ds(o,0,a)}function U_(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}if(Vu)return Vu.decode(s);var r=Vd(s),o=r[0];if(r[1].length)throw"invalid utf-8 data";return o}var Wc=function(s){return s==1?3:s<6?2:s==9?1:0},zh=function(s,e){return e+30+ao(s,e+26)+ao(s,e+28)},Hp=function(s,e,t){var n=ao(s,e+28),r=U_(s.subarray(e+46,e+46+n),!(2048&ao(s,e+8))),o=e+46+n,a=Ur(s,e+20),u=t&&a==4294967295?Wp(s,o):[a,Ur(s,e+24),Ur(s,e+42)],p=u[0],f=u[1],m=u[2];return[ao(s,e+10),p,f,r,o+ao(s,e+30)+ao(s,e+32),m]},Wp=function(s,e){for(;ao(s,e)!=1;e+=4+ao(s,e+2));return[Vp(s,e+12),Vp(s,e+4),Vp(s,e+20)]},qc=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},Gd=function(s,e,t,n,r,o,a,u){var p=n.length,f=t.extra,m=u&&u.length,y=qc(f);B(s,e,a!=null?33639248:67324752),e+=4,a!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(o==null&&8),s[e++]=r&&8,s[e++]=255&t.compression,s[e++]=t.compression>>8;var S=new Date(t.mtime==null?Date.now():t.mtime),M=S.getFullYear()-1980;if(M<0||M>119)throw"date not in range 1980-2099";if(B(s,e,M<<25|S.getMonth()+1<<21|S.getDate()<<16|S.getHours()<<11|S.getMinutes()<<5|S.getSeconds()>>>1),e+=4,o!=null&&(B(s,e,t.crc),B(s,e+4,o),B(s,e+8,t.size)),B(s,e+12,p),B(s,e+14,y),e+=16,a!=null&&(B(s,e,m),B(s,e+6,t.attrs),B(s,e+10,a),e+=14),s.set(n,e),e+=p,y)for(var P in f){var D=f[P],j=D.length;B(s,e,+P),B(s,e+2,j),s.set(D,e+4),e+=4+j}return m&&(s.set(u,e),e+=m),e},Qu=function(s,e,t,n,r){B(s,e,101010256),B(s,e+8,t),B(s,e+10,t),B(s,e+12,n),B(s,e+16,r)},Ai=function(){function s(e){this.filename=e,this.c=oo(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),fn=function(){function s(e,t){var n=this;t||(t={}),Ai.call(this,e),this.d=new Yt(t,function(r,o){n.ondata(null,r,o)}),this.compression=8,this.flag=Wc(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){Ai.prototype.push.call(this,e,t)},s}(),la=function(){function s(e,t){var n=this;t||(t={}),Ai.call(this,e),this.d=new kn(t,function(r,o,a){n.ondata(r,o,a)}),this.compression=8,this.flag=Wc(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){Ai.prototype.push.call(this,e,t)},s}(),dw=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=Gu(e.filename),r=n.length,o=e.comment,a=o&&Gu(o),u=r!=e.filename.length||a&&o.length!=a.length,p=r+qc(e.extra)+30;if(r>65535)throw"filename too long";var f=new Li(p);Gd(f,0,e,n,u);var m=[f],y=function(){for(var j=0,k=m;j<k.length;j++){var L=k[j];t.ondata(null,L,!1)}m=[]},S=this.d;this.d=0;var M=this.u.length,P=ra(e,{f:n,u,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(y(),S){var j=t.u[M+1];j?j.r():t.d=1}S=1}}),D=0;e.ondata=function(j,k,L){if(j)t.ondata(j,k,L),t.terminate();else if(D+=k.length,m.push(k),L){var R=new Li(16);B(R,0,134695760),B(R,4,e.crc),B(R,8,D),B(R,12,e.size),m.push(R),P.c=D,P.b=p+D+16,P.crc=e.crc,P.size=e.size,S&&P.r(),S=1}else S&&y()},this.u.push(P)},s.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,r=0,o=this.u;r<o.length;r++)n+=46+(f=o[r]).f.length+qc(f.extra)+(f.o?f.o.length:0);for(var a=new Li(n+22),u=0,p=this.u;u<p.length;u++){var f=p[u];Gd(a,e,f,f.f,f.u,f.c,t,f.o),e+=46+f.f.length+qc(f.extra)+(f.o?f.o.length:0),t+=f.b}Qu(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},s}();function pw(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};zd(s,"",n,e);var r=Object.keys(n),o=r.length,a=0,u=0,p=o,f=new Array(o),m=[],y=function(){for(var D=0;D<m.length;++D)m[D]()},S=function(){var D=new Li(u+22),j=a,k=u-a;u=0;for(var L=0;L<p;++L){var R=f[L];try{var W=R.c.length;Gd(D,u,R,R.f,R.u,W);var q=30+R.f.length+qc(R.extra),J=u+q;D.set(R.c,J),Gd(D,a,R,R.f,R.u,W,u,R.m),a+=16+q+(R.m?R.m.length:0),u=J+W}catch(ee){return t(ee,null)}}Qu(D,a,f.length,k,j),t(null,D)};o||S();for(var M=function(D){var j=r[D],k=n[j],L=k[0],R=k[1],W=oo(),q=L.length;W.p(L);var J=Gu(j),ee=J.length,he=R.comment,xe=he&&Gu(he),De=xe&&xe.length,Fe=qc(R.extra),ke=R.level==0?0:8,Qe=function(Oe,ze){if(Oe)y(),t(Oe,null);else{var $e=ze.length;f[D]=ra(R,{size:q,crc:W.d(),c:ze,f:J,m:xe,u:ee!=j.length||xe&&he.length!=De,compression:ke}),a+=30+ee+Fe+$e,u+=76+2*(ee+Fe)+(De||0)+$e,--o||S()}};if(ee>65535&&Qe("filename too long",null),ke)if(q<16e4)try{Qe(null,In(L,R))}catch(Oe){Qe(Oe,null)}else m.push(Hn(L,R,Qe));else Qe(null,L)},P=0;P<p;++P)M(P);return y}function V0(s,e){e||(e={});var t={},n=[];zd(s,"",t,e);var r=0,o=0;for(var a in t){var u=t[a],p=u[0],f=u[1],m=f.level==0?0:8,y=(ee=Gu(a)).length,S=f.comment,M=S&&Gu(S),P=M&&M.length,D=qc(f.extra);if(y>65535)throw"filename too long";var j=m?In(p,f):p,k=j.length,L=oo();L.p(p),n.push(ra(f,{size:p.length,crc:L.d(),c:j,f:ee,m:M,u:y!=a.length||M&&S.length!=P,o:r,compression:m})),r+=30+y+D+k,o+=76+2*(y+D)+(P||0)+k}for(var R=new Li(o+22),W=r,q=o-r,J=0;J<n.length;++J){var ee=n[J];Gd(R,ee.o,ee,ee.f,ee.u,ee.c.length);var he=30+ee.f.length+qc(ee.extra);R.set(ee.c,ee.o+he),Gd(R,r,ee,ee.f,ee.u,ee.c.length,ee.o,ee.m),r+=16+he+(ee.m?ee.m.length:0)}return Qu(R,r,n.length,q,W),R}var G0=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),fw=function(){function s(){var e=this;this.i=new Tr(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),mw=function(){function s(e,t){var n=this;t<32e4?this.i=new Tr(function(r,o){n.ondata(null,r,o)}):(this.i=new es(function(r,o,a){n.ondata(r,o,a)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=Ds(e,0)),this.i.push(e,t)},s.compression=8,s}(),Rm=function(){function s(e){this.onfile=e,this.k=[],this.o={0:G0},this.p=pi}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),o=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(r)).length)return this.push(e,t)}else{var a=0,u=0,p=void 0,f=void 0;this.p.length?e.length?((f=new Li(this.p.length+e.length)).set(this.p),f.set(e,this.p.length)):f=this.p:f=e;for(var m=f.length,y=this.c,S=y&&this.d,M=function(){var j,k=Ur(f,u);if(k==67324752){a=1,p=u,P.d=null,P.c=0;var L=ao(f,u+6),R=ao(f,u+8),W=2048&L,q=8&L,J=ao(f,u+26),ee=ao(f,u+28);if(m>u+30+J+ee){var he=[];P.k.unshift(he),a=2;var xe,De=Ur(f,u+18),Fe=Ur(f,u+22),ke=U_(f.subarray(u+30,u+=30+J),!W);De==4294967295?(j=q?[-2]:Wp(f,u),De=j[0],Fe=j[1]):q&&(De=-1),u+=ee,P.c=De;var Qe={name:ke,compression:R,start:function(){if(!Qe.ondata)throw"no callback";if(De){var Oe=n.o[R];if(!Oe)throw"unknown compression type "+R;(xe=De<0?new Oe(ke):new Oe(ke,De,Fe)).ondata=function(ot,yt,Mt){Qe.ondata(ot,yt,Mt)};for(var ze=0,$e=he;ze<$e.length;ze++){var Ge=$e[ze];xe.push(Ge,!1)}n.k[0]==he&&n.c?n.d=xe:xe.push(pi,!0)}else Qe.ondata(null,pi,!0)},terminate:function(){xe&&xe.terminate&&xe.terminate()}};De>=0&&(Qe.size=De,Qe.originalSize=Fe),P.onfile(Qe)}return"break"}if(y){if(k==134695760)return p=u+=12+(y==-2&&8),a=3,P.c=0,"break";if(k==33639248)return p=u-=4,a=3,P.c=0,"break"}},P=this;u<m-4&&M()!=="break";++u);if(this.p=pi,y<0){var D=a?f.subarray(0,p-12-(y==-2&&8)-(Ur(f,p-16)==134695760&&4)):f.subarray(0,u);S?S.push(D,!!a):this.k[+(a==2)].push(D)}if(2&a)return this.push(f.subarray(u),t);this.p=f.subarray(u)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function Q0(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var S=0;S<t.length;++S)t[S]()},r={},o=s.length-22;Ur(s,o)!=101010256;--o)if(!o||s.length-o>65558)return void e("invalid zip file",null);var a=ao(s,o+8);a||e(null,{});var u=a,p=Ur(s,o+16),f=p==4294967295;if(f){if(o=Ur(s,o-12),Ur(s,o)!=101075792)return void e("invalid zip file",null);u=a=Ur(s,o+32),p=Ur(s,o+48)}for(var m=function(S){var M=Hp(s,p,f),P=M[0],D=M[1],j=M[2],k=M[3],L=M[4],R=M[5],W=zh(s,R);p=L;var q=function(ee,he){ee?(n(),e(ee,null)):(r[k]=he,--a||e(null,r))};if(P)if(P==8){var J=s.subarray(W,W+D);if(D<32e4)try{q(null,Xs(J,new Li(j)))}catch(ee){q(ee,null)}else t.push(aa(J,{size:j},q))}else q("unknown compression type "+P,null);else q(null,Ds(s,W,W+D))},y=0;y<u;++y)m();return n}function Bm(s){for(var e={},t=s.length-22;Ur(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=ao(s,t+8);if(!n)return{};var r=Ur(s,t+16),o=r==4294967295;if(o){if(t=Ur(s,t-12),Ur(s,t)!=101075792)throw"invalid zip file";n=Ur(s,t+32),r=Ur(s,t+48)}for(var a=0;a<n;++a){var u=Hp(s,r,o),p=u[0],f=u[1],m=u[2],y=u[3],S=u[4],M=u[5],P=zh(s,M);if(r=S,p){if(p!=8)throw"unknown compression type "+p;e[y]=Xs(s.subarray(P,P+f),new Li(m))}else e[y]=Ds(s,P,P+f)}return e}class km extends c.hH6{load(e,t,n,r){return this.setResponseType("arraybuffer"),super.load(e,o=>{const a=Bm(new Uint8Array(o)),u=new Map(Object.entries(a).map(([p,f])=>[p,new File([f],p)]));t==null||t(u)},n,r)}}function Om(){bi.Importers.push(new Nr(km,["zip"],!0))}class sc extends c.Ox3{constructor(e,t){super(),this.assetType="light",this.isDirectionalLight2=!0,this.color=new c.Ilk(e),this.intensity=t||1,this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),vi(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[-.1,.1],stepSize:.005,label:"Shadow Normal Bias",property:[this==null?void 0:this.shadow,"normalBias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty},{type:"slider",bounds:[.1,50],label:"Shadow frustum",getValue:()=>2*this.shadow.camera.right,setValue:e=>{this.shadow.camera.left=-e/2,this.shadow.camera.right=e/2,this.shadow.camera.top=e/2,this.shadow.camera.bottom=-e/2},onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=cn(vi({},t),!1),this.userData={},this.children=n,r.type="DirectionalLight2",r.target=this.target.position.toArray(),Object.assign(r,cn(this,!0,e))}fromJSON(e,t){if(e.type!=="DirectionalLight2")return null;const n=e.target,r=e.object;return e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld(),delete e.target),e.object&&delete e.object,kt(e,this,!0,t),n&&(e.target=n),r&&(r.color!==void 0&&this.color.set(r.color),r.intensity!==void 0&&(this.intensity=r.intensity),e.object=r),this}}class Vh extends c.PMe{constructor(e,t,n,r,o,a){super(e,t,n,r,o,a),this.assetType="light",this.target.position.set(0,0,-1),this.add(this.target)}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=this.target,r=e.userData;return e.userData={},super.copy(e,t),vi(this.userData,r),n.position.copy(this.target.position),n.updateMatrixWorld(),this.target=n,this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Spot Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"slider",bounds:[0,2],property:[this,"angle"]},{type:"slider",bounds:[0,.9999],property:[this,"penumbra"]},{type:"vec3",label:"Rotation",property:[this,"rotation"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t,children:n}=this;this.userData={},this.children=[];const r=super.toJSON(e);return r.userData=cn(vi({},t),!1),this.userData={},this.children=n,r.type="SpotLight2",r.target=this.target.position.toArray(),Object.assign(r,cn(this,!0,e))}fromJSON(e,t){return e.type!=="SpotLight2"?null:(e.target&&(this.target.position.fromArray(e.target),this.target.updateMatrixWorld()),e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.angle!==void 0&&(this.angle=e.object.angle),e.object.decay!==void 0&&(this.decay=e.object.decay),e.object.penumbra!==void 0&&(this.penumbra=e.object.penumbra),kt(e,this,!0,t),this):this)}}class j_ extends c.cek{constructor(e,t,n,r){super(e,t,n,r),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),vi(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Point Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,30],property:[this,"intensity"]},{type:"input",label:"Distance",property:[this,"distance"]},{type:"input",property:[this,"decay"]},{type:"vec3",label:"Position",property:[this,"position"]},{type:"checkbox",label:"Shadow Enabled",property:[this,"castShadow"]},{type:"vec2",label:"Shadow Map Size",property:[this==null?void 0:this.shadow,"mapSize"],onChange:()=>{var e,t;(e=this.shadow.map)===null||e===void 0||e.dispose(),(t=this.shadow.mapPass)===null||t===void 0||t.dispose(),this.shadow.map=null,this.shadow.mapPass=null}},{type:"slider",bounds:[-.001,.001],stepSize:2e-5,label:"Shadow Bias",property:[this==null?void 0:this.shadow,"bias"],onChange:this.setDirty},{type:"slider",bounds:[0,5],label:"Shadow radius",property:[this==null?void 0:this.shadow,"radius"],onChange:this.setDirty}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=cn(vi({},t),!1),this.userData={},n.type="PointLight2",Object.assign(n,cn(this,!0,e))}fromJSON(e,t){return e.type!=="PointLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),e.object.distance!==void 0&&(this.distance=e.object.distance),e.object.decay!==void 0&&(this.decay=e.object.decay),kt(e,this,!0,t),this):this}}class Lm extends c.Mig{constructor(e,t){super(e,t),this.assetType="light"}get lightObject(){return this}get modelObject(){return this}copy(e,t){const n=e.userData;return e.userData={},super.copy(e,t),vi(this.userData,n),this}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ambient Light",children:[{type:"checkbox",label:"Enabled",property:[this,"visible"]},{type:"color",label:"Color",property:[this,"color"]},{type:"slider",label:"Intensity",bounds:[0,20],property:[this,"intensity"]}]}}toJSON(e){const{userData:t}=this;this.userData={};const n=super.toJSON(e);return n.userData=cn(vi({},t),!1),this.userData={},n.type="AmbientLight2",Object.assign(n,cn(this,!0,e))}fromJSON(e,t){return e.type!=="AmbientLight2"?null:e.object?(e.object.color!==void 0&&this.color.set(e.object.color),e.object.intensity!==void 0&&(this.intensity=e.object.intensity),kt(e,this,!0,t),this):this}}class H0 extends c.aNw{load(e,t,n,r){const o=new c.hH6(this.manager);o.setPath(this.path),o.setResponseType("text"),o.load(e,a=>{try{t(this.parse(a))}catch(u){r?r(u):console.error(u),this.manager.itemError(e)}},n,r)}parse(e){e=e.replace(/^#.*?(\n|\r)/gm,"").replace(/^\s*?(\n|\r)/gm,"").trim();let t=null,n=null;const r=new c.Pa4(0,0,0),o=new c.Pa4(1,1,1),a=e.split(/[\n\r]+/g);let u=null,p=0;for(let y=0,S=a.length;y<S;y++){const M=a[y].trim(),P=M.split(/\s/g);switch(P[0]){case"TITLE":t=M.substring(7,M.length-1);break;case"LUT_3D_SIZE":const D=P[1];n=parseFloat(D),u=new Uint8Array(n*n*n*4);break;case"DOMAIN_MIN":r.x=parseFloat(P[1]),r.y=parseFloat(P[2]),r.z=parseFloat(P[3]);break;case"DOMAIN_MAX":o.x=parseFloat(P[1]),o.y=parseFloat(P[2]),o.z=parseFloat(P[3]);break;default:const j=parseFloat(P[0]),k=parseFloat(P[1]),L=parseFloat(P[2]);if(j>1||j<0||k>1||k<0||L>1||L<0)throw new Error("LUTCubeLoader : Non normalized values not supported.");u[p+0]=255*j,u[p+1]=255*k,u[p+2]=255*L,u[p+3]=255,p+=4}}const f=new c.IEO;f.image.data=u,f.image.width=n,f.image.height=n*n,f.type=c.ywz,f.magFilter=c.wem,f.minFilter=c.wem,f.wrapS=c.uWy,f.wrapT=c.uWy,f.generateMipmaps=!1,f.needsUpdate=!0;const m=new c.JUT;return m.image.data=u,m.image.width=n,m.image.height=n,m.image.depth=n,m.type=c.ywz,m.magFilter=c.wem,m.minFilter=c.wem,m.wrapS=c.uWy,m.wrapT=c.uWy,m.wrapR=c.uWy,m.generateMipmaps=!1,m.needsUpdate=!0,{title:t,size:n,domainMin:r,domainMax:o,texture:f,texture3D:m}}}class bi extends w{constructor(e,t=!1){super(),this._processors=new Tu,this._logger=console.log,this._loaderCache=[],this._fileDatabase=new Map,this._cachedAssets=[],t||(this._logger=()=>{}),this._viewer=e,this._onLoad=this._onLoad.bind(this),this._onProgress=this._onProgress.bind(this),this._onError=this._onError.bind(this),this._onStart=this._onStart.bind(this),this._urlModifier=this._urlModifier.bind(this),this._loadingManager=new c.lLk(this._onLoad,this._onProgress,this._onError),this._loadingManager.onStart=this._onStart,this._loadingManager.setURLModifier(this._urlModifier),Om(),Cm(e.renderer.rendererObject),Ps(e),Zl()}get processors(){return this._processors}get loadingManager(){return this._loadingManager}_onLoad(){this.dispatchEvent({type:"onLoad"})}_onProgress(e,t,n){this.dispatchEvent({type:"onProgress",url:e,loaded:t,total:n})}_onError(e){this.dispatchEvent({type:"onError",url:e})}_onStart(e,t,n){this.dispatchEvent({type:"onStart",url:e,loaded:t,total:n})}_urlModifier(e){var t;let n=decodeURI(e);const r=(t=this._rootContext)===null||t===void 0?void 0:t.rootUrl;n.includes("://")||!r||n.startsWith(r)||(n=r+n),n=n.replace("./",""),n=n.replace(/^(\/\/)/,"/"),n=n.replace(/\?.*$/,"");const o=this._fileDatabase.get(n);return o?o.ext?(o.objectUrl||(o.objectUrl=URL.createObjectURL(o)+"#"+n),o.objectUrl):(console.error("Unable to determine file extension",o),e):e}_createLoader(e){const t=this._getImporter(e),n=t==null?void 0:t.ctor(this);return n&&(t==null||t.ext.forEach(r=>{const o=new RegExp(r.startsWith("data:")?"^"+r+"\\/":"\\."+r+"$","i");this._loadingManager.addHandler(o,n)})),n&&(this._loaderCache.push({loader:n,files:[]}),this.dispatchEvent({type:"loaderCreate",loader:n})),n}async importFiles(e,t={}){const n=new Map;let{allowedExtensions:r}=t;if(r&&r.length<1&&(r=void 0),e.size===0)return n;this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"start"});const o=[],a=[];if(e.forEach((u,p)=>{var f;this.registerFile(p,u);const m=u.ext;m&&((f=r==null?void 0:r.includes(m.toLowerCase()))===null||f===void 0||f)&&(this._isRootFileExtension(m)?o.push(p):a.push(p))}),o.length>0)for(const u of o){let p=await this._importFile(u,void 0,t);p&&(p=await this.processImported(p,t)),n.set(u,p)}else for(const u of a){let p=await this._importFile(u,void 0,t);p&&(p=await this.processImported(p,t)),n.set(u,p)}return this.dispatchEvent({type:"importFiles",files:Object.keys(e),state:"end"}),e.forEach((u,p)=>{this.unregisterFile(p)}),n}registerFile(e,t){var n,r,o;e=e.replace(/\?.*$/,"");const a=(n=t==null?void 0:t.ext)!==null&&n!==void 0?n:(o=xd((r=t==null?void 0:t.name)!==null&&r!==void 0?r:e))===null||o===void 0?void 0:o.toLowerCase();t&&(t.ext||(t.ext=a),this._fileDatabase.set(e,t));let u=this._getLoader(e);if(u||(u=this._createLoader(t??{name:e,ext:a})),u){for(const p of this._loaderCache)if(p.loader===u){p.files.push(e);break}}return u}unregisterFile(e){e=e.replace(/\?.*$/,"");const t=this._fileDatabase.get(e);t!=null&&t.objectUrl&&(URL.revokeObjectURL(t.objectUrl),t.objectUrl=void 0),t&&this._fileDatabase.delete(e)}_isRootFileExtension(e){return bi.Importers.find(t=>t.root&&t.ext.includes(e.toLowerCase()))!=null}resolveURL(e){return this._loadingManager.resolveURL(e)}async _importFile(e,t,n={},r){var o,a;if(!((o=t)===null||o===void 0)&&o.__imported)return t.__imported;let u;this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:0});try{this.registerFile(e,t),n.rootPath=e;const p=this.resolveURL(e),f=e.replace(/\?.*$/,""),m=(a=n.fileHandler)!==null&&a!==void 0?a:await this._loadingManager.getHandler(f)||(t?await this._loadingManager.getHandler(t.name||t.ext||""):void 0);if(!m)throw new Error("AssetImporter: Unable to find loader for "+e);this._rootContext={path:e,url:p,rootUrl:c.Zp0.extractUrlBase(e),baseUrl:c.Zp0.extractUrlBase(p)},u=await m.loadAsync(e+(n.queryString?(e.includes("?")?"&":"?")+n.queryString:""),y=>{r&&r(y),this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:y.loaded/y.total})}),this._rootContext=void 0,this.dispatchEvent({type:"importFile",path:e,state:"downloading",progress:1}),this.dispatchEvent({type:"importFile",path:e,state:"adding"}),t?this._logger("AssetImporter: loaded",e):this._logger("AssetImporter: downloaded",e),t&&this.unregisterFile(e)}catch(p){return console.error("AssetImporter: Unable to import file",e,t),console.error(p),console.error(p==null?void 0:p.stack),this.dispatchEvent({type:"importFile",path:e,state:"error",error:p}),[]}return this.dispatchEvent({type:"importFile",path:e,state:"done"}),t&&(t.__imported=u),u}_getImporter(e,t=!1){return bi.Importers.find(n=>{if(t&&!n.root)return!1;const r=n.ext.find(o=>{var a,u,p;return e.ext&&o===e.ext.toLowerCase()||((u=(a=e.name)===null||a===void 0?void 0:a.toLowerCase())===null||u===void 0?void 0:u.endsWith("."+o.toLowerCase()))||(o==null?void 0:o.startsWith("data:"))&&((p=e.name)===null||p===void 0?void 0:p.startsWith(o))});return!!r&&(e.ext=r,!0)})}_getLoader(e){var t;return(t=this._loadingManager.getHandler(e))!==null&&t!==void 0?t:void 0}async importAsset(e,t={},n){var r;if(!e)return[];if(!this._cachedAssets.includes(e)){if(Object.entries(e).length===1&&e.path){const u=this._cachedAssets.find(p=>p.path===e.path);u&&Object.assign(e,u)}const a=this._cachedAssets.findIndex(u=>u.path===e.path);a>=0&&this._cachedAssets.splice(a,1),this._cachedAssets.push(e)}let o;if(e!=null&&e.preImported&&(o=await e.preImported),!t.forceImport&&o){const a=await this.processImported(o,t);let u=!1;for(const p of a)if(p.__disposed){u=!0;break}if(!u||t.reimportDisposed===!1)return a}return e.preImported=this._importFile(t.pathOverride||e.path,typeof((r=e.file)===null||r===void 0?void 0:r.arrayBuffer)=="function"?e.file:void 0,t,n),o=await e.preImported,o&&(o=await this.processImported(o,t)),o}async importSingle(e,t={}){var n;return(n=await this.importAsset(e,t))===null||n===void 0?void 0:n[0]}async importSinglePath(e,t){var n;return(n=await this.importPath(e,t))===null||n===void 0?void 0:n[0]}async importPath(e,t={}){const n={...t};delete n.pathOverride,delete n.forceImport,delete n.reimportDisposed;const r=JSON.stringify(n);let o;return o=this._cachedAssets.find(a=>a.path===e&&a._options===r)||{path:e},o._options=r,await this.importAsset(o,t)}async processImportedSingle(e,t={}){return(await this.processImported(e,t))[0]}async processImported(e,t={}){var n,r,o,a,u,p,f,m;let y=e;if(!y)return[];if(t.processImported===!1)return[y];if(Array.isArray(y)){const S=[];for(const M of y)S.push(...await this.processImported(M,t));return S}if(!((n=y.userData)===null||n===void 0)&&n.rootSceneModelRoot){if(t._rootSceneImported=!0,y.__processedChildren&&!t.forceImporterReprocess)return y.__processedChildren;if(!(y.children.length<1))return y.animations&&(y.children[0].animations||(y.children[0].animations=[]),y.children[0].animations.push(...y.animations)),y.__importedViewerConfig&&(y.children[0].__importedViewerConfig=y.__importedViewerConfig),y.__processedChildren=await this.processImported([...y.children],t),y.__processedChildren;if(((r=y.animations)===null||r===void 0?void 0:r.length)>0&&console.error("AssetImporter: animations in empty scene not supported yet. animations will be ignored",y.animations),!y.__importedViewerConfig)return[];y=y.__importedViewerConfig}if(!((o=y.userData)===null||o===void 0)&&o.iModel&&(y=y.userData.iModel),!((a=y.userData)===null||a===void 0)&&a.iMaterial&&(y=y.userData.iMaterial),y.assetImporterProcessed&&!t.forceImporterReprocess)return[y];if(!y.assetType){if(y.isBufferGeometry&&(y=new c.Kj0(y,new c.Wid)),y.isObject3D){if(y.isLight)y=z_(y);else{const S=[];y.traverse(M=>{M!==y&&M.isLight&&S.push(M)});for(const M of S)z_(M);y=new fl(y,t)}!t.rootPath||y.modelObject.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(y.modelObject.userData.rootPath=t.rootPath)}y.isTexture&&(y.assetType="texture",t._testDataTextureComplete&&(y.isDataTexture&&(!((u=y.image)===null||u===void 0)&&u.data)&&(y.image.complete=!0),!((p=y.image)===null||p===void 0)&&p.complete&&(y.needsUpdate=!0)),t.generateMipmaps!==void 0&&(y.generateMipmaps=t.generateMipmaps),y.generateMipmaps||y.isRenderTargetTexture||(y.minFilter=y.minFilter===c.D1R?c.wem:y.minFilter,y.magFilter=y.magFilter===c.D1R?c.wem:y.magFilter),!t.rootPath||y.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(y.userData.rootPath=t.rootPath)),y.isMaterial&&(y.assetType="material",!t.rootPath||y.userData.rootPath||t.rootPath.startsWith("blob:")||t.rootPath.startsWith("/")||(y.userData.rootPath=t.rootPath))}if(y.assetType!=null)return y=await this._processors.process(y.assetType,y,{}),y.assetImporterProcessed=!0,[y];if(y instanceof Map)return[...(await this.importFiles(y,t)).values()].flat();if(y.type){const S=this._viewer.getPluginByType(y.type);if(S){let M=y._importedResources||{};return y.resources&&(M=await((f=this._viewer.getManager())===null||f===void 0?void 0:f.importConfigResources(y.resources)),delete y.resources,y._importedResources=M),typeof S.fromJSON=="function"&&(await Promise.resolve(S.fromJSON(y,M)),y.assetImporterProcessed=!1),[]}}else if(y.plugins)return y.resources=await((m=this._viewer.getManager())===null||m===void 0?void 0:m.importConfigResources(y.resources)),await this._viewer.getManager().importViewerConfig(y),y.assetImporterProcessed=!1,[];return console.warn("unknown asset type: ",y),[y]}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}function Nm(s){if(!s)return c.ywz;const e=s.extensions.has("EXT_color_buffer_half_float")||s.capabilities.isWebGL2&&s.extensions.has("EXT_color_buffer_float"),t=s.capabilities.isWebGL2||s.extensions.has("OES_texture_float")||s.extensions.has("WEBGL_color_buffer_float");return e?c.cLu:t?c.VzW:c.ywz}function z_(s){var e,t,n;if(!s.isLight||s.assetType==="light")return s;if(s.uiConfig)return console.warn("ui config already exists, not supported",s),s;let r;if(s.children.length,s.isDirectionalLight&&(r=new sc),s.isAmbientLight&&(r=new Lm),s.isSpotLight&&(r=new Vh),s.isPointLight&&(r=new j_),r){(t=(e=r.lightObject).copy)===null||t===void 0||t.call(e,s);const o=s.parent;!((n=o)===null||n===void 0)&&n.isObject3D&&(o.remove(s),s.dispose(),s.userData.iModel=r,o.add(r.lightObject),r.uuid=s.uuid),ir(r.lightObject,o)}else console.warn("unknown light type: ",s);return r}bi.Importers=[new Nr(Sd,["json"],!1),new Nr(c.hH6,["txt"],!1),new Nr(Uc,["rgbe.png","hdr.png","hdrpng"],!1),new Nr(c.dpR,["webp","png","jpeg","jpg","svg","data:image"],!1),new Nr(H0,["CUBE"],!1)];class W0 extends c.u7G{constructor(e){super(e)}async loadAsync(e,t){var n;const r=new c.hH6(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials);const o=await r.loadAsync(e,t);try{const a=JSON.parse(o);if(a.images&&this.importer){const u={};let p=a.images;Array.isArray(p)||(p=Object.values(p));for(const f of a.images){if(!f.url||!f.uuid)continue;const m=(n=await this.importer.importPath(f.url,{processImported:!1}))===null||n===void 0?void 0:n[0],y=m==null?void 0:m.source;if(!m||!y)continue;const S=new c.Hw6(y.data);S.uuid=f.uuid,u[S.uuid]=S,m.dispose()}return this.parse(a,u)}return this.parse(a)}catch(a){throw console.error(a),this.manager.itemError(e),a}}parse(e,t){var n,r;let o;const a={p:new Promise(m=>{o=m})};if(e.images||e.textures){const m=new Pd(this.manager);let y={};const S=j=>{o(),a.p=void 0,Object.values(y).forEach(k=>{var L;k.isTexture&&(!((L=k.image)===null||L===void 0)&&L.complete)&&(k.needsUpdate=!0)})};let M=e.images||[];Array.isArray(M)||(M=Object.values(M));const P=t||m.parseImages(M,S);let D=e.textures;Array.isArray(D)||(D=Object.values(D)),y=m.parseTextures2(D,P,S),this.setTextures(y)}this.materials||console.warn("A Material Manager is not set to import three materials, trying standard materials");const u={...e};if(Object.entries(u).forEach(([m,y])=>{y&&typeof y=="string"&&this.textures[y]&&(u[m]=this.textures[y])}),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?u.vertexColors=e.vertexColors>0:u.vertexColors=e.vertexColors),e.normalScale!==void 0){let m=e.normalScale;Array.isArray(m)===!1&&(m=[m,m]),u.normalScale=new c.FM8().fromArray(m)}let p=e.type;p!=="MeshPhysicalMaterial"&&p!=="MeshStandardMaterial"||(p=Hs.TYPE),u.userData=kt(u.userData,void 0,!1,this);const f=(r=(n=this.materials)===null||n===void 0?void 0:n.generateFromTemplateType(p,u))!==null&&r!==void 0?r:super.parse(e);return this.setTextures({}),f.userData.imageLoadAwaiter=a,f}}class dn extends w{constructor(e,t,{simpleCache:n=!1,storage:r}={}){if(super(),this._sceneUpdated=this._sceneUpdated.bind(this),this.addAsset=this.addAsset.bind(this),this.addProcessedAssets=this.addProcessedAssets.bind(this),this.addImported=this.addImported.bind(this),(n||r)&&(n&&(c.CtF.enabled=!0),r&&window.Cache&&typeof window.Cache=="function"&&r instanceof window.Cache)){const o={...c.CtF};c.CtF.get=(a,u,p)=>u?a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")?Promise.resolve(void 0):r.match(a).then(f=>{if(f)switch(u){case"arraybuffer":return f.arrayBuffer();case"blob":return f.blob();case"document":return f.text().then(m=>new DOMParser().parseFromString(m,p??"text/html"));case"json":return f.json();default:if(p===void 0)return f.text();{const m=/charset="?([^;"\s]*)"?/i.exec(p),y=m&&m[1]?m[1].toLowerCase():void 0,S=new TextDecoder(y);return f.arrayBuffer().then(M=>S.decode(M))}}}):o.get(a),c.CtF.add=(a,u,p)=>{p||o.add(a,u),a.startsWith("data:")||a.startsWith("blob")||a.startsWith("chrome-extension")||r.put(a,new Response(u,{status:200}))},c.CtF.remove=(a,u)=>{u||o.remove(a),r.delete(a)}}this._importer=e,this._materials=t}async addAsset(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importAsset(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}async addFromPath(e,t={}){if(!this._importer||!this._viewer)return[];const n=await this._importer.importPath(e,t);return n?(this.addProcessedAssets(n,t),n):(console.warn("Unable to import",e,n),[])}addProcessedAssets(e,t){return e.map(n=>{var r;return(r=this._viewer)===null||r===void 0?void 0:r.scene.addSceneObject(n,t)})}async addAssetSingle(e,t={}){var n;return e?(n=await(typeof e=="string"?this.addFromPath:this.addAsset)(e,t))===null||n===void 0?void 0:n[0]:void 0}async addImported(e,t={}){var n;return(n=this._importer)===null||n===void 0?void 0:n.processImported(e,t).then(r=>(this.addProcessedAssets(r,t),r))}async addImportedSingle(e,t={}){return this.addImported(e,t).then(n=>n==null?void 0:n[0])}_sceneUpdated(e){var t;if(e.type==="addSceneObject"){const n=e.object;n.assetType==="material"&&((t=this._materials)===null||t===void 0||t.processMaterial(n,{}))}else console.error("Unexpected")}async onAdded(e){this._viewer=e,this._materials||(this._materials=new Bc,this._viewer.scene.addEventListener("addSceneObject",this._sceneUpdated)),this._importer||(this._importer=new bi(e,!!e.getPluginByType("debug")),this._importer.processors.add("model",{forAssetType:"model",process:(n,r)=>(kc(n,o=>{var a;return(a=this._materials)===null||a===void 0?void 0:a.processModel(o,{recursive:!1})}),n)}),this._importer.processors.add("model",{forAssetType:"model",process:this._materials.processModel}),this._importer.processors.add("material",{forAssetType:"material",process:(n,r)=>{var o;return!((o=this.materials)===null||o===void 0)&&o.findMaterial(n.uuid)&&(console.warn("imported material uuid already exists, creating new uuid"),n.uuid=gt(),n.userData.uuid&&(n.userData.uuid=n.uuid)),this._materials.processMaterial(n,r)}})),bi.Importers.push(new Nr(W0,[Hs.TypeSlug],!1,n=>(n&&(n.materials=this._materials),n&&(n.importer=this._importer),n)));const t=this.importViewerConfig.bind(this);bi.Importers.push(new Nr(class extends Sd{async loadAsync(n,r){return t(await super.loadAsync(n,r))}},[dn.ViewerTypeSlug],!0))}async onDispose(e){}async onRemove(e){var t,n;e===this._viewer&&((t=this._importer)===null||t===void 0||t.dispose(),this._importer=void 0,this._viewer.scene.removeEventListener("addSceneObject",this._sceneUpdated),(n=this._materials)===null||n===void 0||n.dispose(),this._materials=void 0)}get importer(){return this._importer}get exporter(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter}get materials(){return this._materials}exportViewerConfig(e){if(!this._viewer)return{};const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},...e},n=this._viewer.toJSON(t);return n.resources=t,n}exportPluginPresets(e){var t;const n={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}};return{plugins:(t=this._viewer)===null||t===void 0?void 0:t.serializePlugins(n,e),resources:n}}exportPluginPreset(e){if(!e.toJSON)return;const t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n=e.toJSON(t);return n.resources=t,n}async importPluginPreset(e,t){var n;const r=e.type;if(!(t=t||((n=this._viewer)===null||n===void 0?void 0:n.getPluginByType(r))))return void console.warn(`No plugin found for type ${r} to import preset`);if(!t.fromJSON)return void console.warn(`Plugin ${r} does not support importing presets`);const o=e.resources||{};return e.resources&&delete e.resources,await t.fromJSON(e,o),o&&(e.resources=o),t}async importViewerConfig(e,t){if(!this._viewer||!this._importer)return void console.warn("No viewer or importer");const n=await this.importConfigResources(e.resources||{},t);this.applyViewerConfig(e,n)}applyViewerConfig(e,t){var n;if(this._viewer&&this._importer)if((t=t||e.resources).__isLoadedResources){this._viewer.fromJSON(e,t);for(const r of Object.values(t.materials))r.__useCount?delete r.__useCount:(n=this._materials)===null||n===void 0||n.unregisterMaterial(r);for(const r of Object.values(t.textures))r.__useCount&&delete r.__useCount}else console.error("Cannot load viewer config: resources not loaded",e);else console.warn("No viewer or importer")}async importConfigResources(e,t,n){var r,o,a;if(!this._importer)throw"Importer not initialized yet.";if(e.__isLoadedResources)return e;const u={};t=t??new Pd(this._importer.loadingManager),u.animations=e.animations?t.parseAnimations(e.animations):{},n&&n.animations&&(u.animations={...u.animations,...n.animations}),u.shapes=e.shapes?t.parseShapes(e.shapes):{},n&&n.shapes&&(u.shapes={...u.shapes,...n.shapes}),u.geometries=e.geometries?t.parseGeometries(e.geometries,u.shapes):{},n&&n.geometries&&(u.geometries={...u.geometries,...n.geometries}),u.images=e.images?await t.parseImagesAsync(Object.values(e.images)):{},n&&n.images&&(u.images={...u.images,...n.images});for(const f of Object.values(e.textures)){const m=(r=f==null?void 0:f.userData)===null||r===void 0?void 0:r.rootPath;if(m&&(!f.image||!u.images[f.image])){const y=(o=await this._importer.importPath(m,{processImported:!1}))===null||o===void 0?void 0:o[0],S=y==null?void 0:y.source;if(!y||!S)continue;const M=new c.Hw6(S.data);f.image&&(M.uuid=f.image),u.images[M.uuid]=M,f.image=M.uuid,y.dispose()}}u.textures=e.textures?t.parseTextures2(Object.values(e.textures),u.images,()=>{Object.values(u.textures).forEach(f=>{var m;f.isTexture&&(!((m=f.image)===null||m===void 0)&&m.complete)&&(f.needsUpdate=!0)})}):{};for(const f of Object.entries(u.textures))f[1]=(a=await this._importer.processImported(f[1],{}))===null||a===void 0?void 0:a[0],f[1]?u.textures[f[0]]=f[1]:delete u.textures[f[0]];n&&n.textures&&(u.textures={...u.textures,...n.textures});const p=e.materials?Object.values(e.materials):[];for(const f of p)Object.entries(f).forEach(([m,y])=>{y&&y.resource&&y.uuid&&y.resource==="textures"&&(f[m]=y.uuid)});return u.materials=t.parseMaterials2(p,u.textures,this._materials),n&&n.materials&&(u.materials={...u.materials,...n.materials}),e.object&&(u.object=t.parseObject(e.object,u.geometries,u.materials,u.textures,u.animations),e.skeletons&&(u.skeletons=t.parseSkeletons(e.skeletons,u.object),t.bindSkeletons(u.object,u.skeletons))),u.__isLoadedResources=!0,u}}dn.PluginType="AssetManager",dn.ViewerTypeSlug="vjson";class ui extends w{constructor(){super(...arguments),this._dirty=!1}get dirty(){return this._dirty}set dirty(e){this._dirty=e}async onAdded(e){this._viewer=e}async onDispose(e){}async onRemove(e){this._viewer!==e&&console.error("Wrong viewer"),this._viewer=void 0}toJSON(e){const t=cn(this,!0,e);return t.type=this.constructor.PluginType,this.dispatchEvent({type:"serialize",data:t}),t}fromJSON(e,t){return e.type!==this.constructor.PluginType?null:(kt(e,this,!0,t),this.dispatchEvent({type:"deserialize",data:e}),this)}}function Qd(s,e,t){return{...e,get dirty(){return e.dirty||!1},set dirty(n){_e(e,"dirty",n,!0)},update(){var n,r,o;this.passObject.enabled&&((r=(n=this.passObject).updateShaderProperties)===null||r===void 0||r.call(n,Se(t)),(o=e.update)===null||o===void 0||o.call(this))},onRegister(n){var r,o,a;this.passObject.materialExtension&&((o=(r=s.getPlugin(dn))===null||r===void 0?void 0:r.materials)===null||o===void 0||o.registerMaterialExtension(this.passObject.materialExtension)),(a=e.onRegister)===null||a===void 0||a.call(this,n)},onUnregister(n){var r,o,a;this.passObject.materialExtension&&((o=(r=s.getPlugin(dn))===null||r===void 0?void 0:r.materials)===null||o===void 0||o.unregisterMaterialExtension(this.passObject.materialExtension)),(a=e.onUnregister)===null||a===void 0||a.call(this,n)},dispose(){var n,r,o;(r=(n=this.passObject).dispose)===null||r===void 0||r.call(n),(o=e.dispose)===null||o===void 0||o.call(this)}}}class xl extends ui{constructor(){super(),this._enabledTemp=!0}_update(e){var t;return((t=this._pass)===null||t===void 0?void 0:t.enabled)&&this.enabled||!1}get enabled(){var e,t;return((t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||this._enabledTemp}set enabled(e){var t;!((t=this._pass)===null||t===void 0)&&t.passObject&&(this._pass.passObject.enabled=e),this._enabledTemp=e}async onAdded(e){await super.onAdded(e);const t={enabled:!0,passId:this.passId,passObject:this.passCtor(e),after:this._afterFilters,before:this._beforeFilters,required:this._requiredFilters,set dirty(n){n&&e.setDirty()},get dirty(){return!1},update:()=>this._update(e)};this._pass=Qd(e,t),t.passObject.onDirty!==void 0&&t.passObject.onDirty.push(()=>t.dirty=!0),e.renderer.registerPass(this._pass),this.enabled=this._enabledTemp}async onRemove(e){var t,n;this._pass&&e.renderer.unregisterPass(this._pass),(n=(t=this._pass)===null||t===void 0?void 0:t.dispose)===null||n===void 0||n.call(t),this._pass=void 0,await super.onRemove(e)}get pass(){return this._pass}toJSON(e){var t,n;const r=super.toJSON(e);if(!r.type)return r;const o=this.pass;return o&&(r.pass=cn((n=(t=o)===null||t===void 0?void 0:t.passObject)!==null&&n!==void 0?n:o,!1,e)),r}fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;if(e.pass){const o=this.pass;o&&kt(e.pass,(r=(n=o)===null||n===void 0?void 0:n.passObject)!==null&&r!==void 0?r:o,!1,t)}return this}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([et()],xl.prototype,"enabled",null);const V_=new Set,G_=new Set;class q0 extends or{constructor(e,t,n,r){super(void 0,void 0,t,new Sn(1,1,1),1),this.target=e}render(e,t,n,r,o){const a=e.getRenderTarget(),u=e.getActiveCubeFace(),p=e.getActiveMipmapLevel();this.scene.traverse(({material:f})=>{f&&((f.transparent&&f.userData.renderToDepth||!f.transparent&&f.transmission===0&&f.userData.renderToDepth===!1)&&(V_.add(f),f.transparent=!f.transparent),Math.abs(f.transmission||0)>0&&f.userData.renderToDepth&&(G_.add([f,f.transmission]),f.transmission=0))}),qt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(e,t,this.target,r,o)),V_.forEach(f=>f.transparent=!f.transparent),V_.clear(),G_.forEach(([f,m])=>f.transmission=m),G_.clear(),e.setRenderTarget(a,u,p)}}class xr extends xl{constructor(e=!0){super(),this.renderFlagsBuffer=e,this.passId="gbuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._gbufferTextures=[]}passCtor(e){var t,n;const r=((t=this._viewer)===null||t===void 0?void 0:t.renderer.isWebGL2)&&this.renderFlagsBuffer,o=e.renderer.createTarget({depthBuffer:!0,type:c.ywz,textureCount:r?2:1});Array.isArray(o.texture)?(o.texture[0].name="gbufferDepthNormal",o.texture[1].name="gbufferFlags",this._gbufferTextures=o.texture):(o.texture.name="gbufferDepthNormal",this._gbufferTextures.push(o.texture)),this._gbufferTarget=o;const a=(n=this._viewer)===null||n===void 0?void 0:n.getPluginByType("debug");return a&&(a.addTexture("gbuffer depth normal",()=>this.getDepthNormal(),[40,110,300,200]),this._gbufferTextures.length>1&&a.addTexture("gbuffer flags",()=>this.getFlagsTexture(),[40,310,200,100])),new q0(o,new qo(r))}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getDepthNormal(){return this._gbufferTextures.length>0?this._gbufferTextures[0]:void 0}getFlagsTexture(){return this._gbufferTextures.length>1?this._gbufferTextures[1]:void 0}async onDispose(e){}async onRemove(e){return this._gbufferTarget&&(e.renderer.disposeTarget(this._gbufferTarget),this._gbufferTarget=void 0),super.onRemove(e)}getTarget(){return this._gbufferTarget}getUnpackSnippet(){return Yl}updateShaderProperties(e){var t,n;if(e.uniforms.tNormalDepth?e.uniforms.tNormalDepth.value=(t=this.getDepthNormal())!==null&&t!==void 0?t:void 0:console.warn("BaseRenderer: no uniform: tNormalDepth"),e.uniforms.tGBufferFlags){e.uniforms.tGBufferFlags.value=(n=this.getFlagsTexture())!==null&&n!==void 0?n:void 0;const r=e.uniforms.tGBufferFlags.value?1:0;r!==e.defines.GBUFFER_HAS_FLAGS&&(e.defines.GBUFFER_HAS_FLAGS=r,e.needsUpdate=!0)}return this}}xr.PluginType="GBuffer";class Y0 extends or{constructor(e,t=!0){super(),this.blurTransmissionTarget=!1,this._viewer=e,this._doTransmissionFix=t,this.clear=!0,this.clearColor=new Sn(0,0,0),this.clearAlpha=0,this.clearDepth=!1,this._blendPass=new wd({},"c = vec4(a.rgb * (1. - b.a) + b.rgb * b.a, 1.);")}get transparentTarget(){return this._transparentTarget||(this._transparentTarget=this._viewer.renderer.getTempTarget({sizeMultiplier:1,samples:this._viewer.renderer.composerTarget.samples||0,encoding:c.rnI,type:c.cLu,format:c.wk1,minFilter:c.wem,magFilter:c.wem,depthBuffer:!1})),this._transparentTarget}_releaseTransparentTarget(){this._transparentTarget&&this._viewer.renderer.releaseTempTarget(this._transparentTarget),this._transparentTarget=void 0}render(e,t,n,r,o){var a;let u=!1;if(e.userData.mainRenderPass=!0,!this._doTransmissionFix)return super.render(e,t,n,r,o),this.needsSwap=u,void(e.userData.mainRenderPass=void 0);const p=e.userData;p||console.error("threejs is not patched?");const f=this._viewer.useGBufferDepth;let m;if(f){const S=(a=this._viewer.getPlugin(xr))===null||a===void 0?void 0:a.getTarget();if(S){const M=e.properties.get(S);m=M.__webglDepthRenderbuffer||M.__webglDepthbuffer}else console.warn("No Gbuffer present for depth prepass.")}let y=()=>{super.render(e,void 0,n,r,o,m)};if(this._viewer.useRgbm){if(this._viewer.useRgbm){if(u=!1,!e.info.autoReset)throw"renderer.info.autoReset must be true";{const S=e.autoClearDepth;e.autoClearDepth=!f,qt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},y),e.autoClearDepth=S}if(!f){const S=e.properties.get(n);m=S.__webglDepthRenderbuffer||S.__webglDepthbuffer}y=()=>{super.render(e,void 0,this.transparentTarget,r,o,m)};{const S=this.clear,M=e.autoClearDepth;e.autoClearDepth=!1,this.clear=!0,qt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!0,transmissionRender:!1},y),this.clear=S,e.autoClearDepth=M}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,o),u=!0);{const S=this.clear;this.clear=!1,p.transmissionRenderTarget=u?t:n,p.blurTransmissionTarget=this.blurTransmissionTarget,qt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},y),p.blurTransmissionTarget=void 0,p.transmissionRenderTarget=void 0,this.clear=S}e.info.render.calls>0&&(this._blendPass.uniforms.tDiffuse2.value=this.transparentTarget.texture,this._blendPass.render(e,t,n,r,o),u=!0)}}else{{const S=this.clear,M=e.autoClearDepth;e.autoClearDepth=!f,this.clear=!0,qt(e,{shadowMapRender:!0,backgroundRender:!0,opaqueRender:!0,transparentRender:!0,transmissionRender:!1},y),this.clear=S,e.autoClearDepth=M}{this._viewer.renderer.blit(n.texture,t,{clear:!0});const S=this.clear;this.clear=!1,p.transmissionRenderTarget=t,p.blurTransmissionTarget=this.blurTransmissionTarget,qt(e,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!1,transparentRender:!1,transmissionRender:!0},y),p.blurTransmissionTarget=void 0,p.transmissionRenderTarget=void 0,this.clear=S}u=!1}this._releaseTransparentTarget(),this.needsSwap=u,e.userData.mainRenderPass=void 0}}function Q_(s,e){return s.multiplyScalar(s.w*e),s.w=1,s}function H_(s,e){return Q_(s,e),new Sn(s.x,s.y,s.z)}function W_(s,e){const t=Math.max(s.x,Math.max(s.y,s.z));let n=Math.max(Math.min(t/e,1),0);return n=Math.ceil(255*n)/255,s.divideScalar(n*e),s.w=n,s}function X0(s,e){return W_(new c.Ltg(s.r,s.g,s.b,1),e)}var Fm=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};function q_(s){return Object.getPrototypeOf(s).constructor.PluginType}c.Vj0.background.fragmentShader=c.Vj0.background.fragmentShader.replace("uniform sampler2D t2D;",`uniform sampler2D t2D;
uniform float intensity;`),c.Vj0.background.fragmentShader=c.Vj0.background.fragmentShader.replace("texture2D( t2D, vUv )","texture2D( t2D, vUv )*intensity");class Ya extends w{constructor({isAntialiased:e=!1,useRgbm:t=!0,useGBufferDepth:n=!1,screenShader:r="",...o}){var a;super(),this.console=console,this._state=K.None,this.plugins={},this._needsResize=!1,this.resizeObserver=window.ResizeObserver?new window.ResizeObserver(S=>this.resize()):void 0,this._lastSize=new c.FM8,this._onContextRestore=S=>{this.enabled=!0,this._canvas.width=this._lastSize.width,this._canvas.height=this._lastSize.height,this.resize(),this.scene.setDirty({sceneUpdate:!0,frameFade:!1})},this._onContextLost=S=>{this._lastSize.set(this._canvas.width,this._canvas.height),this._canvas.width=2,this._canvas.height=2,this.resize(),this.enabled=!1},this.resize=()=>{this._needsResize=!0,this.setDirty()},this._needsReset=!0,this.enabled=!0,this.renderEnabled=!0,this._isRenderingFrame=!1,this.maxFramePerLoop=1,this._rawBackground=null,this.backgroundIntensity=1,this._sceneEnvironmentChanged=()=>{this._rawBackground===El&&this.scene.setBackground(this.scene.getEnvironment())},this._addSceneObject=S=>{var M;if(!S||!S.object)return;const P=S.object.__importedViewerConfig||((M=S.object.modelObject)===null||M===void 0?void 0:M.__importedViewerConfig);if(!P)return;const D=this.getManager();D?D.applyViewerConfig(P,P.resources):this.fromJSON(P,P.resources)},this.alert=async S=>alert(S),this.confirm=async S=>confirm(S),this.prompt=async(S,M,P=!0)=>prompt(S,M),this._useRgbm=t,this._useGBufferDepth=n,this._screenShader=r,this._canvas=o.canvas||Mc();let u=o.container;if(u&&!o.canvas&&u.appendChild(this._canvas),u||(u=(a=this._canvas.parentElement)!==null&&a!==void 0?a:void 0),!u)throw new Error("No container.");this._container=u,this._animationLoop=this._animationLoop.bind(this),this.setDirty=this.setDirty.bind(this),this._setActiveCameraView=this._setActiveCameraView.bind(this),window.webGiViewers||(window.webGiViewers=[]),window.webGiViewers.push(this),async function(){try{const S=window.location.href;if(S.startsWith("http://localhost:8062")||S.startsWith("https://localhost:8062"))return!0;await fetch("https://europe-west1-pixotronics-320918.cloudfunctions.net/viewer-hit-test"+"/?u="+encodeURIComponent(S),{mode:"no-cors",method:"POST",credentials:"omit",cache:"no-store",keepalive:!1,referrer:"about:client",referrerPolicy:"unsafe-url"})}catch{return!1}}(),async function(){var S;const M=window.location.href,P="https://dev-sandbox.pixotronics.com/webgi/";if(!M.startsWith(P)||Pc("noUpdate")!==null)return!0;const D=(S=M.match(/\/webgi\/([0-9.a-zA-Z]+)/))===null||S===void 0?void 0:S[1],j=(await(await fetch(P+"version.txt")).text()).split(`
`)[0];if(D&&D!==j){if(confirm(`New version ${j} is available, do you want to open?`)){const k=window.location.href.replace(D,j);return window.location.href=k,!1}window.location.href.includes("noUpdate")||(window.location.href+=(window.location.href.includes("?")?"&":"?")+"noUpdate")}}();const p=new yo(void 0,void 0,this._canvas);this.addEventListener("postFrame",()=>{var S,M;const P=m.scene.activeCamera;if(P&&P.interactionsEnabled){if(((S=this.getPluginByType("Progressive"))===null||S===void 0?void 0:S.postFrameConvergedRecordingDelta())===0)return;(M=P.controls)===null||M===void 0||M.update()}}),this.scene=new Cc(p),this.scene.addEventListener("environmentChanged",this._sceneEnvironmentChanged),this.scene.addEventListener("addSceneObject",this._addSceneObject),this.scene.addEventListener("setView",this._setActiveCameraView),this.scene.addEventListener("activateMain",this._setActiveCameraView),this._renderer=new Xn({canvas:this._canvas,animationLoop:this._animationLoop,targetOptions:{samples:e?4:0,encoding:t?At:c.rnI,type:t?c.ywz:c.cLu,depthBuffer:!n}}),this._isAntialiased=e&&this._renderer.isWebGL2;let f=!0;this._renderer.rendererObject.userData||(f=!1,this._renderer.rendererObject.userData={}),this._renderer.rendererObject.userData.renderTransmissionPass=!f;const m=this;this.renderFilter={passId:"render",passObject:new Y0(this,f),update(){const S=this.passObject;S.scene=m.scene.modelObject,S.camera=m.scene.activeCamera.cameraObject}};const y={passId:"screen",after:["render"],required:["render"],passObject:Hd(r)};[this.renderFilter,y].forEach(S=>this._renderer.registerPass(S)),this._renderer.pipeline=["render","screen"],this.scene.addEventListener("sceneMaterialUpdate",S=>this.setDirty(this.scene,S)),this.scene.addEventListener("sceneUpdate",S=>{this.setDirty(this.scene,S),S.geometryChanged!==!1&&this.renderer.resetShadows()}),this.scene.addEventListener("update",S=>this.setDirty(this.scene,S)),this._renderer.addEventListener("update",S=>this.setDirty(this._renderer,S)),this.resizeObserver&&this.resizeObserver.observe(this._canvas),window&&window.addEventListener("resize",this.resize),this._canvas.addEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.addEventListener("webglcontextlost",this._onContextLost,!1),this.renderer.addEventListener("resize",()=>{this.scene.activeCamera.refreshAspect()}),this.setBackground("#ffffff"),this.console.log("WebGi Viewer instance initialized, version: ",Ya.VERSION)}get useRgbm(){return this._useRgbm}get screenShader(){return this._screenShader}get useGBufferDepth(){return this._useGBufferDepth}get isAntialiased(){return this._isAntialiased}setDirty(e,t){this._needsReset=!0,e=e??this,this.dispatchEvent({...t??{},type:"update",source:e})}get renderer(){return this._renderer}dispose(){var e;this._canvas.removeEventListener("webglcontextrestored",this._onContextRestore,!1),this._canvas.removeEventListener("webglcontextlost",this._onContextLost,!1),(e=window.webGiViewers)===null||e===void 0||e.splice(window.webGiViewers.indexOf(this),1),this.resizeObserver?this.resizeObserver.unobserve(this._canvas):window.removeEventListener("resize",this.resize),this.dispatchEvent({type:"dispose"})}_animationLoop({time:e,deltaTime:t,xrFrame:n}){var r,o;if(this.enabled&&this.renderEnabled)if(this._isRenderingFrame)this.console.warn("animation loop: frame skip");else{this._isRenderingFrame=!0;for(let a=0;a<this.maxFramePerLoop;a++){if(this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._needsResize){const f=[this._canvas.clientWidth,this._canvas.clientHeight];if(n){const m=(o=(r=this._renderer.rendererObject.xr.getCamera())===null||r===void 0?void 0:r.cameras[0])===null||o===void 0?void 0:o.viewport;m?(m.x===0&&m.y===0||this.console.warn("x and y must be 0?"),f[0]=m.width,f[1]=m.height,this.console.log("resize for xr",f)):this._needsResize=!1}this._needsResize&&(this._renderer.setSize(...f),this._needsResize=!1)}this.dispatchEvent({type:"preFrame",target:this,time:e,deltaTime:t,xrFrame:n});const u=Object.values(this.plugins).filter(f=>f.dirty);u.length>0&&this.setDirty(u),this._needsReset&&(this._renderer.reset(),this._needsReset=!1),this._renderer.updateDirty();const p=this._renderer.dirty;if(p){this.dispatchEvent({type:"preRender",target:this});try{this._renderer.render()}catch(f){this.console.error(f),this.enabled=!1}this.dispatchEvent({type:"postRender",target:this})}if(this.dispatchEvent({type:"postFrame",target:this}),!p)break}this._isRenderingFrame=!1}}get state(){return this._state}get container(){return this._container}get canvas(){return this._canvas}getPlugin(e){return this.plugins[e.PluginType]}getPluginByType(e){return this.plugins[e]}async addPlugin(e,...t){var n;let r;r=e.prototype?new e(...t):e;const o=q_(r);return o?((n=r.dependencies)===null||n===void 0||n.forEach(a=>{this.getPlugin(a)||(this.console.log("Adding plugin dependency",a.name,"for",o),this.addPlugin(a))}),this.plugins[o]&&this.console.error(`Plugin of type ${o} already exists`,this.plugins[o],r),this.plugins[o]=r,await r.onAdded(this),this.dispatchEvent({type:"addPlugin",target:this,plugin:r}),this.setDirty(r),r):(this.console.error("PluginType is not defined for",r),r)}async removePlugin(e,t=!0){const n=q_(e);this.plugins[n]&&(await e.onRemove(this),delete this.plugins[n],t&&await e.onDispose(this),this.setDirty(e))}createCamera(e){var t;const n=(t=e.userData.iCamera)!==null&&t!==void 0?t:new yo(e,{controlsMode:"",controlsEnabled:!1},this._canvas);return n.autoLookAtTarget=!1,n}setSize(e){this._canvas.style.width=e!=null&&e.width?e.width+"px":"100%",this._canvas.style.height=e!=null&&e.height?e.height+"px":"100%",this.resize()}_backgroundIntensityChanged(){var e,t,n,r;const o=(r=(n=(t=(e=this._renderer)===null||e===void 0?void 0:e.rendererObject)===null||t===void 0?void 0:t.background.getPlaneMesh())===null||n===void 0?void 0:n.material.uniforms)!==null&&r!==void 0?r:c.Vj0.background.uniforms;o.intensity||(o.intensity={value:1}),o.intensity.value=this.backgroundIntensity,this.setDirty()}setBackgroundColor(e){const t=new Sn().set(e).convertSRGBToLinear();return this.setBackground(t)}setBackground(e){if(this._rawBackground=e,e!=null&&(typeof e=="string"||typeof e=="number"||e.isVector4||e.isColor)){if(e===El)return this._sceneEnvironmentChanged();const t=e.isVector4?Wt(e):zt(e.isColor?e:new Sn(e));return t.assetType="texture",this.scene.setBackground(t)}return!e&&this.useRgbm&&this.console.error("Transparent background not supported with HDR RGBM rendering mode"),this.scene.setBackground(e)}getBackground(e=!1){var t,n,r;if(e)return this._rawBackground;let o=(t=this._rawBackground)!==null&&t!==void 0?t:this.scene.getBackground();return o?(!((n=o)===null||n===void 0)&&n.isVector4&&(o=H_(o,7).getHexString()),!((r=o)===null||r===void 0)&&r.isColor?o.getHexString():this._rawBackground===El?this.scene.getEnvironment():o):null}getManager(){return this.getPluginByType("AssetManager")}resetCamera({rootObject:e,centerOffset:t=new c.Pa4(1,1,1),targetOffset:n=new c.Pa4(0,0,0),...r}={}){if(this.scene.activeCamera){this.scene.matrixWorldNeedsUpdate=!0,this.scene.updateMatrixWorld(!0);const o=e?new _t().expandByObject(e,!0,!0):this.scene.getBounds(!0),a=o.getCenter(new c.Pa4),u=.5*o.getSize(new c.Pa4).length();a.add(n.clone().multiplyScalar(u)),this.scene.activeCamera.position=new c.Pa4(a.x+t.x*u,a.y+t.y*u,a.z+t.z*u),this.scene.activeCamera.target=a,this.setDirty()}}async createObject3D(e){var t;return(t=this.getManager())===null||t===void 0?void 0:t.addImportedSingle(e||new c.Tme,{autoScale:!1,pseudoCenter:!1})}createPhysicalMaterial(e){return this.createMaterial("standard",e)}createMaterial(e,t){var n,r,o,a,u;if(!((n=t)===null||n===void 0)&&n.isMaterial){const p=(o=(r=this.getManager())===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(t.uuid);if(p)return p}return(u=(a=this.getManager())===null||a===void 0?void 0:a.materials)===null||u===void 0?void 0:u.generateFromTemplate(e,t)}serializePlugins(e,t){return Object.entries(this.plugins).map(n=>{var r,o;if(!t||t.includes(n[1].constructor.PluginType))return n[1].serializeWithViewer!==!1?(o=(r=n[1]).toJSON)===null||o===void 0?void 0:o.call(r,e):void 0}).filter(n=>!!n)}deserializePlugins(e,t){return e.forEach(n=>{var r;if(!n.type)return void this.console.warn("Invalid plugin to import ",n);const o=this.getPluginByType(n.type);o&&((r=o.fromJSON)===null||r===void 0||r.call(o,n,t))}),this}traverseSceneObjects(e){this.scene.modelRoot.modelObject.traverse(e)}toJSON(e,t){return Object.assign({version:Ya.VERSION,plugins:this.serializePlugins(e,t)},cn(this,!0,e))}fromJSON(e,t){return kt(e,this,!0,t),Array.isArray(e.plugins)&&this.deserializePlugins(e.plugins,t),this.setBackground(this._rawBackground),this}_setActiveCameraView(e={}){if(e.type==="setView"){if(!e.camera)return void console.warn("Cannot find camera",e);this.scene.activeCamera.copyFromCamera(e.camera)}else e.type==="activateMain"&&(this.scene.activeCamera=e.camera?this.createCamera(e.camera):void 0)}}Ya.VERSION="0.5.5",Fm([et()],Ya.prototype,"scene",void 0),Fm([et("background")],Ya.prototype,"_rawBackground",void 0),Fm([et(),we(Ya.prototype._backgroundIntensityChanged)],Ya.prototype,"backgroundIntensity",void 0);const El="envMapBackground";function Hd(s){var e,t,n;return!((e=s)===null||e===void 0)&&e.isShaderPass2?s:new _s({...C,fragmentShader:`
                       varying vec2 vUv;
                       
                       ${Array.isArray(s)?s[0]:((t=s)===null||t===void 0?void 0:t.pars)||""}
                       
                       void main() {

                            gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                            
                            ${Array.isArray(s)?s[1]:typeof s=="string"?s:((n=s)===null||n===void 0?void 0:n.main)||""}
                            
                        }`,uniforms:{tDiffuse:{value:null}}},"tDiffuse")}var Js=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ts=class extends ui{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this._lastSize=["100%","100%"],this._lastFsElement=null,this._fsChangeHandler=s=>{var e;if(this.isFullScreen())this.dispatchEvent({type:"enter"});else{const t=this._lastFsElement||((e=this._viewer)===null||e===void 0?void 0:e.canvas);t&&(t.style.width=this._lastSize[0],t.style.height=this._lastSize[1]),document.removeEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("fullscreenchange",this._fsChangeHandler,!1),document.removeEventListener("MSFullscreenChange",this._fsChangeHandler,!1),this.dispatchEvent({type:"exit"})}},this.enter=this.enter.bind(this),this.exit=this.exit.bind(this)}async enter(s){var e;if(this.isFullScreen())return;const t=s||((e=this._viewer)===null||e===void 0?void 0:e.canvas);return t?(this._lastFsElement=t,document.addEventListener&&(document.addEventListener("webkitfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("mozfullscreenchange",this._fsChangeHandler,!1),document.addEventListener("fullscreenchange",this._fsChangeHandler,!1),document.addEventListener("MSFullscreenChange",this._fsChangeHandler,!1)),this._lastSize=[t.style.width,t.style.height],t.style.width="100%",t.style.height="100%",t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():void 0):void 0}async exit(){return document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen?document.msExitFullscreen():void 0}async toggle(s){return this.isFullScreen()?this.exit():this.enter(s)}isFullScreen(){return document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement!==void 0}};ts.PluginType="FullScreenPlugin",Js([Ji("Enter FullScreen")],ts.prototype,"enter",null),Js([Ji("Exit FullScreen")],ts.prototype,"exit",null),Js([Ji("Toggle FullScreen")],ts.prototype,"toggle",null),ts=Js([Ci("Full Screen")],ts);class qp{constructor(e,t,n){this._el=e,this._inputEl=t,this._listeners={drop:[],dropstart:[],droperror:[]},this._onDragover=this._onDragover.bind(this),this._onDrop=this._onDrop.bind(this),this._onSelect=this._onSelect.bind(this),e==null||e.addEventListener("dragover",this._onDragover,!1),e==null||e.addEventListener("drop",this._onDrop,!1),t==null||t.addEventListener("change",this._onSelect),n&&Object.entries(n).forEach(([r,o])=>o&&this.on(r,o))}get inputEl(){return this._inputEl}get el(){return this._el}on(e,t){return this._listeners[e].push(t),this}_emit(e,t){return this._listeners[e].forEach(n=>n(t)),this}destroy(){const e=this._el,t=this._inputEl;e==null||e.removeEventListener("dragover",this._onDragover),e==null||e.removeEventListener("drop",this._onDrop),t==null||t.removeEventListener("change",this._onSelect)}_onDrop(e){var t,n;e.stopPropagation(),e.preventDefault(),this._emit("dropstart");const r=Array.from(((t=e.dataTransfer)===null||t===void 0?void 0:t.files)||[]),o=Array.from(((n=e.dataTransfer)===null||n===void 0?void 0:n.items)||[]);if(r.length!==0||o.length!==0)if(o.length>0){const a=o.map(u=>u.webkitGetAsEntry());this._loadNextEntry(new Map,a)}else this._emit("drop",{files:new Map(r.map(a=>(a.filePath=a.name,[a.filePath,a])))});else this._fail("Required drag-and-drop APIs are not supported in this browser.")}_onDragover(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="copy")}_onSelect(e){var t;if(!this._inputEl)return void console.warn("Invalid Dropzone event ",e);this._emit("dropstart");const n=[].slice.call((t=this._inputEl.files)!==null&&t!==void 0?t:new FileList),r=new Map;n.forEach(o=>{o.filePath=o.webkitRelativePath||o.name,r.set(o.filePath,o)}),this._emit("drop",{files:r})}_loadNextEntry(e,t){const n=t.pop();if(n)if(n.isFile)n.file(r=>{r.filePath=n.fullPath,e.set(n.fullPath,r),this._loadNextEntry(e,t)},()=>console.error("Could not load file: %s",n.fullPath));else if(n.isDirectory){const r=n.createReader(),o=a=>{a.length?(t=t.concat(a),r.readEntries(o)):this._loadNextEntry(e,t)};r.readEntries(o)}else console.warn("Unknown asset type: "+n.fullPath),this._loadNextEntry(e,t);else this._emit("drop",{files:e})}_fail(e){this._emit("droperror",{message:e})}}class Yp extends w{constructor(e){super(),this._domElement=e,this._allowedExtensions=void 0,this.importerParams={autoScale:!0,autoScaleRadius:2,pseudoCenter:!0,autoCenter:!1,autoImport:!0,autoAdd:!0,centerOffset:new c.Pa4(.5,.5,3)},this.dependencies=[dn],this.uiConfig={type:"folder",label:"Drop Options",children:[{label:"Auto Center",type:"checkbox",property:[this.importerParams,"pseudoCenter"],limitedUi:!0},{label:"Auto Scale",type:"checkbox",property:[this.importerParams,"autoScale"],limitedUi:!0},{label:"Auto scale radius",type:"slider",bounds:[.5,100],property:[this.importerParams,"autoScaleRadius"]}]}}async onAdded(e){this._inputEl=document.createElement("input"),this._viewer=e,this._inputEl.type="file",this._dropzone=new qp(this._domElement||e.canvas,this._inputEl,{drop:this._onFileDrop.bind(this)})}async _onFileDrop({files:e}){var t,n,r,o,a,u;if(!e)return;const p=this._viewer;if(!p)return;if(this._allowedExtensions!==void 0)for(const y of e.keys())this._allowedExtensions.includes((n=(t=y.split(".").pop())===null||t===void 0?void 0:t.toLowerCase())!==null&&n!==void 0?n:"")||e.delete(y);if(e.size<1)return;const f=p.getPlugin(dn),m={type:"drop",files:e};if(this.importerParams.autoImport){const y={allowedExtensions:this.allowedExtensions,...this.importerParams};if(m.imported=await((r=f.importer)===null||r===void 0?void 0:r.importFiles(e,y)),this.importerParams.autoAdd){const S=(u=[...(a=(o=m.imported)===null||o===void 0?void 0:o.values())!==null&&a!==void 0?a:[]].flat(2).filter(M=>!!M))!==null&&u!==void 0?u:[];if(m.assets=f.addProcessedAssets(S,{...this.importerParams}),!y._rootSceneImported)for(const M of m.assets)M.modelObject&&M.modelObject.dispatchEvent({type:"select",value:M.modelObject})}}this.dispatchEvent(m)}promptForFile(){var e;(e=this._inputEl)===null||e===void 0||e.click()}async onDispose(e){}async onRemove(e){var t;(t=this._dropzone)===null||t===void 0||t.destroy(),this._dropzone=void 0,this._viewer=void 0}get allowedExtensions(){return this._allowedExtensions}set allowedExtensions(e){this._allowedExtensions=e,this._inputEl&&(this._inputEl.accept=e?e.map(t=>"."+t).join(", "):"")}}Yp.PluginType="Dropzone";class Y_ extends _s{constructor(e){super({vertexShader:C.vertexShader,fragmentShader:Z`
                uniform vec4 weight;
                uniform vec4 weight2;
                varying vec2 vUv;
                void main() {
                    vec4 texel = clamp(weight * tDiffuseTexelToLinear ( texture2D( tDiffuse, vUv ) ) + weight2 * tDiffuse2TexelToLinear ( texture2D( tDiffuse2, vUv ) ), vec4(0), vec4(8));
                    gl_FragColor = texel;
                    #include <encodings_fragment>
                }
            `,uniforms:{tDiffuse:{value:null},tDiffuse2:{value:e},weight:{value:new c.Ltg(1,1,1,1)},weight2:{value:new c.Ltg(1,1,1,1)}}},"tDiffuse","tDiffuse2"),this.clear=!1,this.needsSwap=!0}set weights2(e){this.uniforms.weight2.value.copy(e)}get weights2(){return this.uniforms.weight2.value}set weights1(e){this.uniforms.weight.value.copy(e)}get weights1(){return this.uniforms.weight.value}set blendTexture(e){this.uniforms.tDiffuse2.value=e}}class Xp extends ui{constructor(){super(),this._pipeline=[]}get passes(){if(!this._passes)throw"Plugin not yet added to the viewer";return this._passes}get pipeline(){return this._pipeline}set pipeline(e){this._pipeline=e}async onAdded(e){await super.onAdded(e);const t=this.createPasses(e);this._passes=Object.fromEntries(t.map(n=>(n.passId||(console.warn("no id found for pass",n),n.passId=ki()),e.renderer.registerPass(n,!0),[n.passId,n])))}async onRemove(e){var t;if(this._passes){for(const n of[...Object.values(this._passes)]){const r=n;e.renderer.unregisterPass(r),(t=r==null?void 0:r.dispose)===null||t===void 0||t.call(r)}this._passes=void 0}await super.onRemove(e)}toJSON(e){var t,n;const r=super.toJSON(e);if(!r.type)return r;const o=Object.entries(this.passes);r.passes={};for(const[a,u]of o)r.passes[a]=cn((n=(t=u)===null||t===void 0?void 0:t.passObject)!==null&&n!==void 0?n:u,!1,e);return r}fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;if(e.passes){const o=Object.entries(this.passes);for(const[a,u]of o)kt(e.passes[a],(r=(n=u)===null||n===void 0?void 0:n.passObject)!==null&&r!==void 0?r:u,!1,t)}return this}}var K0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const X_=[{x:0,y:0},{x:-.5,y:0},{x:-.375,y:-.25},{x:-.1875,y:-.125},{x:-.125,y:-.375},{x:.0625,y:-.0625},{x:.125,y:-.3125},{x:.375,y:-.4375},{x:.3125,y:-.1875},{x:.25,y:.0625},{x:.4375,y:.25},{x:.1875,y:.3125},{x:0,y:.4375},{x:-.0625,y:.1875},{x:-.25,y:.375},{x:-.4375,y:.5},{x:-.3125,y:.125}];class lo extends Xp{constructor(e=2*X_.length){super(),this.enabled=!0,this.jitter=!0,this._hasSetOffset=!1,this.trackedJitterCameras=new Set,this._addSceneObject=t=>{const n=t.object;(n.modelObject||n.lightObject)&&(n.modelObject||n.lightObject).traverse(r=>{var o;!((o=r==null?void 0:r.shadow)===null||o===void 0)&&o.camera&&r.shadow.mapSize&&this.trackedJitterCameras.add([r.shadow.camera,r.shadow.mapSize])})},this._jitterCamera=t=>{var n;const r=t.target;if(this.jitter&&r.renderer.frameCount>2){const o=(u,p)=>{const f={...X_[r.renderer.frameCount%X_.length]};u.setViewOffset(p.width,p.height,f.x,f.y,p.width,p.height)},a=r.scene.activeCamera.cameraObject;o(a,{width:r.canvas.clientWidth*r.renderer.displayCanvasScaling,height:r.canvas.clientHeight*r.renderer.displayCanvasScaling}),this.trackedJitterCameras.forEach(u=>o(...u)),this._hasSetOffset=!0,(n=this._viewer)===null||n===void 0||n.renderer.resetShadows()}},this._resetCameraJitter=t=>{const n=t.target;this._hasSetOffset&&(n.scene.activeCamera.cameraObject.clearViewOffset(),this._hasSetOffset=!1)},this.uiConfig=Ec("Progressive",this),this.maxFrameCount=e}async onAdded(e){return this._lastFrame=e.renderer.composerTarget.clone(!0),await super.onAdded(e)}async onRemove(e){e.removeEventListener("preRender",this._jitterCamera),e.removeEventListener("postRender",this._resetCameraJitter),e.scene.removeEventListener("addSceneObject",this._addSceneObject),this._lastFrame&&e.renderer.disposeTarget(this._lastFrame),this._lastFrame=void 0,await super.onRemove(e)}get lastFrame(){return this._lastFrame}createPasses(e){e.addEventListener("preRender",this._jitterCamera),e.addEventListener("postRender",this._resetCameraJitter),e.scene.addEventListener("addSceneObject",this._addSceneObject);const t=this;return[Qd(e,{passId:"progressive",get dirty(){var r;return t.jitter&&(((r=t._viewer)===null||r===void 0?void 0:r.renderer.frameCount)||0)<t.maxFrameCount},after:["render"],before:["combinedPost","screen"],required:["render"],passObject:new class extends Y_{render(r,o,a,u,p){if(e.renderer.frameCount<1)return this.needsSwap=!1,void((a==null?void 0:a.texture)&&e.renderer.blit(a.texture,t.lastFrame,{}));this.needsSwap=!0,super.render(r,o,a,u,p),e.renderer.blit(o.texture,t.lastFrame,{})}},update(){if(!t.lastFrame)return void console.error("lastFrame render target undefined");let r=1/(Math.max(e.renderer.frameCount,0)+1);this.passObject.weights1.set(r,r,r,r),r=1-r,this.passObject.weights2.set(r,r,r,r),this.passObject.blendTexture=t.lastFrame.texture,this.passObject.material.uniformsNeedUpdate=!0}})]}isConverged(e=!1){var t;return(((t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)||0)>=this.maxFrameCount-1+(e?1:0)}updateShaderProperties(e){var t,n;return e.uniforms.tLastFrame&&(e.uniforms.tLastFrame.value=(n=(t=this.lastFrame)===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:void 0),this}postFrameConvergedRecordingDelta(e="CanvasRecorder"){const t=this._viewer.getPluginByType(e);return t&&t.isRecording()&&t.convergeMode?this.isConverged(!0)?1/t.videoFrameRate:0:-1}}lo.PluginType="Progressive",K0([et(),Si("Frame count")],lo.prototype,"maxFrameCount",void 0),K0([et(),_n("Jitter")],lo.prototype,"jitter",void 0);var Sl="varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}",Kp=`#ifndef BASIC_CAMERA_HELPERS
#define BASIC_CAMERA_HELPERS 
uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;uniform mat4 projection;
#ifndef THREE_PACKING_INCLUDED
#define THREE_PACKING_INCLUDED 
#include <packing>
#endif
float linstep(float edge0,float edge1,float value){return clamp((value-edge0)/(edge1-edge0),0.,1.);}float depthToViewZ(const in float depth){return(depth>0.999)?-cameraNearFar.y*1000.:-mix(cameraNearFar.x,cameraNearFar.y,depth);}float viewZToDepth(const in float viewZ){return linstep(-cameraNearFar.x,-cameraNearFar.y,viewZ);}vec4 viewToScreen3(const in vec3 pos){vec4 projected=projection*vec4(pos,1.);projected.z=pos.z;projected.w=1./projected.w;projected.xyz*=projected.w;projected.xy=0.5+0.5*projected.xy;return projected;}vec3 screenToView(const in vec2 uv,const in float viewZ){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewZ/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewZ/projection[1][1];return vec3(xe,ye,viewZ);}
#endif
`,Um=`#ifndef BASIC_HELPERS
#define BASIC_HELPERS 
float saturate2(float v,float mx){return max(0.,min(mx,v));}vec3 saturate2(vec3 v){return max(vec3(0.),min(vec3(1.),v));}
#endif
`,Cl=`#ifndef BASIC_RANDOM_HELPERS
#define BASIC_RANDOM_HELPERS 
uniform float frameCount;float random(float n){return fract(sin(n)*43758.5453123);}float random2(vec2 n,float x){n+=x;return fract(sin(dot(n.xy,vec2(12.9898,78.233)))*43758.5453);}float random3(vec3 v){v=fract(v*443.8975);v+=dot(v,v.yzx+19.19);return fract((v.x+v.y)*v.z);}float interleavedGradientNoise(const in vec2 fragCoord,const in float seed){vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(fragCoord.xy+seed*vec2(2.083,4.867),magic.xy)));}vec3 hash3(vec2 p){vec3 q=vec3(dot(p,vec2(127.1,311.7)),dot(p,vec2(269.5,183.3)),dot(p,vec2(419.2,371.9)));return fract(sin(q)*43758.5453);}
#endif
`,K_=`#define PI  3.141592653589793
mat3 GetTangentBasis(vec3 TangentZ){vec3 up=vec3(0.,0.,1.);vec3 TangentX=normalize(cross(dot(TangentZ,up)<0.8?up:vec3(1.,0.,0.),TangentZ));vec3 TangentY=cross(TangentZ,TangentX);return mat3(TangentX,TangentY,TangentZ);}vec4 CosineSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=sqrt(E.y);float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=CosTheta*(1./PI);return vec4(H,PDF);}vec4 UniformSampleHemisphere(vec2 E){float Phi=2.*PI*E.x;float CosTheta=E.y;float SinTheta=sqrt(1.-CosTheta*CosTheta);vec3 H;H.x=SinTheta*cos(Phi);H.y=SinTheta*sin(Phi);H.z=CosTheta;float PDF=1./(2.*PI);return vec4(H,PDF);}vec2 UniformSampleDiskConcentric(vec2 E){vec2 p=2.*E-1.;float Radius;float Phi;if(abs(p.x)>abs(p.y)){Radius=p.x;Phi=(PI/4.)*(p.y/p.x);}else{Radius=p.y;Phi=(PI/2.)-(PI/4.)*(p.x/p.y);}return vec2(Radius*cos(Phi),Radius*sin(Phi));}vec2 UniformSampleDiskConcentricApprox(vec2 E){vec2 sf=E*sqrt(2.)-sqrt(0.5);vec2 sq=sf*sf;float root=sqrt(2.*max(sq.x,sq.y)-min(sq.x,sq.y));if(sq.x>sq.y){sf.x=sf.x>0.?root:-root;}else{sf.y=sf.y>0.?root:-root;}return sf;}`,jm=`#ifndef SSRT_PARS_SNIP
#define SSRT_PARS_SNIP 
#define pow2(a)a*a
float getDepth2(const in vec2 uv,const in float lod){float viewDepth=getDepth(uv);return depthToViewZ(viewDepth);}
#define LOD_DEPTH  1.0
#define LOD_COLOR  5.0
void _traceRay(in vec4 ray_origin,in vec4 ray_dir,in float tolerance,inout vec3 state,in int loopMax,in float iStepCount){vec4 sample_uv;float d,hit;float dLod=0.;
#pragma unroll_loop_start
for(int i=0;i<8;i++){if(UNROLLED_LOOP_INDEX<loopMax){sample_uv=ray_origin+ray_dir*state.y;d=getDepth2(sample_uv.xy,dLod);d=sample_uv.z/sample_uv.w-d;if(abs(d+tolerance)<tolerance){hit=clamp(state.x/(state.x-d),0.,1.)-1.;hit=(state.y+hit*iStepCount);state.z=min(state.z,hit);}state.x=d;state.y+=1.*iStepCount;}}
#pragma unroll_loop_end
}vec3 traceRay(in vec3 ray_origin_view,in vec3 ray_dir_view,in float tolerance,inout vec3 state,in int _STEP_COUNT){vec4 sample_uv;vec4 ray_origin=viewToScreen3(ray_origin_view);vec3 ray_end_view=ray_origin_view+ray_dir_view;vec4 ray_dir=viewToScreen3(ray_end_view);vec2 clamp_end=clamp(ray_dir.xy,vec2(0.),vec2(1.));vec2 correction=abs(ray_dir.xy-clamp_end);correction=(step(0.01,correction)*correction/(abs(clamp_end-ray_origin.xy)+0.01))+1.;correction.x=1./min(max(correction.y,correction.x),10.);ray_dir=ray_dir-ray_origin;ray_dir.xyw*=correction.x;float iStepCount=1./float(_STEP_COUNT);tolerance*=0.125;_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT,iStepCount);if(_STEP_COUNT>8&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-8,iStepCount);if(_STEP_COUNT>15&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);if(_STEP_COUNT>23&&state.z>0.98)_traceRay(ray_origin,ray_dir,tolerance,state,_STEP_COUNT-16,iStepCount);sample_uv=ray_origin+ray_dir*state.z;sample_uv.z/=sample_uv.w;state.z=state.z<0.999?state.z:9999999.;return sample_uv.xyz;}
#endif
`,J0=`uniform float objectRadius;uniform float radius;uniform float tolerance;uniform bool autoRadius;
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
vec3 ComputeReflectionL(vec3 N,vec2 E,vec3 V,float rough){float rough4=rough*rough*rough*rough;float phi=2.*PI*E.x;float cos_theta=pow(max(E.y,0.000001),rough4/(2.-rough4));float sin_theta=sqrt(max(0.,1.-cos_theta*cos_theta));vec3 half_vec=vec3(sin_theta*cos(phi),sin_theta*sin(phi),cos_theta);vec3 tangentX=normalize(cross(abs(N.z)<0.999?vec3(0.,0.,1.):vec3(1.,0.,0.),N));vec3 tangentY=cross(N,tangentX);half_vec=half_vec.x*tangentX+half_vec.y*tangentY+half_vec.z*N;vec3 ray_dir=(2.*dot(V,half_vec))*half_vec-V;return ray_dir;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=interleavedGradientNoise(gl_FragCoord.xy,frameCount*117.);rand_e.y=fract(rand_e.x*38.65435);rand_e.y=mix(rand_e.y,1.,0.7);return rand_e;}vec4 calculateSSR(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor,in float roughness){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeReflectionL(normal,E,-normalize(viewPos),roughness);L=normalize(L);float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?mix((cameraDist+objectRadius*sceneBoundingRadius)+viewPos.z,-viewPos.z-max(0.,cameraDist-objectRadius*sceneBoundingRadius),L.z*0.5+0.5):objectRadius*sceneBoundingRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount+seed);rayLen=max(rayLen,0.001);int steps=SSR_STEP_COUNT/(frameCount<float(SSR_LOW_QUALITY_FRAMES)?2:1);vec3 state=vec3(0.,(r+0.5)/float(steps),2.);viewPos+=normal*max(-0.0001*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,steps);if(state.z<0.99){vec3 hitColor=(tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy))).rgb;float ssrWeight=1.;return vec4(hitColor*ssrWeight,1.);}return vec4(0.);}`,zm=`#ifndef SIMPLE_CAMERA_HELPERS
#define SIMPLE_CAMERA_HELPERS 
#ifndef USE_TRANSMISSION
uniform mat4 projectionMatrix;
#endif
vec3 viewToScreen(const in vec3 pos){vec4 projected=projectionMatrix*vec4(pos,1.);return vec3(0.5+0.5*projected.xy/projected.w,projected.w);}
#endif
`,Ml=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ca=class extends _s{constructor(s,e,t,n=!0){super({vertexShader:Sl,fragmentShader:`

varying vec2 vUv;

${Um}
${Kp}
${Cl}
${K_}
${t}

${jm}

${J0}

uniform sampler2D tLastThis;void main(){vec4 texel=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 lastAO=tLastThisTexelToLinear(texture2D(tLastThis,vUv));float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>=0.999){discard;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec3 viewPos=screenToView(screenPos.xy,screenPos.z);viewPos.z=viewZ/viewPos.z;vec4 ao=vec4(0.);ao+=calculateSSR(8.,screenPos,normal,1.,0.1);ao.rgb=min(vec3(3.),ao.rgb);ao.rgb=max(vec3(0.),ao.rgb);if(frameCount<1.){gl_FragColor=ao;return;}if(ao.a<0.01){gl_FragColor.rgb=lastAO.rgb;gl_FragColor.a=(((lastAO.a)*frameCount)/(frameCount+1.));}else{gl_FragColor=((ao+(lastAO)*frameCount)/(frameCount+1.));}
#include <encodings_fragment>
}


            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:0},boost:{value:new c.Pa4(0,0,0)},objectRadius:{value:0},autoRadius:{value:!1},power:{value:0},maskFrontFactor:{value:-.1},tolerance:{value:0},frameCount:{value:0},projection:{value:new c.yGw},cameraPositionWorld:{value:new c.Pa4},cameraNearFar:{value:new c.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},defines:{PERSPECTIVE_CAMERA:1,SSR_STEP_COUNT:16,SSR_LOW_QUALITY_FRAMES:2,SSR_MASK_FRONT_RAYS:!0,SSR_INLINE:n?"1":"0",SSR_NON_PHYSICAL:"0"}},"tDiffuse","tLastThis","tLastFrame"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,o,a)=>{if(!r.defines.SSR_ENABLED)return;const u="#glMarker beforeModulation";r.fragmentShader=r.fragmentShader.replace(u,`

            
            #if defined(SSR_ENABLED) && SSR_ENABLED > 0
vec3 screenPos=viewToScreen(geometry.position);vec4 ssrColor=vec4(0,0,0,0);float alphaModifier=1.-clamp(material.roughness*.3,0.,1.);alphaModifier*=ssrIntensity;
#if defined(SSR_MASK_FRONT_RAYS) && SSR_MASK_FRONT_RAYS > 0
alphaModifier*=clamp(-4.*dot(geometry.viewDir,normal)+(4.+ssrMaskFrontFactor),0.,1.);
#endif
#ifdef USE_TRANSMISSION
alphaModifier*=1.-transmission;
#endif
float vignette=1.;if(true){float fadeStrength=0.1;float dist=min(min(1.-screenPos.x,1.-screenPos.y),min(screenPos.x,screenPos.y));float fade=dist*dist/(fadeStrength+0.001);fade=clamp(fade,0.,1.);fade=pow(fade,0.3);vignette=fade;}alphaModifier*=vignette;vec3 specularColor=EnvironmentBRDF(geometry.normal,geometry.viewDir,material.specularColor.rgb,material.specularF90,material.roughness);if(length(specularColor.rgb)*alphaModifier>0.01&&roughnessFactor<0.9){
#if defined(SSR_INLINE) && SSR_INLINE > 0
ssrColor=calculateSSR(8.,vec3(screenPos.xy,geometry.position.z),geometry.normal,1.,material.roughness);
#else
ssrColor=tSSRMapTexelToLinear(texture2D(tSSRMap,screenPos.xy));
#endif 
}ssrColor.rgb*=ssrBoost;ssrColor.a*=alphaModifier;ssrColor.a=min(ssrColor.a,1.);
#if defined(SSR_NON_PHYSICAL) && SSR_NON_PHYSICAL > 0
diffuseColor.a=max(ssrColor.a,diffuseColor.a*diffuseColor.a);reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(diffuseColor.rgb*ssrColor.rgb),1.);reflectedLight.indirectDiffuse=diffuseColor.rgb*(1.-ssrColor.a);reflectedLight.directDiffuse=vec3(0.);reflectedLight.directSpecular=vec3(0.);
#else
reflectedLight.indirectSpecular=mix(reflectedLight.indirectSpecular,saturate(specularColor.rgb*ssrColor.rgb),ssrColor.a);
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${u}`)},onObjectRender:(r,o,a)=>{var u,p,f,m;let y=this.enabled&&a.userData.screenSpaceRendering!==!1&&!(!((u=o.materialObject.userData)===null||u===void 0)&&u.ssreflDisabled)?1:0;o.materialObject.defines.SSR_ENABLED!==y&&(o.materialObject.defines.SSR_ENABLED=y,o.materialObject.needsUpdate=!0),y=this.material.defines.SSR_STEP_COUNT,o.materialObject.defines.SSR_STEP_COUNT!==y&&(o.materialObject.defines.SSR_STEP_COUNT=y,o.materialObject.needsUpdate=!0),y=this.material.defines.SSR_LOW_QUALITY_FRAMES,o.materialObject.defines.SSR_LOW_QUALITY_FRAMES!==y&&(o.materialObject.defines.SSR_LOW_QUALITY_FRAMES=y,o.materialObject.needsUpdate=!0),y=this.material.defines.PERSPECTIVE_CAMERA,o.materialObject.defines.PERSPECTIVE_CAMERA!==y&&(o.materialObject.defines.PERSPECTIVE_CAMERA=y,o.materialObject.needsUpdate=!0),y=this.material.defines.SSR_INLINE,o.materialObject.defines.SSR_INLINE!==y&&(o.materialObject.defines.SSR_INLINE=y,o.materialObject.needsUpdate=!0),y=this.material.defines.SSR_MASK_FRONT_RAYS?1:0,o.materialObject.defines.SSR_MASK_FRONT_RAYS!==y&&(o.materialObject.defines.SSR_MASK_FRONT_RAYS=y,o.materialObject.needsUpdate=!0),y=!((p=o.materialObject.userData)===null||p===void 0)&&p.ssreflNonPhysical?"1":"0",o.materialObject.defines.SSR_NON_PHYSICAL!==y&&(o.materialObject.defines.SSR_NON_PHYSICAL=y,o.materialObject.needsUpdate=!0),y=(m=(f=this._target)===null||f===void 0?void 0:f.texture)!==null&&m!==void 0?m:null,this.materialExtension.extraUniforms.tSSRMap.value!==y&&(this.materialExtension.extraUniforms.tSSRMap.value=y,o.materialObject.needsUpdate=!0)},parsFragmentSnippet:r=>{var o;return`
uniform float ssrPower;
uniform float ssrIntensity;
uniform float ssrMaskFrontFactor;
uniform vec3 ssrBoost;
uniform sampler2D tSSRMap;
uniform sampler2D tLastFrame;
`+ft("tSSRMap",(o=this._target)===null||o===void 0?void 0:o.texture,r.capabilities.isWebGL2)+ft("tLastFrame",this.materialExtension.extraUniforms.tLastFrame.value,r.capabilities.isWebGL2)+(this._inline?`
#if 1
// #if SSR_INLINE
    ${Um}
    
    #define THREE_PACKING_INCLUDED
    ${Kp}
    
    ${Cl}
    ${K_}
    ${Yl}
    
    ${jm}
    
    ${J0}
// #endif // SSR_INLINE
#endif
`:"")+`

${zm}

        `},extraUniforms:{tSSRMap:{value:null},ssrPower:this.material.uniforms.power,ssrIntensity:this.material.uniforms.intensity,ssrMaskFrontFactor:this.material.uniforms.maskFrontFactor,ssrBoost:this.material.uniforms.boost,tNormalDepth:this.material.uniforms.tNormalDepth,tLastFrame:this.material.uniforms.tLastFrame,objectRadius:this.material.uniforms.objectRadius,autoRadius:this.material.uniforms.autoRadius,tolerance:this.material.uniforms.tolerance,frameCount:this.material.uniforms.frameCount,projection:this.material.uniforms.projection,cameraPositionWorld:this.material.uniforms.cameraPositionWorld,cameraNearFar:this.material.uniforms.cameraNearFar,sceneBoundingRadius:this.material.uniforms.sceneBoundingRadius},computeCacheKey:r=>{var o,a;return this.enabled?"1":"0"+((a=(o=this._target)===null||o===void 0?void 0:o.texture)===null||a===void 0?void 0:a.encoding)},isCompatible:r=>{var o;return!(!((o=r.materialObject.userData)===null||o===void 0)&&o.ssreflDisabled)&&r.isMeshStandardMaterial2}},this.intensity=1,this.boost=new c.Pa4(1,1,1),this.objectRadius=1,this.autoRadius=!0,this.power=1.1,this.tolerance=.5,this.stepCount=16,this.lowQualityFrames=0,this.maskFrontRays=!0,this.maskFrontFactor=-.2,this._renderer=s,this._target=e,this.needsSwap=!1,this._inline=n}render(s,e,t,n,r){if(this._inline)this.needsSwap=!1;else{if(!this._target)throw"Target must be set when inline = false";this._renderer.blit(this._target.texture,e,{}),this.uniforms.tLastThis.value=e.texture,super.render(s,this._target,t,n,r),this.needsSwap=!1}}};Ml([wn("Intensity",[0,4]),et(),be()],Ca.prototype,"intensity",void 0),Ml([Yr("Boost"),et(),be()],Ca.prototype,"boost",void 0),Ml([wn("Object Radius",[.01,2]),et(),be()],Ca.prototype,"objectRadius",void 0),Ml([_n("Auto radius"),et(),be()],Ca.prototype,"autoRadius",void 0),Ml([wn("Power",[0,3]),et(),be()],Ca.prototype,"power",void 0),Ml([wn("Tolerance",[.1,5]),et(),be()],Ca.prototype,"tolerance",void 0),Ml([wn("Step count",[1,32],1),et(),Xe("SSR_STEP_COUNT")],Ca.prototype,"stepCount",void 0),Ml([wn("Low Quality Frames",[0,4],1),et(),Xe("SSR_LOW_QUALITY_FRAMES")],Ca.prototype,"lowQualityFrames",void 0),Ml([_n("Ignore front rays"),et(),Xe("SSR_MASK_FRONT_RAYS")],Ca.prototype,"maskFrontRays",void 0),Ml([wn("Mask front rays factor",[-1,1],.01,s=>({hidden:()=>!s.maskFrontRays})),et(),be()],Ca.prototype,"maskFrontFactor",void 0),Ca=Ml([Ci("Screen Space Reflections")],Ca);class Vm extends Xp{constructor(){super(),this.dependencies=[dn,xr,lo],this.inlineSSR=!0,this.setDirty=this.setDirty.bind(this)}get ssrTarget(){return this._ssrTarget}get enabled(){var e,t;return((t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssr)===null||t===void 0)&&t.passObject&&(this.passes.ssr.passObject.enabled=e)}async onAdded(e){var t,n;e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSRPlugin"),await super.onAdded(e),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}createPasses(e){var t,n;return this._ssrTarget=this.inlineSSR?void 0:e.renderer.createTarget({sizeMultiplier:1}),[Qd(e,{passId:"ssr",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new Ca(e.renderer,this._ssrTarget,(n=(t=e.getPlugin(xr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:"",this.inlineSSR)},()=>[e.getPlugin(xr),e.getPlugin(lo),e.scene.activeCamera,e.renderer,e.scene])]}async onRemove(e){return this._ssrTarget&&e.renderer.disposeTarget(this._ssrTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.passes.ssr)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(u=>Se(u)))===null||o===void 0||o.flat(2).forEach(u=>u&&(u.onChange=this.setDirty)),a}}Vm.PluginType="SSReflection";var $0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Gm extends _s{constructor(e,t,n="rgba"){super({vertexShader:C.vertexShader,fragmentShader:t+`uniform vec2 tDiffuseSize;uniform vec2 bilDirection;varying vec2 vUv;uniform bool smoothEnabled;uniform float edgeSharpness;vec4 bilaterialAO(){vec4 color=clamp((texture2D(tDiffuse,vUv.xy)).B_SRC_ACCESSOR,0.,5.);if(!smoothEnabled)return color;float depth;vec3 normal;getDepthNormal(vUv.xy,depth,normal);float gaussianWeights[4];gaussianWeights[0]=0.153170;gaussianWeights[1]=0.144893;gaussianWeights[2]=0.122649;gaussianWeights[3]=0.092902;float Z=gaussianWeights[0]+0.03;vec4 final_colour=Z*color;vec2 nuv;vec4 cc;float dp;vec3 nor;vec2 direction=bilDirection/tDiffuseSize.xy;
#pragma unroll_loop_start
for(int i=0;i<6;i++){direction*=-1.;nuv=vUv+2.*direction*float(UNROLLED_LOOP_INDEX/2+1);getDepthNormal(nuv,dp,nor);if(dp<0.999){float normalCloseness=dot(normal,nor);normalCloseness*=normalCloseness;float normalError=(1.-normalCloseness)*8.;float normalWeight=max((1.-normalError*edgeSharpness),0.00);float depthWeight=max(0.,1.-edgeSharpness*4000.*abs(depth-dp));float kernelWeight=gaussianWeights[UNROLLED_LOOP_INDEX/2]+0.03;float bilateralWeight=kernelWeight*depthWeight*normalWeight;Z+=bilateralWeight;cc=clamp((texture2D(tDiffuse,nuv)).B_SRC_ACCESSOR,0.,5.);final_colour+=bilateralWeight*cc;}}
#pragma unroll_loop_end
final_colour/=Z;return final_colour;}void main(){vec4 ao=clamp(bilaterialAO(),vec4(0.),vec4(1.));gl_FragColor=ao;}`,uniforms:{bilDirection:{value:new c.FM8(1,0)},tNormalDepth:{value:null},tDiffuse:{value:e.texture},tDiffuseSize:{value:new c.FM8}},defines:{B_SRC_ACCESSOR:n}},"tDiffuse"),this.smoothEnabled=!0,this.edgeSharpness=.1,this._target=e,this.clear=!1,this.needsSwap=!1}render(e,t,n,r,o){var a,u,p,f;this.enabled&&(this.uniforms.bilDirection.value.set(1,0),this.uniforms.tDiffuse.value=this._target.texture,this.uniforms.tDiffuseSize.value.set(((a=this.uniforms.tDiffuse.value)===null||a===void 0?void 0:a.image.width)||0,((u=this.uniforms.tDiffuse.value)===null||u===void 0?void 0:u.image.height)||0),super.render(e,t,this._target,r,o),this.uniforms.bilDirection.value.set(0,1),this.uniforms.tDiffuse.value=t.texture,this.uniforms.tDiffuseSize.value.set(((p=this.uniforms.tDiffuse.value)===null||p===void 0?void 0:p.image.width)||0,((f=this.uniforms.tDiffuse.value)===null||f===void 0?void 0:f.image.height)||0),super.render(e,this._target,t,r,o))}}$0([et(),be()],Gm.prototype,"smoothEnabled",void 0),$0([et(),be()],Gm.prototype,"edgeSharpness",void 0);var Z0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class J_ extends _s{constructor(e,t,n){super({defines:{LINEAR_DEPTH:1,NUM_SAMPLES:11,NUM_SPIRAL_TURNS:3,DEPTH_NORMAL_TEXTURE:1,DEPTH_PACKING_MODE:2,PERSPECTIVE_CAMERA:1},uniforms:{tLastThis:{value:null},tNormalDepth:{value:null},screenSize:{value:new c.FM8(512,512)},saoData:{value:new c.Ltg},frameCount:{value:0},cameraNearFar:{value:new c.FM8(.1,1e3)},projection:{value:new c.yGw},saoBiasEpsilon:{value:new c.Pa4(1,1,1)}},vertexShader:Sl,fragmentShader:`

${Cl}

${n}

#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cameraNearFar;uniform mat4 projection;uniform sampler2D tLastThis;uniform vec4 saoData;uniform vec3 saoBiasEpsilon;uniform vec2 screenSize;const float INV_NUM_SAMPLES=1./float(NUM_SAMPLES);float getViewZFromNDCZ(const in float depth){
#if PERSPECTIVE_CAMERA == 1
return perspectiveDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#else
return orthographicDepthToViewZ(depth,cameraNearFar.x,cameraNearFar.y);
#endif
}vec3 packFloatToRGB(const in float x){const vec3 code=vec3(1.,255.,65025.);vec3 pack=vec3(code*x);pack.gb=fract(pack.gb);pack.rg-=pack.gb*(1./256.);return pack;}vec3 getViewPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return vec3(xe,ye,viewDepth);}float decodeDepth(const in vec2 uv){vec4 uncodedDepth;
#if DEPTH_PACKING_MODE == 2
uncodedDepth=texture2D(tNormalDepth,uv);
#else
uncodedDepth=texture2D(tDepth,uv);
#endif
#if DEPTH_PACKING_MODE == 0
return uncodedDepth.x;
#elif DEPTH_PACKING_MODE == 1
#if LINEAR_DEPTH == 1
return pow2(unpackRGBAToDepth(uncodedDepth));
#else
return unpackRGBAToDepth(uncodedDepth);
#endif
#else
return pow2(unpack16(uncodedDepth.xy));
#endif
}vec3 getPositionFromOffset(const in vec2 uv,const in vec2 offset,const in float screenSpaceRadius){vec2 uvOffset=uv+floor(screenSpaceRadius*offset)/screenSize;float d=decodeDepth(uvOffset);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(d);return getViewPositionFromViewZ(uvOffset,centerViewZ);
#else
d=mix(-cameraNearFar.x,-cameraNearFar.y,d);return getViewPositionFromViewZ(uvOffset,d);
#endif
}float getOcclusion(const in vec2 uv,const in int id,const in float randomAngle,const in float occlusionSphereRadius,const in vec3 centerPosition,const in vec3 centerNormal){float screenSpaceRadius=(float(id)+mod(randomAngle,1.)+0.5)*INV_NUM_SAMPLES;float angle=screenSpaceRadius*(float(NUM_SPIRAL_TURNS)*6.28)+randomAngle;screenSpaceRadius=(screenSpaceRadius*occlusionSphereRadius);vec2 offset=vec2(cos(angle),sin(angle));vec3 samplePosition=getPositionFromOffset(uv,offset,screenSpaceRadius);vec3 direction=samplePosition-centerPosition;float d2=dot(direction,direction);float ao=max((dot(centerNormal,direction)+centerPosition.z*saoBiasEpsilon.x)/(saoBiasEpsilon.z*d2+saoBiasEpsilon.y),0.);return ao;}void main(){float centerDepth;vec3 centerNormal;getDepthNormal(vUv,centerDepth,centerNormal);
#if LINEAR_DEPTH == 0
float centerViewZ=getViewZFromNDCZ(centerDepth);
#else
float centerViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,centerDepth);
#endif
vec3 centerPosition=getViewPositionFromViewZ(vUv,centerViewZ);float occlusionSphereScreenRadius=200.*saoData.z/(-centerPosition.z);float randomAngle=6.2*random3(vec3(vUv,frameCount*0.1));float sum=0.;sum+=getOcclusion(vUv,0,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#if NUM_SAMPLES > 1
sum+=getOcclusion(vUv,1,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 2
sum+=getOcclusion(vUv,2,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 3
sum+=getOcclusion(vUv,3,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 4
sum+=getOcclusion(vUv,4,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 5
sum+=getOcclusion(vUv,5,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 6
sum+=getOcclusion(vUv,6,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 7
sum+=getOcclusion(vUv,7,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 8
sum+=getOcclusion(vUv,8,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 9
sum+=getOcclusion(vUv,9,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
#if NUM_SAMPLES > 10
sum+=getOcclusion(vUv,10,randomAngle,occlusionSphereScreenRadius,centerPosition,centerNormal);
#endif
float aoValue=sum*saoData.y*INV_NUM_SAMPLES;aoValue=clamp(1.-max(aoValue,0.),0.,1.);gl_FragColor.gba=packFloatToRGB(centerDepth);gl_FragColor.r=(vec4(aoValue)).r;}

            `},"tDiffuse"),this.parameters={intensity:.25,occlusionWorldRadius:1,bias:.001,falloff:1,edgeSharpness:.3,blurEnabled:!0},this._smoothEnabled=!0,this.materialExtension={shaderExtender:(r,o,a)=>{r.defines.SSAO_ENABLED&&(r.fragmentShader=r.fragmentShader.replace("#include <aomap_fragment>",`#ifndef USE_TRANSMISSION
#if defined(SSAO_ENABLED) && SSAO_ENABLED > 0
float ambientOcclusion=tSSAOMapTexelToLinear(texture2D(tSSAOMap,viewToScreen(vViewPosition.xyz).xy)).r;reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);
#endif
#endif
#endif
`))},onObjectRender:(r,o,a)=>{var u,p;this.materialExtension.extraUniforms.tSSAOMap.value=(u=this._target)===null||u===void 0?void 0:u.texture;const f=o.materialObject,m=!f.transparent&&f.transmission<.001;let y=this.enabled&&m&&a.userData.screenSpaceRendering!==!1&&!(!((p=o.materialObject.userData)===null||p===void 0)&&p.ssaoDisabled)?1:0;f.defines.SSAO_ENABLED!==y&&(f.defines.SSAO_ENABLED=y,f.needsUpdate=!0),y=this._target.texture,this.materialExtension.extraUniforms.tSSAOMap.value!==y&&(this.materialExtension.extraUniforms.tSSAOMap.value=y,f.needsUpdate=!0)},parsFragmentSnippet:r=>{var o;return Z`
             uniform sampler2D tSSAOMap;
             ${ft("tSSAOMap",(o=this._target)===null||o===void 0?void 0:o.texture,r.capabilities.isWebGL2)}
            ${zm}
        `},extraUniforms:{tSSAOMap:{value:null}},computeCacheKey:r=>{var o,a;return this.enabled?"1":"0"+((a=(o=this._target)===null||o===void 0?void 0:o.texture)===null||a===void 0?void 0:a.encoding)},isCompatible:r=>{var o;return!(!((o=r.materialObject.userData)===null||o===void 0)&&o.ssaoDisabled)&&r.isMeshStandardMaterial2}},this._renderer=e,this._target=t,this.needsSwap=!1,this.clear=!0,this.bilateralPass=new Gm(this._target,n,"rrrr")}get smoothEnabled(){return this._smoothEnabled}set smoothEnabled(e){this._smoothEnabled=e,this.bilateralPass.enabled=e,this.bilateralPass.uniforms.smoothEnabled.value=e}render(e,t,n,r,o){this.enabled&&(this._updateParameters(),this._renderer.blit(this._target.texture,t,{}),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,o),this._smoothEnabled&&this.bilateralPass.render(e,t,n,r,o))}_updateParameters(){const e=this.material.uniforms.saoData.value;e.y=this.parameters.intensity,e.z=this.parameters.occlusionWorldRadius;const t=this.material.uniforms.saoBiasEpsilon.value;t.x=this.parameters.bias,t.y=.001,t.z=this.parameters.falloff}}Z0([et()],J_.prototype,"bilateralPass",void 0),Z0([et()],J_.prototype,"parameters",void 0);class Qm extends Xp{constructor(){super(),this.dependencies=[dn,xr],this.setDirty=this.setDirty.bind(this)}get aoTarget(){return this._aoTarget}async onAdded(e){return e.getPluginByType("Ground")&&console.error("GroundPlugin must be added after SSAOPlugin"),super.onAdded(e)}createPasses(e){var t,n;return this._aoTarget=e.renderer.createTarget({sizeMultiplier:1}),[Qd(e,{passId:"ssao",after:["gbuffer"],before:["render"],required:["render","gbuffer"],passObject:new J_(e.renderer,this._aoTarget,(n=(t=e.getPlugin(xr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:""),update(){this.passObject.bilateralPass.updateShaderProperties([e.getPlugin(xr)])}},()=>[e.getPlugin(xr),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._aoTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get enabled(){var e,t;return((t=(e=this.passes.ssao)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssao)===null||t===void 0)&&t.passObject&&(this.passes.ssao.passObject.enabled=e)}get uiConfig(){var e;if(this._uiConfig)return this._uiConfig;const t=this,n=t.passes.ssao.passObject;return this._uiConfig={type:"folder",label:"SS Ambient Occlusion",children:[{type:"checkbox",label:"Enabled",property:[n,"enabled"],onChange:t.setDirty},{type:"slider",label:"Intensity",bounds:[0,4],property:[n.parameters,"intensity"],onChange:t.setDirty},{type:"slider",label:"Radius",bounds:[.1,8],property:[n.parameters,"occlusionWorldRadius"],onChange:t.setDirty},{type:"slider",label:"Bias",bounds:[1e-5,.01],property:[n.parameters,"bias"],onChange:t.setDirty},{type:"slider",label:"Falloff",bounds:[.01,3],property:[n.parameters,"falloff"],onChange:t.setDirty},{type:"slider",label:"Num samples",stepSize:1,bounds:[1,11],property:[(e=n.material)===null||e===void 0?void 0:e.defines,"NUM_SAMPLES"],onChange:[()=>n.material.needsUpdate=!0,t.setDirty]},{type:"checkbox",property:[n.bilateralPass,"smoothEnabled"],onChange:t.setDirty},{type:"vec4",property:[n.bilateralPass,"edgeSharpness"],onChange:t.setDirty}]}}}Qm.PluginType="SSAO";class eA{constructor(e){this._normalsCache={},this._renderer=e,this._scene=new c.xsS,this._mesh=new c.Kj0,this._mesh.frustumCulled=!1,this._scene.add(this._mesh),this._mesh.position.set(0,0,0),this._mesh.material=new tA}dispose(){this._mesh.material.dispose()}captureNormalMap(e,t,n=512){if(!e)throw"No geometry";if(e.userData._normalsCaptureMap)return!1;const r=t==null?void 0:t.split(";").find(p=>this._normalsCache[p]);if(r){const p=this._normalsCache[r];return t==null||t.split(";").forEach(f=>f!==r&&(this._normalsCache[f]=p)),p.width!==n&&console.warn("last cacheKey normalMapRes mismatch, check model",n),e.userData._normalsCaptureMap=p,!1}const o=this._renderer.createTargetCustom({width:n,height:n},{minFilter:c.TyD,magFilter:c.TyD,generateMipmaps:!1,type:c.cLu},c.oAp);if(!o)throw"Unable to create render target";t==null||t.split(";").forEach(p=>this._normalsCache[p]=o),o.addEventListener("dispose",()=>delete this._normalsCache[t]);const a=new c._am(1e-4,100,o);this._scene.add(a);const u=e.userData._normalsCaptureOffsets;return u.center!==void 0&&this._mesh.material.uniforms.offsetCenter.value.copy(u.center),u.offsetMatrixInv!==void 0&&this._mesh.material.uniforms.offsetMatrixInv.value.copy(u.offsetMatrixInv),u.radius!==void 0&&(this._mesh.material.uniforms.radius.value=u.radius),this._mesh.geometry=e,a.update(this._renderer.rendererObject,this._scene),this._scene.remove(a),this._mesh.geometry=void 0,e.userData._normalsCaptureMap=o,!0}}class tA extends c.jyz{constructor(){super({vertexShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform mat4 offsetMatrixInv;uniform vec3 offsetCenter;void main(){vNormal=normalize((offsetMatrixInv*vec4(normal,0.)).xyz);vecPosition=(modelMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*offsetMatrixInv*vec4(position-offsetCenter,1.);}",fragmentShader:"varying vec3 vNormal;varying vec3 vecPosition;uniform float radius;void main(){vec3 color=normalize(vNormal);color=color*0.5+0.5;gl_FragColor=vec4(color.x,color.y,color.z,length(vecPosition)/radius);}",side:c.ehD,clipping:!1,uniforms:{radius:{value:1},offsetMatrixInv:{value:new c.yGw().identity()},offsetCenter:{value:new c.Pa4}}})}}var gw=__webpackgi_require__(654);function nA(s){const e=new c.Pa4(0,0,0),t=new c.Pa4(0,0,0),n=new c.Pa4(0,0,0),r=new c.Pa4(0,0,0),o=s.getAttribute("position"),a=s.index;if(a)for(let S=Math.max(0,s.drawRange.start),M=Math.min(a.count,s.drawRange.start+s.drawRange.count)-1;S<M/3;S+=3){const P=a.getX(S),D=a.getX(S+1),j=a.getX(S+2);t.set(o.getX(P),o.getY(P),o.getZ(P)),n.set(o.getX(D),o.getY(D),o.getZ(D)),r.set(o.getX(j),o.getY(j),o.getZ(j)),n.sub(t),r.sub(t),r.cross(n),r.normalize(),e.add(r)}else for(let S=0;S<o.count;S+=3)t.set(o.getX(S),o.getY(S),o.getZ(S)),n.set(o.getX(S+1),o.getY(S+1),o.getZ(S+1)),r.set(o.getX(S+2),o.getY(S+2),o.getZ(S+2)),n.sub(t),r.sub(t),r.cross(n),r.normalize(),e.add(r);e.normalize();let u=!1,p=0;for(;!u;){const S=p/3,M=a?a.getX(S):S,P=a?a.getX(S+1):S+1;t.set(o.getX(M),o.getY(M),o.getZ(M)),n.set(o.getX(P),o.getY(P),o.getZ(P)),t.sub(n),t.normalize();const D=e.dot(t);Math.abs(D-1)>.001&&t.length()>.5&&(u=!0),p+=3}n.crossVectors(t,e),n.normalize(),t.crossVectors(e,n),t.normalize();const f=new c.yGw;f.elements[0]=t.x,f.elements[1]=t.y,f.elements[2]=t.z,f.elements[3]=0,f.elements[4]=e.x,f.elements[5]=e.y,f.elements[6]=e.z,f.elements[7]=0,f.elements[8]=n.x,f.elements[9]=n.y,f.elements[10]=n.z,f.elements[11]=0,f.elements[12]=0,f.elements[13]=0,f.elements[14]=0,f.elements[15]=1,s.computeBoundingSphere();const m=s.boundingSphere.radius,y=new c.yGw().makeScale(m,m,m);return f.multiply(y),f}function iA(s){const e=s.getAttribute("position");if(e.count>0)return nA(s);const t=new c.Pa4(0,0,0),n=new c.Pa4(0,0,0),r=new c.Pa4(0,0,0),o=s.index,a=[];if(o)for(let y=Math.max(0,s.drawRange.start),S=Math.min(o.count,s.drawRange.start+s.drawRange.count)-1;y<S/3;y+=3){const M=o.getX(y),P=o.getX(y+1),D=o.getX(y+2);t.set(e.getX(M),e.getY(M),e.getZ(M)),n.set(e.getX(P),e.getY(P),e.getZ(P)),r.set(e.getX(D),e.getY(D),e.getZ(D)),a.push(t.toArray(),n.toArray(),r.toArray())}else for(let y=0;y<e.count;y++)t.set(e.getX(y),e.getY(y),e.getZ(y)),a.push(t.toArray());const u=(0,gw.getEigenVectors)(a),p=new c.yGw;p.elements[0]=u[0].vector[0],p.elements[1]=u[0].vector[1],p.elements[2]=u[0].vector[2],p.elements[3]=0,p.elements[4]=u[1].vector[0],p.elements[5]=u[1].vector[1],p.elements[6]=u[1].vector[2],p.elements[7]=0,p.elements[8]=u[2].vector[0],p.elements[9]=u[2].vector[1],p.elements[10]=u[2].vector[2],p.elements[11]=0,p.elements[12]=0,p.elements[13]=0,p.elements[14]=0,p.elements[15]=1,console.log(p.determinant()),s.computeBoundingSphere();const f=s.boundingSphere.radius,m=new c.yGw().makeScale(f,f,f);return p.multiply(m),p}const rA={...Rc,color:new Sn(1,1,1),envMapIntensity:1,envMapRotation:0,dispersion:.012,squashFactor:.98,geometryFactor:.5,gammaFactor:1,absorptionFactor:1,reflectivity:.5,refractiveIndex:2.4,boostFactors:new c.Pa4(.892,.892,.98595025),envMap:null,wireframe:!1,wireframeLinewidth:0,skinning:!1,transmission:0,morphTargets:!1,morphNormals:!1,rayBounces:1,diamondOrientedEnvMap:0};var ca=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Ir extends c.jyz{constructor(e){super({side:c.ehD,defines:{DIA_ORIENT_ENVMAP:0,RAY_BOUNCES:5,ENV_MAP_TYPE:0,PI:3.1428},vertexShader:`#ifndef USE_ENVMAP
#define USE_ENVMAP  
#endif
varying vec3 vWorldPosition;varying vec3 vWorldNormal;void main(){vWorldNormal=(modelMatrix*vec4(normal,0.)).xyz;
#include <begin_vertex>
#include <project_vertex>
#include <worldpos_vertex>
vWorldPosition=worldPosition.xyz;}`,fragmentShader:`varying vec3 vWorldNormal;varying vec3 vWorldPosition;uniform samplerCube tCubeMapNormals;
#if ENV_MAP_TYPE == 0
uniform samplerCube envMap;
#elif ENV_MAP_TYPE == 1
uniform sampler2D envMap;
#endif
uniform float envMapIntensity;uniform mat4 modelMatrix;uniform mat4 inverseModelMatrix;uniform mat4 offsetMatrixInv;uniform mat4 offsetMatrix;uniform float transmission;uniform vec2 transmissionSamplerSize;uniform sampler2D transmissionSamplerMap;uniform float refractiveIndex;uniform float radius;uniform float rIndexDelta;uniform float squashFactor;uniform float geometryFactor;uniform vec3 color;uniform vec3 colorCorrection;uniform vec3 boostFactors;uniform vec3 centerOffset;uniform float gammaFactor;uniform float absorptionFactor;uniform float envMapRotation;uniform float reflectivity;vec3 BRDF_Specular_GGX_Environment(const in vec3 viewDir,const in vec3 normal,const in vec3 specularColor,const in float roughness){float dotNV=abs(dot(normal,viewDir));const vec4 c0=vec4(-1,-0.0275,-0.572,0.022);const vec4 c1=vec4(1,0.0425,1.04,-0.04);vec4 r=roughness*c0+c1;float a004=min(r.x*r.x,exp2(-9.28*dotNV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec2 cartesianToPolar(vec3 n){vec2 uv;uv.x=atan(n.z,n.x)/(PI*2.)+0.5;uv.y=asin(n.y)/PI+0.5;return uv;}vec4 sampleEnvMap(vec3 direction){
#if !defined(USE_ENVMAP)
return vec4(direction,1);
#else
float cs=cos(envMapRotation);float sn=sin(envMapRotation);float temp=cs*direction.x+sn*direction.z;direction.z=-sn*direction.x+cs*direction.z;direction.x=temp;direction.x*=-1.;direction.z*=-1.;
#if ENV_MAP_TYPE == 0
return(textureCube(envMap,direction));
#elif ENV_MAP_TYPE == 1
return(texture2D(envMap,cartesianToPolar(direction)));
#endif
return vec4(1,0,1,1);
#endif
}vec4 SampleSpecularReflection(vec3 direction){return envMapIntensity*(sampleEnvMap(direction));}uniform mat4 projectionMatrix;vec4 SampleSpecularContribution(vec3 direction){direction=normalize(direction);direction.x*=-1.;direction.z*=-1.;return envMapIntensity*(sampleEnvMap(direction));}vec4 SampleSpecularContributionRef(vec3 origin,int i){vec4 ndcPos=projectionMatrix*viewMatrix*vec4(origin,1.);vec2 refractionCoords=ndcPos.xy/ndcPos.w;refractionCoords+=1.;refractionCoords/=2.;return transmissionSamplerMapTexelToLinear(texture2D(transmissionSamplerMap,refractionCoords));}vec3 intersectSphere(vec3 origin,vec3 direction){origin-=centerOffset;direction.y/=squashFactor;float A=dot(direction,direction);float B=2.*dot(origin,direction);float C=dot(origin,origin)-radius*radius;float disc=B*B-4.*A*C;if(disc>0.){disc=sqrt(disc);float t1=(-B+disc)*geometryFactor/A;float t2=(-B-disc)*geometryFactor/A;float t=(t1>t2)?t1:t2;direction.y*=squashFactor;return vec3(origin+centerOffset+direction*t);}return vec3(0.);}vec3 linePlaneIntersect(in vec3 pointOnLine,in vec3 lineDirection,in vec3 pointOnPlane,in vec3 planeNormal){return lineDirection*(dot(planeNormal,pointOnPlane-pointOnLine)/dot(planeNormal,lineDirection))+pointOnLine;}vec4 getNormalDistance(vec3 d){return textureCube(tCubeMapNormals,d);}vec3 getSurfaceNormal(vec4 surfaceInfos){vec3 surfaceNormal=surfaceInfos.rgb;surfaceNormal=surfaceNormal*2.-1.;return-normalize(surfaceNormal);}vec3 intersect(vec3 rayOrigin,vec3 rayDirection){vec3 sphereHitPoint=intersectSphere(rayOrigin,rayDirection);vec3 direction1=normalize(sphereHitPoint-centerOffset);vec4 normalDistanceData1=getNormalDistance(direction1);float distance1=normalDistanceData1.a*radius;vec3 pointOnPlane1=centerOffset+direction1*distance1;vec3 planeNormal1=getSurfaceNormal(normalDistanceData1);vec3 hitPoint1=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane1,planeNormal1);vec3 direction2=normalize(hitPoint1-centerOffset);vec4 normalDistanceData2=getNormalDistance(direction2);float distance2=normalDistanceData2.a*radius;vec3 pointOnPlane2=centerOffset+direction2*distance2;vec3 hitPoint=hitPoint1;vec3 planeNormal2=getSurfaceNormal(normalDistanceData2);hitPoint=linePlaneIntersect(rayOrigin,rayDirection,pointOnPlane2,planeNormal2);return hitPoint;}vec3 debugBounces(int count){vec3 color=vec3(1.,1.,1.);if(count==1)color=vec3(0.,1.,0.);else if(count==2)color=vec3(0.,0.,1.);else if(count==3)color=vec3(1.,1.,0.);else if(count==4)color=vec3(0.,1.,1.);else color=vec3(0.,1.,0.);if(count==0)color=vec3(1.,0.,0.);return color;}vec3 traceRay(vec3 origin,vec3 direction,vec3 normal){vec3 outColor=vec3(0.);const float n1=1.;const float epsilon=1e-4;float f0=(2.4-n1)/(2.4+n1);f0*=f0;vec3 attenuationFactor=vec3(1.);vec3 newDirection=refract(direction,normal,n1/refractiveIndex);vec3 reflectedDirection=reflect(direction,normal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(reflectedDirection,normal,vec3(f0),0.);vec3 brdfRefracted=BRDF_Specular_GGX_Environment(newDirection,-normal,vec3(f0),0.);attenuationFactor*=(vec3(1.)-brdfRefracted);outColor+=SampleSpecularReflection(reflectedDirection).rgb*brdfReflected*reflectivity*2.;int count=0;newDirection=(offsetMatrixInv*inverseModelMatrix*vec4(newDirection,0.)).xyz;newDirection=normalize(newDirection);origin=(offsetMatrixInv*inverseModelMatrix*vec4(origin,1.)).xyz;vec3 origin2=origin;origin2=(modelMatrix*offsetMatrix*vec4(origin2,1.)).xyz;for(int i=0;i<RAY_BOUNCES;i++){vec3 intersectedPos=intersect(origin,newDirection);vec3 dist=intersectedPos-origin;vec3 d=normalize(intersectedPos-centerOffset);vec3 mappedNormal=getNormalDistance(d).rgb;mappedNormal=2.*mappedNormal-1.;mappedNormal=-normalize(mappedNormal);float r=length(dist)/radius*absorptionFactor;attenuationFactor*=exp(-r*(1.-color));origin=intersectedPos;origin2=(modelMatrix*offsetMatrix*vec4(intersectedPos,1.)).xyz;vec3 oldDir=newDirection;newDirection=refract(newDirection,mappedNormal,refractiveIndex/n1);if(dot(newDirection,newDirection)<epsilon){newDirection=reflect(oldDir,mappedNormal);if(i==RAY_BOUNCES-1){vec3 brdfReflected=BRDF_Specular_GGX_Environment(-oldDir,mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(oldDir,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);outColor+=((transmission>0.&&cosT<transmission)?SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb:SampleSpecularContribution(DIA_ORIENT_ENVMAP<1?d1:newDirection).rgb)*attenuationFactor*colorCorrection*boostFactors*(vec3(1.)-brdfReflected);}}else{vec3 brdfRefracted=vec3(1.)-BRDF_Specular_GGX_Environment(newDirection,-mappedNormal,vec3(f0),0.);vec3 d1=(modelMatrix*offsetMatrix*vec4(newDirection,0.)).xyz;d1=normalize(d1);float cosT=1.-dot(direction,d1);if(transmission>0.&&cosT<transmission){outColor+=SampleSpecularContributionRef(origin2+0.5*d1*cosT,i).rgb*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}else{vec3 dir0=newDirection;vec3 dir1=refract(oldDir,mappedNormal,(refractiveIndex+rIndexDelta)/n1);vec3 dir2=refract(oldDir,mappedNormal,(refractiveIndex-rIndexDelta)/n1);
#if DIA_ORIENT_ENVMAP < 1
dir0=d1;dir1=(modelMatrix*offsetMatrix*vec4(dir1,0.)).xyz;dir2=(modelMatrix*offsetMatrix*vec4(dir2,0.)).xyz;
#endif
outColor+=vec3(SampleSpecularContribution(dir1).r,SampleSpecularContribution(dir0).g,SampleSpecularContribution(dir2).b)*brdfRefracted*attenuationFactor*colorCorrection*boostFactors;}newDirection=reflect(oldDir,mappedNormal);vec3 brdfReflected=BRDF_Specular_GGX_Environment(newDirection,mappedNormal,vec3(f0),0.);attenuationFactor*=brdfReflected*boostFactors;count++;}}return outColor;}void main(){vec3 normalizedNormal=normalize(vWorldNormal);vec3 viewVector=normalize(vWorldPosition-cameraPosition);vec3 color=traceRay(vWorldPosition,viewVector,normalizedNormal);gl_FragColor=vec4(color.rgb,1.);
#include <encodings_fragment>
}`,uniforms:{envMap:{value:e.envMap||null},envMapRotation:{value:0},transmission:{value:0},transmissionSamplerMap:{value:null},transmissionSamplerSize:{value:new c.FM8},normalOffset:{value:0},distanceOffset:{value:0},colorCorrection:{value:new c.Pa4(1,1,1)}}}),this.typeSlug=Ir.TypeSlug,this.assetType="material",this.__envMap=null,this.isDiamondMaterial=!0,this.color=new Sn(1,1,1),this.envMapIntensity=1,this.dispersion=.012,this.absorptionFactor=1,this.refractiveIndex=2.4,this.squashFactor=.98,this.geometryFactor=.5,this.gammaFactor=1,this.boostFactors=new c.Pa4(.892,.892,.98595025),this.transmission=0,this.reflectivity=.5,this.rayBounces=5,this.diamondOrientedEnvMap=0,this.normalsCaptureMap=null,this.extraUniformsToUpload={inverseModelMatrix:{value:new c.yGw().identity()},radius:{value:1},centerOffset:{value:new c.Pa4(0,0,0)},offsetMatrix:{value:new c.yGw().identity()},offsetMatrixInv:{value:new c.yGw().identity()}},this.setDirty=this.setDirty.bind(this),this.userData.setDirty=t=>{console.warn("userData.setDirty is deprecated. Use setDirty instead."),this.setDirty(t)},this.userData.separateEnvMapIntensity=!0,this.userData.enableLUT=!0,this.setValues(e)}get mmMaterial(){return this}get materialObject(){return this}onBeforeRender(e,t,n,r,o){var a,u;super.onBeforeRender(e,t,n,r,o),this.uniforms.envMapRotation.value=((a=this.envMap)===null||a===void 0?void 0:a.rotation)||0,this.extraUniformsToUpload.inverseModelMatrix.value.copy(o.matrixWorld).invert();const p=r.userData._normalsCaptureOffsets;p&&(this.extraUniformsToUpload.centerOffset.value.copy(p.centerOffset),this.extraUniformsToUpload.offsetMatrix.value.copy(p.offsetMatrix),this.extraUniformsToUpload.offsetMatrixInv.value.copy(p.offsetMatrixInv),this.extraUniformsToUpload.radius.value=p.radius);const f=(u=r.userData._normalsCaptureMap)===null||u===void 0?void 0:u.texture;this.normalsCaptureMap!==f&&(this.normalsCaptureMap=f)}setDirty(e){var t,n;this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"}),(n=(t=this._uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0,1)}set envMap(e){var t;this.__envMap=e,this.uniforms.envMap.value=this.__envMap,!((t=this.__envMap)===null||t===void 0)&&t.isCubeTexture?(this.defines.ENV_MAP_TYPE=0,this.needsUpdate=!0):(this.defines.ENV_MAP_TYPE=1,this.needsUpdate=!0)}get envMap(){return this.__envMap}clone(){return super.clone()}toJSON(e){const t={};return t.name=this.name,t.uuid=this.uuid,t.color=this.color.getHex(),t.envMapIntensity=this.envMapIntensity,t.dispersion=this.dispersion,t.squashFactor=this.squashFactor,t.geometryFactor=this.geometryFactor,t.gammaFactor=this.gammaFactor,t.absorptionFactor=this.absorptionFactor,t.reflectivity=this.reflectivity,t.refractiveIndex=this.refractiveIndex,t.rayBounces=this.rayBounces,t.diamondOrientedEnvMap=this.diamondOrientedEnvMap,t.boostFactors={x:this.boostFactors.x,y:this.boostFactors.y,z:this.boostFactors.z,isVector3:!0},t.transmission=this.transmission,t.isDiamondMaterialParameters=!0,t.type=Ir.TYPE,t.userData={},Sr(t.userData,this.userData),t.userData.uuid=this.userData.uuid,t}get uiConfig(){const e=this;return this._uiConfigChildren||(this._uiConfigChildren=[{type:"input",property:[this,"name"]},{type:"checkbox",property:[this,"wireframe"]},...Ql(this),{type:"input",label:"Mesh count",get value(){var t,n,r;return(r=(n=(t=e.userData)===null||t===void 0?void 0:t.__appliedMeshes)===null||n===void 0?void 0:n.size)!==null&&r!==void 0?r:0},set value(t){},disabled:!0},{type:"checkbox",label:"Enable LUT",getValue:()=>this.userData.enableLUT===!0,setValue:t=>{this.userData.enableLUT=t||void 0,this.setDirty()}},{type:"input",label:"uuid",get value(){return e.uuid},set value(t){},disabled:!0},{type:"checkbox",label:"Render to Depth",hidden:()=>this.transmission===0,get value(){return e.userData.renderToDepth===!0},set value(t){e.userData.renderToDepth=t||void 0}},{type:"button",label:"Download .dmat",value:()=>{Ss(new Blob([JSON.stringify(e.toJSON(),null,2)],{type:"application/json"}),"diamond-material.dmat")}}]),this._uiConfig||(this._uiConfig={type:"folder",label:"Diamond Material",expanded:!0,children:this._uiConfigChildren,limitedUi:!0}),this._uiConfig}copyProps(e){if(!e.isDiamondMaterialParameters&&!e.isDiamondMaterial&&!e.isDiamond&&e.type!==Ir.TYPE)return console.warn("Material type is not supported",e),this;const t={};je(e,t,Array.from(Object.keys(rA)));const n=t.userData;return delete t.userData,this.setValues(t),Sr(this.userData,n),this.setDirty(),this}fromJSON(e,t){return this.copyProps(e)}}Ir.TypeSlug="dmat",Ir.TYPE="DiamondMaterial",ca([dl("Color",{limitedUi:!0}),be()],Ir.prototype,"color",void 0),ca([wn("Env Intensity",[0,5],.01,{limitedUi:!0}),be()],Ir.prototype,"envMapIntensity",void 0),ca([wn("Dispersion",[0,.1],1e-4,{limitedUi:!0}),be({propKey:"rIndexDelta"})],Ir.prototype,"dispersion",void 0),ca([wn("Absorption",[0,15],.01,{limitedUi:!0}),be()],Ir.prototype,"absorptionFactor",void 0),ca([wn("Refractive Index",[0,4],.01,{limitedUi:!0}),be()],Ir.prototype,"refractiveIndex",void 0),ca([be()],Ir.prototype,"squashFactor",void 0),ca([be()],Ir.prototype,"geometryFactor",void 0),ca([be()],Ir.prototype,"gammaFactor",void 0),ca([Yr("RGB Boost",void 0,void 0,{limitedUi:!0}),be()],Ir.prototype,"boostFactors",void 0),ca([wn("Transmission",[0,1],.01,{limitedUi:!0}),be()],Ir.prototype,"transmission",void 0),ca([wn("Reflectivity",[0,2],.01,{limitedUi:!0}),be()],Ir.prototype,"reflectivity",void 0),ca([Xe("RAY_BOUNCES",void 0,!0),wn("Ray Bounces",[1,16],1)],Ir.prototype,"rayBounces",void 0),ca([Xe("DIA_ORIENT_ENVMAP",void 0,!0),wn("Diamond Oriented Lighting",[0,1],1)],Ir.prototype,"diamondOrientedEnvMap",void 0),ca([be({propKey:"tCubeMapNormals"})],Ir.prototype,"normalsCaptureMap",void 0);class sA extends w{constructor(e,t,n,r){super(),this._scene=e,this._camera=n??this._scene.activeCamera,this.domElement=t,this._time=this.time,this._mouseDownTime=0,this._mouseUpTime=1,this.selectionCondition=r??(o=>o.userData.userSelectable!==!1&&o.userData.bboxVisible!==!1&&o.material!=null&&o.material.type!=="ShadowMaterial"),this.raycaster=new c.iMs,this.mouse=new c.FM8,this._selected=[],this._hovering=[],this.cursorStyles={default:"grab",down:"grabbing"},this._activeCameraChange=this._activeCameraChange.bind(this),this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.domElement.style.touchAction="none",this.domElement.style.cursor=this.cursorStyles.default,this.domElement.addEventListener("pointermove",o=>this.onPointerMove(o)),this.domElement.addEventListener("pointerleave",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointerout",o=>this.onPointerLeave(o)),this.domElement.addEventListener("pointercancel",o=>this.onPointerCancel(o)),this.domElement.addEventListener("pointerenter",o=>this.onPointerEnter(o)),this.domElement.addEventListener("pointerdown",o=>this.onPointerDown(o)),this.domElement.addEventListener("pointerup",o=>this.onPointerUp(o))}get scene(){return this._scene}set scene(e){var t;(t=this._scene)===null||t===void 0||t.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene=e,this._scene.addEventListener("activeCameraChange",this._activeCameraChange)}_activeCameraChange(){this.camera=this._scene.activeCamera}get camera(){return this._camera}set camera(e){this._camera=e}get selectedObject(){return this._selected.length>0?this._selected[0]:null}set selectedObject(e){this._selected.length===1&&this._selected[0]===e||(this._selected=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"selectedObjectChanged",object:this.selectedObject}))}get hoverObject(){return this._hovering.length>0?this._hovering[0]:null}set hoverObject(e){this._hovering=e?Array.isArray(e)?[...e]:[e]:[],this.refreshOutlinePass(),this.dispatchEvent({type:"hoverObjectChanged",object:this.hoverObject})}get time(){return this._time=Mi(),this._time}get isMouseDown(){return this.mouseDownDeltaTime<0}get mouseDownDeltaTime(){return this._mouseUpTime-this._mouseDownTime}onPointerMove(e){e.isPrimary!==!1&&this.updateMouseFromEvent(e)}onPointerLeave(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this.hoverObject=null)}onPointerEnter(e){}onPointerCancel(e){}updateMouseFromEvent(e){const t=this.domElement.getBoundingClientRect();this.mouse.x=(e.clientX-t.x)/t.width*2-1,this.mouse.y=-(e.clientY-t.y)/t.height*2+1}onPointerDown(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.down,this._mouseDownTime=this.time)}onPointerUp(e){e.isPrimary!==!1&&(this.domElement.style.cursor=this.cursorStyles.default,this._mouseUpTime=this.time,this.mouseDownDeltaTime<200&&this.onPointerClick(e))}onPointerClick(e){if(e.isPrimary===!1)return;this.updateMouseFromEvent(e);const t=this.checkIntersection();t&&this.dispatchEvent({type:"hitObject",time:this._mouseUpTime,intersects:t}),this.selectedObject=(t==null?void 0:t.selectedObject)||null}addPasses(){}checkIntersection(){var e;const t=(e=this._camera)===null||e===void 0?void 0:e.cameraObject;if(!t)return null;this.raycaster.setFromCamera(this.mouse,t);const n=this.raycaster.intersectObject(this._scene.modelRoot.modelObject,!0),r=this.selectedObject;if(r){const o=n.length-1-[...n].reverse().findIndex(a=>{let u=a.object;for(;u;){if(a.object===r)return!0;u=u.parent}return!1});o>=0&&n.splice(0,o+1)}if(n.length>0){for(const o of n){let a=o.object;for(;!(a==null||a.visible&&this.selectionCondition(a));)a=a.parent;if(a)return{selectedObject:a,intersect:o,intersects:n,mouse:this.mouse.toArray()}}return null}return null}refreshOutlinePass(){var e;(e=this.hoverObject)!==null&&e!==void 0||this.selectedObject}isHovering(){return this.hoverObject!=null}isSelected(){return this.selectedObject!=null}}const Gh=new c.iMs,ua=new c.Pa4,Hu=new c.Pa4,Kr=new c._fP,oA={X:new c.Pa4(1,0,0),Y:new c.Pa4(0,1,0),Z:new c.Pa4(0,0,1)},$_={type:"change"},aA={type:"mouseDown"},lA={type:"mouseUp",mode:null},cA={type:"objectChange"};class _w extends c.Tme{constructor(e,t){super(),t===void 0&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new fA;this._gizmo=n,this.add(n);const r=new Aw;this._plane=r,this.add(r);const o=this;function a(k,L){let R=L;Object.defineProperty(o,k,{get:function(){return R!==void 0?R:L},set:function(W){R!==W&&(R=W,r[k]=W,n[k]=W,o.dispatchEvent({type:k+"-changed",value:W}),o.dispatchEvent($_))}}),o[k]=L,r[k]=L,n[k]=L}a("camera",e),a("object",void 0),a("enabled",!0),a("axis",null),a("mode","translate"),a("translationSnap",null),a("rotationSnap",null),a("scaleSnap",null),a("space","world"),a("size",1),a("dragging",!1),a("showX",!0),a("showY",!0),a("showZ",!0);const u=new c.Pa4,p=new c.Pa4,f=new c._fP,m=new c._fP,y=new c.Pa4,S=new c._fP,M=new c.Pa4,P=new c.Pa4,D=new c.Pa4,j=new c.Pa4;a("worldPosition",u),a("worldPositionStart",p),a("worldQuaternion",f),a("worldQuaternionStart",m),a("cameraPosition",y),a("cameraQuaternion",S),a("pointStart",M),a("pointEnd",P),a("rotationAxis",D),a("rotationAngle",0),a("eye",j),this._offset=new c.Pa4,this._startNorm=new c.Pa4,this._endNorm=new c.Pa4,this._cameraScale=new c.Pa4,this._parentPosition=new c.Pa4,this._parentQuaternion=new c._fP,this._parentQuaternionInv=new c._fP,this._parentScale=new c.Pa4,this._worldScaleStart=new c.Pa4,this._worldQuaternionInv=new c._fP,this._worldScale=new c.Pa4,this._positionStart=new c.Pa4,this._quaternionStart=new c._fP,this._scaleStart=new c.Pa4,this._getPointer=Z_.bind(this),this._onPointerDown=vw.bind(this),this._onPointerHover=uA.bind(this),this._onPointerMove=Hm.bind(this),this._onPointerUp=hA.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){this.object!==void 0&&(this.object.updateMatrixWorld(),this.object.parent===null?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.camera.isOrthographicCamera?this.camera.getWorldDirection(this.eye):this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(this.object===void 0||this.dragging===!0)return;Gh.setFromCamera(e,this.camera);const t=ev(this._gizmo.picker[this.mode],Gh);this.axis=t?t.object.name:null}pointerDown(e){if(this.object!==void 0&&this.dragging!==!0&&e.button===0&&this.axis!==null){Gh.setFromCamera(e,this.camera);const t=ev(this._plane,Gh,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,aA.mode=this.mode,this.dispatchEvent(aA)}}pointerMove(e){const t=this.axis,n=this.mode,r=this.object;let o=this.space;if(n==="scale"?o="local":t!=="E"&&t!=="XYZE"&&t!=="XYZ"||(o="world"),r===void 0||t===null||this.dragging===!1||e.button!==-1)return;Gh.setFromCamera(e,this.camera);const a=ev(this._plane,Gh,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),n==="translate")this._offset.copy(this.pointEnd).sub(this.pointStart),o==="local"&&t!=="XYZ"&&this._offset.applyQuaternion(this._worldQuaternionInv),t.indexOf("X")===-1&&(this._offset.x=0),t.indexOf("Y")===-1&&(this._offset.y=0),t.indexOf("Z")===-1&&(this._offset.z=0),o==="local"&&t!=="XYZ"?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),r.position.copy(this._offset).add(this._positionStart),this.translationSnap&&(o==="local"&&(r.position.applyQuaternion(Kr.copy(this._quaternionStart).invert()),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.position.applyQuaternion(this._quaternionStart)),o==="world"&&(r.parent&&r.position.add(ua.setFromMatrixPosition(r.parent.matrixWorld)),t.search("X")!==-1&&(r.position.x=Math.round(r.position.x/this.translationSnap)*this.translationSnap),t.search("Y")!==-1&&(r.position.y=Math.round(r.position.y/this.translationSnap)*this.translationSnap),t.search("Z")!==-1&&(r.position.z=Math.round(r.position.z/this.translationSnap)*this.translationSnap),r.parent&&r.position.sub(ua.setFromMatrixPosition(r.parent.matrixWorld))));else if(n==="scale"){if(t.search("XYZ")!==-1){let u=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(u*=-1),Hu.set(u,u,u)}else ua.copy(this.pointStart),Hu.copy(this.pointEnd),ua.applyQuaternion(this._worldQuaternionInv),Hu.applyQuaternion(this._worldQuaternionInv),Hu.divide(ua),t.search("X")===-1&&(Hu.x=1),t.search("Y")===-1&&(Hu.y=1),t.search("Z")===-1&&(Hu.z=1);r.scale.copy(this._scaleStart).multiply(Hu),this.scaleSnap&&(t.search("X")!==-1&&(r.scale.x=Math.round(r.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Y")!==-1&&(r.scale.y=Math.round(r.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),t.search("Z")!==-1&&(r.scale.z=Math.round(r.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if(n==="rotate"){this._offset.copy(this.pointEnd).sub(this.pointStart);const u=20/this.worldPosition.distanceTo(ua.setFromMatrixPosition(this.camera.matrixWorld));t==="E"?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):t==="XYZE"?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(ua.copy(this.rotationAxis).cross(this.eye))*u):t!=="X"&&t!=="Y"&&t!=="Z"||(this.rotationAxis.copy(oA[t]),ua.copy(oA[t]),o==="local"&&ua.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(ua.cross(this.eye).normalize())*u),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),o==="local"&&t!=="E"&&t!=="XYZE"?(r.quaternion.copy(this._quaternionStart),r.quaternion.multiply(Kr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),r.quaternion.copy(Kr.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),r.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent($_),this.dispatchEvent(cA)}}pointerUp(e){e.button===0&&(this.dragging&&this.axis!==null&&(lA.mode=this.mode,this.dispatchEvent(lA)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse(function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent($_),this.dispatchEvent(cA),this.pointStart.copy(this.pointEnd))}getRaycaster(){return Gh}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}}function Z_(s){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:s.button};{const e=this.domElement.getBoundingClientRect();return{x:(s.clientX-e.left)/e.width*2-1,y:-(s.clientY-e.top)/e.height*2+1,button:s.button}}}function uA(s){if(this.enabled)switch(s.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(s))}}function vw(s){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(s.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(s)),this.pointerDown(this._getPointer(s)))}function Hm(s){this.enabled&&this.pointerMove(this._getPointer(s))}function hA(s){this.enabled&&(this.domElement.releasePointerCapture(s.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(s)))}function ev(s,e,t){const n=e.intersectObject(s,!0);for(let r=0;r<n.length;r++)if(n[r].object.visible||t)return n[r];return!1}const Jp=new c.USm,Pr=new c.Pa4(0,1,0),dA=new c.Pa4(0,0,0),pA=new c.yGw,Wm=new c._fP,Wu=new c._fP,Tl=new c.Pa4,tv=new c.yGw,$p=new c.Pa4(1,0,0),Yc=new c.Pa4(0,1,0),Zp=new c.Pa4(0,0,1),qm=new c.Pa4,Wd=new c.Pa4,ef=new c.Pa4;class fA extends c.Tme{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new c.vBJ({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new c.nls({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const r=t.clone();r.opacity=.5;const o=e.clone();o.color.setHex(16711680);const a=e.clone();a.color.setHex(65280);const u=e.clone();u.color.setHex(255);const p=e.clone();p.color.setHex(16711680),p.opacity=.5;const f=e.clone();f.color.setHex(65280),f.opacity=.5;const m=e.clone();m.color.setHex(255),m.opacity=.5;const y=e.clone();y.opacity=.25;const S=e.clone();S.color.setHex(16776960),S.opacity=.25,e.clone().color.setHex(16776960);const M=e.clone();M.color.setHex(7895160);const P=new c.fHI(0,.04,.1,12);P.translate(0,.05,0);const D=new c.DvJ(.08,.08,.08);D.translate(0,.04,0);const j=new c.u9r;j.setAttribute("position",new c.a$l([0,0,0,1,0,0],3));const k=new c.fHI(.0075,.0075,.5,3);function L(Qe,Oe){const ze=new c.XvJ(Qe,.0075,3,64,Oe*Math.PI*2);return ze.rotateY(Math.PI/2),ze.rotateX(Math.PI/2),ze}k.translate(0,.25,0);const R={X:[[new c.Kj0(P,o),[.5,0,0],[0,0,-Math.PI/2]],[new c.Kj0(P,o),[-.5,0,0],[0,0,Math.PI/2]],[new c.Kj0(k,o),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new c.Kj0(P,a),[0,.5,0]],[new c.Kj0(P,a),[0,-.5,0],[Math.PI,0,0]],[new c.Kj0(k,a)]],Z:[[new c.Kj0(P,u),[0,0,.5],[Math.PI/2,0,0]],[new c.Kj0(P,u),[0,0,-.5],[-Math.PI/2,0,0]],[new c.Kj0(k,u),null,[Math.PI/2,0,0]]],XYZ:[[new c.Kj0(new c.pQR(.1,0),y.clone()),[0,0,0]]],XY:[[new c.Kj0(new c.DvJ(.15,.15,.01),m.clone()),[.15,.15,0]]],YZ:[[new c.Kj0(new c.DvJ(.15,.15,.01),p.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new c.Kj0(new c.DvJ(.15,.15,.01),f.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},W={X:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,.3,0]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new c.Kj0(new c.pQR(.2,0),n)]],XY:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},q={START:[[new c.Kj0(new c.pQR(.01,2),r),null,null,null,"helper"]],END:[[new c.Kj0(new c.pQR(.01,2),r),null,null,null,"helper"]],DELTA:[[new c.x12(function(){const Qe=new c.u9r;return Qe.setAttribute("position",new c.a$l([0,0,0,1,1,1],3)),Qe}(),r),null,null,null,"helper"]],X:[[new c.x12(j,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new c.x12(j,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new c.x12(j,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},J={XYZE:[[new c.Kj0(L(.5,1),M),null,[0,Math.PI/2,0]]],X:[[new c.Kj0(L(.5,.5),o)]],Y:[[new c.Kj0(L(.5,.5),a),null,[0,0,-Math.PI/2]]],Z:[[new c.Kj0(L(.5,.5),u),null,[0,Math.PI/2,0]]],E:[[new c.Kj0(L(.75,1),S),null,[0,Math.PI/2,0]]]},ee={AXIS:[[new c.x12(j,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},he={XYZE:[[new c.Kj0(new c.xo$(.25,10,8),n)]],X:[[new c.Kj0(new c.XvJ(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new c.Kj0(new c.XvJ(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new c.Kj0(new c.XvJ(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new c.Kj0(new c.XvJ(.75,.1,2,24),n)]]},xe={X:[[new c.Kj0(D,o),[.5,0,0],[0,0,-Math.PI/2]],[new c.Kj0(k,o),[0,0,0],[0,0,-Math.PI/2]],[new c.Kj0(D,o),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new c.Kj0(D,a),[0,.5,0]],[new c.Kj0(k,a)],[new c.Kj0(D,a),[0,-.5,0],[0,0,Math.PI]]],Z:[[new c.Kj0(D,u),[0,0,.5],[Math.PI/2,0,0]],[new c.Kj0(k,u),[0,0,0],[Math.PI/2,0,0]],[new c.Kj0(D,u),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new c.Kj0(new c.DvJ(.15,.15,.01),m),[.15,.15,0]]],YZ:[[new c.Kj0(new c.DvJ(.15,.15,.01),p),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new c.Kj0(new c.DvJ(.15,.15,.01),f),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new c.Kj0(new c.DvJ(.1,.1,.1),y.clone())]]},De={X:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,.3,0]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new c.Kj0(new c.fHI(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new c.Kj0(new c.DvJ(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new c.Kj0(new c.DvJ(.2,.2,.2),n),[0,0,0]]]},Fe={X:[[new c.x12(j,r.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new c.x12(j,r.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new c.x12(j,r.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function ke(Qe){const Oe=new c.Tme;for(const ze in Qe)for(let $e=Qe[ze].length;$e--;){const Ge=Qe[ze][$e][0].clone(),ot=Qe[ze][$e][1],yt=Qe[ze][$e][2],Mt=Qe[ze][$e][3],pt=Qe[ze][$e][4];Ge.name=ze,Ge.tag=pt,ot&&Ge.position.set(ot[0],ot[1],ot[2]),yt&&Ge.rotation.set(yt[0],yt[1],yt[2]),Mt&&Ge.scale.set(Mt[0],Mt[1],Mt[2]),Ge.updateMatrix();const Qt=Ge.geometry.clone();Qt.applyMatrix4(Ge.matrix),Ge.geometry=Qt,Ge.renderOrder=1/0,Ge.position.set(0,0,0),Ge.rotation.set(0,0,0),Ge.scale.set(1,1,1),Oe.add(Ge)}return Oe}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=ke(R)),this.add(this.gizmo.rotate=ke(J)),this.add(this.gizmo.scale=ke(xe)),this.add(this.picker.translate=ke(W)),this.add(this.picker.rotate=ke(he)),this.add(this.picker.scale=ke(De)),this.add(this.helper.translate=ke(q)),this.add(this.helper.rotate=ke(ee)),this.add(this.helper.scale=ke(Fe)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t=(this.mode==="scale"?"local":this.space)==="local"?this.worldQuaternion:Wu;this.gizmo.translate.visible=this.mode==="translate",this.gizmo.rotate.visible=this.mode==="rotate",this.gizmo.scale.visible=this.mode==="scale",this.helper.translate.visible=this.mode==="translate",this.helper.rotate.visible=this.mode==="rotate",this.helper.scale.visible=this.mode==="scale";let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let r=0;r<n.length;r++){const o=n[r];let a;o.visible=!0,o.rotation.set(0,0,0),o.position.copy(this.worldPosition),a=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),o.scale.set(1,1,1).multiplyScalar(a*this.size/4),o.tag!=="helper"?(o.quaternion.copy(t),this.mode==="translate"||this.mode==="scale"?(o.name==="X"&&Math.abs(Pr.copy($p).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Y"&&Math.abs(Pr.copy(Yc).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="Z"&&Math.abs(Pr.copy(Zp).applyQuaternion(t).dot(this.eye))>.99&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XY"&&Math.abs(Pr.copy(Zp).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="YZ"&&Math.abs(Pr.copy($p).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1),o.name==="XZ"&&Math.abs(Pr.copy(Yc).applyQuaternion(t).dot(this.eye))<.2&&(o.scale.set(1e-10,1e-10,1e-10),o.visible=!1)):this.mode==="rotate"&&(Wm.copy(t),Pr.copy(this.eye).applyQuaternion(Kr.copy(t).invert()),o.name.search("E")!==-1&&o.quaternion.setFromRotationMatrix(pA.lookAt(this.eye,dA,Yc)),o.name==="X"&&(Kr.setFromAxisAngle($p,Math.atan2(-Pr.y,Pr.z)),Kr.multiplyQuaternions(Wm,Kr),o.quaternion.copy(Kr)),o.name==="Y"&&(Kr.setFromAxisAngle(Yc,Math.atan2(Pr.x,Pr.z)),Kr.multiplyQuaternions(Wm,Kr),o.quaternion.copy(Kr)),o.name==="Z"&&(Kr.setFromAxisAngle(Zp,Math.atan2(Pr.y,Pr.x)),Kr.multiplyQuaternions(Wm,Kr),o.quaternion.copy(Kr))),o.visible=o.visible&&(o.name.indexOf("X")===-1||this.showX),o.visible=o.visible&&(o.name.indexOf("Y")===-1||this.showY),o.visible=o.visible&&(o.name.indexOf("Z")===-1||this.showZ),o.visible=o.visible&&(o.name.indexOf("E")===-1||this.showX&&this.showY&&this.showZ),o.material._color=o.material._color||o.material.color.clone(),o.material._opacity=o.material._opacity||o.material.opacity,o.material.color.copy(o.material._color),o.material.opacity=o.material._opacity,this.enabled&&this.axis&&(o.name===this.axis||this.axis.split("").some(function(u){return o.name===u}))&&(o.material.color.setHex(16776960),o.material.opacity=1)):(o.visible=!1,o.name==="AXIS"?(o.position.copy(this.worldPositionStart),o.visible=!!this.axis,this.axis==="X"&&(Kr.setFromEuler(Jp.set(0,0,0)),o.quaternion.copy(t).multiply(Kr),Math.abs(Pr.copy($p).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Y"&&(Kr.setFromEuler(Jp.set(0,0,Math.PI/2)),o.quaternion.copy(t).multiply(Kr),Math.abs(Pr.copy(Yc).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="Z"&&(Kr.setFromEuler(Jp.set(0,Math.PI/2,0)),o.quaternion.copy(t).multiply(Kr),Math.abs(Pr.copy(Zp).applyQuaternion(t).dot(this.eye))>.9&&(o.visible=!1)),this.axis==="XYZE"&&(Kr.setFromEuler(Jp.set(0,Math.PI/2,0)),Pr.copy(this.rotationAxis),o.quaternion.setFromRotationMatrix(pA.lookAt(dA,Pr,Yc)),o.quaternion.multiply(Kr),o.visible=this.dragging),this.axis==="E"&&(o.visible=!1)):o.name==="START"?(o.position.copy(this.worldPositionStart),o.visible=this.dragging):o.name==="END"?(o.position.copy(this.worldPosition),o.visible=this.dragging):o.name==="DELTA"?(o.position.copy(this.worldPositionStart),o.quaternion.copy(this.worldQuaternionStart),ua.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),ua.applyQuaternion(this.worldQuaternionStart.clone().invert()),o.scale.copy(ua),o.visible=this.dragging):(o.quaternion.copy(t),this.dragging?o.position.copy(this.worldPositionStart):o.position.copy(this.worldPosition),this.axis&&(o.visible=this.axis.search(o.name)!==-1)))}super.updateMatrixWorld(e)}}class Aw extends c.Kj0{constructor(){super(new c._12(1e5,1e5,2,2),new c.vBJ({visible:!1,wireframe:!0,side:c.ehD,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),this.mode==="scale"&&(t="local"),qm.copy($p).applyQuaternion(t==="local"?this.worldQuaternion:Wu),Wd.copy(Yc).applyQuaternion(t==="local"?this.worldQuaternion:Wu),ef.copy(Zp).applyQuaternion(t==="local"?this.worldQuaternion:Wu),Pr.copy(Wd),this.mode){case"translate":case"scale":switch(this.axis){case"X":Pr.copy(this.eye).cross(qm),Tl.copy(qm).cross(Pr);break;case"Y":Pr.copy(this.eye).cross(Wd),Tl.copy(Wd).cross(Pr);break;case"Z":Pr.copy(this.eye).cross(ef),Tl.copy(ef).cross(Pr);break;case"XY":Tl.copy(ef);break;case"YZ":Tl.copy(qm);break;case"XZ":Pr.copy(ef),Tl.copy(Wd);break;case"XYZ":case"E":Tl.set(0,0,0)}break;default:Tl.set(0,0,0)}Tl.length()===0?this.quaternion.copy(this.cameraQuaternion):(tv.lookAt(ua.set(0,0,0),Tl,Pr),this.quaternion.setFromRotationMatrix(tv)),super.updateMatrixWorld(e)}}const mA=new c.ZzF,Ym=new c.Pa4;class gA extends c.L5s{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new c.a$l([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new c.a$l([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new c.$TI(t,6,1);return this.setAttribute("instanceStart",new c.kB5(n,3,0)),this.setAttribute("instanceEnd",new c.kB5(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new c.$TI(t,6,1);return this.setAttribute("instanceColorStart",new c.kB5(n,3,0)),this.setAttribute("instanceColorEnd",new c.kB5(n,3,3)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new c.Uk6(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new c.ZzF);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),mA.setFromBufferAttribute(t),this.boundingBox.union(mA))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new c.aLr),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let r=0;for(let o=0,a=e.count;o<a;o++)Ym.fromBufferAttribute(e,o),r=Math.max(r,n.distanceToSquared(Ym)),Ym.fromBufferAttribute(t,o),r=Math.max(r,n.distanceToSquared(Ym));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class yw extends gA{constructor(e){super(),this.isWireframeGeometry2=!0,this.type="WireframeGeometry2",this.fromWireframeGeometry(new c.Uk6(e))}}c.rBU.line={worldUnits:{value:1},linewidth:{value:1},resolution:{value:new c.FM8(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}},c.Vj0.line={uniforms:c.rDY.merge([c.rBU.common,c.rBU.fog,c.rBU.line]),vertexShader:`
		#include <common>
		#include <color_pars_vertex>
		#include <fog_pars_vertex>
		#include <logdepthbuf_pars_vertex>
		#include <clipping_planes_pars_vertex>

		uniform float linewidth;
		uniform vec2 resolution;

		attribute vec3 instanceStart;
		attribute vec3 instanceEnd;

		attribute vec3 instanceColorStart;
		attribute vec3 instanceColorEnd;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#ifdef USE_DASH

			uniform float dashScale;
			attribute float instanceDistanceStart;
			attribute float instanceDistanceEnd;
			varying float vLineDistance;

		#endif

		void trimSegment( const in vec4 start, inout vec4 end ) {

			// trim end segment so it terminates between the camera plane and the near plane

			// conservative estimate of the near plane
			float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
			float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
			float nearEstimate = - 0.5 * b / a;

			float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

			end.xyz = mix( start.xyz, end.xyz, alpha );

		}

		void main() {

			#ifdef USE_COLOR

				vColor.xyz = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

			#endif

			#ifdef USE_DASH

				vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
				vUv = uv;

			#endif

			float aspect = resolution.x / resolution.y;

			// camera space
			vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
			vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

			#ifdef WORLD_UNITS

				worldStart = start.xyz;
				worldEnd = end.xyz;

			#else

				vUv = uv;

			#endif

			// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
			// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
			// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
			// perhaps there is a more elegant solution -- WestLangley

			bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

			if ( perspective ) {

				if ( start.z < 0.0 && end.z >= 0.0 ) {

					trimSegment( start, end );

				} else if ( end.z < 0.0 && start.z >= 0.0 ) {

					trimSegment( end, start );

				}

			}

			// clip space
			vec4 clipStart = projectionMatrix * start;
			vec4 clipEnd = projectionMatrix * end;

			// ndc space
			vec3 ndcStart = clipStart.xyz / clipStart.w;
			vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

			// direction
			vec2 dir = ndcEnd.xy - ndcStart.xy;

			// account for clip-space aspect ratio
			dir.x *= aspect;
			dir = normalize( dir );

			#ifdef WORLD_UNITS

				// get the offset direction as perpendicular to the view vector
				vec3 worldDir = normalize( end.xyz - start.xyz );
				vec3 offset;
				if ( position.y < 0.5 ) {

					offset = normalize( cross( start.xyz, worldDir ) );

				} else {

					offset = normalize( cross( end.xyz, worldDir ) );

				}

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

				// don't extend the line if we're rendering dashes because we
				// won't be rendering the endcaps
				#ifndef USE_DASH

					// extend the line bounds to encompass  endcaps
					start.xyz += - worldDir * linewidth * 0.5;
					end.xyz += worldDir * linewidth * 0.5;

					// shift the position of the quad so it hugs the forward edge of the line
					offset.xy -= dir * forwardOffset;
					offset.z += 0.5;

				#endif

				// endcaps
				if ( position.y > 1.0 || position.y < 0.0 ) {

					offset.xy += dir * 2.0 * forwardOffset;

				}

				// adjust for linewidth
				offset *= linewidth * 0.5;

				// set the world position
				worldPos = ( position.y < 0.5 ) ? start : end;
				worldPos.xyz += offset;

				// project the worldpos
				vec4 clip = projectionMatrix * worldPos;

				// shift the depth of the projected points so the line
				// segments overlap neatly
				vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
				clip.z = clipPose.z * clip.w;

			#else

				vec2 offset = vec2( dir.y, - dir.x );
				// undo aspect ratio adjustment
				dir.x /= aspect;
				offset.x /= aspect;

				// sign flip
				if ( position.x < 0.0 ) offset *= - 1.0;

				// endcaps
				if ( position.y < 0.0 ) {

					offset += - dir;

				} else if ( position.y > 1.0 ) {

					offset += dir;

				}

				// adjust for linewidth
				offset *= linewidth;

				// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
				offset /= resolution.y;

				// select end
				vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

				// back to clip space
				offset *= clip.w;

				clip.xy += offset;

			#endif

			gl_Position = clip;

			vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

			#include <logdepthbuf_vertex>
			#include <clipping_planes_vertex>
			#include <fog_vertex>

		}
		`,fragmentShader:`
		uniform vec3 diffuse;
		uniform float opacity;
		uniform float linewidth;

		#ifdef USE_DASH

			uniform float dashOffset;
			uniform float dashSize;
			uniform float gapSize;

		#endif

		varying float vLineDistance;

		#ifdef WORLD_UNITS

			varying vec4 worldPos;
			varying vec3 worldStart;
			varying vec3 worldEnd;

			#ifdef USE_DASH

				varying vec2 vUv;

			#endif

		#else

			varying vec2 vUv;

		#endif

		#include <common>
		#include <color_pars_fragment>
		#include <fog_pars_fragment>
		#include <logdepthbuf_pars_fragment>
		#include <clipping_planes_pars_fragment>

		vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

			float mua;
			float mub;

			vec3 p13 = p1 - p3;
			vec3 p43 = p4 - p3;

			vec3 p21 = p2 - p1;

			float d1343 = dot( p13, p43 );
			float d4321 = dot( p43, p21 );
			float d1321 = dot( p13, p21 );
			float d4343 = dot( p43, p43 );
			float d2121 = dot( p21, p21 );

			float denom = d2121 * d4343 - d4321 * d4321;

			float numer = d1343 * d4321 - d1321 * d4343;

			mua = numer / denom;
			mua = clamp( mua, 0.0, 1.0 );
			mub = ( d1343 + d4321 * ( mua ) ) / d4343;
			mub = clamp( mub, 0.0, 1.0 );

			return vec2( mua, mub );

		}

		void main() {

			#include <clipping_planes_fragment>

			#ifdef USE_DASH

				if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

				if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

			#endif

			float alpha = opacity;

			#ifdef WORLD_UNITS

				// Find the closest points on the view ray and the line segment
				vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
				vec3 lineDir = worldEnd - worldStart;
				vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

				vec3 p1 = worldStart + lineDir * params.x;
				vec3 p2 = rayEnd * params.y;
				vec3 delta = p1 - p2;
				float len = length( delta );
				float norm = len / linewidth;

				#ifndef USE_DASH

					#ifdef USE_ALPHA_TO_COVERAGE

						float dnorm = fwidth( norm );
						alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

					#else

						if ( norm > 0.5 ) {

							discard;

						}

					#endif

				#endif

			#else

				#ifdef USE_ALPHA_TO_COVERAGE

					// artifacts appear on some hardware if a derivative is taken within a conditional
					float a = vUv.x;
					float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
					float len2 = a * a + b * b;
					float dlen = fwidth( len2 );

					if ( abs( vUv.y ) > 1.0 ) {

						alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

					}

				#else

					if ( abs( vUv.y ) > 1.0 ) {

						float a = vUv.x;
						float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
						float len2 = a * a + b * b;

						if ( len2 > 1.0 ) discard;

					}

				#endif

			#endif

			vec4 diffuseColor = vec4( diffuse, alpha );

			#include <logdepthbuf_fragment>
			#include <color_fragment>

			gl_FragColor = vec4( diffuseColor.rgb, alpha );

			#include <tonemapping_fragment>
			#include <encodings_fragment>
			#include <fog_fragment>
			#include <premultiplied_alpha_fragment>

		}
		`};class _A extends c.jyz{constructor(e){super({type:"LineMaterial",uniforms:c.rDY.clone(c.Vj0.line.uniforms),vertexShader:c.Vj0.line.vertexShader,fragmentShader:c.Vj0.line.fragmentShader,clipping:!0}),this.isLineMaterial=!0,Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return Boolean("USE_DASH"in this.defines)},set(t){Boolean(t)!==Boolean("USE_DASH"in this.defines)&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)},set:function(t){Boolean(t)!==Boolean("USE_ALPHA_TO_COVERAGE"in this.defines)&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const vA=new c.Pa4,nv=new c.Pa4;class AA extends c.Kj0{constructor(e=new gA,t=new _A({color:16777215*Math.random()})){super(e,t),this.isWireframe=!0,this.type="Wireframe"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,r=new Float32Array(2*t.count);for(let a=0,u=0,p=t.count;a<p;a++,u+=2)vA.fromBufferAttribute(t,a),nv.fromBufferAttribute(n,a),r[u]=u===0?0:r[u-1],r[u+1]=r[u]+vA.distanceTo(nv);const o=new c.$TI(r,2,1);return e.setAttribute("instanceDistanceStart",new c.kB5(o,1,0)),e.setAttribute("instanceDistanceEnd",new c.kB5(o,1,1)),this}}class iv extends c.ZAu{constructor(){super(),this.assetType="widget",this.modelObject=this,this._object=null,this.boundingScaleMultiplier=1,this.position.set(0,0,0),this.visible=!1,this.renderOrder=1,this.userData.bboxVisible=!1,this._updater=this._updater.bind(this)}_updater(){const e=this._object;if(e){const t=new _t().expandByObject(e,!1);t.getCenter(this.position);const n=t.getBoundingSphere(new c.aLr).radius;this.scale.setScalar(n*this.boundingScaleMultiplier),this.setVisible(!0)}else this.setVisible(!1)}_initGeometry(e){if(this._geometry)return;const t=new yw(e);this._geometry=t;const n=new _A({color:"#ff2222",transparent:!0,opacity:.9,linewidth:5,resolution:new c.FM8(1024,1024),dashed:!1,toneMapped:!1}),r=new AA(t,n);r.computeLineDistances(),r.scale.set(1,1,1),r.visible=!0,this.add(r)}setVisible(e){var t;e!==this.visible&&(this.visible=e,(t=this.setDirty)===null||t===void 0||t.call(this,{sceneUpdate:!1}))}attach(e){return this.detach(),e?(this._object=e,this._object.addEventListener("objectUpdate",this._updater),this._updater(),this):this}detach(){var e;return this._object?((e=this._object)===null||e===void 0||e.removeEventListener("objectUpdate",this._updater),this._object=null,this._updater(),this):this}get object(){return this._object}}class rv extends iv{constructor(){super(),this.boundingScaleMultiplier=1/1.7,this._initGeometry(new c.DvJ(2,2,2,1,1,1))}_updater(){super._updater();const e=this.object;e&&(new _t().expandByObject(e,!1).getSize(this.scale).multiplyScalar(this.boundingScaleMultiplier).clampScalar(.1,100),this.setVisible(!0))}}var tf=function(s){return function(e){return 1-s(1-e)}},Xm=function(s){return function(e){return e<=.5?s(2*e)/2:(2-s(2*(1-e)))/2}},yA=function(s){return function(e){return Math.pow(e,s)}},Km=function(s){return function(e){return e*e*((s+1)*e-s)}},bA=function(s){var e=Km(s);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},nf=function(s){return s},qd=yA(2),wA=tf(qd),sv=Xm(qd),ov=function(s){return 1-Math.sin(Math.acos(s))},Jm=tf(ov),av=Xm(Jm),Xc=Km(1.525),xA=tf(Xc),$m=Xm(Xc),lv=bA(1.525),rf=function(s){if(s===1||s===0)return s;var e=s*s;return s<.36363636363636365?7.5625*e:s<.7272727272727273?9.075*e-9.9*s+3.4:s<.9?12.066481994459833*e-19.63545706371191*s+8.898060941828255:10.8*s*s-20.52*s+10.72},EA=tf(rf),SA=function(s){return s<.5?.5*(1-rf(1-2*s)):.5*rf(2*s-1)+.5},ns=function(){return ns=Object.assign||function(s){for(var e,t=1,n=arguments.length;t<n;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(s[r]=e[r]);return s},ns.apply(this,arguments)};function cv(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(n=Object.getOwnPropertySymbols(s);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(s,n[r])&&(t[n[r]]=s[n[r]])}return t}var qu=function(s,e,t){return Math.min(Math.max(t,s),e)};function Yd(s,e){return s*Math.sqrt(1-e*e)}var CA=["duration","bounce"],Zm=["stiffness","damping","mass"];function So(s,e){return e.some(function(t){return s[t]!==void 0})}function oc(s){var e=s.from,t=e===void 0?0:e,n=s.to,r=n===void 0?1:n,o=s.restSpeed,a=o===void 0?2:o,u=s.restDelta,p=cv(s,["from","to","restSpeed","restDelta"]),f={done:!1,value:t},m=function(W){var q=ns({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},W);if(!So(W,Zm)&&So(W,CA)){var J=function(ee){var he,xe,De=ee.duration,Fe=De===void 0?800:De,ke=ee.bounce,Qe=ke===void 0?.25:ke,Oe=ee.velocity,ze=Oe===void 0?0:Oe,$e=ee.mass,Ge=$e===void 0?1:$e,ot=1-Qe;ot=qu(.05,1,ot),Fe=qu(.01,10,Fe/1e3),ot<1?(he=function(pt){var Qt=pt*ot,Kt=Qt*Fe;return .001-(Qt-ze)/Yd(pt,ot)*Math.exp(-Kt)},xe=function(pt){var Qt=pt*ot*Fe,Kt=Qt*ze+ze,Jt=Math.pow(ot,2)*Math.pow(pt,2)*Fe,tn=Math.exp(-Qt),Mn=Yd(Math.pow(pt,2),ot);return(.001-he(pt)>0?-1:1)*((Kt-Jt)*tn)/Mn}):(he=function(pt){return Math.exp(-pt*Fe)*((pt-ze)*Fe+1)-.001},xe=function(pt){return Math.exp(-pt*Fe)*(Fe*Fe*(ze-pt))});var yt=function(pt,Qt,Kt){for(var Jt=Kt,tn=1;tn<12;tn++)Jt-=pt(Jt)/Qt(Jt);return Jt}(he,xe,5/Fe);if(Fe*=1e3,isNaN(yt))return{stiffness:100,damping:10,duration:Fe};var Mt=Math.pow(yt,2)*Ge;return{stiffness:Mt,damping:2*ot*Math.sqrt(Ge*Mt),duration:Fe}}(W);(q=ns(ns(ns({},q),J),{velocity:0,mass:1})).isResolvedFromDuration=!0}return q}(p),y=m.stiffness,S=m.damping,M=m.mass,P=m.velocity,D=m.duration,j=m.isResolvedFromDuration,k=eg,L=eg;function R(){var W=P?-P/1e3:0,q=r-t,J=S/(2*Math.sqrt(y*M)),ee=Math.sqrt(y/M)/1e3;if(u!=null||(u=Math.abs(r-t)<=1?.01:.4),J<1){var he=Yd(ee,J);k=function(De){var Fe=Math.exp(-J*ee*De);return r-Fe*((W+J*ee*q)/he*Math.sin(he*De)+q*Math.cos(he*De))},L=function(De){var Fe=Math.exp(-J*ee*De);return J*ee*Fe*(Math.sin(he*De)*(W+J*ee*q)/he+q*Math.cos(he*De))-Fe*(Math.cos(he*De)*(W+J*ee*q)-he*q*Math.sin(he*De))}}else if(J===1)k=function(De){return r-Math.exp(-ee*De)*(q+(W+ee*q)*De)};else{var xe=ee*Math.sqrt(J*J-1);k=function(De){var Fe=Math.exp(-J*ee*De),ke=Math.min(xe*De,300);return r-Fe*((W+J*ee*q)*Math.sinh(ke)+xe*q*Math.cosh(ke))/xe}}}return R(),{next:function(W){var q=k(W);if(j)f.done=W>=D;else{var J=1e3*L(W),ee=Math.abs(J)<=a,he=Math.abs(r-q)<=u;f.done=ee&&he}return f.value=f.done?r:q,f},flipTarget:function(){var W;P=-P,t=(W=[r,t])[0],r=W[1],R()}}}oc.needsInterpolation=function(s,e){return typeof s=="string"||typeof e=="string"};var eg=function(s){return 0},Yu=function(s,e,t){var n=e-s;return n===0?1:(t-s)/n},Kc=function(s,e,t){return-t*s+t*e+s},Qh=function(s,e){return function(t){return Math.max(Math.min(t,e),s)}},ac=function(s){return s%1?Number(s.toFixed(5)):s},Jc=/(-)?([\d]*\.?[\d])+/g,Hh=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,MA=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i;function Xu(s){return typeof s=="string"}var Ku={test:function(s){return typeof s=="number"},parse:parseFloat,transform:function(s){return s}},sf=ns(ns({},Ku),{transform:Qh(0,1)}),tg=(ns(ns({},Ku),{default:1}),function(s,e){return function(t){return Boolean(Xu(t)&&MA.test(t)&&t.startsWith(s)||e&&Object.prototype.hasOwnProperty.call(t,e))}}),ng=function(s,e,t){return function(n){var r;if(!Xu(n))return n;var o=n.match(Jc),a=o[0],u=o[1],p=o[2],f=o[3];return(r={})[s]=parseFloat(a),r[e]=parseFloat(u),r[t]=parseFloat(p),r.alpha=f!==void 0?parseFloat(f):1,r}},TA=Qh(0,255),ig=ns(ns({},Ku),{transform:function(s){return Math.round(TA(s))}}),$c={test:tg("rgb","red"),parse:ng("red","green","blue"),transform:function(s){var e=s.red,t=s.green,n=s.blue,r=s.alpha,o=r===void 0?1:r;return"rgba("+ig.transform(e)+", "+ig.transform(t)+", "+ig.transform(n)+", "+ac(sf.transform(o))+")"}},Xd={test:tg("#"),parse:function(s){var e="",t="",n="",r="";return s.length>5?(e=s.substr(1,2),t=s.substr(3,2),n=s.substr(5,2),r=s.substr(7,2)):(e=s.substr(1,1),t=s.substr(2,1),n=s.substr(3,1),r=s.substr(4,1),e+=e,t+=t,n+=n,r+=r),{red:parseInt(e,16),green:parseInt(t,16),blue:parseInt(n,16),alpha:r?parseInt(r,16)/255:1}},transform:$c.transform},IA=function(s){return{test:function(e){return Xu(e)&&e.endsWith(s)&&e.split(" ").length===1},parse:parseFloat,transform:function(e){return""+e+s}}},Kd=IA("%"),Wh=(ns(ns({},Kd),{parse:function(s){return Kd.parse(s)/100},transform:function(s){return Kd.transform(100*s)}}),{test:tg("hsl","hue"),parse:ng("hue","saturation","lightness"),transform:function(s){var e=s.hue,t=s.saturation,n=s.lightness,r=s.alpha,o=r===void 0?1:r;return"hsla("+Math.round(e)+", "+Kd.transform(ac(t))+", "+Kd.transform(ac(n))+", "+ac(sf.transform(o))+")"}}),PA=function(s,e,t){var n=s*s,r=e*e;return Math.sqrt(Math.max(0,t*(r-n)+n))},DA=[Xd,$c,Wh],RA=function(s){return DA.find(function(e){return e.test(s)})},rg=function(s,e){var t=RA(s),n=RA(e);t.transform,n.transform;var r=t.parse(s),o=n.parse(e),a=ns({},r),u=t===Wh?Kc:PA;return function(p){for(var f in a)f!=="alpha"&&(a[f]=u(r[f],o[f],p));return a.alpha=Kc(r.alpha,o.alpha,p),t.transform(a)}},uv=function(s){return $c.test(s)||Xd.test(s)||Wh.test(s)},hv=function(s){return $c.test(s)?$c.parse(s):Wh.test(s)?Wh.parse(s):Xd.parse(s)},Jd=function(s){return Xu(s)?s:s.hasOwnProperty("red")?$c.transform(s):Wh.transform(s)},dv="${c}",BA="${n}";function of(s){var e=[],t=0,n=s.match(Hh);n&&(t=n.length,s=s.replace(Hh,dv),e.push.apply(e,n.map(hv)));var r=s.match(Jc);return r&&(s=s.replace(Jc,BA),e.push.apply(e,r.map(Ku.parse))),{values:e,numColors:t,tokenised:s}}function qh(s){return of(s).values}function pv(s){var e=of(s),t=e.values,n=e.numColors,r=e.tokenised,o=t.length;return function(a){for(var u=r,p=0;p<o;p++)u=u.replace(p<n?dv:BA,p<n?Jd(a[p]):ac(a[p]));return u}}var kA=function(s){return typeof s=="number"?0:s},af={test:function(s){var e,t,n,r;return isNaN(s)&&Xu(s)&&((t=(e=s.match(Jc))===null||e===void 0?void 0:e.length)!==null&&t!==void 0?t:0)+((r=(n=s.match(Hh))===null||n===void 0?void 0:n.length)!==null&&r!==void 0?r:0)>0},parse:qh,createTransformer:pv,getAnimatableNone:function(s){var e=qh(s);return pv(s)(e.map(kA))}},lf={x:0,y:0,z:0},sg=function(s){return typeof s=="number"},Lo=function(s,e){return function(t){return e(s(t))}},og=function(){for(var s=[],e=0;e<arguments.length;e++)s[e]=arguments[e];return s.reduce(Lo)};function fv(s,e){return sg(s)?function(t){return Kc(s,e,t)}:uv(s)?rg(s,e):lc(s,e)}var mv=function(s,e){var t=function(o,a){for(var u=0,p=a.length,f=o.length;u<p;u++,f++)o[f]=a[u];return o}([],s),n=t.length,r=s.map(function(o,a){return fv(o,e[a])});return function(o){for(var a=0;a<n;a++)t[a]=r[a](o);return t}},gv=function(s,e){var t=ns(ns({},s),e),n={};for(var r in t)s[r]!==void 0&&e[r]!==void 0&&(n[r]=fv(s[r],e[r]));return function(o){for(var a in n)t[a]=n[a](o);return t}};function cf(s){for(var e=af.parse(s),t=e.length,n=0,r=0,o=0,a=0;a<t;a++)n||typeof e[a]=="number"?n++:e[a].hue!==void 0?o++:r++;return{parsed:e,numNumbers:n,numRGB:r,numHSL:o}}var lc=function(s,e){var t=af.createTransformer(e),n=cf(s),r=cf(e);return og(mv(n.parsed,r.parsed),t)},OA=function(s,e){return function(t){return Kc(s,e,t)}};function ag(s,e,t){var n=t===void 0?{}:t,r=n.clamp,o=r===void 0||r,a=n.ease,u=n.mixer,p=s.length;e.length,!a||!Array.isArray(a)||a.length,s[0]>s[p-1]&&(s=[].concat(s),e=[].concat(e),s.reverse(),e.reverse());var f=function(y,S,M){for(var P=[],D=M||(typeof(W=y[0])=="number"?OA:typeof W=="string"?uv(W)?rg:lc:Array.isArray(W)?mv:typeof W=="object"?gv:void 0),j=y.length-1,k=0;k<j;k++){var L=D(y[k],y[k+1]);if(S){var R=Array.isArray(S)?S[k]:S;L=og(R,L)}P.push(L)}var W;return P}(e,a,u),m=p===2?function(y,S){var M=y[0],P=y[1],D=S[0];return function(j){return D(Yu(M,P,j))}}(s,f):function(y,S){var M=y.length,P=M-1;return function(D){var j=0,k=!1;if(D<=y[0]?k=!0:D>=y[P]&&(j=P-1,k=!0),!k){for(var L=1;L<M&&!(y[L]>D||L===P);L++);j=L-1}var R=Yu(y[j],y[j+1],D);return S[j](R)}}(s,f);return o?function(y){return m(qu(s[0],s[p-1],y))}:m}function cc(s,e){return s.map(function(){return e||sv}).splice(0,s.length-1)}function $d(s){var e=s.from,t=e===void 0?0:e,n=s.to,r=n===void 0?1:n,o=s.ease,a=s.offset,u=s.duration,p=u===void 0?300:u,f={done:!1,value:t},m=Array.isArray(r)?r:[t,r],y=function(P,D){return P.map(function(j){return j*D})}(a&&a.length===m.length?a:function(P){var D=P.length;return P.map(function(j,k){return k!==0?k/(D-1):0})}(m),p);function S(){return ag(y,m,{ease:Array.isArray(o)?o:cc(m,o)})}var M=S();return{next:function(P){return f.value=M(P),f.done=P>=p,f},flipTarget:function(){m.reverse(),M=S()}}}function lg(s){var e=s.velocity,t=e===void 0?0:e,n=s.from,r=n===void 0?0:n,o=s.power,a=o===void 0?.8:o,u=s.timeConstant,p=u===void 0?350:u,f=s.restDelta,m=f===void 0?.5:f,y=s.modifyTarget,S={done:!1,value:r},M=a*t,P=r+M,D=y===void 0?P:y(P);return D!==P&&(M=D-r),{next:function(j){var k=-M*Math.exp(-j/p);return S.done=!(k>m||k<-m),S.value=S.done?D:D+k,S},flipTarget:function(){}}}var _v={keyframes:$d,spring:oc,decay:lg},cg=1/60*1e3,ug=typeof performance<"u"?function(){return performance.now()}:function(){return Date.now()},uf=typeof window<"u"?function(s){return window.requestAnimationFrame(s)}:function(s){return setTimeout(function(){return s(ug())},cg)},hg=!0,Zd=!1,vv=!1,hf={delta:0,timestamp:0},df=["read","update","preRender","render","postRender"],Av=df.reduce(function(s,e){return s[e]=function(t){var n=[],r=[],o=0,a=!1,u=new WeakSet,p={schedule:function(f,m,y){m===void 0&&(m=!1),y===void 0&&(y=!1);var S=y&&a,M=S?n:r;return m&&u.add(f),M.indexOf(f)===-1&&(M.push(f),S&&a&&(o=n.length)),f},cancel:function(f){var m=r.indexOf(f);m!==-1&&r.splice(m,1),u.delete(f)},process:function(f){var m;if(a=!0,n=(m=[r,n])[0],(r=m[1]).length=0,o=n.length)for(var y=0;y<o;y++){var S=n[y];S(f),u.has(S)&&(p.schedule(S),t())}a=!1}};return p}(function(){return Zd=!0}),s},{}),Il=df.reduce(function(s,e){var t=Av[e];return s[e]=function(n,r,o){return r===void 0&&(r=!1),o===void 0&&(o=!1),Zd||fg(),t.schedule(n,r,o)},s},{}),dg=df.reduce(function(s,e){return s[e]=Av[e].cancel,s},{}),LA=function(s){return Av[s].process(hf)},pg=function(s){Zd=!1,hf.delta=hg?cg:Math.max(Math.min(s-hf.timestamp,40),1),hf.timestamp=s,vv=!0,df.forEach(LA),vv=!1,Zd&&(hg=!1,uf(pg))},fg=function(){Zd=!0,hg=!0,vv||uf(pg)},mg=function(){return hf},yv=Il;function gg(s,e,t){return t===void 0&&(t=0),s-e-t}var NA=function(s){var e=function(t){var n=t.delta;return s(n)};return{start:function(){return yv.update(e,!0)},stop:function(){return dg.update(e)}}};function ep(s){var e,t,n,r,o,a=s.from,u=s.autoplay,p=u===void 0||u,f=s.driver,m=f===void 0?NA:f,y=s.elapsed,S=y===void 0?0:y,M=s.repeat,P=M===void 0?0:M,D=s.repeatType,j=D===void 0?"loop":D,k=s.repeatDelay,L=k===void 0?0:k,R=s.onPlay,W=s.onStop,q=s.onComplete,J=s.onRepeat,ee=s.onUpdate,he=cv(s,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),xe=he.to,De=0,Fe=he.duration,ke=!1,Qe=!0,Oe=function($e){if(Array.isArray($e.to))return $d;if(_v[$e.type])return _v[$e.type];var Ge=new Set(Object.keys($e));return Ge.has("ease")||Ge.has("duration")&&!Ge.has("dampingRatio")?$d:Ge.has("dampingRatio")||Ge.has("stiffness")||Ge.has("mass")||Ge.has("damping")||Ge.has("restSpeed")||Ge.has("restDelta")?oc:$d}(he);!((t=(e=Oe).needsInterpolation)===null||t===void 0)&&t.call(e,a,xe)&&(o=ag([0,100],[a,xe],{clamp:!1}),a=0,xe=100);var ze=Oe(ns(ns({},he),{from:a,to:xe}));return p&&(R==null||R(),(n=m(function($e){if(Qe||($e=-$e),S+=$e,!ke){var Ge=ze.next(Math.max(0,S));r=Ge.value,o&&(r=o(r)),ke=Qe?Ge.done:S<=0}ee==null||ee(r),ke&&(De===0&&(Fe!=null||(Fe=S)),De<P?function(ot,yt,Mt,pt){return pt?ot>=yt+Mt:ot<=-Mt}(S,Fe,L,Qe)&&(De++,j==="reverse"?S=function(ot,yt,Mt,pt){return Mt===void 0&&(Mt=0),pt===void 0&&(pt=!0),pt?gg(yt+-ot,yt,Mt):yt-(ot-yt)+Mt}(S,Fe,L,Qe=De%2==0):(S=gg(S,Fe,L),j==="mirror"&&ze.flipTarget()),ke=!1,J&&J()):(n.stop(),q&&q()))})).start()),{stop:function(){W==null||W(),n.stop()}}}const Yh={linear:nf,easeIn:qd,easeOut:wA,easeInOut:sv,circIn:ov,circOut:Jm,circInOut:av,backIn:Xc,backOut:xA,backInOut:$m,anticipate:lv,bounceOut:rf,bounceIn:EA,bounceInOut:SA,easeInOutSine:function(s){return-(Math.cos(Math.PI*s)-1)/2}};async function is(s){return new Promise(e=>setTimeout(e,Math.max(0,s)))}function pf(s,e,t){const n=s[e],r=()=>{typeof(s==null?void 0:s.setDirty)=="function"&&s.setDirty(),t==null||t()};return n.isVector3||n.isVector2||n.isVector4?o=>{n.copy(o),r()}:o=>{s[e]=o,r()}}function bv(s){return typeof s!="boolean"}async function ff(s,e,t){e in s||console.error("invalid key",e,s);const n=pf(s,e),r=s[e],o=a=>{var u;n(a),(u=t.onUpdate)===null||u===void 0||u.call(t,a)};if(bv(r))return typeof t.to=="function"&&(t={...t,to:t.to(r,s)}),wv({...t,from:r,onUpdate:o});{const{duration:a}=t;return is(a??0).then(()=>o(t.to))}}async function wv(s){return new Promise((e,t)=>{ep({onComplete:()=>{var n;(n=s.onComplete)===null||n===void 0||n.call(s),e()},onStop:()=>{var n;(n=s.onStop)===null||n===void 0||n.call(s),e()},...s})})}class Zc extends xl{constructor(){super(),this.passId="frameFade",this._fadeTime=0,this._fadeTimeState=0,this._toSaveFrame=!1,this._beforeFilters=["progressive","taa"],this._afterFilters=["render"],this._requiredFilters=["render","progressive"],this.dependencies=[lo],this.fadeOnActiveCameraChange=!0,this.fadeOnMaterialUpdate=!0,this.fadeOnSceneUpdate=!0,this.pointerEnabled=!0,this._fadeCam=e=>e.frameFade!==!1&&this.fadeOnActiveCameraChange&&this.startTransition(1e3),this._fadeMat=e=>{e.frameFade!==!1&&this.fadeOnMaterialUpdate&&this.startTransition(200)},this._fadeScene=e=>{e.frameFade!==!1&&this.fadeOnSceneUpdate&&this.startTransition(500)},this._onPointerMove=e=>{var t;const n=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(!n)return void(this.pointerEnabled=!1);if(!e.buttons||e.target!==n)return void(this.pointerEnabled=!0);const r=n.getBoundingClientRect(),o=(e.clientX-r.left)/r.width,a=(e.clientY-r.top)/r.height;this.pointerEnabled=o<0||o>1||a<0||a>1},this._disabledBy=[],this.startTransition=this.startTransition.bind(this),this.stopTransition=this.stopTransition.bind(this),this._fadeCam=this._fadeCam.bind(this),this._fadeMat=this._fadeMat.bind(this)}async startTransition(e){this._viewer&&this._pass&&!this.isDisabled()&&(this._target||(this._target=this._viewer.renderer.getTempTarget({sizeMultiplier:1,minFilter:c.wem,magFilter:c.wem,encoding:this._viewer.renderer.composerTarget.texture.encoding})),this._fadeTimeState=Math.max(e,this._fadeTimeState),this._fadeTime=this._fadeTimeState,this._toSaveFrame=!0,this.setDirty(),await is(e))}stopTransition(){this._fadeTimeState=0}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._fadeCam),e.scene.addEventListener("activeCameraUpdate",this.stopTransition),e.scene.addEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.addEventListener("sceneUpdate",this._fadeScene),window.addEventListener("pointermove",this._onPointerMove)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._fadeCam),e.scene.removeEventListener("activeCameraUpdate",this.stopTransition),e.scene.removeEventListener("sceneMaterialUpdate",this._fadeMat),e.scene.removeEventListener("sceneUpdate",this._fadeScene),window.removeEventListener("pointermove",this._onPointerMove),super.onRemove(e)}passCtor(e){const t=this,n=e.getPlugin(lo),r=new class extends Y_{constructor(){super(...arguments),this._lastTime=0,this.uiConfig=Ec("Frame Fade",this)}render(o,a,u,p,f){this.needsSwap=!1;const m=t._target;if(!m||!t.pointerEnabled||!this.enabled||!t.dirty||t._fadeTimeState<.001)return;t._toSaveFrame&&n.lastFrame&&(e.renderer.blit(n.lastFrame.texture,m),this._lastTime=0,t._toSaveFrame=!1),this.blendTexture=m==null?void 0:m.texture;const y=t._fadeTimeState/t._fadeTime;this.weights2.setScalar(y),this.weights2.w=1,this.weights1.setScalar(1-y),this.weights1.w=1,super.render(o,a,u,p,f),this.needsSwap=!0;const S=Mi();this._lastTime<10&&(this._lastTime=S-10);const M=S-this._lastTime;this._lastTime=S,t._fadeTimeState-=M}};return r.enabled=!0,r}setDirty(){var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.setDirty())}get dirty(){return this.enabled&&this._fadeTimeState>0}set dirty(e){console.warn("FrameFadePlugin.dirty is readonly")}_update(e){return!!super._update(e)&&(this.isDisabled()&&this.stopTransition(),this._fadeTimeState<.001&&(this._toSaveFrame=!1,this._target&&this._viewer&&(this._viewer.renderer.releaseTempTarget(this._target),this._target=void 0)),!0)}get uiConfig(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig}disable(e){this._disabledBy.includes(e)||this._disabledBy.push(e)}enable(e){const t=this._disabledBy.indexOf(e);t>=0&&this._disabledBy.splice(t,1)}isDisabled(){return!this.pointerEnabled||this._disabledBy.length>0||!this.enabled}}Zc.PluginType="FrameFade";var _g=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a},xv=c.M8C.degToRad;class er extends ui{constructor(e=rv,t=!1,n=!0,r=!1){super(),this.enabled=!0,this.autoFocus=!1,this._onObjectHit=o=>{this._viewer&&(this.enabled?this.dispatchEvent(o):o.intersects.selectedObject=null)},this._uiConfigChildren=[{label:"AutoFocus",type:"checkbox",property:[this,"autoFocus"],onChange:()=>{const o=this.getSelectedObject();this.autoFocus&&o&&this.setSelectedObject(o,!0)}}],e&&(this._widget=new e),this._controls=t,this._pickUi=n,this.autoFocus=r}get picker(){return this._picker}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}getSelectedObject(){var e;if(this.enabled)return((e=this._picker)===null||e===void 0?void 0:e.selectedObject)||void 0}setSelectedObject(e,t=!1){if(!this.enabled||!this._picker)return;const n=this.autoFocus;this.autoFocus=!1,this._picker.selectedObject=e||null,this.autoFocus=n,(n||t)&&this.focusObject(e)}async onAdded(e){await super.onAdded(e),this._picker=new sA(e.scene,e.canvas,void 0,t=>{var n,r;if(!t.material)return!1;let o=t,a=!1;for(;o;){if(!o.visible||(((n=o.userData.iModel)!==null&&n!==void 0?n:o).assetType==="model"&&(a=!0),((r=o.userData.iModel)!==null&&r!==void 0?r:o).assetType==="widget")||o.userData.userSelectable===!1||o.userData.bboxVisible===!1)return!1;o=o.parent}return a}),this._widget&&e.scene.addWidget(this._widget),this._transformControls=new Ev(e),this._transformControls.enabled=this._controls,this._picker.addEventListener("selectedObjectChanged",t=>{var n,r,o,a;this.dispatchEvent(t);const u=((n=this._picker)===null||n===void 0?void 0:n.selectedObject)||void 0;if(this._pickUi){const m=(r=u)===null||r===void 0?void 0:r.uiConfig,y=this.uiConfig;y.children=[...this._uiConfigChildren],m&&y.children.push(m),(o=y.uiRefresh)===null||o===void 0||o.call(y)}const p=this._widget;p&&(u?p.attach(u):p.detach());const f=this._transformControls;f&&(!((a=this._viewer)===null||a===void 0)&&a.scene.activeCamera.controls)&&(u&&f.enabled?f.attach(u):f.detach()),e.setDirty(),this.autoFocus&&this.focusObject(u)}),this._picker.addEventListener("hoverObjectChanged",this.dispatchEvent),this._picker.addEventListener("hitObject",this._onObjectHit),e.scene.addEventListener("select",t=>{t.value?this.setSelectedObject(t.value,this.autoFocus||t.focusCamera):console.warn("e.value must be set for picking")}),e.scene.addEventListener("addSceneObject",async t=>{var n,r,o;const a=t.object,u=this.getSelectedObject();if(u&&(a==null?void 0:a.assetType)==="material"&&typeof(u==null?void 0:u.setMaterial)=="function"&&(!((n=u==null?void 0:u.modelObject)===null||n===void 0)&&n.isMesh)&&await e.confirm("Applying material: Apply material to the selected object?")){const p=u.material;if(Array.isArray(p))console.warn("Dropping on material array not yet fully supported."),u.setMaterial(a);else{let f=Array.from((r=p==null?void 0:p.userData.__appliedMeshes)!==null&&r!==void 0?r:[]);(f.length>1?!await e.confirm("Applying material: Apply to all objects using this material?"):f.length<1)&&(f=[u]);for(const m of f)m&&((o=m.setMaterial)===null||o===void 0||o.call(m,a))}}}),e.scene.addEventListener("sceneUpdate",t=>{if(!t.hierarchyChanged)return;const n=this.getSelectedObject();let r=!1;n==null||n.traverseAncestors(o=>{o===e.scene.modelObject&&(r=!0)}),r||this.setSelectedObject(void 0)})}async focusObject(e){var t,n,r,o;const a=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CameraViews");await(a==null?void 0:a.animateToObject(e,4,1e3,"easeOut",{min:((o=(r=(n=this._viewer)===null||n===void 0?void 0:n.scene.activeCamera.getControls())===null||r===void 0?void 0:r.minDistance)!==null&&o!==void 0?o:.5)+.5,max:5}))}get uiConfig(){return this._pickUi?this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Picker",expanded:!0,children:[...this._uiConfigChildren]}:{}}get transformControls(){return this._transformControls}get widget(){return this._widget}}er.PluginType="Picking",_g([et(),_n()],er.prototype,"enabled",void 0),_g([et()],er.prototype,"autoFocus",void 0);class Ev extends _w{constructor(e){super(e.scene.activeCamera.cameraObject,e.canvas),this.modelObject=this,this.assetType="widget",this._activeCameraChange=this._activeCameraChange.bind(this),this._scene=e.scene,this._scene.addEventListener("activeCameraChange",this._activeCameraChange),this.visible=!1,this.userData.bboxVisible=!1,this.addEventListener("objectChange",()=>{var t;(t=this==null?void 0:this.object)===null||t===void 0||t.dispatchEvent({type:"objectUpdate",fadeFrame:!1})}),this.addEventListener("dragging-changed",t=>{const n=e==null?void 0:e.getPlugin(Zc);n&&(n.enabled=!t.value),this._scene.activeCamera.interactionsEnabled=!t.value}),this._keyDownListener=this._keyDownListener.bind(this),window.addEventListener("keydown",this._keyDownListener),window.addEventListener("keyup",this._keyUpListener),this._scene.addWidget(this)}_keyDownListener(e){if(this.enabled&&this.object){switch(e.keyCode){case 81:this.setSpace(this.space==="local"?"world":"local");break;case 16:this.setTranslationSnap(100),this.setRotationSnap(xv(15)),this.setScaleSnap(.25);break;case 87:this.setMode("translate");break;case 69:this.setMode("rotate");break;case 82:this.setMode("scale");break;case 187:case 107:this.setSize(this.size+.1);break;case 189:case 109:this.setSize(Math.max(this.size-.1,.1));break;case 88:this.showX=!this.showX;break;case 89:this.showY=!this.showY;break;case 90:this.showZ=!this.showZ;break;case 32:this.enabled=!this.enabled;break;default:return}this._scene.setDirty({sceneUpdate:!0,frameFade:!0})}}_keyUpListener(e){this.enabled&&(e.keyCode===16&&(this.setTranslationSnap(null),this.setRotationSnap(null),this.setScaleSnap(null)),this.object&&e.keyCode)}_activeCameraChange(){this.camera=this._scene.activeCamera.cameraObject}dispose(){window.removeEventListener("keydown",this._keyDownListener),window.removeEventListener("keyup",this._keyUpListener),this._scene.removeEventListener("activeCameraChange",this._activeCameraChange),this._scene.modelObject.remove(this),super.dispose()}}var tp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Qr extends ui{constructor(){super(),this.offsetCache={},this.enabled=!0,this.envMap=null,this.forceSceneEnvMap=!1,this.getEnvMap=()=>{var e;return!this.forceSceneEnvMap&&this.envMap?this.envMap:((e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())||null},this._modelProcessor={forAssetType:"model",processAsync:async(e,t)=>{const n=[];return e.modelObject.traverse(r=>{var o,a,u,p;const f=(a=(o=r.userData)===null||o===void 0?void 0:o.gltfExtensions)===null||a===void 0?void 0:a[Qr.DIAMOND_GLTF_EXTENSION];f&&r.geometry&&(this.prepareDiamondMesh(r,f),delete r.userData.gltfExtensions[Qr.DIAMOND_GLTF_EXTENSION]),r.material&&!n.includes(r.material)&&(!((p=(u=r.material.userData)===null||u===void 0?void 0:u.gltfExtensions)===null||p===void 0)&&p[Qr.DIAMOND_GLTF_EXTENSION])&&(r.material.materialObject||console.warn("material not processed",r.material),n.push(r.material))}),n.forEach(r=>{const o=r.userData.gltfExtensions[Qr.DIAMOND_GLTF_EXTENSION];o&&this._convertToDiamondMaterial(r,o)}),e}},this.uiConfig={type:"folder",label:"Diamonds",children:[{type:"toggle",label:"Use Scene Environment",property:[this,"forceSceneEnvironment"],limitedUi:!0},{type:"image",label:"Environment",hidden:()=>this.forceSceneEnvMap,property:[this,"envMap"],limitedUi:!0},{type:"slider",bounds:[0,2*Math.PI],hidden:()=>this.forceSceneEnvMap,label:"Env Rotation",property:[this,"envMapRotation"],limitedUi:!0},{type:"button",label:"Make Diamond",hidden:()=>{var e,t,n;const r=(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject())===null||n===void 0?void 0:n.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==Hs.TypeSlug},value:async()=>{var e,t,n,r,o,a;const u=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();if(!(u!=null&&u.material))return;const p=await((n=this._viewer)===null||n===void 0?void 0:n.prompt("Cache key: Enter optional cache key unique to the diamond shape.","",!1));let f=parseInt(await((r=this._viewer)===null||r===void 0?void 0:r.prompt("Cache size: Enter size of the cache [64-1024]","512",!1))||"512");isFinite(f)||(f=512),f<64&&(f=64),((o=u.material.userData)===null||o===void 0?void 0:o.__appliedMeshes.size)>1&&await((a=this._viewer)===null||a===void 0?void 0:a.confirm("Convert all: Apply diamond material to all the meshes with the same material?"))?this.makeDiamond(u.material,{cacheKey:p||void 0,normalMapRes:f},{}):this.makeDiamondMesh(u,{cacheKey:p||void 0,normalMapRes:f},{}),this.refreshUi()},limitedUi:!0},{type:"button",label:"Make Standard",hidden:()=>{var e,t,n;const r=(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject())===null||n===void 0?void 0:n.material;return!!Array.isArray(r)||(r==null?void 0:r.typeSlug)!==Ir.TypeSlug},value:async()=>{var e,t,n,r,o,a,u,p;const f=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject(),m=f==null?void 0:f.material;if(!m)return;const y=m.userData._baseMaterial;let S=(o=(r=(n=this._viewer)===null||n===void 0?void 0:n.getManager())===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(y);if(S&&!S.isDiamondMaterial||(S=(a=this._viewer)===null||a===void 0?void 0:a.createPhysicalMaterial({color:m.color})),S){const M=m.userData.__appliedMeshes.size>1&&await((u=this._viewer)===null||u===void 0?void 0:u.confirm("Convert all with this material?"))?Array.from(m.userData.__appliedMeshes):[f];for(const P of M)(p=P==null?void 0:P.setMaterial)===null||p===void 0||p.call(P,S)}this.refreshUi()},limitedUi:!0}]},this.refreshEnvMaps=this.refreshEnvMaps.bind(this),this.refreshUi=this.refreshUi.bind(this)}get envMapRotation(){var e,t;return(t=(e=this.envMap)===null||e===void 0?void 0:e.rotation)!==null&&t!==void 0?t:0}set envMapRotation(e){var t;const n=this.envMap;n&&(n.rotation=e,(t=this._viewer)===null||t===void 0||t.scene.setDirty())}refreshEnvMaps(){var e,t,n;if(!this._viewer)return;const r=this.getEnvMap(),o=((t=(e=this._viewer.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0?void 0:t.getMaterialsOfType(Ir.TypeSlug))||[];for(const a of o)a&&a.envMap!==r&&(a.envMap=r,a.needsUpdate=!0);(n=this._viewer)===null||n===void 0||n.scene.setDirty()}refreshUi(){var e,t,n;(e=this._viewer)===null||e===void 0||e.setDirty(),(n=(t=this.uiConfig)===null||t===void 0?void 0:t.uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}async onAdded(e){var t,n,r,o,a,u;this._normalCapture=new eA(e.renderer),this.offsetCache={},e.scene.addEventListener("environmentChanged",this.refreshEnvMaps);const p=e.getPlugin(dn);(t=p==null?void 0:p.importer)===null||t===void 0||t.processors.add("model",this._modelProcessor),(n=e.getPlugin(er))===null||n===void 0||n.addEventListener("selectedObjectChanged",this.refreshUi);const f=this.getEnvMap,m=new Nr(class extends Sd{async loadAsync(y,S){var M;const P=await super.loadAsync(y,S);return P.type===Ir.TYPE||P.isDiamondMaterialParameters?(P.envMap=f(),(M=p==null?void 0:p.materials)===null||M===void 0?void 0:M.generateFromTemplate("diamond",P)):(console.error("Invalid material type for Diamond Material.",P),null)}},[Ir.TypeSlug],!1);return bi.Importers.push(m),(a=(o=(r=p==null?void 0:p.exporter)===null||r===void 0?void 0:r.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||a===void 0||a.push(mf),(u=p==null?void 0:p.materials)===null||u===void 0||u.registerMaterialTemplate({name:"diamond",materialType:Ir.TYPE,isDiamondMaterialParameters:!0,generator:(y,S)=>{const M=new Ir(y);return M.envMap=f(),S&&S!=={}&&M.copyProps(S),M}}),super.onAdded(e)}async onRemove(e){var t,n,r,o;return(t=this._normalCapture)===null||t===void 0||t.dispose(),this._normalCapture=void 0,this.offsetCache={},(r=(n=e.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.processors.remove("model",this._modelProcessor),(o=e.getPlugin(er))===null||o===void 0||o.removeEventListener("selectedObjectChanged",this.refreshUi),super.onRemove(e)}prepareDiamondMesh(e,{cacheKey:t,normalMapRes:n}){var r,o,a;e.userData._diamondCacheKey=t??e.userData._diamondCacheKey,e.userData._diamondNormalMapRes=n??e.userData._diamondNormalMapRes,t=t&&t.length>0?t.includes(";"+e.geometry.uuid)?t:t+";"+e.geometry.uuid:e.geometry.uuid,this._computeOffsets(e.geometry,e.geometry.uuid);const u=(o=(r=this._normalCapture)===null||r===void 0?void 0:r.captureNormalMap(e.geometry,t,n))!==null&&o!==void 0?o:[void 0,!1],p=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("debug");p&&u&&(p.counters.normalsCapture||(p.counters.normalsCapture=0),p.counters.normalsCapture++,console.log("DEBUG: new normal map captured",p.counters.normalsCapture,t),p.addTexture("normal"+p.counters.normalsCapture,()=>{var f;return(f=e.geometry.userData._normalsCaptureMap)===null||f===void 0?void 0:f.texture},[40,110*p.counters.normalsCapture-100,200,100],void 0,void 0,"postRender",!0))}makeDiamond(e,t,n){var r,o;Array.from((r=e==null?void 0:e.userData.__appliedMeshes)!==null&&r!==void 0?r:[]).forEach(a=>{a!=null&&a.isMesh&&a.geometry&&this.prepareDiamondMesh(a,t)}),this._convertToDiamondMaterial(e,n),(o=this._viewer)===null||o===void 0||o.setDirty()}makeDiamondMesh(e,t,n){if(!e.modelObject.isMesh||!e.geometry||!e.setMaterial)return;this.prepareDiamondMesh(e.modelObject,t);const r=Array.isArray(e.material)?e.material[0]:e.material,o=this._convertToDiamondMaterial(r,n,!1);e.setMaterial(o)}_convertToDiamondMaterial(e,t={isDiamond:!0},n=!0){var r,o,a,u,p,f,m;let y={...t??{}};y.isDiamond||y.isDiamondMaterialParameters?Array.isArray(y.boostFactors)&&(y.boostFactors=new c.Pa4().fromArray(y.boostFactors)):y={isDiamondMaterialParameters:!0},y.color=(a=(r=y.color)!==null&&r!==void 0?r:(o=e==null?void 0:e.materialObject)===null||o===void 0?void 0:o.color)!==null&&a!==void 0?a:new Sn(1,1,1);const S=(f=(p=(u=this._viewer)===null||u===void 0?void 0:u.getManager())===null||p===void 0?void 0:p.materials)===null||f===void 0?void 0:f.generateFromTemplate("diamond",y);if(S&&e&&!e.isDiamondMaterial&&(S.userData._baseMaterial=e.uuid),n){const M=P=>{var D;return(D=P.setMaterial)!==null&&D!==void 0?D:j=>{P.material=j.materialObject}};Array.from((m=e==null?void 0:e.userData.__appliedMeshes)!==null&&m!==void 0?m:[]).forEach(P=>{M(P)(S),this.prepareDiamondMesh(P,t)})}return S}_computeOffsets(e,t,n=!1){const r=t.split(";").find(f=>this.offsetCache[f]);if(r&&!n){const f=this.offsetCache[r];return t.split(";").forEach(m=>m!==r&&(this.offsetCache[m]=f)),e.userData._normalsCaptureOffsets=f,f}e.computeBoundingBox();const o=e.boundingBox.getCenter(new c.Pa4),a=iA(e),u=a.clone().invert(),p={center:o,offsetMatrix:a,offsetMatrixInv:u,radius:1,centerOffset:new c.Pa4().copy(o).applyMatrix4(u)};return t.split(";").forEach(f=>this.offsetCache[f]=p),e.userData._normalsCaptureOffsets=p,p}}Qr.PluginType="Diamond",Qr.DIAMOND_GLTF_EXTENSION="WEBGI_materials_diamond",tp([we(Qr.prototype.refreshEnvMaps),et()],Qr.prototype,"envMap",void 0),tp([we(Qr.prototype.refreshEnvMaps),et()],Qr.prototype,"forceSceneEnvMap",void 0);const mf=s=>({writeMaterial:(e,t)=>{e.isDiamondMaterial&&(t.extensions=t.extensions||{},t.extensions[Qr.DIAMOND_GLTF_EXTENSION]=e.toJSON(),s.extensionsUsed[Qr.DIAMOND_GLTF_EXTENSION]=!0)},writeMesh:(e,t)=>{var n,r;if(!(e!=null&&e.material.isDiamondMaterial))return;t.extensions=t.extensions||{};const o={};(r=(n=e.userData)===null||n===void 0?void 0:n.gltfExtensions)===null||r===void 0||delete r[Qr.DIAMOND_GLTF_EXTENSION],e.userData._diamondNormalMapRes&&(o.normalMapRes=e.userData._diamondNormalMapRes),e.userData._diamondCacheKey&&(o.cacheKey=e.userData._diamondCacheKey),t.extensions[Qr.DIAMOND_GLTF_EXTENSION]=o,s.extensionsUsed[Qr.DIAMOND_GLTF_EXTENSION]=!0}});var Ma,Os=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Br=Ma=class extends ui{constructor(){super(),this.enabled=!0,this.animations=[],this.loopAnimations=!0,this.loopRepetitions=1/0,this.timeScale=0,this.animateOnScroll=!1,this.animationSpeed=1,this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this.dependencies=[dn],this._lastFrameTime=0,this._fadeDisabled=!1,this._objectAdded=s=>{const e=s.object;e.assetType==="model"&&e.modelObject&&this._viewer&&e.modelObject.traverse(t=>{const n=t.animations;if(n.length<1)return;const r=Math.max(...n.map(u=>u.duration));n.forEach(u=>u.duration=r);const o=new c.Xcj(this._viewer.scene.modelRoot.modelObject),a=n.map(u=>o.clipAction(u).setLoop(this.loopAnimations?c.YKA:c.jAl,this.loopRepetitions));this.animations.push({mixer:o,clips:n,actions:a,duration:r}),this.onPropertyChange()})},this._animationTime=0,this._animationDuration=0,this._animationState="none",this.uiConfig=void 0,this._lastAnimId="",this.timelineMarkers=[],this._postFrame=this._postFrame.bind(this),this._wheel=this._wheel.bind(this),this.playClips=this.playClips.bind(this),this.playClip=this.playClip.bind(this),this.playAnimation=this.playAnimation.bind(this),this.playPauseAnimation=this.playPauseAnimation.bind(this),this.pauseAnimation=this.pauseAnimation.bind(this),this.stopAnimation=this.stopAnimation.bind(this),this.resetAnimation=this.resetAnimation.bind(this),this.onPropertyChange=this.onPropertyChange.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get animationState(){return this._animationState}get animationTime(){return this._animationTime}get animationDuration(){return this._animationDuration}_wheel({deltaY:s}){this.enabled&&Math.abs(s)>.001&&(this._scrollAnimationState=-1*Math.sign(s))}_postFrame(){var s,e;if(!this._viewer)return;const t=this._viewer,n=this.animateOnScroll;if(!this.enabled||this.animations.length<1||this._animationState!=="playing"&&!n)return this._lastFrameTime=0,void(this._fadeDisabled&&((s=this._viewer.getPluginByType("FrameFade"))===null||s===void 0||s.enable(Ma.PluginType),this._fadeDisabled=!1));const r=Mi()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/30);let o=r-this._lastFrameTime;if(o*=this.animationSpeed,this._lastFrameTime=r,n&&(o*=this._scrollAnimationState),Math.abs(o)<1e-4)return;const a=(e=this._viewer.getPluginByType("Progressive"))===null||e===void 0?void 0:e.postFrameConvergedRecordingDelta();if(a&&a>0&&(o=a),a!==0&&(this.animations.map(u=>u.mixer.update(o)),this._animationTime+=o,this._animationTime>this._animationDuration&&(this._animationTime-=this._animationDuration),this._animationTime<0&&(this._animationTime+=this._animationDuration),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,t.scene.activeCamera.cameraObject.userData.__animatingCamera&&t.scene.activeCamera.setDirty(),t.renderer.resetShadows(),t.setDirty(),!this._fadeDisabled)){const u=this._viewer.getPluginByType("FrameFade");u&&(u.disable(Ma.PluginType),this._fadeDisabled=!0)}}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new eu(e,this))}async onAdded(s){var e,t,n,r,o,a;(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),s.scene.addEventListener("addSceneObject",this._objectAdded),(a=(o=(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.exporter)===null||r===void 0?void 0:r.getExporter("gltf","glb"))===null||o===void 0?void 0:o.extensions)===null||a===void 0||a.push(gf),s.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel);let u=-1;return Object.defineProperty(s.scene.modelRoot,"currentTimelineMarker",{get:()=>u,set:p=>s.scene.modelRoot.dispatchEvent({type:"animationTimelineMarker",marker:this.timelineMarkers[u=p]})}),s.scene.modelRoot.addEventListener("animationTimelineMarker",({marker:p})=>{var f;if(!this._viewer)return;if(!p)return this._viewer.scene.activeCamera=(f=this._viewer)===null||f===void 0?void 0:f.scene.defaultCamera,void this._viewer.setDirty();const m=p.camera;m&&(m.userData.__animatingCamera=!0,this._viewer.scene.activeCamera=this._viewer.createCamera(m))}),super.onAdded(s)}async onRemove(s){var e,t;return s.scene.removeEventListener("addSceneObject",this._objectAdded),(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),s.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),super.onRemove(s)}onPropertyChange(){this._animationState==="playing"&&this.playAnimation(),this._animationDuration=Math.max(...this.animations.map(({duration:s})=>s))}onStateChange(){var s,e;(e=(s=this.uiConfig)===null||s===void 0?void 0:s.children)===null||e===void 0||e.map(t=>t&&Se(t)).flat(2).forEach(t=>{var n;return(n=t==null?void 0:t.uiRefresh)===null||n===void 0?void 0:n.call(t)})}playPauseAnimation(){this._animationState==="playing"?this.pauseAnimation():this.playAnimation()}async playClip(s,e=!1){return this.playClips([s],e)}async playClips(s,e=!1){const t=[];return this.animations.forEach(({actions:n})=>{n.forEach(r=>{s.includes(r.getClip().name)&&t.push(r)})}),this.playAnimation(e,t)}async playAnimation(s=!1,e){var t,n,r;if(!this.enabled)return;this._animationState==="playing"&&this.stopAnimation(!1),_e((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"))===null||n===void 0?void 0:n.transformControls,"enabled",!1);let o=0;e||(e=[],this.animations.forEach(({mixer:p,actions:f,clips:m})=>{e.push(...f)}));const a=ki();this._lastAnimId=a,this._animationState!=="paused"&&this.resetAnimation();for(const p of e)this.timeScale>0&&(p.timeScale=this.timeScale),p.setLoop(this.loopAnimations?c.YKA:c.jAl,this.loopRepetitions),p.play(),o=Math.max(o,p.getClip().duration/p.timeScale);if(this._animationState="playing",(r=this._viewer)===null||r===void 0||r.setDirty(),o*=this.loopAnimations?this.loopRepetitions:1,o/=this.animationSpeed,!isFinite(o))return;const u=1e3*o-this._animationTime/this.animationSpeed+.01;u>0&&await is(u),a===this._lastAnimId&&this.stopAnimation(s)}pauseAnimation(){var s,e,t;this._animationState="paused",_e((e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.transformControls,"enabled",!0),(t=this._viewer)===null||t===void 0||t.setDirty(),this._lastAnimId=""}stopAnimation(s=!1){var e,t,n;this._animationState="stopped",_e((e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"),"enabled",!0),s?this.resetAnimation():(t=this._viewer)===null||t===void 0||t.setDirty(),this._lastAnimId="",this._viewer&&this._fadeDisabled&&((n=this._viewer.getPluginByType("FrameFade"))===null||n===void 0||n.enable(Ma.PluginType),this._fadeDisabled=!1)}resetAnimation(){var s;this._animationState==="stopped"?(this.animations.forEach(({mixer:e,actions:t,clips:n})=>{e.stopAllAction(),e.setTime(0)}),this._animationTime=0,(s=this._viewer)===null||s===void 0||s.setDirty()):this.stopAnimation(!0)}};Br.PluginType="GLTFAnimation",Br.AnimationMarkersExtension="WEBGI_animation_markers",Os([ja()],Br.prototype,"animationState",null),Os([ja()],Br.prototype,"animationTime",null),Os([ja()],Br.prototype,"animationDuration",null),Os([we(Ma.prototype.onPropertyChange),_n("Loop",{limitedUi:!0})],Br.prototype,"loopAnimations",void 0),Os([we(Ma.prototype.onPropertyChange)],Br.prototype,"loopRepetitions",void 0),Os([we(Ma.prototype.onPropertyChange)],Br.prototype,"timeScale",void 0),Os([_n(),et()],Br.prototype,"animateOnScroll",void 0),Os([wn("Speed",[.1,4],.1,{limitedUi:!0}),et()],Br.prototype,"animationSpeed",void 0),Os([we(Ma.prototype.onStateChange)],Br.prototype,"_animationState",void 0),Os([Ji("Play/Pause",s=>({label:()=>s.animationState==="playing"?"Pause":"Play",limitedUi:!0}))],Br.prototype,"playPauseAnimation",null),Os([Ji("Stop",{limitedUi:!0})],Br.prototype,"stopAnimation",null),Os([Ji("Reset",{limitedUi:!0})],Br.prototype,"resetAnimation",null),Br=Ma=Os([Ci("GLTF Animations")],Br);class eu{constructor(e,t){this.parser=e,this.name=Br.AnimationMarkersExtension,this.plugin=t}async afterRoot(e){var t;let n=[];for(const S of this.parser.json.scenes){if(!S.extensions)continue;const M=S.extensions[this.name];for(const P of(M==null?void 0:M.markers)||[]){const D=P.camera!==void 0?await this.parser.getDependency("camera",P.camera):void 0;P.time===void 0&&(P.time=P.frame/30,console.error("Update timeline markers plugin for correct times.")),n.push({name:P.name,frame:P.frame,time:P.time,camera:D})}}if(n.length<1)return;n=n.sort((S,M)=>S.frame-M.frame);const r=(t=e.scene)!==null&&t!==void 0?t:e.scenes[0];if(!r)return;r.userData.__markers=n;const o=this.plugin.timelineMarkers,a=n.map(S=>S.time);let u=o.length;const p=n.map(S=>u++),f=Math.max(...a)+.01;o.push(...n);const m=new c.dUE(".currentTimelineMarker",a,p,2300),y=new c.m7l("animationTimelineMarker",f,[m]);y.__gltfExport=!1,e.animations.push(y)}}const gf=s=>({afterParse(e){const t=s.json.scenes[s.json.scene||0];t.extensions=t.extensions||{};const n={markers:[]},r=[];if((Array.isArray(e)?e:[e]).forEach(o=>o.traverse(a=>{a.userData.__markers&&r.push(...a.userData.__markers)})),r.sort((o,a)=>o.frame-a.frame),!(r.length<1)){for(const o of r){const a=o.camera;if(a){const u=s.nodeMap.get(a);if(u===void 0){console.warn("Camera not found in gltf export",a,s.nodeMap);continue}const p=s.json.nodes[u].camera;o.camera=p,n.markers.push(o)}}t.extensions[Br.AnimationMarkersExtension]=n,s.extensionsUsed[Br.AnimationMarkersExtension]=!0}}});class Pl extends w{constructor(){super(...arguments),this.dirty=!1,this.counters={},this._generators=new Map,this._preRender=()=>this._showDebug("preRender"),this._postRender=()=>this._showDebug("postRender")}async onAdded(e){this._viewer=e,e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender)}addTexture(e,t,n,r,o,a="postRender",u=!1){var p;this._generators.has(a)||this._generators.set(a,[]),(p=this._generators.get(a))===null||p===void 0||p.push({key:e,fn:t,rect:n?[...n]:void 0,frag:o||r||u?new c.jyz({vertexShader:C.vertexShader,uniforms:{tDiffuse:{value:null},opacity:{value:1}},fragmentShader:o??`
        #include <common>
        #include <packing>
        uniform float opacity;
		uniform ${u?"samplerCube":"sampler2D"} tDiffuse;
		varying vec2 vUv;
		void main() {
			vec4 texel = ${u?"textureCube( tDiffuse, vec3(cos(vUv.y * PI2) * cos(vUv.x * PI2), sin(vUv.y * PI2), cos(vUv.y * PI2) * sin(vUv.x * PI2)) )":"texture2D( tDiffuse, vUv )"};
			${r??""}
			gl_FragColor = opacity * texel;
		}
            `}):void 0})}removeTexture(e,t="postRender"){var n,r;this._generators.set(t,(r=(n=this._generators.get(t))===null||n===void 0?void 0:n.filter(o=>o.key!==e))!==null&&r!==void 0?r:[])}async onDispose(e){return Promise.resolve(void 0)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),this._viewer=void 0,Promise.resolve(void 0)}_showDebug(e){var t;const n=this._viewer,r=n==null?void 0:n.renderer;r&&n&&((t=this._generators.get(e))===null||t===void 0||t.forEach(({key:o,fn:a,rect:u,frag:p})=>{const f=a(n);if(f){if(f.image&&u){const m=f.image.width/f.image.height;u[2]<1&&u[3]<1&&(u[2]=200),u[2]<1&&(u[2]=u[3]*m),u[3]<1&&(u[3]=u[2]/m)}r.blit(f,void 0,{viewport:u,clear:!1,material:p})}}))}}Pl.PluginType="debug";var np=function(s,e){return np=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])},np(s,e)};function _f(s,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=s}np(s,e),s.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ip,vg=function(){function s(){}return s._xfnv1a=function(e){for(var t=2166136261,n=0;n<e.length;n++)t=Math.imul(t^e.charCodeAt(n),16777619);return function(){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,(t+=t<<5)>>>0}},s}(),Xh=function(s){function e(t){var n=s.call(this)||this;return n.a=e._xfnv1a(t)(),n}return _f(e,s),e.prototype.next=function(){var t=this.a+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},e}(vg),FA=function(s){function e(t){var n=s.call(this)||this,r=e._xfnv1a(t);return n.a=r(),n.b=r(),n.c=r(),n.d=r(),n}return _f(e,s),e.prototype.next=function(){this.a>>>=0,this.b>>>=0,this.c>>>=0,this.d>>>=0;var t=this.a+this.b|0;return this.a=this.b^this.b>>>9,this.b=this.c+(this.c<<3)|0,this.c=this.c<<21|this.c>>>11,this.d=this.d+1|0,t=t+this.d|0,this.c=this.c+t|0,(t>>>0)/4294967296},e}(vg),Ju=function(s){function e(t){var n=s.call(this)||this,r=e._xfnv1a(t);return n.a=r(),n.b=r(),n.c=r(),n.d=r(),n}return _f(e,s),e.prototype.next=function(){var t=this.b<<9,n=5*this.a;return n=n<<7|9*(n>>>25),this.c^=this.a,this.d^=this.b,this.b^=this.c,this.a^=this.d,this.c^=t,this.d=this.d<<11|this.d>>>21,(n>>>0)/4294967296},e}(vg);(function(s){s.sfc32="sfc32",s.mulberry32="mulberry32",s.xoshiro128ss="xoshiro128ss"})(ip||(ip={}));var vf=function(){function s(e,t){t===void 0&&(t=ip.sfc32),this.str=e,this.prng=t,this.generator=this._initializeGenerator()}return s.prototype.next=function(){return this.generator.next()},s.prototype._initializeGenerator=function(){if(function(t){return t===null}(e=this.str)||function(t){return t===void 0}(e))return this.wrap();var e;switch(this.prng){case"sfc32":return new FA(this.str);case"mulberry32":return new Xh(this.str);case"xoshiro128ss":return new Ju(this.str);default:return this.wrap()}},s.prototype.wrap=function(){return{next:function(){return Math.random()}}},s}(),UA=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Af extends sc{constructor(e,t,n,r){super(e,t),this._shadowParams={enabled:!0,radius:2,width:1024,height:1024,bias:-.001,normalBias:0,near:1.5,far:4,frustumSize:4},this._randomParams={focus:1,spread:.01,distanceScale:50,minDistanceScale:new c.Pa4(10,10,10),normalDirection:new c.Pa4(.01,.98,.01).normalize(),direction:new c.Pa4(-.9,.5,-1)},this.isRandomizedDirectionalLight=!0,this.shadowParams=n??{},this.randomParams=r??{},this.updateShadowParams=this.updateShadowParams.bind(this)}get shadowParams(){return this._shadowParams}set shadowParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),this._shadowParams={...this._shadowParams,...e},this.updateShadowParams()}get randomParams(){return this._randomParams}set randomParams(e){Object.keys(e).forEach(t=>e[t]===void 0&&delete e[t]),Object.assign(this._randomParams,e)}updateShadowParams(){this.castShadow=this._shadowParams.enabled,this.shadow.mapSize.x=this._shadowParams.width,this.shadow.mapSize.y=this._shadowParams.height,this.shadow.bias=this._shadowParams.bias,this.shadow.normalBias=this._shadowParams.normalBias,this.refreshShadowCamNearFar(),this.shadow.radius=this._shadowParams.radius,this.shadow.camera.right=this._shadowParams.frustumSize/2,this.shadow.camera.left=-this._shadowParams.frustumSize/2,this.shadow.camera.top=this._shadowParams.frustumSize/2,this.shadow.camera.bottom=-this._shadowParams.frustumSize/2,this.shadow.camera.updateProjectionMatrix(),this.matrixWorldNeedsUpdate=!0}randomizePosition(e,t=null,n=null){const r=new vf(e.toString()),o=new c.FM8(r.next()*Math.PI*2,Math.asin(2*r.next()-1));let a=new c.Pa4(Math.cos(o.x)*Math.cos(o.y),Math.sin(o.y),Math.sin(o.x)*Math.cos(o.y));const u=new c.FM8;for(let p=0;p<5;p++){u.set(r.next(),r.next()),a=jA(u,this._randomParams.normalDirection,.4),r.next()<Math.sqrt(t??this._randomParams.focus)&&(u.set(r.next(),r.next()),a=jA(u,this._randomParams.direction,Math.pow((n??this._randomParams.spread)/2,2)));const f=a.dot(this._randomParams.normalDirection);if(f>0&&f<.4)break}a.normalize(),a.multiplyScalar(this._randomParams.distanceScale),this.position.set(0,0,0),this.target.position.copy(a.normalize().negate()),this.target.updateMatrixWorld(),this.refreshShadowCamNearFar(),this.updateMatrixWorld()}refreshShadowCamNearFar(){const e=new c.Pa4().subVectors(this.target.position,this.shadow.camera.position).length();this.shadow.camera.near=e-this._shadowParams.near*this._shadowParams.frustumSize/2,this.shadow.camera.far=e+this._shadowParams.far*this._shadowParams.frustumSize/2}dispose(){}get uiConfig(){if(this._uiConfig)return this._uiConfig}fromJSON(e,t){return super.fromJSON(e,t)?(this.updateShadowParams(),this):null}}function jA(s,e,t){e=e.clone().normalize();const n=new c.Pa4(0,-e.z,e.y).normalize(),r=new c.Pa4().crossVectors(e,n).normalize(),o=s;o.x=2*o.x*Math.PI,o.y=1-o.y*t;const a=Math.sqrt(1-o.y*o.y);return n.multiplyScalar(Math.cos(o.x)*a).add(r.multiplyScalar(Math.sin(o.x)*a)).add(e.multiplyScalar(o.y))}UA([et("shadowParams")],Af.prototype,"_shadowParams",void 0),UA([et("randomParams")],Af.prototype,"_randomParams",void 0);class Sv extends c.Tn7{constructor(){super(...arguments),this.typeSlug="fsShadow",this.assetType="material",this._uniforms={},this.lastFrameTexture=null}get materialObject(){return this}onBeforeCompile(e,t){e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`
#include <project_vertex>
gl_Position = vec4(uv*2.-1., 0, 1.); 
        `),e.vertexShader=e.vertexShader.replace("void main() {",`
varying vec2 vUv;
void main() {
    vUv = uv;
        `),e.fragmentShader=e.fragmentShader.replace("void main() {",`
varying vec2 vUv;
uniform sampler2D tLastThis;
void main() {
        `),e.fragmentShader=e.fragmentShader.replace("gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );",Z`
float shadow = getShadowMask();

//shift the color by dither_shift
shadow = clamp(shadow + mix(-1./512., 1./512., rand( gl_FragCoord.xy )), 0., 1.);

float last = unpackRGBAToDepth(texture2D(tLastThis, vUv));
gl_FragColor = packDepthToRGBA(mix(last, shadow, opacity));
//if not useMovingAverage:
//gl_FragColor = packDepthToRGBA(shadow * opacity + last);
        `),Object.assign(e.uniforms,this._uniforms),super.onBeforeCompile(e,t)}customProgramCacheKey(){return super.customProgramCacheKey()}toJSON(e){throw new Error("Method not supported for this material.")}fromJSON(e,t){throw new Error("Method not supported for this material.")}copyProps(e){throw new Error("Method not supported for this material.")}setDirty(e){this.needsUpdate=!0,this.dispatchEvent({...e,type:"materialUpdate"})}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([be({propKey:"tLastThis"})],Sv.prototype,"lastFrameTexture",void 0);var yf=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Dl{constructor(e){this.enabled=!0,this._lightLayer=5,this._frameNumber=0,this.maxFrameNumber=400,this.groundMapMode="aoMap",this.alphaVignette=!0,this.alphaVignetteAxis="xy",this.shadowAutoUpdate=!0,this.materialExtension={shaderExtender:(n,r,o)=>{this.groundMapMode==="aoMap"?n.fragmentShader=Lr(n.fragmentShader,"#include <aomap_fragment>",Lr(c.WdD.aomap_fragment,"float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;","float ambientOcclusion = ( unpackRGBAToDepth(texture2D( aoMap, vUv2 ) ) - 1.0) * aoMapIntensity + 1.0;")):this.groundMapMode==="map"?n.fragmentShader=Lr(n.fragmentShader,"#include <map_fragment>",Lr(c.WdD.map_fragment,"diffuseColor *= sampledDiffuseColor;","float groundShadow = unpackRGBAToDepth(sampledDiffuseColor); diffuseColor.rgb *= groundShadow; diffuseColor.a *= max(0., 1.-groundShadow);")):this.groundMapMode==="alphaMap"&&(n.fragmentShader=Lr(n.fragmentShader,"#include <alphamap_fragment>",Lr(c.WdD.alphamap_fragment,"texture2D( alphaMap, vUv ).g","1. - unpackRGBAToDepth( texture2D( alphaMap, vUv ) )",{replaceAll:!0}))),this.alphaVignette&&o.capabilities.isWebGL2&&(n.fragmentShader=Lr(n.fragmentShader,"#include <output_fragment>",Z`#include <output_fragment>
                    #ifndef OPAQUE
                    float weight = 0.;
                    #ifdef USE_UV
                    weight = 2.*abs(length(0.5 - vUv.${this.alphaVignetteAxis}));
                    #endif
                    #if defined(USE_LIGHTMAP) || defined(USE_AOMAP)
                    weight = 2.*abs(length(0.5 - vUv2.${this.alphaVignetteAxis}));
                    #endif
                    weight = min(1., max(0., weight))-0.5;
                    weight = min(1., max(0., 1.0-2.*weight));
                    weight = pow(weight, 1.5);
                    gl_FragColor.a *= weight;
                    //gl_FragColor.rgb /= max(0.01, weight);
                    gl_FragColor = saturate(gl_FragColor);
                    //gl_FragColor.a = 0.5;
                    #endif
                    `))},computeCacheKey:()=>this.groundMapMode+"."+this.alphaVignette+"."+this.alphaVignetteAxis,onObjectRender:(n,r)=>{r.materialObject.userData.gMapMode!==this.groundMapMode&&(r.materialObject.userData.gMapMode=this.groundMapMode,r.materialObject.needsUpdate=!0)},isCompatible:n=>n.isMeshStandardMaterial2},this._viewer=e;const t=new Af(16777215,10,{near:1.5,far:20,bias:0,frustumSize:4,width:1024,height:1024,enabled:!0,radius:10,normalBias:0},{direction:new c.Pa4(.2,1,.2).normalize(),spread:.9,focus:1,distanceScale:20,minDistanceScale:new c.Pa4(10,10,10),normalDirection:new c.Pa4(0,1,0)});t.shadow.camera.updateProjectionMatrix(),t.layers.disableAll(),t.layers.set(this._lightLayer),this._light=t,e.scene.addLight(this._light,{addToRoot:!0}),this._shadowMat=new Sv({color:"#ffffff",toneMapped:!1,depthWrite:!1,depthTest:!1,premultipliedAlpha:!1,opacity:1,transparent:!1,blending:c.jFi})}get attachedMesh(){return this._attachedMesh}set attachedMesh(e){this._attachedMesh!==e&&(this._attachedMesh&&this.cleanupMaterial(),this._attachedMesh=e,this._attachedMesh&&this._updateMaterial())}get target(){return this._target}get light(){return this._light}dispose(){this._shadowMat.dispose(),this._target=void 0,this.reset()}cleanupMaterial(){this._updateMaterial(!0)}_groundMapModeChanged(){this._attachedMesh&&(this.cleanupMaterial(),this._updateMaterial(),this.groundMapMode==="alphaMap"?this._attachedMesh.material.transparent=!0:this._attachedMesh.material.transparent=!1),this.reset()}_alphaVignetteChanged(){var e,t,n;(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e),(n=this._viewer)===null||n===void 0||n.setDirty()}fromJSON(e,t){return kt(e,this,!0,t),this.reset(),this}reset(){this._frameNumber=0}autoUpdateShadow(){this.shadowAutoUpdate&&this.updateShadow()}updateShadow(){if(!this.enabled)return!1;const e=this._attachedMesh;if(++this._frameNumber>this.maxFrameNumber||!e)return!1;const t=1024;this._target||(this._target=this._viewer.renderer.createTarget({type:c.ywz,depthBuffer:!1,size:new c.FM8(t,t),sizeMultiplier:void 0,encoding:c.rnI,format:c.wk1})),this._frameNumber<3?this._light.randomizePosition(0,1,0):this._light.randomizePosition(this._frameNumber),e.castShadow=!1;const n=this._viewer.renderer.rendererObject,r=n.shadowMap,o=r.type,a=r.needsUpdate,u=r.autoUpdate;r.type=c._MY,r.needsUpdate=!0,r.autoUpdate=!1;const p=this._viewer.scene,f=new c.S9g;f.disableAll(),p.modelObject.traverse(P=>{P.isLight&&P!==this._light.lightObject&&(P.userData.__gp_layers=P.layers,P.layers=f)});const m=p.activeCamera.cameraObject;if(m.layers.mask&1<<this._lightLayer)throw"Camera can render pseudo directional light, check layers";m.layers.enable(this._lightLayer),e.layers.disable(this._lightLayer),qt(n,{shadowMapRender:!0,backgroundRender:!1,sceneRender:!1},()=>this._viewer.renderer.renderScene(p)),m.layers.disable(this._lightLayer);const y=m.layers.mask;m.layers.set(this._lightLayer),e.layers.enable(this._lightLayer);const S=this._viewer.renderer.getTempTarget({type:c.ywz,depthBuffer:!1,size:new c.FM8(t,t),encoding:c.rnI,format:c.wk1}),M=S.texture.encoding;S.texture.encoding=c.rnI,this._viewer.renderer.blit(this._target.texture,S,{clear:!0});{const P=p.modelObject.environment,D=p.modelObject.background,j=e.material,k=e.frustumCulled,L=n.getRenderTarget(),R=n.getActiveCubeFace(),W=n.getActiveMipmapLevel();p.modelObject.background=null,p.modelObject.environment=null,e.material=this._shadowMat,e.frustumCulled=!1,n.setRenderTarget(this._target),this._shadowMat.opacity=Math.max(1/this.maxFrameNumber,1/this._frameNumber),this._shadowMat.lastFrameTexture=S.texture,this._shadowMat.needsUpdate=!0,qt(n,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1},()=>this._viewer.renderer.renderScene(p)),n.setRenderTarget(L,R,W),e.frustumCulled=k,e.material=j,p.modelObject.environment=P,p.modelObject.background=D}return S.texture.encoding=M,this._viewer.renderer.releaseTempTarget(S),e.layers.disable(this._lightLayer),m.layers.mask=y,p.modelObject.traverse(P=>{P.isLight&&P!==this._light.lightObject&&(P.layers=P.userData.__gp_layers,delete P.userData.__gp_layers)}),r.type=o,r.needsUpdate=a,r.autoUpdate=u,e.castShadow=!0,(this._frameNumber<2||this._frameNumber>Math.min(30,this.maxFrameNumber)&&this._frameNumber%150==0)&&(this._updateMaterial(),this._viewer.setDirty(),e.dispatchEvent({type:"materialUpdate"})),!0}_updateMaterial(e=!1){var t,n,r;this._attachedMesh&&(e?(this._attachedMesh.material.alphaMap===((t=this._target)===null||t===void 0?void 0:t.texture)&&(this._attachedMesh.material.alphaMap=null),this._attachedMesh.material.aoMap===((n=this._target)===null||n===void 0?void 0:n.texture)&&(this._attachedMesh.material.aoMap=null),this._attachedMesh.material.map===((r=this._target)===null||r===void 0?void 0:r.texture)&&(this._attachedMesh.material.map=null)):this._target&&(this.groundMapMode==="alphaMap"&&(this._attachedMesh.material.alphaMap=this._target.texture),this.groundMapMode==="aoMap"&&(this._attachedMesh.material.aoMap=this._target.texture),this.groundMapMode==="map"&&(this._attachedMesh.material.map=this._target.texture)),this._attachedMesh.material&&(this._attachedMesh.material.userData.ALPHA_I_RGBA_PACKING=!e&&this.groundMapMode==="alphaMap",this._attachedMesh.material.alphaTest=e||this.groundMapMode!=="alphaMap"?0:.001,this._attachedMesh.material.needsUpdate=!0))}}yf([et("randomizedLight")],Dl.prototype,"_light",void 0),yf([we(Dl.prototype.reset),et()],Dl.prototype,"maxFrameNumber",void 0),yf([we(Dl.prototype._groundMapModeChanged),et()],Dl.prototype,"groundMapMode",void 0),yf([et(),we(Dl.prototype._alphaVignetteChanged)],Dl.prototype,"alphaVignette",void 0),yf([et(),we(Dl.prototype._alphaVignetteChanged)],Dl.prototype,"alphaVignetteAxis",void 0);var zA="vec2 poisson_disk_samples[16];void setPds(){poisson_disk_samples[0]=vec2(-0.399691779231,0.728591545584);poisson_disk_samples[1]=vec2(-0.48622557676,-0.84016533712);poisson_disk_samples[2]=vec2(0.770309468987,-0.24906070432);poisson_disk_samples[3]=vec2(0.556596796154,0.820359876432);poisson_disk_samples[4]=vec2(-0.933902004071,0.0600539051593);poisson_disk_samples[5]=vec2(0.330144964342,0.207477293384);poisson_disk_samples[6]=vec2(0.289013230975,-0.686749271417);poisson_disk_samples[7]=vec2(-0.0832470893559,-0.187351643125);poisson_disk_samples[8]=vec2(-0.296314525615,0.254474834305);poisson_disk_samples[9]=vec2(-0.850977666059,0.484642744689);poisson_disk_samples[10]=vec2(0.829287915319,0.2345063545);poisson_disk_samples[11]=vec2(-0.773042143899,-0.543741521254);poisson_disk_samples[12]=vec2(0.0561133030864,0.928419742597);poisson_disk_samples[13]=vec2(-0.205799249508,-0.562072714492);poisson_disk_samples[14]=vec2(-0.526991665882,-0.193690188118);poisson_disk_samples[15]=vec2(-0.051789270667,-0.935374050821);}",Ag=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Kh extends c.Kj0{constructor(e,t,n=0){super(e),this.type="Reflector",this.isReflector2=!0,this.enabled=!0,this.reflectorModePhysical=!0,this.reflectionTargetNeedsUpdate=!0,this.transparentReflectionBackground=!0,this.materialExtension={extraUniforms:{tRefDiffuse:{value:null},tRefDiffuseSize:{value:new c.FM8},refTextureMatrix:{value:null},frameCount:{value:0},sceneBoundingRadius:{value:0}},updaters:[],shaderExtender:(j,k,L)=>{if(this.enabled){j.vertexShader=j.vertexShader.replace("void main() {",`void main() {
vRefUv = refTextureMatrix * vec4( position, 1.0 );`);const R="#glMarker beforeModulation";j.fragmentShader=j.fragmentShader.replace(R,`
                    if(roughnessFactor < 0.95) {
                        float d = 0.;//textureProj(tRefDepth, vRefUv).r;
                        // d = min(2., max(0., (d-0.06) * ((7./3.-ior)) * sceneBoundingRadius));
                        vec4 refBaseColor = getReflectionColor(material.roughness, material.roughness * d);
                        // refBaseColor.rgb = vec3(refBaseColor.a);
                        // refBaseColor.a *= 1.0 - clamp(material.roughness * .3, 0., 1.);
                        `+(this.reflectorModePhysical?`
                        #if !defined(SSR_ENABLED) || SSR_ENABLED < 1 
                        vec3 specularColor = EnvironmentBRDF(geometry.normal, geometry.viewDir, material.specularColor.rgb, material.specularF90, material.roughness);
                        #endif
                        reflectedLight.indirectSpecular = mix(vec3(reflectedLight.indirectSpecular), saturate(specularColor.rgb * refBaseColor.rgb), refBaseColor.a);
                        `:`
                        reflectedLight.indirectSpecular = saturate(diffuseColor.rgb * refBaseColor.rgb);
                        diffuseColor.a *= refBaseColor.a;
                        `)+`}
`+R),j.vertexUvs=!0}},parsVertexSnippet:()=>this.enabled?`
		uniform mat4 refTextureMatrix;
		varying vec4 vRefUv;
`:"",parsFragmentSnippet:()=>this.enabled?zA+`
`+Cl+`
#ifndef D_sceneBoundingRadius
#define D_sceneBoundingRadius 
uniform float sceneBoundingRadius;
#endif
varying vec4 vRefUv;uniform sampler2D tRefDiffuse;uniform vec2 tRefDiffuseSize;float getSpecularMIPLevel(const in float roughness,const in float maxMIPLevel){float sigma=PI*roughness*roughness/(1.+roughness);float desiredMIPLevel=maxMIPLevel+log2(sigma);return clamp(desiredMIPLevel,0.,maxMIPLevel);}vec4 getReflectionColor(const in float roughness,const in float depthModifier){float mip=getSpecularMIPLevel(roughness+depthModifier,5.);vec4 color=texture2D(tRefDiffuse,vRefUv.xy/vRefUv.w,mip);float blurDist=saturate(2./(1.+pow(abs(vViewPosition.z),0.25)))*mip*32.*color.a;float rnd=PI2*interleavedGradientNoise(vUv.xy,frameCount);vec4 rotationMatrix=vec4(cos(rnd),-sin(rnd),0.,0.);rotationMatrix.z=-rotationMatrix.y;rotationMatrix.w=rotationMatrix.x;vec3 colorSum=color.rgb*color.a;float weightSum=0.001+color.a;vec2 ofs;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));ofs=vRefUv.xy+vRefUv.w*blurDist*ofs/tRefDiffuseSize.xy;color=texture2D(tRefDiffuse,ofs/vRefUv.w,mip);colorSum+=color.rgb*color.a;weightSum+=color.a;}
#pragma unroll_loop_end
return vec4(colorSum/weightSum,1.);}`:"",computeCacheKey:j=>this.enabled+" "+j.materialObject.transparent+" "+this.reflectorModePhysical+" ",onObjectRender:(j,{materialObject:k})=>{k.userData.__lastTransparent!==k.transparent&&(k.needsUpdate=!0,k.userData.__lastTransparent=k.transparent)},isCompatible:j=>j.isMeshStandardMaterial2},this.material=void 0,this._renderTarget=t;const r=new c.JOQ,o=new c.Pa4,a=new c.Pa4,u=new c.Pa4,p=new c.yGw,f=new c.Pa4(0,0,-1),m=new c.Ltg,y=new c.Pa4,S=new c.Pa4,M=new c.Ltg,P=new c.yGw,D=new c.cPb;c.M8C.isPowerOfTwo(t.texture.image.width)&&c.M8C.isPowerOfTwo(t.texture.image.height)||(this._renderTarget.texture.generateMipmaps=!1),this.onBeforeRender=(j,k,L)=>{if(!this.enabled||!j.userData.mainRenderPass||!this.reflectionTargetNeedsUpdate)return;const R=L.view?Object.assign({},L.view):null;if(R&&L.clearViewOffset&&L.clearViewOffset(),a.setFromMatrixPosition(this.matrixWorld),u.setFromMatrixPosition(L.matrixWorld),p.extractRotation(this.matrixWorld),o.set(0,0,1),o.applyMatrix4(p),y.subVectors(a,u),y.dot(o)>0)return;y.reflect(o).negate(),y.add(a),p.extractRotation(L.matrixWorld),f.set(0,0,-1),f.applyMatrix4(p),f.add(u),S.subVectors(a,f),S.reflect(o).negate(),S.add(a),D.position.copy(y),D.up.set(0,1,0),D.up.applyMatrix4(p),D.up.reflect(o),D.lookAt(S),D.far=2,D.near=0,D.updateMatrixWorld(),D.projectionMatrix.copy(L.projectionMatrix),P.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),P.multiply(D.projectionMatrix),P.multiply(D.matrixWorldInverse),P.multiply(this.matrixWorld),r.setFromNormalAndCoplanarPoint(o,a),r.applyMatrix4(D.matrixWorldInverse),m.set(r.normal.x,r.normal.y,r.normal.z,r.constant);const W=D.projectionMatrix;M.x=(Math.sign(m.x)+W.elements[8])/W.elements[0],M.y=(Math.sign(m.y)+W.elements[9])/W.elements[5],M.z=-1,M.w=(1+W.elements[10])/W.elements[14],m.multiplyScalar(2/m.dot(M)),W.elements[2]=m.x,W.elements[6]=m.y,W.elements[10]=m.z+1-n,W.elements[14]=m.w,this.visible=!1;const q=j.getRenderTarget(),J=j.xr.enabled,ee=j.shadowMap.autoUpdate;j.xr.enabled=!1,j.shadowMap.autoUpdate=!1,j.setRenderTarget(this._renderTarget),j.state.buffers.depth.setMask(!0),j.autoClear===!1&&j.clear();const he=k.background;this.transparentReflectionBackground&&(k.background=null);const xe=!this.transparentReflectionBackground;he&&xe&&(he.userData.flipX=!he.userData.flipX),qt(j,{shadowMapRender:!1,backgroundRender:xe,opaqueRender:!0,transparentRender:!0,transmissionRender:!1,screenSpaceRendering:!1},()=>j.render(k,D)),he&&xe&&(he.userData.flipX=!he.userData.flipX||void 0),this.transparentReflectionBackground&&(k.background=he),j.xr.enabled=J,j.shadowMap.autoUpdate=ee,j.setRenderTarget(q),R!=null&&R.enabled&&L.setViewOffset&&L.setViewOffset(R.fullWidth,R.fullHeight,R.offsetX,R.offsetY,R.width,R.height);const De=L.viewport;De!==void 0&&j.state.viewport(De),this.visible=!0,this.reflectionTargetNeedsUpdate=!1},this.textureMatrix=P,this.materialExtension.extraUniforms.tRefDiffuse.value=this._renderTarget.texture,this.materialExtension.extraUniforms.tRefDiffuseSize.value=new c.FM8(this._renderTarget.width,this._renderTarget.height),this.materialExtension.extraUniforms.refTextureMatrix.value=P}_updateExtension(){var e,t;this.transparentReflectionBackground=this.reflectorModePhysical,(t=(e=this.materialExtension)===null||e===void 0?void 0:e.setDirty)===null||t===void 0||t.call(e)}getRenderTarget(){return this._renderTarget}}Ag([we(Kh.prototype._updateExtension)],Kh.prototype,"enabled",void 0),Ag([we(Kh.prototype._updateExtension)],Kh.prototype,"reflectorModePhysical",void 0),Kh.prototype.isReflector=!0;var Xa=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class Co extends ui{constructor(e={}){super(),this._transformNeedRefresh=!0,this.dependencies=[dn],this.visible=!0,this.size=8,this.yOffset=0,this.renderToDepth=!0,this.tonemapGround=!0,this.limitCameraAboveGround=!1,this._cameraLimitsSet=!1,this._cameraLastMaxPolarAngle=Math.PI,this._refreshMaterial=this._refreshMaterial.bind(this),this._refreshTransform=this._refreshTransform.bind(this),this._refreshCameraLimits=this._refreshCameraLimits.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._refreshOptions2=this._refreshOptions2.bind(this),this._onSceneUpdate=this._onSceneUpdate.bind(this),this._preRender=this._preRender.bind(this),this._postFrame=this._postFrame.bind(this),this._geometry=new c._12(1,1,1,1),this._geometry.attributes.uv2=this._geometry.attributes.uv.clone(),this._geometry.attributes.uv2.needsUpdate=!0,this._options={shape:"",up:[0,100,0],autoAdjustTransform:!0},this.setOptions(e)}get enabled(){return this.visible}set enabled(e){this.visible=e}get material(){return this._material}get mesh(){return this._iMesh}_createMesh(){return new c.Kj0(this._geometry)}async onAdded(e){var t,n;await super.onAdded(e),e.getPluginByType("TweakpaneUi")&&console.error("TweakpaneUiPlugin must be added after Ground Plugin"),this._manager=e.getPlugin(dn);const r=this._createMesh();r.userData.physicsMass=0,this._iMesh=await((t=this._manager)===null||t===void 0?void 0:t.addImportedSingle(r,{pseudoCenter:!1,autoScale:!1,addToRoot:!0})),this._mesh=(n=this._iMesh)===null||n===void 0?void 0:n.modelObject,this._mesh&&(this._mesh.userData.userSelectable=!1,this._mesh.castShadow=!0,this._mesh.receiveShadow=!0,this._mesh.name="Ground Plane"),e.scene.addEventListener("sceneUpdate",this._onSceneUpdate),e.scene.addEventListener("addSceneObject",this._onSceneUpdate),e.addEventListener("preRender",this._preRender),e.addEventListener("postFrame",this._postFrame),this.refreshOptions()}_postFrame(){this._transformNeedRefresh&&this._refreshTransform(),this._viewer}_preRender(){this._viewer}async onDispose(e){var t,n;return this._geometry.dispose(),(n=(t=this._iMesh)===null||t===void 0?void 0:t.dispose)===null||n===void 0||n.call(t),super.onDispose(e)}async onRemove(e){return this._removeMaterial(),e.scene.removeEventListener("sceneUpdate",this._onSceneUpdate),e.scene.removeEventListener("addSceneObject",this._onSceneUpdate),e.removeEventListener("postFrame",this._postFrame),e.removeEventListener("preRender",this._preRender),this._manager=void 0,super.onRemove(e)}_removeMaterial(){var e,t;this._material&&((t=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterial(this._material),this._material.userData.renderToDepth=this._material.userData.__renderToDepth,this._material.userData.__renderToDepth=void 0,this._material=void 0)}_onSceneUpdate(e){e.geometryChanged!==!1&&e.updateGround!==!1&&this.refreshTransform()}refreshTransform(){this._transformNeedRefresh=!0}_refreshOptions2(){this.refreshOptions()}refreshOptions(){this._viewer&&(this._refreshMaterial(),this.refreshTransform(),this._refreshCameraLimits())}_refreshCameraLimits(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.controls;t&&(t.maxPolarAngle!==void 0?this.limitCameraAboveGround?(this._cameraLimitsSet||(this._cameraLastMaxPolarAngle=t.maxPolarAngle),t.maxPolarAngle=Math.PI/2,this._cameraLimitsSet=!0):this._cameraLimitsSet&&(t.maxPolarAngle=this._cameraLastMaxPolarAngle,this._cameraLimitsSet=!1):console.warn("refreshCameraLimits only available with orbit controls."))}_refreshTransform(){var e,t,n;if(!this._mesh||!this._viewer)return;let r=!1;if(this.visible!==this._mesh.visible&&(this._mesh.visible=this.visible,r=!0),this.enabled){if(this._options.autoAdjustTransform){this._mesh.userData.bboxVisible=!1;const o=this._viewer.scene.getBounds(!0);this._mesh.userData.bboxVisible=!0;const a=o.getCenter(new c.Pa4).sub(new c.Pa4(0,o.getSize(new c.Pa4).y/2+this.yOffset,0));r=r||a.clone().sub(this._mesh.position).length()>1e-4,r&&this._mesh.position.copy(a)}r=r||Math.abs(this._mesh.scale.x-this.size)>1e-4,r&&(this._mesh.scale.setScalar(this.size),this._mesh.setRotationFromEuler(new c.USm(-Math.PI/2,0,0)),this._mesh.matrixWorldNeedsUpdate=!0,(n=(t=this._mesh).setDirty)===null||n===void 0||n.call(t)),this._transformNeedRefresh=!1}else r&&((e=this._viewer)===null||e===void 0||e.scene.setDirty())}_refreshMaterial(){var e,t,n,r,o,a,u,p;if(!this._viewer||!this.enabled)return!1;this._manager||console.error("GroundPlugin requires asset manager");const f=(t=(e=this._manager)===null||e===void 0?void 0:e.materials)===null||t===void 0?void 0:t.findOrCreate((r=(n=this._material)===null||n===void 0?void 0:n.uuid)!==null&&r!==void 0?r:"standard",{name:"BaseGroundMaterial",runtimeMaterial:!0,color:16777215});let m=!1;return(f==null?void 0:f.uuid)!==((o=this._material)===null||o===void 0?void 0:o.uuid)&&(this._removeMaterial(),f&&(this._material=f),!((a=this._material)===null||a===void 0)&&a.uuid||console.warn("No material found for ground"),this._viewer.scene.setDirty(),this._mesh&&this._material&&(this._material.roughness=.2,this._material.metalness=.5,((p=(u=this._mesh)===null||u===void 0?void 0:u.setMaterial)!==null&&p!==void 0?p:y=>{this._mesh&&(this._mesh.material=y.materialObject)})(this._material)),m=!0),this._material&&(this._material.userData.__renderToDepth===void 0&&(this._material.userData.__renderToDepth=this._material.userData.renderToDepth),this._material.userData.renderToDepth!==this.renderToDepth&&(this._material.userData.renderToDepth=this.renderToDepth),this._material.userData.__postTonemap===void 0&&(this._material.userData.__postTonemap=this._material.userData.postTonemap),this._material.userData.postTonemap!==this.tonemapGround&&(this._material.userData.postTonemap=this.tonemapGround),this._material.materialObject.userData.ssaoDisabled=!0,this._material.materialObject.userData.sscsDisabled=!0),this._viewer.setDirty(this),m}setOptions(e){Object.assign(this._options,e),this.refreshOptions()}fromJSON(e,t){return super.fromJSON(e,t)?(this.refreshOptions(),this):null}_extraUiConfig(){return[()=>{var e;return(e=this._material)===null||e===void 0?void 0:e.uiConfig}]}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Ground",children:[{label:"Visible",type:"checkbox",property:[this,"visible"],limitedUi:!0},{label:"Size",type:"input",property:[this,"size"],limitedUi:!0},{label:"Render to Depth",type:"checkbox",property:[this,"renderToDepth"]},{label:"Limit Camera",type:"checkbox",property:[this,"limitCameraAboveGround"]},{label:"Tonemap",type:"checkbox",property:[this,"tonemapGround"]},{label:"Height",type:"slider",bounds:[-2,2],property:[this,"yOffset"]},...this._extraUiConfig()]}}}Xa([et("material")],Co.prototype,"_material",void 0),Xa([we(Co.prototype.refreshTransform),et()],Co.prototype,"visible",void 0),Xa([we(Co.prototype._onSceneUpdate),et()],Co.prototype,"size",void 0),Xa([we(Co.prototype._onSceneUpdate),et()],Co.prototype,"yOffset",void 0),Xa([we(Co.prototype._refreshOptions2),et()],Co.prototype,"renderToDepth",void 0),Xa([we(Co.prototype._refreshOptions2),et()],Co.prototype,"tonemapGround",void 0),Xa([we(Co.prototype._refreshCameraLimits),et()],Co.prototype,"limitCameraAboveGround",void 0);var jr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ha extends Co{constructor(e={},t=!1){super(e),this.bakedShadows=!0,this.groundReflection=!1,this.physicalReflections=!1,this._showDebug=t,t&&this.dependencies.push(Pl),this._onSceneUpdate=this._onSceneUpdate.bind(this)}get shadowBaker(){return this._shadowBaker}_createMesh(){const e=new Kh(this._geometry,this._viewer.renderer.createTarget({type:c.ywz,format:c.wk1,encoding:c.rnI,size:{width:1024,height:1024},generateMipmaps:!0,depthBuffer:!0,minFilter:c.D1R,magFilter:c.wem})),t=e.onBeforeRender;return e.onBeforeRender=(...n)=>{var r,o,a,u,p;let f=(o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("SSReflection"))===null||o===void 0?void 0:o.passes.ssr.passObject;f&&!f.enabled&&(f=void 0),f&&(f.enabled=!1);let m=(p=(u=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSBevelPlugin"))===null||u===void 0?void 0:u.pass)===null||p===void 0?void 0:p.passObject;m&&!m.enabled&&(m=void 0),m&&(m.enabled=!1),t(...n),f&&(f.enabled=!0),m&&(m.enabled=!0)},e}async onAdded(e){var t,n;await super.onAdded(e),this._showDebug&&((t=e.getPlugin(Pl))===null||t===void 0||t.addTexture("bake_ground_1",()=>{var r,o;return(o=(r=this._shadowBaker)===null||r===void 0?void 0:r.light.shadow.map)===null||o===void 0?void 0:o.texture},[100,100,200,200]),(n=e.getPlugin(Pl))===null||n===void 0||n.addTexture("bake_ground_2",()=>{var r,o;return(o=(r=this._shadowBaker)===null||r===void 0?void 0:r.target)===null||o===void 0?void 0:o.texture},[100,400,400,400],"texel = vec4(vec3(unpackRGBAToDepth(texel)), 1.0);"))}_postFrame(){var e;super._postFrame(),this._viewer&&this.enabled&&this.bakedShadows&&((e=this._shadowBaker)===null||e===void 0||e.autoUpdateShadow())}_preRender(){super._preRender(),this._viewer&&(this._mesh.reflectionTargetNeedsUpdate=this._viewer.renderer.frameCount<1)}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_removeMaterial(){var e,t,n,r;if(this._material){if(this._shadowBaker&&this._material.groundMatExtension&&((t=(e=this._material).unregisterMaterialExtensions)===null||t===void 0||t.call(e,[this._shadowBaker.materialExtension]),delete this._material.groundMatExtension),this._material.reflectorMatExtension){const o=this._mesh.materialExtension;o||console.warn("unable to find the extension to unregister"),(r=(n=this._material).unregisterMaterialExtensions)===null||r===void 0||r.call(n,[o]),delete this._material.reflectorMatExtension}super._removeMaterial()}}_onSceneUpdate(e){var t;super._onSceneUpdate(e),e.geometryChanged!==!1&&((t=this._shadowBaker)===null||t===void 0||t.reset())}refreshOptions(){if(!this._viewer)return;this.bakedShadows&&!this._shadowBaker?(this._shadowBaker=new Dl(this._viewer),this._shadowBaker.attachedMesh=this._mesh):!this.bakedShadows&&this._shadowBaker&&(this._shadowBaker.reset(),this._shadowBaker.cleanupMaterial());const e=this._mesh;e.isReflector2&&(e.enabled=this.groundReflection,e.reflectorModePhysical=this.physicalReflections),super.refreshOptions(),this._viewer.setDirty(this)}_refreshMaterial(){var e,t,n,r;if(!this._viewer)return!1;const o=super._refreshMaterial();if(!this._material)return o;if(this.groundReflection&&this._mesh.isReflector2&&!this._material.reflectorMatExtension){const a=this._mesh.materialExtension;a.updaters=[this._viewer.scene,this._viewer.renderer],(t=(e=this._material).registerMaterialExtensions)===null||t===void 0||t.call(e,[a]),this._material.reflectorMatExtension=!0}return this.bakedShadows&&this._shadowBaker&&!this._material.groundMatExtension&&((r=(n=this._material).registerMaterialExtensions)===null||r===void 0||r.call(n,[this._shadowBaker.materialExtension]),this._material.groundMatExtension=!0),this._material.materialObject.userData.ssreflDisabled=this.groundReflection,this._material.materialObject.userData.ssreflNonPhysical=!this.physicalReflections,this._viewer.setDirty(this),o}_extraUiConfig(){var e,t,n,r,o,a,u,p,f,m,y,S,M,P,D,j,k,L,R,W,q,J,ee,he,xe,De,Fe,ke,Qe,Oe;return[{label:"Baked Shadows",type:"checkbox",property:[this,"bakedShadows"]},{label:"Shadow Frames",type:"input",hidden:()=>!this._shadowBaker,stepSize:1,bounds:[1,1e3],property:[this._shadowBaker,"maxFrameNumber"]},{label:"Alpha Vignette",type:"checkbox",hidden:()=>!this._material||this._material.transmission<1e-4&&!this._material.transparent,property:[this._shadowBaker,"alphaVignette"],limitedUi:!0,onChange:()=>{var ze,$e;return($e=(ze=this._uiConfig)===null||ze===void 0?void 0:ze.uiRefresh)===null||$e===void 0?void 0:$e.call(ze,"postFrame",!0)}},{label:"Alpha Vignette Axis",type:"dropdown",hidden:()=>{var ze;return!(!((ze=this._shadowBaker)===null||ze===void 0)&&ze.alphaVignette)||!this._material||this._material.transmission<1e-4&&!this._material.transparent},property:[this._shadowBaker,"alphaVignetteAxis"],children:["x","y","xy"].map(ze=>({label:ze,value:ze})),limitedUi:!0},{label:"Planar Reflections",type:"checkbox",property:[this,"groundReflection"],limitedUi:!0},{label:"Physical Reflections",type:"checkbox",property:[this,"physicalReflections"],limitedUi:!0},{label:"Shadow type",type:"dropdown",hidden:()=>!this._shadowBaker,property:[this._shadowBaker,"groundMapMode"],children:[{label:"aoMap"},{label:"map"},{label:"alphaMap"}],limitedUi:!0},{type:"folder",label:"Randomized Light",hidden:()=>!this._shadowBaker,limitedUi:!0,children:[{type:"color",label:"Color",property:[(e=this._shadowBaker)===null||e===void 0?void 0:e.light,"color"]},{type:"slider",label:"Intensity",bounds:[0,100],property:[(t=this._shadowBaker)===null||t===void 0?void 0:t.light,"intensity"]},{type:"checkbox",label:"Shadow Enabled",property:[(r=(n=this._shadowBaker)===null||n===void 0?void 0:n.light)===null||r===void 0?void 0:r.shadowParams,"enabled"],onChange:[(a=(o=this._shadowBaker)===null||o===void 0?void 0:o.light)===null||a===void 0?void 0:a.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(p=(u=this._shadowBaker)===null||u===void 0?void 0:u.light)===null||p===void 0?void 0:p.randomParams,"focus"],onChange:[this._onSceneUpdate]},{type:"slider",bounds:[0,1],property:[(m=(f=this._shadowBaker)===null||f===void 0?void 0:f.light)===null||m===void 0?void 0:m.randomParams,"spread"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,60],property:[(S=(y=this._shadowBaker)===null||y===void 0?void 0:y.light)===null||S===void 0?void 0:S.randomParams,"distanceScale"],onChange:[(P=(M=this._shadowBaker)===null||M===void 0?void 0:M.light)===null||P===void 0?void 0:P.updateShadowParams,this._onSceneUpdate]},{type:"vec3",bounds:[-1,1],property:[(j=(D=this._shadowBaker)===null||D===void 0?void 0:D.light)===null||j===void 0?void 0:j.randomParams,"direction"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"vec3",bounds:[-1,1],property:[(L=(k=this._shadowBaker)===null||k===void 0?void 0:k.light)===null||L===void 0?void 0:L.randomParams,"normalDirection"],onChange:[this._onSceneUpdate],limitedUi:!0},{type:"slider",bounds:[.01,10],property:[(W=(R=this._shadowBaker)===null||R===void 0?void 0:R.light)===null||W===void 0?void 0:W.shadowParams,"radius"],onChange:[(J=(q=this._shadowBaker)===null||q===void 0?void 0:q.light)===null||J===void 0?void 0:J.updateShadowParams,this._onSceneUpdate]},{type:"input",property:[(he=(ee=this._shadowBaker)===null||ee===void 0?void 0:ee.light)===null||he===void 0?void 0:he.shadowParams,"frustumSize"],onChange:[(De=(xe=this._shadowBaker)===null||xe===void 0?void 0:xe.light)===null||De===void 0?void 0:De.updateShadowParams,this._onSceneUpdate]},{type:"slider",bounds:[-.1,.1],property:[(ke=(Fe=this._shadowBaker)===null||Fe===void 0?void 0:Fe.light)===null||ke===void 0?void 0:ke.shadowParams,"bias"],onChange:[(Oe=(Qe=this._shadowBaker)===null||Qe===void 0?void 0:Qe.light)===null||Oe===void 0?void 0:Oe.updateShadowParams,this._onSceneUpdate]}]},...super._extraUiConfig()]}}ha.PluginType="Ground",jr([we(ha.prototype.refreshOptions),et()],ha.prototype,"bakedShadows",void 0),jr([we(ha.prototype.refreshOptions),et()],ha.prototype,"groundReflection",void 0),jr([we(ha.prototype.refreshOptions),et()],ha.prototype,"physicalReflections",void 0),jr([et("shadowBaker")],ha.prototype,"_shadowBaker",void 0);var $u,Ka=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let da=$u=class extends _s{constructor(){super({vertexShader:C.vertexShader,defines:{PASS_STEP:1},uniforms:{tSource:{value:null},tDiffuse:{value:null},opacity:{value:1},tDiffuseSize:{value:new c.FM8},weight:{value:1},tNormalDepth:{value:null}},fragmentShader:Yl+`
uniform float intensity;uniform float opacity;uniform vec2 tDiffuseSize;varying vec2 vUv;uniform float weight;
#if PASS_STEP == 0
uniform vec4 prefilter;vec4 Prefilter(vec4 c){if(getDepth(vUv)>0.999){return vec4(0.);}float brightness=max(c.r,max(c.g,c.b));float soft=brightness+prefilter.x*(prefilter.y-1.);soft=clamp(soft,0.,prefilter.z);soft=soft*soft*prefilter.w;float contribution=max(soft,brightness-prefilter.x);contribution/=max(brightness,0.001);return vec4(c.rgb*contribution,c.a);}
#endif
vec4 Sample(vec2 uv){return tDiffuseTexelToLinear(texture2D(tDiffuse,uv));}vec4 SampleBox(vec2 uv,float delta){vec4 o=vec2(-delta,delta).xxyy/tDiffuseSize.xyxy;vec4 s=Sample(uv+o.xy)+Sample(uv+o.zy)+Sample(uv+o.xw)+Sample(uv+o.zw);return s*0.25;}void main(){
#if PASS_STEP == 0 
gl_FragColor=weight*Prefilter(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 1 
gl_FragColor=weight*(SampleBox(vUv,1.));gl_FragColor.a=1.;
#elif PASS_STEP == 2 
gl_FragColor=(SampleBox(vUv,0.5));gl_FragColor.a=1.;
#elif PASS_STEP == 3 
vec4 texel=tSourceTexelToLinear(texture2D(tSource,vUv));vec4 bloom=intensity*SampleBox(vUv,0.5).rgba;float brightness=max(bloom.r,max(bloom.g,bloom.b));texel.rgb+=bloom.rgb;texel.a=min(1.,texel.a+brightness);gl_FragColor=texel;
#elif PASS_STEP == 4 
vec4 texel=vec4(0.);texel.rgb+=intensity*SampleBox(vUv,0.5).rgb;texel.a=1.;gl_FragColor=texel;
#endif
#include <encodings_fragment>
}`},"tDiffuse","tSource"),this.uiConfig=void 0,this.prefilter=new c.Ltg(2,.5,0,0),this.threshold=2,this.softThreshold=.5,this.intensity=.5,this.bloomIterations=4,this.radius=.6,this.power=1,this.bloomDebug=!1,this._weights=[],this._updateWeights=this._updateWeights.bind(this),this._thresholdsUpdated=this._thresholdsUpdated.bind(this),this._updateWeights(),this._thresholdsUpdated(),this.clear=!0,this.userData={setDirty:()=>{this.setDirty()}}}_thresholdsUpdated(){this.prefilter.x=this.threshold,this.prefilter.y=this.softThreshold,this.prefilter.z=2*this.prefilter.x*this.prefilter.y,this.prefilter.w=.125/(this.uniforms.prefilter.value.z+1e-5)}render(s,e,t,n,r){const o=s.baseRenderer;this.material.defines.PASS_STEP=0,this.clear=!0;const a=t;let u=.5,p=a.width*u,f=a.height*u;const m=[];let y=o.getTempTarget({sizeMultiplier:.5,type:c.cLu});m.push(y);let S=a;this.material.needsUpdate=!0,this.material.uniforms.weight.value=this._weights[0],super.render(s,y,S,n,r),S=y;let M=1;for(;M<this.bloomIterations&&(p/=2,f/=2,u/=2,!(f<2||p<2));M++){y=o.getTempTarget({sizeMultiplier:u,type:c.cLu}),m.push(y),this.material.defines.PASS_STEP=1;let D=this._weights[M];D=this._weights[M-1]!==0?this._weights[M]/this._weights[M-1]:this._weights[M],this.material.uniforms.weight.value=D,this.material.needsUpdate=!0,super.render(s,y,S,n,r),S=y}this.clear=!1;const P=s.autoClear;for(s.autoClear=!1,M-=2;M>=0;M--)y=m[M],m[M]=void 0,this.material.defines.PASS_STEP=2,this.material.transparent=!0,this.material.blending=c.WMw,this.material.needsUpdate=!0,s.autoClear=!1,super.render(s,y,S,n,r),this.material.blending=c.jFi,o.releaseTempTarget(S),S=y;this.clear=!0,s.autoClear=P,s.autoClear=!0,this.bloomDebug?(this.material.defines.PASS_STEP=4,this.material.needsUpdate=!0,super.render(s,e,S,n,r)):(this.uniforms.tSource.value=a.texture,this.material.defines.PASS_STEP=3,this.material.needsUpdate=!0,super.render(s,e,S,n,r),this.uniforms.tSource.value=null),o.releaseTempTarget(S)}_updateWeights(){if(!this._weights)return;const s=Math.max(Math.min(this.radius,1),0),e=1/(this.bloomIterations-1);for(let t=0;t<this.bloomIterations;t++){let n=t*e+.1,r=1.2-n;n=Math.pow(n,this.power),r=Math.pow(r,this.power),this._weights[t]=r*(1-s)+n*s}this.setDirty()}};Ka([be()],da.prototype,"prefilter",void 0),Ka([wn("Threshold",[0,2]),we($u.prototype._thresholdsUpdated),et()],da.prototype,"threshold",void 0),Ka([wn("Soft Threshold",[0,1]),we($u.prototype._thresholdsUpdated),et()],da.prototype,"softThreshold",void 0),Ka([wn("Intensity",[0,3]),et(),be()],da.prototype,"intensity",void 0),Ka([wn("Iterations",[0,7],1),we($u.prototype._updateWeights),et()],da.prototype,"bloomIterations",void 0),Ka([wn("Radius",[0,1],.01),we($u.prototype._updateWeights),et()],da.prototype,"radius",void 0),Ka([wn("Power",[.2,10],.01),we($u.prototype._updateWeights),et()],da.prototype,"power",void 0),Ka([_n("Debug")],da.prototype,"bloomDebug",void 0),da=$u=Ka([Ci("Bloom")],da);class Zu extends xl{constructor(){super(...arguments),this.passId="bloom",this._beforeFilters=["combinedPost","screen"],this._afterFilters=["render","progressive"],this._requiredFilters=["render"]}passCtor(e){return new da}_update(e){var t,n;return(t=e.getPlugin(xr))===null||t===void 0||t.updateShaderProperties((n=this.pass)===null||n===void 0?void 0:n.passObject.material),super._update(e)}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Zu.PluginType="Bloom";var yg=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let pa=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this._defines={ANISOTROPY_DEBUG:!1},this._uniforms={anisotropyFactor:{value:1},anisotropyNoise:{value:1},anisotropyDirection:{value:1},anisotropyDirectionMap:{value:null},frameCount:{value:0}},this.materialExtension={shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!e.materialObject.userData._isAnisotropic)return;const r=(n=e.materialObject.userData)===null||n===void 0?void 0:n._anisotropyDirectionMap,o=Z`
                #include <bsdfs>
                //#if ANISOTROPY_ENABLED
                ${Cl}
                ${`uniform float anisotropyFactor;uniform float anisotropyNoise;
#if ANISOTROPY_TEX_MODE == 0
uniform float anisotropyDirection;
#else
uniform sampler2D anisotropyDirectionMap;
#endif
const float MIN_ROUGHNESS=0.05;float D_GGX_Anisotropy(float at,float ab,float ToH,float BoH,float NoH){float a2=at*ab;highp vec3 d=vec3(ab*ToH,at*BoH,a2*NoH);highp float d2=dot(d,d);float b2=a2/d2;return a2*b2*b2*(1./PI);}float V_GGX_SmithCorrelated_Anisotropy(float at,float ab,float ToV,float BoV,float ToL,float BoL,float NoV,float NoL){float lambdaV=NoL*length(vec3(at*ToV,ab*BoV,NoV));float lambdaL=NoV*length(vec3(at*ToL,ab*BoL,NoL));float v=0.5/(lambdaV+lambdaL);return saturate(v);}vec3 indirectAnisotropyBentNormal(const in vec3 normal,const in vec3 viewDir,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){vec3 aDirection=anisotropyFactor>=0.?anisotropicB:anisotropicT;vec3 aTangent=cross(aDirection,viewDir);vec3 aNormal=cross(aTangent,aDirection);float bendFactor=abs(anisotropyFactor)*saturate(5.*max(roughness,MIN_ROUGHNESS));return normalize(mix(normal,aNormal,bendFactor));}vec3 BRDF_GGX_Anisotropy(const in vec3 lightDir,const in vec3 viewDir,const in vec3 normal,const in vec3 f0,const in float f90,const in float roughness,const in vec3 anisotropicT,const in vec3 anisotropicB){float alpha=pow2(roughness);vec3 halfDir=normalize(lightDir+viewDir);float dotNL=saturate(dot(normal,lightDir));float dotNV=saturate(dot(normal,viewDir));float dotNH=saturate(dot(normal,halfDir));float dotVH=saturate(dot(viewDir,halfDir));float dotTV=dot(anisotropicT,viewDir);float dotBV=dot(anisotropicB,viewDir);float dotTL=dot(anisotropicT,lightDir);float dotBL=dot(anisotropicB,lightDir);float dotTH=dot(anisotropicT,halfDir);float dotBH=dot(anisotropicB,halfDir);float aspect=sqrt(1.-min(1.-MIN_ROUGHNESS,abs(anisotropyFactor)*0.9));if(anisotropyFactor>0.)aspect=1./aspect;float at=roughness*aspect;float ab=roughness/aspect;vec3 F=F_Schlick(f0,f90,dotVH);float V=V_GGX_SmithCorrelated_Anisotropy(at,ab,dotTV,dotBV,dotTL,dotBL,dotNV,dotNL);float D=D_GGX_Anisotropy(at,ab,dotTH,dotBH,dotNH);return F*(V*D);}`}
            `+(r?ft("anisotropyDirectionMap",r,t.capabilities.isWebGL2):"");s.fragmentShader=s.fragmentShader.replace("#include <bsdfs>",o),s.fragmentShader=s.fragmentShader.replace("#include <lights_fragment_begin>",c.WdD.lights_fragment_begin),s.fragmentShader=s.fragmentShader.replace("IncidentLight directLight;",`float rnd=(random2(vUv.xy,frameCount)-0.5)*anisotropyNoise*material.roughness;
#if ANISOTROPY_TEX_MODE < 2
#if ANISOTROPY_TEX_MODE == 0 
float rot=saturate(anisotropyDirection);
#else 
float rot=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).r);
#endif
rot=rot*2.*PI+rnd;vec2 rot2=vec2(sin(rot),cos(rot));
#else 
vec2 rot2=(anisotropyDirectionMapTexelToLinear(texture2D(anisotropyDirectionMap,vUv)).rg*2.-1.)+vec2(rnd,rnd);rot2=normalize(rot2);const float anisoSpecMultiplier=0.25;float matSpecAniso=(length(material.specularColor.rgb))*2.*PI;rot2=mix(rot2,vec2(sin(matSpecAniso),cos(matSpecAniso)),anisoSpecMultiplier);rot2=normalize(rot2);
#endif
vec3 anisotropicT=(tangent*rot2.x+bitangent*rot2.y);anisotropicT=normalize(anisotropicT-normal*dot(anisotropicT,normal));vec3 anisotropicB=normalize(cross(normal,anisotropicT));IncidentLight directLight;`).replaceAll("RE_Direct( directLight, geometry, material, reflectedLight )","RE_Direct( directLight, geometry, material, reflectedLight, anisotropicT, anisotropicB )");const a=c.WdD.lights_physical_pars_fragment.replace("void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {","void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight, const in vec3 anisotropicT, const in vec3 anisotropicB ) {").replace("BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness )","BRDF_GGX_Anisotropy( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness, anisotropicT, anisotropicB )");s.fragmentShader=s.fragmentShader.replace("#include <lights_physical_pars_fragment>",a);const u=Z`
                #if defined( USE_ENVMAP )
                vec3 anisotropyBentNormal = indirectAnisotropyBentNormal(geometry.normal, geometry.viewDir, material.roughness, anisotropicT, anisotropicB);
                #endif
            `+c.WdD.lights_fragment_maps.replace("getIBLIrradiance( geometry.normal )","getIBLIrradiance( anisotropyBentNormal )").replace("getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness )","getIBLRadiance( geometry.viewDir, anisotropyBentNormal, material.roughness )");s.fragmentShader=s.fragmentShader.replace("#include <lights_fragment_maps>",u),s.vertexUvs=!0,s.vertexTangents=!0},onObjectRender:(s,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._isAnisotropic))return;const r=s;if(!r.isMesh||!r.geometry)return;if(!r.geometry.attributes.tangent)throw new Error("No tangents on the geometry");this._uniforms.anisotropyFactor.value=n._anisotropyFactor,this._uniforms.anisotropyNoise.value=n._anisotropyNoise,this._uniforms.anisotropyDirectionMap.value=!((t=n._anisotropyDirectionMap)===null||t===void 0)&&t.isTexture?n._anisotropyDirectionMap:null,this._uniforms.anisotropyDirection.value=n._anisotropyDirection;let o=this.enabled?1:0;e.materialObject.defines.ANISOTROPY_ENABLED!==o&&(e.materialObject.defines.ANISOTROPY_ENABLED=o,e.materialObject.needsUpdate=!0),o=+this._defines.ANISOTROPY_DEBUG,e.materialObject.defines.ANISOTROPY_DEBUG!==o&&(e.materialObject.defines.ANISOTROPY_DEBUG=o,e.materialObject.needsUpdate=!0),o=n._anisotropyDirectionMode,this._uniforms.anisotropyDirectionMap.value||(o="CONSTANT"),o=o==="DIRECTION"?2:o==="ROTATION"?1:0,e.materialObject.defines.ANISOTROPY_TEX_MODE!==o&&(e.materialObject.defines.ANISOTROPY_TEX_MODE=o,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+(!((e=s.materialObject.userData)===null||e===void 0)&&e._isAnisotropic?"1":"0")+((n=(t=s.materialObject.userData)===null||t===void 0?void 0:t._anisotropyDirectionMap)===null||n===void 0?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>{var s;return[(s=this._viewer)===null||s===void 0?void 0:s.renderer]},getUiConfig:s=>{const e=this._viewer,t=this.makeAnisotropic,n={type:"folder",label:"Anisotropy",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._isAnisotropic||!1},set value(r){var o;r!==s.materialObject.userData._isAnisotropic&&(r?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._isAnisotropic=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)===null||o===void 0||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Factor",bounds:[-2,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyFactor"],onChange:this.setDirty},{type:"slider",label:"Noise",bounds:[0,2],hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyNoise"],onChange:this.setDirty},{type:"image",label:"Texture",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},{type:"dropdown",label:"Mode",hidden:()=>!s.materialObject.userData._isAnisotropic,property:[s.materialObject.userData,"_anisotropyDirectionMode"],children:["CONSTANT","ROTATION","DIRECTION"].map(r=>({label:r})),onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}}]};return n}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this.makeSelectedAnisotropic=()=>{var s,e,t;const n=(t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(er))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.makeAnisotropic(n)},this._loaderCreate=this._loaderCreate.bind(this)}makeAnisotropic(s){var e;const t=(e=s.materialObject)===null||e===void 0?void 0:e.userData;if(!t)return!1;if(t._isAnisotropic===void 0){const n=t.__appliedMeshes;let r=!0;if(n)for(const{geometry:o}of n)!o||o.index&&o.attributes.position&&o.attributes.normal&&o.attributes.uv||(r=!1),r&&!o.attributes.tangent&&o.computeTangents();if(!r)return!1}return t._isAnisotropic=!0,t._anisotropyFactor===void 0&&(t._anisotropyFactor=1),t._anisotropyNoise===void 0&&(t._anisotropyNoise=0),t._anisotropyDirectionMode===void 0&&(t._anisotropyDirectionMode="DIRECTION"),s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new bf(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(dn);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(Cv)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};pa.PluginType="AnisotropyPlugin",pa.ANISOTROPY_GLTF_EXTENSION="WEBGI_materials_anisotropy",yg([_n("Enabled",s=>({onChange:s.setDirty})),et()],pa.prototype,"enabled",void 0),yg([Ji("Make Anisotropy",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPlugin(er))}}))],pa.prototype,"makeSelectedAnisotropic",void 0),pa=yg([Ci("Anisotropy Materials")],pa);class bf{constructor(e){this.parser=e,this.name=pa.ANISOTROPY_GLTF_EXTENSION}async extendMaterialParams(e,t){var n,r,o;const a=this.parser,u=a.json.materials[e];if(!u.extensions||!u.extensions[this.name])return Promise.resolve();const p=[],f=u.extensions[this.name];t.userData||(t.userData={}),t.userData._isAnisotropic=!0,t.userData._anisotropyFactor=(n=f.anisotropyFactor)!==null&&n!==void 0?n:0,t.userData._anisotropyNoise=(o=(r=f.anisotropyNoiseFactor)!==null&&r!==void 0?r:f.anisotropyNoise)!==null&&o!==void 0?o:0;let{anisotropyDirectionMode:m,anisotropyDirection:y}=f;return m||(m=f.anisotropyTextureMode),y||(y=f.anisotropyRotation),t.userData._anisotropyDirectionMode=m&&typeof(y==null?void 0:y.index)=="number"?m:"CONSTANT",m==="ROTATION"||m==="DIRECTION"?p.push(a.assignTexture(t.userData,"_anisotropyDirectionMap",y).then(S=>{S.encoding=c.knz})):t.userData._anisotropyDirection=y??0,Promise.all(p)}afterRoot(e){return e.scene.traverse(t=>{var n,r;if(!(!((r=(n=t.material)===null||n===void 0?void 0:n.userData)===null||r===void 0)&&r._isAnisotropic))return;const o=t.geometry;o.attributes.tangent||(o.computeTangents(),o.attributes.tangent.needsUpdate=!0)}),null}}const Cv=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._isAnisotropic||(e.userData._anisotropyFactor||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.anisotropyFactor=e.userData._anisotropyFactor||1,n.anisotropyNoiseFactor=e.userData._anisotropyNoise||0,n.anisotropyDirectionMode=e.userData._anisotropyDirectionMode||"CONSTANT",e.userData._anisotropyDirectionMap&&n.anisotropyDirectionMode!=="CONSTANT"){const r={index:s.processTexture(e.userData._anisotropyDirectionMap)};s.applyTextureTransform(r,e.userData._anisotropyDirectionMap),n.anisotropyDirection=r}else n.anisotropyDirectionMode="CONSTANT",n.anisotropyDirection=e.userData._anisotropyDirection||0;t.extensions[pa.ANISOTROPY_GLTF_EXTENSION]=n,s.extensionsUsed[pa.ANISOTROPY_GLTF_EXTENSION]=!0}});var Rl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ta=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this._defines={},this._uniforms={thinBaseLayerFactors:{value:new c.Ltg},thinNoiseLayerFactors:{value:new c.Ltg},thinColorNoiseParams:{value:new c.Ltg},thinFilmFactor:{value:.8}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm)?Cl+`
#ifndef VORONOISE_HELPER
#define VORONOISE_HELPER 
float voronoise(in vec2 p,float u,float v){float k=1.+63.*pow(1.-v,6.);vec2 i=floor(p);vec2 f=fract(p);vec2 a=vec2(0.,0.);for(int y=-2;y<=2;y++)for(int x=-2;x<=2;x++){vec2 g=vec2(x,y);vec3 o=hash3(i+g)*vec3(u,u,1.);vec2 d=g-f+o.xy;float w=pow(1.-smoothstep(0.,1.414,length(d)),k);a+=vec2(o.z*w,w);}return a.x/a.y;}vec3 voronoise3(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),voronoise(p-vec2(0.83,0.45),u,v));}vec3 voronoiseNormal(vec2 p,float u,float v){return vec3(voronoise(p,u,v),voronoise(p+vec2(0.435,0.23),u,v),1.);}
#endif

#ifndef HSV_HELPERS
#define HSV_HELPERS 
vec3 hsv2rgb(vec3 c){vec4 K=vec4(1.,2./3.,1./3.,3.);vec3 p=abs(fract(c.xxx+K.xyz)*6.-K.www);return c.z*mix(K.xxx,clamp(p-K.xxx,0.,1.),c.y);}vec3 rgb2hsv(vec3 c){vec4 K=vec4(0.,-1./3.,2./3.,-1.);vec4 p=c.g<c.b?vec4(c.bg,K.wz):vec4(c.gb,K.xy);vec4 q=c.r<p.x?vec4(p.xyw,c.r):vec4(c.r,p.yzx);float d=q.x-min(q.w,q.y);float e=1.0e-10;return vec3(abs(q.z+(q.w-q.y)/(6.*d+e)),d/(q.x+e),q.x);}
#endif 

uniform vec4 thinBaseLayerFactors;
uniform vec4 thinNoiseLayerFactors;
uniform vec4 thinColorNoiseParams;
uniform float thinFilmFactor;
        `:""},shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!(!((n=e.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm))return;const r="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(r,"vec3 incident=normalize(vViewPosition.xyz);float hWeight=1.-dot(normal,incident);vec3 noiseV=voronoise3(vUv.xy*thinColorNoiseParams.xy*60.,thinColorNoiseParams.z,thinColorNoiseParams.w);float hWeight2=1.-dot(normalize(noiseV),incident);vec3 film=hsv2rgb(vec3(fract(hWeight+thinBaseLayerFactors.x),thinBaseLayerFactors.y,thinBaseLayerFactors.z))*thinBaseLayerFactors.a;vec3 film2=hsv2rgb(vec3(fract(hWeight2+thinNoiseLayerFactors.x),thinNoiseLayerFactors.y,thinNoiseLayerFactors.z))*thinNoiseLayerFactors.a;film=(film+film2)/(thinBaseLayerFactors.a+thinNoiseLayerFactors.a);diffuseColor.rgb=mix(diffuseColor.rgb,film,thinFilmFactor);"+r),s.vertexUvs=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._thinFilmLayer;if(!(n!=null&&n.hasThinFilm))return;this._uniforms.thinBaseLayerFactors.value.fromArray(n.baseLayerFactors),this._uniforms.thinNoiseLayerFactors.value.fromArray(n.noiseLayerFactors),this._uniforms.thinColorNoiseParams.value.fromArray(n.colorNoiseParams),this._uniforms.thinFilmFactor.value=n.filmFactor;const r=this.enabled?1:0;e.materialObject.defines.THIN_FILM_LAYER_ENABLED!==r&&(e.materialObject.defines.THIN_FILM_LAYER_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._thinFilmLayer)===null||t===void 0)&&t.hasThinFilm?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ThinFilmLayer",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0?void 0:n.hasThinFilm)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._thinFilmLayer)===null||r===void 0?void 0:r.hasThinFilm)&&(n?bg(s.materialObject)||e.alert("Cannot add thin film."):(s.materialObject.userData._thinFilmLayer.hasThinFilm=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,1],label:"Intensity",hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"filmFactor"],onChange:this.setDirty}),()=>({type:"vec4",label:"Base Layer",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"baseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Layer",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"noiseLayerFactors"],onChange:this.setDirty}),()=>({type:"vec4",label:"Noise Params",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._thinFilmLayer)===null||n===void 0)&&n.hasThinFilm)},property:[s.materialObject.userData._thinFilmLayer,"colorNoiseParams"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addThinFilmLayer(s){return bg(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new wf(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(dn);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(bw)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function bg(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._thinFilmLayer||(e._thinFilmLayer={});const t=e._thinFilmLayer;return t.hasThinFilm=!0,t.baseLayerFactors===void 0&&(t.baseLayerFactors=[.3,.6,1,.9]),t.noiseLayerFactors===void 0&&(t.noiseLayerFactors=[.7,.5,.9,.7]),t.colorNoiseParams===void 0&&(t.colorNoiseParams=[.5,.5,.5,.7]),t.filmFactor===void 0&&(t.filmFactor=.3),s.isMaterial&&(s.needsUpdate=!0),!0}Ta.PluginType="ThinFilmLayerPlugin",Ta.THIN_FILM_LAYER_GLTF_EXTENSION="WEBGI_materials_thin_film_layer",Rl([_n("Enabled",s=>({onChange:s.setDirty})),et()],Ta.prototype,"enabled",void 0),Ta=Rl([Ci("ThinFilmLayer Materials")],Ta);class wf{constructor(e){this.parser=e,this.name=Ta.THIN_FILM_LAYER_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),bg(t),t.userData._thinFilmLayer=kt(r,t.userData._thinFilmLayer,!1,{}),Promise.resolve()}}const bw=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._thinFilmLayer||!e.userData._thinFilmLayer.hasThinFilm)return;t.extensions=t.extensions||{};const n=cn(e.userData._thinFilmLayer,!1);t.extensions[Ta.THIN_FILM_LAYER_GLTF_EXTENSION]=n,s.extensionsUsed[Ta.THIN_FILM_LAYER_GLTF_EXTENSION]=!0}});var rp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let co=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this._defines={},this._uniforms={noiseBumpParams:{value:new c.FM8},noiseBumpScale:{value:.05},noiseBumpFlakeScale:{value:1e3},noiseFlakeClamp:{value:1},noiseFlakeRadius:{value:.5},noiseFlakeRoughnessMod:{value:1}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._noiseBumpMat)===null||t===void 0)&&t.hasBump)?Cl+`
#ifndef VORONOI_HELPER
#define VORONOI_HELPER 
float voronoi_distance(vec2 a,vec2 b,float metric){return distance(a,b);}float voronoi_f1_2d(in vec2 coord,in float randomness,in float flakeClamp,in float flakeRadius,inout vec3 outColor){vec2 cellPosition=floor(coord);vec2 localPosition=coord-cellPosition;float minDistance=8.;vec2 targetOffset,targetPosition;for(int j=-1;j<=1;j++){for(int i=-1;i<=1;i++){vec2 cellOffset=vec2(i,j);vec2 pointPosition=cellOffset+hash3(cellPosition+cellOffset).xy*randomness;float distanceToPoint=voronoi_distance(pointPosition,localPosition,1.);if(distanceToPoint<minDistance){targetOffset=cellOffset;minDistance=distanceToPoint;targetPosition=pointPosition;}}}float outDistance=minDistance;float dist=step(flakeRadius,outDistance);outColor=hash3(cellPosition+hash3(cellPosition+targetOffset).xy*randomness+targetOffset);vec3 outColor1=minDistance<flakeRadius?outColor:vec3(0.5,0.5,1.);outDistance=mix(dist,minDistance,flakeClamp);outColor=mix(outColor1,outColor,flakeClamp);return outDistance;}
#endif

uniform vec2 noiseBumpParams;uniform float noiseBumpScale;uniform float noiseBumpFlakeScale;uniform float noiseFlakeClamp;uniform float noiseFlakeRadius;uniform float noiseFlakeRoughnessMod;vec3 perturbNormalArb_nb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
`:""},shaderExtender:(s,e,t)=>{var n;if(!this.enabled||!(!((n=e.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump))return;const r="#glMarker beforeAccumulation";s.fragmentShader=s.fragmentShader.replace(r,`
            vec3 outColor; 
            float voronoiDist = clamp(voronoi_f1_2d( noiseBumpFlakeScale * noiseBumpParams.xy * vUv, 1., noiseFlakeClamp, noiseFlakeRadius, outColor ), 0.0, 1.0);
            normal = perturbNormalArb_nb( - vViewPosition, normal, (2. * outColor.xy - 1.) * noiseBumpScale, faceDirection ); 
            float avg = (outColor.r + outColor.g)*0.5; 
            diffuseColor *= (clamp(avg+0.5, 0.3, 1.));
            float roughnessModifier = mix(1. - avg, 1., noiseFlakeRoughnessMod);
            roughnessFactor *= roughnessModifier;
            
`+r),s.vertexUvs=!0,s.extensionDerivatives=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._noiseBumpMat;if(!(n!=null&&n.hasBump))return;this._uniforms.noiseBumpParams.value.fromArray(n.bumpNoiseParams),this._uniforms.noiseBumpScale.value=n.bumpScale,this._uniforms.noiseBumpFlakeScale.value=n.flakeScale,this._uniforms.noiseFlakeClamp.value=n.flakeClamp,this._uniforms.noiseFlakeRadius.value=n.flakeRadius,this._uniforms.noiseFlakeRoughnessMod.value=n.flakeRoughnessMod;const r=this.enabled?1:0;e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED!==r&&(e.materialObject.defines.NOISE_BUMP_MATERIAL_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._noiseBumpMat)===null||t===void 0)&&t.hasBump?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"NoiseBumpMaterial",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0?void 0:n.hasBump)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._noiseBumpMat)===null||r===void 0?void 0:r.hasBump)&&(n?Jh(s.materialObject)||e.alert("Cannot add noise bump."):(s.materialObject.userData._noiseBumpMat.hasBump=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"vec4",label:"Bump Noise Params",bounds:[0,1],hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpNoiseParams"],onChange:this.setDirty}),()=>({type:"slider",label:"Bump Scale",bounds:[0,.01],stepSize:1e-5,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"bumpScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Scale",bounds:[100,1e4],stepSize:1e-4,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeScale"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Clamp",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeClamp"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Radius",bounds:[.1,1],stepSize:.01,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeRadius"],onChange:this.setDirty}),()=>({type:"slider",label:"Flake Roughness Modifier",bounds:[0,1],stepSize:1,hidden:()=>{var n;return!(!((n=s.materialObject.userData._noiseBumpMat)===null||n===void 0)&&n.hasBump)},property:[s.materialObject.userData._noiseBumpMat,"flakeRoughnessMod"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addNoiseBumpMaterial(s){return Jh(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new xf(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(dn);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(sp)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function Jh(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._noiseBumpMat||(e._noiseBumpMat={});const t=e._noiseBumpMat;return t.hasBump=!0,t.bumpNoiseParams===void 0&&(t.bumpNoiseParams=[.5,.5]),t.bumpScale===void 0&&(t.bumpScale=.05),t.flakeScale===void 0&&(t.flakeScale=.05),t.flakeClamp===void 0&&(t.flakeClamp=1),t.flakeRadius===void 0&&(t.flakeRadius=.3),t.flakeRoughnessMod===void 0&&(t.flakeRoughnessMod=1),s.isMaterial&&(s.needsUpdate=!0),!0}co.PluginType="NoiseBumpMaterialPlugin",co.NOISE_BUMP_MATERIAL_GLTF_EXTENSION="WEBGI_materials_noise_bump",rp([_n("Enabled",s=>({onChange:s.setDirty})),et()],co.prototype,"enabled",void 0),co=rp([Ci("NoiseBumpMaterial Materials")],co);class xf{constructor(e){this.parser=e,this.name=co.NOISE_BUMP_MATERIAL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),Jh(t),t.userData._noiseBumpMat=kt(r,t.userData._noiseBumpMat,!1,{}),Promise.resolve()}}const sp=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._noiseBumpMat||!e.userData._noiseBumpMat.hasBump)return;t.extensions=t.extensions||{};const n=cn(e.userData._noiseBumpMat,!1);t.extensions[co.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=n,s.extensionsUsed[co.NOISE_BUMP_MATERIAL_GLTF_EXTENSION]=!0}});var $h,eh=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let $s=$h=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this.bicubicFiltering=!0,this._defines={CUSTOM_BUMP_MAP_DEBUG:!1,CUSTOM_BUMP_MAP_BICUBIC:!0},this._uniforms={customBumpUvTransform:{value:new c.Vkp},customBumpScale:{value:.001},customBumpMap:{value:null}},this.materialExtension={parsFragmentSnippet:(s,e)=>this.enabled&&(e!=null&&e.materialObject.userData._hasCustomBump)?`#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
#if CUSTOM_BUMP_MAP_BICUBIC > 0  
vec4 cubic(float v){vec4 n=vec4(1.,2.,3.,4.)-v;vec4 s=n*n*n;float x=s.x;float y=s.y-4.*s.x;float z=s.z-4.*s.y+6.*s.x;float w=6.-x-y-z;return vec4(x,y,z,w)*(1./6.);}vec4 textureBicubic(sampler2D sampler,vec2 texCoords){vec2 texSize=vec2(textureSize(sampler,0));vec2 invTexSize=1./texSize;texCoords=texCoords*texSize-0.5;vec2 fxy=fract(texCoords);texCoords-=fxy;vec4 xcubic=cubic(fxy.x);vec4 ycubic=cubic(fxy.y);vec4 c=texCoords.xxyy+vec2(-0.5,+1.5).xyxy;vec4 s=vec4(xcubic.xz+xcubic.yw,ycubic.xz+ycubic.yw);vec4 offset=c+vec4(xcubic.yw,ycubic.yw)/s;offset*=invTexSize.xxyy;vec4 sample0=texture(sampler,offset.xz);vec4 sample1=texture(sampler,offset.yz);vec4 sample2=texture(sampler,offset.xw);vec4 sample3=texture(sampler,offset.yw);float sx=s.x/(s.x+s.y);float sy=s.z/(s.z+s.w);return mix(mix(sample3,sample2,sx),mix(sample1,sample0,sx),sy);}
#endif
varying vec2 vCustomBumpUv;uniform sampler2D customBumpMap;uniform float customBumpScale;vec2 dHdxy_fwd_cb(){vec2 dSTdx=dFdx(vCustomBumpUv);vec2 dSTdy=dFdy(vCustomBumpUv);
#if CUSTOM_BUMP_MAP_BICUBIC > 0
float Hll=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*textureBicubic(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#else
float Hll=customBumpScale*texture2D(customBumpMap,vCustomBumpUv).x;float dBx=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdx).x-Hll;float dBy=customBumpScale*texture2D(customBumpMap,vCustomBumpUv+dSTdy).x-Hll;
#endif
return vec2(dBx,dBy);}
#ifndef USE_BUMPMAP
vec3 perturbNormalArb(vec3 surf_pos,vec3 surf_norm,vec2 dHdxy,float faceDirection){vec3 vSigmaX=dFdx(surf_pos.xyz);vec3 vSigmaY=dFdy(surf_pos.xyz);vec3 vN=surf_norm;vec3 R1=cross(vSigmaY,vN);vec3 R2=cross(vN,vSigmaX);float fDet=dot(vSigmaX,R1)*faceDirection;vec3 vGrad=sign(fDet)*(dHdxy.x*R1+dHdxy.y*R2);return normalize(abs(fDet)*surf_norm-vGrad);}
#endif
#endif
`:"",shaderExtender:(s,e,t)=>{var n;this.enabled&&e.materialObject.userData._hasCustomBump&&(!((n=e.materialObject.userData)===null||n===void 0)&&n._customBumpMap)&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker beforeAccumulation",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
    normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd_cb(), faceDirection );
#endif
                `,{prepend:!0}),s.vertexShader=Lr(s.vertexShader,"#include <uv_pars_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                varying vec2 vCustomBumpUv;
                uniform mat3 customBumpUvTransform;
#endif
                `,{prepend:!0}),s.vertexShader=Lr(s.vertexShader,"#include <uv_vertex>",`
#if defined(CUSTOM_BUMP_MAP_ENABLED) && CUSTOM_BUMP_MAP_ENABLED > 0
                vCustomBumpUv = ( customBumpUvTransform * vec3( uv, 1 ) ).xy;
#endif
                `,{prepend:!0}),s.vertexUvs=!0)},onObjectRender:(s,e)=>{var t;const n=e.materialObject.userData;if(!(n!=null&&n._hasCustomBump))return;const r=s;if(!r.isMesh||!r.geometry)return;const o=!((t=n._customBumpMap)===null||t===void 0)&&t.isTexture?n._customBumpMap:null;this._uniforms.customBumpMap.value=o,this._uniforms.customBumpScale.value=o?n._customBumpScale:0,o&&(o.updateMatrix(),this._uniforms.customBumpUvTransform.value.copy(o.matrix));let a=this.enabled&&o?1:0;e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_ENABLED=a,e.materialObject.needsUpdate=!0),a=+this._defines.CUSTOM_BUMP_MAP_DEBUG,e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_DEBUG=a,e.materialObject.needsUpdate=!0),a=+this._defines.CUSTOM_BUMP_MAP_BICUBIC,e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC!==a&&(e.materialObject.defines.CUSTOM_BUMP_MAP_BICUBIC=a,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t,n;return(this.enabled?"1":"0")+(!((e=s.materialObject.userData)===null||e===void 0)&&e._hasCustomBump?"1":"0")+((n=(t=s.materialObject.userData)===null||t===void 0?void 0:t._customBumpMap)===null||n===void 0?void 0:n.uuid)},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t=this.enableCustomBump,n={type:"folder",label:"CustomBumpMap",children:[{type:"checkbox",label:"Enabled",get value(){return s.materialObject.userData._hasCustomBump||!1},set value(r){var o;r!==s.materialObject.userData._hasCustomBump&&(r?t(s)||e.alert("One or more geometries cannot be made anisotropic."):(s.materialObject.userData._hasCustomBump=!1,s.materialObject.needsUpdate=!0),(o=n.uiRefresh)===null||o===void 0||o.call(n,"postFrame",!0))},onChange:this.setDirty},{type:"slider",label:"Bump Scale",hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpScale"],onChange:this.setDirty},{type:"image",label:"Bump Map",hidden:()=>!s.materialObject.userData._hasCustomBump,property:[s.materialObject.userData,"_customBumpMap"],onChange:()=>{s.materialObject.needsUpdate=!0,this.setDirty()}},Ui(s.materialObject.userData,"_customBumpMap")]};return n}},this.setDirty=()=>{var s,e,t;(e=(s=this.materialExtension).setDirty)===null||e===void 0||e.call(s),(t=this._viewer)===null||t===void 0||t.setDirty()},this.enableCustomBumpSelected=()=>{var s,e,t;const n=(t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(er))===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material;return(n==null?void 0:n.assetType)==="material"&&this.enableCustomBump(n)},this._loaderCreate=this._loaderCreate.bind(this)}enableCustomBump(s,e,t){var n,r;const o=(n=s.materialObject)===null||n===void 0?void 0:n.userData;if(!o)return!1;if(o._hasCustomBump===void 0){const a=o.__appliedMeshes;let u=!0;if(a)for(const{geometry:p}of a)!p||p.attributes.position&&p.attributes.normal&&p.attributes.uv||(u=!1);if(!u)return!1}return o._hasCustomBump=!0,o._customBumpScale=(r=t??o._customBumpScale)!==null&&r!==void 0?r:.001,o._customBumpMap=e??o._customBumpMap,s.materialObject.needsUpdate=!0,!0}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new Ef(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(dn);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(VA)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};$s.PluginType="CustomBumpMapPlugin",$s.CUSTOM_BUMP_MAP_GLTF_EXTENSION="WEBGI_materials_custom_bump_map",eh([_n("Enabled",s=>({onChange:s.setDirty})),et()],$s.prototype,"enabled",void 0),eh([_n("Bicubic",s=>({onChange:s.setDirty})),Xe("CUSTOM_BUMP_MAP_BICUBIC",void 0,!0,$h.prototype.setDirty),et()],$s.prototype,"bicubicFiltering",void 0),eh([Ji("Enable CustomBumpMap",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPlugin(er))}}))],$s.prototype,"enableCustomBumpSelected",void 0),$s=$h=eh([Ci("CustomBumpMap Materials")],$s);class Ef{constructor(e){this.parser=e,this.name=$s.CUSTOM_BUMP_MAP_GLTF_EXTENSION}async extendMaterialParams(e,t){var n;const r=this.parser,o=r.json.materials[e];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],u=o.extensions[this.name];t.userData||(t.userData={}),t.userData._hasCustomBump=!0,t.userData._customBumpScale=(n=u.customBumpScale)!==null&&n!==void 0?n:0;const p=u.customBumpMap;return p&&a.push(r.assignTexture(t.userData,"_customBumpMap",p).then(f=>{f.encoding=c.knz})),Promise.all(a)}}const VA=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._hasCustomBump||(e.userData._customBumpScale||0)<.001)return;t.extensions=t.extensions||{};const n={};if(n.customBumpScale=e.userData._customBumpScale||1,e.userData._customBumpMap){const r={index:s.processTexture(e.userData._customBumpMap)};s.applyTextureTransform(r,e.userData._customBumpMap),n.customBumpMap=r}t.extensions[$s.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=n,s.extensionsUsed[$s.CUSTOM_BUMP_MAP_GLTF_EXTENSION]=!0}});var Mv=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Ja=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this._defines={},this._uniforms={ccTintColor:{value:new Sn},ccThickness:{value:0},ccIor:{value:0}},this.materialExtension={parsFragmentSnippet:(s,e)=>{var t;return this.enabled&&(!((t=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||t===void 0)&&t.enableTint)&&e.materialObject.clearcoat>0?`
uniform vec3 ccTintColor;
uniform float ccThickness;
uniform float ccIor;
vec3 clearcoatTint(const in float dotNV, const in float dotNL, const in float clearcoat) {
    vec3 tint = ( ccThickness > 0. ? 1. - ccTintColor : ccTintColor); // Set thickness < 0 for glow.
    tint = exp(tint * -(ccThickness * ((dotNL + dotNV) / max(dotNL * dotNV, 1e-3)))); // beer's law
    return mix(vec3(1.0), tint, clearcoat);
}
        `:""},shaderExtender:(s,e,t)=>{var n;if(!(this.enabled&&(!((n=e==null?void 0:e.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)&&e.materialObject.clearcoat>0))return;const r="outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;",o="float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );";s.fragmentShader.includes(o)&&s.fragmentShader.includes(r)||console.error("ClearcoatTintPlugin: shaderExtender cannot patch shader, version changed?"),s.fragmentShader=s.fragmentShader.replace(o,`
            float dotNVcc = saturate( dot( geometry.clearcoatNormal, -refract(geometry.viewDir, geometry.clearcoatNormal, 1./ccIor) ) );
            `),s.fragmentShader=s.fragmentShader.replace(r,`
            outgoingLight *= clearcoatTint(dotNVcc, dotNVcc, material.clearcoat);
            `+r),s.vertexUvs=!0},onObjectRender:(s,e)=>{var t;const n=(t=e.materialObject.userData)===null||t===void 0?void 0:t._clearcoatTint;if(!(n!=null&&n.enableTint))return;this._uniforms.ccTintColor.value.set(n.tintColor),this._uniforms.ccThickness.value=n.thickness,this._uniforms.ccIor.value=n.ior;const r=this.enabled?1:0;e.materialObject.defines.CLEARCOAT_TINT_ENABLED!==r&&(e.materialObject.defines.CLEARCOAT_TINT_ENABLED=r,e.materialObject.needsUpdate=!0)},extraUniforms:{...this._uniforms},computeCacheKey:s=>{var e,t;return(this.enabled?"1":"0")+(!((t=(e=s.materialObject.userData)===null||e===void 0?void 0:e._clearcoatTint)===null||t===void 0)&&t.enableTint?"1":"0")+(s.materialObject.clearcoat>0?"1":"0")},isCompatible:s=>s.isMeshStandardMaterial2,updaters:()=>[],getUiConfig:s=>{const e=this._viewer,t={type:"folder",label:"ClearcoatTint",children:[{type:"checkbox",label:"Enabled",get value(){var n;return((n=s.materialObject.userData._clearcoatTint)===null||n===void 0?void 0:n.enableTint)||!1},set value(n){var r,o;n!==((r=s.materialObject.userData._clearcoatTint)===null||r===void 0?void 0:r.enableTint)&&(n?wg(s.materialObject)||e.alert("Cannot add clearcoat tint."):(s.materialObject.userData._clearcoatTint.enableTint=!1,s.materialObject.needsUpdate=!0),(o=t.uiRefresh)===null||o===void 0||o.call(t,"postFrame",!0))},onChange:this.setDirty},()=>({type:"color",label:"Tint color",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"tintColor"],onChange:this.setDirty}),()=>({type:"input",label:"Thickness",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"thickness"],onChange:this.setDirty}),()=>({type:"slider",bounds:[.8,2.5],label:"IOR",hidden:()=>{var n;return!(!((n=s.materialObject.userData._clearcoatTint)===null||n===void 0)&&n.enableTint)},property:[s.materialObject.userData._clearcoatTint,"ior"],onChange:this.setDirty})]};return t}},this.setDirty=()=>{var s;(s=this._viewer)===null||s===void 0||s.setDirty()},this._loaderCreate=this._loaderCreate.bind(this)}addClearcoatTint(s){return wg(s.materialObject)}_loaderCreate({loader:s}){s.isGLTFLoader2&&s.register(e=>new GA(e))}async onAdded(s){var e,t,n,r,o;await super.onAdded(s);const a=s.getPlugin(dn);(e=a==null?void 0:a.materials)===null||e===void 0||e.registerMaterialExtension(this.materialExtension),(t=a==null?void 0:a.importer)===null||t===void 0||t.addEventListener("loaderCreate",this._loaderCreate),(o=(r=(n=a==null?void 0:a.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(Tv)}async onRemove(s){var e,t,n,r;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),(r=(n=s.getPlugin(dn))===null||n===void 0?void 0:n.importer)===null||r===void 0||r.removeEventListener("loaderCreate",this._loaderCreate),super.onRemove(s)}};function wg(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._clearcoatTint||(e._clearcoatTint={});const t=e._clearcoatTint;return t.enableTint=!0,t.tintColor===void 0&&(t.tintColor=16777215),t.thickness===void 0&&(t.thickness=.1),t.ior===void 0&&(t.ior=1.5),s.isMaterial&&(s.needsUpdate=!0),!0}Ja.PluginType="ClearcoatTintPlugin",Ja.CLEARCOAT_TINT_GLTF_EXTENSION="WEBGI_materials_clearcoat_tint",Mv([_n("Enabled",s=>({onChange:s.setDirty})),et()],Ja.prototype,"enabled",void 0),Ja=Mv([Ci("ClearcoatTint Materials")],Ja);class GA{constructor(e){this.parser=e,this.name=Ja.CLEARCOAT_TINT_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),wg(t),t.userData._clearcoatTint=kt(r,t.userData._clearcoatTint,!1,{}),Promise.resolve()}}const Tv=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._clearcoatTint||!e.userData._clearcoatTint.enableTint)return;t.extensions=t.extensions||{};const n=cn(e.userData._clearcoatTint,!1);t.extensions[Ja.CLEARCOAT_TINT_GLTF_EXTENSION]=n,s.extensionsUsed[Ja.CLEARCOAT_TINT_GLTF_EXTENSION]=!0}});var Iv=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let Sf=class extends or{constructor(s,e,t){super(s,e,t??new QA,new Sn(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,r){if(!this.enabled)return;const o=this.overrideMaterial;o.uniforms.currentProjectionViewMatrix.value.copy(this.camera.projectionMatrix).multiply(this.camera.matrixWorldInverse),this._firstCall&&(o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value),this._firstCall=!1),super.render(s,e,t,n,r),o.uniforms.lastProjectionViewMatrix.value.copy(o.uniforms.currentProjectionViewMatrix.value)}};Iv([_n("Enabled")],Sf.prototype,"enabled",void 0),Sf=Iv([Ci("Velocity Buffer (TAA)")],Sf);class QA extends c.jyz{constructor(){super({vertexShader:`#ifdef USE_ALPHAMAP
#define USE_UV 
#endif
#include <uv_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 modelMatrixPrevious;void main(){
#include <uv_vertex>
#include <skinbase_vertex>
#include <begin_vertex>
#include <morphtarget_vertex>
#include <skinning_vertex>
#include <displacementmap_vertex>
vec4 mvPosition=vec4(transformed,1.);
#ifdef USE_INSTANCING
mvPosition=instanceMatrix*mvPosition;
#endif
vWorldPosition=(modelMatrix*mvPosition).xyz;vWorldPositionPrevious=(modelMatrixPrevious*mvPosition).xyz;mvPosition=modelViewMatrix*mvPosition;gl_Position=projectionMatrix*mvPosition;
#include <logdepthbuf_vertex>
#include <clipping_planes_vertex>
}`,fragmentShader:"varying vec3 vWorldPosition;varying vec3 vWorldPositionPrevious;uniform mat4 currentProjectionViewMatrix;uniform mat4 lastProjectionViewMatrix;vec2 computeScreenSpaceVelocity2(){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(vWorldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(vWorldPositionPrevious,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}void main(){vec2 velocity=clamp(computeScreenSpaceVelocity2(),-1.,1.);velocity=sign(velocity)*pow(abs(velocity),vec2(1./4.));velocity=velocity*0.5+0.5;gl_FragColor=vec4(velocity.x,velocity.y,1.,1.);}",uniforms:{cameraNearFar:{value:new c.FM8(.1,1e3)},alphaMap:{value:null},alphaTest:{value:null},currentProjectionViewMatrix:{value:new c.yGw},lastProjectionViewMatrix:{value:new c.yGw}}}),this.extraUniformsToUpload={modelMatrixPrevious:{value:new c.yGw().identity()}},this._previousWorldMatrices={}}onBeforeRender(e,t,n,r,o){var a,u;const p=this._previousWorldMatrices[o.uuid];this.extraUniformsToUpload.modelMatrixPrevious.value.copy(p??o.matrixWorld),p?p.copy(o.matrixWorld):this._previousWorldMatrices[o.uuid]=o.matrixWorld.clone();let f=o.material;Array.isArray(f)&&(f=f[0]),this.uniforms.alphaMap.value=(a=f==null?void 0:f.alphaMap)!==null&&a!==void 0?a:null,this.uniforms.alphaTest.value=!f||!f.alphaTest||f.alphaTest<1e-7?.001:f.alphaTest;let m=this.uniforms.alphaMap.value?1:void 0;m!==this.defines.USE_ALPHAMAP&&(m===void 0?delete this.defines.USE_ALPHAMAP:this.defines.USE_ALPHAMAP=m,this.needsUpdate=!0),m=f.userData.ALPHA_I_RGBA_PACKING?1:void 0,m!==this.defines.ALPHA_I_RGBA_PACKING&&(m===void 0?delete this.defines.ALPHA_I_RGBA_PACKING:this.defines.ALPHA_I_RGBA_PACKING=m,this.needsUpdate=!0),this.side=(u=f.side)!==null&&u!==void 0?u:c.ehD}}class Cf extends xl{constructor(e=!0){super(),this.passId="velocityBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this._velocityBuffers=[],this.enabled=e}passCtor(e){const t=e.renderer.createTarget({depthBuffer:!0,type:c.ywz});t.texture.name="velocityBuffer",this._velocityBuffers.push(t),e.getPluginByType("debug");const n=new Set,r=new Set;return new class extends Sf{render(o,a,u,p,f){if(e.renderer.frameCount>0)return;const m=o.getRenderTarget(),y=o.getActiveCubeFace(),S=o.getActiveMipmapLevel();this.scene.traverse(({material:M})=>{M&&((M.transparent&&M.userData.renderToDepth||!M.transparent&&M.transmission===0&&M.userData.renderToDepth===!1)&&(n.add(M),M.transparent=!M.transparent),Math.abs(M.transmission||0)>0&&M.userData.renderToDepth&&(r.add([M,M.transmission]),M.transmission=0))}),qt(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,p,f)),n.forEach(M=>M.transparent=!M.transparent),n.clear(),r.forEach(([M,P])=>M.transmission=P),r.clear(),o.setRenderTarget(m,y,S)}}}_update(e){if(!super._update(e)||e.renderer.frameCount>0)return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,e.scene.activeCamera.updateShaderProperties(t.overrideMaterial),t.camera=e.scene.activeCamera.cameraObject,!0}getVelocityBuffer(){return this._velocityBuffers.length>0?this._velocityBuffers[0]:void 0}async onDispose(e){}async onRemove(e){return this._velocityBuffers.forEach(t=>{var n;return e.renderer.disposeTarget((n=t==null?void 0:t.dispose)===null||n===void 0?void 0:n.call(t))}),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tVelocity?e.uniforms.tVelocity.value=this.enabled&&(n=(t=this.getVelocityBuffer())===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:null:console.warn("BaseRenderer: no uniform: tVelocity"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Cf.PluginType="VelocityBuffer";class Pv extends _s{constructor(e,t){super({vertexShader:C.vertexShader,fragmentShader:t+`
`+Kp+`
#include <common>
varying vec2 vUv;uniform vec2 previousRTSize;uniform mat4 lastProjectionViewMatrix;uniform mat4 currentProjectionViewMatrix;uniform mat4 inverseViewMatrix;uniform vec2 jitterSample;uniform vec2 feedBack;uniform bool firstFrame;
#if HAS_VELOCITY_BUFFER == 1
uniform sampler2D tVelocity;
#endif
vec3 find_closest_fragment_3x3(const in vec2 uv){const vec3 offset=vec3(-1.,1.,0.);vec2 texelSize=1./previousRTSize;vec3 dtr=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtc=vec3(0,1,getDepth(uv+offset.zx*texelSize));vec3 dtl=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dml=vec3(-1,0,getDepth(uv+offset.yz*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dmr=vec3(1,0,getDepth(uv+offset.xz*texelSize));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbc=vec3(0,-1,getDepth(uv+offset.zy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtc.z)dmin=dtc;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dml.z)dmin=dml;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dmr.z)dmin=dmr;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbc.z)dmin=dbc;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+texelSize.xy*dmin.xy,dmin.z);}vec3 find_closest_fragment_5tap(const in vec2 uv){vec2 texelSize=1./previousRTSize;vec2 offset=vec2(1.,-1.);vec3 dtl=vec3(-1,1,getDepth(uv+offset.yx*texelSize));vec3 dtr=vec3(1,1,getDepth(uv+offset.xx*texelSize));vec3 dmc=vec3(0,0,getDepth(uv));vec3 dbl=vec3(-1,-1,getDepth(uv+offset.yy*texelSize));vec3 dbr=vec3(1,-1,getDepth(uv+offset.xy*texelSize));vec3 dmin=dtl;if(dmin.z>dtr.z)dmin=dtr;if(dmin.z>dmc.z)dmin=dmc;if(dmin.z>dbl.z)dmin=dbl;if(dmin.z>dbr.z)dmin=dbr;return vec3(uv+dmin.xy*texelSize,dmin.z);}vec4 clip_aabb(const in vec4 aabb_min,const in vec4 aabb_max,vec4 p){const float FLT_EPS=1e-8;vec4 p_clip=0.5*(aabb_max+aabb_min);vec4 e_clip=0.5*(aabb_max-aabb_min)+FLT_EPS;vec4 v_clip=p-p_clip;vec4 v_unit=abs(v_clip/e_clip);float ma_unit=max(v_unit.x,max(v_unit.y,v_unit.z));if(ma_unit>1.)return p_clip+v_clip/ma_unit;else return p;}
#if HAS_VELOCITY_BUFFER == 0
vec2 computeScreenSpaceVelocity(const in vec3 worldPosition){vec4 currentPositionClip=currentProjectionViewMatrix*vec4(worldPosition,1.);vec4 prevPositionClip=lastProjectionViewMatrix*vec4(worldPosition,1.);vec2 currentPositionNDC=currentPositionClip.xy/currentPositionClip.w;vec2 prevPositionNDC=prevPositionClip.xy/prevPositionClip.w;if(prevPositionNDC.x>=1.||prevPositionNDC.x<=-1.||prevPositionNDC.x>=1.||prevPositionNDC.y<=-1.){return vec2(0.);}return 0.5*(currentPositionNDC-prevPositionNDC);}
#endif
vec4 computeTAA(const in vec2 uv,const in vec2 screenSpaceVelocity){vec2 jitterOffset=jitterSample/previousRTSize;vec2 uvUnJitter=uv;vec4 currentColor=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter));vec4 previousColor=previousRTTexelToLinear(texture2D(previousRT,uv-screenSpaceVelocity));const vec3 offset=vec3(1.,-1.,0.);vec2 texelSize=1./previousRTSize;float texelSpeed=length(screenSpaceVelocity);vec4 tl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yx*texelSize));vec4 tc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zx*texelSize));vec4 tr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xx*texelSize));vec4 ml=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yz*texelSize));vec4 mc=currentColor;vec4 mr=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xz*texelSize));vec4 bl=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.yy*texelSize));vec4 bc=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.zy*texelSize));vec4 br=currentRTTexelToLinear(texture2D(currentRT,uvUnJitter+offset.xy*texelSize));vec4 corners=2.*(tr+bl+br+tl)-2.*mc;mc+=(mc-(corners*0.166667))*2.718282*0.3;mc=max(vec4(0.),mc);vec4 min5=min(tc,min(ml,min(mc,min(mr,bc))));vec4 max5=max(tc,max(ml,max(mc,max(mr,bc))));vec4 cmin=min(min5,min(tl,min(tr,min(bl,br))));vec4 cmax=max(min5,max(tl,max(tr,max(bl,br))));;cmin=0.5*(cmin+min5);cmax=0.5*(cmax+max5);previousColor=clip_aabb(cmin,cmax,previousColor);float lum0=luminance(currentColor.rgb);float lum1=luminance(previousColor.rgb);float unbiased_diff=abs(lum0-lum1)/max(lum0,max(lum1,0.2));float unbiased_weight=1.-unbiased_diff;float unbiased_weight_sqr=unbiased_weight*unbiased_weight;float k_feedback=mix(feedBack.x,feedBack.y,unbiased_weight_sqr);return mix(currentColor,previousColor,k_feedback);}vec3 getWorldPositionFromViewZ(const in vec2 uv,const in float viewDepth){vec2 uv_=2.*uv-1.;float xe=-(uv_.x+projection[2][0])*viewDepth/projection[0][0];float ye=-(uv_.y+projection[2][1])*viewDepth/projection[1][1];return(inverseViewMatrix*vec4(xe,ye,viewDepth,1.)).xyz;}void main(){vec2 jitterOffset=jitterSample/previousRTSize;
#if QUALITY == 1
vec3 c_frag=find_closest_fragment_3x3(vUv);
#else
vec3 c_frag=find_closest_fragment_5tap(vUv);
#endif
if(c_frag.z>=0.999){gl_FragColor=currentRTTexelToLinear(texture2D(currentRT,vUv-jitterOffset));}else{float sampleViewZ=mix(-cameraNearFar.x,-cameraNearFar.y,c_frag.z);vec3 worldPosition=getWorldPositionFromViewZ(c_frag.xy,sampleViewZ);
#if HAS_VELOCITY_BUFFER == 0
vec2 screenSpaceVelocity=computeScreenSpaceVelocity(worldPosition);
#else
vec2 screenSpaceVelocity=(texture2D(tVelocity,vUv).xy*2.-1.);screenSpaceVelocity=sign(screenSpaceVelocity)*pow(abs(screenSpaceVelocity),vec2(4.));
#endif
gl_FragColor=firstFrame?currentRTTexelToLinear(texture2D(currentRT,vUv)):computeTAA(vUv,screenSpaceVelocity);}
#include <encodings_fragment>
}`,uniforms:{currentRT:{value:null},previousRT:{value:null},previousRTSize:{value:new c.FM8},cameraNearFar:{value:new c.FM8},lastProjectionViewMatrix:{value:new c.yGw},currentProjectionViewMatrix:{value:new c.yGw},projection:{value:new c.yGw},inverseViewMatrix:{value:new c.yGw},jitterSample:{value:new c.FM8},firstFrame:{value:!0},tNormalDepth:{value:null},tVelocity:{value:null}},defines:{HAS_VELOCITY_BUFFER:0,QUALITY:1,UNJITTER:0}},"currentRT","previousRT"),this.taaEnabled=!0,this.feedBack=new c.FM8(.88,.97),this.uiConfig={type:"folder",label:"Temporal AA",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:()=>this.onSizeUpdate()},{type:"input",label:"Feedback",property:[this,"feedBack"],onChange:this.setDirty}]},this.onSizeUpdate=this.onSizeUpdate.bind(this),this.target=e,this.clear=!1,this.needsSwap=!0}render(e,t,n,r,o){if(!this.taaEnabled||!this.enabled)return void(this.needsSwap=!1);this.needsSwap=!0;const a=this.uniforms.tVelocity.value?1:0;a!==this.material.defines.HAS_VELOCITY_BUFFER&&(this.material.defines.HAS_VELOCITY_BUFFER=a,this.material.needsUpdate=!0),this.uniforms.previousRT.value=this.target.texture,super.render(e,t,n,r,o),this.uniforms.lastProjectionViewMatrix.value.copy(this.uniforms.currentProjectionViewMatrix.value),this.uniforms.firstFrame.value=!1}updateCameraProperties(e){e&&(this.uniforms.currentProjectionViewMatrix.value.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this.uniforms.inverseViewMatrix.value.copy(e.matrixWorld))}onSizeUpdate(){this.uniforms.firstFrame.value=!0,this.setDirty()}setSize(e,t){super.setSize(e,t),this.onSizeUpdate()}}(function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)})([et(),be()],Pv.prototype,"feedBack",void 0);class Mf extends xl{constructor(){super(...arguments),this.passId="taa",this._beforeFilters=["progressive"],this._afterFilters=[],this._requiredFilters=["render","progressive"],this.dependencies=[xr]}passCtor(e){if(!e.getPlugin(lo))throw"Add ProgressivePlugin before TAA";const t=new Pv(e.getPlugin(lo).lastFrame,e.getPlugin(xr).getUnpackSnippet());return e.renderer.addEventListener("resize",t.onSizeUpdate),t}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}async onDispose(e){return this.pass&&e.renderer.removeEventListener("resize",this.pass.passObject.onSizeUpdate),super.onDispose(e)}_update(e){if(!super._update(e))return!1;const t=e.renderer.frameCount,n=this._pass.passObject;if(n.taaEnabled=t<1,!n.taaEnabled)return!1;const r=e.scene.activeCamera;return n.updateShaderProperties([e.getPlugin(xr),r,e.getPluginByType("VelocityBuffer")]),n.target=e.getPlugin(lo).lastFrame,n.updateCameraProperties(r==null?void 0:r.cameraObject),!0}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}Mf.PluginType="TAA";class Dv{static async GetDataUrl(e,{mimeType:t="image/png",rect:n={x:0,y:0,width:e.width,height:e.height,assumeClientRect:!1},displayPixelRatio:r=1,scale:o=1}){var a,u,p;const f=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");f.width=n.width*o*r,f.height=n.height*o*r,n.assumeClientRect&&(n.x*=e.width/(r*e.clientWidth),n.y*=e.height/(r*e.clientHeight),n.width*=e.width/(r*e.clientWidth),n.height*=e.height/(r*e.clientHeight));const m=f.getContext("2d");if(!m)return console.error("snapshot: cannot create context"),"";const y=e.style.background||((a=e.parentElement)===null||a===void 0?void 0:a.style.background)||"";if(y.includes("url")){const M=(u=/url\("(.*)"\)/gi.exec(y))===null||u===void 0?void 0:u[1];if(M){const P=new Image;P.src=M,await new Promise((D,j)=>{P.onload=()=>D(),P.onerror=()=>j(),P.complete&&D()}),m.drawImage(P,P.width*n.x*r/e.width,P.height*n.y*r/e.height,P.width*n.width*r/e.width,P.height*n.height*r/e.height,0,0,f.width,f.height)}}else m.fillStyle=e.style.background||((p=e.parentElement)===null||p===void 0?void 0:p.style.backgroundColor)||"#00000000",m.fillRect(0,0,f.width,f.height);m==null||m.drawImage(e,n.x*r,n.y*r,n.width*r,n.height*r,0,0,f.width,f.height);const S=m.canvas.toDataURL(t);return f.remove(),S}static async GetImage(e,t={}){const n=await this.GetDataUrl(e,t);return new Promise((r,o)=>{const a=new Image;a.onload=()=>{r(a)},a.src=n})}static async GetBlob(e,t={}){return await(await fetch(await this.GetDataUrl(e,t))).blob()}static async GetFile(e,t="image.png",n={}){var r;return n.getDataUrl?await this.GetDataUrl(e,n):new File([await this.GetBlob(e,n)],t,{type:(r=n.mimeType)!==null&&r!==void 0?r:"image/png",lastModified:Mi()})}}var Ia=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let fa=class extends ui{constructor(){super(),this.enabled=!0,this.downloadSnapshot=this.downloadSnapshot.bind(this)}async getFile(s,e={}){return e.getDataUrl=!1,await this._getFile(s,e)}async getDataUrl(s={}){var e;return s.getDataUrl=!0,(e=await this._getFile("",s))!==null&&e!==void 0?e:""}async _getFile(s,e={}){var t,n,r;const o=(t=this._viewer)===null||t===void 0?void 0:t.canvas;if(o){const a=this._viewer.renderer.displayCanvasScaling;e.displayPixelRatio!==void 0&&e.displayPixelRatio!==a&&(this._viewer.renderer.displayCanvasScaling=e.displayPixelRatio);const u=(n=this._viewer)===null||n===void 0?void 0:n.getPlugin(lo);if(e.waitForProgressive&&u&&e.timeout===void 0)for(;!u.isConverged(!0);)await is(64);else await is((r=e.timeout)!==null&&r!==void 0?r:200);e.displayPixelRatio=1;const p=await Dv.GetFile(o,s,e);return e.displayPixelRatio=this._viewer.renderer.displayCanvasScaling,this._viewer.renderer.displayCanvasScaling=a,p}}async downloadSnapshot(s="snapshot.png",e={}){const t=await this.getFile(s,e);t&&Wo(t)}};fa.PluginType="CanvasSnipper",Ia([Ji("Download .png",{limitedUi:!0})],fa.prototype,"downloadSnapshot",null),fa=Ia([Ci("Image Export")],fa);var Jr=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let HA=1,No=class{constructor(s,e,t,n,r){this.position=new c.Pa4,this.target=new c.Pa4,this.quaternion=new c._fP,this.up=new c.Pa4,this.name="Camera View",this.snap="",this.focusView=()=>{},this.deleteView=()=>{},this.uiConfig=Ec(this.name,this),s&&(this.position=s),e&&(this.target=e),t&&(this.up=t),n&&(this.quaternion=n),r&&(this.snap=r),this.name="Camera View"+HA++}_nameChanged(){var s,e;this.uiConfig&&(this.uiConfig.label=this.name,(e=(s=this.uiConfig).uiRefresh)===null||e===void 0||e.call(s))}};Jr([et(),Yr()],No.prototype,"position",void 0),Jr([et(),Yr()],No.prototype,"target",void 0),Jr([et(),Yr()],No.prototype,"quaternion",void 0),Jr([et(),Yr()],No.prototype,"up",void 0),Jr([et(),Si()],No.prototype,"name",void 0),Jr([Th()],No.prototype,"snap",void 0),Jr([Ji()],No.prototype,"focusView",void 0),Jr([Ji()],No.prototype,"deleteView",void 0),No=Jr([Qn("CameraView")],No);class rs extends ui{constructor(){super(),this.enabled=!0,this._cameraViews=[],this.viewLooping=!1,this.viewPauseTime=200,this.animEase="easeInOutSine",this.animDuration=1e3,this.rotationOffset=.25,this.interpolateMode="spherical",this.animateOnScroll=!1,this.seekOnScroll=!1,this._animating=!1,this.dependencies=[],this._scrollAnimationState=0,this.scrollAnimationDamping=.1,this._updaters=[],this._lastFrameTime=0,this._fadeDisabled=!1,this._viewQueue=[],this._animationLooping=!1,this._infiniteLooping=!0,this._driver=e=>({start:()=>this._updaters.push({u:e,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(t=>t.u===e),1)}),this.focusNext=(e=!0)=>{if(this._animating||this._cameraViews.length<2)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=-1),t+=1,e?t%=this._cameraViews.length:t=Math.min(t,this._cameraViews.length-1),this.focusView(this._cameraViews[t])},this.focusPrevious=(e=!0)=>{if(this._animating||this._cameraViews.length<2||!this._currentView)return;let t=this._cameraViews.findIndex(n=>n===this._currentView);t<0&&(t=0),t-=1,t=e?(t+this._cameraViews.length)%this._cameraViews.length:Math.max(t,0),this.focusView(this._cameraViews[t])},this._popAnimations=[],this.uiConfig={type:"folder",label:"Camera Views",children:[()=>[...this._cameraViews.map(e=>e.uiConfig)],...Ql(this)]},this.addCurrentView=this.addCurrentView.bind(this),this.animateAllViews=this.animateAllViews.bind(this),this.recordAllViews=this.recordAllViews.bind(this),this.resetToFirstView=this.resetToFirstView.bind(this),this._wheel=this._wheel.bind(this),this._pointerMove=this._pointerMove.bind(this),this._postFrame=this._postFrame.bind(this)}get animationLooping(){return this._animationLooping}get animating(){return this._animating}get camViews(){return this._cameraViews}_wheel(e){this.enabled&&(this.seekOnScroll&&!this._animating||Math.abs(e.deltaY)>.001&&(this._scrollAnimationState=-1*Math.sign(e.deltaY)))}_pointerMove(e){var t;if(this.enabled&&!this._animating&&this.seekOnScroll){const n=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera;if(!n)return;const r=new c.$V,o=n.position,a=n.target,u=new c._fP().setFromUnitVectors(n.cameraObject.up,new c.Pa4(0,1,0)),p=u.clone().invert(),f=o.clone().sub(a);f.applyQuaternion(u),r.setFromVector3(f),r.theta+=this.rotationOffset*e.movementX/this._viewer.canvas.clientWidth,r.phi+=this.rotationOffset*e.movementY/this._viewer.canvas.clientHeight,r.makeSafe(),f.setFromSpherical(r),f.applyQuaternion(p),o.copy(a).add(f),n.positionUpdated(!1),n.targetUpdated()}}async onAdded(e){await super.onAdded(e);let t=!1;e.addEventListener("preFrame",n=>{this.seekOnScroll||this._animating?this._viewer.scene.activeCamera.interactionsEnabled&&(this._viewer.scene.activeCamera.interactionsEnabled=!1,t=!0):t&&(this._viewer.scene.activeCamera.interactionsEnabled=!0,t=!1)}),e.addEventListener("postFrame",this._postFrame),window.addEventListener("wheel",this._wheel),window.addEventListener("pointermove",this._pointerMove)}_postFrame(){var e,t;if(!this._viewer)return;if(!this.enabled||!this._animating)return this._lastFrameTime=0,void(this._fadeDisabled&&((e=this._viewer.getPluginByType("FrameFade"))===null||e===void 0||e.enable(rs.PluginType),this._fadeDisabled=!1));const n=Mi()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=n-1/60);let r=n-this._lastFrameTime;this._lastFrameTime=n,r*=this.animateOnScroll?this._scrollAnimationState:1;const o=(t=this._viewer.getPluginByType("Progressive"))===null||t===void 0?void 0:t.postFrameConvergedRecordingDelta();if(o&&o>0&&(r=o),o!==0&&(r*=1e3,!(r<=0||(this._updaters.forEach(a=>{let u=r;a.time+u<0&&(u=-a.time),a.time+=u,Math.abs(u)>.001&&a.u(u)}),this._scrollAnimationState<.001?this._scrollAnimationState=0:this._scrollAnimationState*=1-this.scrollAnimationDamping,this._fadeDisabled)))){const a=this._viewer.getPluginByType("FrameFade");a&&(a.disable(rs.PluginType),this._fadeDisabled=!0)}}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),window.removeEventListener("wheel",this._wheel),window.removeEventListener("pointermove",this._pointerMove),super.onRemove(e)}async _animationLoop(){if(!this._animationLooping){for(this._animationLooping=!0;(this.viewLooping||!this._infiniteLooping)&&this.enabled&&!(this._cameraViews.length<1);){if(this._viewQueue.length===0){if(!this._infiniteLooping)break;this._viewQueue.push(...this._cameraViews)}await this.animateToView(this._viewQueue.shift()),await is(2+this.viewPauseTime)}this._animationLooping=!1}}async animateAllViews(){if(this.enabled&&!(this.viewLooping||this._cameraViews.length<2)){for(;this._viewQueue.length>0;)this._viewQueue.pop();this._viewQueue.push(...this._cameraViews),this._viewQueue.push(this._viewQueue.shift()),this._infiniteLooping=!1,await this._animationLoop(),this._infiniteLooping=!0}}async resetToFirstView(e=100){this.enabled&&(this._currentView=void 0,await this.animateToView(this._cameraViews[0],e),await is(2))}async recordAllViews(e){var t;if(!this.enabled)return;const n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CanvasRecorder");return n&&n.enabled&&(await this.resetToFirstView(),n.startRecording())?new Promise((r,o)=>{const a=()=>{n.removeEventListener("start",u),n.removeEventListener("stop",a),n.removeEventListener("error",p)},u=async()=>{a(),e==null||e(),await this.animateAllViews();const f=await n.stopRecording();f&&Ss(f,"recording.mp4"),r()},p=async()=>{a(),o()};n.addEventListener("start",u),n.addEventListener("stop",a),n.addEventListener("error",p)}):void 0}async addCurrentView(){var e,t,n,r,o;if(!this.enabled)return;const a=(e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera;if(!a)return;const u=this.getCurrentCameraView(a);u.snap=await((n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(fa))===null||n===void 0?void 0:n.getDataUrl({displayPixelRatio:.25,mimeType:"image/jpg"}))||"",this._cameraViews.push(u),(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r)}getCurrentCameraView(e){var t;if(e||(e=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera),!e)return new No;const n=new c.Pa4,r=e.cameraObject.matrixWorld;n.x=r.elements[4],n.y=r.elements[5],n.z=r.elements[6];const o=new No(e.position.clone(),e.target.clone(),n.normalize(),e.cameraObject.quaternion.clone(),"");return o.focusView=async()=>this.focusView(o),o.deleteView=()=>this.deleteView(o),o}async focusView(e){return this.animateToView(e)}deleteView(e){var t,n;const r=this._cameraViews.indexOf(e);r>=0&&this._cameraViews.splice(r,1),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t)}async stopAllAnimations(){for(this.viewLooping=!1,this._popAnimations.forEach(e=>{var t;return(t=e==null?void 0:e.stop)===null||t===void 0?void 0:t.call(e)}),this._popAnimations=[];this._animating||this._animationLooping;)await is(100)}async animateToView(e,t,n){var r;const o=(r=this._viewer)===null||r===void 0?void 0:r.scene.activeCamera;if(!o)return;if(this._animating&&(this._popAnimations.forEach(m=>{var y;return(y=m==null?void 0:m.stop)===null||y===void 0?void 0:y.call(m)}),await is(100),this._animating))return void console.warn("todo: still animating?");this._currentView=e,this._animating=!0,this.dispatchEvent({type:"startViewChange",view:e}),t===void 0&&(t=this.animDuration);const a=typeof n=="function"?n:Yh[n||this.animEase],u=this._driver,p=[];this._popAnimations=[];const f=this._popAnimations;if(this.interpolateMode==="spherical")p.push(async function(m,y,S,M,P,D){const j=m.target.clone(),k=new c.Pa4,L=new c.Pa4,R=Zh(m.cameraObject,j),W=Zh(y,y.target),q=new c.$V;return Tf({from:0,to:1,duration:S,ease:M,driver:P,onUpdate:J=>{q.phi=xg(R.phi,W.phi,J),q.theta=xg(R.theta,W.theta,J),q.radius=Ei(R.radius,W.radius,J),k.copy(j).lerp(y.target,J),L.setFromSpherical(q),L.add(k),m.position=L,m.target=k,m.positionUpdated(!1),m.targetUpdated()},onComplete:()=>{m.position=y.position,m.target=y.target,m.positionUpdated(!1),m.targetUpdated()}},D)}(o,e,t,a,u,f));else if(this.interpolateMode==="linear"){p.push(Tf({from:o.position.clone(),to:e.position.clone(),duration:t,ease:a,driver:u,onUpdate:S=>o.position=S,onComplete:()=>o.position=e.position},f)),p.push(Tf({from:o.target.clone(),to:e.target.clone(),duration:t,ease:a,driver:u,onUpdate:S=>{o.target=S,o.targetUpdated()},onComplete:()=>{o.target=e.target,o.targetUpdated()}},f));const m=o.cameraObject.quaternion.clone(),y=new c._fP;p.push(Tf({from:0,to:1,duration:t,ease:a,driver:u,onUpdate:S=>{y.copy(m).slerp(e.quaternion,S),o.cameraObject.quaternion.copy(y),o.cameraObject.updateProjectionMatrix()},onComplete:()=>{o.cameraObject.quaternion.copy(e.quaternion),o.cameraObject.updateProjectionMatrix()}},f))}await Promise.all(p),this._animating=!1,this.dispatchEvent({type:"viewChange",view:e}),await is(10)}fromJSON(e,t){var n,r;return this._cameraViews.forEach(o=>this.deleteView(o)),super.fromJSON(e,t)?(this._cameraViews.forEach(o=>o.focusView=async()=>this.focusView(o)),this._cameraViews.forEach(o=>o.deleteView=()=>this.deleteView(o)),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n),this):null}async animateToObject(e,t=4,n,r,o={min:.5,max:5}){if(!this._viewer)return;const a=new _t().expandByObject(e||this._viewer.scene.modelRoot.modelObject,!1,!0),u=a.getCenter(new c.Pa4),p=a.getSize(new c.Pa4).length()/2;await this.animateToTarget(Math.min(o.max,Math.max(o.min,p*t)),u,n,r)}async animateToTarget(e,t,n,r){const o=this.getCurrentCameraView();o.target.copy(t);const a=new c.Pa4().subVectors(o.target,o.position).normalize();o.position.copy(a.multiplyScalar(-e).add(o.target)),await this.animateToView(o,n,r)}}async function Tf(s,e){const t=s.onComplete,n=s.onStop;return s={...s},new Promise((r,o)=>{s.onComplete=()=>{t==null||t(),r()},s.onStop=()=>{n==null||n(),r()};const a=ep(s);e.push(a)})}function Zh(s,e){const t=s.position.clone();t.sub(e);const n=new c.$V().setFromVector3(t);return n.makeSafe(),n}function xg(s,e,t){const n=e-s;return n>=Math.PI?s+(n-2*Math.PI)*t:n<=-Math.PI?s+(n+2*Math.PI)*t:s+n*t}function Rv(s,e,t){const n=(1-t)*Math.cos(s)+t*Math.cos(e),r=(1-t)*Math.sin(s)+t*Math.sin(e);return Math.atan2(r,n)}rs.PluginType="CameraViews",Jr([et("cameraViews")],rs.prototype,"_cameraViews",void 0),Jr([we(rs.prototype._animationLoop),et(),_n("Loop All Views",{limitedUi:!0})],rs.prototype,"viewLooping",void 0),Jr([et(),Si("View Pause Time")],rs.prototype,"viewPauseTime",void 0),Jr([et(),Ao("Ease",Object.keys(Yh).map(s=>({label:s})))],rs.prototype,"animEase",void 0),Jr([et(),wn("Duration",[10,1e4],10,{limitedUi:!0})],rs.prototype,"animDuration",void 0),Jr([et(),wn("RotationOffset",[.2,.75],.01)],rs.prototype,"rotationOffset",void 0),Jr([et(),Ao("Interpolation",["spherical","linear"].map(s=>({label:s})))],rs.prototype,"interpolateMode",void 0),Jr([_n(),et()],rs.prototype,"seekOnScroll",void 0),Jr([Ji("Animate All Views",{limitedUi:!0})],rs.prototype,"animateAllViews",null),Jr([Ji("Record All Views")],rs.prototype,"recordAllViews",null),Jr([Ji("Add Current View")],rs.prototype,"addCurrentView",null),Jr([Ji("Focus Next")],rs.prototype,"focusNext",void 0),Jr([Ji("Focus Previous")],rs.prototype,"focusPrevious",void 0);const Bv=new c.Pa4;function Bl(s,e,t){let n=s.dot(e);n=Math.min(Math.max(n,-1),1);const r=Math.acos(n)*t;return Bv.copy(s).multiplyScalar(n).sub(e).negate().normalize(),s.multiplyScalar(Math.cos(r)).add(Bv.multiplyScalar(Math.sin(r)))}var tu=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class nu extends ui{constructor(e=!0){super(),this.enabled=!0,this.light=new Af("#cceeff",1),this.lightLayers=1,this._preRender=()=>{var t,n,r;if(!this.enabled)return void(this.light.layers.mask=0);const o=(n=(t=this._viewer)===null||t===void 0?void 0:t.renderer.frameCount)!==null&&n!==void 0?n:0;(o<1||o>5)&&this.light.randomizePosition(o<5?0:o),this.light.layers.mask=this.lightLayers,this.light.updateShadowParams(),(r=this._cameraHelper)===null||r===void 0||r.update()},this._setDirty=this._setDirty.bind(this),this.enabled=e}get cameraHelper(){return this._cameraHelper}async onAdded(e){await super.onAdded(e),this._cameraHelper=new c.Rki(this.light.shadow.camera),this._cameraHelper.visible=!1,this._cameraHelper.userData.bboxVisible=!1,e.scene.add(this._cameraHelper),e.scene.addLight(this.light,{addToRoot:!0}),e.addEventListener("preRender",this._preRender)}async onRemove(e){return e.removeEventListener("preRender",this._preRender),this.light.removeFromParent(),super.onRemove(e)}_setDirty(e=!1){var t,n;e?(t=this._viewer)===null||t===void 0||t.scene.setDirty():(n=this._viewer)===null||n===void 0||n.setDirty()}get uiConfig(){return this._uiConfig?this._uiConfig:this._uiConfig={type:"folder",label:"Progressive Shadow",children:[{type:"checkbox",label:"Enabled",property:[this,"enabled"],onChange:this._setDirty},{type:"folder",label:"Directional Light",children:[{type:"checkbox",label:"Visible",property:[this.light,"visible"],onChange:this._setDirty},{type:"slider",label:"Intensity",bounds:[0,10],property:[this.light,"intensity"],onChange:this._setDirty},{type:"color",label:"Color",property:[this.light,"color"],onChange:this._setDirty},{type:"checkbox",label:"Shadow Enabled",property:[this.light.shadowParams,"enabled"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"focus"],onChange:this._setDirty},{type:"slider",bounds:[0,1],property:[this.light.randomParams,"spread"],onChange:this._setDirty},{type:"slider",bounds:[.01,60],property:[this.light.randomParams,"distanceScale"],onChange:this._setDirty},{type:"vec3",bounds:[-5,5],property:[this.light.randomParams,"direction"],onChange:this._setDirty},{type:"slider",bounds:[.01,10],property:[this.light.shadowParams,"radius"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[.01,30],property:[this.light.shadowParams,"frustumSize"],onChange:[this.light.updateShadowParams,this._setDirty]},{type:"slider",bounds:[-.01,.01],property:[this.light.shadowParams,"bias"],onChange:[this.light.updateShadowParams,this._setDirty]}]}]}}}nu.PluginType="RandomizedDirectionalLight",tu([et()],nu.prototype,"enabled",void 0),tu([et("rdLight")],nu.prototype,"light",void 0),tu([et()],nu.prototype,"lightLayers",void 0);var iu,If=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ma=iu=class extends ui{constructor(s=!1){super(),this.enabled=!1,this.worldRadius=100,this.tripodHeight=10,this._paramsChanged=this._paramsChanged.bind(this),this.enabled=s}_paramsChanged(){var s,e,t,n,r,o,a,u,p,f,m;const y=(s=this._viewer)===null||s===void 0?void 0:s.getBackground(!0);if(this.enabled&&y&&y!==El)if(y.isDataTexture)y.mapping=c.dSO;else if(confirm("Background must be same as environment, do you want to change it?")){const P=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("SimpleBackgroundEnvUiPlugin1");P?(P.envmapBg=!0,(n=(t=P.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)):(r=this._viewer)===null||r===void 0||r.setBackground(El)}else this.enabled=!1;const S=(p=(u=(a=(o=this._viewer)===null||o===void 0?void 0:o.renderer)===null||a===void 0?void 0:a.rendererObject)===null||u===void 0?void 0:u.background.getBoxMesh2())===null||p===void 0?void 0:p.material,M=(f=S==null?void 0:S.uniforms)!==null&&f!==void 0?f:c.Vj0.cube.uniforms;M.tripodHeight||(M.tripodHeight={value:1}),M.worldRadius||(M.worldRadius={value:1}),M.tripodHeight.value=this.tripodHeight,M.worldRadius.value=this.worldRadius,S&&(!this.enabled&&S.defines.HDRi_GROUND_PROJ?delete S.defines.HDRi_GROUND_PROJ:this.enabled&&(S.defines.HDRi_GROUND_PROJ="1"),S.needsUpdate=!0),(m=this._viewer)===null||m===void 0||m.setDirty()}async onAdded(s){var e,t,n;await super.onAdded(s),!((n=(t=(e=this._viewer)===null||e===void 0?void 0:e.renderer)===null||t===void 0?void 0:t.rendererObject)===null||n===void 0)&&n.background.getBoxMesh()&&console.error("HDRi Ground Plugin must be added before setting any cube or env map"),c.Vj0.cube.fragmentShader=c.Vj0.cube.fragmentShader.replace("void main() {",`
#ifdef HDRi_GROUND_PROJ
float intersectPlane1(const in vec3 r0,const in vec3 rd,const in vec3 n,const in vec3 p0){float t=dot(p0-r0,n)/(dot(n,rd)+1e-6);return t<0.?1000.:t;}float intersectSphere1(in vec3 ro,in vec3 rd,in vec3 sph,in float rad){vec3 oc=ro-sph;float b=dot(oc,rd);float c=dot(oc,oc)-rad*rad;float t=b*b-c;return t<0.?t:-b+sqrt(t);}
#define PI_HALF  1.5707963267948966
uniform float worldRadius;uniform float tripodHeight;vec3 hdriProject(){vec3 p=normalize(vWorldDirection);vec3 camPos=cameraPosition;camPos.y-=tripodHeight;float t=intersectSphere1(camPos,p,vec3(0.,0.,0.),worldRadius);if(t>0.){float t2=intersectPlane1(camPos,p,vec3(0,-1,0),vec3(0.,-tripodHeight,0.));p=(camPos+min(t,t2)*p)/worldRadius;}else p=vec3(0.,1.,0.);return p;}
#endif

void main() {`),c.Vj0.cube.fragmentShader=c.Vj0.cube.fragmentShader.replace("vec3 vReflect = vWorldDirection;",`
vec3 vReflect = 
#ifdef HDRi_GROUND_PROJ
hdriProject()
#else
vWorldDirection
#endif
;
`),s.scene.addEventListener("environmentChanged",this._paramsChanged)}};ma.PluginType="HDRiGroundPlugin",If([et(),we(iu.prototype._paramsChanged),_n("Enabled")],ma.prototype,"enabled",void 0),If([et(),we(iu.prototype._paramsChanged),wn("World Radius",[1,1e3])],ma.prototype,"worldRadius",void 0),If([et(),we(iu.prototype._paramsChanged),wn("Tripod height",[0,50])],ma.prototype,"tripodHeight",void 0),ma=iu=If([Ci("HDRi Ground")],ma);var $a=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const op={uniforms:{colorTexture:{value:null},tNormalDepth:{value:null},blurTexture:{value:null},cocTexture:{value:null},cocTextureSize:{value:new c.FM8},cameraNearFar:{value:new c.FM8}},vertexShader:Sl,fragmentShader:Yl+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 cocTextureSize;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;uniform vec2 crossCenter;uniform float crossRadius;uniform float crossAlpha;uniform vec3 crossColor;float smoothBoundary(float d,float smooothFactor){smooothFactor*=0.5;float value=smoothstep(-smooothFactor,smooothFactor,d);return value;}float circle(vec2 p,float r){return min((length(p)-r),-(length(p)-r-0.01));}float computeCoc(){float depth=getDepth(vUv);if(depth>1.-0.01)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){vec4 blur=blurTextureTexelToLinear(texture2D(blurTexture,vUv));float scale=0.5;blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(-1.,-1.)/cocTextureSize));blur+=blurTextureTexelToLinear(texture2D(blurTexture,vUv+scale*vec2(1.,-1.)/cocTextureSize));blur/=5.;vec2 uvNearest=(floor(vUv*cocTextureSize)+0.5)/cocTextureSize;float coc=abs(min(2.*cocTextureTexelToLinear(texture2D(cocTexture,uvNearest)).a-1.,computeCoc()));float cocLower=0.005;float cocHigher=0.3;vec4 outColor=vec4(mix(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,blur.rgb,smoothstep(cocLower,cocHigher,coc)),1.);vec2 d=vUv-crossCenter;if(length(d)>crossRadius+0.05){float dist=circle(d,crossRadius);gl_FragColor=outColor;}else{d.x*=cocTextureSize.x/cocTextureSize.y;float dist=circle(d,crossRadius);dist=smoothBoundary(dist,2.*fwidth(dist));vec4 color=outColor;vec3 dofCircleColor=mix(crossColor,color.rgb,1.-crossAlpha);gl_FragColor=vec4(mix(color.rgb,dofCircleColor,dist),color.a);}
#include <encodings_fragment>
}`},Pf=(Oi({uniforms:{cocTexture:{value:null},colorTexture:{value:null},colorTextureSize:{value:new c.FM8},direction:{value:new c.FM8}},vertexShader:Sl,fragmentShader:`#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;const float MAXIMUM_BLUR_SIZE=16.;const float SIGMA=5.;const int NUM_SAMPLES=4;float normpdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}vec3 weightedBlur(){float cocIn=2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv)).a-1.;float kernelRadius=MAXIMUM_BLUR_SIZE*cocIn;vec2 invSize=1./colorTextureSize;cocIn*=cocIn*cocIn;float centreSpaceWeight=normpdf(0.,SIGMA)*abs(cocIn);float weightSum=centreSpaceWeight;vec3 centreSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb;vec3 diffuseSum=centreSample*weightSum;vec2 delta=invSize*kernelRadius/float(NUM_SAMPLES);for(int i=1;i<=NUM_SAMPLES;i++){float spaceWeight=normpdf(float(i),SIGMA);vec2 texcoord=direction*delta*float(i);vec4 rightSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv+texcoord));vec4 leftSample=colorTextureTexelToLinear(texture2D(colorTexture,vUv-texcoord));float leftCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv-texcoord)).a-1.);float rightCocWeight=abs(2.*cocTextureTexelToLinear(texture2D(cocTexture,vUv+texcoord)).a-1.);leftCocWeight*=leftCocWeight*leftCocWeight;rightCocWeight*=rightCocWeight*rightCocWeight;diffuseSum+=((leftSample.rgb*leftCocWeight)+(rightSample.rgb*rightCocWeight))*spaceWeight;weightSum+=(spaceWeight*(leftCocWeight+rightCocWeight));}return diffuseSum/weightSum;}void main(){gl_FragColor=vec4(weightedBlur(),1.);
#include <encodings_fragment>
}`},"colorTexture","cocTexture"),Oi({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new c.FM8},direction:{value:new c.FM8},frameCount:{value:0},blurRadius:{value:16}},vertexShader:Sl,fragmentShader:Cl+`
`+zA+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform float blurRadius;vec4 CircularBlur(){vec4 color=colorTextureTexelToLinear(texture2D(colorTexture,vUv));
#ifdef DOF_MODE
float blurDist=blurRadius*(2.*color.a-1.);
#else
float blurDist=blurRadius*color.a;
#endif
float rnd=PI2*random3(vec3(vUv,frameCount*0.1));float costheta=cos(rnd);float sintheta=sin(rnd);vec4 rotationMatrix=vec4(costheta,-sintheta,sintheta,costheta);vec3 colorSum=vec3(0.);float weightSum=0.001;vec2 ofs;vec4 sampleColor;setPds();
#pragma unroll_loop_start
for(int i=0;i<16;i++){ofs=poisson_disk_samples[UNROLLED_LOOP_INDEX];ofs=vec2(dot(ofs,rotationMatrix.xy),dot(ofs,rotationMatrix.zw));sampleColor=colorTextureTexelToLinear(texture2D(colorTexture,vUv+blurDist*ofs/colorTextureSize.xy));
#ifdef DOF_MODE
sampleColor.a=abs(sampleColor.a*2.-1.);sampleColor.a*=sampleColor.a*sampleColor.a;
#endif
colorSum+=sampleColor.rgb*sampleColor.a;weightSum+=sampleColor.a;}
#pragma unroll_loop_end
colorSum/=weightSum;return vec4(saturate(colorSum),1.);}void main(){gl_FragColor=CircularBlur();
#include <encodings_fragment>
}`,defines:{DOF_MODE:1}},"colorTexture"));class th extends _s{constructor(){super(op,"colorTexture","cocTexture","blurTexture"),this.dofBlurMaterial=Pf,this.nearFarBlurScale=new c.FM8(.25,.25),this.focalDepthRange=new c.FM8(.5,1.5),this.crossCenter=new c.FM8(.5,.5),this.crossRadius=.04,this.crossAlpha=1,this.crossColor=new Sn(16750848),this.uiConfig={type:"folder",label:"Depth of Field",children:[{type:"checkbox",label:"Enabled",limitedUi:!0,property:[this,"enabled"]},{type:"slider",label:"Depth Range",bounds:[.5,3],property:[this.focalDepthRange,"y"]},{type:"slider",label:"Near Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"x"]},{type:"slider",label:"Far Blur scale",bounds:[0,1],property:[this.nearFarBlurScale,"y"]}]},this.material.extensions.derivatives=!0,this.computeCocMaterial=Oi({uniforms:{colorTexture:{value:null},tNormalDepth:this.uniforms.tNormalDepth,cameraNearFar:this.uniforms.cameraNearFar,nearFarBlurScale:this.uniforms.nearFarBlurScale,focalDepthRange:this.uniforms.focalDepthRange},vertexShader:Sl,fragmentShader:Yl+`
#include <common>
#include <packing>
varying vec2 vUv;uniform vec2 nearFarBlurScale;uniform vec2 cameraNearFar;uniform vec2 focalDepthRange;float computeCoc(){float depth=getDepth(vUv);if(depth==1.)return max(nearFarBlurScale.x,nearFarBlurScale.y);depth=mix(cameraNearFar.x,cameraNearFar.y,depth);float coc=(depth-focalDepthRange.x)/focalDepthRange.y;coc=clamp(coc,-1.,1.);return(coc>0.?coc*nearFarBlurScale.y:coc*nearFarBlurScale.x);}void main(){gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*computeCoc()+0.5);
#include <encodings_fragment>
}`},"colorTexture"),this.expandCocMaterial=Oi({uniforms:{colorTexture:{value:null},colorTextureSize:{value:new c.FM8},direction:{value:new c.FM8},tNormalDepth:this.uniforms.tNormalDepth,nearFarBlurScale:this.uniforms.nearFarBlurScale},vertexShader:Sl,fragmentShader:Yl+`
#include <common>
varying vec2 vUv;uniform vec2 colorTextureSize;uniform vec2 direction;uniform vec2 nearFarBlurScale;const float MAXIMUM_BLUR_SIZE=4.;float expandNear(const in vec2 offset,const in bool isBackground){float coc=0.;vec2 sampleOffsets=MAXIMUM_BLUR_SIZE*offset/5.;float coc0=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv)).a-1.;float coc1=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-5.*sampleOffsets)).a-1.;float coc2=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-4.*sampleOffsets)).a-1.;float coc3=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-3.*sampleOffsets)).a-1.;float coc4=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-2.*sampleOffsets)).a-1.;float coc5=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv-1.*sampleOffsets)).a-1.;float coc6=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+1.*sampleOffsets)).a-1.;float coc7=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+2.*sampleOffsets)).a-1.;float coc8=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+3.*sampleOffsets)).a-1.;float coc9=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+4.*sampleOffsets)).a-1.;float coc10=2.*colorTextureTexelToLinear(texture2D(colorTexture,vUv+5.*sampleOffsets)).a-1.;if(isBackground){coc=abs(coc0)*0.095474+(abs(coc1)+abs(coc10))*0.084264+(abs(coc2)+abs(coc9))*0.088139+(abs(coc3)+abs(coc8))*0.091276+(abs(coc4)+abs(coc7))*0.093585+(abs(coc5)+abs(coc6))*0.094998;}else{coc=min(coc0,0.);coc=min(coc1*0.3,coc);coc=min(coc2*0.5,coc);coc=min(coc3*0.75,coc);coc=min(coc4*0.8,coc);coc=min(coc5*0.95,coc);coc=min(coc6*0.95,coc);coc=min(coc7*0.8,coc);coc=min(coc8*0.75,coc);coc=min(coc9*0.5,coc);coc=min(coc10*0.3,coc);if(abs(coc0)>abs(coc))coc=coc0;}return coc;}void main(){vec2 offset=2.*direction/colorTextureSize;bool isBackground=getDepth(vUv)>1.-0.001;float coc=expandNear(offset,isBackground);gl_FragColor=vec4(colorTextureTexelToLinear(texture2D(colorTexture,vUv)).rgb,0.5*coc+0.5);
#include <encodings_fragment>
}`},"colorTexture")}render(e,t,n,r,o){if(!this.enabled)return;const a=e.baseRenderer,u={minFilter:c.TyD,magFilter:c.TyD,type:c.cLu,encoding:c.rnI,sizeMultiplier:.5,isAntialiased:!1,format:c.wk1,depthBuffer:!1,generateMipmaps:!1},p=a.getTempTarget(u),f=a.getTempTarget(u);if(this.computeCocMaterial.uniforms.colorTexture.value=n.texture,a.blit(void 0,p,{material:this.computeCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=p.texture,this.expandCocMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,f,{material:this.expandCocMaterial}),this.expandCocMaterial.uniforms.colorTexture.value=f.texture,this.expandCocMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,p,{material:this.expandCocMaterial}),this.dofBlurMaterial.uniforms.frameCount)this.dofBlurMaterial.uniforms.colorTexture.value=p.texture,a.blit(void 0,f,{material:this.dofBlurMaterial});else{const m=a.getTempTarget(u);this.dofBlurMaterial.uniforms.cocTexture.value=p.texture,this.dofBlurMaterial.uniforms.colorTexture.value=p.texture,this.dofBlurMaterial.uniforms.direction.value.set(1,0),a.blit(void 0,m,{material:this.dofBlurMaterial}),this.dofBlurMaterial.uniforms.colorTexture.value=m.texture,this.dofBlurMaterial.uniforms.direction.value.set(0,1),a.blit(void 0,f,{material:this.dofBlurMaterial}),a.releaseTempTarget(m)}this.material.uniforms.blurTexture.value=f.texture,this.material.uniforms.cocTexture.value=p.texture,super.render(e,t,n,r,o),a.releaseTempTarget(p),a.releaseTempTarget(f)}}$a([et(),be()],th.prototype,"nearFarBlurScale",void 0),$a([et(),be()],th.prototype,"focalDepthRange",void 0),$a([be()],th.prototype,"crossCenter",void 0),$a([be()],th.prototype,"crossRadius",void 0),$a([be()],th.prototype,"crossAlpha",void 0),$a([be()],th.prototype,"crossColor",void 0);var ru=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class su extends xl{constructor(e=!0,t=!1){super(),this.passId="depthOfField",this._beforeFilters=["progressive","tonemap","screen"],this._afterFilters=["render"],this._requiredFilters=["render"],this.dependencies=[xr],this.enableEdit=!1,this._focalPointHit=new c.Pa4(0,0,0),this.crossFadeTime=200,this._focalPointHitTime=0,this._tempVec=new c.Pa4,this.enabled=e,this.enableEdit=t,this._onObjectHit=this._onObjectHit.bind(this),this.setDirty=this.setDirty.bind(this)}passCtor(e){return new th}setFocalPoint(e,t=!0,n=!1){var r,o;this._focalPointHit.copy(e),t&&((o=(r=this._viewer)===null||r===void 0?void 0:r.getPlugin(Zc))===null||o===void 0||o.startTransition(this._frameFadeTime)),n&&(this._focalPointHitTime=Mi()),this.setDirty()}getFocalPoint(){return this._focalPointHit}get depthRange(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.focalDepthRange.y)!==null&&t!==void 0?t:0}set depthRange(e){this.pass&&(this.pass.passObject.focalDepthRange.y=e),this.setDirty()}get nearBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.x)!==null&&t!==void 0?t:0}set nearBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.x=e),this.setDirty()}get farBlurScale(){var e,t;return(t=(e=this.pass)===null||e===void 0?void 0:e.passObject.nearFarBlurScale.y)!==null&&t!==void 0?t:0}set farBlurScale(e){this.pass&&(this.pass.passObject.nearFarBlurScale.y=e),this.setDirty()}get _frameFadeTime(){return 2.5*this.crossFadeTime}_onObjectHit(e){var t,n;this._pass&&e.intersects.intersect&&this.enabled&&this.enableEdit&&(this._focalPointHit.copy(e.intersects.intersect.point),this._focalPointHitTime=e.time,e.intersects.selectedObject=null,(n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(Zc))===null||n===void 0||n.startTransition(this._frameFadeTime),this.setDirty())}async onAdded(e){var t;await super.onAdded(e),(t=e.getPluginByType("Picking"))===null||t===void 0||t.addEventListener("hitObject",this._onObjectHit)}async onRemove(e){var t;return(t=e.getPluginByType("Picking"))===null||t===void 0||t.removeEventListener("hitObject",this._onObjectHit),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_update(e){var t,n;if(!super._update(e))return!1;const r=(t=this.pass)===null||t===void 0?void 0:t.passObject;if(!r)return!1;const o=e.getPlugin(xr);o==null||o.updateShaderProperties(r.material),r.dofBlurMaterial.uniforms.frameCount&&((n=e.renderer)===null||n===void 0||n.updateShaderProperties(r.dofBlurMaterial));const a=e.scene.activeCamera;if(!a)return!1;a.cameraObject.updateMatrixWorld(!0),a.updateShaderProperties(r.material),this._tempVec.subVectors(this._focalPointHit,a.cameraObject.position),r.focalDepthRange.x=this._tempVec.length(),r.focalDepthRange.x*=a.cameraObject.getWorldDirection(new c.Pa4).dot(this._tempVec.normalize());let u=(Mi()-this._focalPointHitTime)/this.crossFadeTime;if(u=1-Math.min(1,Math.max(0,u)),Math.abs(u-r.crossAlpha)>.01&&(r.crossAlpha=u,this.setDirty()),u>0){const p=this._tempVec.copy(this._focalPointHit).project(a.cameraObject).addScalar(1).divideScalar(2);r.crossCenter.set(p.x,p.y),r.computeCocMaterial.uniformsNeedUpdate=!0,r.expandCocMaterial.uniformsNeedUpdate=!0}return!0}get uiConfig(){var e,t,n,r,o;if(this._uiConfig)return this._uiConfig;const a=(t=(e=this._pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig;return a?((r=(n=a.children)===null||n===void 0?void 0:n.map(u=>Se(u)))===null||r===void 0||r.flat(2).forEach(u=>u&&(u.onChange=this.setDirty)),(o=a.children)===null||o===void 0||o.push({type:"checkbox",label:"Enable Edit",limitedUi:!0,property:[this,"enableEdit"]}),this._uiConfig=a,a):{}}}su.PluginType="DepthOfField",ru([et()],su.prototype,"enableEdit",void 0),ru([et("focalPoint")],su.prototype,"_focalPointHit",void 0),ru([et()],su.prototype,"crossFadeTime",void 0);var ed,Ls=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ys=ed=class extends ui{constructor(s=!0){super(),this.enabled=!0,this.radius=.015,this.intensity=1,this.tolerance=1.5,this._defines={},this.onlySSCSDebug=!1,this.stepCount=2,this.dependencies=[xr,dn],this.materialExtension={shaderExtender:(e,t,n)=>{if(!e.defines.SSCS_ENABLED)return;const r=Z`
                #ifndef D_sceneBoundingRadius
                #define D_sceneBoundingRadius
                uniform float sceneBoundingRadius;
                #endif
                float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, vec3 lightDirection ) {
                    vec3 ray_origin_view = -vViewPosition;
                    float rnd = interleavedGradientNoise(gl_FragCoord.xy, frameCount+34.);
                    float cameraDist = length(cameraPositionWorld);
//                    float radius = mix((cameraNearFar.y) + ray_origin_view.z, -ray_origin_view.z - cameraNearFar.x, rnd * 0.5 + 0.5)*sscsRadius;
                    float radius = mix((cameraDist + sceneBoundingRadius) + ray_origin_view.z, -ray_origin_view.z - max(0.0, cameraDist - sceneBoundingRadius), rnd * 0.5 + 0.5)*sscsRadius;
                    vec3 state = vec3(1.,(rnd+0.5)/float(SSCS_STEP_COUNT),2.);
                    traceRay(ray_origin_view, normalize(lightDirection) * radius, sscsTolerance * radius * 2., state, SSCS_STEP_COUNT);
                    state.z = state.z > 0.99 ? 1. : max(0.,min(state.z * state.z * (1.-sscsIntensity), 1.));
                    
                #if defined(SSCS_DEBUG) && SSCS_DEBUG > 0
                    return state.z;
                #endif
            `,o=`
#if SSCS_ENABLED

    uniform float sscsIntensity;
    uniform float sscsRadius;
    uniform float sscsTolerance;

    ${Um}
    
    #define THREE_PACKING_INCLUDED
    ${Kp}
    
    ${Yl}
    ${Cl}
    
    ${jm}

#endif
            
            `+c.WdD.shadowmap_pars_fragment.replace("float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {",`${r}
`).replace("return shadow;","return min(shadow, state.z);");e.fragmentShader=e.fragmentShader.replace("#include <shadowmap_pars_fragment>",o),e.fragmentShader=e.fragmentShader.replace("#include <lights_fragment_begin>",c.WdD.lights_fragment_begin),e.fragmentShader=e.fragmentShader.replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ], directLight.direction ) : 1.0;").replace("directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;","directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ], directLight.direction ) : 1.0;")},onObjectRender:(e,t,n)=>{var r;const o=t.materialObject;let a=this.enabled&&n.userData.screenSpaceRendering!==!1&&!(!((r=o.userData)===null||r===void 0)&&r.sscsDisabled)?1:0;o.defines.SSCS_ENABLED!==a&&(o.defines.SSCS_ENABLED=a,o.needsUpdate=!0),a=this._defines.SSCS_STEP_COUNT,o.defines.SSCS_STEP_COUNT!==a&&(o.defines.SSCS_STEP_COUNT=a,o.needsUpdate=!0),a=+this._defines.SSCS_DEBUG,o.defines.SSCS_DEBUG!==a&&(o.defines.SSCS_DEBUG=a,o.needsUpdate=!0)},parsFragmentSnippet:()=>`
`,extraUniforms:{...ed._uniforms},computeCacheKey:e=>this.enabled?"1":"0",isCompatible:e=>e.isMeshStandardMaterial2,updaters:()=>{var e,t,n,r,o;return[(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(xr),(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(lo),(n=this._viewer)===null||n===void 0?void 0:n.scene.activeCamera,(r=this._viewer)===null||r===void 0?void 0:r.renderer,(o=this._viewer)===null||o===void 0?void 0:o.scene]}},this.enabled=s,this.userData={setDirty:()=>{var e;(e=this._viewer)===null||e===void 0||e.setDirty()}}}async onAdded(s){var e,t;await super.onAdded(s),(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this.materialExtension)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this.materialExtension),super.onRemove(s)}};ys.PluginType="SSContactShadows",ys._uniforms={tNormalDepth:{value:null},frameCount:{value:0},projection:{value:new c.yGw},cameraPositionWorld:{value:new c.Pa4},cameraNearFar:{value:new c.FM8(.1,1e3)},sceneBoundingRadius:{value:0}},Ls([_n("Enabled"),et()],ys.prototype,"enabled",void 0),Ls([be({uniforms:ed._uniforms,propKey:"sscsRadius"}),wn("Radius",[1e-4,.1],1e-4),et()],ys.prototype,"radius",void 0),Ls([be({uniforms:ed._uniforms,propKey:"sscsIntensity"}),wn("Intensity",[1e-4,1],1e-4),et()],ys.prototype,"intensity",void 0),Ls([be({uniforms:ed._uniforms,propKey:"sscsTolerance"}),wn("Tolerance",[.1,5]),et()],ys.prototype,"tolerance",void 0),Ls([Xe("SSCS_DEBUG",void 0,!0),_n("Debug only SSCS"),et()],ys.prototype,"onlySSCSDebug",void 0),Ls([Xe("SSCS_STEP_COUNT",void 0,!0),wn("Step count",[1,8],1),et()],ys.prototype,"stepCount",void 0),ys=ed=Ls([Ci("Screen Space Contact Shadows")],ys);class ww{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const n=this.workersResolve[e];if(n&&n(t),this.queue.length){const{resolve:r,msg:o,transfer:a}=this.queue.shift();this.workersResolve[e]=r,this.workers[e].postMessage(o,a)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(n=>{const r=this._getIdleWorker();r!==-1?(this._initWorker(r),this.workerStatus|=1<<r,this.workersResolve[r]=n,this.workers[r].postMessage(e,t)):this.queue.push({resolve:n,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}class ou{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Df{constructor(e,t,n,r){this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const Fo=[171,75,84,88,32,50,48,187,13,10,26,10];function ap(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}let kv,au,Ov;const uc={env:{emscripten_notify_memory_growth:function(s){Ov=new Uint8Array(au.exports.memory.buffer)}}};class WA{init(){return kv||(kv=typeof fetch<"u"?fetch("data:application/wasm;base64,"+Lv).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,uc)).then(this._init):WebAssembly.instantiate(Buffer.from(Lv,"base64"),uc).then(this._init),kv)}_init(e){au=e.instance,uc.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!au)throw new Error("ZSTDDecoder: Await .init() before decoding.");const n=e.byteLength,r=au.exports.malloc(n);Ov.set(e,r),t=t||Number(au.exports.ZSTD_findDecompressedSize(r,n));const o=au.exports.malloc(t),a=au.exports.ZSTD_decompress(o,t,r,n),u=Ov.slice(o,o+a);return au.exports.free(r),au.exports.free(o),u}}const Lv="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",Eg=new WeakMap;let Sg,Rf=0;class hc extends c.aNw{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new ww,this.workerSourceURL="",this.workerConfig=null,typeof MSC_TRANSCODER<"u"&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){const e=new c.hH6(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),n=new c.hH6(this.manager);n.setPath(this.transcoderPath),n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials);const r=n.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,r]).then(([o,a])=>{const u=hc.BasisWorker.toString(),p=["/* constants */","let _EngineFormat = "+JSON.stringify(hc.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(hc.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(hc.BasisFormat),"/* basis_transcoder.js */",o,"/* worker */",u.substring(u.indexOf("{")+1,u.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p])),this.transcoderBinary=a,this.workerPool.setWorkerCreator(()=>{const f=new Worker(this.workerSourceURL),m=this.transcoderBinary.slice(0);return f.postMessage({type:"init",config:this.workerConfig,transcoderBinary:m},[m]),f})}),Rf>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),Rf++}return this.transcoderPending}load(e,t,n,r){if(this.workerConfig===null)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const o=new c.hH6(this.manager);o.setResponseType("arraybuffer"),o.setWithCredentials(this.withCredentials),o.load(e,a=>{if(Eg.has(a))return Eg.get(a).promise.then(t).catch(r);this.createTexture(a).then(u=>t?t(u):null).catch(r)},n,r)}_createTextureFrom(e){const{mipmaps:t,width:n,height:r,format:o,type:a,error:u,dfdTransferFn:p,dfdFlags:f}=e;if(a==="error")return Promise.reject(u);const m=new c.EB7(t,n,r,o,c.ywz);return m.minFilter=t.length===1?c.wem:c.D1R,m.magFilter=c.wem,m.generateMipmaps=!1,m.needsUpdate=!0,m.encoding=p===2?c.knz:c.rnI,m.premultiplyAlpha=!!(1&f),m}createTexture(e,t={}){const n=function(a){const u=new Uint8Array(a.buffer,a.byteOffset,Fo.length);if(u[0]!==Fo[0]||u[1]!==Fo[1]||u[2]!==Fo[2]||u[3]!==Fo[3]||u[4]!==Fo[4]||u[5]!==Fo[5]||u[6]!==Fo[6]||u[7]!==Fo[7]||u[8]!==Fo[8]||u[9]!==Fo[9]||u[10]!==Fo[10]||u[11]!==Fo[11])throw new Error("Missing KTX 2.0 identifier.");const p=new ou,f=17*Uint32Array.BYTES_PER_ELEMENT,m=new Df(a,Fo.length,f,!0);p.vkFormat=m._nextUint32(),p.typeSize=m._nextUint32(),p.pixelWidth=m._nextUint32(),p.pixelHeight=m._nextUint32(),p.pixelDepth=m._nextUint32(),p.layerCount=m._nextUint32(),p.faceCount=m._nextUint32();const y=m._nextUint32();p.supercompressionScheme=m._nextUint32();const S=m._nextUint32(),M=m._nextUint32(),P=m._nextUint32(),D=m._nextUint32(),j=m._nextUint64(),k=m._nextUint64(),L=new Df(a,Fo.length+f,3*y*8,!0);for(let Kt=0;Kt<y;Kt++)p.levels.push({levelData:new Uint8Array(a.buffer,a.byteOffset+L._nextUint64(),L._nextUint64()),uncompressedByteLength:L._nextUint64()});const R=new Df(a,S,M,!0),W={vendorId:R._skip(4)._nextUint16(),descriptorType:R._nextUint16(),versionNumber:R._nextUint16(),descriptorBlockSize:R._nextUint16(),colorModel:R._nextUint8(),colorPrimaries:R._nextUint8(),transferFunction:R._nextUint8(),flags:R._nextUint8(),texelBlockDimension:[R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8()],bytesPlane:[R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8()],samples:[]},q=(W.descriptorBlockSize/4-6)/4;for(let Kt=0;Kt<q;Kt++){const Jt={bitOffset:R._nextUint16(),bitLength:R._nextUint8(),channelType:R._nextUint8(),samplePosition:[R._nextUint8(),R._nextUint8(),R._nextUint8(),R._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&Jt.channelType?(Jt.sampleLower=R._nextInt32(),Jt.sampleUpper=R._nextInt32()):(Jt.sampleLower=R._nextUint32(),Jt.sampleUpper=R._nextUint32()),W.samples[Kt]=Jt}p.dataFormatDescriptor.length=0,p.dataFormatDescriptor.push(W);const J=new Df(a,P,D,!0);for(;J._offset<D;){const Kt=J._nextUint32(),Jt=J._scan(Kt),tn=ap(Jt),Mn=J._scan(Kt-Jt.byteLength);p.keyValue[tn]=tn.match(/^ktx/i)?ap(Mn):Mn,J._offset%4&&J._skip(4-J._offset%4)}if(k<=0)return p;const ee=new Df(a,j,k,!0),he=ee._nextUint16(),xe=ee._nextUint16(),De=ee._nextUint32(),Fe=ee._nextUint32(),ke=ee._nextUint32(),Qe=ee._nextUint32(),Oe=[];for(let Kt=0;Kt<y;Kt++)Oe.push({imageFlags:ee._nextUint32(),rgbSliceByteOffset:ee._nextUint32(),rgbSliceByteLength:ee._nextUint32(),alphaSliceByteOffset:ee._nextUint32(),alphaSliceByteLength:ee._nextUint32()});const ze=j+ee._offset,$e=ze+De,Ge=$e+Fe,ot=Ge+ke,yt=new Uint8Array(a.buffer,a.byteOffset+ze,De),Mt=new Uint8Array(a.buffer,a.byteOffset+$e,Fe),pt=new Uint8Array(a.buffer,a.byteOffset+Ge,ke),Qt=new Uint8Array(a.buffer,a.byteOffset+ot,Qe);return p.globalData={endpointCount:he,selectorCount:xe,imageDescs:Oe,endpointsData:yt,selectorsData:Mt,tablesData:pt,extendedData:Qt},p}(new Uint8Array(e));if(n.vkFormat!==0)return async function(a){const{vkFormat:u,pixelWidth:p,pixelHeight:f,pixelDepth:m}=a;if(Nv[u]===void 0)throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");const y=a.levels[0];let S,M;if(a.supercompressionScheme===0)S=y.levelData;else{if(a.supercompressionScheme!==2)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");Sg||(Sg=new Promise(async D=>{const j=new WA;await j.init(),D(j)})),S=(await Sg).decode(y.levelData,y.uncompressedByteLength)}M=Cg[u]===c.VzW?new Float32Array(S.buffer,S.byteOffset,S.byteLength/Float32Array.BYTES_PER_ELEMENT):Cg[u]===c.cLu?new Uint16Array(S.buffer,S.byteOffset,S.byteLength/Uint16Array.BYTES_PER_ELEMENT):S;const P=m===0?new c.IEO(M,p,f):new c.JUT(M,p,f,m);return P.type=Cg[u],P.format=Nv[u],P.encoding=Bf[u]||c.rnI,P.needsUpdate=!0,Promise.resolve(P)}(n);const r=t,o=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:r},[e])).then(a=>this._createTextureFrom(a.data));return Eg.set(e,{promise:o}),o}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),Rf--,this}}hc.BasisFormat={ETC1S:0,UASTC_4x4:1},hc.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},hc.EngineFormat={RGBAFormat:c.wk1,RGBA_ASTC_4x4_Format:c.ptH,RGBA_BPTC_Format:c.bsb,RGBA_ETC2_EAC_Format:c.ekQ,RGBA_PVRTC_4BPPV1_Format:c.eaV,RGBA_S3TC_DXT5_Format:c.ILR,RGB_ETC1_Format:c.fto,RGB_ETC2_Format:c.l0P,RGB_PVRTC_4BPPV1_Format:c._AM,RGB_S3TC_DXT1_Format:c.wuA},hc.BasisWorker=function(){let s,e,t;const n=_EngineFormat,r=_TranscoderFormat,o=_BasisFormat;self.addEventListener("message",function(m){const y=m.data;switch(y.type){case"init":s=y.config,S=y.transcoderBinary,e=new Promise(M=>{t={wasmBinary:S,onRuntimeInitialized:M},BASIS(t)}).then(()=>{t.initializeBasis(),t.KTX2File===void 0&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":e.then(()=>{try{const{width:M,height:P,hasAlpha:D,mipmaps:j,format:k,dfdTransferFn:L,dfdFlags:R}=function(q){const J=new t.KTX2File(new Uint8Array(q));function ee(){J.close(),J.delete()}if(!J.isValid())throw ee(),new Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");const he=J.isUASTC()?o.UASTC_4x4:o.ETC1S,xe=J.getWidth(),De=J.getHeight(),Fe=J.getLevels(),ke=J.getHasAlpha(),Qe=J.getDFDTransferFunc(),Oe=J.getDFDFlags(),{transcoderFormat:ze,engineFormat:$e}=function(ot,yt,Mt,pt){let Qt,Kt;const Jt=ot===o.ETC1S?u:p;for(let tn=0;tn<Jt.length;tn++){const Mn=Jt[tn];if(s[Mn.if]&&Mn.basisFormat.includes(ot)&&!(pt&&Mn.transcoderFormat.length<2)&&(!Mn.needsPowerOfTwo||f(yt)&&f(Mt)))return Qt=Mn.transcoderFormat[pt?1:0],Kt=Mn.engineFormat[pt?1:0],{transcoderFormat:Qt,engineFormat:Kt}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),Qt=r.RGBA32,Kt=n.RGBAFormat,{transcoderFormat:Qt,engineFormat:Kt}}(he,xe,De,ke);if(!xe||!De||!Fe)throw ee(),new Error("THREE.KTX2Loader:	Invalid texture");if(!J.startTranscoding())throw ee(),new Error("THREE.KTX2Loader: .startTranscoding failed");const Ge=[];for(let ot=0;ot<Fe;ot++){const yt=J.getImageLevelInfo(ot,0,0),Mt=yt.origWidth,pt=yt.origHeight,Qt=new Uint8Array(J.getImageTranscodedSizeInBytes(ot,0,0,ze));if(!J.transcodeImage(Qt,ot,0,0,ze,0,-1,-1))throw ee(),new Error("THREE.KTX2Loader: .transcodeImage failed.");Ge.push({data:Qt,width:Mt,height:pt})}return ee(),{width:xe,height:De,hasAlpha:ke,mipmaps:Ge,format:$e,dfdTransferFn:Qe,dfdFlags:Oe}}(y.buffer),W=[];for(let q=0;q<j.length;++q)W.push(j[q].data.buffer);self.postMessage({type:"transcode",id:y.id,width:M,height:P,hasAlpha:D,mipmaps:j,format:k,dfdTransferFn:L,dfdFlags:R},W)}catch(M){console.error(M),self.postMessage({type:"error",id:y.id,error:M.message})}})}var S});const a=[{if:"astcSupported",basisFormat:[o.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[n.RGB_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[o.ETC1S,o.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],u=a.sort(function(m,y){return m.priorityETC1S-y.priorityETC1S}),p=a.sort(function(m,y){return m.priorityUASTC-y.priorityUASTC});function f(m){return m<=2||(m&m-1)==0&&m!==0}};const Nv={109:c.wk1,97:c.wk1,37:c.wk1,43:c.wk1,103:c.av9,83:c.av9,16:c.av9,22:c.av9,100:c.hEm,76:c.hEm,15:c.hEm,9:c.hEm},Cg={109:c.VzW,97:c.cLu,37:c.ywz,43:c.ywz,103:c.VzW,83:c.cLu,16:c.ywz,22:c.ywz,100:c.VzW,76:c.cLu,15:c.ywz,9:c.ywz},Bf={43:c.knz,22:c.knz,15:c.knz},kf="KHR_texture_basisu";class Fv extends w{constructor(){super(...arguments),this.dependencies=[dn]}async onAdded(e){var t,n,r,o;this._importer||(this._importer=new Nr(class extends hc{constructor(a){super(a),this.setTranscoderPath("https://cdn.jsdelivr.net/gh/BinomialLLC/basis_universal@master/webgl/transcoder/build/").detectSupport(e.renderer.rendererObject)}async createTexture(a,u){const p=a.map(m=>new Uint8Array(m.slice(0))),f=await super.createTexture(a,u);return f.source._sourceImgBuffer=p,f.userData.mimeType="image/ktx2",f}},["ktx2"],!1)),bi.Importers.push(this._importer),(o=(r=(n=(t=e.getManager())===null||t===void 0?void 0:t.exporter)===null||n===void 0?void 0:n.getExporter("gltf","glb"))===null||r===void 0?void 0:r.extensions)===null||o===void 0||o.push(qA)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&bi.Importers.splice(bi.Importers.indexOf(this._importer),1),this._importer=void 0}}Fv.PluginType="KTX2LoadPlugin";const qA=s=>({writeTexture:(e,t)=>{if(e.userData.mimeType!=="image/ktx2")return;if(t.source!==void 0)return void console.warn("ktx2 export: source already set");const n=e.source._sourceImgBuffer;if(!n||!n.length)return void console.warn("ktx2 export: no source buffer for ktx2");t.extensions=t.extensions||{};const r={},o=new Blob(Array.isArray(n)?n:[n],{type:"image/ktx2"});r.source=s.processImageBlob(o,e),t.extensions[kf]=r,s.extensionsUsed[kf]=!0}});class Mg{constructor(e){this.presets=[],this.name="",this.selected=void 0,e&&(this.name=e)}async apply(e,t,n){var r,o;if(!t)return void(this.selected=void 0);let a=this.presets.find(u=>u.path===t.path);return a||(this.presets.push(t),a=t),this.selected=a,(o=(r=e.getManager())===null||r===void 0?void 0:r.importer)===null||o===void 0?void 0:o.importAsset(a,n)}}class YA extends Mg{constructor(){super(...arguments),this.name="Background"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return r&&(r.encoding=c.knz,await e.setBackground(r)),r}}class XA extends Mg{constructor(){super(...arguments),this.name="Environment"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return r&&await e.scene.setEnvironment(r),r}}class KA extends Mg{constructor(){super(...arguments),this.name="GemEnvironment"}async apply(e,t){const n=await super.apply(e,t),r=n==null?void 0:n[0];return _e(e.getPluginByType("Diamond"),"envMap",r),r}}class Of extends Mg{async apply(e,t){var n,r;const o=await super.apply(e,t,{processImported:!1});return o?(r=(n=e.getManager())===null||n===void 0?void 0:n.importer)===null||r===void 0?void 0:r.processImported(o):void 0}}class Tg extends Of{constructor(){super(...arguments),this.name="MaterialLibraries"}async apply(e,t){const n=await super.apply(e,t);return n&&await e.alert("Material Library successfully imported."),n}}class lu extends ui{constructor(){super(...arguments),this.toJSON=null,this.enabled=!0,this.presetGroups=[],this.uiConfig={type:"folder",label:"Presets",expanded:!0,limitedUi:!0,children:[()=>this.presetGroups.map(e=>({type:"dropdown",label:e.name,limitedUi:!0,children:[{value:"",label:"none"},...e.presets.map(t=>({label:t.path.split("/").pop(),value:t.path}))],getValue:()=>{var t;return((t=e.selected)===null||t===void 0?void 0:t.path)||""},setValue:t=>{e.apply(this._viewer,e.presets.find(n=>n.path===t))}})),{type:"button",label:"Download Selection",limitedUi:!0,value:()=>{const e=this.exportPresets();Wo(new File([JSON.stringify(e,null,2)],"preset.template.json",{type:"application/json"}))}},{type:"button",label:"Export Preset Groups",hidden:!0,limitedUi:!1,value:()=>{const e=this.exportPresetGroups();Wo(new File([JSON.stringify(e,null,2)],"presetGroups.json",{type:"application/json"}))}}]}}async onAdded(e){var t,n;await super.onAdded(e),this.presetGroups.push(new YA),this.presetGroups.push(new XA),this.presetGroups.push(new KA),this.presetGroups.push(new Of("Ground")),this.presetGroups.push(new Of("CameraViews")),this.presetGroups.push(new Of("MaterialConfiguration")),this.presetGroups.push(new Tg),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}exportPresets(){const e=Object.fromEntries(this.presetGroups.map(t=>{var n;return[t.name,((n=t.selected)===null||n===void 0?void 0:n.path)||void 0]}).filter(([,t])=>t));return e.type=lu.PluginType,e}async fromJSON(e,t){var n,r;if(!super.fromJSON(e,t))return null;const o={...e};delete o.type;const a=[];for(const[u,p]of Object.entries(o)){const f=this.presetGroups.find(S=>S.name===u),m=f==null?void 0:f.presets;if(!f||!m)continue;const y=typeof p=="string"?{path:p}:p;a.push(f.apply(this._viewer,y))}return await Promise.all(a),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0),this}loadPresetGroups(e){var t;for(const[n,r]of Object.entries(e)){const o=(t=this.presetGroups.find(a=>a.name===n))===null||t===void 0?void 0:t.presets;o==null||o.push(...r)}}exportPresetGroups(){return Object.fromEntries(this.presetGroups.map(e=>[e.name,e.presets.map(t=>t.path)]).filter(([,e])=>e.length>0))}}lu.PluginType="PresetLibraryPlugin";var dc=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let ga=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this.scenes=[],this.assets={},this.toJSON=void 0,this._isPlaying=!1,this._isPlayingLoop=!1,this._options={},this.minSceneTime=2e3,this.loadScenes=this.loadScenes.bind(this),this.play=this.play.bind(this),this.stop=this.stop.bind(this),this.downloadScenes=this.downloadScenes.bind(this),this.promptLoadScenes=this.promptLoadScenes.bind(this)}get loadedScenes(){return this.scenes.length}async promptLoadScenes(){const s=await Tc(!0,!1,"model/gltf");await this.loadScenes(s)}async loadScenes(s){var e,t;const n=await Promise.all(s.map(async r=>await r.arrayBuffer()));for(let r=0;r<s.length;r++){const o=s[r];this.scenes.push({[o.name]:new Uint8Array(n[r])}),this.assets[o.name]={path:o.name,file:o}}(t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e)}async play(){var s;if(!this._viewer||this._isPlaying||this._isPlayingLoop)return;this._isPlaying=!0,this._isPlayingLoop=!0;const e=this._viewer.getPluginByType("AssetManagerBasicPopupPlugin");e==null||e.enabled,e&&(e.enabled=!1);const t=this._viewer.getPluginByType("FrameFade"),n=this._viewer.getPluginByType("GLTFAnimation"),r=this._viewer.getPluginByType("CameraViews");for(;this._isPlaying;)for(const o of this.scenes){if(!this._isPlaying)break;const a=Object.keys(o);n==null||n.stopAnimation(!1),await(r==null?void 0:r.stopAllAnimations()),this._viewer.scene.removeSceneModels(),this._viewer.renderEnabled=!1;for(const p of a){let f=this.assets[p];f||(f={path:p,file:new File([o[p]],p)},this.assets[p]=f),await((s=this._viewer.getManager())===null||s===void 0?void 0:s.addAssetSingle(f,this._options))}if(!this._isPlaying)break;this._viewer.renderEnabled=!0,e&&(e.enabled=!1),t&&(t.enabled=!0,await t.startTransition(1e3));const u=[is(this.minSceneTime)];n&&u.push(n.playAnimation()),r&&u.push(r.animateAllViews()),await Promise.all(u)}this._isPlayingLoop=!1}stop(){this._isPlaying=!1}async downloadScenes(){const s={};for(const t of this.scenes)for(const n of Object.keys(t)){const r=s[n]?n+"_":n;s[r]=t[r]}const e=V0(s);Ss(new Blob([e],{type:"application/zip"}),"scenes.glbloop")}async onAdded(s){await super.onAdded(s);const e=this;bi.Importers.push(new Nr(class extends km{load(t,n,r,o){super.load(t,a=>{e.loadScenes([...a.values()]),n==null||n(null),is(100).then(e.play)},r,o)}},["glbloop"],!0))}};ga.PluginType="SceneLoopPlugin",dc([ja("Loaded scenes")],ga.prototype,"loadedScenes",null),dc([Ji("Load Scenes")],ga.prototype,"promptLoadScenes",null),dc([ja("Playing")],ga.prototype,"_isPlaying",void 0),dc([Si("Min Scene Time")],ga.prototype,"minSceneTime",void 0),dc([Ji("Play")],ga.prototype,"play",null),dc([Ji("Stop")],ga.prototype,"stop",null),dc([Ji("Download Scenes")],ga.prototype,"downloadScenes",null),ga=dc([Ci("Scene Loop")],ga);var JA=__webpackgi_require__(701),Uv=__webpackgi_require__.n(JA),xw=__webpackgi_require__(236),Ig=__webpackgi_require__.n(xw),$A=__webpackgi_require__(850),jv=__webpackgi_require__.n($A),Pg=__webpackgi_require__(182),Lf=__webpackgi_require__.n(Pg),Ew=__webpackgi_require__(213),zv=__webpackgi_require__.n(Ew),Dg=__webpackgi_require__(798),lp={};Dg.Z&&Dg.Z.locals&&(lp.locals=Dg.Z.locals);var Rg,cu=0,td={};td.styleTagTransform=zv(),td.setAttributes=jv(),td.insert=function(s,e){(e.target||document.head).appendChild(s)},td.domAPI=Ig(),td.insertStyleElement=Lf(),lp.use=function(s){return td.options=s||{},cu++||(Rg=Uv()(Dg.Z,td)),lp},lp.unuse=function(){cu>0&&!--cu&&(Rg(),Rg=null)};var Bg,ZA=lp,nh=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let uu=Bg=class extends ui{constructor(){super(),this.enabled=!0,this.dependencies=[dn],this._popupDiv=Cr({id:"assetManagerPopup",addToBody:!1,innerHTML:""});const s=Cr({id:"assetManagerPopupClose",addToBody:!1,innerHTML:"&#10005"});s.addEventListener("click",()=>{this._popupDiv.style.display="none"}),this._popupContent=Cr({id:"assetManagerPopupContent",addToBody:!1,innerHTML:""}),this.enabled||(this._popupDiv.style.display="none"),this._popupDiv.appendChild(s),this._popupDiv.appendChild(this._popupContent)}_onEnabledChange(){this.enabled||(this._popupDiv.style.display="none")}_updatePopupDiv(s){if(!this._popupContent)return;if(!this.enabled)return void(this._popupDiv.style.display="none");let e="";s.forEach((t,n)=>{e+=`<span class="processState">${t.state}</span>: ${n.split("/").pop()} ${t.progress?" - "+t.progress:""}<br>`}),this._popupContent.innerHTML=e,s.size===0?this._popupDiv.style.display="none":this._popupDiv.style.display="block"}async onAdded(s){var e,t,n,r;await super.onAdded(s),ZA.use({target:s.container}),s.container.appendChild(this._popupDiv);const o=new Map;(t=(e=s.getManager())===null||e===void 0?void 0:e.importer)===null||t===void 0||t.addEventListener("importFile",a=>{a.state!=="done"?o.set(a.path,{state:a.state,progress:a.progress?(100*a.progress).toFixed(0)+"%":void 0}):o.delete(a.path),this._updatePopupDiv(o)}),(r=(n=s.getManager())===null||n===void 0?void 0:n.exporter)===null||r===void 0||r.addEventListener("exportFile",a=>{a.state!=="done"?o.set(a.obj.name,{state:a.state,progress:a.progress?(100*a.progress).toFixed(0)+"%":void 0}):o.delete(a.obj.name),this._updatePopupDiv(o)})}};uu.PluginType="AssetManagerBasicPopupPlugin",nh([_n("Enabled"),we(Bg.prototype._onEnabledChange),et()],uu.prototype,"enabled",void 0),uu=Bg=nh([Ci("Asset manager popup")],uu);class Sw extends _s{constructor(e){super({vertexShader:C.vertexShader,uniforms:{tDiffuse:{value:null}},defines:{},fragmentShader:`
                varying vec2 vUv;
                ${e[0]}
                void main() {
                    gl_FragColor = tDiffuseTexelToLinear (texture2D(tDiffuse, vUv));
                    #glMarker
                    ${e[1]}
                }
                `},"tDiffuse"),this.uiConfig=void 0,this.customMaterial=new Dc}render(e,t,n,r,o){super.render(e,t,n,r,o),this.needsSwap=!0}}class Mo extends xl{constructor(e=!0,t=!0){super(),this.depthTonemap=e,this.passId="combinedPost",this.dependencies=[xr],this.toJSON=void 0,this._beforeFilters=[],this._afterFilters=["render"],this._requiredFilters=["render"],this._renderToScreen=!0,this._setDirty=this._setDirty.bind(this),this._renderToScreen=t}get renderToScreen(){return this._renderToScreen}async onAdded(e){var t,n;return!((n=(t=this._viewer)===null||t===void 0?void 0:t.screenShader)===null||n===void 0)&&n.isShaderPass2&&(this._renderToScreen=!1),this._renderToScreen&&_e(e.renderer.passes.find(r=>r.passId==="screen"),"enabled",!1,!0,!0),super.onAdded(e)}passCtor(e){var t,n,r,o;const a=e.screenShader,u=["",""];this._renderToScreen&&!a.isShaderPass2&&(u[0]=Array.isArray(a)?a[0]:((t=a)===null||t===void 0?void 0:t.pars)||"",u[1]=Array.isArray(a)?a[1]:typeof a=="string"?a:((n=a)===null||n===void 0?void 0:n.main)||"");const p=new Sw(u);return _e((o=(r=p.uiConfig)===null||r===void 0?void 0:r.children)===null||o===void 0?void 0:o.find(f=>{var m;return((m=f)===null||m===void 0?void 0:m.label)==="Enabled"}),"hidden",!0,!0),p}_update(e){var t;return!!super._update(e)&&(this._pass.passObject.updateShaderProperties((t=this._viewer)===null||t===void 0?void 0:t.getPlugin(xr)),!0)}_setDirty(){this.pass&&(this.pass.dirty=!0)}get uiConfig(){var e,t,n;return(n=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{}}addExtension(e){this.pass.passObject.material.registerMaterialExtensions([e])}}Mo.PluginType="CombinedPostPlugin";var ey=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class hu extends ui{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[Mo]}get uiConfig(){var e;return(e=this._extension)===null||e===void 0?void 0:e.uiConfig}get config(){return this._extension}disposeExtension(){}async onAdded(e){var t;await super.onAdded(e),this._extension=this.generateExtension(e),(t=e.getPlugin(Mo))===null||t===void 0||t.addExtension(this._extension)}async onRemove(e){this.disposeExtension(),this._extension=void 0,await super.onRemove(e)}}ey([et("extension")],hu.prototype,"_extension",void 0),ey([et()],hu.prototype,"enabled",void 0);class ih{constructor(){this.uiConfig=void 0,this.enabled=!0}shaderExtender(e,t,n){this.enabled&&(e.fragmentShader=Lr(e.fragmentShader,"#glMarker",` 
            gl_FragColor = LinearTosRGB(gl_FragColor);
            #glMarker
        `))}computeCacheKey(e){return this.enabled?"1":"0"}isCompatible(e){return!0}}class kg extends hu{generateExtension(e){return new ih}}kg.PluginType="GammaCorrection";var Nf,kl=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ty=c.dZ3;let rh=Nf=class{constructor(s,e=!0,t=!0){this.depthTonemap=e,this.toneMapping=c.LY2,this.tonemapBackground=!0,this.clipBackground=!1,this.exposure=1,this._renderToScreen=!0,this.enabled=!0,this._rendererState={},this.extraUniforms={tNormalDepth:{value:null},tGBufferFlags:{value:null},opacity:{value:1}},this.parsFragmentSnippet=(n,r)=>this.enabled?Z`
            ${this.depthTonemap?Yl:""}
            #define USE_DEPTH_TONEMAP ${this.depthTonemap?"1":"0"}
            uniform float opacity;
            ${`vec4 ToneMapping(in vec4 color){vec4 outColor=opacity*color;
#if USE_DEPTH_TONEMAP > 0
bool doTonemap=getGBufferFlags(vUv).x>0.5;float depth=getDepth(vUv);
#if TONEMAP_BACKGROUND < 1 || TRANSPARENT_BACKGROUND > 0
bool isBackground=depth>0.9999;if(isBackground)doTonemap=false;
#endif
if(doTonemap){
#endif
#if defined( TONE_MAPPING )
outColor.rgb=toneMapping(outColor.rgb);
#endif
#if USE_DEPTH_TONEMAP > 0
}else{
#if TRANSPARENT_BACKGROUND > 0
if(isBackground)outColor.a=0.;
#endif
}if(depth<0.00001)outColor.a=0.;
#endif
return outColor;}`}
        `:"",this._combinedPostPlugin=s.getPlugin(Mo),this._setDirty=this._setDirty.bind(this),this._renderToScreen=t,this.depthTonemap=e}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = ToneMapping(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){if(!this.enabled)return;const{toneMapping:n,toneMappingExposure:r,outputEncoding:o}=t;this._rendererState.toneMapping=n,this._rendererState.toneMappingExposure=r,this._rendererState.outputEncoding=o;let a=this.tonemapBackground?"1":"0";e.materialObject.defines.TONEMAP_BACKGROUND!==a&&(e.materialObject.defines.TONEMAP_BACKGROUND=a,e.materialObject.needsUpdate=!0),a=this.clipBackground?"1":"0",e.materialObject.defines.TRANSPARENT_BACKGROUND!==a&&(e.materialObject.defines.TRANSPARENT_BACKGROUND=a,e.materialObject.needsUpdate=!0),t.toneMapping=this.toneMapping,t.toneMappingExposure=this.exposure,t.outputEncoding=c.knz,e.materialObject.toneMapped=!0,e.materialObject.needsUpdate=!0}onAfterRender(s,e,t){t.toneMapping=this._rendererState.toneMapping,t.toneMappingExposure=this._rendererState.toneMappingExposure,t.outputEncoding=this._rendererState.outputEncoding}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};rh.PluginType="Tonemap",kl([Ao("Mode",[["Linear",c.EoG],["Reinhard",c.CdI],["Cineon",c.YGz],["ACESFilmic",c.LY2],["Uncharted2",ty]].map(s=>({label:s[0],value:s[1]})),{limitedUi:!0}),we(Nf.prototype._setDirty),et()],rh.prototype,"toneMapping",void 0),kl([_n("Tonemap Background",{limitedUi:!0}),et()],rh.prototype,"tonemapBackground",void 0),kl([we(Nf.prototype._setDirty),_n("Clip Background"),et()],rh.prototype,"clipBackground",void 0),kl([we(Nf.prototype._setDirty),wn("Exposure",[0,2*Math.PI],.01,{limitedUi:!0}),et()],rh.prototype,"exposure",void 0),rh=Nf=kl([Ci("Tonemapping")],rh);class Ff extends hu{constructor(e=!0){super(),this.depthTonemap=e,this.depthTonemap=e}fromJSON(e,t){return e.pass&&((e={...e}).extension={...e.pass},delete e.extension.enabled,delete e.pass),super.fromJSON(e,t)}generateExtension(e){return new rh(e,this.depthTonemap)}get exposure(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.exposure)!==null&&t!==void 0?t:1}set exposure(e){this._extension&&(this._extension.exposure=e,this._extension.setDirty())}get toneMapping(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.toneMapping)!==null&&t!==void 0?t:c.EoG}set toneMapping(e){this._extension&&(this._extension.toneMapping=e,this._extension.setDirty())}}Ff.PluginType="Tonemap",c.WdD.tonemapping_pars_fragment=c.WdD.tonemapping_pars_fragment.replace("vec3 CustomToneMapping( vec3 color ) { return color; }",`

// source: http://filmicworlds.com/blog/filmic-tonemapping-operators/
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {

	// John Hable's filmic operator from Uncharted 2 video game
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( 1.0 ) ) );

}

vec3 CustomToneMapping( vec3 color ) { return Uncharted2ToneMapping( color ); }

`);var Uf,cp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let up=Uf=class{constructor(s){this.enabled=!1,this.intensity=1,this.lutMap=void 0,this.extraUniforms={intensity:{value:1},lutSize:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?`#if USE_LUT == 1
uniform float lutSize;uniform float intensity;
#if USE_3DTEXTURE == 1
precision highp sampler3D;uniform sampler3D lut3d;
#else
uniform sampler2D lut;vec3 lutLookup(sampler2D tex,float size,vec3 rgb){float sliceHeight=1./size;float yPixelHeight=1./(size*size);float slice=rgb.b*size;float interp=fract(slice);float slice0=slice-interp;float centeredInterp=interp-0.5;float slice1=slice0+sign(centeredInterp);float greenOffset=clamp(rgb.g*sliceHeight,yPixelHeight*0.5,sliceHeight-yPixelHeight*0.5);vec2 uv0=vec2(rgb.r,slice0*sliceHeight+greenOffset);vec2 uv1=vec2(rgb.r,slice1*sliceHeight+greenOffset);vec3 sample0=texture2D(tex,uv0).rgb;vec3 sample1=texture2D(tex,uv1).rgb;return mix(sample0,sample1,abs(centeredInterp));}
#endif
vec4 colorLookUp(in vec4 color){vec4 outColor;float pixelWidth=1./lutSize;float halfPixelWidth=0.5/lutSize;vec3 uvw=vec3(halfPixelWidth)+color.rgb*(1.-pixelWidth);float lutFac=step(0.0001,getGBufferFlags(vUv).a);
#if USE_3DTEXTURE == 1
outColor=vec4(texture(lut3d,uvw).rgb,color.a);
#else
outColor=vec4(lutLookup(lut,lutSize,uvw),color.a);
#endif
outColor=mix(color,outColor,lutFac);return vec4(mix(color,outColor,intensity));}
#endif
`:"",this._combinedPostPlugin=s.getPlugin(Mo),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker",` 
            #if USE_LUT == 1
                gl_FragColor = colorLookUp(gl_FragColor);
            #endif
            #glMarker
        `))}onObjectRender(s,e,t){if(this.enabled)if(this.lutMap){const n=this.lutMap.texture3D?1:0;e.materialObject.defines.USE_3DTEXTURE!==n&&(e.materialObject.defines.USE_3DTEXTURE=n,e.materialObject.needsUpdate=!0);let r=1;this.lutMap.texture3D?(e.materialObject.uniforms.lut3d={value:this.lutMap.texture3D},e.materialObject.uniforms.lut3d.value.needsUpdate=!0,r=this.lutMap.texture3D.image.width):this.lutMap.texture&&(e.materialObject.uniforms.lut={value:this.lutMap.texture},e.materialObject.uniforms.lut.value.needsUpdate=!0,r=this.lutMap.texture.image.width),e.materialObject.uniforms.lutSize.value=r,e.materialObject.uniforms.intensity.value=this.intensity,e.materialObject.defines.USE_LUT=1}else e.materialObject.defines.USE_3DTEXTURE=0,e.materialObject.defines.USE_LUT=0,e.materialObject.needsUpdate=!0}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}};cp([et(),we(Uf.prototype._setDirty),_n("Enable")],up.prototype,"enabled",void 0),cp([et(),we(Uf.prototype._setDirty),wn("Intensity")],up.prototype,"intensity",void 0),cp([we(Uf.prototype._setDirty),Th("LUT"),et()],up.prototype,"lutMap",void 0),up=Uf=cp([Ci("LUT")],up);class Og extends hu{generateExtension(e){return new up(e)}}Og.PluginType="LUT";var jf,Qi=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let nd=jf=class{constructor(s){this.enabled=!1,this.power=.5,this.bgcolor=new c.Ilk(0),this.extraUniforms={power:{value:1},bgcolor:{value:new c.Ilk}},this.parsFragmentSnippet=(e,t)=>this.enabled?Z`
            uniform float power;
            uniform vec3 bgcolor;
            ${"vec4 Vignette(in vec4 color){vec2 uv=vUv*(1.-vUv);float vig=uv.x*uv.y*16.;vig=pow(vig,power);return vec4(mix(color.rgb,vec3(bgcolor),1.-vig),color.a);}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Mo),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = Vignette(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.power.value=this.power,e.materialObject.uniforms.bgcolor.value.copy(this.bgcolor))}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};nd.PluginType="Vignette",Qi([we(jf.prototype._setDirty),_n("Enable"),et()],nd.prototype,"enabled",void 0),Qi([we(jf.prototype._setDirty),wn("Power",[.1,4],.01,{limitedUi:!0}),et()],nd.prototype,"power",void 0),Qi([we(jf.prototype._setDirty),dl("Color"),et()],nd.prototype,"bgcolor",void 0),nd=jf=Qi([Ci("Vignette")],nd);class Lg extends hu{constructor(){super()}generateExtension(e){return new nd(e)}get power(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.power)!==null&&t!==void 0?t:1}set power(e){this._extension&&(this._extension.power=e,this._extension.setDirty())}get color(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.bgcolor)!==null&&t!==void 0?t:new c.Ilk}set color(e){this._extension&&(this._extension.bgcolor.copy(e),this._extension.setDirty())}}Lg.PluginType="Vignette";var Ng,Vv=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let sh=Ng=class{constructor(s){this.enabled=!1,this.aberrationIntensity=.01,this.extraUniforms={aberrationIntensity:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?Z`
            uniform float aberrationIntensity;
            ${"vec4 chromaticAberration(){vec2 distFromCenter=vUv-0.5;vec2 aberrated=aberrationIntensity*pow(distFromCenter,vec2(2.));vec4 color=tDiffuseTexelToLinear(texture2D(tDiffuse,vUv));vec4 outColor=vec4(tDiffuseTexelToLinear(texture2D(tDiffuse,vUv+aberrated)).r,color.g,tDiffuseTexelToLinear(texture2D(tDiffuse,vUv-aberrated)).b,color.a);return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Mo),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = chromaticAberration();
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.aberrationIntensity.value=this.aberrationIntensity)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};sh.PluginType="ChromaticAberration",Vv([we(Ng.prototype._setDirty),_n("Enable"),et()],sh.prototype,"enabled",void 0),Vv([we(Ng.prototype._setDirty),wn("Intensity",[0,.1],.001,{limitedUi:!0}),et()],sh.prototype,"aberrationIntensity",void 0),sh=Ng=Vv([Ci("ChromaticAberration")],sh);class Fg extends hu{constructor(){super()}generateExtension(e){return new sh(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.aberrationIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.aberrationIntensity=e,this._extension.setDirty())}}Fg.PluginType="ChromaticAberration";var zf,Ug=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let hp=zf=class{constructor(s){this.enabled=!1,this.grainMultiply=!1,this.grainIntensity=10,this.extraUniforms={grainIntensity:{value:1},grainMultiply:{value:1}},this.parsFragmentSnippet=(e,t)=>this.enabled?Z`
            uniform float grainIntensity;
            uniform bool grainMultiply;
            ${"vec4 grain(in vec4 color){float x=(vUv.x+4.)*(vUv.y+4.)*(10.);vec4 grain=vec4(mod((mod(x,13.)+1.)*(mod(x,123.)+1.),0.01)-0.005)*grainIntensity;vec4 outColor=color;if(grainMultiply){grain=1.-grain;outColor.rgb=color.rgb*vec3(grain);}else{outColor.rgb=color.rgb+vec3(grain);}return outColor;}"}
        `:"",this._combinedPostPlugin=s.getPlugin(Mo),this._setDirty=this._setDirty.bind(this)}shaderExtender(s,e,t){this.enabled&&(s.fragmentShader=Lr(s.fragmentShader,"#glMarker",` 
            gl_FragColor = grain(gl_FragColor);
            #glMarker
        `))}onObjectRender(s,e,t){this.enabled&&(e.materialObject.uniforms.grainIntensity.value=this.grainIntensity,e.materialObject.uniforms.grainMultiply.value=this.grainMultiply)}getUiConfig(){return this.uiConfig}computeCacheKey(s){return this.enabled?"1":"0"}isCompatible(s){return!0}_setDirty(){this._combinedPostPlugin&&(this._combinedPostPlugin.pass.dirty=!0)}setDirty(){this._setDirty()}};Ug([we(zf.prototype._setDirty),_n("Enable"),et()],hp.prototype,"enabled",void 0),Ug([we(zf.prototype._setDirty),_n("Multiply"),et()],hp.prototype,"grainMultiply",void 0),Ug([we(zf.prototype._setDirty),wn("Intensity",[0,20],.01,{limitedUi:!0}),et()],hp.prototype,"grainIntensity",void 0),hp=zf=Ug([Ci("FilmicGrain")],hp);class jg extends hu{constructor(){super()}generateExtension(e){return new hp(e)}get intensity(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainIntensity)!==null&&t!==void 0?t:1}set intensity(e){this._extension&&(this._extension.grainIntensity=e,this._extension.setDirty())}get multiply(){var e,t;return(t=(e=this._extension)===null||e===void 0?void 0:e.grainMultiply)!==null&&t!==void 0&&t}set multiply(e){this._extension&&(this._extension.grainMultiply=e,this._extension.setDirty())}}async function zg(s,{ground:e=!0,bloom:t=!0,depthTonemap:n=!0,enableDrop:r=!1}={}){await s.addPlugin(xr),await s.addPlugin(ts),r&&await s.addPlugin(Yp),await s.addPlugin(new lo(32)),await s.addPlugin(new Mo),await s.addPlugin(new Fg),await s.addPlugin(new Ff(n||!s.useRgbm)),await s.addPlugin(new Og),await s.addPlugin(new Lg),await s.addPlugin(new jg),await s.addPlugin(new kg),await s.addPlugin(Vm),await s.addPlugin(Qm),await s.addPlugin(Qr),await s.addPlugin(Zc),await s.addPlugin(Br),e&&await s.addPlugin(ha),t&&await s.addPlugin(Zu),await s.addPlugin(pa),await s.addPlugin(Ta),await s.addPlugin(co),await s.addPlugin($s),await s.addPlugin(Ja),await s.addPlugin(Cf,!1),await s.addPlugin(Mf),await s.addPlugin(rs),await s.addPlugin(nu,!1),await s.addPlugin(ma,!1),await s.addPlugin(su,!1),await s.addPlugin(ys,!1),await s.addPlugin(Fv),await s.addPlugin(lu),await s.addPlugin(ga)}async function Vg(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:r=!1,importPopup:o=!0,enableDrop:a=!1}={}){var u;const p=new Ya(s);e&&await p.addPlugin(Pl);const f=await p.addPlugin(dn,void 0,void 0,{storage:caches?await caches.open("webgi-cache-storage"):void 0});return o&&await p.addPlugin(uu),await zg(p,{ground:t,bloom:n,depthTonemap:r,enableDrop:a}),p.renderer.refreshPipeline(),(u=f.importer)===null||u===void 0||u.processors.add("model",{forAssetType:"model",process:(m,y)=>m}),p}jg.PluginType="FilmicGrain";let Cw=0;class ny extends HTMLElement{constructor(){super(),this._initialized=!1,this._state={src:"",environment:""},this._models={},this._refreshingModels=!1,this._refreshingEnvironment=!1,this.viewerIndex=Cw++,this.canvasId="webgi-viewer-"+this.viewerIndex,this.attachShadow({mode:"open"}),this.wrapper=document.createElement("div"),this.wrapper.style.width="100%",this.wrapper.style.height="100%",this.wrapper.style.display="block",this.canvas=Mc(),this.canvas.setAttribute("id",this.canvasId);const e=document.createElement("style");e.textContent=se`
            #${this.canvasId}{
              width: 100%; height: 100%; z-index: 1;
              display: block;
            }
        `,this.wrapper.append(this.canvas),this.shadowRoot.append(e,this.wrapper),this._initialize().then(async()=>this.refreshAll())}async refreshAll(){await Promise.all([this.refreshModelSource(),this.refreshEnvironment()])}async _initialize(){this._initialized||(this.viewer=await Vg({canvas:this.canvas,useRgbm:this._getAttr("rgbm","true")==="true",useGBufferDepth:this._getAttr("depth-prepass","true")==="true"},{debug:this._getAttr("debug","false")==="true",ground:this._getAttr("ground","baked")==="baked",bloom:this._getAttr("bloom","true")==="true",depthTonemap:!0}),this._initialized=!0,this.dispatchEvent(new Event("initialized")))}connectedCallback(){console.log("WebGiViewerElement added to page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}disconnectedCallback(){console.log("WebGiViewerElement removed from page."),this.viewer&&(this.viewer.enabled=!1)}adoptedCallback(){console.log("WebGiViewerElement moved to new page."),this.viewer&&(this.viewer.resize(),this.viewer.enabled=!0)}static get observedAttributes(){return["src","environment"]}attributeChangedCallback(e,t,n){console.log("WebGiViewerElement attributes changed.",e,t,n),this.refreshAll()}clearModels(){}async refreshModelSource(){if(!this.viewer)return;const e=this._getAttr("src","");if(e===this._state.src||this._refreshingModels)return;this._refreshingModels=!0;const t=[e],n=[],r=[];for(const o of t)!this._models[o]&&o&&(this._models[o]=this.viewer.getManager().importer.importPath(o,{autoScale:this._getAttr("auto-scale","true")==="true",autoCenter:this._getAttr("auto-center","true")==="true",processImported:!1}));for(const[o,a]of Object.entries(this._models))t.includes(o)?n.push(a):r.push(a);await Promise.all([Promise.all(n).then(async o=>Promise.all(o.map(async a=>this.viewer.getManager().importer.processImported(a)))).then(o=>{for(const a of o)for(const u of a)u&&u.assetType==="model"&&this.viewer.scene.addSceneObject(u)}),Promise.all(r).then(o=>{for(const a of o)for(const u of a)u&&u.assetType==="model"&&u.modelObject.removeFromParent()})]),this._state.src=e,this._refreshingModels=!1}async refreshEnvironment(){if(!this.viewer)return;if(!this.hasAttribute("environment"))return void(this._state.environment=null);const e=this._getAttr("environment","");if(e===this._state.src||this._refreshingEnvironment)return;this._refreshingEnvironment=!0;const t=this.viewer.scene.getEnvironment(),n=e?await this.viewer.getManager().importer.importSinglePath(e):void 0;n&&n.assetType!=="texture"||await this.viewer.scene.setEnvironment(n),t==null||t.dispose(),this._state.environment=e,this._refreshingEnvironment=!1}_getAttr(e,t){return this.hasAttribute(e)?this.getAttribute(e):t}}window&&window.customElements&&!window.customElements.get("webgi-viewer")&&window.customElements.define("webgi-viewer",ny);class iy{constructor(e){var t,n,r;this._basePath=(t=e==null?void 0:e.basePath)!==null&&t!==void 0?t:"",this._assets=(r=(n=e==null?void 0:e.assets)===null||n===void 0?void 0:n.map(o=>this._resolveAsset(o)))!==null&&r!==void 0?r:[]}get basePath(){return this._basePath}get assets(){return this._assets}find(e){const t=this._assets.find(e);return t??void 0}_resolveAsset(e){return{...e,path:Su([this._basePath,e.path])}}}class Mw extends w{constructor(...e){super(),this._assets=e}addAssetList(e){this._assets.push(e)}removeAssetList(e){const t=this._assets.indexOf(e);t>=0&&this._assets.splice(t,1)}async findAssetRegex(e){for(const t of this._assets){const n=t.find(r=>{var o,a;return r&&(e.test(r.path)||e.test((a=(o=r.file)===null||o===void 0?void 0:o.name)!==null&&a!==void 0?a:""))});if(n)return n}console.warn("Asset not found:",e)}async findAsset(e){return this.findAssetRegex(e.query)}async findAssetSimple(e,t=!1){return this.findAssetRegex(new RegExp(e,t?"i":""))}}var Gv={},dp=function(s){return URL.createObjectURL(new Blob([s],{type:"text/javascript"}))},ry=function(s){return new Worker(s)};try{URL.revokeObjectURL(dp(""))}catch{dp=function(e){return"data:application/javascript;charset=UTF-8,"+encodeURI(e)},ry=function(e){return new Worker(e,{type:"module"})}}var ji=Uint8Array,Zs=Uint16Array,To=Uint32Array,du=new ji([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),oh=new ji([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Vf=new ji([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Qv=function(s,e){for(var t=new Zs(31),n=0;n<31;++n)t[n]=e+=1<<s[n-1];var r=new To(t[30]);for(n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)r[o]=o-t[n]<<5|n;return[t,r]},sy=Qv(du,2),Hv=sy[0],Gf=sy[1];Hv[28]=258,Gf[258]=28;for(var Wv=Qv(oh,0),oy=Wv[0],qv=Wv[1],Qf=new Zs(32768),zr=0;zr<32768;++zr){var pc=(43690&zr)>>>1|(21845&zr)<<1;pc=(61680&(pc=(52428&pc)>>>2|(13107&pc)<<2))>>>4|(3855&pc)<<4,Qf[zr]=((65280&pc)>>>8|(255&pc)<<8)>>>1}var Pa=function(s,e,t){for(var n=s.length,r=0,o=new Zs(e);r<n;++r)++o[s[r]-1];var a,u=new Zs(e);for(r=0;r<e;++r)u[r]=u[r-1]+o[r-1]<<1;if(t){a=new Zs(1<<e);var p=15-e;for(r=0;r<n;++r)if(s[r])for(var f=r<<4|s[r],m=e-s[r],y=u[s[r]-1]++<<m,S=y|(1<<m)-1;y<=S;++y)a[Qf[y]>>>p]=f}else for(a=new Zs(n),r=0;r<n;++r)s[r]&&(a[r]=Qf[u[s[r]-1]++]>>>15-s[r]);return a},pu=new ji(288);for(zr=0;zr<144;++zr)pu[zr]=8;for(zr=144;zr<256;++zr)pu[zr]=9;for(zr=256;zr<280;++zr)pu[zr]=7;for(zr=280;zr<288;++zr)pu[zr]=8;var fu=new ji(32);for(zr=0;zr<32;++zr)fu[zr]=5;var ss=Pa(pu,9,0),ay=Pa(pu,9,1),ds=Pa(fu,5,0),Hf=Pa(fu,5,1),Gg=function(s){for(var e=s[0],t=1;t<s.length;++t)s[t]>e&&(e=s[t]);return e},Za=function(s,e,t){var n=e/8|0;return(s[n]|s[n+1]<<8)>>(7&e)&t},Qg=function(s,e){var t=e/8|0;return(s[t]|s[t+1]<<8|s[t+2]<<16)>>(7&e)},pp=function(s){return(s/8|0)+(7&s&&1)},Uo=function(s,e,t){(e==null||e<0)&&(e=0),(t==null||t>s.length)&&(t=s.length);var n=new(s instanceof Zs?Zs:s instanceof To?To:ji)(t-e);return n.set(s.subarray(e,t)),n},id=function(s,e,t){var n=s.length;if(!n||t&&!t.l&&n<5)return e||new ji(0);var r=!e||t,o=!t||t.i;t||(t={}),e||(e=new ji(3*n));var a=function(Mn){var Rt=e.length;if(Mn>Rt){var oi=new ji(Math.max(2*Rt,Mn));oi.set(e),e=oi}},u=t.f||0,p=t.p||0,f=t.b||0,m=t.l,y=t.d,S=t.m,M=t.n,P=8*n;do{if(!m){t.f=u=Za(s,p,1);var D=Za(s,p+1,3);if(p+=3,!D){var j=s[(Fe=pp(p)+4)-4]|s[Fe-3]<<8,k=Fe+j;if(k>n){if(o)throw"unexpected EOF";break}r&&a(f+j),e.set(s.subarray(Fe,k),f),t.b=f+=j,t.p=p=8*k;continue}if(D==1)m=ay,y=Hf,S=9,M=5;else{if(D!=2)throw"invalid block type";var L=Za(s,p,31)+257,R=Za(s,p+10,15)+4,W=L+Za(s,p+5,31)+1;p+=14;for(var q=new ji(W),J=new ji(19),ee=0;ee<R;++ee)J[Vf[ee]]=Za(s,p+3*ee,7);p+=3*R;var he=Gg(J),xe=(1<<he)-1,De=Pa(J,he,1);for(ee=0;ee<W;){var Fe,ke=De[Za(s,p,xe)];if(p+=15&ke,(Fe=ke>>>4)<16)q[ee++]=Fe;else{var Qe=0,Oe=0;for(Fe==16?(Oe=3+Za(s,p,3),p+=2,Qe=q[ee-1]):Fe==17?(Oe=3+Za(s,p,7),p+=3):Fe==18&&(Oe=11+Za(s,p,127),p+=7);Oe--;)q[ee++]=Qe}}var ze=q.subarray(0,L),$e=q.subarray(L);S=Gg(ze),M=Gg($e),m=Pa(ze,S,1),y=Pa($e,M,1)}if(p>P){if(o)throw"unexpected EOF";break}}r&&a(f+131072);for(var Ge=(1<<S)-1,ot=(1<<M)-1,yt=p;;yt=p){var Mt=(Qe=m[Qg(s,p)&Ge])>>>4;if((p+=15&Qe)>P){if(o)throw"unexpected EOF";break}if(!Qe)throw"invalid length/literal";if(Mt<256)e[f++]=Mt;else{if(Mt==256){yt=p,m=null;break}var pt=Mt-254;if(Mt>264){var Qt=du[ee=Mt-257];pt=Za(s,p,(1<<Qt)-1)+Hv[ee],p+=Qt}var Kt=y[Qg(s,p)&ot],Jt=Kt>>>4;if(!Kt)throw"invalid distance";if(p+=15&Kt,$e=oy[Jt],Jt>3&&(Qt=oh[Jt],$e+=Qg(s,p)&(1<<Qt)-1,p+=Qt),p>P){if(o)throw"unexpected EOF";break}r&&a(f+131072);for(var tn=f+pt;f<tn;f+=4)e[f]=e[f-$e],e[f+1]=e[f+1-$e],e[f+2]=e[f+2-$e],e[f+3]=e[f+3-$e];f=tn}}t.l=m,t.p=yt,t.b=f,m&&(u=1,t.m=S,t.d=y,t.n=M)}while(!u);return f==e.length?e:Uo(e,0,f)},fc=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8},fp=function(s,e,t){t<<=7&e;var n=e/8|0;s[n]|=t,s[n+1]|=t>>>8,s[n+2]|=t>>>16},Hg=function(s,e){for(var t=[],n=0;n<s.length;++n)s[n]&&t.push({s:n,f:s[n]});var r=t.length,o=t.slice();if(!r)return[mu,0];if(r==1){var a=new ji(t[0].s+1);return a[t[0].s]=1,[a,1]}t.sort(function(q,J){return q.f-J.f}),t.push({s:-1,f:25001});var u=t[0],p=t[1],f=0,m=1,y=2;for(t[0]={s:-1,f:u.f+p.f,l:u,r:p};m!=r-1;)u=t[t[f].f<t[y].f?f++:y++],p=t[f!=m&&t[f].f<t[y].f?f++:y++],t[m++]={s:-1,f:u.f+p.f,l:u,r:p};var S=o[0].s;for(n=1;n<r;++n)o[n].s>S&&(S=o[n].s);var M=new Zs(S+1),P=el(t[m-1],M,0);if(P>e){n=0;var D=0,j=P-e,k=1<<j;for(o.sort(function(q,J){return M[J.s]-M[q.s]||q.f-J.f});n<r;++n){var L=o[n].s;if(!(M[L]>e))break;D+=k-(1<<P-M[L]),M[L]=e}for(D>>>=j;D>0;){var R=o[n].s;M[R]<e?D-=1<<e-M[R]++-1:++n}for(;n>=0&&D;--n){var W=o[n].s;M[W]==e&&(--M[W],++D)}P=e}return[new ji(M),P]},el=function(s,e,t){return s.s==-1?Math.max(el(s.l,e,t+1),el(s.r,e,t+1)):e[s.s]=t},Yv=function(s){for(var e=s.length;e&&!s[--e];);for(var t=new Zs(++e),n=0,r=s[0],o=1,a=function(p){t[n++]=p},u=1;u<=e;++u)if(s[u]==r&&u!=e)++o;else{if(!r&&o>2){for(;o>138;o-=138)a(32754);o>2&&(a(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(a(r),--o;o>6;o-=6)a(8304);o>2&&(a(o-3<<5|8208),o=0)}for(;o--;)a(r);o=1,r=s[u]}return[t.subarray(0,n),e]},mp=function(s,e){for(var t=0,n=0;n<e.length;++n)t+=s[n]*e[n];return t},Wf=function(s,e,t){var n=t.length,r=pp(e+2);s[r]=255&n,s[r+1]=n>>>8,s[r+2]=255^s[r],s[r+3]=255^s[r+1];for(var o=0;o<n;++o)s[r+o+4]=t[o];return 8*(r+4+n)},Xv=function(s,e,t,n,r,o,a,u,p,f,m){fc(e,m++,t),++r[256];for(var y=Hg(r,15),S=y[0],M=y[1],P=Hg(o,15),D=P[0],j=P[1],k=Yv(S),L=k[0],R=k[1],W=Yv(D),q=W[0],J=W[1],ee=new Zs(19),he=0;he<L.length;++he)ee[31&L[he]]++;for(he=0;he<q.length;++he)ee[31&q[he]]++;for(var xe=Hg(ee,7),De=xe[0],Fe=xe[1],ke=19;ke>4&&!De[Vf[ke-1]];--ke);var Qe,Oe,ze,$e,Ge=f+5<<3,ot=mp(r,pu)+mp(o,fu)+a,yt=mp(r,S)+mp(o,D)+a+14+3*ke+mp(ee,De)+(2*ee[16]+3*ee[17]+7*ee[18]);if(Ge<=ot&&Ge<=yt)return Wf(e,m,s.subarray(p,p+f));if(fc(e,m,1+(yt<ot)),m+=2,yt<ot){Qe=Pa(S,M,0),Oe=S,ze=Pa(D,j,0),$e=D;var Mt=Pa(De,Fe,0);for(fc(e,m,R-257),fc(e,m+5,J-1),fc(e,m+10,ke-4),m+=14,he=0;he<ke;++he)fc(e,m+3*he,De[Vf[he]]);m+=3*ke;for(var pt=[L,q],Qt=0;Qt<2;++Qt){var Kt=pt[Qt];for(he=0;he<Kt.length;++he){var Jt=31&Kt[he];fc(e,m,Mt[Jt]),m+=De[Jt],Jt>15&&(fc(e,m,Kt[he]>>>5&127),m+=Kt[he]>>>12)}}}else Qe=ss,Oe=pu,ze=ds,$e=fu;for(he=0;he<u;++he)if(n[he]>255){Jt=n[he]>>>18&31,fp(e,m,Qe[Jt+257]),m+=Oe[Jt+257],Jt>7&&(fc(e,m,n[he]>>>23&31),m+=du[Jt]);var tn=31&n[he];fp(e,m,ze[tn]),m+=$e[tn],tn>3&&(fp(e,m,n[he]>>>5&8191),m+=oh[tn])}else fp(e,m,Qe[n[he]]),m+=Oe[n[he]];return fp(e,m,Qe[256]),m+Oe[256]},ly=new To([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),mu=new ji(0),cy=function(s,e,t,n,r,o){var a=s.length,u=new ji(n+a+5*(1+Math.ceil(a/7e3))+r),p=u.subarray(n,u.length-r),f=0;if(!e||a<8)for(var m=0;m<=a;m+=65535){var y=m+65535;y<a?f=Wf(p,f,s.subarray(m,y)):(p[m]=o,f=Wf(p,f,s.subarray(m,a)))}else{for(var S=ly[e-1],M=S>>>13,P=8191&S,D=(1<<t)-1,j=new Zs(32768),k=new Zs(D+1),L=Math.ceil(t/3),R=2*L,W=function(gr){return(s[gr]^s[gr+1]<<L^s[gr+2]<<R)&D},q=new To(25e3),J=new Zs(288),ee=new Zs(32),he=0,xe=0,De=(m=0,0),Fe=0,ke=0;m<a;++m){var Qe=W(m),Oe=32767&m,ze=k[Qe];if(j[Oe]=ze,k[Qe]=Oe,Fe<=m){var $e=a-m;if((he>7e3||De>24576)&&$e>423){f=Xv(s,p,0,q,J,ee,xe,De,ke,m-ke,f),De=he=xe=0,ke=m;for(var Ge=0;Ge<286;++Ge)J[Ge]=0;for(Ge=0;Ge<30;++Ge)ee[Ge]=0}var ot=2,yt=0,Mt=P,pt=Oe-ze&32767;if($e>2&&Qe==W(m-pt))for(var Qt=Math.min(M,$e)-1,Kt=Math.min(32767,m),Jt=Math.min(258,$e);pt<=Kt&&--Mt&&Oe!=ze;){if(s[m+ot]==s[m+ot-pt]){for(var tn=0;tn<Jt&&s[m+tn]==s[m+tn-pt];++tn);if(tn>ot){if(ot=tn,yt=pt,tn>Qt)break;var Mn=Math.min(pt,tn-2),Rt=0;for(Ge=0;Ge<Mn;++Ge){var oi=m-pt+Ge+32768&32767,xi=oi-j[oi]+32768&32767;xi>Rt&&(Rt=xi,ze=oi)}}}pt+=(Oe=ze)-(ze=j[Oe])+32768&32767}if(yt){q[De++]=268435456|Gf[ot]<<18|qv[yt];var ai=31&Gf[ot],Yi=31&qv[yt];xe+=du[ai]+oh[Yi],++J[257+ai],++ee[Yi],Fe=m+ot,++he}else q[De++]=s[m],++J[s[m]]}}f=Xv(s,p,o,q,J,ee,xe,De,ke,m-ke,f),!o&&7&f&&(f=Wf(p,f+1,mu))}return Uo(u,0,n+pp(f)+r)},uy=function(){for(var s=new To(256),e=0;e<256;++e){for(var t=e,n=9;--n;)t=(1&t&&3988292384)^t>>>1;s[e]=t}return s}(),gp=function(){var s=-1;return{p:function(e){for(var t=s,n=0;n<e.length;++n)t=uy[255&t^e[n]]^t>>>8;s=t},d:function(){return~s}}},Kv=function(){var s=1,e=0;return{p:function(t){for(var n=s,r=e,o=t.length,a=0;a!=o;){for(var u=Math.min(a+2655,o);a<u;++a)r+=n+=t[a];n=(65535&n)+15*(n>>16),r=(65535&r)+15*(r>>16)}s=n,e=r},d:function(){return(255&(s%=65521))<<24|s>>>8<<16|(255&(e%=65521))<<8|e>>>8}}},rd=function(s,e,t,n,r){return cy(s,e.level==null?6:e.level,e.mem==null?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(s.length)))):12+e.mem,t,n,!r)},qf=function(s,e){var t={};for(var n in s)t[n]=s[n];for(var n in e)t[n]=e[n];return t},hy=function(s,e,t){for(var n=s(),r=s.toString(),o=r.slice(r.indexOf("[")+1,r.lastIndexOf("]")).replace(/ /g,"").split(","),a=0;a<n.length;++a){var u=n[a],p=o[a];if(typeof u=="function"){e+=";"+p+"=";var f=u.toString();if(u.prototype)if(f.indexOf("[native code]")!=-1){var m=f.indexOf(" ",8)+1;e+=f.slice(m,f.indexOf("(",m))}else for(var y in e+=f,u.prototype)e+=";"+p+".prototype."+y+"="+u.prototype[y].toString();else e+=f}else t[p]=u}return[e,t]},Wg=[],dy=function(s,e,t,n){var r;if(!Wg[t]){for(var o="",a={},u=s.length-1,p=0;p<u;++p)o=(r=hy(s[p],o,a))[0],a=r[1];Wg[t]=hy(s[u],o,a)}var f=qf({},Wg[t][1]);return function(m,y,S,M,P){var D=ry(Gv[y]||(Gv[y]=dp(m)));return D.onerror=function(j){return P(j.error,null)},D.onmessage=function(j){return P(null,j.data)},D.postMessage(S,M),D}(Wg[t][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+e.toString()+"}",t,f,function(m){var y=[];for(var S in m)(m[S]instanceof ji||m[S]instanceof Zs||m[S]instanceof To)&&y.push((m[S]=new m[S].constructor(m[S])).buffer);return y}(f),n)},_p=function(){return[ji,Zs,To,du,oh,Vf,Hv,oy,ay,Hf,Qf,Pa,Gg,Za,Qg,pp,Uo,id,ve,ah,Jv]},vp=function(){return[ji,Zs,To,du,oh,Vf,Gf,qv,ss,pu,ds,fu,Qf,ly,mu,Pa,fc,fp,Hg,el,Yv,mp,Wf,Xv,pp,Uo,cy,rd,H,ah]},py=function(){return[g,T,d,gp,uy]},fy=function(){return[v,b]},my=function(){return[I,d,Kv]},gy=function(){return[N]},ah=function(s){return postMessage(s,[s.buffer])},Jv=function(s){return s&&s.size&&new ji(s.size)},Ap=function(s,e,t,n,r,o){var a=dy(t,n,r,function(u,p){a.terminate(),o(u,p)});return a.postMessage([s,e],e.consume?[s.buffer]:[]),function(){a.terminate()}},tl=function(s){return s.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(e){return s.push(e.data[0],e.data[1])}},x=function(s,e,t,n,r){var o,a=dy(s,n,r,function(u,p){u?(a.terminate(),e.ondata.call(e,u)):(p[1]&&a.terminate(),e.ondata.call(e,u,p[0],p[1]))});a.postMessage(t),e.push=function(u,p){if(o)throw"stream finished";if(!e.ondata)throw"no stream handler";a.postMessage([u,o=p],[u.buffer])},e.terminate=function(){a.terminate()}},i=function(s,e){return s[e]|s[e+1]<<8},l=function(s,e){return(s[e]|s[e+1]<<8|s[e+2]<<16|s[e+3]<<24)>>>0},h=function(s,e){return l(s,e)+4294967296*l(s,e+4)},d=function(s,e,t){for(;t;++e)s[e]=t,t>>>=8},g=function(s,e){var t=e.filename;if(s[0]=31,s[1]=139,s[2]=8,s[8]=e.level<2?4:e.level==9?2:0,s[9]=3,e.mtime!=0&&d(s,4,Math.floor(new Date(e.mtime||Date.now())/1e3)),t){s[3]=8;for(var n=0;n<=t.length;++n)s[n+10]=t.charCodeAt(n)}},v=function(s){if(s[0]!=31||s[1]!=139||s[2]!=8)throw"invalid gzip data";var e=s[3],t=10;4&e&&(t+=s[10]|2+(s[11]<<8));for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!s[t++]);return t+(2&e)},b=function(s){var e=s.length;return(s[e-4]|s[e-3]<<8|s[e-2]<<16|s[e-1]<<24)>>>0},T=function(s){return 10+(s.filename&&s.filename.length+1||0)},I=function(s,e){var t=e.level,n=t==0?0:t<6?1:t==9?3:2;s[0]=120,s[1]=n<<6|(n?32-2*n:1)},N=function(s){if((15&s[0])!=8||s[0]>>>4>7||(s[0]<<8|s[1])%31)throw"invalid zlib data";if(32&s[1])throw"invalid zlib data: preset dictionaries not supported"};function z(s,e){return e||typeof s!="function"||(e=s,s={}),this.ondata=e,s}var U=function(){function s(e,t){t||typeof e!="function"||(t=e,e={}),this.ondata=t,this.o=e||{}}return s.prototype.p=function(e,t){this.ondata(rd(e,this.o,0,0,!t),t)},s.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},s}(),Q=function(){return function(s,e){x([vp,function(){return[tl,U]}],this,z.call(this,s,e),function(t){var n=new U(t.data);onmessage=tl(n)},6)}}();function Y(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[vp],function(n){return ah(H(n.data[0],n.data[1]))},0,t)}function H(s,e){return rd(s,e||{},0,0)}var ne=function(){function s(e){this.s={},this.p=new ji(0),this.ondata=e}return s.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,n=new ji(t+e.length);n.set(this.p),n.set(e,t),this.p=n},s.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=id(this.p,this.o,this.s);this.ondata(Uo(n,t,this.s.b),this.d),this.o=Uo(n,this.s.b-32768),this.s.b=this.o.length,this.p=Uo(this.p,this.s.p/8|0),this.s.p&=7},s.prototype.push=function(e,t){this.e(e),this.c(t)},s}(),ie=function(){return function(s){this.ondata=s,x([_p,function(){return[tl,ne]}],this,0,function(){var e=new ne;onmessage=tl(e)},7)}}();function re(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[_p],function(n){return ah(ve(n.data[0],Jv(n.data[1])))},1,t)}function ve(s,e){return id(s,e)}var Ee=function(){function s(e,t){this.c=gp(),this.l=0,this.v=1,U.call(this,e,t)}return s.prototype.push=function(e,t){U.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var n=rd(e,this.o,this.v&&T(this.o),t&&8,!t);this.v&&(g(n,this.o),this.v=0),t&&(d(n,n.length-8,this.c.d()),d(n,n.length-4,this.l)),this.ondata(n,t)},s}(),Me=function(){return function(s,e){x([vp,py,function(){return[tl,U,Ee]}],this,z.call(this,s,e),function(t){var n=new Ee(t.data);onmessage=tl(n)},8)}}();function Pe(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[vp,py,function(){return[Ye]}],function(n){return ah(Ye(n.data[0],n.data[1]))},2,t)}function Ye(s,e){e||(e={});var t=gp(),n=s.length;t.p(s);var r=rd(s,e,T(e),8),o=r.length;return g(r,e),d(r,o-8,t.d()),d(r,o-4,n),r}var Ke=function(){function s(e){this.v=1,ne.call(this,e)}return s.prototype.push=function(e,t){if(ne.prototype.e.call(this,e),this.v){var n=this.p.length>3?v(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}ne.prototype.c.call(this,t)},s}(),lt=function(){return function(s){this.ondata=s,x([_p,fy,function(){return[tl,ne,Ke]}],this,0,function(){var e=new Ke;onmessage=tl(e)},9)}}();function ut(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[_p,fy,function(){return[Ze]}],function(n){return ah(Ze(n.data[0]))},3,t)}function Ze(s,e){return id(s.subarray(v(s),-8),e||new ji(b(s)))}var Ft=function(){function s(e,t){this.c=Kv(),this.v=1,U.call(this,e,t)}return s.prototype.push=function(e,t){U.prototype.push.call(this,e,t)},s.prototype.p=function(e,t){this.c.p(e);var n=rd(e,this.o,this.v&&2,t&&4,!t);this.v&&(I(n,this.o),this.v=0),t&&d(n,n.length-4,this.c.d()),this.ondata(n,t)},s}(),$t=function(){return function(s,e){x([vp,my,function(){return[tl,U,Ft]}],this,z.call(this,s,e),function(t){var n=new Ft(t.data);onmessage=tl(n)},10)}}();function Lt(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[vp,my,function(){return[an]}],function(n){return ah(an(n.data[0],n.data[1]))},4,t)}function an(s,e){e||(e={});var t=Kv();t.p(s);var n=rd(s,e,2,4);return I(n,e),d(n,n.length-4,t.d()),n}var ln=function(){function s(e){this.v=1,ne.call(this,e)}return s.prototype.push=function(e,t){if(ne.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}ne.prototype.c.call(this,t)},s}(),Ct=function(){return function(s){this.ondata=s,x([_p,gy,function(){return[tl,ne,ln]}],this,0,function(){var e=new ln;onmessage=tl(e)},11)}}();function Dt(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return Ap(s,e,[_p,gy,function(){return[nn]}],function(n){return ah(nn(n.data[0],Jv(n.data[1])))},5,t)}function nn(s,e){return id((N(s),s.subarray(2,-4)),e)}var Ut=function(){function s(e){this.G=Ke,this.I=ne,this.Z=ln,this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new ji(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var r=this,o=function(){r.ondata.apply(r,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(o):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(o):new this.Z(o),this.s.push(this.p,t),this.p=null}}},s}(),on=function(){function s(e){this.G=lt,this.I=ie,this.Z=Ct,this.ondata=e}return s.prototype.push=function(e,t){Ut.prototype.push.call(this,e,t)},s}();function On(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";return s[0]==31&&s[1]==139&&s[2]==8?ut(s,e,t):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?re(s,e,t):Dt(s,e,t)}function Ti(s,e){return s[0]==31&&s[1]==139&&s[2]==8?Ze(s,e):(15&s[0])!=8||s[0]>>4>7||(s[0]<<8|s[1])%31?ve(s,e):nn(s,e)}var Fn=function(s,e,t,n){for(var r in s){var o=s[r],a=e+r;o instanceof ji?t[a]=[o,n]:Array.isArray(o)?t[a]=[o[0],qf(n,o[1])]:Fn(o,a+"/",t,n)}},yi=typeof TextEncoder<"u"&&new TextEncoder,He=typeof TextDecoder<"u"&&new TextDecoder,Ue=0;try{He.decode(mu,{stream:!0}),Ue=1}catch{}var mt=function(s){for(var e="",t=0;;){var n=s[t++],r=(n>127)+(n>223)+(n>239);if(t+r>s.length)return[e,Uo(s,t-1)];r?r==3?(n=((15&n)<<18|(63&s[t++])<<12|(63&s[t++])<<6|63&s[t++])-65536,e+=String.fromCharCode(55296|n>>10,56320|1023&n)):e+=1&r?String.fromCharCode((31&n)<<6|63&s[t++]):String.fromCharCode((15&n)<<12|(63&s[t++])<<6|63&s[t++]):e+=String.fromCharCode(n)}},at=function(){function s(e){this.ondata=e,Ue?this.t=new TextDecoder:this.p=mu}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}}else{if(!this.p)throw"stream finished";var n=new ji(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length);var r=mt(n),o=r[0],a=r[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(o,t)}},s}(),We=function(){function s(e){this.ondata=e}return s.prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(st(e),this.d=t||!1)},s}();function st(s,e){if(e){for(var t=new ji(s.length),n=0;n<s.length;++n)t[n]=s.charCodeAt(n);return t}if(yi)return yi.encode(s);var r=s.length,o=new ji(s.length+(s.length>>1)),a=0,u=function(m){o[a++]=m};for(n=0;n<r;++n){if(a+5>o.length){var p=new ji(a+8+(r-n<<1));p.set(o),o=p}var f=s.charCodeAt(n);f<128||e?u(f):f<2048?(u(192|f>>6),u(128|63&f)):f>55295&&f<57344?(u(240|(f=65536+(1047552&f)|1023&s.charCodeAt(++n))>>18),u(128|f>>12&63),u(128|f>>6&63),u(128|63&f)):(u(224|f>>12),u(128|f>>6&63),u(128|63&f))}return Uo(o,0,a)}function Tt(s,e){if(e){for(var t="",n=0;n<s.length;n+=16384)t+=String.fromCharCode.apply(null,s.subarray(n,n+16384));return t}if(He)return He.decode(s);var r=mt(s),o=r[0];if(r[1].length)throw"invalid utf-8 data";return o}var Ae=function(s){return s==1?3:s<6?2:s==9?1:0},It=function(s,e){return e+30+i(s,e+26)+i(s,e+28)},dt=function(s,e,t){var n=i(s,e+28),r=Tt(s.subarray(e+46,e+46+n),!(2048&i(s,e+8))),o=e+46+n,a=l(s,e+20),u=t&&a==4294967295?Nt(s,o):[a,l(s,e+24),l(s,e+42)],p=u[0],f=u[1],m=u[2];return[i(s,e+10),p,f,r,o+i(s,e+30)+i(s,e+32),m]},Nt=function(s,e){for(;i(s,e)!=1;e+=4+i(s,e+2));return[h(s,e+12),h(s,e+4),h(s,e+20)]},Gt=function(s){var e=0;if(s)for(var t in s){var n=s[t].length;if(n>65535)throw"extra field too long";e+=n+4}return e},pn=function(s,e,t,n,r,o,a,u){var p=n.length,f=t.extra,m=u&&u.length,y=Gt(f);d(s,e,a!=null?33639248:67324752),e+=4,a!=null&&(s[e++]=20,s[e++]=t.os),s[e]=20,e+=2,s[e++]=t.flag<<1|(o==null&&8),s[e++]=r&&8,s[e++]=255&t.compression,s[e++]=t.compression>>8;var S=new Date(t.mtime==null?Date.now():t.mtime),M=S.getFullYear()-1980;if(M<0||M>119)throw"date not in range 1980-2099";if(d(s,e,M<<25|S.getMonth()+1<<21|S.getDate()<<16|S.getHours()<<11|S.getMinutes()<<5|S.getSeconds()>>>1),e+=4,o!=null&&(d(s,e,t.crc),d(s,e+4,o),d(s,e+8,t.size)),d(s,e+12,p),d(s,e+14,y),e+=16,a!=null&&(d(s,e,m),d(s,e+6,t.attrs),d(s,e+10,a),e+=14),s.set(n,e),e+=p,y)for(var P in f){var D=f[P],j=D.length;d(s,e,+P),d(s,e+2,j),s.set(D,e+4),e+=4+j}return m&&(s.set(u,e),e+=m),e},Un=function(s,e,t,n,r){d(s,e,101010256),d(s,e+8,t),d(s,e+10,t),d(s,e+12,n),d(s,e+16,r)},Jn=function(){function s(e){this.filename=e,this.c=gp(),this.size=0,this.compression=0}return s.prototype.process=function(e,t){this.ondata(null,e,t)},s.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},s}(),fi=function(){function s(e,t){var n=this;t||(t={}),Jn.call(this,e),this.d=new U(t,function(r,o){n.ondata(null,r,o)}),this.compression=8,this.flag=Ae(t.level)}return s.prototype.process=function(e,t){try{this.d.push(e,t)}catch(n){this.ondata(n,null,t)}},s.prototype.push=function(e,t){Jn.prototype.push.call(this,e,t)},s}(),Yn=function(){function s(e,t){var n=this;t||(t={}),Jn.call(this,e),this.d=new Q(t,function(r,o,a){n.ondata(r,o,a)}),this.compression=8,this.flag=Ae(t.level),this.terminate=this.d.terminate}return s.prototype.process=function(e,t){this.d.push(e,t)},s.prototype.push=function(e,t){Jn.prototype.push.call(this,e,t)},s}(),$n=function(){function s(e){this.ondata=e,this.u=[],this.d=1}return s.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var n=st(e.filename),r=n.length,o=e.comment,a=o&&st(o),u=r!=e.filename.length||a&&o.length!=a.length,p=r+Gt(e.extra)+30;if(r>65535)throw"filename too long";var f=new ji(p);pn(f,0,e,n,u);var m=[f],y=function(){for(var j=0,k=m;j<k.length;j++){var L=k[j];t.ondata(null,L,!1)}m=[]},S=this.d;this.d=0;var M=this.u.length,P=qf(e,{f:n,u,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(y(),S){var j=t.u[M+1];j?j.r():t.d=1}S=1}}),D=0;e.ondata=function(j,k,L){if(j)t.ondata(j,k,L),t.terminate();else if(D+=k.length,m.push(k),L){var R=new ji(16);d(R,0,134695760),d(R,4,e.crc),d(R,8,D),d(R,12,e.size),m.push(R),P.c=D,P.b=p+D+16,P.crc=e.crc,P.size=e.size,S&&P.r(),S=1}else S&&y()},this.u.push(P)},s.prototype.end=function(){var e=this;if(2&this.d)throw 1&this.d?"stream finishing":"stream finished";this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},s.prototype.e=function(){for(var e=0,t=0,n=0,r=0,o=this.u;r<o.length;r++)n+=46+(f=o[r]).f.length+Gt(f.extra)+(f.o?f.o.length:0);for(var a=new ji(n+22),u=0,p=this.u;u<p.length;u++){var f=p[u];pn(a,e,f,f.f,f.u,f.c,t,f.o),e+=46+f.f.length+Gt(f.extra)+(f.o?f.o.length:0),t+=f.b}Un(a,e,this.u.length,n,t),this.ondata(null,a,!0),this.d=2},s.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2},s}();function hr(s,e,t){if(t||(t=e,e={}),typeof t!="function")throw"no callback";var n={};Fn(s,"",n,e);var r=Object.keys(n),o=r.length,a=0,u=0,p=o,f=new Array(o),m=[],y=function(){for(var D=0;D<m.length;++D)m[D]()},S=function(){var D=new ji(u+22),j=a,k=u-a;u=0;for(var L=0;L<p;++L){var R=f[L];try{var W=R.c.length;pn(D,u,R,R.f,R.u,W);var q=30+R.f.length+Gt(R.extra),J=u+q;D.set(R.c,J),pn(D,a,R,R.f,R.u,W,u,R.m),a+=16+q+(R.m?R.m.length:0),u=J+W}catch(ee){return t(ee,null)}}Un(D,a,f.length,k,j),t(null,D)};o||S();for(var M=function(D){var j=r[D],k=n[j],L=k[0],R=k[1],W=gp(),q=L.length;W.p(L);var J=st(j),ee=J.length,he=R.comment,xe=he&&st(he),De=xe&&xe.length,Fe=Gt(R.extra),ke=R.level==0?0:8,Qe=function(Oe,ze){if(Oe)y(),t(Oe,null);else{var $e=ze.length;f[D]=qf(R,{size:q,crc:W.d(),c:ze,f:J,m:xe,u:ee!=j.length||xe&&he.length!=De,compression:ke}),a+=30+ee+Fe+$e,u+=76+2*(ee+Fe)+(De||0)+$e,--o||S()}};if(ee>65535&&Qe("filename too long",null),ke)if(q<16e4)try{Qe(null,H(L,R))}catch(Oe){Qe(Oe,null)}else m.push(Y(L,R,Qe));else Qe(null,L)},P=0;P<p;++P)M(P);return y}function Da(s,e){e||(e={});var t={},n=[];Fn(s,"",t,e);var r=0,o=0;for(var a in t){var u=t[a],p=u[0],f=u[1],m=f.level==0?0:8,y=(ee=st(a)).length,S=f.comment,M=S&&st(S),P=M&&M.length,D=Gt(f.extra);if(y>65535)throw"filename too long";var j=m?H(p,f):p,k=j.length,L=gp();L.p(p),n.push(qf(f,{size:p.length,crc:L.d(),c:j,f:ee,m:M,u:y!=a.length||M&&S.length!=P,o:r,compression:m})),r+=30+y+D+k,o+=76+2*(y+D)+(P||0)+k}for(var R=new ji(o+22),W=r,q=o-r,J=0;J<n.length;++J){var ee=n[J];pn(R,ee.o,ee,ee.f,ee.u,ee.c.length);var he=30+ee.f.length+Gt(ee.extra);R.set(ee.c,ee.o+he),pn(R,r,ee,ee.f,ee.u,ee.c.length,ee.o,ee.m),r+=16+he+(ee.m?ee.m.length:0)}return Un(R,r,n.length,q,W),R}var hi=function(){function s(){}return s.prototype.push=function(e,t){this.ondata(null,e,t)},s.compression=0,s}(),Ar=function(){function s(){var e=this;this.i=new ne(function(t,n){e.ondata(null,t,n)})}return s.prototype.push=function(e,t){try{this.i.push(e,t)}catch(n){this.ondata(n,e,t)}},s.compression=8,s}(),yr=function(){function s(e,t){var n=this;t<32e4?this.i=new ne(function(r,o){n.ondata(null,r,o)}):(this.i=new ie(function(r,o,a){n.ondata(r,o,a)}),this.terminate=this.i.terminate)}return s.prototype.push=function(e,t){this.i.terminate&&(e=Uo(e,0)),this.i.push(e,t)},s.compression=8,s}(),qg=function(){function s(e){this.onfile=e,this.k=[],this.o={0:hi},this.p=mu}return s.prototype.push=function(e,t){var n=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var r=Math.min(this.c,e.length),o=e.subarray(0,r);if(this.c-=r,this.d?this.d.push(o,!this.c):this.k[0].push(o),(e=e.subarray(r)).length)return this.push(e,t)}else{var a=0,u=0,p=void 0,f=void 0;this.p.length?e.length?((f=new ji(this.p.length+e.length)).set(this.p),f.set(e,this.p.length)):f=this.p:f=e;for(var m=f.length,y=this.c,S=y&&this.d,M=function(){var j,k=l(f,u);if(k==67324752){a=1,p=u,P.d=null,P.c=0;var L=i(f,u+6),R=i(f,u+8),W=2048&L,q=8&L,J=i(f,u+26),ee=i(f,u+28);if(m>u+30+J+ee){var he=[];P.k.unshift(he),a=2;var xe,De=l(f,u+18),Fe=l(f,u+22),ke=Tt(f.subarray(u+30,u+=30+J),!W);De==4294967295?(j=q?[-2]:Nt(f,u),De=j[0],Fe=j[1]):q&&(De=-1),u+=ee,P.c=De;var Qe={name:ke,compression:R,start:function(){if(!Qe.ondata)throw"no callback";if(De){var Oe=n.o[R];if(!Oe)throw"unknown compression type "+R;(xe=De<0?new Oe(ke):new Oe(ke,De,Fe)).ondata=function(ot,yt,Mt){Qe.ondata(ot,yt,Mt)};for(var ze=0,$e=he;ze<$e.length;ze++){var Ge=$e[ze];xe.push(Ge,!1)}n.k[0]==he&&n.c?n.d=xe:xe.push(mu,!0)}else Qe.ondata(null,mu,!0)},terminate:function(){xe&&xe.terminate&&xe.terminate()}};De>=0&&(Qe.size=De,Qe.originalSize=Fe),P.onfile(Qe)}return"break"}if(y){if(k==134695760)return p=u+=12+(y==-2&&8),a=3,P.c=0,"break";if(k==33639248)return p=u-=4,a=3,P.c=0,"break"}},P=this;u<m-4&&M()!=="break";++u);if(this.p=mu,y<0){var D=a?f.subarray(0,p-12-(y==-2&&8)-(l(f,p-16)==134695760&&4)):f.subarray(0,u);S?S.push(D,!!a):this.k[+(a==2)].push(D)}if(2&a)return this.push(f.subarray(u),t);this.p=f.subarray(u)}if(t){if(this.c)throw"invalid zip file";this.p=null}},s.prototype.register=function(e){this.o[e.compression]=e},s}();function An(s,e){if(typeof e!="function")throw"no callback";for(var t=[],n=function(){for(var S=0;S<t.length;++S)t[S]()},r={},o=s.length-22;l(s,o)!=101010256;--o)if(!o||s.length-o>65558)return void e("invalid zip file",null);var a=i(s,o+8);a||e(null,{});var u=a,p=l(s,o+16),f=p==4294967295;if(f){if(o=l(s,o-12),l(s,o)!=101075792)return void e("invalid zip file",null);u=a=l(s,o+32),p=l(s,o+48)}for(var m=function(S){var M=dt(s,p,f),P=M[0],D=M[1],j=M[2],k=M[3],L=M[4],R=M[5],W=It(s,R);p=L;var q=function(ee,he){ee?(n(),e(ee,null)):(r[k]=he,--a||e(null,r))};if(P)if(P==8){var J=s.subarray(W,W+D);if(D<32e4)try{q(null,ve(J,new ji(j)))}catch(ee){q(ee,null)}else t.push(re(J,{size:j},q))}else q("unknown compression type "+P,null);else q(null,Uo(s,W,W+D))},y=0;y<u;++y)m();return n}function _y(s){for(var e={},t=s.length-22;l(s,t)!=101010256;--t)if(!t||s.length-t>65558)throw"invalid zip file";var n=i(s,t+8);if(!n)return{};var r=l(s,t+16),o=r==4294967295;if(o){if(t=l(s,t-12),l(s,t)!=101075792)throw"invalid zip file";n=l(s,t+32),r=l(s,t+48)}for(var a=0;a<n;++a){var u=dt(s,r,o),p=u[0],f=u[1],m=u[2],y=u[3],S=u[4],M=u[5],P=It(s,M);if(r=S,p){if(p!=8)throw"unknown compression type "+p;e[y]=ve(s.subarray(P,P+f),new ji(m))}else e[y]=Uo(s,P,P+f)}return e}class vy extends c.yxD{constructor(e){super(e),this.type=c.cLu}parse(e){const o=Math.pow(2.7182818,2.2),a={l:0,c:0,lc:0};function u(Ce,Je,Te,it,ht){for(;Te<Ce;)Je=Je<<8|Qt(it,ht),Te+=8;Te-=Ce,a.l=Je>>Te&(1<<Ce)-1,a.c=Je,a.lc=Te}const p=new Array(59);function f(Ce){return 63&Ce}function m(Ce){return Ce>>6}const y={c:0,lc:0};function S(Ce,Je,Te,it){Ce=Ce<<8|Qt(Te,it),Je+=8,y.c=Ce,y.lc=Je}const M={c:0,lc:0};function P(Ce,Je,Te,it,ht,nt,bt,sn,mn){if(Ce==Je){it<8&&(S(Te,it,ht,nt),Te=y.c,it=y.lc);let En=Te>>(it-=8);if(En=new Uint8Array([En])[0],sn.value+En>mn)return!1;const xn=bt[sn.value-1];for(;En-- >0;)bt[sn.value++]=xn}else{if(!(sn.value<mn))return!1;bt[sn.value++]=Ce}M.c=Te,M.lc=it}function D(Ce){return 65535&Ce}function j(Ce){const Je=D(Ce);return Je>32767?Je-65536:Je}const k={a:0,b:0};function L(Ce,Je){const Te=j(Ce),it=j(Je),ht=Te+(1&it)+(it>>1),nt=ht,bt=ht-it;k.a=nt,k.b=bt}function R(Ce,Je){const Te=D(Ce),it=D(Je),ht=Te-(it>>1)&65535,nt=it+ht-32768&65535;k.a=nt,k.b=ht}function W(Ce,Je,Te,it,ht,nt,bt){const sn=bt<16384,mn=Te>ht?ht:Te;let En,xn,Tn=1;for(;Tn<=mn;)Tn<<=1;for(Tn>>=1,En=Tn,Tn>>=1;Tn>=1;){xn=0;const yn=xn+nt*(ht-En),gn=nt*Tn,Ln=nt*En,un=it*Tn,jn=it*En;let Wn,ii,Wr,Dr;for(;xn<=yn;xn+=Ln){let zn=xn;const ci=xn+it*(Te-En);for(;zn<=ci;zn+=jn){const Fi=zn+un,go=zn+gn,hl=go+un;sn?(L(Ce[zn+Je],Ce[go+Je]),Wn=k.a,Wr=k.b,L(Ce[Fi+Je],Ce[hl+Je]),ii=k.a,Dr=k.b,L(Wn,ii),Ce[zn+Je]=k.a,Ce[Fi+Je]=k.b,L(Wr,Dr),Ce[go+Je]=k.a,Ce[hl+Je]=k.b):(R(Ce[zn+Je],Ce[go+Je]),Wn=k.a,Wr=k.b,R(Ce[Fi+Je],Ce[hl+Je]),ii=k.a,Dr=k.b,R(Wn,ii),Ce[zn+Je]=k.a,Ce[Fi+Je]=k.b,R(Wr,Dr),Ce[go+Je]=k.a,Ce[hl+Je]=k.b)}if(Te&Tn){const Fi=zn+gn;sn?L(Ce[zn+Je],Ce[Fi+Je]):R(Ce[zn+Je],Ce[Fi+Je]),Wn=k.a,Ce[Fi+Je]=k.b,Ce[zn+Je]=Wn}}if(ht&Tn){let zn=xn;const ci=xn+it*(Te-En);for(;zn<=ci;zn+=jn){const Fi=zn+un;sn?L(Ce[zn+Je],Ce[Fi+Je]):R(Ce[zn+Je],Ce[Fi+Je]),Wn=k.a,Ce[Fi+Je]=k.b,Ce[zn+Je]=Wn}}En=Tn,Tn>>=1}return xn}function q(Ce,Je,Te,it,ht,nt){const bt=Te.value,sn=pt(Je,Te),mn=pt(Je,Te);Te.value+=4;const En=pt(Je,Te);if(Te.value+=4,sn<0||sn>=65537||mn<0||mn>=65537)throw new Error("Something wrong with HUF_ENCSIZE");const xn=new Array(65537),Tn=new Array(16384);if(function(yn){for(let gn=0;gn<16384;gn++)yn[gn]={},yn[gn].len=0,yn[gn].lit=0,yn[gn].p=null}(Tn),function(yn,gn,Ln,un,jn,Wn){const ii=gn;let Wr=0,Dr=0;for(;un<=jn;un++){if(ii.value-gn.value>Ln)return!1;u(6,Wr,Dr,yn,ii);const zn=a.l;if(Wr=a.c,Dr=a.lc,Wn[un]=zn,zn==63){if(ii.value-gn.value>Ln)throw new Error("Something wrong with hufUnpackEncTable");u(8,Wr,Dr,yn,ii);let ci=a.l+6;if(Wr=a.c,Dr=a.lc,un+ci>jn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ci--;)Wn[un++]=0;un--}else if(zn>=59){let ci=zn-59+2;if(un+ci>jn+1)throw new Error("Something wrong with hufUnpackEncTable");for(;ci--;)Wn[un++]=0;un--}}(function(zn){for(let Fi=0;Fi<=58;++Fi)p[Fi]=0;for(let Fi=0;Fi<65537;++Fi)p[zn[Fi]]+=1;let ci=0;for(let Fi=58;Fi>0;--Fi){const go=ci+p[Fi]>>1;p[Fi]=ci,ci=go}for(let Fi=0;Fi<65537;++Fi){const go=zn[Fi];go>0&&(zn[Fi]=go|p[go]++<<6)}})(Wn)}(Ce,Te,it-(Te.value-bt),sn,mn,xn),En>8*(it-(Te.value-bt)))throw new Error("Something wrong with hufUncompress");(function(yn,gn,Ln,un){for(;gn<=Ln;gn++){const jn=m(yn[gn]),Wn=f(yn[gn]);if(jn>>Wn)throw new Error("Invalid table entry");if(Wn>14){const ii=un[jn>>Wn-14];if(ii.len)throw new Error("Invalid table entry");if(ii.lit++,ii.p){const Wr=ii.p;ii.p=new Array(ii.lit);for(let Dr=0;Dr<ii.lit-1;++Dr)ii.p[Dr]=Wr[Dr]}else ii.p=new Array(1);ii.p[ii.lit-1]=gn}else if(Wn){let ii=0;for(let Wr=1<<14-Wn;Wr>0;Wr--){const Dr=un[(jn<<14-Wn)+ii];if(Dr.len||Dr.p)throw new Error("Invalid table entry");Dr.len=Wn,Dr.lit=gn,ii++}}}})(xn,sn,mn,Tn),function(yn,gn,Ln,un,jn,Wn,ii,Wr,Dr){let zn=0,ci=0;const Fi=ii,go=Math.trunc(un.value+(jn+7)/8);for(;un.value<go;)for(S(zn,ci,Ln,un),zn=y.c,ci=y.lc;ci>=14;){const Io=gn[zn>>ci-14&16383];if(Io.len)ci-=Io.len,P(Io.lit,Wn,zn,ci,Ln,un,Wr,Dr,Fi),zn=M.c,ci=M.lc;else{if(!Io.p)throw new Error("hufDecode issues");let _d;for(_d=0;_d<Io.lit;_d++){const xm=f(yn[Io.p[_d]]);for(;ci<xm&&un.value<go;)S(zn,ci,Ln,un),zn=y.c,ci=y.lc;if(ci>=xm&&m(yn[Io.p[_d]])==(zn>>ci-xm&(1<<xm)-1)){ci-=xm,P(Io.p[_d],Wn,zn,ci,Ln,un,Wr,Dr,Fi),zn=M.c,ci=M.lc;break}}if(_d==Io.lit)throw new Error("hufDecode issues")}}const hl=8-jn&7;for(zn>>=hl,ci-=hl;ci>0;){const Io=gn[zn<<14-ci&16383];if(!Io.len)throw new Error("hufDecode issues");ci-=Io.len,P(Io.lit,Wn,zn,ci,Ln,un,Wr,Dr,Fi),zn=M.c,ci=M.lc}}(xn,Tn,Ce,Te,En,mn,nt,ht,{value:0})}function J(Ce){for(let Je=1;Je<Ce.length;Je++){const Te=Ce[Je-1]+Ce[Je]-128;Ce[Je]=Te}}function ee(Ce,Je){let Te=0,it=Math.floor((Ce.length+1)/2),ht=0;const nt=Ce.length-1;for(;!(ht>nt||(Je[ht++]=Ce[Te++],ht>nt));)Je[ht++]=Ce[it++]}function he(Ce){let Je=Ce.byteLength;const Te=new Array;let it=0;const ht=new DataView(Ce);for(;Je>0;){const nt=ht.getInt8(it++);if(nt<0){const bt=-nt;Je-=bt+1;for(let sn=0;sn<bt;sn++)Te.push(ht.getUint8(it++))}else{const bt=nt;Je-=2;const sn=ht.getUint8(it++);for(let mn=0;mn<bt+1;mn++)Te.push(sn)}}return Te}function xe(Ce,Je,Te){let it,ht=1;for(;ht<64;)it=Je[Ce.value],it==65280?ht=64:it>>8==255?ht+=255&it:(Te[ht]=it,ht++),Ce.value++}function De(Ce){const Je=.5*Math.cos(.7853975),Te=.5*Math.cos(3.14159/16),it=.5*Math.cos(3.14159/8),ht=.5*Math.cos(3*3.14159/16),nt=.5*Math.cos(.981746875),bt=.5*Math.cos(3*3.14159/8),sn=.5*Math.cos(1.374445625),mn=new Array(4),En=new Array(4),xn=new Array(4),Tn=new Array(4);for(let yn=0;yn<8;++yn){const gn=8*yn;mn[0]=it*Ce[gn+2],mn[1]=bt*Ce[gn+2],mn[2]=it*Ce[gn+6],mn[3]=bt*Ce[gn+6],En[0]=Te*Ce[gn+1]+ht*Ce[gn+3]+nt*Ce[gn+5]+sn*Ce[gn+7],En[1]=ht*Ce[gn+1]-sn*Ce[gn+3]-Te*Ce[gn+5]-nt*Ce[gn+7],En[2]=nt*Ce[gn+1]-Te*Ce[gn+3]+sn*Ce[gn+5]+ht*Ce[gn+7],En[3]=sn*Ce[gn+1]-nt*Ce[gn+3]+ht*Ce[gn+5]-Te*Ce[gn+7],xn[0]=Je*(Ce[gn+0]+Ce[gn+4]),xn[3]=Je*(Ce[gn+0]-Ce[gn+4]),xn[1]=mn[0]+mn[3],xn[2]=mn[1]-mn[2],Tn[0]=xn[0]+xn[1],Tn[1]=xn[3]+xn[2],Tn[2]=xn[3]-xn[2],Tn[3]=xn[0]-xn[1],Ce[gn+0]=Tn[0]+En[0],Ce[gn+1]=Tn[1]+En[1],Ce[gn+2]=Tn[2]+En[2],Ce[gn+3]=Tn[3]+En[3],Ce[gn+4]=Tn[3]-En[3],Ce[gn+5]=Tn[2]-En[2],Ce[gn+6]=Tn[1]-En[1],Ce[gn+7]=Tn[0]-En[0]}for(let yn=0;yn<8;++yn)mn[0]=it*Ce[16+yn],mn[1]=bt*Ce[16+yn],mn[2]=it*Ce[48+yn],mn[3]=bt*Ce[48+yn],En[0]=Te*Ce[8+yn]+ht*Ce[24+yn]+nt*Ce[40+yn]+sn*Ce[56+yn],En[1]=ht*Ce[8+yn]-sn*Ce[24+yn]-Te*Ce[40+yn]-nt*Ce[56+yn],En[2]=nt*Ce[8+yn]-Te*Ce[24+yn]+sn*Ce[40+yn]+ht*Ce[56+yn],En[3]=sn*Ce[8+yn]-nt*Ce[24+yn]+ht*Ce[40+yn]-Te*Ce[56+yn],xn[0]=Je*(Ce[yn]+Ce[32+yn]),xn[3]=Je*(Ce[yn]-Ce[32+yn]),xn[1]=mn[0]+mn[3],xn[2]=mn[1]-mn[2],Tn[0]=xn[0]+xn[1],Tn[1]=xn[3]+xn[2],Tn[2]=xn[3]-xn[2],Tn[3]=xn[0]-xn[1],Ce[0+yn]=Tn[0]+En[0],Ce[8+yn]=Tn[1]+En[1],Ce[16+yn]=Tn[2]+En[2],Ce[24+yn]=Tn[3]+En[3],Ce[32+yn]=Tn[3]-En[3],Ce[40+yn]=Tn[2]-En[2],Ce[48+yn]=Tn[1]-En[1],Ce[56+yn]=Tn[0]-En[0]}function Fe(Ce){for(let Je=0;Je<64;++Je){const Te=Ce[0][Je],it=Ce[1][Je],ht=Ce[2][Je];Ce[0][Je]=Te+1.5747*ht,Ce[1][Je]=Te-.1873*it-.4682*ht,Ce[2][Je]=Te+1.8556*it}}function ke(Ce,Je,Te){for(let ht=0;ht<64;++ht)Je[Te+ht]=c.A5E.toHalfFloat((it=Ce[ht])<=1?Math.sign(it)*Math.pow(Math.abs(it),2.2):Math.sign(it)*Math.pow(o,Math.abs(it)-1));var it}function Qe(Ce){return new DataView(Ce.array.buffer,Ce.offset.value,Ce.size)}function Oe(Ce){const Je=Ce.viewer.buffer.slice(Ce.offset.value,Ce.offset.value+Ce.size),Te=new Uint8Array(he(Je)),it=new Uint8Array(Te.length);return J(Te),ee(Te,it),new DataView(it.buffer)}function ze(Ce){const Je=Ce.array.slice(Ce.offset.value,Ce.offset.value+Ce.size);A===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const Te=nn(Je),it=new Uint8Array(Te.length);return J(Te),ee(Te,it),new DataView(it.buffer)}function $e(Ce){const Je=Ce.viewer,Te={value:Ce.offset.value},it=new Uint16Array(Ce.width*Ce.scanlineBlockSize*(Ce.channels*Ce.type)),ht=new Uint8Array(8192);let nt=0;const bt=new Array(Ce.channels);for(let Ln=0;Ln<Ce.channels;Ln++)bt[Ln]={},bt[Ln].start=nt,bt[Ln].end=bt[Ln].start,bt[Ln].nx=Ce.width,bt[Ln].ny=Ce.lines,bt[Ln].size=Ce.type,nt+=bt[Ln].nx*bt[Ln].ny*bt[Ln].size;const sn=oi(Je,Te),mn=oi(Je,Te);if(mn>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(sn<=mn)for(let Ln=0;Ln<mn-sn+1;Ln++)ht[Ln+sn]=Kt(Je,Te);const En=new Uint16Array(65536),xn=function(Ln,un){let jn=0;for(let ii=0;ii<65536;++ii)(ii==0||Ln[ii>>3]&1<<(7&ii))&&(un[jn++]=ii);const Wn=jn-1;for(;jn<65536;)un[jn++]=0;return Wn}(ht,En),Tn=pt(Je,Te);q(Ce.array,Je,Te,Tn,it,nt);for(let Ln=0;Ln<Ce.channels;++Ln){const un=bt[Ln];for(let jn=0;jn<bt[Ln].size;++jn)W(it,un.start+jn,un.nx,un.size,un.ny,un.nx*un.size,xn)}(function(Ln,un,jn){for(let Wn=0;Wn<jn;++Wn)un[Wn]=Ln[un[Wn]]})(En,it,nt);let yn=0;const gn=new Uint8Array(it.buffer.byteLength);for(let Ln=0;Ln<Ce.lines;Ln++)for(let un=0;un<Ce.channels;un++){const jn=bt[un],Wn=jn.nx*jn.size,ii=new Uint8Array(it.buffer,2*jn.end,2*Wn);gn.set(ii,yn),yn+=2*Wn,jn.end+=Wn}return new DataView(gn.buffer)}function Ge(Ce){const Je=Ce.array.slice(Ce.offset.value,Ce.offset.value+Ce.size);A===void 0&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const Te=nn(Je),it=Ce.lines*Ce.channels*Ce.width,ht=Ce.type==1?new Uint16Array(it):new Uint32Array(it);let nt=0,bt=0;const sn=new Array(4);for(let mn=0;mn<Ce.lines;mn++)for(let En=0;En<Ce.channels;En++){let xn=0;switch(Ce.type){case 1:sn[0]=nt,sn[1]=sn[0]+Ce.width,nt=sn[1]+Ce.width;for(let Tn=0;Tn<Ce.width;++Tn)xn+=Te[sn[0]++]<<8|Te[sn[1]++],ht[bt]=xn,bt++;break;case 2:sn[0]=nt,sn[1]=sn[0]+Ce.width,sn[2]=sn[1]+Ce.width,nt=sn[2]+Ce.width;for(let Tn=0;Tn<Ce.width;++Tn)xn+=Te[sn[0]++]<<24|Te[sn[1]++]<<16|Te[sn[2]++]<<8,ht[bt]=xn,bt++}}return new DataView(ht.buffer)}function ot(Ce){const Je=Ce.viewer,Te={value:Ce.offset.value},it=new Uint8Array(Ce.width*Ce.lines*(Ce.channels*Ce.type*2)),ht={version:Jt(Je,Te),unknownUncompressedSize:Jt(Je,Te),unknownCompressedSize:Jt(Je,Te),acCompressedSize:Jt(Je,Te),dcCompressedSize:Jt(Je,Te),rleCompressedSize:Jt(Je,Te),rleUncompressedSize:Jt(Je,Te),rleRawSize:Jt(Je,Te),totalAcUncompressedCount:Jt(Je,Te),totalDcUncompressedCount:Jt(Je,Te),acCompression:Jt(Je,Te)};if(ht.version<2)throw new Error("EXRLoader.parse: "+Zt.compression+" version "+ht.version+" is unsupported");const nt=new Array;let bt=oi(Je,Te)-2;for(;bt>0;){const un=yt(Je.buffer,Te),jn=Kt(Je,Te),Wn=jn>>2&3,ii=new Int8Array([(jn>>4)-1])[0],Wr=Kt(Je,Te);nt.push({name:un,index:ii,type:Wr,compression:Wn}),bt-=un.length+3}const sn=Zt.channels,mn=new Array(Ce.channels);for(let un=0;un<Ce.channels;++un){const jn=mn[un]={},Wn=sn[un];jn.name=Wn.name,jn.compression=0,jn.decoded=!1,jn.type=Wn.pixelType,jn.pLinear=Wn.pLinear,jn.width=Ce.width,jn.height=Ce.lines}const En={idx:new Array(3)};for(let un=0;un<Ce.channels;++un){const jn=mn[un];for(let Wn=0;Wn<nt.length;++Wn){const ii=nt[Wn];jn.name==ii.name&&(jn.compression=ii.compression,ii.index>=0&&(En.idx[ii.index]=un),jn.offset=un)}}let xn,Tn,yn;if(ht.acCompressedSize>0)switch(ht.acCompression){case 0:xn=new Uint16Array(ht.totalAcUncompressedCount),q(Ce.array,Je,Te,ht.acCompressedSize,xn,ht.totalAcUncompressedCount);break;case 1:const un=nn(Ce.array.slice(Te.value,Te.value+ht.totalAcUncompressedCount));xn=new Uint16Array(un.buffer),Te.value+=ht.totalAcUncompressedCount}if(ht.dcCompressedSize>0){const un={array:Ce.array,offset:Te,size:ht.dcCompressedSize};Tn=new Uint16Array(ze(un).buffer),Te.value+=ht.dcCompressedSize}ht.rleRawSize>0&&(yn=he(nn(Ce.array.slice(Te.value,Te.value+ht.rleCompressedSize)).buffer),Te.value+=ht.rleCompressedSize);let gn=0;const Ln=new Array(mn.length);for(let un=0;un<Ln.length;++un)Ln[un]=new Array;for(let un=0;un<Ce.lines;++un)for(let jn=0;jn<mn.length;++jn)Ln[jn].push(gn),gn+=mn[jn].width*Ce.type*2;(function(un,jn,Wn,ii,Wr,Dr){let zn=new DataView(Dr.buffer);const ci=Wn[un.idx[0]].width,Fi=Wn[un.idx[0]].height,go=Math.floor(ci/8),hl=Math.ceil(ci/8),Io=Math.ceil(Fi/8),_d=ci-8*(hl-1),xm=Fi-8*(Io-1),XI={value:0},S1=new Array(3),N0=new Array(3),F0=new Array(3),Eu=new Array(3),uw=new Array(3);for(let ls=0;ls<3;++ls)uw[ls]=jn[un.idx[ls]],S1[ls]=ls<1?0:S1[ls-1]+hl*Io,N0[ls]=new Float32Array(64),F0[ls]=new Uint16Array(64),Eu[ls]=new Uint16Array(64*hl);for(let ls=0;ls<Io;++ls){let k_=8;ls==Io-1&&(k_=xm);let O_=8;for(let Or=0;Or<hl;++Or){Or==hl-1&&(O_=_d);for(let $r=0;$r<3;++$r)F0[$r].fill(0),F0[$r][0]=Wr[S1[$r]++],xe(XI,ii,F0[$r]),Rn=F0[$r],(Bn=N0[$r])[0]=Rt(Rn[0]),Bn[1]=Rt(Rn[1]),Bn[2]=Rt(Rn[5]),Bn[3]=Rt(Rn[6]),Bn[4]=Rt(Rn[14]),Bn[5]=Rt(Rn[15]),Bn[6]=Rt(Rn[27]),Bn[7]=Rt(Rn[28]),Bn[8]=Rt(Rn[2]),Bn[9]=Rt(Rn[4]),Bn[10]=Rt(Rn[7]),Bn[11]=Rt(Rn[13]),Bn[12]=Rt(Rn[16]),Bn[13]=Rt(Rn[26]),Bn[14]=Rt(Rn[29]),Bn[15]=Rt(Rn[42]),Bn[16]=Rt(Rn[3]),Bn[17]=Rt(Rn[8]),Bn[18]=Rt(Rn[12]),Bn[19]=Rt(Rn[17]),Bn[20]=Rt(Rn[25]),Bn[21]=Rt(Rn[30]),Bn[22]=Rt(Rn[41]),Bn[23]=Rt(Rn[43]),Bn[24]=Rt(Rn[9]),Bn[25]=Rt(Rn[11]),Bn[26]=Rt(Rn[18]),Bn[27]=Rt(Rn[24]),Bn[28]=Rt(Rn[31]),Bn[29]=Rt(Rn[40]),Bn[30]=Rt(Rn[44]),Bn[31]=Rt(Rn[53]),Bn[32]=Rt(Rn[10]),Bn[33]=Rt(Rn[19]),Bn[34]=Rt(Rn[23]),Bn[35]=Rt(Rn[32]),Bn[36]=Rt(Rn[39]),Bn[37]=Rt(Rn[45]),Bn[38]=Rt(Rn[52]),Bn[39]=Rt(Rn[54]),Bn[40]=Rt(Rn[20]),Bn[41]=Rt(Rn[22]),Bn[42]=Rt(Rn[33]),Bn[43]=Rt(Rn[38]),Bn[44]=Rt(Rn[46]),Bn[45]=Rt(Rn[51]),Bn[46]=Rt(Rn[55]),Bn[47]=Rt(Rn[60]),Bn[48]=Rt(Rn[21]),Bn[49]=Rt(Rn[34]),Bn[50]=Rt(Rn[37]),Bn[51]=Rt(Rn[47]),Bn[52]=Rt(Rn[50]),Bn[53]=Rt(Rn[56]),Bn[54]=Rt(Rn[59]),Bn[55]=Rt(Rn[61]),Bn[56]=Rt(Rn[35]),Bn[57]=Rt(Rn[36]),Bn[58]=Rt(Rn[48]),Bn[59]=Rt(Rn[49]),Bn[60]=Rt(Rn[57]),Bn[61]=Rt(Rn[58]),Bn[62]=Rt(Rn[62]),Bn[63]=Rt(Rn[63]),De(N0[$r]);Fe(N0);for(let $r=0;$r<3;++$r)ke(N0[$r],Eu[$r],64*Or)}let Gl=0;for(let Or=0;Or<3;++Or){const $r=Wn[un.idx[Or]].type;for(let vd=8*ls;vd<8*ls+k_;++vd){Gl=uw[Or][vd];for(let U0=0;U0<go;++U0){const Mh=64*U0+8*(7&vd);zn.setUint16(Gl+0*$r,Eu[Or][Mh+0],!0),zn.setUint16(Gl+2*$r,Eu[Or][Mh+1],!0),zn.setUint16(Gl+4*$r,Eu[Or][Mh+2],!0),zn.setUint16(Gl+6*$r,Eu[Or][Mh+3],!0),zn.setUint16(Gl+8*$r,Eu[Or][Mh+4],!0),zn.setUint16(Gl+10*$r,Eu[Or][Mh+5],!0),zn.setUint16(Gl+12*$r,Eu[Or][Mh+6],!0),zn.setUint16(Gl+14*$r,Eu[Or][Mh+7],!0),Gl+=16*$r}}if(go!=hl)for(let vd=8*ls;vd<8*ls+k_;++vd){const U0=uw[Or][vd]+8*go*2*$r,Mh=64*go+8*(7&vd);for(let hw=0;hw<O_;++hw)zn.setUint16(U0+2*hw*$r,Eu[Or][Mh+hw],!0)}}}var Rn,Bn;const nM=new Uint16Array(ci);zn=new DataView(Dr.buffer);for(let ls=0;ls<3;++ls){Wn[un.idx[ls]].decoded=!0;const k_=Wn[un.idx[ls]].type;if(Wn[ls].type==2)for(let O_=0;O_<Fi;++O_){const Gl=uw[ls][O_];for(let Or=0;Or<ci;++Or)nM[Or]=zn.getUint16(Gl+2*Or*k_,!0);for(let Or=0;Or<ci;++Or)zn.setFloat32(Gl+2*Or*k_,Rt(nM[Or]),!0)}}})(En,Ln,mn,xn,Tn,it);for(let un=0;un<mn.length;++un){const jn=mn[un];if(!jn.decoded){if(jn.compression!==2)throw new Error("EXRLoader.parse: unsupported channel compression");{let Wn=0,ii=0;for(let Wr=0;Wr<Ce.lines;++Wr){let Dr=Ln[un][Wn];for(let zn=0;zn<jn.width;++zn){for(let ci=0;ci<2*jn.type;++ci)it[Dr++]=yn[ii+ci*jn.width*jn.height];ii++}Wn++}}}}return new DataView(it.buffer)}function yt(Ce,Je){const Te=new Uint8Array(Ce);let it=0;for(;Te[Je.value+it]!=0;)it+=1;const ht=new TextDecoder().decode(Te.slice(Je.value,Je.value+it));return Je.value=Je.value+it+1,ht}function Mt(Ce,Je){const Te=Ce.getInt32(Je.value,!0);return Je.value=Je.value+4,Te}function pt(Ce,Je){const Te=Ce.getUint32(Je.value,!0);return Je.value=Je.value+4,Te}function Qt(Ce,Je){const Te=Ce[Je.value];return Je.value=Je.value+1,Te}function Kt(Ce,Je){const Te=Ce.getUint8(Je.value);return Je.value=Je.value+1,Te}const Jt=function(Ce,Je){const Te=Number(Ce.getBigInt64(Je.value,!0));return Je.value+=8,Te};function tn(Ce,Je){const Te=Ce.getFloat32(Je.value,!0);return Je.value+=4,Te}function Mn(Ce,Je){return c.A5E.toHalfFloat(tn(Ce,Je))}function Rt(Ce){const Je=(31744&Ce)>>10,Te=1023&Ce;return(Ce>>15?-1:1)*(Je?Je===31?Te?NaN:1/0:Math.pow(2,Je-15)*(1+Te/1024):Te/1024*6103515625e-14)}function oi(Ce,Je){const Te=Ce.getUint16(Je.value,!0);return Je.value+=2,Te}function xi(Ce,Je){return Rt(oi(Ce,Je))}function ai(Ce,Je,Te,it,ht){return it==="string"||it==="stringvector"||it==="iccProfile"?function(nt,bt,sn){const mn=new TextDecoder().decode(new Uint8Array(nt).slice(bt.value,bt.value+sn));return bt.value=bt.value+sn,mn}(Je,Te,ht):it==="chlist"?function(nt,bt,sn,mn){const En=sn.value,xn=[];for(;sn.value<En+mn-1;){const Tn=yt(bt,sn),yn=Mt(nt,sn),gn=Kt(nt,sn);sn.value+=3;const Ln=Mt(nt,sn),un=Mt(nt,sn);xn.push({name:Tn,pixelType:yn,pLinear:gn,xSampling:Ln,ySampling:un})}return sn.value+=1,xn}(Ce,Je,Te,ht):it==="chromaticities"?function(nt,bt){return{redX:tn(nt,bt),redY:tn(nt,bt),greenX:tn(nt,bt),greenY:tn(nt,bt),blueX:tn(nt,bt),blueY:tn(nt,bt),whiteX:tn(nt,bt),whiteY:tn(nt,bt)}}(Ce,Te):it==="compression"?function(nt,bt){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][Kt(nt,bt)]}(Ce,Te):it==="box2i"?function(nt,bt){return{xMin:pt(nt,bt),yMin:pt(nt,bt),xMax:pt(nt,bt),yMax:pt(nt,bt)}}(Ce,Te):it==="lineOrder"?function(nt,bt){return["INCREASING_Y"][Kt(nt,bt)]}(Ce,Te):it==="float"?tn(Ce,Te):it==="v2f"?function(nt,bt){return[tn(nt,bt),tn(nt,bt)]}(Ce,Te):it==="v3f"?function(nt,bt){return[tn(nt,bt),tn(nt,bt),tn(nt,bt)]}(Ce,Te):it==="int"?Mt(Ce,Te):it==="rational"?function(nt,bt){return[Mt(nt,bt),pt(nt,bt)]}(Ce,Te):it==="timecode"?function(nt,bt){return[pt(nt,bt),pt(nt,bt)]}(Ce,Te):it==="preview"?(Te.value+=ht,"skipped"):void(Te.value+=ht)}const Yi=new DataView(e),gr=new Uint8Array(e),wt={value:0},Zt=function(Ce,Je,Te){const it={};if(Ce.getUint32(0,!0)!=20000630)throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");it.version=Ce.getUint8(4);const ht=Ce.getUint8(5);it.spec={singleTile:!!(2&ht),longName:!!(4&ht),deepFormat:!!(8&ht),multiPart:!!(16&ht)},Te.value=8;let nt=!0;for(;nt;){const bt=yt(Je,Te);if(bt==0)nt=!1;else{const sn=yt(Je,Te),mn=ai(Ce,Je,Te,sn,pt(Ce,Te));mn===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${sn}'.`):it[bt]=mn}}if(-5&ht)throw console.error("EXRHeader:",it),new Error("THREE.EXRLoader: provided file is currently unsupported.");return it}(Yi,e,wt),en=function(Ce,Je,Te,it,ht){const nt={size:0,viewer:Je,array:Te,offset:it,width:Ce.dataWindow.xMax-Ce.dataWindow.xMin+1,height:Ce.dataWindow.yMax-Ce.dataWindow.yMin+1,channels:Ce.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:Ce.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(Ce.compression){case"NO_COMPRESSION":nt.lines=1,nt.uncompress=Qe;break;case"RLE_COMPRESSION":nt.lines=1,nt.uncompress=Oe;break;case"ZIPS_COMPRESSION":nt.lines=1,nt.uncompress=ze;break;case"ZIP_COMPRESSION":nt.lines=16,nt.uncompress=ze;break;case"PIZ_COMPRESSION":nt.lines=32,nt.uncompress=$e;break;case"PXR24_COMPRESSION":nt.lines=16,nt.uncompress=Ge;break;case"DWAA_COMPRESSION":nt.lines=32,nt.uncompress=ot;break;case"DWAB_COMPRESSION":nt.lines=256,nt.uncompress=ot;break;default:throw new Error("EXRLoader.parse: "+Ce.compression+" is unsupported")}if(nt.scanlineBlockSize=nt.lines,nt.type==1)switch(ht){case c.VzW:nt.getter=xi,nt.inputSize=2;break;case c.cLu:nt.getter=oi,nt.inputSize=2}else{if(nt.type!=2)throw new Error("EXRLoader.parse: unsupported pixelType "+nt.type+" for "+Ce.compression+".");switch(ht){case c.VzW:nt.getter=tn,nt.inputSize=4;break;case c.cLu:nt.getter=Mn,nt.inputSize=4}}nt.blockCount=(Ce.dataWindow.yMax+1)/nt.scanlineBlockSize;for(let sn=0;sn<nt.blockCount;sn++)Jt(Je,it);nt.outputChannels=nt.channels==3?4:nt.channels;const bt=nt.width*nt.height*nt.outputChannels;switch(ht){case c.VzW:nt.byteArray=new Float32Array(bt),nt.channels<nt.outputChannels&&nt.byteArray.fill(1,0,bt);break;case c.cLu:nt.byteArray=new Uint16Array(bt),nt.channels<nt.outputChannels&&nt.byteArray.fill(15360,0,bt);break;default:console.error("THREE.EXRLoader: unsupported type: ",ht)}return nt.bytesPerLine=nt.width*nt.inputSize*nt.channels,nt.outputChannels==4?(nt.format=c.wk1,nt.encoding=c.rnI):(nt.format=c.hEm,nt.encoding=c.rnI),nt}(Zt,Yi,gr,wt,this.type),li={value:0},dr={R:0,G:1,B:2,A:3,Y:0};for(let Ce=0;Ce<en.height/en.scanlineBlockSize;Ce++){const Je=pt(Yi,wt);en.size=pt(Yi,wt),en.lines=Je+en.scanlineBlockSize>en.height?en.height-Je:en.scanlineBlockSize;const Te=en.size<en.lines*en.bytesPerLine?en.uncompress(en):Qe(en);wt.value+=en.size;for(let it=0;it<en.scanlineBlockSize;it++){const ht=it+Ce*en.scanlineBlockSize;if(ht>=en.height)break;for(let nt=0;nt<en.channels;nt++){const bt=dr[Zt.channels[nt].name];for(let sn=0;sn<en.width;sn++){li.value=(it*(en.channels*en.width)+nt*en.width+sn)*en.inputSize;const mn=(en.height-1-ht)*(en.width*en.outputChannels)+sn*en.outputChannels+bt;en.byteArray[mn]=en.getter(Te,li)}}}}return{header:Zt,width:en.width,height:en.height,data:en.byteArray,format:en.format,encoding:en.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,r){return super.load(e,function(o,a){o.encoding=a.encoding,o.minFilter=c.wem,o.magFilter=c.wem,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,a)},n,r)}}class jo extends w{constructor(){super(...arguments),this.dependencies=[dn]}async onAdded(e){this._importer||(this._importer=new Nr(class extends vy{constructor(t){super(t),this.setDataType(Nm(e.renderer.rendererObject))}},["exr"],!1)),bi.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&bi.Importers.splice(bi.Importers.indexOf(this._importer),1),this._importer=void 0}}function $v(s,e,t){const n=t.length-s-1;if(e>=t[n])return n-1;if(e<=t[s])return s;let r=s,o=n,a=Math.floor((r+o)/2);for(;e<t[a]||e>=t[a+1];)e<t[a]?o=a:r=a,a=Math.floor((r+o)/2);return a}function Ay(s,e){let t=1;for(let r=2;r<=s;++r)t*=r;let n=1;for(let r=2;r<=e;++r)n*=r;for(let r=2;r<=s-e;++r)n*=r;return t/n}jo.PluginType="EXRLoadPlugin";class Zv extends c.Hyl{constructor(e,t,n,r,o){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=r||0,this.endKnot=o||this.knots.length-1;for(let a=0;a<n.length;++a){const u=n[a];this.controlPoints[a]=new c.Ltg(u.x,u.y,u.z,u.w)}}getPoint(e,t=new c.Pa4){const n=t,r=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),o=function(a,u,p,f){const m=$v(a,f,u),y=function(M,P,D,j){const k=[],L=[],R=[];k[0]=1;for(let W=1;W<=D;++W){L[W]=P-j[M+1-W],R[W]=j[M+W]-P;let q=0;for(let J=0;J<W;++J){const ee=R[J+1],he=L[W-J],xe=k[J]/(ee+he);k[J]=q+ee*xe,q=he*xe}k[W]=q}return k}(m,f,a,u),S=new c.Ltg(0,0,0,0);for(let M=0;M<=a;++M){const P=p[m-a+M],D=y[M],j=P.w*D;S.x+=P.x*j,S.y+=P.y*j,S.z+=P.z*j,S.w+=P.w*D}return S}(this.degree,this.knots,this.controlPoints,r);return o.w!==1&&o.divideScalar(o.w),n.set(o.x,o.y,o.z)}getTangent(e,t=new c.Pa4){const n=t,r=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),o=function(a,u,p,f,m){const y=function(S,M,P,D,j){const k=j<S?j:S,L=[],R=$v(S,D,M),W=function(J,ee,he,xe,De){const Fe=[];for(let Ge=0;Ge<=he;++Ge)Fe[Ge]=0;const ke=[];for(let Ge=0;Ge<=xe;++Ge)ke[Ge]=Fe.slice(0);const Qe=[];for(let Ge=0;Ge<=he;++Ge)Qe[Ge]=Fe.slice(0);Qe[0][0]=1;const Oe=Fe.slice(0),ze=Fe.slice(0);for(let Ge=1;Ge<=he;++Ge){Oe[Ge]=ee-De[J+1-Ge],ze[Ge]=De[J+Ge]-ee;let ot=0;for(let yt=0;yt<Ge;++yt){const Mt=ze[yt+1],pt=Oe[Ge-yt];Qe[Ge][yt]=Mt+pt;const Qt=Qe[yt][Ge-1]/Qe[Ge][yt];Qe[yt][Ge]=ot+Mt*Qt,ot=pt*Qt}Qe[Ge][Ge]=ot}for(let Ge=0;Ge<=he;++Ge)ke[0][Ge]=Qe[Ge][he];for(let Ge=0;Ge<=he;++Ge){let ot=0,yt=1;const Mt=[];for(let pt=0;pt<=he;++pt)Mt[pt]=Fe.slice(0);Mt[0][0]=1;for(let pt=1;pt<=xe;++pt){let Qt=0;const Kt=Ge-pt,Jt=he-pt;Ge>=pt&&(Mt[yt][0]=Mt[ot][0]/Qe[Jt+1][Kt],Qt=Mt[yt][0]*Qe[Kt][Jt]);const tn=Ge-1<=Jt?pt-1:he-Ge;for(let Rt=Kt>=-1?1:-Kt;Rt<=tn;++Rt)Mt[yt][Rt]=(Mt[ot][Rt]-Mt[ot][Rt-1])/Qe[Jt+1][Kt+Rt],Qt+=Mt[yt][Rt]*Qe[Kt+Rt][Jt];Ge<=Jt&&(Mt[yt][pt]=-Mt[ot][pt-1]/Qe[Jt+1][Ge],Qt+=Mt[yt][pt]*Qe[Ge][Jt]),ke[pt][Ge]=Qt;const Mn=ot;ot=yt,yt=Mn}}let $e=he;for(let Ge=1;Ge<=xe;++Ge){for(let ot=0;ot<=he;++ot)ke[Ge][ot]*=$e;$e*=he-Ge}return ke}(R,D,S,k,M),q=[];for(let J=0;J<P.length;++J){const ee=P[J].clone(),he=ee.w;ee.x*=he,ee.y*=he,ee.z*=he,q[J]=ee}for(let J=0;J<=k;++J){const ee=q[R-S].clone().multiplyScalar(W[J][0]);for(let he=1;he<=S;++he)ee.add(q[R-S+he].clone().multiplyScalar(W[J][he]));L[J]=ee}for(let J=k+1;J<=j+1;++J)L[J]=new c.Ltg(0,0,0);return L}(a,u,p,f,m);return function(S){const M=S.length,P=[],D=[];for(let k=0;k<M;++k){const L=S[k];P[k]=new c.Pa4(L.x,L.y,L.z),D[k]=L.w}const j=[];for(let k=0;k<M;++k){const L=P[k].clone();for(let R=1;R<=k;++R)L.sub(j[k-R].clone().multiplyScalar(Ay(k,R)*D[R]));j[k]=L.divideScalar(D[0])}return j}(y)}(this.degree,this.knots,this.controlPoints,r,1);return n.copy(o[1]).normalize(),n}}let Ni,os,zo;class yy extends c.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=o.path===""?c.Zp0.extractUrlBase(e):o.path,u=new c.hH6(this.manager);u.setPath(o.path),u.setResponseType("arraybuffer"),u.setRequestHeader(o.requestHeader),u.setWithCredentials(o.withCredentials),u.load(e,function(p){try{t(o.parse(p,a))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},n,r)}parse(e,t){if(function(r){const o="Kaydara FBX Binary  \0";return r.byteLength>=o.length&&o===Hr(r,0,o.length)}(e))Ni=new Tw().parse(e);else{const r=Hr(e);if(!function(o){const a=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"];let u=0;function p(f){const m=o[f-1];return o=o.slice(u+f),u++,m}for(let f=0;f<a.length;++f)if(p(1)===a[f])return!1;return!0}(r))throw new Error("THREE.FBXLoader: Unknown format.");if(Ve(r)<7e3)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+Ve(r));Ni=new Yg().parse(r)}const n=new c.dpR(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);return new sd(n,this.manager).parse(Ni)}}class sd{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){os=this.parseConnections();const e=this.parseImages(),t=this.parseTextures(e),n=this.parseMaterials(t),r=this.parseDeformers(),o=new by().parse(r);return this.parseScene(r,o,n),zo}parseConnections(){const e=new Map;return"Connections"in Ni&&Ni.Connections.connections.forEach(function(t){const n=t[0],r=t[1],o=t[2];e.has(n)||e.set(n,{parents:[],children:[]});const a={ID:r,relationship:o};e.get(n).parents.push(a),e.has(r)||e.set(r,{parents:[],children:[]});const u={ID:n,relationship:o};e.get(r).children.push(u)}),e}parseImages(){const e={},t={};if("Video"in Ni.Objects){const n=Ni.Objects.Video;for(const r in n){const o=n[r];if(e[parseInt(r)]=o.RelativeFilename||o.Filename,"Content"in o){const a=o.Content instanceof ArrayBuffer&&o.Content.byteLength>0,u=typeof o.Content=="string"&&o.Content!=="";if(a||u){const p=this.parseImage(n[r]);t[o.RelativeFilename||o.Filename]=p}}}}for(const n in e){const r=e[n];t[r]!==void 0?e[n]=t[r]:e[n]=e[n].split("\\").pop()}return e}parseImage(e){const t=e.Content,n=e.RelativeFilename||e.Filename,r=n.slice(n.lastIndexOf(".")+1).toLowerCase();let o;switch(r){case"bmp":o="image/bmp";break;case"jpg":case"jpeg":o="image/jpeg";break;case"png":o="image/png";break;case"tif":o="image/tiff";break;case"tga":this.manager.getHandler(".tga")===null&&console.warn("FBXLoader: TGA loader not found, skipping ",n),o="image/tga";break;default:return void console.warn('FBXLoader: Image type "'+r+'" is not supported.')}if(typeof t=="string")return"data:"+o+";base64,"+t;{const a=new Uint8Array(t);return window.URL.createObjectURL(new Blob([a],{type:o}))}}parseTextures(e){const t=new Map;if("Texture"in Ni.Objects){const n=Ni.Objects.Texture;for(const r in n){const o=this.parseTexture(n[r],e);t.set(parseInt(r),o)}}return t}parseTexture(e,t){const n=this.loadTexture(e,t);n.ID=e.id,n.name=e.attrName;const r=e.WrapModeU,o=e.WrapModeV,a=r!==void 0?r.value:0,u=o!==void 0?o.value:0;if(n.wrapS=a===0?c.rpg:c.uWy,n.wrapT=u===0?c.rpg:c.uWy,"Scaling"in e){const p=e.Scaling.value;n.repeat.x=p[0],n.repeat.y=p[1]}if("Translation"in e){const p=e.Translation.value;n.offset.x=p[0],n.offset.y=p[1]}return n}loadTexture(e,t){let n;const r=this.textureLoader.path,o=os.get(e.id).children;let a;o!==void 0&&o.length>0&&t[o[0].ID]!==void 0&&(n=t[o[0].ID],n.indexOf("blob:")!==0&&n.indexOf("data:")!==0||this.textureLoader.setPath(void 0));const u=e.FileName.slice(-3).toLowerCase();if(u==="tga"){const p=this.manager.getHandler(".tga");p===null?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),a=new c.xEZ):(p.setPath(this.textureLoader.path),a=p.load(n))}else u==="psd"?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),a=new c.xEZ):a=this.textureLoader.load(n);return this.textureLoader.setPath(r),a}parseMaterials(e){const t=new Map;if("Material"in Ni.Objects){const n=Ni.Objects.Material;for(const r in n){const o=this.parseMaterial(n[r],e);o!==null&&t.set(parseInt(r),o)}}return t}parseMaterial(e,t){const n=e.id,r=e.attrName;let o=e.ShadingModel;if(typeof o=="object"&&(o=o.value),!os.has(n))return null;const a=this.parseParameters(e,t,n);let u;switch(o.toLowerCase()){case"phong":u=new c.xoR;break;case"lambert":u=new c.YBo;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',o),u=new c.xoR}return u.setValues(a),u.name=r,u}parseParameters(e,t,n){const r={};e.BumpFactor&&(r.bumpScale=e.BumpFactor.value),e.Diffuse?r.color=new c.Ilk().fromArray(e.Diffuse.value):!e.DiffuseColor||e.DiffuseColor.type!=="Color"&&e.DiffuseColor.type!=="ColorRGB"||(r.color=new c.Ilk().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(r.displacementScale=e.DisplacementFactor.value),e.Emissive?r.emissive=new c.Ilk().fromArray(e.Emissive.value):!e.EmissiveColor||e.EmissiveColor.type!=="Color"&&e.EmissiveColor.type!=="ColorRGB"||(r.emissive=new c.Ilk().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(r.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(r.opacity=parseFloat(e.Opacity.value)),r.opacity<1&&(r.transparent=!0),e.ReflectionFactor&&(r.reflectivity=e.ReflectionFactor.value),e.Shininess&&(r.shininess=e.Shininess.value),e.Specular?r.specular=new c.Ilk().fromArray(e.Specular.value):e.SpecularColor&&e.SpecularColor.type==="Color"&&(r.specular=new c.Ilk().fromArray(e.SpecularColor.value));const o=this;return os.get(n).children.forEach(function(a){const u=a.relationship;switch(u){case"Bump":r.bumpMap=o.getTexture(t,a.ID);break;case"Maya|TEX_ao_map":r.aoMap=o.getTexture(t,a.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":r.map=o.getTexture(t,a.ID),r.map!==void 0&&(r.map.encoding=c.knz);break;case"DisplacementColor":r.displacementMap=o.getTexture(t,a.ID);break;case"EmissiveColor":r.emissiveMap=o.getTexture(t,a.ID),r.emissiveMap!==void 0&&(r.emissiveMap.encoding=c.knz);break;case"NormalMap":case"Maya|TEX_normal_map":r.normalMap=o.getTexture(t,a.ID);break;case"ReflectionColor":r.envMap=o.getTexture(t,a.ID),r.envMap!==void 0&&(r.envMap.mapping=c.dSO,r.envMap.encoding=c.knz);break;case"SpecularColor":r.specularMap=o.getTexture(t,a.ID),r.specularMap!==void 0&&(r.specularMap.encoding=c.knz);break;case"TransparentColor":case"TransparencyFactor":r.alphaMap=o.getTexture(t,a.ID),r.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",u)}}),r}getTexture(e,t){return"LayeredTexture"in Ni.Objects&&t in Ni.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=os.get(t).children[0].ID),e.get(t)}parseDeformers(){const e={},t={};if("Deformer"in Ni.Objects){const n=Ni.Objects.Deformer;for(const r in n){const o=n[r],a=os.get(parseInt(r));if(o.attrType==="Skin"){const u=this.parseSkeleton(a,n);u.ID=r,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),u.geometryID=a.parents[0].ID,e[r]=u}else if(o.attrType==="BlendShape"){const u={id:r};u.rawTargets=this.parseMorphTargets(a,n),u.id=r,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[r]=u}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){const n=[];return e.children.forEach(function(r){const o=t[r.ID];if(o.attrType!=="Cluster")return;const a={ID:r.ID,indices:[],weights:[],transformLink:new c.yGw().fromArray(o.TransformLink.a)};"Indexes"in o&&(a.indices=o.Indexes.a,a.weights=o.Weights.a),n.push(a)}),{rawBones:n,bones:[]}}parseMorphTargets(e,t){const n=[];for(let r=0;r<e.children.length;r++){const o=e.children[r],a=t[o.ID],u={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if(a.attrType!=="BlendShapeChannel")return;u.geoID=os.get(parseInt(o.ID)).children.filter(function(p){return p.relationship===void 0})[0].ID,n.push(u)}return n}parseScene(e,t,n){zo=new c.ZAu;const r=this.parseModels(e.skeletons,t,n),o=Ni.Objects.Model,a=this;r.forEach(function(p){const f=o[p.ID];a.setLookAtProperties(p,f),os.get(p.ID).parents.forEach(function(m){const y=r.get(m.ID);y!==void 0&&y.add(p)}),p.parent===null&&zo.add(p)}),this.bindSkeleton(e.skeletons,t,r),this.createAmbientLight(),zo.traverse(function(p){if(p.userData.transformData){p.parent&&(p.userData.transformData.parentMatrix=p.parent.matrix,p.userData.transformData.parentMatrixWorld=p.parent.matrixWorld);const f=Wi(p.userData.transformData);p.applyMatrix4(f),p.updateWorldMatrix()}});const u=new wy().parse();zo.children.length===1&&zo.children[0].isGroup&&(zo.children[0].animations=u,zo=zo.children[0]),zo.animations=u}parseModels(e,t,n){const r=new Map,o=Ni.Objects.Model;for(const a in o){const u=parseInt(a),p=o[a],f=os.get(u);let m=this.buildSkeleton(f,e,u,p.attrName);if(!m){switch(p.attrType){case"Camera":m=this.createCamera(f);break;case"Light":m=this.createLight(f);break;case"Mesh":m=this.createMesh(f,t,n);break;case"NurbsCurve":m=this.createCurve(f,t);break;case"LimbNode":case"Root":m=new c.N$j;break;default:m=new c.ZAu}m.name=p.attrName?c.iUV.sanitizeNodeName(p.attrName):"",m.ID=u}this.getTransformData(m,p),r.set(u,m)}return r}buildSkeleton(e,t,n,r){let o=null;return e.parents.forEach(function(a){for(const u in t){const p=t[u];p.rawBones.forEach(function(f,m){if(f.ID===a.ID){const y=o;o=new c.N$j,o.matrixWorld.copy(f.transformLink),o.name=r?c.iUV.sanitizeNodeName(r):"",o.ID=n,p.bones[m]=o,y!==null&&o.add(y)}})}}),o}createCamera(e){let t,n;if(e.children.forEach(function(r){const o=Ni.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new c.Tme;else{let r=0;n.CameraProjectionType!==void 0&&n.CameraProjectionType.value===1&&(r=1);let o=1;n.NearPlane!==void 0&&(o=n.NearPlane.value/1e3);let a=1e3;n.FarPlane!==void 0&&(a=n.FarPlane.value/1e3);let u=window.innerWidth,p=window.innerHeight;n.AspectWidth!==void 0&&n.AspectHeight!==void 0&&(u=n.AspectWidth.value,p=n.AspectHeight.value);const f=u/p;let m=45;n.FieldOfView!==void 0&&(m=n.FieldOfView.value);const y=n.FocalLength?n.FocalLength.value:null;switch(r){case 0:t=new c.cPb(m,f,o,a),y!==null&&t.setFocalLength(y);break;case 1:t=new c.iKG(-u/2,u/2,p/2,-p/2,o,a);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+r+"."),t=new c.Tme}}return t}createLight(e){let t,n;if(e.children.forEach(function(r){const o=Ni.Objects.NodeAttribute[r.ID];o!==void 0&&(n=o)}),n===void 0)t=new c.Tme;else{n.LightType===void 0||n.LightType.value;let r=16777215;n.Color!==void 0&&(r=new c.Ilk().fromArray(n.Color.value));let o=n.Intensity===void 0?1:n.Intensity.value/100;n.CastLightOnObject!==void 0&&n.CastLightOnObject.value===0&&(o=0);let a=0;n.FarAttenuationEnd!==void 0&&(a=n.EnableFarAttenuation!==void 0&&n.EnableFarAttenuation.value===0?0:n.FarAttenuationEnd.value);const u=1;switch(e){case 0:t=new c.cek(r,o,a,u);break;case 1:t=new c.Ox3(r,o);break;case 2:let p=Math.PI/3;n.InnerAngle!==void 0&&(p=c.M8C.degToRad(n.InnerAngle.value));let f=0;n.OuterAngle!==void 0&&(f=c.M8C.degToRad(n.OuterAngle.value),f=Math.max(f,1)),t=new c.PMe(r,o,a,p,f,u);break;default:console.warn("THREE.FBXLoader: Unknown light type "+n.LightType.value+", defaulting to a PointLight."),t=new c.cek(r,o)}n.CastShadows!==void 0&&n.CastShadows.value===1&&(t.castShadow=!0)}return t}createMesh(e,t,n){let r,o=null,a=null;const u=[];return e.children.forEach(function(p){t.has(p.ID)&&(o=t.get(p.ID)),n.has(p.ID)&&u.push(n.get(p.ID))}),u.length>1?a=u:u.length>0?a=u[0]:(a=new c.xoR({color:13421772}),u.push(a)),"color"in o.attributes&&u.forEach(function(p){p.vertexColors=!0}),o.FBX_Deformer?(r=new c.TUv(o,a),r.normalizeSkinWeights()):r=new c.Kj0(o,a),r}createCurve(e,t){const n=e.children.reduce(function(o,a){return t.has(a.ID)&&(o=t.get(a.ID)),o},null),r=new c.nls({color:3342591,linewidth:1});return new c.x12(n,r)}getTransformData(e,t){const n={};"InheritType"in t&&(n.inheritType=parseInt(t.InheritType.value)),n.eulerOrder="RotationOrder"in t?Kn(t.RotationOrder.value):"ZYX","Lcl_Translation"in t&&(n.translation=t.Lcl_Translation.value),"PreRotation"in t&&(n.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(n.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(n.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(n.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(n.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(n.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(n.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(n.rotationPivot=t.RotationPivot.value),e.userData.transformData=n}setLookAtProperties(e,t){"LookAtProperty"in t&&os.get(e.ID).children.forEach(function(n){if(n.relationship==="LookAtProperty"){const r=Ni.Objects.Model[n.ID];if("Lcl_Translation"in r){const o=r.Lcl_Translation.value;e.target!==void 0?(e.target.position.fromArray(o),zo.add(e.target)):e.lookAt(new c.Pa4().fromArray(o))}}})}bindSkeleton(e,t,n){const r=this.parsePoseNodes();for(const o in e){const a=e[o];os.get(parseInt(a.ID)).parents.forEach(function(u){if(t.has(u.ID)){const p=u.ID;os.get(p).parents.forEach(function(f){n.has(f.ID)&&n.get(f.ID).bind(new c.OdW(a.bones),r[f.ID])})}})}}parsePoseNodes(){const e={};if("Pose"in Ni.Objects){const t=Ni.Objects.Pose;for(const n in t)if(t[n].attrType==="BindPose"&&t[n].NbPoseNodes>0){const r=t[n].PoseNode;Array.isArray(r)?r.forEach(function(o){e[o.Node]=new c.yGw().fromArray(o.Matrix.a)}):e[r.Node]=new c.yGw().fromArray(r.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in Ni&&"AmbientColor"in Ni.GlobalSettings){const e=Ni.GlobalSettings.AmbientColor.value,t=e[0],n=e[1],r=e[2];if(t!==0||n!==0||r!==0){const o=new c.Ilk(t,n,r);zo.add(new c.Mig(o,1))}}}}class by{parse(e){const t=new Map;if("Geometry"in Ni.Objects){const n=Ni.Objects.Geometry;for(const r in n){const o=os.get(parseInt(r)),a=this.parseGeometry(o,n[r],e);t.set(parseInt(r),a)}}return t}parseGeometry(e,t,n){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,n);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,n){const r=n.skeletons,o=[],a=e.parents.map(function(y){return Ni.Objects.Model[y.ID]});if(a.length===0)return;const u=e.children.reduce(function(y,S){return r[S.ID]!==void 0&&(y=r[S.ID]),y},null);e.children.forEach(function(y){n.morphTargets[y.ID]!==void 0&&o.push(n.morphTargets[y.ID])});const p=a[0],f={};"RotationOrder"in p&&(f.eulerOrder=Kn(p.RotationOrder.value)),"InheritType"in p&&(f.inheritType=parseInt(p.InheritType.value)),"GeometricTranslation"in p&&(f.translation=p.GeometricTranslation.value),"GeometricRotation"in p&&(f.rotation=p.GeometricRotation.value),"GeometricScaling"in p&&(f.scale=p.GeometricScaling.value);const m=Wi(f);return this.genGeometry(t,u,o,m)}genGeometry(e,t,n,r){const o=new c.u9r;e.attrName&&(o.name=e.attrName);const a=this.parseGeoNode(e,t),u=this.genBuffers(a),p=new c.a$l(u.vertex,3);if(p.applyMatrix4(r),o.setAttribute("position",p),u.colors.length>0&&o.setAttribute("color",new c.a$l(u.colors,3)),t&&(o.setAttribute("skinIndex",new c.qlB(u.weightsIndices,4)),o.setAttribute("skinWeight",new c.a$l(u.vertexWeights,4)),o.FBX_Deformer=t),u.normal.length>0){const f=new c.Vkp().getNormalMatrix(r),m=new c.a$l(u.normal,3);m.applyNormalMatrix(f),o.setAttribute("normal",m)}if(u.uvs.forEach(function(f,m){let y="uv"+(m+1).toString();m===0&&(y="uv"),o.setAttribute(y,new c.a$l(u.uvs[m],2))}),a.material&&a.material.mappingType!=="AllSame"){let f=u.materialIndex[0],m=0;if(u.materialIndex.forEach(function(y,S){y!==f&&(o.addGroup(m,S-m,f),f=y,m=S)}),o.groups.length>0){const y=o.groups[o.groups.length-1],S=y.start+y.count;S!==u.materialIndex.length&&o.addGroup(S,u.materialIndex.length-S,f)}o.groups.length===0&&o.addGroup(0,u.materialIndex.length,u.materialIndex[0])}return this.addMorphTargets(o,e,n,r),o}parseGeoNode(e,t){const n={};if(n.vertexPositions=e.Vertices!==void 0?e.Vertices.a:[],n.vertexIndices=e.PolygonVertexIndex!==void 0?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(n.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(n.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(n.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){n.uv=[];let r=0;for(;e.LayerElementUV[r];)e.LayerElementUV[r].UV&&n.uv.push(this.parseUVs(e.LayerElementUV[r])),r++}return n.weightTable={},t!==null&&(n.skeleton=t,t.rawBones.forEach(function(r,o){r.indices.forEach(function(a,u){n.weightTable[a]===void 0&&(n.weightTable[a]=[]),n.weightTable[a].push({id:o,weight:r.weights[u]})})})),n}genBuffers(e){const t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]};let n=0,r=0,o=!1,a=[],u=[],p=[],f=[],m=[],y=[];const S=this;return e.vertexIndices.forEach(function(M,P){let D,j=!1;M<0&&(M^=-1,j=!0);let k=[],L=[];if(a.push(3*M,3*M+1,3*M+2),e.color){const R=Vt(P,n,M,e.color);p.push(R[0],R[1],R[2])}if(e.skeleton){if(e.weightTable[M]!==void 0&&e.weightTable[M].forEach(function(R){L.push(R.weight),k.push(R.id)}),L.length>4){o||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),o=!0);const R=[0,0,0,0],W=[0,0,0,0];L.forEach(function(q,J){let ee=q,he=k[J];W.forEach(function(xe,De,Fe){if(ee>xe){Fe[De]=ee,ee=xe;const ke=R[De];R[De]=he,he=ke}})}),k=R,L=W}for(;L.length<4;)L.push(0),k.push(0);for(let R=0;R<4;++R)m.push(L[R]),y.push(k[R])}if(e.normal){const R=Vt(P,n,M,e.normal);u.push(R[0],R[1],R[2])}e.material&&e.material.mappingType!=="AllSame"&&(D=Vt(P,n,M,e.material)[0],D<0&&(console.warn("THREE.FBXLoader: Invalid material index:",D),D=0)),e.uv&&e.uv.forEach(function(R,W){const q=Vt(P,n,M,R);f[W]===void 0&&(f[W]=[]),f[W].push(q[0]),f[W].push(q[1])}),r++,j&&(S.genFace(t,e,a,D,u,p,f,m,y,r),n++,r=0,a=[],u=[],p=[],f=[],m=[],y=[])}),t}genFace(e,t,n,r,o,a,u,p,f,m){for(let y=2;y<m;y++)e.vertex.push(t.vertexPositions[n[0]]),e.vertex.push(t.vertexPositions[n[1]]),e.vertex.push(t.vertexPositions[n[2]]),e.vertex.push(t.vertexPositions[n[3*(y-1)]]),e.vertex.push(t.vertexPositions[n[3*(y-1)+1]]),e.vertex.push(t.vertexPositions[n[3*(y-1)+2]]),e.vertex.push(t.vertexPositions[n[3*y]]),e.vertex.push(t.vertexPositions[n[3*y+1]]),e.vertex.push(t.vertexPositions[n[3*y+2]]),t.skeleton&&(e.vertexWeights.push(p[0]),e.vertexWeights.push(p[1]),e.vertexWeights.push(p[2]),e.vertexWeights.push(p[3]),e.vertexWeights.push(p[4*(y-1)]),e.vertexWeights.push(p[4*(y-1)+1]),e.vertexWeights.push(p[4*(y-1)+2]),e.vertexWeights.push(p[4*(y-1)+3]),e.vertexWeights.push(p[4*y]),e.vertexWeights.push(p[4*y+1]),e.vertexWeights.push(p[4*y+2]),e.vertexWeights.push(p[4*y+3]),e.weightsIndices.push(f[0]),e.weightsIndices.push(f[1]),e.weightsIndices.push(f[2]),e.weightsIndices.push(f[3]),e.weightsIndices.push(f[4*(y-1)]),e.weightsIndices.push(f[4*(y-1)+1]),e.weightsIndices.push(f[4*(y-1)+2]),e.weightsIndices.push(f[4*(y-1)+3]),e.weightsIndices.push(f[4*y]),e.weightsIndices.push(f[4*y+1]),e.weightsIndices.push(f[4*y+2]),e.weightsIndices.push(f[4*y+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[3*(y-1)]),e.colors.push(a[3*(y-1)+1]),e.colors.push(a[3*(y-1)+2]),e.colors.push(a[3*y]),e.colors.push(a[3*y+1]),e.colors.push(a[3*y+2])),t.material&&t.material.mappingType!=="AllSame"&&(e.materialIndex.push(r),e.materialIndex.push(r),e.materialIndex.push(r)),t.normal&&(e.normal.push(o[0]),e.normal.push(o[1]),e.normal.push(o[2]),e.normal.push(o[3*(y-1)]),e.normal.push(o[3*(y-1)+1]),e.normal.push(o[3*(y-1)+2]),e.normal.push(o[3*y]),e.normal.push(o[3*y+1]),e.normal.push(o[3*y+2])),t.uv&&t.uv.forEach(function(S,M){e.uvs[M]===void 0&&(e.uvs[M]=[]),e.uvs[M].push(u[M][0]),e.uvs[M].push(u[M][1]),e.uvs[M].push(u[M][2*(y-1)]),e.uvs[M].push(u[M][2*(y-1)+1]),e.uvs[M].push(u[M][2*y]),e.uvs[M].push(u[M][2*y+1])})}addMorphTargets(e,t,n,r){if(n.length===0)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];const o=this;n.forEach(function(a){a.rawTargets.forEach(function(u){const p=Ni.Objects.Geometry[u.geoID];p!==void 0&&o.genMorphGeometry(e,t,p,r,u.name)})})}genMorphGeometry(e,t,n,r,o){const a=t.PolygonVertexIndex!==void 0?t.PolygonVertexIndex.a:[],u=n.Vertices!==void 0?n.Vertices.a:[],p=n.Indexes!==void 0?n.Indexes.a:[],f=3*e.attributes.position.count,m=new Float32Array(f);for(let P=0;P<p.length;P++){const D=3*p[P];m[D]=u[3*P],m[D+1]=u[3*P+1],m[D+2]=u[3*P+2]}const y={vertexIndices:a,vertexPositions:m},S=this.genBuffers(y),M=new c.a$l(S.vertex,3);M.name=o||n.attrName,M.applyMatrix4(r),e.morphAttributes.position.push(M)}parseNormals(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Normals.a;let o=[];return n==="IndexToDirect"&&("NormalIndex"in e?o=e.NormalIndex.a:"NormalsIndex"in e&&(o=e.NormalsIndex.a)),{dataSize:3,buffer:r,indices:o,mappingType:t,referenceType:n}}parseUVs(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.UV.a;let o=[];return n==="IndexToDirect"&&(o=e.UVIndex.a),{dataSize:2,buffer:r,indices:o,mappingType:t,referenceType:n}}parseVertexColors(e){const t=e.MappingInformationType,n=e.ReferenceInformationType,r=e.Colors.a;let o=[];return n==="IndexToDirect"&&(o=e.ColorIndex.a),{dataSize:4,buffer:r,indices:o,mappingType:t,referenceType:n}}parseMaterialIndices(e){const t=e.MappingInformationType,n=e.ReferenceInformationType;if(t==="NoMappingInformation")return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:n};const r=e.Materials.a,o=[];for(let a=0;a<r.length;++a)o.push(a);return{dataSize:1,buffer:r,indices:o,mappingType:t,referenceType:n}}parseNurbsGeometry(e){if(Zv===void 0)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new c.u9r;const t=parseInt(e.Order);if(isNaN(t))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new c.u9r;const n=t-1,r=e.KnotVector.a,o=[],a=e.Points.a;for(let m=0,y=a.length;m<y;m+=4)o.push(new c.Ltg().fromArray(a,m));let u,p;if(e.Form==="Closed")o.push(o[0]);else if(e.Form==="Periodic"){u=n,p=r.length-1-u;for(let m=0;m<n;++m)o.push(o[m])}const f=new Zv(n,r,o,u,p).getPoints(12*o.length);return new c.u9r().setFromPoints(f)}}class wy{parse(){const e=[],t=this.parseClips();if(t!==void 0)for(const n in t){const r=t[n],o=this.addClip(r);e.push(o)}return e}parseClips(){if(Ni.Objects.AnimationCurve===void 0)return;const e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);const t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){const e=Ni.Objects.AnimationCurveNode,t=new Map;for(const n in e){const r=e[n];if(r.attrName.match(/S|R|T|DeformPercent/)!==null){const o={id:r.id,attr:r.attrName,curves:{}};t.set(o.id,o)}}return t}parseAnimationCurves(e){const t=Ni.Objects.AnimationCurve;for(const n in t){const r={id:t[n].id,times:t[n].KeyTime.a.map(Bt),values:t[n].KeyValueFloat.a},o=os.get(r.id);if(o!==void 0){const a=o.parents[0].ID,u=o.parents[0].relationship;u.match(/X/)?e.get(a).curves.x=r:u.match(/Y/)?e.get(a).curves.y=r:u.match(/Z/)?e.get(a).curves.z=r:u.match(/d|DeformPercent/)&&e.has(a)&&(e.get(a).curves.morph=r)}}}parseAnimationLayers(e){const t=Ni.Objects.AnimationLayer,n=new Map;for(const r in t){const o=[],a=os.get(parseInt(r));a!==void 0&&(a.children.forEach(function(u,p){if(e.has(u.ID)){const f=e.get(u.ID);if(f.curves.x!==void 0||f.curves.y!==void 0||f.curves.z!==void 0){if(o[p]===void 0){const m=os.get(u.ID).parents.filter(function(y){return y.relationship!==void 0})[0].ID;if(m!==void 0){const y=Ni.Objects.Model[m.toString()];if(y===void 0)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",u);const S={modelName:y.attrName?c.iUV.sanitizeNodeName(y.attrName):"",ID:y.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};zo.traverse(function(M){M.ID===y.id&&(S.transform=M.matrix,M.userData.transformData&&(S.eulerOrder=M.userData.transformData.eulerOrder))}),S.transform||(S.transform=new c.yGw),"PreRotation"in y&&(S.preRotation=y.PreRotation.value),"PostRotation"in y&&(S.postRotation=y.PostRotation.value),o[p]=S}}o[p]&&(o[p][f.attr]=f)}else if(f.curves.morph!==void 0){if(o[p]===void 0){const m=os.get(u.ID).parents.filter(function(j){return j.relationship!==void 0})[0].ID,y=os.get(m).parents[0].ID,S=os.get(y).parents[0].ID,M=os.get(S).parents[0].ID,P=Ni.Objects.Model[M],D={modelName:P.attrName?c.iUV.sanitizeNodeName(P.attrName):"",morphName:Ni.Objects.Deformer[m].attrName};o[p]=D}o[p][f.attr]=f}}}),n.set(parseInt(r),o))}return n}parseAnimStacks(e){const t=Ni.Objects.AnimationStack,n={};for(const r in t){const o=os.get(parseInt(r)).children;o.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");const a=e.get(o[0].ID);n[r]={name:t[r].attrName,layer:a}}return n}addClip(e){let t=[];const n=this;return e.layer.forEach(function(r){t=t.concat(n.generateTracks(r))}),new c.m7l(e.name,-1,t)}generateTracks(e){const t=[];let n=new c.Pa4,r=new c._fP,o=new c.Pa4;if(e.transform&&e.transform.decompose(n,r,o),n=n.toArray(),r=new c.USm().setFromQuaternion(r,e.eulerOrder).toArray(),o=o.toArray(),e.T!==void 0&&Object.keys(e.T.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.T.curves,n,"position");a!==void 0&&t.push(a)}if(e.R!==void 0&&Object.keys(e.R.curves).length>0){const a=this.generateRotationTrack(e.modelName,e.R.curves,r,e.preRotation,e.postRotation,e.eulerOrder);a!==void 0&&t.push(a)}if(e.S!==void 0&&Object.keys(e.S.curves).length>0){const a=this.generateVectorTrack(e.modelName,e.S.curves,o,"scale");a!==void 0&&t.push(a)}if(e.DeformPercent!==void 0){const a=this.generateMorphTrack(e);a!==void 0&&t.push(a)}return t}generateVectorTrack(e,t,n,r){const o=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(o,t,n);return new c.yC1(e+"."+r,o,a)}generateRotationTrack(e,t,n,r,o,a){t.x!==void 0&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(c.M8C.degToRad)),t.y!==void 0&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(c.M8C.degToRad)),t.z!==void 0&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(c.M8C.degToRad));const u=this.getTimesForAllAxes(t),p=this.getKeyframeTrackValues(u,t,n);r!==void 0&&((r=r.map(c.M8C.degToRad)).push(a),r=new c.USm().fromArray(r),r=new c._fP().setFromEuler(r)),o!==void 0&&((o=o.map(c.M8C.degToRad)).push(a),o=new c.USm().fromArray(o),o=new c._fP().setFromEuler(o).invert());const f=new c._fP,m=new c.USm,y=[];for(let S=0;S<p.length;S+=3)m.set(p[S],p[S+1],p[S+2],a),f.setFromEuler(m),r!==void 0&&f.premultiply(r),o!==void 0&&f.multiply(o),f.toArray(y,S/3*4);return new c.iLg(e+".quaternion",u,y)}generateMorphTrack(e){const t=e.DeformPercent.curves.morph,n=t.values.map(function(o){return o/100}),r=zo.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new c.dUE(e.modelName+".morphTargetInfluences["+r+"]",t.times,n)}getTimesForAllAxes(e){let t=[];if(e.x!==void 0&&(t=t.concat(e.x.times)),e.y!==void 0&&(t=t.concat(e.y.times)),e.z!==void 0&&(t=t.concat(e.z.times)),t=t.sort(function(n,r){return n-r}),t.length>1){let n=1,r=t[0];for(let o=1;o<t.length;o++){const a=t[o];a!==r&&(t[n]=a,r=a,n++)}t=t.slice(0,n)}return t}getKeyframeTrackValues(e,t,n){const r=n,o=[];let a=-1,u=-1,p=-1;return e.forEach(function(f){if(t.x&&(a=t.x.times.indexOf(f)),t.y&&(u=t.y.times.indexOf(f)),t.z&&(p=t.z.times.indexOf(f)),a!==-1){const m=t.x.values[a];o.push(m),r[0]=m}else o.push(r[0]);if(u!==-1){const m=t.y.values[u];o.push(m),r[1]=m}else o.push(r[1]);if(p!==-1){const m=t.z.values[p];o.push(m),r[2]=m}else o.push(r[2])}),o}interpolateRotations(e){for(let t=1;t<e.values.length;t++){const n=e.values[t-1],r=e.values[t]-n,o=Math.abs(r);if(o>=180){const a=o/180,u=r/a;let p=n+u;const f=e.times[t-1],m=(e.times[t]-f)/a;let y=f+m;const S=[],M=[];for(;y<e.times[t];)S.push(y),y+=m,M.push(p),p+=u;e.times=qi(e.times,t,S),e.values=qi(e.values,t,M)}}}}class Yg{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new e0,this.nodeStack=[],this.currentProp=[],this.currentPropName="";const t=this,n=e.split(/[\r\n]+/);return n.forEach(function(r,o){const a=r.match(/^[\s\t]*;/),u=r.match(/^[\s\t]*$/);if(a||u)return;const p=r.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),f=r.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),m=r.match("^\\t{"+(t.currentIndent-1)+"}}");p?t.parseNodeBegin(r,p):f?t.parseNodeProperty(r,f,n[++o]):m?t.popStack():r.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(r)}),this.allNodes}parseNodeBegin(e,t){const n=t[1].trim().replace(/^"/,"").replace(/"$/,""),r=t[2].split(",").map(function(p){return p.trim().replace(/^"/,"").replace(/"$/,"")}),o={name:n},a=this.parseNodeAttr(r),u=this.getCurrentNode();this.currentIndent===0?this.allNodes.add(n,o):n in u?(n==="PoseNode"?u.PoseNode.push(o):u[n].id!==void 0&&(u[n]={},u[n][u[n].id]=u[n]),a.id!==""&&(u[n][a.id]=o)):typeof a.id=="number"?(u[n]={},u[n][a.id]=o):n!=="Properties70"&&(u[n]=n==="PoseNode"?[o]:o),typeof a.id=="number"&&(o.id=a.id),a.name!==""&&(o.attrName=a.name),a.type!==""&&(o.attrType=a.type),this.pushStack(o)}parseNodeAttr(e){let t=e[0];e[0]!==""&&(t=parseInt(e[0]),isNaN(t)&&(t=e[0]));let n="",r="";return e.length>1&&(n=e[1].replace(/^(\w+)::/,""),r=e[2]),{id:t,name:n,type:r}}parseNodeProperty(e,t,n){let r=t[1].replace(/^"/,"").replace(/"$/,"").trim(),o=t[2].replace(/^"/,"").replace(/"$/,"").trim();r==="Content"&&o===","&&(o=n.replace(/"/g,"").replace(/,$/,"").trim());const a=this.getCurrentNode();if(a.name!=="Properties70"){if(r==="C"){const u=o.split(",").slice(1),p=parseInt(u[0]),f=parseInt(u[1]);let m=o.split(",").slice(3);m=m.map(function(y){return y.trim().replace(/^"/,"")}),r="connections",o=[p,f],function(y,S){for(let M=0,P=y.length,D=S.length;M<D;M++,P++)y[P]=S[M]}(o,m),a[r]===void 0&&(a[r]=[])}r==="Node"&&(a.id=o),r in a&&Array.isArray(a[r])?a[r].push(o):r!=="a"?a[r]=o:a.a=o,this.setCurrentProp(a,r),r==="a"&&o.slice(-1)!==","&&(a.a=Ii(o))}else this.parseNodeSpecialProperty(e,r,o)}parseNodePropertyContinued(e){const t=this.getCurrentNode();t.a+=e,e.slice(-1)!==","&&(t.a=Ii(t.a))}parseNodeSpecialProperty(e,t,n){const r=n.split('",').map(function(m){return m.trim().replace(/^\"/,"").replace(/\s/,"_")}),o=r[0],a=r[1],u=r[2],p=r[3];let f=r[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":f=parseFloat(f);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":f=Ii(f)}this.getPrevNode()[o]={type:a,type2:u,flag:p,value:f},this.setCurrentProp(this.getPrevNode(),o)}}class Tw{parse(e){const t=new Yf(e);t.skip(23);const n=t.getUint32();if(n<6400)throw new Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+n);const r=new e0;for(;!this.endOfContent(t);){const o=this.parseNode(t,n);o!==null&&r.add(o.name,o)}return r}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){const n={},r=t>=7500?e.getUint64():e.getUint32(),o=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();const a=e.getUint8(),u=e.getString(a);if(r===0)return null;const p=[];for(let S=0;S<o;S++)p.push(this.parseProperty(e));const f=p.length>0?p[0]:"",m=p.length>1?p[1]:"",y=p.length>2?p[2]:"";for(n.singleProperty=o===1&&e.getOffset()===r;r>e.getOffset();){const S=this.parseNode(e,t);S!==null&&this.parseSubNode(u,n,S)}return n.propertyList=p,typeof f=="number"&&(n.id=f),m!==""&&(n.attrName=m),y!==""&&(n.attrType=y),u!==""&&(n.name=u),n}parseSubNode(e,t,n){if(n.singleProperty===!0){const r=n.propertyList[0];Array.isArray(r)?(t[n.name]=n,n.a=r):t[n.name]=r}else if(e==="Connections"&&n.name==="C"){const r=[];n.propertyList.forEach(function(o,a){a!==0&&r.push(o)}),t.connections===void 0&&(t.connections=[]),t.connections.push(r)}else if(n.name==="Properties70")Object.keys(n).forEach(function(r){t[r]=n[r]});else if(e==="Properties70"&&n.name==="P"){let r=n.propertyList[0],o=n.propertyList[1];const a=n.propertyList[2],u=n.propertyList[3];let p;r.indexOf("Lcl ")===0&&(r=r.replace("Lcl ","Lcl_")),o.indexOf("Lcl ")===0&&(o=o.replace("Lcl ","Lcl_")),p=o==="Color"||o==="ColorRGB"||o==="Vector"||o==="Vector3D"||o.indexOf("Lcl_")===0?[n.propertyList[4],n.propertyList[5],n.propertyList[6]]:n.propertyList[4],t[r]={type:o,type2:a,flag:u,value:p}}else t[n.name]===void 0?typeof n.id=="number"?(t[n.name]={},t[n.name][n.id]=n):t[n.name]=n:n.name==="PoseNode"?(Array.isArray(t[n.name])||(t[n.name]=[t[n.name]]),t[n.name].push(n)):t[n.name][n.id]===void 0&&(t[n.name][n.id]=n)}parseProperty(e){const t=e.getString(1);let n;switch(t){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return n=e.getUint32(),e.getArrayBuffer(n);case"S":return n=e.getUint32(),e.getString(n);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":const r=e.getUint32(),o=e.getUint32(),a=e.getUint32();if(o===0)switch(t){case"b":case"c":return e.getBooleanArray(r);case"d":return e.getFloat64Array(r);case"f":return e.getFloat32Array(r);case"i":return e.getInt32Array(r);case"l":return e.getInt64Array(r)}A===void 0&&console.error("THREE.FBXLoader: External library fflate.min.js required.");const u=nn(new Uint8Array(e.getArrayBuffer(a))),p=new Yf(u.buffer);switch(t){case"b":case"c":return p.getBooleanArray(r);case"d":return p.getFloat64Array(r);case"f":return p.getFloat32Array(r);case"i":return p.getInt32Array(r);case"l":return p.getInt64Array(r)}break;default:throw new Error("THREE.FBXLoader: Unknown property type "+t)}}}class Yf{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=t===void 0||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){const t=[];for(let n=0;n<e;n++)t.push(this.getBoolean());return t}getUint8(){const e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){const e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){const e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt32());return t}getUint32(){const e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),2147483648&t?(t=4294967295&~t,e=4294967295&~e,e===4294967295&&(t=t+1&4294967295),e=e+1&4294967295,-(4294967296*t+e)):4294967296*t+e}getInt64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),4294967296*t+e}getFloat32(){const e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat32());return t}getFloat64(){const e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){const t=[];for(let n=0;n<e;n++)t.push(this.getFloat64());return t}getArrayBuffer(e){const t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();const n=t.indexOf(0);return n>=0&&(t=t.slice(0,n)),c.Zp0.decodeText(new Uint8Array(t))}}class e0{add(e,t){this[e]=t}}function Ve(s){const e=s.match(/FBXVersion: (\d+)/);if(e)return parseInt(e[1]);throw new Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function Bt(s){return s/46186158e3}const Ht=[];function Vt(s,e,t,n){let r;switch(n.mappingType){case"ByPolygonVertex":r=s;break;case"ByPolygon":r=e;break;case"ByVertice":r=t;break;case"AllSame":r=n.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+n.mappingType)}n.referenceType==="IndexToDirect"&&(r=n.indices[r]);const o=r*n.dataSize,a=o+n.dataSize;return function(u,p,f,m){for(let y=f,S=0;y<m;y++,S++)u[S]=p[y];return u}(Ht,n.buffer,o,a)}const rn=new c.USm,Pn=new c.Pa4;function Wi(s){const e=new c.yGw,t=new c.yGw,n=new c.yGw,r=new c.yGw,o=new c.yGw,a=new c.yGw,u=new c.yGw,p=new c.yGw,f=new c.yGw,m=new c.yGw,y=new c.yGw,S=new c.yGw,M=s.inheritType?s.inheritType:0;if(s.translation&&e.setPosition(Pn.fromArray(s.translation)),s.preRotation){const De=s.preRotation.map(c.M8C.degToRad);De.push(s.eulerOrder||c.USm.DefaultOrder),t.makeRotationFromEuler(rn.fromArray(De))}if(s.rotation){const De=s.rotation.map(c.M8C.degToRad);De.push(s.eulerOrder||c.USm.DefaultOrder),n.makeRotationFromEuler(rn.fromArray(De))}if(s.postRotation){const De=s.postRotation.map(c.M8C.degToRad);De.push(s.eulerOrder||c.USm.DefaultOrder),r.makeRotationFromEuler(rn.fromArray(De)),r.invert()}s.scale&&o.scale(Pn.fromArray(s.scale)),s.scalingOffset&&u.setPosition(Pn.fromArray(s.scalingOffset)),s.scalingPivot&&a.setPosition(Pn.fromArray(s.scalingPivot)),s.rotationOffset&&p.setPosition(Pn.fromArray(s.rotationOffset)),s.rotationPivot&&f.setPosition(Pn.fromArray(s.rotationPivot)),s.parentMatrixWorld&&(y.copy(s.parentMatrix),m.copy(s.parentMatrixWorld));const P=t.clone().multiply(n).multiply(r),D=new c.yGw;D.extractRotation(m);const j=new c.yGw;j.copyPosition(m);const k=j.clone().invert().multiply(m),L=D.clone().invert().multiply(k),R=o,W=new c.yGw;if(M===0)W.copy(D).multiply(P).multiply(L).multiply(R);else if(M===1)W.copy(D).multiply(L).multiply(P).multiply(R);else{const De=new c.yGw().scale(new c.Pa4().setFromMatrixScale(y)).clone().invert(),Fe=L.clone().multiply(De);W.copy(D).multiply(P).multiply(Fe).multiply(R)}const q=f.clone().invert(),J=a.clone().invert();let ee=e.clone().multiply(p).multiply(f).multiply(t).multiply(n).multiply(r).multiply(q).multiply(u).multiply(a).multiply(o).multiply(J);const he=new c.yGw().copyPosition(ee),xe=m.clone().multiply(he);return S.copyPosition(xe),ee=S.clone().multiply(W),ee.premultiply(m.invert()),ee}function Kn(s){const e=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return(s=s||0)===6?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),e[0]):e[s]}function Ii(s){return s.split(",").map(function(e){return parseFloat(e)})}function Hr(s,e,t){return e===void 0&&(e=0),t===void 0&&(t=s.byteLength),c.Zp0.decodeText(new Uint8Array(s,e,t))}function qi(s,e,t){return s.slice(0,e).concat(t).concat(s.slice(e))}class wi extends w{constructor(){super(...arguments),this.dependencies=[dn],this._importer=new Nr(yy,["fbx"],!0)}async onAdded(e){bi.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){bi.Importers.splice(bi.Importers.indexOf(this._importer),1)}}wi.PluginType="FBXLoadPlugin";const bs=new WeakMap;class Xf extends c.aNw{constructor(e){super(e),this.libraryPath="",this.libraryPending=null,this.libraryBinary=null,this.libraryConfig={},this.url="",this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.workerConfig={},this.materials=[],this.warnings=[]}setLibraryPath(e){return this.libraryPath=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,n,r){const o=new c.hH6(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),this.url=e,o.load(e,a=>{if(bs.has(a))return bs.get(a).promise.then(t).catch(r);this.decodeObjects(a,e).then(u=>{u.userData.warnings=this.warnings,t(u)}).catch(u=>r(u))},n,r)}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}decodeObjects(e,t){let n,r;const o=e.byteLength,a=this._getWorker(o).then(u=>(n=u,r=this.workerNextTaskID++,new Promise((p,f)=>{n._callbacks[r]={resolve:p,reject:f},n.postMessage({type:"decode",id:r,buffer:e},[e])}))).then(u=>this._createGeometry(u.data)).catch(u=>{throw u});return a.catch(()=>!0).then(()=>{n&&r&&this._releaseTask(n,r)}),bs.set(e,{url:t,promise:a}),a}parse(e,t,n){this.decodeObjects(e,"").then(r=>{r.userData.warnings=this.warnings,t(r)}).catch(r=>n(r))}_compareMaterials(e){const t={};t.name=e.name,t.color={},t.color.r=e.color.r,t.color.g=e.color.g,t.color.b=e.color.b,t.type=e.type;for(let n=0;n<this.materials.length;n++){const r=this.materials[n],o={};if(o.name=r.name,o.color={},o.color.r=r.color.r,o.color.g=r.color.g,o.color.b=r.color.b,o.type=r.type,JSON.stringify(t)===JSON.stringify(o))return r}return this.materials.push(e),e}_createMaterial(e){if(e===void 0)return new c.Wid({color:new c.Ilk(1,1,1),metalness:.8,name:"default",side:2});const t=e.diffuseColor,n=new c.Ilk(t.r/255,t.g/255,t.b/255);t.r===0&&t.g===0&&t.b===0&&(n.r=1,n.g=1,n.b=1);const r=new c.Wid({color:n,name:e.name,side:2,transparent:e.transparency>0,opacity:1-e.transparency}),o=new c.dpR;for(let a=0;a<e.textures.length;a++){const u=e.textures[a];if(u.image!==null){const p=o.load(u.image);switch(u.type){case"Diffuse":r.map=p;break;case"Bump":r.bumpMap=p;break;case"Transparency":r.alphaMap=p,r.transparent=!0;break;case"Emap":r.envMap=p}p.wrapS=u.wrapU===0?c.rpg:c.uWy,p.wrapT=u.wrapV===0?c.rpg:c.uWy,p.repeat.set(u.repeat[0],u.repeat[1])}}return r}_createGeometry(e){const t=new c.Tme,n=[],r=[],o=[];t.userData.layers=e.layers,t.userData.groups=e.groups,t.userData.settings=e.settings,t.userData.objectType="File3dm",t.userData.materials=null,t.name=this.url;let a=e.objects;const u=e.materials;for(let p=0;p<a.length;p++){const f=a[p],m=f.attributes;switch(f.objectType){case"InstanceDefinition":r.push(f);break;case"InstanceReference":o.push(f);break;default:let y;if(m.materialIndex>=0){const M=u[m.materialIndex];let P=this._createMaterial(M);P=this._compareMaterials(P),y=this._createObject(f,P)}else{const M=this._createMaterial();y=this._createObject(f,M)}if(y===void 0)continue;const S=e.layers[m.layerIndex];y.visible=!S||e.layers[m.layerIndex].visible,m.isInstanceDefinitionObject?n.push(y):t.add(y)}}for(let p=0;p<r.length;p++){const f=r[p];a=[];for(let m=0;m<f.attributes.objectIds.length;m++){const y=f.attributes.objectIds[m];for(let S=0;S<n.length;S++)y===n[S].userData.attributes.id&&a.push(n[S])}for(let m=0;m<o.length;m++){const y=o[m];if(y.geometry.parentIdefId===f.attributes.id){const S=new c.Tme,M=y.geometry.xform.array,P=new c.yGw;P.set(M[0],M[1],M[2],M[3],M[4],M[5],M[6],M[7],M[8],M[9],M[10],M[11],M[12],M[13],M[14],M[15]),S.applyMatrix4(P);for(let D=0;D<a.length;D++)S.add(a[D].clone(!0));t.add(S)}}}return t.userData.materials=this.materials,t}_createObject(e,t){const n=new c.s4_,r=e.attributes;let o,a,u,p;switch(e.objectType){case"Point":case"PointSet":o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")?a=new c.UY4({vertexColors:!0,sizeAttenuation:!1,size:2}):(u=r.drawColor,p=new c.Ilk(u.r/255,u.g/255,u.b/255),a=new c.UY4({color:p,sizeAttenuation:!1,size:2})),a=this._compareMaterials(a);const f=new c.woe(o,a);return f.userData.attributes=r,f.userData.objectType=e.objectType,r.name&&(f.name=r.name),f;case"Mesh":case"Extrusion":case"SubD":case"Brep":if(e.geometry===null)return;o=n.parse(e.geometry),o.attributes.hasOwnProperty("color")&&(t.vertexColors=!0),t===null&&(t=this._createMaterial(),t=this._compareMaterials(t));const m=new c.Kj0(o,t);return m.castShadow=r.castsShadows,m.receiveShadow=r.receivesShadows,m.userData.attributes=r,m.userData.objectType=e.objectType,r.name&&(m.name=r.name),m;case"Curve":o=n.parse(e.geometry),u=r.drawColor,p=new c.Ilk(u.r/255,u.g/255,u.b/255),a=new c.nls({color:p}),a=this._compareMaterials(a);const y=new c.x12(o,a);return y.userData.attributes=r,y.userData.objectType=e.objectType,r.name&&(y.name=r.name),y;case"TextDot":o=e.geometry;const S=document.createElement("canvas").getContext("2d"),M=`${o.fontHeight}px ${o.fontFace}`;S.font=M;const P=S.measureText(o.text).width+10,D=o.fontHeight+10,j=window.devicePixelRatio;S.canvas.width=P*j,S.canvas.height=D*j,S.canvas.style.width=P+"px",S.canvas.style.height=D+"px",S.setTransform(j,0,0,j,0,0),S.font=M,S.textBaseline="middle",S.textAlign="center",p=r.drawColor,S.fillStyle=`rgba(${p.r},${p.g},${p.b},${p.a})`,S.fillRect(0,0,P,D),S.fillStyle="white",S.fillText(o.text,P/2,D/2);const k=new c.ROQ(S.canvas);k.minFilter=c.wem,k.wrapS=c.uWy,k.wrapT=c.uWy,a=new c.xeV({map:k,depthTest:!1});const L=new c.jyi(a);return L.position.set(o.point[0],o.point[1],o.point[2]),L.scale.set(P/10,D/10,1),L.userData.attributes=r,L.userData.objectType=e.objectType,r.name&&(L.name=r.name),L;case"Light":let R;switch(o=e.geometry,o.lightStyle.name){case"LightStyle_WorldPoint":R=new c.cek,R.castShadow=r.castsShadows,R.position.set(o.location[0],o.location[1],o.location[2]),R.shadow.normalBias=.1;break;case"LightStyle_WorldSpot":R=new c.PMe,R.castShadow=r.castsShadows,R.position.set(o.location[0],o.location[1],o.location[2]),R.target.position.set(o.direction[0],o.direction[1],o.direction[2]),R.angle=o.spotAngleRadians,R.shadow.normalBias=.1;break;case"LightStyle_WorldRectangular":R=new c.T_f;const W=Math.abs(o.width[2]),q=Math.abs(o.length[0]);R.position.set(o.location[0]-q/2,o.location[1],o.location[2]-W/2),R.height=q,R.width=W,R.lookAt(new c.Pa4(o.direction[0],o.direction[1],o.direction[2]));break;case"LightStyle_WorldDirectional":R=new c.Ox3,R.castShadow=r.castsShadows,R.position.set(o.location[0],o.location[1],o.location[2]),R.target.position.set(o.direction[0],o.direction[1],o.direction[2]),R.shadow.normalBias=.1}return R&&(R.intensity=o.intensity,u=o.diffuse,p=new c.Ilk(u.r/255,u.g/255,u.b/255),R.color=p,R.userData.attributes=r,R.userData.objectType=e.objectType),R}}_initLibrary(){if(!this.libraryPending){const e=new c.hH6(this.manager);e.setPath(this.libraryPath);const t=new Promise((o,a)=>{e.load("rhino3dm.js",o,void 0,a)}),n=new c.hH6(this.manager);n.setPath(this.libraryPath),n.setResponseType("arraybuffer");const r=new Promise((o,a)=>{n.load("rhino3dm.wasm",o,void 0,a)});this.libraryPending=Promise.all([t,r]).then(([o,a])=>{this.libraryConfig.wasmBinary=a;const u=nl.toString(),p=["/* rhino3dm.js */",o,"/* worker */",u.substring(u.indexOf("{")+1,u.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([p]))})}return this.libraryPending}_getWorker(e){return this._initLibrary().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",libraryConfig:this.libraryConfig}),n.onmessage=r=>{const o=r.data;switch(o.type){case"warning":this.warnings.push(o.data),console.warn(o.data);break;case"decode":n._callbacks[o.id].resolve(o);break;case"error":n._callbacks[o.id].reject(o);break;default:console.error('THREE.Rhino3dmLoader: Unexpected message, "'+o.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,r){return n._taskLoad>r._taskLoad?-1:1});const t=this.workerPool[this.workerPool.length-1];return t._taskLoad+=e,t})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function nl(){let s,e,t,n;function r(u,p){const f=u.geometry(),m=u.attributes();let y,S,M,P,D,j=f.objectType;switch(j){case t.ObjectType.Curve:const k=a(f,100);M={},S={},P={},M.itemSize=3,M.type="Float32Array",M.array=[];for(let J=0;J<k.length;J++)M.array.push(k[J][0]),M.array.push(k[J][1]),M.array.push(k[J][2]);S.position=M,P.attributes=S,y={data:P};break;case t.ObjectType.Point:const L=f.location;M={};const R={};S={},P={},M.itemSize=3,M.type="Float32Array",M.array=[L[0],L[1],L[2]];const W=m.drawColor(p);R.itemSize=3,R.type="Float32Array",R.array=[W.r/255,W.g/255,W.b/255],S.position=M,S.color=R,P.attributes=S,y={data:P};break;case t.ObjectType.PointSet:case t.ObjectType.Mesh:y=f.toThreejsJSON();break;case t.ObjectType.Brep:const q=f.faces();D=new t.Mesh;for(let J=0;J<q.count;J++){const ee=q.get(J),he=ee.getMesh(t.MeshType.Any);he&&(D.append(he),he.delete()),ee.delete()}D.faces().count>0&&(D.compact(),y=D.toThreejsJSON(),q.delete()),D.delete();break;case t.ObjectType.Extrusion:D=f.getMesh(t.MeshType.Any),D&&(y=D.toThreejsJSON(),D.delete());break;case t.ObjectType.TextDot:y=o(f);break;case t.ObjectType.Light:y=o(f),y.lightStyle.name==="LightStyle_WorldLinear"&&self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: No conversion exists for ${j.constructor.name} ${y.lightStyle.name}`,type:"no conversion",guid:m.id}});break;case t.ObjectType.InstanceReference:y=o(f),y.xform=o(f.xform),y.xform.array=f.xform.toFloatArray(!0);break;case t.ObjectType.SubD:f.subdivide(3),D=t.Mesh.createFromSubDControlNet(f),D&&(y=D.toThreejsJSON(),D.delete());break;default:self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: Conversion not implemented for ${j.constructor.name}`,type:"not implemented",guid:m.id}})}if(y)return S=o(m),S.geometry=o(f),m.groupCount>0&&(S.groupIds=m.getGroupList()),m.userStringCount>0&&(S.userStrings=m.getUserStrings()),f.userStringCount>0&&(S.geometry.userStrings=f.getUserStrings()),S.drawColor=m.drawColor(p),j=j.constructor.name,j=j.substring(11,j.length),{geometry:y,attributes:S,objectType:j};self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: ${j.constructor.name} has no associated mesh geometry.`,type:"missing mesh",guid:m.id}})}function o(u){const p={};for(const f in u){const m=u[f];typeof m!="function"&&(typeof m=="object"&&m!==null&&m.hasOwnProperty("constructor")?p[f]={name:m.constructor.name,value:m.value}:p[f]=m)}return p}function a(u,p){let f=p,m=[];const y=[];if(u instanceof t.LineCurve)return[u.pointAtStart,u.pointAtEnd];if(u instanceof t.PolylineCurve){f=u.pointCount;for(let P=0;P<f;P++)m.push(u.point(P));return m}if(u instanceof t.PolyCurve){const P=u.segmentCount;for(let D=0;D<P;D++){const j=u.segmentCurve(D),k=a(j,f);m=m.concat(k),j.delete()}return m}if(u instanceof t.ArcCurve&&(f=Math.floor(u.angleDegrees/5),f=f<2?2:f),u instanceof t.NurbsCurve&&u.degree===1){const P=u.tryGetPolyline();for(let D=0;D<P.count;D++)m.push(P.get(D));return P.delete(),m}const S=u.domain,M=f-1;for(let P=0;P<f;P++){const D=S[0]+P/M*(S[1]-S[0]);if(D===S[0]||D===S[1]){y.push(D);continue}const j=u.tangentAt(D),k=u.tangentAt(y.slice(-1)[0]),L=j[0]*j[0]+j[1]*j[1]+j[2]*j[2],R=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],W=Math.sqrt(L*R);let q;if(W===0)q=Math.PI/2;else{const J=(j.x*k.x+j.y*k.y+j.z*k.z)/W;q=Math.acos(Math.max(-1,Math.min(1,J)))}q<.1||y.push(D)}return m=y.map(P=>u.pointAt(P)),m}onmessage=function(u){const p=u.data;switch(p.type){case"init":e=p.libraryConfig;const f=e.wasmBinary;let m;s=new Promise(function(S){m={wasmBinary:f,onRuntimeInitialized:S},rhino3dm(m)}).then(()=>{t=m});break;case"decode":n=p.id;const y=p.buffer;s.then(()=>{try{const S=function(M,P){const D=new Uint8Array(P),j=M.File3dm.fromByteArray(D),k=[],L=[],R=[],W=[],q=[],J=[],ee=[],he=j.objects(),xe=he.count;for(let Oe=0;Oe<xe;Oe++){const ze=he.get(Oe),$e=r(ze,j);ze.delete(),$e&&k.push($e)}for(let Oe=0;Oe<j.instanceDefinitions().count();Oe++){const ze=j.instanceDefinitions().get(Oe),$e=o(ze);$e.objectIds=ze.getObjectIds(),k.push({geometry:null,attributes:$e,objectType:"InstanceDefinition"})}const De=[M.TextureType.Diffuse,M.TextureType.Bump,M.TextureType.Transparency,M.TextureType.Opacity,M.TextureType.Emap],Fe=[M.TextureType.PBR_BaseColor,M.TextureType.PBR_Subsurface,M.TextureType.PBR_SubsurfaceScattering,M.TextureType.PBR_SubsurfaceScatteringRadius,M.TextureType.PBR_Metallic,M.TextureType.PBR_Specular,M.TextureType.PBR_SpecularTint,M.TextureType.PBR_Roughness,M.TextureType.PBR_Anisotropic,M.TextureType.PBR_Anisotropic_Rotation,M.TextureType.PBR_Sheen,M.TextureType.PBR_SheenTint,M.TextureType.PBR_Clearcoat,M.TextureType.PBR_ClearcoatBump,M.TextureType.PBR_ClearcoatRoughness,M.TextureType.PBR_OpacityIor,M.TextureType.PBR_OpacityRoughness,M.TextureType.PBR_Emission,M.TextureType.PBR_AmbientOcclusion,M.TextureType.PBR_Displacement];for(let Oe=0;Oe<j.materials().count();Oe++){const ze=j.materials().get(Oe),$e=ze.physicallyBased();let Ge=o(ze);const ot=[];for(let yt=0;yt<De.length;yt++){const Mt=ze.getTexture(De[yt]);if(Mt){let pt=De[yt].constructor.name;pt=pt.substring(12,pt.length);const Qt={type:pt},Kt=j.getEmbeddedFileAsBase64(Mt.fileName);Qt.wrapU=Mt.wrapU,Qt.wrapV=Mt.wrapV,Qt.wrapW=Mt.wrapW;const Jt=Mt.uvwTransform.toFloatArray(!0);Qt.repeat=[Jt[0],Jt[5]],Kt?Qt.image="data:image/png;base64,"+Kt:(self.postMessage({type:"warning",id:n,data:{message:`THREE.3DMLoader: Image for ${pt} texture not embedded in file.`,type:"missing resource"}}),Qt.image=null),ot.push(Qt),Mt.delete()}}if(Ge.textures=ot,$e.supported){for(let Mt=0;Mt<Fe.length;Mt++){const pt=ze.getTexture(Fe[Mt]);if(pt){const Qt=j.getEmbeddedFileAsBase64(pt.fileName);let Kt=Fe[Mt].constructor.name;Kt=Kt.substring(12,Kt.length);const Jt={type:Kt,image:"data:image/png;base64,"+Qt};ot.push(Jt),pt.delete()}}const yt=o(ze.physicallyBased());Ge=Object.assign(yt,Ge)}L.push(Ge),ze.delete(),$e.delete()}for(let Oe=0;Oe<j.layers().count();Oe++){const ze=j.layers().get(Oe),$e=o(ze);R.push($e),ze.delete()}for(let Oe=0;Oe<j.views().count();Oe++){const ze=j.views().get(Oe),$e=o(ze);W.push($e),ze.delete()}for(let Oe=0;Oe<j.namedViews().count();Oe++){const ze=j.namedViews().get(Oe),$e=o(ze);q.push($e),ze.delete()}for(let Oe=0;Oe<j.groups().count();Oe++){const ze=j.groups().get(Oe),$e=o(ze);J.push($e),ze.delete()}const ke=o(j.settings()),Qe=j.strings().count();for(let Oe=0;Oe<Qe;Oe++)ee.push(j.strings().get(Oe));return j.delete(),{objects:k,materials:L,layers:R,views:W,namedViews:q,groups:J,strings:ee,settings:ke}}(t,y);self.postMessage({type:"decode",id:p.id,data:S})}catch(S){self.postMessage({type:"error",id:p.id,error:S})}})}}}class Xg extends Xf{constructor(e){super(e),this.setLibraryPath("https://cdn.jsdelivr.net/npm/rhino3dm@7.11.1/")}async loadAsync(e,t){return await super.loadAsync(e,t)}}class mc extends w{constructor(){super(...arguments),this.dependencies=[dn],this._importer=new Nr(Xg,["3dm"],!0)}async onAdded(e){bi.Importers.push(this._importer)}async onDispose(e){}async onRemove(e){bi.Importers.splice(bi.Importers.indexOf(this._importer),1)}}mc.PluginType="Rhino3dmLoadPlugin";class t0 extends w{constructor(){super(...arguments),this.dependencies=[dn]}async onAdded(e){const t=document.createElement("script");t.type="module",t.innerHTML=`
import { MeshoptDecoder } from 'https://cdn.jsdelivr.net/gh/zeux/meshoptimizer@master/js/meshopt_decoder.module.js'
window.MeshoptDecoder = MeshoptDecoder
`,document.head.appendChild(t),this._script=t}async onDispose(e){}async onRemove(e){this._script&&(document.head.removeChild(this._script),this._script=void 0)}}t0.PluginType="GLTFMeshOptPlugin";class Kg extends c.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=new c.hH6(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(u){try{t(o.parse(u))}catch(p){r?r(p):console.error(p),o.manager.itemError(e)}},n,r)}parse(e){function t(o,a,u){for(let p=0,f=o.length;p<f;p++)if(o[p]!==a.getUint8(u+p))return!1;return!0}const n=function(o){if(typeof o=="string"){const a=new Uint8Array(o.length);for(let u=0;u<o.length;u++)a[u]=255&o.charCodeAt(u);return a.buffer||a}return o}(e);return function(o){const a=new DataView(o);if(84+50*a.getUint32(80,!0)===a.byteLength)return!0;const u=[115,111,108,105,100];for(let p=0;p<5;p++)if(t(u,a,p))return!1;return!0}(n)?function(o){const a=new DataView(o),u=a.getUint32(80,!0);let p,f,m,y,S,M,P,D,j=!1;for(let W=0;W<70;W++)a.getUint32(W,!1)==1129270351&&a.getUint8(W+4)==82&&a.getUint8(W+5)==61&&(j=!0,y=new Float32Array(3*u*3),S=a.getUint8(W+6)/255,M=a.getUint8(W+7)/255,P=a.getUint8(W+8)/255,D=a.getUint8(W+9)/255);const k=new c.u9r,L=new Float32Array(3*u*3),R=new Float32Array(3*u*3);for(let W=0;W<u;W++){const q=84+50*W,J=a.getFloat32(q,!0),ee=a.getFloat32(q+4,!0),he=a.getFloat32(q+8,!0);if(j){const xe=a.getUint16(q+48,!0);32768&xe?(p=S,f=M,m=P):(p=(31&xe)/31,f=(xe>>5&31)/31,m=(xe>>10&31)/31)}for(let xe=1;xe<=3;xe++){const De=q+12*xe,Fe=3*W*3+3*(xe-1);L[Fe]=a.getFloat32(De,!0),L[Fe+1]=a.getFloat32(De+4,!0),L[Fe+2]=a.getFloat32(De+8,!0),R[Fe]=J,R[Fe+1]=ee,R[Fe+2]=he,j&&(y[Fe]=p,y[Fe+1]=f,y[Fe+2]=m)}}return k.setAttribute("position",new c.TlE(L,3)),k.setAttribute("normal",new c.TlE(R,3)),j&&(k.setAttribute("color",new c.TlE(y,3)),k.hasColors=!0,k.alpha=D),k}(n):function(o){const a=new c.u9r,u=/solid([\s\S]*?)endsolid/g,p=/facet([\s\S]*?)endfacet/g;let f=0;const m=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,y=new RegExp("vertex"+m+m+m,"g"),S=new RegExp("normal"+m+m+m,"g"),M=[],P=[],D=new c.Pa4;let j,k=0,L=0,R=0;for(;(j=u.exec(o))!==null;){L=R;const W=j[0];for(;(j=p.exec(W))!==null;){let ee=0,he=0;const xe=j[0];for(;(j=S.exec(xe))!==null;)D.x=parseFloat(j[1]),D.y=parseFloat(j[2]),D.z=parseFloat(j[3]),he++;for(;(j=y.exec(xe))!==null;)M.push(parseFloat(j[1]),parseFloat(j[2]),parseFloat(j[3])),P.push(D.x,D.y,D.z),ee++,R++;he!==1&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+f),ee!==3&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+f),f++}const q=L,J=R-L;a.addGroup(q,J,k),k++}return a.setAttribute("position",new c.a$l(M,3)),a.setAttribute("normal",new c.a$l(P,3)),a}(typeof(r=e)!="string"?c.Zp0.decodeText(new Uint8Array(r)):r);var r}}class n0 extends w{constructor(){super(...arguments),this.dependencies=[dn]}async onAdded(e){this._importer||(this._importer=new Nr(Kg,["stl"],!0)),bi.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&bi.Importers.splice(bi.Importers.indexOf(this._importer),1),this._importer=void 0}}n0.PluginType="STLLoadPlugin";class Kf extends c.aNw{constructor(e){super(e)}load(e,t,n,r){const o=this,a=this.path===""?c.Zp0.extractUrlBase(e):this.path,u=new c.hH6(this.manager);u.setPath(this.path),u.setRequestHeader(this.requestHeader),u.setWithCredentials(this.withCredentials),u.load(e,function(p){try{t(o.parse(p,a))}catch(f){r?r(f):console.error(f),o.manager.itemError(e)}},n,r)}setMaterialOptions(e){return this.materialOptions=e,this}parse(e,t){const n=e.split(`
`);let r={};const o=/\s+/,a={};for(let p=0;p<n.length;p++){let f=n[p];if(f=f.trim(),f.length===0||f.charAt(0)==="#")continue;const m=f.indexOf(" ");let y=m>=0?f.substring(0,m):f;y=y.toLowerCase();let S=m>=0?f.substring(m+1):"";if(S=S.trim(),y==="newmtl")r={name:S},a[S]=r;else if(y==="ka"||y==="kd"||y==="ks"||y==="ke"){const M=S.split(o,3);r[y]=[parseFloat(M[0]),parseFloat(M[1]),parseFloat(M[2])]}else r[y]=S}const u=new uo(this.resourcePath||t,this.materialOptions);return u.setCrossOrigin(this.crossOrigin),u.setManager(this.manager),u.setMaterials(a),u}}class uo{constructor(e="",t={}){this.baseUrl=e,this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.crossOrigin="anonymous",this.side=this.options.side!==void 0?this.options.side:c.Wl3,this.wrap=this.options.wrap!==void 0?this.options.wrap:c.rpg}setCrossOrigin(e){return this.crossOrigin=e,this}setManager(e){this.manager=e}setMaterials(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}}convert(e){if(!this.options)return e;const t={};for(const n in e){const r=e[n],o={};t[n]=o;for(const a in r){let u=!0,p=r[a];const f=a.toLowerCase();switch(f){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(p=[p[0]/255,p[1]/255,p[2]/255]),this.options&&this.options.ignoreZeroRGBs&&p[0]===0&&p[1]===0&&p[2]===0&&(u=!1)}u&&(o[f]=p)}}return t}async preload(){for(const e in this.materialsInfo)await this.create(e)}getIndex(e){return this.nameLookup[e]}async getAsArray(){let e=0;for(const t in this.materialsInfo)this.materialsArray[e]=await this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray}async create(e){return this.materials[e]===void 0&&await this.createMaterial_(e),this.materials[e]}async createMaterial_(e){const t=this,n=this.materialsInfo[e],r={name:e,side:this.side};async function o(p,f){if(r[p])return;const m=t.getTextureParams(f,r);return new Promise((y,S)=>{let M=!1,P=()=>!M&&(M=!0)&&y();const D=t.loadTexture((j=t.baseUrl,typeof(k=m.url)!="string"||k===""?"":/^https?:\/\//i.test(k)?k:j+k),void 0,L=>{r[p]=L,P()},void 0,P);var j,k;setTimeout(P,50),D.repeat.copy(m.scale),D.offset.copy(m.offset),D.wrapS=t.wrap,D.wrapT=t.wrap})}const a=Array.from(Object.keys(n||{}));let u=a.includes("d")||a.includes("D");for(const p of a){const f=n[p];let m;if(f!=="")switch(p.toLowerCase()){case"kd":r.color=new c.Ilk().fromArray(f);break;case"ks":r.specular=new c.Ilk().fromArray(f);break;case"ke":r.emissive=new c.Ilk().fromArray(f);break;case"map_kd":await o("map",f);break;case"map_ks":await o("specularMap",f);break;case"map_ke":await o("emissiveMap",f);break;case"norm":await o("normalMap",f);break;case"map_bump":case"bump":await o("bumpMap",f);break;case"map_d":await o("alphaMap",f),r.transparent=!0;break;case"ns":r.shininess=parseFloat(f);break;case"d":m=parseFloat(f),m<1&&(r.opacity=m,r.transparent=!0);break;case"tr":if(u)break;m=parseFloat(f),this.options&&this.options.invertTrProperty&&(m=1-m),m>0&&(r.opacity=1-m,r.transparent=!0)}}return this.materials[e]=new c.xoR(r),this.materials[e]}getTextureParams(e,t){const n={scale:new c.FM8(1,1),offset:new c.FM8(0,0)},r=e.split(/\s+/);let o;return o=r.indexOf("-bm"),o>=0&&(t.bumpScale=parseFloat(r[o+1]),r.splice(o,2)),o=r.indexOf("-s"),o>=0&&(n.scale.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),o=r.indexOf("-o"),o>=0&&(n.offset.set(parseFloat(r[o+1]),parseFloat(r[o+2])),r.splice(o,4)),n.url=r.join(" ").trim(),n}loadTexture(e,t,n,r,o){const a=this.manager!==void 0?this.manager:c.tEQ;let u=a.getHandler(e);u===null&&(u=new c.dpR(a)),u.setCrossOrigin&&u.setCrossOrigin(this.crossOrigin);const p=u.load(e,n,r,o);return t!==void 0&&(p.mapping=t),p}}const Jf=/^[og]\s*(.+)?/,Ol=/^mtllib /,si=/^usemtl /,eo=/^usemap /,Jg=new c.Pa4,i0=new c.Pa4,xy=new c.Pa4,$f=new c.Pa4,il=new c.Pa4;function Iw(){const s={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materials:{},materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);const n=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[],hasUVIndices:!1},materials:[],smooth:!0,startMaterial:function(r,o){const a=this._finalize(!1);a&&(a.inherited||a.groupCount<=0)&&this.materials.splice(a.index,1);const u={index:this.materials.length,name:r||"",mtllib:Array.isArray(o)&&o.length>0?o[o.length-1]:"",smooth:a!==void 0?a.smooth:this.smooth,groupStart:a!==void 0?a.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(p){const f={index:typeof p=="number"?p:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return f.clone=this.clone.bind(f),f}};return this.materials.push(u),u},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(r){const o=this.currentMaterial();if(o&&o.groupEnd===-1&&(o.groupEnd=this.geometry.vertices.length/3,o.groupCount=o.groupEnd-o.groupStart,o.inherited=!1),r&&this.materials.length>1)for(let a=this.materials.length-1;a>=0;a--)this.materials[a].groupCount<=0&&this.materials.splice(a,1);return r&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),o}},n&&n.name&&typeof n.clone=="function"){const r=n.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){const n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){const n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){const r=this.vertices,o=this.object.geometry.vertices;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addVertexPoint:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){const t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,n){const r=this.normals,o=this.object.geometry.normals;o.push(r[e+0],r[e+1],r[e+2]),o.push(r[t+0],r[t+1],r[t+2]),o.push(r[n+0],r[n+1],r[n+2])},addFaceNormal:function(e,t,n){const r=this.vertices,o=this.object.geometry.normals;Jg.fromArray(r,e),i0.fromArray(r,t),xy.fromArray(r,n),il.subVectors(xy,i0),$f.subVectors(Jg,i0),il.cross($f),il.normalize(),o.push(il.x,il.y,il.z),o.push(il.x,il.y,il.z),o.push(il.x,il.y,il.z)},addColor:function(e,t,n){const r=this.colors,o=this.object.geometry.colors;r[e]!==void 0&&o.push(r[e+0],r[e+1],r[e+2]),r[t]!==void 0&&o.push(r[t+0],r[t+1],r[t+2]),r[n]!==void 0&&o.push(r[n+0],r[n+1],r[n+2])},addUV:function(e,t,n){const r=this.uvs,o=this.object.geometry.uvs;o.push(r[e+0],r[e+1]),o.push(r[t+0],r[t+1]),o.push(r[n+0],r[n+1])},addDefaultUV:function(){const e=this.object.geometry.uvs;e.push(0,0),e.push(0,0),e.push(0,0)},addUVLine:function(e){const t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,n,r,o,a,u,p,f){const m=this.vertices.length;let y=this.parseVertexIndex(e,m),S=this.parseVertexIndex(t,m),M=this.parseVertexIndex(n,m);if(this.addVertex(y,S,M),this.addColor(y,S,M),u!==void 0&&u!==""){const P=this.normals.length;y=this.parseNormalIndex(u,P),S=this.parseNormalIndex(p,P),M=this.parseNormalIndex(f,P),this.addNormal(y,S,M)}else this.addFaceNormal(y,S,M);if(r!==void 0&&r!==""){const P=this.uvs.length;y=this.parseUVIndex(r,P),S=this.parseUVIndex(o,P),M=this.parseUVIndex(a,P),this.addUV(y,S,M),this.object.geometry.hasUVIndices=!0}else this.addDefaultUV()},addPointGeometry:function(e){this.object.geometry.type="Points";const t=this.vertices.length;for(let n=0,r=e.length;n<r;n++){const o=this.parseVertexIndex(e[n],t);this.addVertexPoint(o),this.addColor(o)}},addLineGeometry:function(e,t){this.object.geometry.type="Line";const n=this.vertices.length,r=this.uvs.length;for(let o=0,a=e.length;o<a;o++)this.addVertexLine(this.parseVertexIndex(e[o],n));for(let o=0,a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],r))}};return s.startObject("",!1),s}class Ey extends c.aNw{constructor(e){super(e),this.materials=null}load(e,t,n,r){const o=this,a=new c.hH6(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,async function(u){try{t(await o.parse(u))}catch(p){r?r(p):console.error(p),o.manager.itemError(e)}},n,r)}setMaterials(e){return this.materials=e,this}async parse(e){const t=new Iw;e.indexOf(`\r
`)!==-1&&(e=e.replace(/\r\n/g,`
`)),e.indexOf(`\\
`)!==-1&&(e=e.replace(/\\\n/g,""));const n=e.split(`
`);let r="",o="",a=0,u=[];const p=typeof"".trimLeft=="function";for(let m=0,y=n.length;m<y;m++)if(r=n[m],r=p?r.trimLeft():r.trim(),a=r.length,a!==0&&(o=r.charAt(0),o!=="#"))if(o==="v"){const S=r.split(/\s+/);switch(S[0]){case"v":t.vertices.push(parseFloat(S[1]),parseFloat(S[2]),parseFloat(S[3])),S.length>=7?t.colors.push(parseFloat(S[4]),parseFloat(S[5]),parseFloat(S[6])):t.colors.push(void 0,void 0,void 0);break;case"vn":t.normals.push(parseFloat(S[1]),parseFloat(S[2]),parseFloat(S[3]));break;case"vt":t.uvs.push(parseFloat(S[1]),parseFloat(S[2]))}}else if(o==="f"){const S=r.substr(1).trim().split(/\s+/),M=[];for(let D=0,j=S.length;D<j;D++){const k=S[D];if(k.length>0){const L=k.split("/");M.push(L)}}const P=M[0];for(let D=1,j=M.length-1;D<j;D++){const k=M[D],L=M[D+1];t.addFace(P[0],k[0],L[0],P[1],k[1],L[1],P[2],k[2],L[2])}}else if(o==="l"){const S=r.substring(1).trim().split(" ");let M=[];const P=[];if(r.indexOf("/")===-1)M=S;else for(let D=0,j=S.length;D<j;D++){const k=S[D].split("/");k[0]!==""&&M.push(k[0]),k[1]!==""&&P.push(k[1])}t.addLineGeometry(M,P)}else if(o==="p"){const S=r.substr(1).trim().split(" ");t.addPointGeometry(S)}else if((u=Jf.exec(r))!==null){const S=(" "+u[0].substr(1).trim()).substr(1);t.startObject(S)}else if(si.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(Ol.test(r)){t.materialLibraries.push(r.substring(7).trim());const S=r.substring(7).trim(),M=this.manager.getHandler(S);if(M){const P=await M.loadAsync(S).catch(D=>{console.warn(D)});P&&this.setMaterials(P)}else console.warn("OBJLoader2: Set MTLLoader to loading manager to load materials.")}else if(eo.test(r))console.warn('OBJLoader2: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(o==="s"){if(u=r.split(" "),u.length>1){const M=u[1].trim().toLowerCase();t.object.smooth=M!=="0"&&M!=="off"}else t.object.smooth=!0;const S=t.object.currentMaterial();S&&(S.smooth=t.object.smooth)}else{if(r==="\0")continue;console.warn('THREE.OBJLoader: Unexpected line: "'+r+'"')}t.finalize();const f=new c.ZAu;if(f.materialLibraries=[].concat(t.materialLibraries),!(t.objects.length===1&&t.objects[0].geometry.vertices.length===0))for(let m=0,y=t.objects.length;m<y;m++){const S=t.objects[m],M=S.geometry,P=S.materials,D=M.type==="Line",j=M.type==="Points";let k=!1;if(M.vertices.length===0)continue;const L=new c.u9r;L.setAttribute("position",new c.a$l(M.vertices,3)),M.normals.length>0&&L.setAttribute("normal",new c.a$l(M.normals,3)),M.colors.length>0&&(k=!0,L.setAttribute("color",new c.a$l(M.colors,3))),M.hasUVIndices===!0&&L.setAttribute("uv",new c.a$l(M.uvs,2));const R=[];for(let q=0,J=P.length;q<J;q++){const ee=P[q],he=ee.name+"_"+ee.smooth+"_"+k;let xe=t.materials[he];if(this.materials!==null)if(xe=await this.materials.create(ee.name),!D||!xe||xe instanceof c.nls){if(j&&xe&&!(xe instanceof c.UY4)){const De=new c.UY4({size:10,sizeAttenuation:!1});c.F5T.prototype.copy.call(De,xe),De.color.copy(xe.color),De.map=xe.map,xe=De}}else{const De=new c.nls;c.F5T.prototype.copy.call(De,xe),De.color.copy(xe.color),xe=De}xe===void 0&&(xe=D?new c.nls:j?new c.UY4({size:1,sizeAttenuation:!1}):new c.xoR,xe.name=ee.name,xe.flatShading=!ee.smooth,xe.vertexColors=k,t.materials[he]=xe),R.push(xe)}let W;if(R.length>1){for(let q=0,J=P.length;q<J;q++){const ee=P[q];L.addGroup(ee.groupStart,ee.groupCount,q)}W=D?new c.ejS(L,R):j?new c.woe(L,R):new c.Kj0(L,R)}else W=D?new c.ejS(L,R[0]):j?new c.woe(L,R[0]):new c.Kj0(L,R[0]);W.name=S.name,f.add(W)}else if(t.vertices.length>0){const m=new c.UY4({size:1,sizeAttenuation:!1}),y=new c.u9r;y.setAttribute("position",new c.a$l(t.vertices,3)),t.colors.length>0&&t.colors[0]!==void 0&&(y.setAttribute("color",new c.a$l(t.colors,3)),m.vertexColors=!0);const S=new c.woe(y,m);f.add(S)}return f}}class r0 extends w{constructor(){super(...arguments),this.dependencies=[dn],this._importer1=new Nr(Ey,["obj"],!0),this._importer2=new Nr(Kf,["mtl"],!1)}async onAdded(e){bi.Importers.push(this._importer1),bi.Importers.push(this._importer2)}async onDispose(e){}async onRemove(e){bi.Importers.splice(bi.Importers.indexOf(this._importer1),1),bi.Importers.splice(bi.Importers.indexOf(this._importer2),1)}}r0.PluginType="ObjMtlLoadPlugin";class Pw extends c.DqL{constructor(e){super(e)}parse(e,t){const n=new Dw(e,1);return{mipmaps:n.mipmaps(t),width:n.pixelWidth,height:n.pixelHeight,format:n.glInternalFormat,isCubemap:n.numberOfFaces===6,mipmapCount:n.numberOfMipmapLevels}}}class Dw{constructor(e,t){this.arrayBuffer=e;const n=new Uint8Array(this.arrayBuffer,0,12);if(n[0]!==171||n[1]!==75||n[2]!==84||n[3]!==88||n[4]!==32||n[5]!==49||n[6]!==49||n[7]!==187||n[8]!==13||n[9]!==10||n[10]!==26||n[11]!==10)return void console.error("texture missing KTX identifier");const r=Uint32Array.BYTES_PER_ELEMENT,o=new DataView(this.arrayBuffer,12,13*r),a=o.getUint32(0,!0)===67305985;this.glType=o.getUint32(1*r,a),this.glTypeSize=o.getUint32(2*r,a),this.glFormat=o.getUint32(3*r,a),this.glInternalFormat=o.getUint32(4*r,a),this.glBaseInternalFormat=o.getUint32(5*r,a),this.pixelWidth=o.getUint32(6*r,a),this.pixelHeight=o.getUint32(7*r,a),this.pixelDepth=o.getUint32(8*r,a),this.numberOfArrayElements=o.getUint32(9*r,a),this.numberOfFaces=o.getUint32(10*r,a),this.numberOfMipmapLevels=o.getUint32(11*r,a),this.bytesOfKeyValueData=o.getUint32(12*r,a),this.glType===0?(this.numberOfMipmapLevels=Math.max(1,this.numberOfMipmapLevels),this.pixelHeight!==0&&this.pixelDepth===0?this.numberOfArrayElements===0?this.numberOfFaces===t?this.loadType=0:console.warn("number of faces expected"+t+", but found "+this.numberOfFaces):console.warn("texture arrays not currently supported"):console.warn("only 2D textures currently supported")):console.warn("only compressed formats currently supported")}mipmaps(e){const t=[];let n=64+this.bytesOfKeyValueData,r=this.pixelWidth,o=this.pixelHeight;const a=e?this.numberOfMipmapLevels:1;for(let u=0;u<a;u++){const p=new Int32Array(this.arrayBuffer,n,1)[0];n+=4;for(let f=0;f<this.numberOfFaces;f++){const m=new Uint8Array(this.arrayBuffer,n,p);t.push({data:m,width:r,height:o}),n+=p,n+=3-(p+3)%4}r=Math.max(1,.5*r),o=Math.max(1,.5*o)}return t}}class $g extends w{constructor(){super(...arguments),this.dependencies=[dn]}async onAdded(e){this._importer||(this._importer=new Nr(Pw,["ktx"],!1)),bi.Importers.push(this._importer)}async onDispose(e){this._importer=void 0}async onRemove(e){this._importer&&bi.Importers.splice(bi.Importers.indexOf(this._importer),1),this._importer=void 0}}$g.PluginType="KTXLoadPlugin";class Rw extends c.hH6{constructor(e){super(e),this.responseType="blob"}}class Er extends c.hH6{constructor(e){super(e),this.responseType="blob"}load(e,t,n,r){return super.load(e,o=>{try{t==null||t(ps(o))}catch(a){r==null||r(a)}},n,r)}}class Sy{async parseAsync(e,t){var n;return new Blob([JSON.stringify(e,null,(n=t.jsonSpaces)!==null&&n!==void 0?n:2)],{type:"application/json"})}}class gc{async parseAsync(e,t){return new Blob([e],{type:"text/plain"})}}class _c{constructor(){this.pluginCallbacks=[],this.register(function(e){return new Go(e)}),this.register(function(e){return new Zf(e)}),this.register(function(e){return new Bw(e)}),this.register(function(e){return new rM(e)}),this.register(function(e){return new sM(e)}),this.register(function(e){return new Cy(e)}),this.register(function(e){return new oM(e)}),this.register(function(e){return new iM(e)}),this.register(function(e){return new aM(e)})}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,n,r,o){const a=o||new s0,u=[];for(let p=0,f=this.pluginCallbacks.length;p<f;p++)u.push(this.pluginCallbacks[p](a));a.setPlugins(u),a.write(e,t,r).catch(n)}parseAsync(e,t){const n=this;return new Promise(function(r,o){n.parse(e,r,o,t)})}}const Zg=5121,od=5123,Vo={};Vo[c.TyD]=9728,Vo[c.YLQ]=9984,Vo[c.aH4]=9986,Vo[c.wem]=9729,Vo[c.qyh]=9985,Vo[c.D1R]=9987,Vo[c.uWy]=33071,Vo[c.rpg]=10497,Vo[c.OoA]=33648;const ho={scale:"scale",position:"translation",quaternion:"rotation",morphTargetInfluences:"weights"};function Ll(s,e){return s.length===e.length&&s.every(function(t,n){return t===e[n]})}function e_(s){return 4*Math.ceil(s/4)}function rl(s,e=0){const t=e_(s.byteLength);if(t!==s.byteLength){const n=new Uint8Array(t);if(n.set(new Uint8Array(s)),e!==0)for(let r=s.byteLength;r<t;r++)n[r]=e;return n.buffer}return s}function sl(s,e){if(s.toBlob!==void 0)return new Promise(n=>s.toBlob(n,e));let t;return e==="image/jpeg"?t=.92:e==="image/webp"&&(t=.8),s.convertToBlob({type:e,quality:t})}class s0{constructor(){this.plugins=[],this.options={},this.pending=[],this.buffers=[],this.byteOffset=0,this.buffers=[],this.nodeMap=new Map,this.skins=[],this.extensionsUsed={},this.uids=new Map,this.uid=0,this.json={asset:{version:"2.0",generator:"THREE.GLTFExporter"}},this.cache={meshes:new Map,attributes:new Map,attributesNormalized:new Map,materials:new Map,textures:new Map,images:new Map}}setPlugins(e){this.plugins=e}async write(e,t,n){this.options=Object.assign({},{binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,maxTextureSize:1/0,animations:[],includeCustomExtensions:!1},n),this.options.animations.length>0&&(this.options.trs=!0),this.processInput(e),await Promise.all(this.pending);const r=this,o=r.buffers,a=r.json;n=r.options;const u=r.extensionsUsed,p=new Blob(o,{type:"application/octet-stream"}),f=Object.keys(u);if(f.length>0&&(a.extensionsUsed=f),a.buffers&&a.buffers.length>0&&(a.buffers[0].byteLength=p.size),n.binary===!0){const m=new FileReader;m.readAsArrayBuffer(p),m.onloadend=function(){const y=rl(m.result),S=new DataView(new ArrayBuffer(8));S.setUint32(0,y.byteLength,!0),S.setUint32(4,5130562,!0);const M=rl((P=JSON.stringify(a),new TextEncoder().encode(P).buffer),32);var P;const D=new DataView(new ArrayBuffer(8));D.setUint32(0,M.byteLength,!0),D.setUint32(4,1313821514,!0);const j=new ArrayBuffer(12),k=new DataView(j);k.setUint32(0,1179937895,!0),k.setUint32(4,2,!0);const L=12+D.byteLength+M.byteLength+S.byteLength+y.byteLength;k.setUint32(8,L,!0);const R=new Blob([j,D,M,S,y],{type:"application/octet-stream"}),W=new FileReader;W.readAsArrayBuffer(R),W.onloadend=function(){t(W.result)}}}else if(a.buffers&&a.buffers.length>0){const m=new FileReader;m.readAsDataURL(p),m.onloadend=function(){const y=m.result;a.buffers[0].uri=y,t(a)}}else t(a)}serializeUserData(e,t){if(Object.keys(e.userData).length===0)return;const n=this.options,r=this.extensionsUsed;try{const o=JSON.parse(JSON.stringify(e.userData));if(n.includeCustomExtensions&&o.gltfExtensions){t.extensions===void 0&&(t.extensions={});for(const a in o.gltfExtensions)t.extensions[a]=o.gltfExtensions[a],r[a]=!0;delete o.gltfExtensions}Object.keys(o).length>0&&(t.extras=o)}catch(o){console.warn("THREE.GLTFExporter: userData of '"+e.name+"' won't be serialized because of JSON.stringify error - "+o.message),console.warn({...e.userData})}}getUID(e,t=!1){if(this.uids.has(e)===!1){const n=new Map;n.set(!0,this.uid++),n.set(!1,this.uid++),this.uids.set(e,n)}return this.uids.get(e).get(t)}isNormalizedNormalAttribute(e){if(this.cache.attributesNormalized.has(e))return!1;const t=new c.Pa4;for(let n=0,r=e.count;n<r;n++)if(Math.abs(t.fromBufferAttribute(e,n).length()-1)>5e-4)return!1;return!0}createNormalizedNormalAttribute(e){const t=this.cache;if(t.attributesNormalized.has(e))return t.attributesNormalized.get(e);const n=e.clone(),r=new c.Pa4;for(let o=0,a=n.count;o<a;o++)r.fromBufferAttribute(n,o),r.x===0&&r.y===0&&r.z===0?r.setX(1):r.normalize(),n.setXYZ(o,r.x,r.y,r.z);return t.attributesNormalized.set(e,n),n}applyTextureTransform(e,t){let n=!1;const r={};t.offset.x===0&&t.offset.y===0||(r.offset=t.offset.toArray(),n=!0),t.rotation!==0&&(r.rotation=t.rotation,n=!0),t.repeat.x===1&&t.repeat.y===1||(r.scale=t.repeat.toArray(),n=!0),n&&(e.extensions=e.extensions||{},e.extensions.KHR_texture_transform=r,this.extensionsUsed.KHR_texture_transform=!0)}buildMetalRoughTexture(e,t){if(e===t)return e;function n(S){return S.encoding===c.knz?function(M){return M<.04045?.0773993808*M:Math.pow(.9478672986*M+.0521327014,2.4)}:function(M){return M}}console.warn("THREE.GLTFExporter: Merged metalnessMap and roughnessMap textures.");const r=e?e.image:void 0,o=t?t.image:void 0,a=Math.max(r?r.width:0,o?o.width:0),u=Math.max(r?r.height:0,o?o.height:0),p=document.createElement("canvas");p.width=a,p.height=u;const f=p.getContext("2d");f.fillStyle="#00ffff",f.fillRect(0,0,a,u);const m=f.getImageData(0,0,a,u);if(r){f.drawImage(r,0,0,a,u);const S=n(e),M=f.getImageData(0,0,a,u).data;for(let P=2;P<M.length;P+=4)m.data[P]=256*S(M[P]/256)}if(o){f.drawImage(o,0,0,a,u);const S=n(t),M=f.getImageData(0,0,a,u).data;for(let P=1;P<M.length;P+=4)m.data[P]=256*S(M[P]/256)}f.putImageData(m,0,0);const y=(e||t).clone();return y.source=new c.Hw6(p),y.encoding=c.rnI,y}processBuffer(e){const t=this.json,n=this.buffers;return t.buffers||(t.buffers=[{byteLength:0}]),n.push(e),0}processBufferView(e,t,n,r,o){const a=this.json;let u;a.bufferViews||(a.bufferViews=[]),u=t===Zg?1:t===od?2:4;const p=e_(r*e.itemSize*u),f=new DataView(new ArrayBuffer(p));let m=0;for(let S=n;S<n+r;S++)for(let M=0;M<e.itemSize;M++){let P;e.itemSize>4?P=e.array[S*e.itemSize+M]:M===0?P=e.getX(S):M===1?P=e.getY(S):M===2?P=e.getZ(S):M===3&&(P=e.getW(S)),t===5126?f.setFloat32(m,P,!0):t===5125?f.setUint32(m,P,!0):t===od?f.setUint16(m,P,!0):t===Zg&&f.setUint8(m,P),m+=u}const y={buffer:this.processBuffer(f.buffer),byteOffset:this.byteOffset,byteLength:p};return o!==void 0&&(y.target=o),o===34962&&(y.byteStride=e.itemSize*u),this.byteOffset+=p,a.bufferViews.push(y),{id:a.bufferViews.length-1,byteLength:0}}processBufferViewImage(e){const t=this,n=t.json;return n.bufferViews||(n.bufferViews=[]),new Promise(function(r){const o=new FileReader;o.readAsArrayBuffer(e),o.onloadend=function(){const a=rl(o.result),u={buffer:t.processBuffer(a),byteOffset:t.byteOffset,byteLength:a.byteLength};t.byteOffset+=a.byteLength,r(n.bufferViews.push(u)-1)}})}processAccessor(e,t,n,r){const o=this.options,a=this.json;let u;if(e.array.constructor===Float32Array)u=5126;else if(e.array.constructor===Uint32Array)u=5125;else if(e.array.constructor===Uint16Array)u=od;else{if(e.array.constructor!==Uint8Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");u=Zg}if(n===void 0&&(n=0),r===void 0&&(r=e.count),o.truncateDrawRange&&t!==void 0&&t.index===null){const S=n+r,M=t.drawRange.count===1/0?e.count:t.drawRange.start+t.drawRange.count;n=Math.max(n,t.drawRange.start),r=Math.min(S,M)-n,r<0&&(r=0)}if(r===0)return null;const p=function(S,M,P){const D={min:new Array(S.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(S.itemSize).fill(Number.NEGATIVE_INFINITY)};for(let j=M;j<M+P;j++)for(let k=0;k<S.itemSize;k++){let L;S.itemSize>4?L=S.array[j*S.itemSize+k]:k===0?L=S.getX(j):k===1?L=S.getY(j):k===2?L=S.getZ(j):k===3&&(L=S.getW(j)),D.min[k]=Math.min(D.min[k],L),D.max[k]=Math.max(D.max[k],L)}return D}(e,n,r);let f;t!==void 0&&(f=e===t.index?34963:34962);const m=this.processBufferView(e,u,n,r,f),y={bufferView:m.id,byteOffset:m.byteOffset,componentType:u,count:r,max:p.max,min:p.min,type:{1:"SCALAR",2:"VEC2",3:"VEC3",4:"VEC4",16:"MAT4"}[e.itemSize]};return a.accessors||(a.accessors=[]),a.accessors.push(y)-1}processImage(e,t,n,r="image/png"){const o=this,a=o.cache,u=o.json,p=o.options,f=o.pending;a.images.has(e)||a.images.set(e,{});const m=a.images.get(e),y=r+":flipY/"+n.toString();if(m[y]!==void 0)return m[y];u.images||(u.images=[]);const S={mimeType:r},M=typeof document>"u"&&typeof OffscreenCanvas<"u"?new OffscreenCanvas(1,1):document.createElement("canvas");M.width=Math.min(e.width,p.maxTextureSize),M.height=Math.min(e.height,p.maxTextureSize);const P=M.getContext("2d");if(n===!0&&(P.translate(0,M.height),P.scale(1,-1)),e.data!==void 0){t!==c.wk1&&console.error("GLTFExporter: Only RGBAFormat is supported."),(e.width>p.maxTextureSize||e.height>p.maxTextureSize)&&console.warn("GLTFExporter: Image size is bigger than maxTextureSize",e);const j=new Uint8ClampedArray(e.height*e.width*4);for(let k=0;k<j.length;k+=4)j[k+0]=e.data[k+0],j[k+1]=e.data[k+1],j[k+2]=e.data[k+2],j[k+3]=e.data[k+3];P.putImageData(new ImageData(j,e.width,e.height),0,0)}else P.drawImage(e,0,0,M.width,M.height);p.binary===!0?f.push(sl(M,r).then(j=>o.processBufferViewImage(j)).then(j=>{S.bufferView=j})):M.toDataURL!==void 0?S.uri=M.toDataURL(r):f.push(sl(M,r).then(j=>new FileReader().readAsDataURL(j)).then(j=>{S.uri=j}));const D=u.images.push(S)-1;return m[y]=D,D}processSampler(e){const t=this.json;t.samplers||(t.samplers=[]);const n={magFilter:Vo[e.magFilter],minFilter:Vo[e.minFilter],wrapS:Vo[e.wrapS],wrapT:Vo[e.wrapT]};return t.samplers.push(n)-1}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);n.textures||(n.textures=[]);let r=e.userData.mimeType;r==="image/webp"&&(r="image/png"),r==="image/jpg"&&(r="image/jpeg");const o=["image/jpeg","image/png"];r&&!o.includes(r)&&console.error("GLTFExporter: Unsupported mime type: "+r+". Cannot export texture.",e);const a={sampler:this.processSampler(e),source:!r||o.includes(r)?this.processImage(e.image,e.format,e.flipY,r):null};e.name&&(a.name=e.name),this._invokeAll(function(p){p.writeTexture&&p.writeTexture(e,a)});const u=n.textures.push(a)-1;return t.textures.set(e,u),u}processMaterial(e){const t=this.cache,n=this.json;if(t.materials.has(e))return t.materials.get(e);if(e.isShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;n.materials||(n.materials=[]);const r={pbrMetallicRoughness:{}};e.isMeshStandardMaterial!==!0&&e.isMeshBasicMaterial!==!0&&console.warn("GLTFExporter: Use MeshStandardMaterial or MeshBasicMaterial for best results.");const o=e.color.toArray().concat([e.opacity]);if(Ll(o,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=o),e.isMeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.metalnessMap||e.roughnessMap){const u=this.buildMetalRoughTexture(e.metalnessMap,e.roughnessMap),p={index:this.processTexture(u)};this.applyTextureTransform(p,u),r.pbrMetallicRoughness.metallicRoughnessTexture=p}if(e.map){const u={index:this.processTexture(e.map)};this.applyTextureTransform(u,e.map),r.pbrMetallicRoughness.baseColorTexture=u}if(e.emissive){const u=e.emissive.clone().multiplyScalar(e.emissiveIntensity),p=Math.max(u.r,u.g,u.b);if(p>1&&(u.multiplyScalar(1/p),console.warn("THREE.GLTFExporter: Some emissive components exceed 1; emissive has been limited")),p>0&&(r.emissiveFactor=u.toArray()),e.emissiveMap){const f={index:this.processTexture(e.emissiveMap)};this.applyTextureTransform(f,e.emissiveMap),r.emissiveTexture=f}}if(e.normalMap){const u={index:this.processTexture(e.normalMap)};e.normalScale&&e.normalScale.x!==1&&(u.scale=e.normalScale.x),this.applyTextureTransform(u,e.normalMap),r.normalTexture=u}if(e.aoMap){const u={index:this.processTexture(e.aoMap),texCoord:1};e.aoMapIntensity!==1&&(u.strength=e.aoMapIntensity),this.applyTextureTransform(u,e.aoMap),r.occlusionTexture=u}e.transparent?r.alphaMode="BLEND":e.alphaTest>0&&(r.alphaMode="MASK",r.alphaCutoff=e.alphaTest),e.side===c.ehD&&(r.doubleSided=!0),e.name!==""&&(r.name=e.name),this.serializeUserData(e,r),this._invokeAll(function(u){u.writeMaterial&&u.writeMaterial(e,r)});const a=n.materials.push(r)-1;return t.materials.set(e,a),a}processMesh(e){const t=this.cache,n=this.json,r=[e.geometry.uuid];if(Array.isArray(e.material))for(let R=0,W=e.material.length;R<W;R++)r.push(e.material[R].uuid);else r.push(e.material.uuid);const o=r.join(":");if(t.meshes.has(o))return t.meshes.get(o);const a=e.geometry;let u;u=e.isLineSegments?1:e.isLineLoop?2:e.isLine?3:e.isPoints?0:e.material.wireframe?1:4;const p={},f={},m=[],y=[],S={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"},M=a.getAttribute("normal");M===void 0||this.isNormalizedNormalAttribute(M)||(console.warn("THREE.GLTFExporter: Creating normalized normal attribute from the non-normalized one."),a.setAttribute("normal",this.createNormalizedNormalAttribute(M)));let P=null;for(let R in a.attributes){if(R.slice(0,5)==="morph")continue;const W=a.attributes[R];if(R=S[R]||R.toUpperCase(),/^(POSITION|NORMAL|TANGENT|TEXCOORD_\d+|COLOR_\d+|JOINTS_\d+|WEIGHTS_\d+)$/.test(R)||(R="_"+R),t.attributes.has(this.getUID(W))){f[R]=t.attributes.get(this.getUID(W));continue}P=null;const q=W.array;R!=="JOINTS_0"||q instanceof Uint16Array||q instanceof Uint8Array||(console.warn('GLTFExporter: Attribute "skinIndex" converted to type UNSIGNED_SHORT.'),P=new c.TlE(new Uint16Array(q),W.itemSize,W.normalized));const J=this.processAccessor(P||W,a);J!==null&&(f[R]=J,t.attributes.set(this.getUID(W),J))}if(M!==void 0&&a.setAttribute("normal",M),Object.keys(f).length===0)return null;if(e.morphTargetInfluences!==void 0&&e.morphTargetInfluences.length>0){const R=[],W=[],q={};if(e.morphTargetDictionary!==void 0)for(const J in e.morphTargetDictionary)q[e.morphTargetDictionary[J]]=J;for(let J=0;J<e.morphTargetInfluences.length;++J){const ee={};let he=!1;for(const xe in a.morphAttributes){if(xe!=="position"&&xe!=="normal"){he||(console.warn("GLTFExporter: Only POSITION and NORMAL morph are supported."),he=!0);continue}const De=a.morphAttributes[xe][J],Fe=xe.toUpperCase(),ke=a.attributes[xe];if(t.attributes.has(this.getUID(De,!0))){ee[Fe]=t.attributes.get(this.getUID(De,!0));continue}const Qe=De.clone();if(!a.morphTargetsRelative)for(let Oe=0,ze=De.count;Oe<ze;Oe++)Qe.setXYZ(Oe,De.getX(Oe)-ke.getX(Oe),De.getY(Oe)-ke.getY(Oe),De.getZ(Oe)-ke.getZ(Oe));ee[Fe]=this.processAccessor(Qe,a),t.attributes.set(this.getUID(ke,!0),ee[Fe])}y.push(ee),R.push(e.morphTargetInfluences[J]),e.morphTargetDictionary!==void 0&&W.push(q[J])}p.weights=R,W.length>0&&(p.extras={},p.extras.targetNames=W)}const D=Array.isArray(e.material);if(D&&a.groups.length===0)return null;const j=D?e.material:[e.material],k=D?a.groups:[{materialIndex:0,start:void 0,count:void 0}];for(let R=0,W=k.length;R<W;R++){const q={mode:u,attributes:f};if(this.serializeUserData(a,q),y.length>0&&(q.targets=y),a.index!==null){let ee=this.getUID(a.index);k[R].start===void 0&&k[R].count===void 0||(ee+=":"+k[R].start+":"+k[R].count),t.attributes.has(ee)?q.indices=t.attributes.get(ee):(q.indices=this.processAccessor(a.index,a,k[R].start,k[R].count),t.attributes.set(ee,q.indices)),q.indices===null&&delete q.indices}const J=this.processMaterial(j[k[R].materialIndex]);J!==null&&(q.material=J),m.push(q)}p.primitives=m,n.meshes||(n.meshes=[]),this._invokeAll(function(R){R.writeMesh&&R.writeMesh(e,p)});const L=n.meshes.push(p)-1;return t.meshes.set(o,L),L}processCamera(e){const t=this.json;t.cameras||(t.cameras=[]);const n=e.isOrthographicCamera,r={type:n?"orthographic":"perspective"};return n?r.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near}:r.perspective={aspectRatio:e.aspect,yfov:c.M8C.degToRad(e.fov),zfar:e.far<=0?.001:e.far,znear:e.near<0?0:e.near},e.name!==""&&(r.name=e.type),t.cameras.push(r)-1}processAnimation(e,t){const n=this.json,r=this.nodeMap;n.animations||(n.animations=[]);const o=(e=_c.Utils.mergeMorphTargetTracks(e.clone(),t)).tracks,a=[],u=[];for(let p=0;p<o.length;++p){const f=o[p],m=c.iUV.parseTrackName(f.name);let y=c.iUV.findNode(t,m.nodeName);const S=ho[m.propertyName];if(m.objectName==="bones"&&(y=y.isSkinnedMesh===!0?y.skeleton.getBoneByName(m.objectIndex):void 0),!y||!S)return console.warn('THREE.GLTFExporter: Could not export animation track "%s".',f.name),null;const M=1;let P,D=f.values.length/f.times.length;S===ho.morphTargetInfluences&&(D/=y.morphTargetInfluences.length),f.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline===!0?(P="CUBICSPLINE",D/=3):P=f.getInterpolation()===c.Syv?"STEP":"LINEAR",u.push({input:this.processAccessor(new c.TlE(f.times,M)),output:this.processAccessor(new c.TlE(f.values,D)),interpolation:P}),a.push({sampler:u.length-1,target:{node:r.get(y),path:S}})}return n.animations.push({name:e.name||"clip_"+n.animations.length,samplers:u,channels:a}),n.animations.length-1}processSkin(e){const t=this.json,n=this.nodeMap,r=t.nodes[n.get(e)],o=e.skeleton;if(o===void 0)return null;const a=e.skeleton.bones[0];if(a===void 0)return null;const u=[],p=new Float32Array(16*o.bones.length),f=new c.yGw;for(let m=0;m<o.bones.length;++m)u.push(n.get(o.bones[m])),f.copy(o.boneInverses[m]),f.multiply(e.bindMatrix).toArray(p,16*m);return t.skins===void 0&&(t.skins=[]),t.skins.push({inverseBindMatrices:this.processAccessor(new c.TlE(p,16)),joints:u,skeleton:n.get(a)}),r.skin=t.skins.length-1}processNode(e){const t=this.json,n=this.options,r=this.nodeMap;t.nodes||(t.nodes=[]);const o={};if(n.trs){const u=e.quaternion.toArray(),p=e.position.toArray(),f=e.scale.toArray();Ll(u,[0,0,0,1])||(o.rotation=u),Ll(p,[0,0,0])||(o.translation=p),Ll(f,[1,1,1])||(o.scale=f)}else e.matrixAutoUpdate&&e.updateMatrix(),Ll(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])===!1&&(o.matrix=e.matrix.elements);if(e.name!==""&&(o.name=String(e.name)),this.serializeUserData(e,o),e.isMesh||e.isLine||e.isPoints){const u=this.processMesh(e);u!==null&&(o.mesh=u)}else e.isCamera&&(o.camera=this.processCamera(e));if(e.isSkinnedMesh&&this.skins.push(e),e.children.length>0){const u=[];for(let p=0,f=e.children.length;p<f;p++){const m=e.children[p];if(m.visible||n.onlyVisible===!1){const y=this.processNode(m);y!==null&&u.push(y)}}u.length>0&&(o.children=u)}this._invokeAll(function(u){u.writeNode&&u.writeNode(e,o)});const a=t.nodes.push(o)-1;return r.set(e,a),a}processScene(e){const t=this.json,n=this.options;t.scenes||(t.scenes=[],t.scene=0);const r={};e.name!==""&&(r.name=e.name),t.scenes.push(r);const o=[];for(let a=0,u=e.children.length;a<u;a++){const p=e.children[a];if(p.visible||n.onlyVisible===!1){const f=this.processNode(p);f!==null&&o.push(f)}}o.length>0&&(r.nodes=o),this.serializeUserData(e,r)}processObjects(e){const t=new c.xsS;t.name="AuxScene";for(let n=0;n<e.length;n++)t.children.push(e[n]);this.processScene(t)}processInput(e){const t=this.options;e=e instanceof Array?e:[e],this._invokeAll(function(r){r.beforeParse&&r.beforeParse(e)});const n=[];for(let r=0;r<e.length;r++)e[r]instanceof c.xsS?this.processScene(e[r]):n.push(e[r]);n.length>0&&this.processObjects(n);for(let r=0;r<this.skins.length;++r)this.processSkin(this.skins[r]);for(let r=0;r<t.animations.length;++r)this.processAnimation(t.animations[r],e[0]);this._invokeAll(function(r){r.afterParse&&r.afterParse(e)})}_invokeAll(e){for(let t=0,n=this.plugins.length;t<n;t++)e(this.plugins[t])}}class Go{constructor(e){this.writer=e,this.name="KHR_lights_punctual"}writeNode(e,t){if(!e.isLight)return;if(!e.isDirectionalLight&&!e.isPointLight&&!e.isSpotLight)return void console.warn("THREE.GLTFExporter: Only directional, point, and spot lights are supported.",e);const n=this.writer,r=n.json,o=n.extensionsUsed,a={};e.name&&(a.name=e.name),a.color=e.color.toArray(),a.intensity=e.intensity,e.isDirectionalLight?a.type="directional":e.isPointLight?(a.type="point",e.distance>0&&(a.range=e.distance)):e.isSpotLight&&(a.type="spot",e.distance>0&&(a.range=e.distance),a.spot={},a.spot.innerConeAngle=(e.penumbra-1)*e.angle*-1,a.spot.outerConeAngle=e.angle),e.decay!==void 0&&e.decay!==2&&console.warn("THREE.GLTFExporter: Light decay may be lost. glTF is physically-based, and expects light.decay=2."),!e.target||e.target.parent===e&&e.target.position.x===0&&e.target.position.y===0&&e.target.position.z===-1||console.warn("THREE.GLTFExporter: Light direction may be lost. For best results, make light.target a child of the light with position 0,0,-1."),o[this.name]||(r.extensions=r.extensions||{},r.extensions[this.name]={lights:[]},o[this.name]=!0);const u=r.extensions[this.name].lights;u.push(a),t.extensions=t.extensions||{},t.extensions[this.name]={light:u.length-1}}}class Zf{constructor(e){this.writer=e,this.name="KHR_materials_unlit"}writeMaterial(e,t){if(!e.isMeshBasicMaterial)return;const n=this.writer.extensionsUsed;t.extensions=t.extensions||{},t.extensions[this.name]={},n[this.name]=!0,t.pbrMetallicRoughness.metallicFactor=0,t.pbrMetallicRoughness.roughnessFactor=.9}}class Bw{constructor(e){this.writer=e,this.name="KHR_materials_pbrSpecularGlossiness"}writeMaterial(e,t){if(!e.isGLTFSpecularGlossinessMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};t.pbrMetallicRoughness.baseColorFactor&&(o.diffuseFactor=t.pbrMetallicRoughness.baseColorFactor);const a=[1,1,1];if(e.specular.toArray(a,0),o.specularFactor=a,o.glossinessFactor=e.glossiness,t.pbrMetallicRoughness.baseColorTexture&&(o.diffuseTexture=t.pbrMetallicRoughness.baseColorTexture),e.specularMap){const u={index:n.processTexture(e.specularMap)};n.applyTextureTransform(u,e.specularMap),o.specularGlossinessTexture=u}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class Cy{constructor(e){this.writer=e,this.name="KHR_materials_clearcoat"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.clearcoatFactor=e.clearcoat,e.clearcoatMap){const a={index:n.processTexture(e.clearcoatMap)};n.applyTextureTransform(a,e.clearcoatMap),o.clearcoatTexture=a}if(o.clearcoatRoughnessFactor=e.clearcoatRoughness,e.clearcoatRoughnessMap){const a={index:n.processTexture(e.clearcoatRoughnessMap)};n.applyTextureTransform(a,e.clearcoatRoughnessMap),o.clearcoatRoughnessTexture=a}if(e.clearcoatNormalMap){const a={index:n.processTexture(e.clearcoatNormalMap)};n.applyTextureTransform(a,e.clearcoatNormalMap),o.clearcoatNormalTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class iM{constructor(e){this.writer=e,this.name="KHR_materials_iridescence"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.iridescenceFactor=e.iridescence,e.iridescenceMap){const a={index:n.processTexture(e.iridescenceMap)};n.applyTextureTransform(a,e.iridescenceMap),o.iridescenceTexture=a}if(o.iridescenceIor=e.iridescenceIOR,o.iridescenceThicknessMinimum=e.iridescenceThicknessRange[0],o.iridescenceThicknessMaximum=e.iridescenceThicknessRange[1],e.iridescenceThicknessMap){const a={index:n.processTexture(e.iridescenceThicknessMap)};n.applyTextureTransform(a,e.iridescenceThicknessMap),o.iridescenceThicknessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class rM{constructor(e){this.writer=e,this.name="KHR_materials_transmission"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.transmissionFactor=e.transmission,e.transmissionMap){const a={index:n.processTexture(e.transmissionMap)};n.applyTextureTransform(a,e.transmissionMap),o.transmissionTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class sM{constructor(e){this.writer=e,this.name="KHR_materials_volume"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.transmission===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.thicknessFactor=e.thickness,e.thicknessMap){const a={index:n.processTexture(e.thicknessMap)};n.applyTextureTransform(a,e.thicknessMap),o.thicknessTexture=a}o.attenuationDistance=e.attenuationDistance,o.attenuationColor=e.attenuationColor.toArray(),t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class oM{constructor(e){this.writer=e,this.name="KHR_materials_sheen"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial||e.sheen<.01)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.sheenColorFactor=e.sheenColor.toArray(),e.sheenColorMap){const a={index:n.processTexture(e.sheenColorMap)};n.applyTextureTransform(a,e.sheenColorMap),o.sheenColorTexture=a}if(o.sheenRoughnessFactor=e.sheenRoughness,e.sheenRoughnessMap){const a={index:n.processTexture(e.sheenRoughnessMap)};n.applyTextureTransform(a,e.sheenRoughnessMap),o.sheenRoughnessTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,t.extras=t.extras||{},t.extras.sheenFactor=e.sheen,r[this.name]=!0}}class aM{constructor(e){this.writer=e,this.name="KHR_materials_ior"}writeMaterial(e,t){if(!e.isMeshPhysicalMaterial)return;const n=this.writer.extensionsUsed,r={};r.ior=e.ior,t.extensions=t.extensions||{},t.extensions[this.name]=r,n[this.name]=!0}}_c.Utils={GLTFWriter:s0,insertKeyframe:function(s,e){const n=s.getValueSize(),r=new s.TimeBufferType(s.times.length+1),o=new s.ValueBufferType(s.values.length+n),a=s.createInterpolant(new s.ValueBufferType(n));let u;if(s.times.length===0){r[0]=e;for(let p=0;p<n;p++)o[p]=0;u=0}else if(e<s.times[0]){if(Math.abs(s.times[0]-e)<.001)return 0;r[0]=e,r.set(s.times,1),o.set(a.evaluate(e),0),o.set(s.values,n),u=0}else if(e>s.times[s.times.length-1]){if(Math.abs(s.times[s.times.length-1]-e)<.001)return s.times.length-1;r[r.length-1]=e,r.set(s.times,0),o.set(s.values,0),o.set(a.evaluate(e),s.values.length),u=r.length-1}else for(let p=0;p<s.times.length;p++){if(Math.abs(s.times[p]-e)<.001)return p;if(s.times[p]<e&&s.times[p+1]>e){r.set(s.times.slice(0,p+1),0),r[p+1]=e,r.set(s.times.slice(p+1),p+2),o.set(s.values.slice(0,(p+1)*n),0),o.set(a.evaluate(e),(p+1)*n),o.set(s.values.slice((p+1)*n),(p+2)*n),u=p+1;break}}return s.times=r,s.values=o,u},mergeMorphTargetTracks:function(s,e){const t=[],n={},r=s.tracks;for(let o=0;o<r.length;++o){let a=r[o];const u=c.iUV.parseTrackName(a.name),p=c.iUV.findNode(e,u.nodeName);if(u.propertyName!=="morphTargetInfluences"||u.propertyIndex===void 0){t.push(a);continue}if(a.createInterpolant!==a.InterpolantFactoryMethodDiscrete&&a.createInterpolant!==a.InterpolantFactoryMethodLinear){if(a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline)throw new Error("THREE.GLTFExporter: Cannot merge tracks with glTF CUBICSPLINE interpolation.");console.warn("THREE.GLTFExporter: Morph target interpolation mode not yet supported. Using LINEAR instead."),a=a.clone(),a.setInterpolation(c.NMF)}const f=p.morphTargetInfluences.length,m=p.morphTargetDictionary[u.propertyIndex];if(m===void 0)throw new Error("THREE.GLTFExporter: Morph target name not found: "+u.propertyIndex);let y;if(n[p.uuid]===void 0){y=a.clone();const M=new y.ValueBufferType(f*y.times.length);for(let P=0;P<y.times.length;P++)M[P*f+m]=y.values[P];y.name=(u.nodeName||"")+".morphTargetInfluences",y.values=M,n[p.uuid]=y,t.push(y);continue}const S=a.createInterpolant(new a.ValueBufferType(1));y=n[p.uuid];for(let M=0;M<y.times.length;M++)y.values[M*f+m]=S.evaluate(y.times[M]);for(let M=0;M<a.times.length;M++){const P=this.insertKeyframe(y,a.times[M]);y.values[P*f+m]=a.values[M]}}return s.tracks=t,s}};class C1 extends _c.Utils.GLTFWriter{constructor(){super(...arguments),this._defaultMaterial=new c.Wid}serializeUserData(e,t){const n=e.userData,r={};n.__disposed&&console.error("Serializing a disposed object",e),Object.entries(n).forEach(([o,a])=>{(!a||typeof a=="function"||a.isObject3D||a.isTexture||a.isMaterial||a.assetType!=null||o.startsWith("_")||o!=="uuid"&&(rr.includes(o)||Qs.includes(o)||qr.includes(o)))&&(r[o]=a,delete n[o])}),super.serializeUserData(e,t),Object.entries(r).forEach(([o,a])=>{n[o]=a,delete r[o]})}processObjects(e){var t;e.length===1&&(!((t=e[0])===null||t===void 0)&&t.userData.rootSceneModelRoot)?this.processScene(e[0]):super.processObjects(e)}processMaterial(e){if(this.cache.materials.has(e))return this.cache.materials.get(e);let t=e;t&&!t.isShaderMaterial||(t=this._defaultMaterial);const n=super.processMaterial(t);if(!e||t===e)return n;const r=JSON.stringify(this.json.materials[n]),o=JSON.parse(r);this.serializeUserData(e,o),this._invokeAll(u=>{u.writeMaterial&&u.writeMaterial(e,o)});const a=this.json.materials.push(o)-1;return this.cache.materials.set(e,a),a}processImageBlob(e,t){if(!e)return-1;const n=this.cache,r=this.options,o=this.pending,a=this.json,u=t.image;n.images.has(u)||n.images.set(u,{});const p=n.images.get(u),f=e.type+":flipY/"+t.flipY.toString();if(p[f]!==void 0)return p[f];a.images||(a.images=[]);const m={mimeType:e.type};r.binary===!0?o.push(new Promise(S=>{this.processBufferViewImage(e).then(M=>{m.bufferView=M,S()})})):o.push(ps(e).then(S=>{m.uri=S}));const y=a.images.push(m)-1;return p[f]=y,y}processSampler(e){return super.processSampler(e)}processTexture(e){const t=this.cache,n=this.json;if(t.textures.has(e))return t.textures.get(e);const r=e.source.data,o=e.userData.mimeType;e.userData.rootPath&&!this.options.embedUrlImages&&(e.source.data=null,delete e.userData.mimeType);const a=super.processTexture(e),u=n.textures[a];if(!u)return console.error("No texture def",a,e),a;const p=n.images?n.images[u.source]:null;if(p&&(p.extras||(p.extras={}),e.source&&(p.extras.uuid=e.source.uuid),p.extras.t_uuid=e.uuid),e.userData.rootPath&&!this.options.embedUrlImages){if(e.source.data=r,e.userData.mimeType=o,!u)return console.error("textureDef is null",a,e),a;u.source>=0?console.warn("textureDef.source is already set",a,e):u.source=this.processImageUri(e.image,e.userData.rootPath,e.flipY,o)}return u.source<0&&console.error("textureDef.source cannot be saved",u,e),a}processImage(e,t,n,r="image/png"){return e?super.processImage(e,t,n,r):-1}processImageUri(e,t,n,r="image/png"){const o=this.cache,a=this.json;o.images.has(e)||o.images.set(e,{});const u=o.images.get(e),p=r+":flipY/"+n.toString();if(u[p]!==void 0)return u[p];a.images||(a.images=[]);const f={mimeType:r,uri:t,extras:{flipY:n}},m=a.images.push(f)-1;return u[p]=m,m}}class kw extends _c{register(e){return super.register(e)}async parseAsync(e,t){var n;if(!e)throw new Error("No object to export");const r=e.__isGLTFOutput||!Array.isArray(e)&&!e.isObject3D?e:await new Promise((o,a)=>this.parse(e,o,a,t));if(r&&typeof r=="object"&&!r.byteLength)return new Blob([JSON.stringify(r,(o,a)=>o.startsWith("__")?void 0:a,(n=t.jsonSpaces)!==null&&n!==void 0?n:2)],{type:"model/gltf+json"});if(r)return new Blob([r],{type:"model/gltf+binary"});throw new Error("GLTFExporter2.parse() failed")}parse(e,t,n,r={}){var o;const a={binary:!1,trs:!1,onlyVisible:!0,truncateDrawRange:!0,externalImagesInExtras:!r.embedUrlImages&&r.externalImagesInExtras||!1,embedUrlImages:(o=r.embedUrlImages)!==null&&o!==void 0&&o,maxTextureSize:1/0,animations:[],includeCustomExtensions:!0};return r.exportExt==="glb"&&(a.binary=!0),r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(u=>u.traverse(p=>{p.uuid&&(p.userData.gltfUUID=p.uuid)})),(Array.isArray(e)?e:[e]).forEach(u=>u.traverse(p=>{if(p.animations)for(const f of p.animations)f.__gltfExport===!1||a.animations.includes(f)||a.animations.push(...p.animations)})),super.parse(e,u=>{r.preserveUUIDs!==!1&&(Array.isArray(e)?e:[e]).forEach(p=>p.traverse(f=>{delete f.userData.gltfUUID})),t(Object.assign(u,{__isGLTFOutput:!0}))},n,a,new C1)}}function M1(s,e){const t=s.getPlugin(dn).exportViewerConfig();e.json.textures&&e.json.samplers&&e.json.images&&t.resources.textures&&Object.entries(t.resources.textures).forEach(([r,o])=>{e.json.textures.find(u=>{var p,f,m,y,S;return((p=u.extras)===null||p===void 0?void 0:p.uuid)===r||((m=(f=e.json.samplers[u.sampler])===null||f===void 0?void 0:f.extras)===null||m===void 0?void 0:m.uuid)===r||((S=(y=e.json.images[u.source])===null||y===void 0?void 0:y.extras)===null||S===void 0?void 0:S.t_uuid)===r})&&(o.image&&t.resources.images&&t.resources.images[o.image]&&delete t.resources.images[o.image],t.resources.textures[r]={})}),e.json.materials&&t.resources.materials&&Object.entries(t.resources.materials).forEach(([r,o])=>{e.json.materials.find(u=>{var p;return((p=u.extras)===null||p===void 0?void 0:p.uuid)===r})&&(t.resources.materials[r]={})});const n=[];Object.values(t.resources).forEach(r=>{Object.values(r).forEach(o=>{o.url&&(o.url.type==="Uint16Array"&&o.url.data&&(o.url.data instanceof Uint16Array||(o.url.data=new Uint16Array(o.url.data)),n.push(o.url)),o.url.type==="Uint8Array"&&o.url.data&&(o.url.data instanceof Uint8Array||(o.url.data=new Uint8Array(o.url.data)),n.push(o.url)))})});for(const r of n){let o="application/octet-stream";if(r.type==="Uint16Array"){const f=lM(r.data,4),m=new ImageData(f,r.width,r.height),y=c.PpQ.getDataURL(m,!0).split(",")[1];o="image/png",r.data=atob(y),r.encoding="rgbe"}const a=new Blob([r.data],{type:o});e.json.images||(e.json.images=[]);const u={mimeType:o},p=e.json.images.push(u)-1;r.data={image:p},e.pending.push(e.processBufferViewImage(a).then(f=>{u.bufferView=f}))}return t}function lM(s,e=3,t){let n,r,o,a,u;const p=s.byteLength/(2*e)|0;t=t||new Uint8ClampedArray(4*p);for(let f=0;f<p;f++){n=s[f*e],r=s[f*e+1],o=s[f*e+2],a=Math.max(Math.max(n,r),o);const m=Math.ceil(Math.log2(a));u=Math.pow(2,m-8),t[4*f]=n/u|0,t[4*f+1]=r/u|0,t[4*f+2]=o/u|0,t[4*f+3]=m+128}return t}function Ow(s,e=kw,t){var n;if(!s)return;const r=lh.Exporters.findIndex(a=>a.ext.includes("gltf")||a.ext.includes("glb")),o=[];r>=0?(o.push(...(n=lh.Exporters[r].extensions)!==null&&n!==void 0?n:[]),lh.Exporters.splice(r,1)):(o.push(hM),o.push(uM),o.push(cM),o.push(a=>new dM(a)),o.push(a=>new pM(a)),o.push(a=>new fM(a)),o.push(a=>new mM(a))),lh.Exporters.push({ctor:()=>{const a=new e;return o.forEach(u=>a.register(u)),a.register(u=>({afterParse:p=>{var f,m;if(!(!((f=(p=Array.isArray(p)?p[0]:p)==null?void 0:p.userData)===null||f===void 0)&&f.rootSceneModelRoot)||((m=p==null?void 0:p.userData)===null||m===void 0?void 0:m.__exportViewerConfig)===!1)return;const y=u.json.scenes[u.json.scene||0];y.extensions||(y.extensions={}),y.extensions[Jo]=M1(s,u),u.extensionsUsed[Jo]=!0}})),t==null||t(a),a},ext:["gltf","glb"],extensions:o})}const cM=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isLight))return;t.extensions||(t.extensions={});const n={};e.shadow&&(n.shadow=e.shadow.toJSON()),Object.keys(n).length>0&&(t.extensions[Re]=n,s.extensionsUsed[Re]=!0)}}),uM=s=>({writeNode:(e,t)=>{if(!(e!=null&&e.isObject3D))return;t.extensions||(t.extensions={});const n={};e.castShadow!==void 0&&(n.castShadow=e.castShadow),e.receiveShadow!==void 0&&(n.receiveShadow=e.receiveShadow),e.visible===!1&&(n.visible=!1),e.frustumCulled===!1&&(n.frustumCulled=!1),e.renderOrder!==0&&(n.renderOrder=e.renderOrder),e.layers.mask!==1&&(n.layers=e.layers.mask),e.matrixAutoUpdate===!1&&(n.matrixAutoUpdate=!1),Object.keys(n).length>0&&(t.extensions[_l]=n,s.extensionsUsed[_l]=!0)}}),hM=s=>({writeMaterial(e,t){var n;if(!(e!=null&&e.isMaterial))return;t.extensions||(t.extensions={});const r={};if(e.emissiveIntensity!==void 0&&(!((n=e.emissive)===null||n===void 0)&&n.isColor)){const a=e.emissive.clone().multiplyScalar(e.emissiveIntensity),u=Math.max(a.r,a.g,a.b);u>1&&(r.emissiveIntensity=u)}e.fog!==void 0&&(r.fog=e.fog),e.flatShading!==void 0&&(r.flatShading=e.flatShading),e.blending!==void 0&&(r.blending=e.blending),e.side!==void 0&&e.side!==c.ehD&&(r.side=e.side),e.shadowSide!==void 0&&(r.shadowSide=e.shadowSide),e.depthFunc!==void 0&&(r.depthFunc=e.depthFunc),e.depthTest!==void 0&&(r.depthTest=e.depthTest),e.depthWrite!==void 0&&(r.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(r.colorWrite=e.colorWrite),e.wireframe!==void 0&&(r.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(r.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(r.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(r.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(r.rotation=e.rotation),e.polygonOffset!==void 0&&(r.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(r.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(r.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(r.dithering=e.dithering),e.alphaToCoverage!==void 0&&(r.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(r.premultipliedAlpha=e.premultipliedAlpha),e.toneMapped!==void 0&&(r.toneMapped=e.toneMapped);const o=this.materialExternalResources[e.uuid];o&&Object.entries(o).forEach(([a,u])=>{a.startsWith("_")||(r[a]=cn(u,!1,this.serializedMeta))}),Object.keys(r).length>0&&(t.extensions[$o]=r,s.extensionsUsed[$o]=!0)},materialExternalResources:{},serializedMeta:{images:{},textures:{}},beforeParse(e){if(this.materialExternalResources={},!s.options.externalImagesInExtras)return;const t=[];(Array.isArray(e)?e:[e]).forEach(n=>{n==null||n.traverse(r=>{var o;r&&(!((o=r.material)===null||o===void 0)&&o.isMaterial)&&t.push(r.material)})}),t.forEach(n=>{n&&(this.materialExternalResources[n.uuid]||(this.materialExternalResources[n.uuid]={}),this.materialExternalResources[n.uuid].__materialRef=n,Object.entries(n).forEach(([r,o])=>{r.startsWith("_")||o&&o.isTexture&&o.userData.rootPath&&(n[r]=null,this.materialExternalResources[n.uuid][r]=o)}))})},afterParse(e){const t=Object.values(this.materialExternalResources);if(t.length<1)return;t.forEach(r=>{const o=r.__materialRef;o&&(Object.entries(r).forEach(([a,u])=>{a.startsWith("_")||u&&(o[a]=u)}),delete this.materialExternalResources[o.uuid])});const n=s.json.scenes[s.json.scene||0];n.extensions||(n.extensions={}),n.extensions[$o]={resources:this.serializedMeta},s.extensionsUsed[$o]=!0}});class dM{constructor(e){this.writer=e,this.name=ba}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.bumpScale===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.bumpScale=e.bumpScale,e.bumpMap){const a={index:n.processTexture(e.bumpMap)};n.applyTextureTransform(a,e.bumpMap),o.bumpTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class pM{constructor(e){this.writer=e,this.name=Jl}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.displacementScale===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.displacementScale=e.displacementScale,o.displacementBias=e.displacementBias,e.displacementMap){const a={index:n.processTexture(e.displacementMap)};n.applyTextureTransform(a,e.displacementMap),o.displacementTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class fM{constructor(e){this.writer=e,this.name=wa}writeMaterial(e,t){if(!e.isMeshStandardMaterial||e.lightMapIntensity===0)return;const n=this.writer,r=n.extensionsUsed,o={};if(o.lightMapIntensity=e.lightMapIntensity,e.lightMap){const a={index:n.processTexture(e.lightMap)};n.applyTextureTransform(a,e.lightMap),o.lightMapTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class mM{constructor(e){this.writer=e,this.name=Al}writeMaterial(e,t){if(!e.isMeshStandardMaterial||!e.alphaMap)return;const n=this.writer,r=n.extensionsUsed,o={};if(e.alphaMap){const a={index:n.processTexture(e.alphaMap)};n.applyTextureTransform(a,e.alphaMap),o.alphaTexture=a}t.extensions=t.extensions||{},t.extensions[this.name]=o,r[this.name]=!0}}class lh extends w{constructor(e,t={}){super(),this._processors=new Tu,this._cachedParsers=[],Ow(e)}get processors(){return this._processors}getExporter(...e){return lh.Exporters.find(t=>t.ext.some(n=>e.includes(n)))}async exportObject(e,t={}){var n,r,o,a;if(!(e!=null&&e.assetType))return void console.error("Object has no asset type");!((r=(n=e)===null||n===void 0?void 0:n.userData)===null||r===void 0)&&r.rootSceneModelRoot&&t.viewerConfig===!1&&(e.userData.__exportViewerConfig=!1);const u=await this._exportFile(e,t);return!((a=(o=e)===null||o===void 0?void 0:o.userData)===null||a===void 0)&&a.rootSceneModelRoot&&t.viewerConfig===!1&&delete e.userData.__exportViewerConfig,u}async _exportFile(e,t={}){var n,r,o;let a;this.dispatchEvent({type:"exportFile",obj:e,state:"processing"});try{const u=await this.processBeforeExport(e,t),p=(r=(n=t.exportExt)!==null&&n!==void 0?n:u==null?void 0:u.typeExt)!==null&&r!==void 0?r:u==null?void 0:u.ext;if(!u||!p)throw new Error(`Unable to preprocess before export ${p}`);const f=this._getParser(p);this.dispatchEvent({type:"exportFile",obj:e,state:"exporting"});const m=await f.parseAsync(u.obj,{exportExt:(o=u.ext)!==null&&o!==void 0?o:p,...t});m.ext=u.ext,a=m}catch(u){return console.error("AssetExporter: Unable to Export file",e),console.error(u),void this.dispatchEvent({type:"exportFile",obj:e,state:"error",error:u})}return this.dispatchEvent({type:"exportFile",obj:e,state:"done"}),a}_createParser(e){const t=lh.Exporters.find(r=>r.ext.includes(e));if(!t)throw new Error(`No exporter found for extension ${e}`);const n=t==null?void 0:t.ctor(this);if(!n)throw new Error(`Unable to create parser for extension ${e}`);return this._cachedParsers.push({ext:t.ext,parser:n}),this.dispatchEvent({type:"exporterCreate",exporter:t,parser:n}),n}_getParser(e){var t,n;return(n=(t=this._cachedParsers.find(r=>r.ext.includes(e)))===null||t===void 0?void 0:t.parser)!==null&&n!==void 0?n:this._createParser(e)}async processBeforeExport(e,t={}){switch(e.assetType!=null&&(e=await this._processors.process(e.assetType,e,t)),e.assetType){case"light":return void console.error("AssetExporter: light export not implemented");case"model":return{obj:e,ext:"glb"};case"material":return{obj:e.toJSON(),ext:e.typeSlug||"json",typeExt:"json"};case"texture":return{obj:e.toJSON(),ext:"json"};default:console.error("AssetExporter: unknown asset type",e.assetType)}}dispose(){var e;(e=this._processors)===null||e===void 0||e.dispose()}}lh.Exporters=[{ctor:()=>new Sy,ext:["json"]},{ctor:()=>new gc,ext:["txt","text"]}];class o0 extends ui{constructor(e){super(),this.enabled=!0,this.exportOptions={compress:!1,name:"scene",viewerConfig:!0,convertMeshToIndexed:!1,embedUrlImages:!1},this.exporter=e,this.exportScene=this.exportScene.bind(this)}async onAdded(e){await super.onAdded(e),this.exporter||(this.exporter=new lh(e)),this.exporter.processors.add("model",{forAssetType:"model",processAsync:async(t,n)=>{var r;return n.convertMeshToIndexed&&((r=t.modelObject)===null||r===void 0||r.traverse(o=>{var a;o.geometry&&(o.geometry.attributes.index||(a=o.setGeometry)===null||a===void 0||a.call(o,Zn(o.geometry)))})),t}})}async onRemove(e){return super.onRemove(e)}async exportScene(e){var t,n;return(t=this.exporter)===null||t===void 0?void 0:t.exportObject((n=this._viewer)===null||n===void 0?void 0:n.scene.modelRoot,e||{...this.exportOptions})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this._viewer;e.addEventListener("addPlugin",n=>{var r;typeof((r=n.plugin)===null||r===void 0?void 0:r.toJSON)=="function"&&console.error("Add all plugins before setting up the export UI, or use `toJSON: any = null` in the plugin ")});const t=Object.entries(e.plugins).filter(([n,r])=>typeof(r==null?void 0:r.toJSON)=="function").map(([n,r])=>({label:n,type:"checkbox",value:!0}));return this._uiConfig={type:"folder",label:"Asset Export",limitedUi:!0,children:[{type:"input",property:[this.exportOptions,"name"],limitedUi:!0},{type:"folder",label:"GLB Export",limitedUi:!0,children:[{type:"checkbox",label:"DRACO Compress",property:[this.exportOptions,"compress"],limitedUi:!0},{type:"checkbox",label:"Scene Settings",property:[this.exportOptions,"viewerConfig"],limitedUi:!0},{type:"checkbox",label:"Indexed meshes only",property:[this.exportOptions,"convertMeshToIndexed"]},{type:"button",label:"Export GLB",limitedUi:!0,value:async()=>{const n=await this.exportScene(this.exportOptions);n&&Ss(n,this.exportOptions.name+"."+n.ext)}}]},{type:"folder",label:"Preset/Config export",children:[{type:"folder",label:"Plugins",children:t},{type:"button",label:"Select none",value:()=>{t.forEach(n=>{var r;n.value=!1,(r=n.uiRefresh)===null||r===void 0||r.call(n)})}},{type:"button",label:"Select all",value:()=>{t.forEach(n=>{var r;n.value=!0,(r=n.uiRefresh)===null||r===void 0||r.call(n)})}},{type:"button",label:"Export Plugins",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(dn).exportPluginPresets(t.filter(r=>!!r.value).map(r=>Se(r.label)||"")),null,2)],{type:"application/json"});n&&Ss(n,this.exportOptions.name+"."+dn.ViewerTypeSlug)}},{type:"button",label:"Export All Viewer Config",limitedUi:!0,value:async()=>{const n=new Blob([JSON.stringify(e.getPlugin(dn).exportViewerConfig(),null,2)],{type:"application/json"});n&&Ss(n,this.exportOptions.name+"."+dn.ViewerTypeSlug)}}]}]}}}o0.PluginType="AssetExporterPlugin";class Lw{constructor(){this._listeners={}}addEventListener(e,t){const n=this._listeners;return n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),this}removeEventListener(e,t){if(this._listeners===void 0)return this;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}return this}dispatchEvent(e){if(this._listeners===void 0)return this;const t=this._listeners[e.type];if(t!==void 0){const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e)}return this}dispose(){for(const e in this._listeners)delete this._listeners[e]}}class ch extends Lw{constructor(e,t,n,r={}){if(super(),this._name=void 0,this._parent=void 0,this._child=void 0,this._attributes=void 0,this._disposed=!1,this._name=e,this._parent=t,this._child=n,this._attributes=r,!t.isOnGraph(n))throw new Error("Cannot connect disconnected graphs.")}getName(){return this._name}getParent(){return this._parent}getChild(){return this._child}setChild(e){return this._child=e,this}getAttributes(){return this._attributes}dispose(){this._disposed||(this._disposed=!0,this.dispatchEvent({type:"dispose",target:this}),super.dispose())}isDisposed(){return this._disposed}}class gM extends Lw{constructor(...e){super(...e),this._emptySet=new Set,this._edges=new Set,this._parentEdges=new Map,this._childEdges=new Map}listEdges(){return Array.from(this._edges)}listParentEdges(e){return Array.from(this._childEdges.get(e)||this._emptySet)}listParents(e){return this.listParentEdges(e).map(t=>t.getParent())}listChildEdges(e){return Array.from(this._parentEdges.get(e)||this._emptySet)}listChildren(e){return this.listChildEdges(e).map(t=>t.getChild())}disconnectParents(e,t){let n=this.listParentEdges(e);return t&&(n=n.filter(r=>t(r.getParent()))),n.forEach(r=>r.dispose()),this}createEdge(e,t,n,r){return this._registerEdge(new ch(e,t,n,r))}_registerEdge(e){this._edges.add(e);const t=e.getParent();this._parentEdges.has(t)||this._parentEdges.set(t,new Set),this._parentEdges.get(t).add(e);const n=e.getChild();return this._childEdges.has(n)||this._childEdges.set(n,new Set),this._childEdges.get(n).add(e),e.addEventListener("dispose",()=>this._removeEdge(e)),e}_removeEdge(e){return this._edges.delete(e),this._parentEdges.get(e.getParent()).delete(e),this._childEdges.get(e.getChild()).delete(e),this}}function a0(){return a0=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},a0.apply(this,arguments)}function Nw(s){return s instanceof ch}function Fw(s){return Array.isArray(s)&&s[0]instanceof ch}function Uw(s){return!!(s&&typeof s=="object"&&Object.values(s)[0]instanceof ch)}const kr=Symbol("attributes"),t_=Symbol("immutableKeys");class jw extends Lw{constructor(e){super(),this._disposed=!1,this.graph=void 0,this[kr]=void 0,this[t_]=void 0,this.graph=e,this[t_]=new Set,this[kr]=this._createAttributes()}getDefaults(){return{}}_createAttributes(){const e=this.getDefaults(),t={};for(const n in e){const r=e[n];if(r instanceof jw){const o=this.graph.createEdge(n,this,r);o.addEventListener("dispose",()=>r.dispose()),this[t_].add(n),t[n]=o}else t[n]=r}return t}isOnGraph(e){return this.graph===e.graph}isDisposed(){return this._disposed}dispose(){this._disposed||(this.graph.listChildEdges(this).forEach(e=>e.dispose()),this.graph.disconnectParents(this),this._disposed=!0,this.dispatchEvent({type:"dispose"}))}detach(){return this.graph.disconnectParents(this),this}swap(e,t){for(const n in this[kr]){const r=this[kr][n];if(Nw(r)){const o=r;o.getChild()===e&&this.setRef(n,t,o.getAttributes())}else if(Fw(r)){const o=r.find(a=>a.getChild()===e);if(o){const a=o.getAttributes();this.removeRef(n,e).addRef(n,t,a)}}else if(Uw(r)){const o=r;for(const a in o){const u=o[a];u.getChild()===e&&this.setRefMap(n,a,t,u.getAttributes())}}}return this}get(e){return this[kr][e]}set(e,t){return this[kr][e]=t,this.dispatchEvent({type:"change",attribute:e})}getRef(e){const t=this[kr][e];return t?t.getChild():null}setRef(e,t,n){if(this[t_].has(e))throw new Error(`Cannot overwrite immutable attribute, "${e}".`);const r=this[kr][e];if(r&&r.dispose(),!t)return this;const o=this.graph.createEdge(e,this,t,n);return o.addEventListener("dispose",()=>{delete this[kr][e],this.dispatchEvent({type:"change",attribute:e})}),this[kr][e]=o,this.dispatchEvent({type:"change",attribute:e})}listRefs(e){return this[kr][e].map(t=>t.getChild())}addRef(e,t,n){const r=this.graph.createEdge(e,this,t,n),o=this[kr][e];return o.push(r),r.addEventListener("dispose",()=>{const a=o.filter(u=>u!==r);o.length=0;for(const u of a)o.push(u);this.dispatchEvent({type:"change",attribute:e})}),this.dispatchEvent({type:"change",attribute:e})}removeRef(e,t){return this[kr][e].filter(n=>n.getChild()===t).forEach(n=>n.dispose()),this}listRefMapKeys(e){return Object.keys(this[kr][e])}listRefMapValues(e){return Object.values(this[kr][e]).map(t=>t.getChild())}getRefMap(e,t){const n=this[kr][e];return n[t]?n[t].getChild():null}setRefMap(e,t,n,r){const o=this[kr][e],a=o[t];if(a&&a.dispose(),!n)return this;r=Object.assign(r||{},{key:t});const u=this.graph.createEdge(e,this,n,a0({},r,{key:t}));return u.addEventListener("dispose",()=>{delete o[t],this.dispatchEvent({type:"change",attribute:e,key:t})}),o[t]=u,this.dispatchEvent({type:"change",attribute:e,key:t})}dispatchEvent(e){return super.dispatchEvent(a0({},e,{target:this})),this.graph.dispatchEvent(a0({},e,{target:this,type:`node:${e.type}`})),this}}var My,hn,Ty,gu,Ns,vc,zw=typeof Float32Array<"u"?Float32Array:Array;function Vw(s){var e=s[0],t=s[1],n=s[2];return Math.hypot(e,t,n)}function _M(s,e,t){var n=e[0],r=e[1],o=e[2],a=t[3]*n+t[7]*r+t[11]*o+t[15];return a=a||1,s[0]=(t[0]*n+t[4]*r+t[8]*o+t[12])/a,s[1]=(t[1]*n+t[5]*r+t[9]*o+t[13])/a,s[2]=(t[2]*n+t[6]*r+t[10]*o+t[14])/a,s}function vM(s,e,t){var n=e[0],r=e[1],o=e[2],a=e[3],u=e[4],p=e[5],f=e[6],m=e[7],y=e[8],S=e[9],M=e[10],P=e[11],D=e[12],j=e[13],k=e[14],L=e[15],R=t[0],W=t[1],q=t[2],J=t[3];return s[0]=R*n+W*u+q*y+J*D,s[1]=R*r+W*p+q*S+J*j,s[2]=R*o+W*f+q*M+J*k,s[3]=R*a+W*m+q*P+J*L,R=t[4],W=t[5],q=t[6],J=t[7],s[4]=R*n+W*u+q*y+J*D,s[5]=R*r+W*p+q*S+J*j,s[6]=R*o+W*f+q*M+J*k,s[7]=R*a+W*m+q*P+J*L,R=t[8],W=t[9],q=t[10],J=t[11],s[8]=R*n+W*u+q*y+J*D,s[9]=R*r+W*p+q*S+J*j,s[10]=R*o+W*f+q*M+J*k,s[11]=R*a+W*m+q*P+J*L,R=t[12],W=t[13],q=t[14],J=t[15],s[12]=R*n+W*u+q*y+J*D,s[13]=R*r+W*p+q*S+J*j,s[14]=R*o+W*f+q*M+J*k,s[15]=R*a+W*m+q*P+J*L,s}function AM(s,e){const t={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]};for(const n of s.listPrimitives()){const r=n.getAttribute("POSITION");if(!r)continue;let o=[0,0,0],a=[0,0,0];for(let u=0;u<r.getCount();u++)o=r.getElement(u,o),a=_M(a,o,e),Gw(a,t)}return t}function Gw(s,e){for(let t=0;t<3;t++)e.min[t]=Math.min(s[t],e.min[t]),e.max[t]=Math.max(s[t],e.max[t])}Math.hypot||(Math.hypot=function(){for(var s=0,e=arguments.length;e--;)s+=arguments[e]*arguments[e];return Math.sqrt(s)}),My=new zw(3),zw!=Float32Array&&(My[0]=0,My[1]=0,My[2]=0),function(s){s.ACCESSOR="Accessor",s.ANIMATION="Animation",s.ANIMATION_CHANNEL="AnimationChannel",s.ANIMATION_SAMPLER="AnimationSampler",s.BUFFER="Buffer",s.CAMERA="Camera",s.MATERIAL="Material",s.MESH="Mesh",s.PRIMITIVE="Primitive",s.PRIMITIVE_TARGET="PrimitiveTarget",s.NODE="Node",s.ROOT="Root",s.SCENE="Scene",s.SKIN="Skin",s.TEXTURE="Texture",s.TEXTURE_INFO="TextureInfo"}(hn||(hn={})),function(s){s.INTERLEAVED="interleaved",s.SEPARATE="separate"}(Ty||(Ty={})),function(s){s.ARRAY_BUFFER="ARRAY_BUFFER",s.ELEMENT_ARRAY_BUFFER="ELEMENT_ARRAY_BUFFER",s.INVERSE_BIND_MATRICES="INVERSE_BIND_MATRICES",s.OTHER="OTHER"}(gu||(gu={})),function(s){s[s.R=4096]="R",s[s.G=256]="G",s[s.B=16]="B",s[s.A=1]="A"}(Ns||(Ns={})),function(s){s.GLTF="GLTF",s.GLB="GLB"}(vc||(vc={}));class tr{static createBufferFromDataURI(e){if(typeof Buffer>"u"){const t=atob(e.split(",")[1]),n=new Uint8Array(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}{const t=e.split(",")[1],n=e.indexOf("base64")>=0;return Buffer.from(t,n?"base64":"utf8")}}static encodeText(e){return typeof TextEncoder<"u"?new TextEncoder().encode(e):Buffer.from(e)}static decodeText(e){return typeof TextDecoder<"u"?new TextDecoder().decode(e):Buffer.from(e).toString("utf8")}static concat(e){let t=0;for(const o of e)t+=o.byteLength;const n=new Uint8Array(t);let r=0;for(const o of e)n.set(o,r),r+=o.byteLength;return n}static pad(e,t=0){const n=this.padNumber(e.byteLength);if(n===e.byteLength)return e;const r=new Uint8Array(n);if(r.set(e),t!==0)for(let o=e.byteLength;o<n;o++)r[o]=t;return r}static padNumber(e){return 4*Math.ceil(e/4)}static equals(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;let n=e.byteLength;for(;n--;)if(e[n]!==t[n])return!1;return!0}static toView(e,t=0,n=1/0){return new Uint8Array(e.buffer,e.byteOffset+t,Math.min(e.byteLength,n))}static assertView(e){if(e&&!ArrayBuffer.isView(e))throw new Error(`Method requires Uint8Array parameter; received "${typeof e}".`);return e}}class ol{static hexToFactor(e,t){e=Math.floor(e);const n=t;return n[0]=(e>>16&255)/255,n[1]=(e>>8&255)/255,n[2]=(255&e)/255,this.convertSRGBToLinear(t,t)}static factorToHex(e){const t=[...e],[n,r,o]=this.convertLinearToSRGB(e,t);return 255*n<<16^255*r<<8^255*o<<0}static convertSRGBToLinear(e,t){const n=e,r=t;for(let o=0;o<3;o++)r[o]=n[o]<.04045?.0773993808*n[o]:Math.pow(.9478672986*n[o]+.0521327014,2.4);return t}static convertLinearToSRGB(e,t){const n=e,r=t;for(let o=0;o<3;o++)r[o]=n[o]<.0031308?12.92*n[o]:1.055*Math.pow(n[o],.41666)-.055;return t}}class Iy{match(e){return e.length>=8&&e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10}getSize(e){const t=new DataView(e.buffer,e.byteOffset);return tr.decodeText(e.slice(12,16))===Iy.PNG_FRIED_CHUNK_NAME?[t.getUint32(32,!1),t.getUint32(36,!1)]:[t.getUint32(16,!1),t.getUint32(20,!1)]}getChannels(e){return 4}}Iy.PNG_FRIED_CHUNK_NAME="CgBI";class ad{static registerFormat(e,t){this.impls[e]=t}static getMimeType(e){for(const t in this.impls)if(this.impls[t].match(e))return t;return null}static getSize(e,t){return this.impls[t]?this.impls[t].getSize(e):null}static getChannels(e,t){return this.impls[t]?this.impls[t].getChannels(e):null}static getMemSize(e,t){if(!this.impls[t])return null;if(this.impls[t].getGPUByteLength)return this.impls[t].getGPUByteLength(e);let n=0;const r=this.getSize(e,t);if(!r)return null;for(;r[0]>1||r[1]>1;)n+=r[0]*r[1]*4,r[0]=Math.max(Math.floor(r[0]/2),1),r[1]=Math.max(Math.floor(r[1]/2),1);return n+=4,n}static mimeTypeToExtension(e){return e==="image/jpeg"?"jpg":e.split("/").pop()}static extensionToMimeType(e){return e==="jpg"?"image/jpeg":`image/${e}`}}function yM(s,e){if(e>s.byteLength)throw new TypeError("Corrupt JPG, exceeded buffer limits");if(s.getUint8(e)!==255)throw new TypeError("Invalid JPG, marker table corrupted");return s}ad.impls={"image/jpeg":new class{match(s){return s.length>=3&&s[0]===255&&s[1]===216&&s[2]===255}getSize(s){let e,t,n=new DataView(s.buffer,s.byteOffset+4);for(;n.byteLength;){if(e=n.getUint16(0,!1),yM(n,e),t=n.getUint8(e+1),t===192||t===193||t===194)return[n.getUint16(e+7,!1),n.getUint16(e+5,!1)];n=new DataView(s.buffer,n.byteOffset+e+2)}throw new TypeError("Invalid JPG, no size found")}getChannels(s){return 3}},"image/png":new Iy};class em{static basename(e){const t=e.split(/[\\/]/).pop();return t.substring(0,t.lastIndexOf("."))}static extension(e){if(e.startsWith("data:image/")){const t=e.match(/data:(image\/\w+)/)[1];return ad.mimeTypeToExtension(t)}return e.startsWith("data:model/gltf+json")?"gltf":e.startsWith("data:model/gltf-binary")?"glb":e.startsWith("data:application/")?"bin":e.split(/[\\/]/).pop().split(/[.]/).pop()}}function T1(s){return Object.prototype.toString.call(s)==="[object Object]"}function ld(s){if(T1(s)===!1)return!1;const e=s.constructor;if(e===void 0)return!0;const t=e.prototype;return T1(t)!==!1&&Object.prototype.hasOwnProperty.call(t,"isPrototypeOf")!==!1}class Nl{constructor(e){this.verbosity=void 0,this.verbosity=e}debug(e){this.verbosity<=Nl.Verbosity.DEBUG&&console.debug(e)}info(e){this.verbosity<=Nl.Verbosity.INFO&&console.info(e)}warn(e){this.verbosity<=Nl.Verbosity.WARN&&console.warn(e)}error(e){this.verbosity<=Nl.Verbosity.ERROR&&console.error(e)}}Nl.Verbosity={SILENT:4,ERROR:3,WARN:2,INFO:1,DEBUG:0},Nl.DEFAULT_INSTANCE=new Nl(Nl.Verbosity.INFO);class ws{static identity(e){return e}static eq(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(Math.abs(e[n]-t[n])>1e-5)return!1;return!0}static denormalize(e,t){switch(t){case 5126:return e;case 5123:return e/65535;case 5121:return e/255;case 5122:return Math.max(e/32767,-1);case 5120:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}static normalize(e,t){switch(t){case 5126:return e;case 5123:return Math.round(65535*e);case 5121:return Math.round(255*e);case 5122:return Math.round(32767*e);case 5120:return Math.round(127*e);default:throw new Error("Invalid component type.")}}static decompose(e,t,n,r){let o=Vw([e[0],e[1],e[2]]);const a=Vw([e[4],e[5],e[6]]),u=Vw([e[8],e[9],e[10]]);(function(S){var M=S[0],P=S[1],D=S[2],j=S[3],k=S[4],L=S[5],R=S[6],W=S[7],q=S[8],J=S[9],ee=S[10],he=S[11],xe=S[12],De=S[13],Fe=S[14],ke=S[15];return(M*L-P*k)*(ee*ke-he*Fe)-(M*R-D*k)*(J*ke-he*De)+(M*W-j*k)*(J*Fe-ee*De)+(P*R-D*L)*(q*ke-he*xe)-(P*W-j*L)*(q*Fe-ee*xe)+(D*W-j*R)*(q*De-J*xe)})(e)<0&&(o=-o),t[0]=e[12],t[1]=e[13],t[2]=e[14];const p=e.slice(),f=1/o,m=1/a,y=1/u;p[0]*=f,p[1]*=f,p[2]*=f,p[4]*=m,p[5]*=m,p[6]*=m,p[8]*=y,p[9]*=y,p[10]*=y,function(S,M){var P=new zw(3);(function(Qe,Oe){var ze=Oe[0],$e=Oe[1],Ge=Oe[2],ot=Oe[4],yt=Oe[5],Mt=Oe[6],pt=Oe[8],Qt=Oe[9],Kt=Oe[10];Qe[0]=Math.hypot(ze,$e,Ge),Qe[1]=Math.hypot(ot,yt,Mt),Qe[2]=Math.hypot(pt,Qt,Kt)})(P,M);var D=1/P[0],j=1/P[1],k=1/P[2],L=M[0]*D,R=M[1]*j,W=M[2]*k,q=M[4]*D,J=M[5]*j,ee=M[6]*k,he=M[8]*D,xe=M[9]*j,De=M[10]*k,Fe=L+J+De,ke=0;Fe>0?(ke=2*Math.sqrt(Fe+1),S[3]=.25*ke,S[0]=(ee-xe)/ke,S[1]=(he-W)/ke,S[2]=(R-q)/ke):L>J&&L>De?(ke=2*Math.sqrt(1+L-J-De),S[3]=(ee-xe)/ke,S[0]=.25*ke,S[1]=(R+q)/ke,S[2]=(he+W)/ke):J>De?(ke=2*Math.sqrt(1+J-L-De),S[3]=(he-W)/ke,S[0]=(R+q)/ke,S[1]=.25*ke,S[2]=(ee+xe)/ke):(ke=2*Math.sqrt(1+De-L-J),S[3]=(R-q)/ke,S[0]=(he+W)/ke,S[1]=(ee+xe)/ke,S[2]=.25*ke)}(n,p),r[0]=o,r[1]=a,r[2]=u}static compose(e,t,n,r){const o=r,a=t[0],u=t[1],p=t[2],f=t[3],m=a+a,y=u+u,S=p+p,M=a*m,P=a*y,D=a*S,j=u*y,k=u*S,L=p*S,R=f*m,W=f*y,q=f*S,J=n[0],ee=n[1],he=n[2];return o[0]=(1-(j+L))*J,o[1]=(P+q)*J,o[2]=(D-W)*J,o[3]=0,o[4]=(P-q)*ee,o[5]=(1-(M+L))*ee,o[6]=(k+R)*ee,o[7]=0,o[8]=(D+W)*he,o[9]=(k-R)*he,o[10]=(1-(M+j))*he,o[11]=0,o[12]=e[0],o[13]=e[1],o[14]=e[2],o[15]=1,o}}function bM(s,e){if(!!s!=!!e)return!1;const t=s.getChild(),n=e.getChild();return t===n||t.equals(n)}function wM(s,e){if(!!s!=!!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++){const n=s[t],r=e[t];if(n.getChild()!==r.getChild()&&!n.getChild().equals(r.getChild()))return!1}return!0}function xM(s,e){if(!!s!=!!e)return!1;const t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(const r in s){const o=s[r],a=e[r];if(!!o!=!!a)return!1;const u=o.getChild(),p=a.getChild();if(u!==p&&!u.equals(p))return!1}return!0}function I1(s,e){if(s===e)return!0;if(!!s!=!!e||!s||!e||s.length!==e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!==e[t])return!1;return!0}function P1(s,e){if(s===e)return!0;if(!!s!=!!e)return!1;if(!ld(s)||!ld(e))return s===e;const t=s,n=e;let r,o=0,a=0;for(r in t)o++;for(r in n)a++;if(o!==a)return!1;for(r in t){const u=t[r],p=n[r];if(Py(u)&&Py(p)){if(!I1(u,p))return!1}else if(ld(u)&&ld(p)){if(!P1(u,p))return!1}else if(u!==p)return!1}return!0}function Py(s){return Array.isArray(s)||ArrayBuffer.isView(s)}const D1="23456789abdegjkmnpqrvwxyzABDEGJKMNPQRVWXYZ",R1=new Set,EM=function(){let s="";for(let e=0;e<6;e++)s+=D1.charAt(Math.floor(Math.random()*D1.length));return s};class yp{static dirname(e){const t=e.lastIndexOf("/");return t===-1?"./":e.substring(0,t+1)}static basename(e){return em.basename(new URL(e,"https://null.example").pathname)}static extension(e){return em.extension(new URL(e,"https://null.example").pathname)}static resolve(e,t){if(!this.isRelativePath(t))return t;const n=e.split("/"),r=t.split("/");n.pop();for(let o=0;o<r.length;o++)r[o]!=="."&&(r[o]===".."?n.pop():n.push(r[o]));return n.join("/")}static isAbsoluteURL(e){return this.PROTOCOL_REGEXP.test(e)}static isRelativePath(e){return!/^(?:[a-zA-Z]+:)?\//.test(e)}}yp.DEFAULT_INIT={},yp.PROTOCOL_REGEXP=/^[a-zA-Z]+:\/\//;const uh=s=>s,SM=new Set;class Qw extends jw{constructor(e,t=""){super(e),this[kr].name=t,this.init(),this.dispatchEvent({type:"create"})}getDefaults(){return Object.assign(super.getDefaults(),{name:"",extras:{}})}getName(){return this.get("name")}setName(e){return this.set("name",e)}getExtras(){return this.get("extras")}setExtras(e){return this.set("extras",e)}clone(){return new this.constructor(this.graph).copy(this,uh)}copy(e,t=uh){for(const n in this[kr]){const r=this[kr][n];if(r instanceof ch)this[t_].has(n)||r.dispose();else if(Array.isArray(r)&&r[0]instanceof ch)for(const o of r)o.dispose();else if(ld(r)&&Object.values(r)[0]instanceof ch)for(const o in r)r[o].dispose()}for(const n in e[kr]){const r=this[kr][n],o=e[kr][n];if(o instanceof ch)this[t_].has(n)?r.getChild().copy(t(o.getChild()),t):this.setRef(n,t(o.getChild()),o.getAttributes());else if(Array.isArray(o)&&o[0]instanceof ch)for(const a of o)this.addRef(n,t(a.getChild()),a.getAttributes());else if(ld(o)&&Object.values(o)[0]instanceof ch)for(const a in o){const u=o[a];this.setRefMap(n,a,t(u.getChild()),u.getAttributes())}else this[kr][n]=ld(o)?JSON.parse(JSON.stringify(o)):Array.isArray(o)||o instanceof ArrayBuffer||ArrayBuffer.isView(o)?o.slice():o}return this}equals(e,t=SM){if(this===e)return!0;if(this.propertyType!==e.propertyType)return!1;for(const n in this[kr]){if(t.has(n))continue;const r=this[kr][n],o=e[kr][n];if(Nw(r)||Nw(o)){if(!bM(r,o))return!1}else if(Fw(r)||Fw(o)){if(!wM(r,o))return!1}else if(Uw(r)||Uw(o)){if(!xM(r,o))return!1}else if(ld(r)||ld(o)){if(!P1(r,o))return!1}else if(Py(r)||Py(o)){if(!I1(r,o))return!1}else if(r!==o)return!1}return!0}detach(){return this.graph.disconnectParents(this,e=>e.propertyType!=="Root"),this}listParents(){return this.graph.listParents(this)}}class Ra extends Qw{getDefaults(){return Object.assign(super.getDefaults(),{extensions:{}})}getExtension(e){return this.getRefMap("extensions",e)}setExtension(e,t){return t&&t.t(this),this.setRefMap("extensions",e,t)}listExtensions(){return this.listRefMapValues("extensions")}}class Dn extends Ra{constructor(...e){super(...e),this.i=ws.identity,this.o=ws.identity}init(){this.propertyType=hn.ACCESSOR}getDefaults(){return Object.assign(super.getDefaults(),{array:null,type:Dn.Type.SCALAR,componentType:Dn.ComponentType.FLOAT,normalized:!1,buffer:null})}copy(e,t=uh){return super.copy(e,t),this.i=e.i,this.o=e.o,this}static getElementSize(e){switch(e){case Dn.Type.SCALAR:return 1;case Dn.Type.VEC2:return 2;case Dn.Type.VEC3:return 3;case Dn.Type.VEC4:case Dn.Type.MAT2:return 4;case Dn.Type.MAT3:return 9;case Dn.Type.MAT4:return 16;default:throw new Error("Unexpected type: "+e)}}static getComponentSize(e){switch(e){case Dn.ComponentType.BYTE:case Dn.ComponentType.UNSIGNED_BYTE:return 1;case Dn.ComponentType.SHORT:case Dn.ComponentType.UNSIGNED_SHORT:return 2;case Dn.ComponentType.UNSIGNED_INT:case Dn.ComponentType.FLOAT:return 4;default:throw new Error("Unexpected component type: "+e)}}getMinNormalized(e){const t=this.getElementSize();this.getMin(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMin(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=1/0;for(let o=0;o<n*r;o+=r)for(let a=0;a<r;a++){const u=t[o+a];Number.isFinite(u)&&(e[a]=Math.min(e[a],u))}return e}getMaxNormalized(e){const t=this.getElementSize();this.getMax(e);for(let n=0;n<t;n++)e[n]=this.o(e[n]);return e}getMax(e){const t=this.get("array"),n=this.getCount(),r=this.getElementSize();for(let o=0;o<r;o++)e[o]=-1/0;for(let o=0;o<n*r;o+=r)for(let a=0;a<r;a++){const u=t[o+a];Number.isFinite(u)&&(e[a]=Math.max(e[a],u))}return e}getCount(){const e=this.get("array");return e?e.length/this.getElementSize():0}getType(){return this.get("type")}setType(e){return this.set("type",e)}getElementSize(){return Dn.getElementSize(this.get("type"))}getComponentSize(){return this.get("array").BYTES_PER_ELEMENT}getComponentType(){return this.get("componentType")}getNormalized(){return this.get("normalized")}setNormalized(e){return this.set("normalized",e),e?(this.o=t=>ws.denormalize(t,this.get("componentType")),this.i=t=>ws.normalize(t,this.get("componentType"))):(this.o=ws.identity,this.i=ws.identity),this}getScalar(e){const t=this.getElementSize();return this.o(this.get("array")[e*t])}setScalar(e,t){return this.get("array")[e*this.getElementSize()]=this.i(t),this}getElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let o=0;o<n;o++)t[o]=this.o(r[e*n+o]);return t}setElement(e,t){const n=this.getElementSize(),r=this.get("array");for(let o=0;o<n;o++)r[e*n+o]=this.i(t[o]);return this}getBuffer(){return this.getRef("buffer")}setBuffer(e){return this.setRef("buffer",e)}getArray(){return this.get("array")}setArray(e){return this.set("componentType",e?function(t){switch(t.constructor){case Float32Array:return Dn.ComponentType.FLOAT;case Uint32Array:return Dn.ComponentType.UNSIGNED_INT;case Uint16Array:return Dn.ComponentType.UNSIGNED_SHORT;case Uint8Array:return Dn.ComponentType.UNSIGNED_BYTE;case Int16Array:return Dn.ComponentType.SHORT;case Int8Array:return Dn.ComponentType.BYTE;default:throw new Error("Unknown accessor componentType.")}}(e):Dn.ComponentType.FLOAT),this.set("array",e),this}getByteLength(){const e=this.get("array");return e?e.byteLength:0}}Dn.Type={SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"},Dn.ComponentType={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,UNSIGNED_INT:5125,FLOAT:5126};class B1 extends Ra{init(){this.propertyType=hn.ANIMATION}getDefaults(){return Object.assign(super.getDefaults(),{channels:[],samplers:[]})}addChannel(e){return this.addRef("channels",e)}removeChannel(e){return this.removeRef("channels",e)}listChannels(){return this.listRefs("channels")}addSampler(e){return this.addRef("samplers",e)}removeSampler(e){return this.removeRef("samplers",e)}listSamplers(){return this.listRefs("samplers")}}class Hw extends Ra{init(){this.propertyType=hn.ANIMATION_CHANNEL}getDefaults(){return Object.assign(super.getDefaults(),{targetPath:null,targetNode:null,sampler:null})}getTargetPath(){return this.get("targetPath")}setTargetPath(e){return this.set("targetPath",e)}getTargetNode(){return this.getRef("targetNode")}setTargetNode(e){return this.setRef("targetNode",e)}getSampler(){return this.getRef("sampler")}setSampler(e){return this.setRef("sampler",e)}}Hw.TargetPath={TRANSLATION:"translation",ROTATION:"rotation",SCALE:"scale",WEIGHTS:"weights"};class n_ extends Ra{init(){this.propertyType=hn.ANIMATION_SAMPLER}getDefaultAttributes(){return Object.assign(super.getDefaults(),{interpolation:n_.Interpolation.LINEAR,input:null,output:null})}getInterpolation(){return this.get("interpolation")}setInterpolation(e){return this.set("interpolation",e)}getInput(){return this.getRef("input")}setInput(e){return this.setRef("input",e,{usage:gu.OTHER})}getOutput(){return this.getRef("output")}setOutput(e){return this.setRef("output",e,{usage:gu.OTHER})}}n_.Interpolation={LINEAR:"LINEAR",STEP:"STEP",CUBICSPLINE:"CUBICSPLINE"};class k1 extends Ra{init(){this.propertyType=hn.BUFFER}getDefaults(){return Object.assign(super.getDefaults(),{uri:""})}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e)}}class tm extends Ra{init(){this.propertyType=hn.CAMERA}getDefaults(){return Object.assign(super.getDefaults(),{type:tm.Type.PERSPECTIVE,znear:.1,zfar:100,aspectRatio:null,yfov:2*Math.PI*50/360,xmag:1,ymag:1})}getType(){return this.get("type")}setType(e){return this.set("type",e)}getZNear(){return this.get("znear")}setZNear(e){return this.set("znear",e)}getZFar(){return this.get("zfar")}setZFar(e){return this.set("zfar",e)}getAspectRatio(){return this.get("aspectRatio")}setAspectRatio(e){return this.set("aspectRatio",e)}getYFov(){return this.get("yfov")}setYFov(e){return this.set("yfov",e)}getXMag(){return this.get("xmag")}setXMag(e){return this.set("xmag",e)}getYMag(){return this.get("ymag")}setYMag(e){return this.set("ymag",e)}}tm.Type={PERSPECTIVE:"perspective",ORTHOGRAPHIC:"orthographic"};class Fs extends Qw{t(e){if(!this.parentTypes.includes(e.propertyType))throw new Error(`Parent "${e.propertyType}" invalid for child "${this.propertyType}".`)}}Fs.EXTENSION_NAME=void 0;class as extends Ra{init(){this.propertyType=hn.TEXTURE_INFO}getDefaults(){return Object.assign(super.getDefaults(),{texCoord:0,magFilter:null,minFilter:null,wrapS:as.WrapMode.REPEAT,wrapT:as.WrapMode.REPEAT})}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}getMagFilter(){return this.get("magFilter")}setMagFilter(e){return this.set("magFilter",e)}getMinFilter(){return this.get("minFilter")}setMinFilter(e){return this.set("minFilter",e)}getWrapS(){return this.get("wrapS")}setWrapS(e){return this.set("wrapS",e)}getWrapT(){return this.get("wrapT")}setWrapT(e){return this.set("wrapT",e)}}as.WrapMode={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497},as.MagFilter={NEAREST:9728,LINEAR:9729},as.MinFilter={NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987};const{R:Dy,G:Ry,B:By,A:CM}=Ns;class nm extends Ra{init(){this.propertyType=hn.MATERIAL}getDefaults(){return Object.assign(super.getDefaults(),{alphaMode:nm.AlphaMode.OPAQUE,alphaCutoff:.5,doubleSided:!1,baseColorFactor:[1,1,1,1],baseColorTexture:null,baseColorTextureInfo:new as(this.graph,"baseColorTextureInfo"),emissiveFactor:[0,0,0],emissiveTexture:null,emissiveTextureInfo:new as(this.graph,"emissiveTextureInfo"),normalScale:1,normalTexture:null,normalTextureInfo:new as(this.graph,"normalTextureInfo"),occlusionStrength:1,occlusionTexture:null,occlusionTextureInfo:new as(this.graph,"occlusionTextureInfo"),roughnessFactor:1,metallicFactor:1,metallicRoughnessTexture:null,metallicRoughnessTextureInfo:new as(this.graph,"metallicRoughnessTextureInfo")})}getDoubleSided(){return this.get("doubleSided")}setDoubleSided(e){return this.set("doubleSided",e)}getAlpha(){return this.get("baseColorFactor")[3]}setAlpha(e){const t=this.get("baseColorFactor").slice();return t[3]=e,this.set("baseColorFactor",t)}getAlphaMode(){return this.get("alphaMode")}setAlphaMode(e){return this.set("alphaMode",e)}getAlphaCutoff(){return this.get("alphaCutoff")}setAlphaCutoff(e){return this.set("alphaCutoff",e)}getBaseColorFactor(){return this.get("baseColorFactor")}setBaseColorFactor(e){return this.set("baseColorFactor",e)}getBaseColorHex(){return ol.factorToHex(this.get("baseColorFactor"))}setBaseColorHex(e){const t=this.get("baseColorFactor").slice();return this.set("baseColorFactor",ol.hexToFactor(e,t))}getBaseColorTexture(){return this.getRef("baseColorTexture")}getBaseColorTextureInfo(){return this.getRef("baseColorTexture")?this.getRef("baseColorTextureInfo"):null}setBaseColorTexture(e){return this.setRef("baseColorTexture",e,{channels:Dy|Ry|By|CM})}getEmissiveFactor(){return this.get("emissiveFactor")}setEmissiveFactor(e){return this.set("emissiveFactor",e)}getEmissiveHex(){return ol.factorToHex(this.get("emissiveFactor"))}setEmissiveHex(e){const t=this.get("emissiveFactor").slice();return this.set("emissiveFactor",ol.hexToFactor(e,t))}getEmissiveTexture(){return this.getRef("emissiveTexture")}getEmissiveTextureInfo(){return this.getRef("emissiveTexture")?this.getRef("emissiveTextureInfo"):null}setEmissiveTexture(e){return this.setRef("emissiveTexture",e,{channels:Dy|Ry|By})}getNormalScale(){return this.get("normalScale")}setNormalScale(e){return this.set("normalScale",e)}getNormalTexture(){return this.getRef("normalTexture")}getNormalTextureInfo(){return this.getRef("normalTexture")?this.getRef("normalTextureInfo"):null}setNormalTexture(e){return this.setRef("normalTexture",e,{channels:Dy|Ry|By})}getOcclusionStrength(){return this.get("occlusionStrength")}setOcclusionStrength(e){return this.set("occlusionStrength",e)}getOcclusionTexture(){return this.getRef("occlusionTexture")}getOcclusionTextureInfo(){return this.getRef("occlusionTexture")?this.getRef("occlusionTextureInfo"):null}setOcclusionTexture(e){return this.setRef("occlusionTexture",e,{channels:Dy})}getRoughnessFactor(){return this.get("roughnessFactor")}setRoughnessFactor(e){return this.set("roughnessFactor",e)}getMetallicFactor(){return this.get("metallicFactor")}setMetallicFactor(e){return this.set("metallicFactor",e)}getMetallicRoughnessTexture(){return this.getRef("metallicRoughnessTexture")}getMetallicRoughnessTextureInfo(){return this.getRef("metallicRoughnessTexture")?this.getRef("metallicRoughnessTextureInfo"):null}setMetallicRoughnessTexture(e){return this.setRef("metallicRoughnessTexture",e,{channels:Ry|By})}}nm.AlphaMode={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};class O1 extends Ra{init(){this.propertyType=hn.MESH}getDefaults(){return Object.assign(super.getDefaults(),{weights:[],primitives:[]})}addPrimitive(e){return this.addRef("primitives",e)}removePrimitive(e){return this.removeRef("primitives",e)}listPrimitives(){return this.listRefs("primitives")}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}}class ky extends Ra{constructor(...e){super(...e),this.u=null}init(){this.propertyType=hn.NODE}getDefaults(){return Object.assign(super.getDefaults(),{translation:[0,0,0],rotation:[0,0,0,1],scale:[1,1,1],weights:[],camera:null,mesh:null,skin:null,children:[]})}copy(e,t=uh){if(t===uh)throw new Error("Node cannot be copied.");return super.copy(e,t)}getTranslation(){return this.get("translation")}getRotation(){return this.get("rotation")}getScale(){return this.get("scale")}setTranslation(e){return this.set("translation",e)}setRotation(e){return this.set("rotation",e)}setScale(e){return this.set("scale",e)}getMatrix(){return ws.compose(this.get("translation"),this.get("rotation"),this.get("scale"),[])}setMatrix(e){const t=this.get("translation").slice(),n=this.get("rotation").slice(),r=this.get("scale").slice();return ws.decompose(e,t,n,r),this.set("translation",t).set("rotation",n).set("scale",r)}getWorldTranslation(){const e=[0,0,0];return ws.decompose(this.getWorldMatrix(),e,[0,0,0,1],[1,1,1]),e}getWorldRotation(){const e=[0,0,0,1];return ws.decompose(this.getWorldMatrix(),[0,0,0],e,[1,1,1]),e}getWorldScale(){const e=[1,1,1];return ws.decompose(this.getWorldMatrix(),[0,0,0],[0,0,0,1],e),e}getWorldMatrix(){const e=[];for(let r=this;r instanceof ky;r=r.u)e.push(r);let t;const n=e.pop().getMatrix();for(;t=e.pop();)vM(n,n,t.getMatrix());return n}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[kr].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}getParent(){return this.u}getMesh(){return this.getRef("mesh")}setMesh(e){return this.setRef("mesh",e)}getCamera(){return this.getRef("camera")}setCamera(e){return this.setRef("camera",e)}getSkin(){return this.getRef("skin")}setSkin(e){return this.setRef("skin",e)}getWeights(){return this.get("weights")}setWeights(e){return this.set("weights",e)}traverse(e){e(this);for(const t of this.listChildren())t.traverse(e);return this}}class im extends Ra{init(){this.propertyType=hn.PRIMITIVE}getDefaults(){return Object.assign(super.getDefaults(),{mode:im.Mode.TRIANGLES,material:null,indices:null,attributes:{},targets:[]})}getIndices(){return this.getRef("indices")}setIndices(e){return this.setRef("indices",e,{usage:gu.ELEMENT_ARRAY_BUFFER})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:gu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}getMode(){return this.get("mode")}setMode(e){return this.set("mode",e)}listTargets(){return this.listRefs("targets")}addTarget(e){return this.addRef("targets",e)}removeTarget(e){return this.removeRef("targets",e)}}im.Mode={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6};class MM extends Qw{init(){this.propertyType=hn.PRIMITIVE_TARGET}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:gu.ARRAY_BUFFER})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}function al(){return(al=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}class L1 extends Ra{init(){this.propertyType=hn.SCENE}getDefaults(){return Object.assign(super.getDefaults(),{children:[]})}copy(e,t=uh){if(t===uh)throw new Error("Scene cannot be copied.");return super.copy(e,t)}addChild(e){e.u&&e.u.removeChild(e),this.addRef("children",e),e.u=this;const t=this[kr].children;return t[t.length-1].addEventListener("dispose",()=>e.u=null),this}removeChild(e){return this.removeRef("children",e)}listChildren(){return this.listRefs("children")}traverse(e){for(const t of this.listChildren())t.traverse(e);return this}}class N1 extends Ra{init(){this.propertyType=hn.SKIN}getDefaults(){return Object.assign(super.getDefaults(),{skeleton:null,inverseBindMatrices:null,joints:[]})}getSkeleton(){return this.getRef("skeleton")}setSkeleton(e){return this.setRef("skeleton",e)}getInverseBindMatrices(){return this.getRef("inverseBindMatrices")}setInverseBindMatrices(e){return this.setRef("inverseBindMatrices",e,{usage:gu.INVERSE_BIND_MATRICES})}addJoint(e){return this.addRef("joints",e)}removeJoint(e){return this.removeRef("joints",e)}listJoints(){return this.listRefs("joints")}}class F1 extends Ra{init(){this.propertyType=hn.TEXTURE}getDefaults(){return Object.assign(super.getDefaults(),{image:null,mimeType:"",uri:""})}getMimeType(){return this.get("mimeType")||ad.extensionToMimeType(em.extension(this.get("uri")))}setMimeType(e){return this.set("mimeType",e)}getURI(){return this.get("uri")}setURI(e){return this.set("uri",e),this.set("mimeType",ad.extensionToMimeType(em.extension(e))),this}getImage(){return this.get("image")}setImage(e){return this.set("image",tr.assertView(e))}getSize(){const e=this.get("image");return e?ad.getSize(e,this.getMimeType()):null}}class U1 extends Ra{init(){this.propertyType=hn.ROOT}getDefaults(){return Object.assign(super.getDefaults(),{asset:{generator:"glTF-Transform v2.2.3",version:"2.0"},defaultScene:null,accessors:[],animations:[],buffers:[],cameras:[],materials:[],meshes:[],nodes:[],scenes:[],skins:[],textures:[]})}constructor(e){super(e),this.h=new Set,e.addEventListener("node:create",t=>{this.l(t.target)})}clone(){throw new Error("Root cannot be cloned.")}copy(e,t=uh){if(t===uh)throw new Error("Root cannot be copied.");this.set("asset",al({},e.get("asset"))),this.setName(e.getName()),this.setExtras(al({},e.getExtras())),this.setDefaultScene(e.getDefaultScene()?t(e.getDefaultScene()):null);for(const n of e.listRefMapKeys("extensions")){const r=e.getExtension(n);this.setExtension(n,t(r))}return this}l(e){return e instanceof L1?this.addRef("scenes",e):e instanceof ky?this.addRef("nodes",e):e instanceof tm?this.addRef("cameras",e):e instanceof N1?this.addRef("skins",e):e instanceof O1?this.addRef("meshes",e):e instanceof nm?this.addRef("materials",e):e instanceof F1?this.addRef("textures",e):e instanceof B1?this.addRef("animations",e):e instanceof Dn?this.addRef("accessors",e):e instanceof k1&&this.addRef("buffers",e),this}getAsset(){return this.get("asset")}listExtensionsUsed(){return Array.from(this.h)}listExtensionsRequired(){return this.listExtensionsUsed().filter(e=>e.isRequired())}g(e){return this.h.add(e),this}p(e){return this.h.delete(e),this}listScenes(){return this.listRefs("scenes")}setDefaultScene(e){return this.setRef("defaultScene",e)}getDefaultScene(){return this.getRef("defaultScene")}listNodes(){return this.listRefs("nodes")}listCameras(){return this.listRefs("cameras")}listSkins(){return this.listRefs("skins")}listMeshes(){return this.listRefs("meshes")}listMaterials(){return this.listRefs("materials")}listTextures(){return this.listRefs("textures")}listAnimations(){return this.listRefs("animations")}listAccessors(){return this.listRefs("accessors")}listBuffers(){return this.listRefs("buffers")}}class Ww{constructor(){this.m=new gM,this.T=new U1(this.m),this.v=Nl.DEFAULT_INSTANCE}getRoot(){return this.T}getGraph(){return this.m}getLogger(){return this.v}setLogger(e){return this.v=e,this}clone(){return new Ww().setLogger(this.v).merge(this)}merge(e){for(const o of e.getRoot().listExtensionsUsed()){const a=this.createExtension(o.constructor);o.isRequired()&&a.setRequired(!0)}const t=new Set,n=new Map;t.add(e.T),n.set(e.T,this.T);for(const o of e.m.listEdges())for(const a of[o.getParent(),o.getChild()]){if(t.has(a))continue;let u;u=a.propertyType===hn.TEXTURE_INFO?a:new a.constructor(this.m),n.set(a,u),t.add(a)}const r=o=>{const a=n.get(o);if(!a)throw new Error("Could resolve property.");return a};for(const o of t){const a=n.get(o);if(!a)throw new Error("Could resolve property.");a.propertyType!==hn.TEXTURE_INFO&&a.copy(o,r)}return this}async transform(...e){const t=e.map(n=>n.name);for(const n of e)await n(this,{stack:t});return this}createExtension(e){const t=e.EXTENSION_NAME;return this.getRoot().listExtensionsUsed().find(n=>n.extensionName===t)||new e(this)}createScene(e=""){return new L1(this.m,e)}createNode(e=""){return new ky(this.m,e)}createCamera(e=""){return new tm(this.m,e)}createSkin(e=""){return new N1(this.m,e)}createMesh(e=""){return new O1(this.m,e)}createPrimitive(){return new im(this.m)}createPrimitiveTarget(e=""){return new MM(this.m,e)}createMaterial(e=""){return new nm(this.m,e)}createTexture(e=""){return new F1(this.m,e)}createAnimation(e=""){return new B1(this.m,e)}createAnimationChannel(e=""){return new Hw(this.m,e)}createAnimationSampler(e=""){return new n_(this.m,e)}createAccessor(e="",t=null){return t||(t=this.getRoot().listBuffers()[0]),new Dn(this.m,e).setBuffer(t)}createBuffer(e=""){return new k1(this.m,e)}}class ms{constructor(e){this.extensionName="",this.prereadTypes=[],this.prewriteTypes=[],this.readDependencies=[],this.writeDependencies=[],this.document=void 0,this.required=!1,this.properties=new Set,this.S=void 0,this.document=e,e.getRoot().g(this),this.S=n=>{const r=n,o=r.target;o instanceof Fs&&o.extensionName===this.extensionName&&(r.type==="node:create"&&this.M(o),r.type==="node:dispose"&&this.I(o))};const t=e.getGraph();t.addEventListener("node:create",this.S),t.addEventListener("node:dispose",this.S)}dispose(){this.document.getRoot().p(this);const e=this.document.getGraph();e.removeEventListener("node:create",this.S),e.removeEventListener("node:dispose",this.S);for(const t of this.properties)t.dispose()}static register(){}isRequired(){return this.required}setRequired(e){return this.required=e,this}M(e){return this.properties.add(e),this}I(e){return this.properties.delete(e),this}install(e,t){return this}preread(e,t){return this}prewrite(e,t){return this}}ms.EXTENSION_NAME=void 0;class TM{constructor(e){this.jsonDoc=void 0,this.buffers=[],this.bufferViews=[],this.bufferViewBuffers=[],this.accessors=[],this.textures=[],this.textureInfos=new Map,this.materials=[],this.meshes=[],this.cameras=[],this.nodes=[],this.skins=[],this.animations=[],this.scenes=[],this.jsonDoc=e}setTextureInfo(e,t){this.textureInfos.set(e,t),t.texCoord!==void 0&&e.setTexCoord(t.texCoord);const n=this.jsonDoc.json.textures[t.index];if(n.sampler===void 0)return;const r=this.jsonDoc.json.samplers[n.sampler];r.magFilter!==void 0&&e.setMagFilter(r.magFilter),r.minFilter!==void 0&&e.setMinFilter(r.minFilter),r.wrapS!==void 0&&e.setWrapS(r.wrapS),r.wrapT!==void 0&&e.setWrapT(r.wrapT)}}const qw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},j1={logger:Nl.DEFAULT_INSTANCE,extensions:[],dependencies:{}};function Oy(s,e){const t=e.bufferViews[s.bufferView],n=e.jsonDoc.json.bufferViews[s.bufferView],r=qw[s.componentType],o=Dn.getElementSize(s.type),a=r.BYTES_PER_ELEMENT;if(n.byteStride!==void 0&&n.byteStride!==o*a)return function(p,f){const m=f.bufferViews[p.bufferView],y=f.jsonDoc.json.bufferViews[p.bufferView],S=qw[p.componentType],M=Dn.getElementSize(p.type),P=S.BYTES_PER_ELEMENT,D=p.byteOffset||0,j=new S(p.count*M),k=new DataView(m.buffer,m.byteOffset,m.byteLength),L=y.byteStride;for(let R=0;R<p.count;R++)for(let W=0;W<M;W++){const q=D+R*L+W*P;let J;switch(p.componentType){case Dn.ComponentType.FLOAT:J=k.getFloat32(q,!0);break;case Dn.ComponentType.UNSIGNED_INT:J=k.getUint32(q,!0);break;case Dn.ComponentType.UNSIGNED_SHORT:J=k.getUint16(q,!0);break;case Dn.ComponentType.UNSIGNED_BYTE:J=k.getUint8(q);break;case Dn.ComponentType.SHORT:J=k.getInt16(q,!0);break;case Dn.ComponentType.BYTE:J=k.getInt8(q);break;default:throw new Error(`Unexpected componentType "${p.componentType}".`)}j[R*M+W]=J}return j}(s,e);const u=t.byteOffset+(s.byteOffset||0);return new r(t.buffer.slice(u,u+s.count*o*a))}var l0;(function(s){s[s.ARRAY_BUFFER=34962]="ARRAY_BUFFER",s[s.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(l0||(l0={}));class Ac{constructor(e,t,n){this.N=void 0,this.jsonDoc=void 0,this.options=void 0,this.accessorIndexMap=new Map,this.animationIndexMap=new Map,this.bufferIndexMap=new Map,this.cameraIndexMap=new Map,this.skinIndexMap=new Map,this.materialIndexMap=new Map,this.meshIndexMap=new Map,this.nodeIndexMap=new Map,this.imageIndexMap=new Map,this.textureDefIndexMap=new Map,this.textureInfoDefMap=new Map,this.samplerDefIndexMap=new Map,this.sceneIndexMap=new Map,this.imageBufferViews=[],this.otherBufferViews=new Map,this.otherBufferViewsIndexMap=new Map,this.extensionData={},this.bufferURIGenerator=void 0,this.imageURIGenerator=void 0,this.logger=void 0,this.O=new Map,this.accessorUsageGroupedByParent=new Set(["ARRAY_BUFFER"]),this.accessorParents=new Map,this.N=e,this.jsonDoc=t,this.options=n;const r=e.getRoot(),o=r.listBuffers().length,a=r.listTextures().length;this.bufferURIGenerator=new z1(o>1,n.basename),this.imageURIGenerator=new z1(a>1,n.basename),this.logger=e.getLogger()}createTextureInfoDef(e,t){const n={magFilter:t.getMagFilter()||void 0,minFilter:t.getMinFilter()||void 0,wrapS:t.getWrapS(),wrapT:t.getWrapT()},r=JSON.stringify(n);this.samplerDefIndexMap.has(r)||(this.samplerDefIndexMap.set(r,this.jsonDoc.json.samplers.length),this.jsonDoc.json.samplers.push(n));const o={source:this.imageIndexMap.get(e),sampler:this.samplerDefIndexMap.get(r)},a=JSON.stringify(o);this.textureDefIndexMap.has(a)||(this.textureDefIndexMap.set(a,this.jsonDoc.json.textures.length),this.jsonDoc.json.textures.push(o));const u={index:this.textureDefIndexMap.get(a)};return t.getTexCoord()!==0&&(u.texCoord=t.getTexCoord()),this.textureInfoDefMap.set(t,u),u}createPropertyDef(e){const t={};return e.getName()&&(t.name=e.getName()),Object.keys(e.getExtras()).length>0&&(t.extras=e.getExtras()),t}createAccessorDef(e){const t=this.createPropertyDef(e);return t.type=e.getType(),t.componentType=e.getComponentType(),t.count=e.getCount(),this.N.getGraph().listParentEdges(e).some(n=>n.getName()==="attributes"&&n.getAttributes().key==="POSITION"||n.getName()==="input")&&(t.max=e.getMax([]).map(Math.fround),t.min=e.getMin([]).map(Math.fround)),e.getNormalized()&&(t.normalized=e.getNormalized()),t}createImageData(e,t,n){if(this.options.format===vc.GLB)this.imageBufferViews.push(t),e.bufferView=this.jsonDoc.json.bufferViews.length,this.jsonDoc.json.bufferViews.push({buffer:0,byteOffset:-1,byteLength:t.byteLength});else{const r=ad.mimeTypeToExtension(n.getMimeType());e.uri=this.imageURIGenerator.createURI(n,r),this.jsonDoc.resources[e.uri]=t}}getAccessorUsage(e){const t=this.O.get(e);if(t)return t;for(const n of this.N.getGraph().listParentEdges(e)){const{usage:r}=n.getAttributes();if(r)return r;n.getParent().propertyType!==hn.ROOT&&this.N.getLogger().warn(`Missing attribute ".usage" on edge, "${n.getName()}".`)}return Ac.BufferViewUsage.OTHER}addAccessorToUsageGroup(e,t){const n=this.O.get(e);if(n&&n!==t)throw new Error(`Accessor with usage "${n}" cannot be reused as "${t}".`);return this.O.set(e,t),this}listAccessorUsageGroups(){const e={};for(const[t,n]of Array.from(this.O.entries()))e[n]=e[n]||[],e[n].push(t);return e}}Ac.BufferViewTarget=l0,Ac.BufferViewUsage=gu,Ac.USAGE_TO_TARGET={[gu.ARRAY_BUFFER]:l0.ARRAY_BUFFER,[gu.ELEMENT_ARRAY_BUFFER]:l0.ELEMENT_ARRAY_BUFFER};class z1{constructor(e,t){this.multiple=void 0,this.basename=void 0,this.counter=1,this.multiple=e,this.basename=t}createURI(e,t){return e.getURI()?e.getURI():this.multiple?`${this.basename}_${this.counter++}.${t}`:`${this.basename}.${t}`}}const{BufferViewUsage:Yw}=Ac;var Ly;(function(s){s[s.JSON=1313821514]="JSON",s[s.BIN=5130562]="BIN"})(Ly||(Ly={}));class IM extends class{constructor(){this.v=Nl.DEFAULT_INSTANCE,this.h=new Set,this.C={},this.F=Ty.INTERLEAVED,this.lastReadBytes=0,this.lastWriteBytes=0}setLogger(e){return this.v=e,this}registerExtensions(e){for(const t of e)this.h.add(t),t.register();return this}registerDependencies(e){return Object.assign(this.C,e),this}setVertexLayout(e){return this.F=e,this}async read(e){return await this.readJSON(await this.readAsJSON(e))}async readAsJSON(e){return e.match(/^data:application\/octet-stream;/)||this.detectFormat(e)===vc.GLB?this.U(e):this.P(e)}async readJSON(e){return e=this.j(e),this.L(e),class{static read(t,n=j1){const r=al({},j1,n),{json:o}=t,a=new Ww;this.validate(t,r);const u=new TM(t),p=o.asset,f=a.getRoot().getAsset();p.copyright&&(f.copyright=p.copyright),p.extras&&(f.extras=p.extras),o.extras!==void 0&&a.getRoot().setExtras(al({},o.extras));const m=o.extensionsUsed||[],y=o.extensionsRequired||[];for(const L of r.extensions)if(m.includes(L.EXTENSION_NAME)){const R=a.createExtension(L).setRequired(y.includes(L.EXTENSION_NAME));for(const W of R.readDependencies)R.install(W,r.dependencies[W])}const S=o.buffers||[];a.getRoot().listExtensionsUsed().filter(L=>L.prereadTypes.includes(hn.BUFFER)).forEach(L=>L.preread(u,hn.BUFFER)),u.buffers=S.map(L=>{const R=a.createBuffer(L.name);return L.extras&&R.setExtras(L.extras),L.uri&&L.uri.indexOf("__")!==0&&R.setURI(L.uri),R}),u.bufferViewBuffers=(o.bufferViews||[]).map((L,R)=>{if(!u.bufferViews[R]){const W=t.json.buffers[L.buffer];u.bufferViews[R]=tr.toView(W.uri?t.resources[W.uri]:t.resources["@glb.bin"],L.byteOffset||0,L.byteLength)}return u.buffers[L.buffer]}),u.accessors=(o.accessors||[]).map(L=>{const R=a.createAccessor(L.name,u.bufferViewBuffers[L.bufferView]).setType(L.type);if(L.extras&&R.setExtras(L.extras),L.normalized!==void 0&&R.setNormalized(L.normalized),L.bufferView===void 0&&!L.sparse)return R;let W;return W=L.sparse!==void 0?function(q,J){const ee=qw[q.componentType],he=Dn.getElementSize(q.type);let xe;xe=q.bufferView!==void 0?Oy(q,J):new ee(q.count*he);const De=q.sparse,Fe=De.count,ke=al({},q,De.indices,{count:Fe,type:"SCALAR"}),Qe=al({},q,De.values,{count:Fe}),Oe=Oy(ke,J),ze=Oy(Qe,J);for(let $e=0;$e<ke.count;$e++)for(let Ge=0;Ge<he;Ge++)xe[Oe[$e]*he+Ge]=ze[$e*he+Ge];return xe}(L,u):Oy(L,u),R.setArray(W),R});const M=o.images||[],P=o.textures||[];a.getRoot().listExtensionsUsed().filter(L=>L.prereadTypes.includes(hn.TEXTURE)).forEach(L=>L.preread(u,hn.TEXTURE)),u.textures=M.map(L=>{const R=a.createTexture(L.name);if(L.extras&&R.setExtras(L.extras),L.bufferView!==void 0){const W=o.bufferViews[L.bufferView],q=t.json.buffers[W.buffer],J=W.byteOffset||0,ee=(q.uri?t.resources[q.uri]:t.resources["@glb.bin"]).slice(J,J+W.byteLength);R.setImage(ee)}else L.uri!==void 0&&(R.setImage(t.resources[L.uri]),L.uri.indexOf("__")!==0&&R.setURI(L.uri));if(L.mimeType!==void 0)R.setMimeType(L.mimeType);else if(L.uri){const W=em.extension(L.uri);R.setMimeType(ad.extensionToMimeType(W))}return R}),u.materials=(o.materials||[]).map(L=>{const R=a.createMaterial(L.name);L.extras&&R.setExtras(L.extras),L.alphaMode!==void 0&&R.setAlphaMode(L.alphaMode),L.alphaCutoff!==void 0&&R.setAlphaCutoff(L.alphaCutoff),L.doubleSided!==void 0&&R.setDoubleSided(L.doubleSided);const W=L.pbrMetallicRoughness||{};if(W.baseColorFactor!==void 0&&R.setBaseColorFactor(W.baseColorFactor),L.emissiveFactor!==void 0&&R.setEmissiveFactor(L.emissiveFactor),W.metallicFactor!==void 0&&R.setMetallicFactor(W.metallicFactor),W.roughnessFactor!==void 0&&R.setRoughnessFactor(W.roughnessFactor),W.baseColorTexture!==void 0){const q=W.baseColorTexture;R.setBaseColorTexture(u.textures[P[q.index].source]),u.setTextureInfo(R.getBaseColorTextureInfo(),q)}if(L.emissiveTexture!==void 0){const q=L.emissiveTexture;R.setEmissiveTexture(u.textures[P[q.index].source]),u.setTextureInfo(R.getEmissiveTextureInfo(),q)}if(L.normalTexture!==void 0){const q=L.normalTexture;R.setNormalTexture(u.textures[P[q.index].source]),u.setTextureInfo(R.getNormalTextureInfo(),q),L.normalTexture.scale!==void 0&&R.setNormalScale(L.normalTexture.scale)}if(L.occlusionTexture!==void 0){const q=L.occlusionTexture;R.setOcclusionTexture(u.textures[P[q.index].source]),u.setTextureInfo(R.getOcclusionTextureInfo(),q),L.occlusionTexture.strength!==void 0&&R.setOcclusionStrength(L.occlusionTexture.strength)}if(W.metallicRoughnessTexture!==void 0){const q=W.metallicRoughnessTexture;R.setMetallicRoughnessTexture(u.textures[P[q.index].source]),u.setTextureInfo(R.getMetallicRoughnessTextureInfo(),q)}return R});const D=o.meshes||[];a.getRoot().listExtensionsUsed().filter(L=>L.prereadTypes.includes(hn.PRIMITIVE)).forEach(L=>L.preread(u,hn.PRIMITIVE)),u.meshes=D.map(L=>{const R=a.createMesh(L.name);return L.extras&&R.setExtras(L.extras),L.weights!==void 0&&R.setWeights(L.weights),(L.primitives||[]).forEach(W=>{const q=a.createPrimitive();W.extras&&q.setExtras(W.extras),W.material!==void 0&&q.setMaterial(u.materials[W.material]),W.mode!==void 0&&q.setMode(W.mode);for(const[ee,he]of Object.entries(W.attributes||{}))q.setAttribute(ee,u.accessors[he]);W.indices!==void 0&&q.setIndices(u.accessors[W.indices]);const J=L.extras&&L.extras.targetNames||[];(W.targets||[]).forEach((ee,he)=>{const xe=J[he]||he.toString(),De=a.createPrimitiveTarget(xe);for(const[Fe,ke]of Object.entries(ee))De.setAttribute(Fe,u.accessors[ke]);q.addTarget(De)}),R.addPrimitive(q)}),R}),u.cameras=(o.cameras||[]).map(L=>{const R=a.createCamera(L.name).setType(L.type);if(L.extras&&R.setExtras(L.extras),L.type===tm.Type.PERSPECTIVE){const W=L.perspective;R.setYFov(W.yfov),R.setZNear(W.znear),W.zfar!==void 0&&R.setZFar(W.zfar),W.aspectRatio!==void 0&&R.setAspectRatio(W.aspectRatio)}else{const W=L.orthographic;R.setZNear(W.znear).setZFar(W.zfar).setXMag(W.xmag).setYMag(W.ymag)}return R});const j=o.nodes||[];a.getRoot().listExtensionsUsed().filter(L=>L.prereadTypes.includes(hn.NODE)).forEach(L=>L.preread(u,hn.NODE)),u.nodes=j.map(L=>{const R=a.createNode(L.name);if(L.extras&&R.setExtras(L.extras),L.translation!==void 0&&R.setTranslation(L.translation),L.rotation!==void 0&&R.setRotation(L.rotation),L.scale!==void 0&&R.setScale(L.scale),L.matrix!==void 0){const W=[0,0,0],q=[0,0,0,1],J=[1,1,1];ws.decompose(L.matrix,W,q,J),R.setTranslation(W),R.setRotation(q),R.setScale(J)}return L.weights!==void 0&&R.setWeights(L.weights),R}),u.skins=(o.skins||[]).map(L=>{const R=a.createSkin(L.name);L.extras&&R.setExtras(L.extras),L.inverseBindMatrices!==void 0&&R.setInverseBindMatrices(u.accessors[L.inverseBindMatrices]),L.skeleton!==void 0&&R.setSkeleton(u.nodes[L.skeleton]);for(const W of L.joints)R.addJoint(u.nodes[W]);return R}),j.map((L,R)=>{const W=u.nodes[R];(L.children||[]).forEach(q=>W.addChild(u.nodes[q])),L.mesh!==void 0&&W.setMesh(u.meshes[L.mesh]),L.camera!==void 0&&W.setCamera(u.cameras[L.camera]),L.skin!==void 0&&W.setSkin(u.skins[L.skin])}),u.animations=(o.animations||[]).map(L=>{const R=a.createAnimation(L.name);L.extras&&R.setExtras(L.extras);const W=(L.samplers||[]).map(q=>{const J=a.createAnimationSampler().setInput(u.accessors[q.input]).setOutput(u.accessors[q.output]).setInterpolation(q.interpolation||n_.Interpolation.LINEAR);return q.extras&&J.setExtras(q.extras),R.addSampler(J),J});return(L.channels||[]).forEach(q=>{const J=a.createAnimationChannel().setSampler(W[q.sampler]).setTargetPath(q.target.path);q.target.node!==void 0&&J.setTargetNode(u.nodes[q.target.node]),q.extras&&J.setExtras(q.extras),R.addChannel(J)}),R});const k=o.scenes||[];return a.getRoot().listExtensionsUsed().filter(L=>L.prereadTypes.includes(hn.SCENE)).forEach(L=>L.preread(u,hn.SCENE)),u.scenes=k.map(L=>{const R=a.createScene(L.name);return L.extras&&R.setExtras(L.extras),(L.nodes||[]).map(W=>u.nodes[W]).forEach(W=>R.addChild(W)),R}),o.scene!==void 0&&a.getRoot().setDefaultScene(u.scenes[o.scene]),a.getRoot().listExtensionsUsed().forEach(L=>L.read(u)),a}static validate(t,n){const r=t.json;if(r.asset.version!=="2.0")throw new Error(`Unsupported glTF version, "${r.asset.version}".`);if(r.extensionsRequired){for(const o of r.extensionsRequired)if(!n.extensions.find(a=>a.EXTENSION_NAME===o))throw new Error(`Missing required extension, "${o}".`)}if(r.extensionsUsed)for(const o of r.extensionsUsed)n.extensions.find(a=>a.EXTENSION_NAME===o)||n.logger.warn(`Missing optional extension, "${o}".`)}}.read(e,{extensions:Array.from(this.h),dependencies:this.C,logger:this.v})}async binaryToJSON(e){const t=this._(tr.assertView(e));this.L(t);const n=t.json;if(n.buffers&&n.buffers.some(r=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)}(t,r)))throw new Error("Cannot resolve external buffers with binaryToJSON().");if(n.images&&n.images.some(r=>function(o,a){return a.uri!==void 0&&!(a.uri in o.resources)&&a.bufferView===void 0}(t,r)))throw new Error("Cannot resolve external images with binaryToJSON().");return t}async readBinary(e){return this.readJSON(await this.binaryToJSON(tr.assertView(e)))}async writeJSON(e,t={}){if(t.format===vc.GLB&&e.getRoot().listBuffers().length>1)throw new Error("GLB must have 01 buffers.");return class{static write(n,r){const o=n.getRoot(),a={asset:al({generator:"glTF-Transform v2.2.3"},o.getAsset()),extras:al({},o.getExtras())},u={json:a,resources:{}},p=new Ac(n,u,r),f=r.logger||Nl.DEFAULT_INSTANCE,m=new Set(r.extensions.map(k=>k.EXTENSION_NAME)),y=n.getRoot().listExtensionsUsed().filter(k=>m.has(k.extensionName)),S=n.getRoot().listExtensionsRequired().filter(k=>m.has(k.extensionName));y.length<n.getRoot().listExtensionsUsed().length&&f.debug("Some extensions were not registered for I/O, and will not be written.");for(const k of y)for(const L of k.writeDependencies)k.install(L,r.dependencies[L]);function M(k,L,R,W){const q=[];let J=0;for(const he of k){const xe=p.createAccessorDef(he);xe.bufferView=a.bufferViews.length;const De=he.getArray(),Fe=tr.pad(tr.toView(De));xe.byteOffset=J,J+=Fe.byteLength,q.push(Fe),p.accessorIndexMap.set(he,a.accessors.length),a.accessors.push(xe)}const ee={buffer:L,byteOffset:R,byteLength:tr.concat(q).byteLength};return W&&(ee.target=W),a.bufferViews.push(ee),{buffers:q,byteLength:J}}function P(k,L,R){const W=k[0].getCount();let q=0;for(const xe of k){const De=p.createAccessorDef(xe);De.bufferView=a.bufferViews.length,De.byteOffset=q;const Fe=xe.getElementSize(),ke=xe.getComponentSize();q+=tr.padNumber(Fe*ke),p.accessorIndexMap.set(xe,a.accessors.length),a.accessors.push(De)}const J=W*q,ee=new ArrayBuffer(J),he=new DataView(ee);for(let xe=0;xe<W;xe++){let De=0;for(const Fe of k){const ke=Fe.getElementSize(),Qe=Fe.getComponentSize(),Oe=Fe.getComponentType(),ze=Fe.getArray();for(let $e=0;$e<ke;$e++){const Ge=xe*q+De+$e*Qe,ot=ze[xe*ke+$e];switch(Oe){case Dn.ComponentType.FLOAT:he.setFloat32(Ge,ot,!0);break;case Dn.ComponentType.BYTE:he.setInt8(Ge,ot);break;case Dn.ComponentType.SHORT:he.setInt16(Ge,ot,!0);break;case Dn.ComponentType.UNSIGNED_BYTE:he.setUint8(Ge,ot);break;case Dn.ComponentType.UNSIGNED_SHORT:he.setUint16(Ge,ot,!0);break;case Dn.ComponentType.UNSIGNED_INT:he.setUint32(Ge,ot,!0);break;default:throw new Error("Unexpected component type: "+Oe)}}De+=tr.padNumber(ke*Qe)}}return a.bufferViews.push({buffer:L,byteOffset:R,byteLength:J,byteStride:q,target:Ac.BufferViewTarget.ARRAY_BUFFER}),{byteLength:J,buffers:[new Uint8Array(ee)]}}const D=new Map;for(const k of n.getGraph().listEdges()){if(k.getParent()===o)continue;const L=k.getChild();if(L instanceof Dn){const R=D.get(L)||[];R.push(k),D.set(L,R)}}if(a.accessors=[],a.bufferViews=[],a.samplers=[],a.textures=[],a.images=o.listTextures().map((k,L)=>{const R=p.createPropertyDef(k);k.getMimeType()&&(R.mimeType=k.getMimeType());const W=k.getImage();return W&&p.createImageData(R,W,k),p.imageIndexMap.set(k,L),R}),y.filter(k=>k.prewriteTypes.includes(hn.ACCESSOR)).forEach(k=>k.prewrite(p,hn.ACCESSOR)),o.listAccessors().forEach(k=>{const L=p.accessorUsageGroupedByParent,R=p.accessorParents;if(p.accessorIndexMap.has(k))return;const W=D.get(k)||[],q=p.getAccessorUsage(k);if(p.addAccessorToUsageGroup(k,q),L.has(q)){const J=W[0].getParent(),ee=R.get(J)||new Set;ee.add(k),R.set(J,ee)}}),y.filter(k=>k.prewriteTypes.includes(hn.BUFFER)).forEach(k=>k.prewrite(p,hn.BUFFER)),(o.listAccessors().length>0||o.listTextures().length>0||p.otherBufferViews.size>0)&&o.listBuffers().length===0)throw new Error("Buffer required for Document resources, but none was found.");a.buffers=[],o.listBuffers().forEach((k,L)=>{const R=p.createPropertyDef(k),W=p.accessorUsageGroupedByParent,q=p.accessorParents,J=k.listParents().filter(ke=>ke instanceof Dn),ee=new Set(J),he=[],xe=a.buffers.length;let De=0;const Fe=p.listAccessorUsageGroups();for(const ke in Fe)if(W.has(ke))for(const Qe of Array.from(q.values())){const Oe=Array.from(Qe).filter(ze=>ee.has(ze)).filter(ze=>p.getAccessorUsage(ze)===ke);if(Oe.length)if(ke!==Yw.ARRAY_BUFFER||r.vertexLayout===Ty.INTERLEAVED){const ze=ke===Yw.ARRAY_BUFFER?P(Oe,xe,De):M(Oe,xe,De);De+=ze.byteLength,he.push(...ze.buffers)}else for(const ze of Oe){const $e=P([ze],xe,De);De+=$e.byteLength,he.push(...$e.buffers)}}else{const Qe=Fe[ke].filter(ze=>ee.has(ze));if(!Qe.length)continue;const Oe=M(Qe,xe,De,ke===Yw.ELEMENT_ARRAY_BUFFER?Ac.BufferViewTarget.ELEMENT_ARRAY_BUFFER:void 0);De+=Oe.byteLength,he.push(...Oe.buffers)}if(p.imageBufferViews.length&&L===0){for(let ke=0;ke<p.imageBufferViews.length;ke++)if(a.bufferViews[a.images[ke].bufferView].byteOffset=De,De+=p.imageBufferViews[ke].byteLength,he.push(p.imageBufferViews[ke]),De%8){const Qe=8-De%8;De+=Qe,he.push(new Uint8Array(Qe))}}if(p.otherBufferViews.has(k))for(const ke of p.otherBufferViews.get(k))a.bufferViews.push({buffer:xe,byteOffset:De,byteLength:ke.byteLength}),p.otherBufferViewsIndexMap.set(ke,a.bufferViews.length-1),De+=ke.byteLength,he.push(ke);if(De){let ke;r.format===vc.GLB?ke="@glb.bin":(ke=p.bufferURIGenerator.createURI(k,"bin"),R.uri=ke),R.byteLength=De,u.resources[ke]=tr.concat(he)}a.buffers.push(R),p.bufferIndexMap.set(k,L)}),o.listAccessors().find(k=>!k.getBuffer())&&f.warn("Skipped writing one or more Accessors: no Buffer assigned."),a.materials=o.listMaterials().map((k,L)=>{const R=p.createPropertyDef(k);if(k.getAlphaMode()!==nm.AlphaMode.OPAQUE&&(R.alphaMode=k.getAlphaMode()),k.getAlphaMode()===nm.AlphaMode.MASK&&(R.alphaCutoff=k.getAlphaCutoff()),k.getDoubleSided()&&(R.doubleSided=!0),R.pbrMetallicRoughness={},ws.eq(k.getBaseColorFactor(),[1,1,1,1])||(R.pbrMetallicRoughness.baseColorFactor=k.getBaseColorFactor()),ws.eq(k.getEmissiveFactor(),[0,0,0])||(R.emissiveFactor=k.getEmissiveFactor()),k.getRoughnessFactor()!==1&&(R.pbrMetallicRoughness.roughnessFactor=k.getRoughnessFactor()),k.getMetallicFactor()!==1&&(R.pbrMetallicRoughness.metallicFactor=k.getMetallicFactor()),k.getBaseColorTexture()){const W=k.getBaseColorTexture(),q=k.getBaseColorTextureInfo();R.pbrMetallicRoughness.baseColorTexture=p.createTextureInfoDef(W,q)}if(k.getEmissiveTexture()){const W=k.getEmissiveTexture(),q=k.getEmissiveTextureInfo();R.emissiveTexture=p.createTextureInfoDef(W,q)}if(k.getNormalTexture()){const W=k.getNormalTexture(),q=k.getNormalTextureInfo(),J=p.createTextureInfoDef(W,q);k.getNormalScale()!==1&&(J.scale=k.getNormalScale()),R.normalTexture=J}if(k.getOcclusionTexture()){const W=k.getOcclusionTexture(),q=k.getOcclusionTextureInfo(),J=p.createTextureInfoDef(W,q);k.getOcclusionStrength()!==1&&(J.strength=k.getOcclusionStrength()),R.occlusionTexture=J}if(k.getMetallicRoughnessTexture()){const W=k.getMetallicRoughnessTexture(),q=k.getMetallicRoughnessTextureInfo();R.pbrMetallicRoughness.metallicRoughnessTexture=p.createTextureInfoDef(W,q)}return p.materialIndexMap.set(k,L),R}),a.meshes=o.listMeshes().map((k,L)=>{const R=p.createPropertyDef(k);let W=null;return R.primitives=k.listPrimitives().map(q=>{const J={attributes:{}};J.mode=q.getMode();const ee=q.getMaterial();ee&&(J.material=p.materialIndexMap.get(ee)),Object.keys(q.getExtras()).length&&(J.extras=q.getExtras());const he=q.getIndices();he&&(J.indices=p.accessorIndexMap.get(he));for(const xe of q.listSemantics())J.attributes[xe]=p.accessorIndexMap.get(q.getAttribute(xe));for(const xe of q.listTargets()){const De={};for(const Fe of xe.listSemantics())De[Fe]=p.accessorIndexMap.get(xe.getAttribute(Fe));J.targets=J.targets||[],J.targets.push(De)}return q.listTargets().length&&!W&&(W=q.listTargets().map(xe=>xe.getName())),J}),k.getWeights().length&&(R.weights=k.getWeights()),W&&(R.extras=R.extras||{},R.extras.targetNames=W),p.meshIndexMap.set(k,L),R}),a.cameras=o.listCameras().map((k,L)=>{const R=p.createPropertyDef(k);if(R.type=k.getType(),R.type===tm.Type.PERSPECTIVE){R.perspective={znear:k.getZNear(),zfar:k.getZFar(),yfov:k.getYFov()};const W=k.getAspectRatio();W!==null&&(R.perspective.aspectRatio=W)}else R.orthographic={znear:k.getZNear(),zfar:k.getZFar(),xmag:k.getXMag(),ymag:k.getYMag()};return p.cameraIndexMap.set(k,L),R}),a.nodes=o.listNodes().map((k,L)=>{const R=p.createPropertyDef(k);return ws.eq(k.getTranslation(),[0,0,0])||(R.translation=k.getTranslation()),ws.eq(k.getRotation(),[0,0,0,1])||(R.rotation=k.getRotation()),ws.eq(k.getScale(),[1,1,1])||(R.scale=k.getScale()),k.getWeights().length&&(R.weights=k.getWeights()),p.nodeIndexMap.set(k,L),R}),a.skins=o.listSkins().map((k,L)=>{const R=p.createPropertyDef(k),W=k.getInverseBindMatrices();W&&(R.inverseBindMatrices=p.accessorIndexMap.get(W));const q=k.getSkeleton();return q&&(R.skeleton=p.nodeIndexMap.get(q)),R.joints=k.listJoints().map(J=>p.nodeIndexMap.get(J)),p.skinIndexMap.set(k,L),R}),o.listNodes().forEach((k,L)=>{const R=a.nodes[L],W=k.getMesh();W&&(R.mesh=p.meshIndexMap.get(W));const q=k.getCamera();q&&(R.camera=p.cameraIndexMap.get(q));const J=k.getSkin();J&&(R.skin=p.skinIndexMap.get(J)),k.listChildren().length>0&&(R.children=k.listChildren().map(ee=>p.nodeIndexMap.get(ee)))}),a.animations=o.listAnimations().map((k,L)=>{const R=p.createPropertyDef(k),W=new Map;return R.samplers=k.listSamplers().map((q,J)=>{const ee=p.createPropertyDef(q);return ee.input=p.accessorIndexMap.get(q.getInput()),ee.output=p.accessorIndexMap.get(q.getOutput()),ee.interpolation=q.getInterpolation(),W.set(q,J),ee}),R.channels=k.listChannels().map(q=>{const J=p.createPropertyDef(q);return J.sampler=W.get(q.getSampler()),J.target={node:p.nodeIndexMap.get(q.getTargetNode()),path:q.getTargetPath()},J}),p.animationIndexMap.set(k,L),R}),a.scenes=o.listScenes().map((k,L)=>{const R=p.createPropertyDef(k);return R.nodes=k.listChildren().map(W=>p.nodeIndexMap.get(W)),p.sceneIndexMap.set(k,L),R});const j=o.getDefaultScene();return j&&(a.scene=o.listScenes().indexOf(j)),a.extensionsUsed=y.map(k=>k.extensionName),a.extensionsRequired=S.map(k=>k.extensionName),y.forEach(k=>k.write(p)),function(k){const L=[];for(const R in k){const W=k[R];(Array.isArray(W)&&W.length===0||W===null||W===""||W&&typeof W=="object"&&Object.keys(W).length===0)&&L.push(R)}for(const R of L)delete k[R]}(a),u}}.write(e,{format:t.format||vc.GLTF,basename:t.basename||"",logger:this.v,vertexLayout:this.F,dependencies:al({},this.C),extensions:Array.from(this.h)})}async writeBinary(e){const{json:t,resources:n}=await this.writeJSON(e,{format:vc.GLB}),r=new Uint32Array([1179937895,2,12]),o=JSON.stringify(t),a=tr.pad(tr.encodeText(o),32),u=tr.toView(new Uint32Array([a.byteLength,1313821514])),p=tr.concat([u,a]);r[r.length-1]+=p.byteLength;const f=Object.values(n)[0];if(!f||!f.byteLength)return tr.concat([tr.toView(r),p]);const m=tr.pad(f,0),y=tr.toView(new Uint32Array([m.byteLength,5130562])),S=tr.concat([y,m]);return r[r.length-1]+=S.byteLength,tr.concat([tr.toView(r),p,S])}detectFormat(e){return(yp.isAbsoluteURL(e)?yp.extension(e):em.extension(e))==="glb"?vc.GLB:vc.GLTF}async P(e){this.lastReadBytes=0;const t=await this.readURI(e,"text");this.lastReadBytes+=t.length;const n={json:JSON.parse(t),resources:{}};return await this.D(n,this.dirname(e)),this.L(n),n}async U(e){const t=await this.readURI(e,"view");this.lastReadBytes=t.byteLength;const n=this._(t);return await this.D(n,this.dirname(e)),this.L(n),n}async D(e,t){var n=this;const r=[...e.json.images||[],...e.json.buffers||[]].map(async function(o){const a=o.uri;if(!a||a.match(/data:/))return Promise.resolve();e.resources[a]=await n.readURI(n.resolve(t,a),"view"),n.lastReadBytes+=e.resources[a].byteLength});await Promise.all(r)}L(e){function t(n){if(n.uri){if(n.uri in e.resources)tr.assertView(e.resources[n.uri]);else if(n.uri.match(/data:/)){const r=`__${function(){for(let o=0;o<999;o++){const a=EM();if(!R1.has(a))return R1.add(a),a}return""}()}.${em.extension(n.uri)}`;e.resources[r]=tr.createBufferFromDataURI(n.uri),n.uri=r}}}(e.json.images||[]).forEach(n=>{if(n.bufferView===void 0&&n.uri===void 0)throw new Error("Missing resource URI or buffer view.");t(n)}),(e.json.buffers||[]).forEach(t)}j(e){const{images:t,buffers:n}=e.json;return e={json:al({},e.json),resources:al({},e.resources)},t&&(e.json.images=t.map(r=>al({},r))),n&&(e.json.buffers=n.map(r=>al({},r))),e}_(e){const t=new Uint32Array(e.buffer,e.byteOffset,3);if(t[0]!==1179937895)throw new Error("Invalid glTF asset.");if(t[1]!==2)throw new Error(`Unsupported glTF binary version, "${t[1]}".`);const n=new Uint32Array(e.buffer,e.byteOffset+12,2);if(n[1]!==Ly.JSON)throw new Error("Missing required GLB JSON chunk.");const r=n[0],o=tr.decodeText(tr.toView(e,20,r)),a=JSON.parse(o),u=20+r;if(e.byteLength<=u)return{json:a,resources:{}};const p=new Uint32Array(e.buffer,e.byteOffset+u,2);if(p[1]!==Ly.BIN)throw new Error("Expected GLB BIN in second chunk.");return{json:a,resources:{"@glb.bin":tr.toView(e,u+8,p[0])}}}}{constructor(e=yp.DEFAULT_INIT){super(),this.V=void 0,this.V=e}async readURI(e,t){const n=await fetch(e,this.V);switch(t){case"view":return new Uint8Array(await n.arrayBuffer());case"text":return n.text()}}resolve(e,t){return yp.resolve(e,t)}dirname(e){return yp.dirname(e)}detectFormat(e){return yp.extension(e)==="glb"?vc.GLB:vc.GLTF}}class PM{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class c0{constructor(e,t,n,r){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,n),this._littleEndian=r,this._offset=0}_nextUint8(){const e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){const e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){const e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){const e=this._dataView.getUint32(this._offset,this._littleEndian)+4294967296*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e}_nextInt32(){const e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_skip(e){return this._offset+=e,this}_scan(e,t=0){const n=this._offset;let r=0;for(;this._dataView.getUint8(this._offset)!==t&&r<e;)r++,this._offset++;return r<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+n,r)}}const Ba=[171,75,84,88,32,50,48,187,13,10,26,10];function V1(s){return typeof TextDecoder<"u"?new TextDecoder().decode(s):Buffer.from(s).toString("utf8")}function Xw(s){const e=new Uint8Array(s.buffer,s.byteOffset,Ba.length);if(e[0]!==Ba[0]||e[1]!==Ba[1]||e[2]!==Ba[2]||e[3]!==Ba[3]||e[4]!==Ba[4]||e[5]!==Ba[5]||e[6]!==Ba[6]||e[7]!==Ba[7]||e[8]!==Ba[8]||e[9]!==Ba[9]||e[10]!==Ba[10]||e[11]!==Ba[11])throw new Error("Missing KTX 2.0 identifier.");const t=new PM,n=17*Uint32Array.BYTES_PER_ELEMENT,r=new c0(s,Ba.length,n,!0);t.vkFormat=r._nextUint32(),t.typeSize=r._nextUint32(),t.pixelWidth=r._nextUint32(),t.pixelHeight=r._nextUint32(),t.pixelDepth=r._nextUint32(),t.layerCount=r._nextUint32(),t.faceCount=r._nextUint32();const o=r._nextUint32();t.supercompressionScheme=r._nextUint32();const a=r._nextUint32(),u=r._nextUint32(),p=r._nextUint32(),f=r._nextUint32(),m=r._nextUint64(),y=r._nextUint64(),S=new c0(s,Ba.length+n,3*o*8,!0);for(let Ge=0;Ge<o;Ge++)t.levels.push({levelData:new Uint8Array(s.buffer,s.byteOffset+S._nextUint64(),S._nextUint64()),uncompressedByteLength:S._nextUint64()});const M=new c0(s,a,u,!0),P={vendorId:M._skip(4)._nextUint16(),descriptorType:M._nextUint16(),versionNumber:M._nextUint16(),descriptorBlockSize:M._nextUint16(),colorModel:M._nextUint8(),colorPrimaries:M._nextUint8(),transferFunction:M._nextUint8(),flags:M._nextUint8(),texelBlockDimension:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],bytesPlane:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],samples:[]},D=(P.descriptorBlockSize/4-6)/4;for(let Ge=0;Ge<D;Ge++){const ot={bitOffset:M._nextUint16(),bitLength:M._nextUint8(),channelType:M._nextUint8(),samplePosition:[M._nextUint8(),M._nextUint8(),M._nextUint8(),M._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&ot.channelType?(ot.sampleLower=M._nextInt32(),ot.sampleUpper=M._nextInt32()):(ot.sampleLower=M._nextUint32(),ot.sampleUpper=M._nextUint32()),P.samples[Ge]=ot}t.dataFormatDescriptor.length=0,t.dataFormatDescriptor.push(P);const j=new c0(s,p,f,!0);for(;j._offset<f;){const Ge=j._nextUint32(),ot=j._scan(Ge),yt=V1(ot),Mt=j._scan(Ge-ot.byteLength);t.keyValue[yt]=yt.match(/^ktx/i)?V1(Mt):Mt,j._offset%4&&j._skip(4-j._offset%4)}if(y<=0)return t;const k=new c0(s,m,y,!0),L=k._nextUint16(),R=k._nextUint16(),W=k._nextUint32(),q=k._nextUint32(),J=k._nextUint32(),ee=k._nextUint32(),he=[];for(let Ge=0;Ge<o;Ge++)he.push({imageFlags:k._nextUint32(),rgbSliceByteOffset:k._nextUint32(),rgbSliceByteLength:k._nextUint32(),alphaSliceByteOffset:k._nextUint32(),alphaSliceByteLength:k._nextUint32()});const xe=m+k._offset,De=xe+W,Fe=De+q,ke=Fe+J,Qe=new Uint8Array(s.buffer,s.byteOffset+xe,W),Oe=new Uint8Array(s.buffer,s.byteOffset+De,q),ze=new Uint8Array(s.buffer,s.byteOffset+Fe,J),$e=new Uint8Array(s.buffer,s.byteOffset+ke,ee);return t.globalData={endpointCount:L,selectorCount:R,imageDescs:he,endpointsData:Qe,selectorsData:Oe,tablesData:ze,extendedData:$e},t}class G1 extends Fs{init(){this.extensionName="EXT_mesh_gpu_instancing",this.propertyType="InstancedMesh",this.parentTypes=[hn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{attributes:{}})}getAttribute(e){return this.getRefMap("attributes",e)}setAttribute(e,t){return this.setRefMap("attributes",e,t,{usage:"INSTANCE_ATTRIBUTE"})}listAttributes(){return this.listRefMapValues("attributes")}listSemantics(){return this.listRefMapKeys("attributes")}}G1.EXTENSION_NAME="EXT_mesh_gpu_instancing";const rm="EXT_mesh_gpu_instancing";function bp(){return(bp=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s}).apply(this,arguments)}var u0,i_,Us;(class extends ms{constructor(...s){super(...s),this.extensionName=rm,this.provideTypes=[hn.NODE],this.prewriteTypes=[hn.ACCESSOR]}createInstancedMesh(){return new G1(this.document.getGraph())}read(s){return(s.jsonDoc.json.nodes||[]).forEach((e,t)=>{if(!e.extensions||!e.extensions[rm])return;const n=e.extensions[rm],r=this.createInstancedMesh();for(const o in n.attributes)r.setAttribute(o,s.accessors[n.attributes[o]]);s.nodes[t].setExtension(rm,r)}),this}prewrite(s){s.accessorUsageGroupedByParent.add("INSTANCE_ATTRIBUTE");for(const e of this.properties)for(const t of e.listAttributes())s.addAccessorToUsageGroup(t,"INSTANCE_ATTRIBUTE");return this}write(s){const e=s.jsonDoc;return this.document.getRoot().listNodes().forEach(t=>{const n=t.getExtension(rm);if(n){const r=s.nodeIndexMap.get(t),o=e.json.nodes[r],a={attributes:{}};n.listSemantics().forEach(u=>{const p=n.getAttribute(u);a.attributes[u]=s.accessorIndexMap.get(p)}),o.extensions=o.extensions||{},o.extensions[rm]=a}}),this}}).EXTENSION_NAME=rm,function(s){s.QUANTIZE="quantize",s.FILTER="filter"}(u0||(u0={})),function(s){s.ATTRIBUTES="ATTRIBUTES",s.TRIANGLES="TRIANGLES",s.INDICES="INDICES"}(i_||(i_={})),function(s){s.NONE="NONE",s.OCTAHEDRAL="OCTAHEDRAL",s.QUATERNION="QUATERNION",s.EXPONENTIAL="EXPONENTIAL"}(Us||(Us={}));const{BYTE:DM,SHORT:Q1,FLOAT:RM}=Dn.ComponentType,{normalize:H1,denormalize:Kw}=ws;function BM(s,e,t,n){const{filter:r,bits:o}=n,a={array:s.getArray(),byteStride:s.getElementSize()*s.getComponentSize(),componentType:s.getComponentType(),normalized:s.getNormalized()};if(t!==i_.ATTRIBUTES)return a;if(r!==Us.NONE){let u=s.getNormalized()?function(p){const f=p.getComponentType(),m=p.getArray(),y=new Float32Array(m.length);for(let S=0;S<m.length;S++)y[S]=Kw(m[S],f);return y}(s):new Float32Array(a.array);switch(r){case Us.EXPONENTIAL:a.byteStride=4*s.getElementSize(),a.componentType=RM,a.normalized=!1,a.array=e.encodeFilterExp(u,s.getCount(),a.byteStride,o);break;case Us.OCTAHEDRAL:a.byteStride=o>8?8:4,a.componentType=o>8?Q1:DM,a.normalized=!0,u=s.getElementSize()===3?function(p){const f=new Float32Array(4*p.length/3);for(let m=0,y=p.length/3;m<y;m++)f[4*m]=p[3*m],f[4*m+1]=p[3*m+1],f[4*m+2]=p[3*m+2];return f}(u):u,a.array=e.encodeFilterOct(u,s.getCount(),a.byteStride,o);break;case Us.QUATERNION:a.byteStride=8,a.componentType=Q1,a.normalized=!0,a.array=e.encodeFilterQuat(u,s.getCount(),a.byteStride,o);break;default:throw new Error("Invalid filter.")}a.min=s.getMin([]),a.max=s.getMax([]),s.getNormalized()&&(a.min=a.min.map(p=>Kw(p,s.getComponentType())),a.max=a.max.map(p=>Kw(p,s.getComponentType()))),a.normalized&&(a.min=a.min.map(p=>H1(p,a.componentType)),a.max=a.max.map(p=>H1(p,a.componentType)))}else a.byteStride%4&&(a.array=function(u,p){const f=tr.padNumber(u.BYTES_PER_ELEMENT*p)/u.BYTES_PER_ELEMENT,m=new u.constructor(u.length/p*f);for(let y=0;y*p<u.length;y++)for(let S=0;S<p;S++)m[y*f+S]=u[y*p+S];return m}(a.array,s.getElementSize()),a.byteStride=a.array.byteLength/s.getCount());return a}function kM(s,e){return e===Ac.BufferViewUsage.ELEMENT_ARRAY_BUFFER?s.listParents().some(t=>t instanceof im&&t.getMode()===im.Mode.TRIANGLES)?i_.TRIANGLES:i_.INDICES:i_.ATTRIBUTES}function OM(s,e){const t=e.getGraph().listParentEdges(s).filter(n=>!(n.getParent()instanceof U1));for(const n of t){const r=n.getName(),o=n.getAttributes().key||"";if(r==="indices")return{filter:Us.NONE};if(r==="attributes"){if(o==="POSITION")return{filter:Us.NONE};if(o==="TEXCOORD_0")return{filter:Us.NONE};if(o==="NORMAL")return{filter:Us.OCTAHEDRAL,bits:8};if(o==="TANGENT")return{filter:Us.OCTAHEDRAL,bits:8};if(o.startsWith("JOINTS_"))return{filter:Us.NONE};if(o.startsWith("WEIGHTS_"))return{filter:Us.NONE}}if(r==="output"){const a=W1(s);return a==="rotation"?{filter:Us.QUATERNION,bits:16}:a==="translation"||a==="scale"?{filter:Us.EXPONENTIAL,bits:12}:{filter:Us.NONE}}if(r==="input")return{filter:Us.NONE};if(r==="inverseBindMatrices")return{filter:Us.NONE}}return{filter:Us.NONE}}function W1(s){for(const e of s.listParents())if(e instanceof n_){for(const t of e.listParents())if(t instanceof Hw)return t.getTargetPath()}return null}const ka="EXT_meshopt_compression",q1={method:u0.QUANTIZE};class Y1 extends ms{constructor(...e){super(...e),this.extensionName=ka,this.prereadTypes=[hn.BUFFER,hn.PRIMITIVE],this.prewriteTypes=[hn.BUFFER,hn.ACCESSOR],this.readDependencies=["meshopt.decoder"],this.writeDependencies=["meshopt.encoder"],this._decoder=null,this._decoderFallbackBufferMap=new Map,this._encoder=null,this._encoderOptions=q1,this._encoderFallbackBuffer=null,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={}}install(e,t){return e==="meshopt.decoder"&&(this._decoder=t),e==="meshopt.encoder"&&(this._encoder=t),this}setEncoderOptions(e){return this._encoderOptions=bp({},q1,e),this}preread(e,t){if(!this._decoder){if(!this.isRequired())return this;throw new Error(`[${ka}] Please install extension dependency, "meshopt.decoder".`)}if(!this._decoder.supported){if(!this.isRequired())return this;throw new Error(`[${ka}]: Missing WASM support.`)}return t===hn.BUFFER?this._prereadBuffers(e):t===hn.PRIMITIVE&&this._prereadPrimitives(e),this}_prereadBuffers(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach((n,r)=>{if(!n.extensions||!n.extensions[ka])return;const o=n.extensions[ka],a=o.byteOffset||0,u=o.byteLength||0,p=o.count,f=o.byteStride,m=new Uint8Array(p*f),y=t.json.buffers[n.buffer],S=tr.toView(y.uri?t.resources[y.uri]:t.resources["@glb.bin"],a,u);this._decoder.decodeGltfBuffer(m,p,f,S,o.mode,o.filter),e.bufferViews[r]=m})}_prereadPrimitives(e){const t=e.jsonDoc;(t.json.bufferViews||[]).forEach(n=>{var r;n.extensions&&n.extensions[ka]&&(r=t.json.buffers[n.buffer]).extensions&&r.extensions.EXT_meshopt_compression&&r.extensions.EXT_meshopt_compression.fallback&&this._decoderFallbackBufferMap.set(e.buffers[n.buffer],e.buffers[n.extensions[ka].buffer])})}read(e){if(!this.isRequired())return this;for(const[t,n]of this._decoderFallbackBufferMap){for(const r of t.listParents())r instanceof Dn&&r.swap(t,n);t.dispose()}return this}prewrite(e,t){return t===hn.ACCESSOR?this._prewriteAccessors(e):t===hn.BUFFER&&this._prewriteBuffers(e),this}_prewriteAccessors(e){const t=e.jsonDoc.json,n=this._encoder,r=this._encoderOptions,o=this.document.createBuffer(),a=this.document.getRoot().listBuffers().indexOf(o);this._encoderFallbackBuffer=o,this._encoderBufferViews={},this._encoderBufferViewData={},this._encoderBufferViewAccessors={};for(const u of this.document.getRoot().listAccessors()){if(W1(u)==="weights")continue;const p=e.getAccessorUsage(u),f=kM(u,p),m=r.method===u0.FILTER?OM(u,this.document):{filter:Us.NONE},y=BM(u,n,f,m),{array:S,byteStride:M}=y,P=u.getBuffer();if(!P)throw new Error(`${ka}: Missing buffer for accessor.`);const D=this.document.getRoot().listBuffers().indexOf(P),j=[p,f,m.filter,M,D].join(":");let k=this._encoderBufferViews[j],L=this._encoderBufferViewData[j],R=this._encoderBufferViewAccessors[j];k&&L||(R=this._encoderBufferViewAccessors[j]=[],L=this._encoderBufferViewData[j]=[],k=this._encoderBufferViews[j]={buffer:a,target:Ac.USAGE_TO_TARGET[p],byteOffset:0,byteLength:0,byteStride:p===Ac.BufferViewUsage.ARRAY_BUFFER?M:void 0,extensions:{[ka]:{buffer:D,byteOffset:0,byteLength:0,mode:f,filter:m.filter!==Us.NONE?m.filter:void 0,byteStride:M,count:0}}});const W=e.createAccessorDef(u);W.componentType=y.componentType,W.normalized=y.normalized,W.byteOffset=k.byteLength,W.min&&y.min&&(W.min=y.min),W.max&&y.max&&(W.max=y.max),e.accessorIndexMap.set(u,t.accessors.length),t.accessors.push(W),R.push(W),L.push(new Uint8Array(S.buffer,S.byteOffset,S.byteLength)),k.byteLength+=S.byteLength,k.extensions.EXT_meshopt_compression.count+=u.getCount()}}_prewriteBuffers(e){const t=this._encoder;for(const n in this._encoderBufferViews){const r=this._encoderBufferViews[n],o=this._encoderBufferViewData[n],a=this.document.getRoot().listBuffers()[r.extensions[ka].buffer],u=e.otherBufferViews.get(a)||[],{count:p,byteStride:f,mode:m}=r.extensions[ka],y=tr.concat(o),S=t.encodeGltfBuffer(y,p,f,m),M=tr.pad(S);r.extensions[ka].byteLength=S.byteLength,o.length=0,o.push(M),u.push(M),e.otherBufferViews.set(a,u)}}write(e){let t=0;for(const a in this._encoderBufferViews){const u=this._encoderBufferViews[a],p=e.otherBufferViewsIndexMap.get(this._encoderBufferViewData[a][0]),f=this._encoderBufferViewAccessors[a];for(const S of f)S.bufferView=p;const m=e.jsonDoc.json.bufferViews[p],y=m.byteOffset||0;Object.assign(m,u),m.byteOffset=t,m.extensions[ka].byteOffset=y,t+=tr.padNumber(u.byteLength)}const n=this._encoderFallbackBuffer,r=e.bufferIndexMap.get(n),o=e.jsonDoc.json.buffers[r];return o.byteLength=t,o.extensions={[ka]:{fallback:!0}},n.dispose(),this}}Y1.EXTENSION_NAME=ka,Y1.EncoderMethod=u0;const X1="EXT_texture_webp";class LM{match(e){return e.length>=12&&e[8]===87&&e[9]===69&&e[10]===66&&e[11]===80}getSize(e){const t=tr.decodeText(e.slice(0,4)),n=tr.decodeText(e.slice(8,12));if(t!=="RIFF"||n!=="WEBP")return null;const r=new DataView(e.buffer,e.byteOffset);let o=12;for(;o<r.byteLength;){const a=tr.decodeText(new Uint8Array([r.getUint8(o),r.getUint8(o+1),r.getUint8(o+2),r.getUint8(o+3)])),u=r.getUint32(o+4,!0);if(a==="VP8 ")return[16383&r.getInt16(o+14,!0),16383&r.getInt16(o+16,!0)];if(a==="VP8L"){const p=r.getUint8(o+9),f=r.getUint8(o+10),m=r.getUint8(o+11);return[1+((63&f)<<8|p),1+((15&r.getUint8(o+12))<<10|m<<2|(192&f)>>6)]}o+=8+u+u%2}return null}getChannels(e){return 4}}(class extends ms{constructor(...s){super(...s),this.extensionName=X1,this.prereadTypes=[hn.TEXTURE]}static register(){ad.registerFormat("image/webp",new LM)}preread(s){return(s.jsonDoc.json.textures||[]).forEach(e=>{e.extensions&&e.extensions.EXT_texture_webp&&(e.source=e.extensions.EXT_texture_webp.source)}),this}read(s){return this}write(s){const e=s.jsonDoc;return this.document.getRoot().listTextures().forEach(t=>{if(t.getMimeType()==="image/webp"){const n=s.imageIndexMap.get(t);(e.json.textures||[]).forEach(r=>{r.source===n&&(r.extensions=r.extensions||{},r.extensions.EXT_texture_webp={source:r.source},delete r.source)})}}),this}}).EXTENSION_NAME=X1;const K1="KHR_draco_mesh_compression";let po,J1,$1,ll;function NM(s,e){const t=new po.DecoderBuffer;try{if(t.Init(e,e.length),s.GetEncodedGeometryType(t)!==po.TRIANGULAR_MESH)throw new Error(`[${K1}] Unknown geometry type.`);const n=new po.Mesh;if(!s.DecodeBufferToMesh(t,n).ok()||n.ptr===0)throw new Error(`[${K1}] Decoding failure.`);return n}finally{po.destroy(t)}}function FM(s,e){const t=3*e.num_faces();let n,r;if(e.num_points()<=65534){const o=t*Uint16Array.BYTES_PER_ELEMENT;n=po._malloc(o),s.GetTrianglesUInt16Array(e,o,n),r=new Uint16Array(po.HEAPU16.buffer,n,t).slice()}else{const o=t*Uint32Array.BYTES_PER_ELEMENT;n=po._malloc(o),s.GetTrianglesUInt32Array(e,o,n),r=new Uint32Array(po.HEAPU32.buffer,n,t).slice()}return po._free(n),r}function UM(s,e,t,n){const r=$1[n.componentType],o=J1[n.componentType],a=t.num_components(),u=e.num_points()*a,p=u*o.BYTES_PER_ELEMENT,f=po._malloc(p);s.GetAttributeDataArrayForAllPoints(e,t,r,p,f);const m=new o(po.HEAPF32.buffer,f,u).slice();return po._free(f),m}var h0,yc;(function(s){s[s.EDGEBREAKER=1]="EDGEBREAKER",s[s.SEQUENTIAL=0]="SEQUENTIAL"})(h0||(h0={})),function(s){s.POSITION="POSITION",s.NORMAL="NORMAL",s.COLOR="COLOR",s.TEX_COORD="TEX_COORD",s.GENERIC="GENERIC"}(yc||(yc={}));const Z1={[yc.POSITION]:14,[yc.NORMAL]:10,[yc.COLOR]:8,[yc.TEX_COORD]:12,[yc.GENERIC]:12},eE={decodeSpeed:5,encodeSpeed:5,method:h0.EDGEBREAKER,quantizationBits:Z1,quantizationVolume:"mesh"};function jM(s,e=eE){const t=bp({},eE,e);t.quantizationBits=bp({},Z1,e.quantizationBits);const n=new ll.Encoder,r=new ll.MeshBuilder,o=new ll.Mesh,a={},u=new ll.DracoInt8Array;for(const P of s.listSemantics()){const D=s.getAttribute(P),j=zM(P),k=VM(r,D.getComponentType(),o,ll[j],D.getCount(),D.getElementSize(),D.getArray());if(k===-1)throw new Error(`Error compressing "${P}" attribute.`);if(a[P]=k,t.quantizationVolume==="mesh"||P!=="POSITION")n.SetAttributeQuantization(ll[j],t.quantizationBits[j]);else{if(typeof t.quantizationVolume!="object")throw new Error("Invalid quantization volume state.");{const{quantizationVolume:L}=t,R=Math.max(L.max[0]-L.min[0],L.max[1]-L.min[1],L.max[2]-L.min[2]);n.SetAttributeExplicitQuantization(ll[j],t.quantizationBits[j],D.getElementSize(),L.min,R)}}}const p=s.getIndices();if(!p)throw new Error("Primitive must have indices.");r.AddFacesToMesh(o,p.getCount()/3,p.getArray()),n.SetSpeedOptions(t.encodeSpeed,t.decodeSpeed),n.SetTrackEncodedProperties(!0),t.method===h0.SEQUENTIAL||s.listTargets().length>0?n.SetEncodingMethod(ll.MESH_SEQUENTIAL_ENCODING):n.SetEncodingMethod(ll.MESH_EDGEBREAKER_ENCODING);const f=n.EncodeMeshToDracoBuffer(o,u);if(f<=0)throw new Error("Error applying Draco compression.");const m=new Uint8Array(f);for(let P=0;P<f;++P)m[P]=u.GetValue(P);const y=s.getAttribute("POSITION").getCount(),S=n.GetNumberOfEncodedPoints(),M=3*n.GetNumberOfEncodedFaces();if(s.listTargets().length>0&&S!==y)throw new Error('Compression reduced vertex count unexpectedly, corrupting morph targets. Applying the "weld" function before compression may resolve the issue.');return ll.destroy(u),ll.destroy(o),ll.destroy(r),ll.destroy(n),{numVertices:S,numIndices:M,data:m,attributeIDs:a}}function zM(s){return s==="POSITION"?yc.POSITION:s==="NORMAL"?yc.NORMAL:s.startsWith("COLOR_")?yc.COLOR:s.startsWith("TEXCOORD_")?yc.TEX_COORD:yc.GENERIC}function VM(s,e,t,n,r,o,a){switch(e){case Dn.ComponentType.UNSIGNED_BYTE:return s.AddUInt8Attribute(t,n,r,o,a);case Dn.ComponentType.BYTE:return s.AddInt8Attribute(t,n,r,o,a);case Dn.ComponentType.UNSIGNED_SHORT:return s.AddUInt16Attribute(t,n,r,o,a);case Dn.ComponentType.SHORT:return s.AddInt16Attribute(t,n,r,o,a);case Dn.ComponentType.UNSIGNED_INT:return s.AddUInt32Attribute(t,n,r,o,a);case Dn.ComponentType.FLOAT:return s.AddFloatAttribute(t,n,r,o,a);default:throw new Error(`Unexpected component type, "${e}".`)}}const to="KHR_draco_mesh_compression";class d0 extends ms{constructor(...e){super(...e),this.extensionName=to,this.prereadTypes=[hn.PRIMITIVE],this.prewriteTypes=[hn.ACCESSOR],this.readDependencies=["draco3d.decoder"],this.writeDependencies=["draco3d.encoder"],this._decoderModule=null,this._encoderModule=null,this._encoderOptions={}}install(e,t){return e==="draco3d.decoder"&&(this._decoderModule=t,po=this._decoderModule,J1={[Dn.ComponentType.FLOAT]:Float32Array,[Dn.ComponentType.UNSIGNED_INT]:Uint32Array,[Dn.ComponentType.UNSIGNED_SHORT]:Uint16Array,[Dn.ComponentType.UNSIGNED_BYTE]:Uint8Array,[Dn.ComponentType.SHORT]:Int16Array,[Dn.ComponentType.BYTE]:Int8Array},$1={[Dn.ComponentType.FLOAT]:po.DT_FLOAT32,[Dn.ComponentType.UNSIGNED_INT]:po.DT_UINT32,[Dn.ComponentType.UNSIGNED_SHORT]:po.DT_UINT16,[Dn.ComponentType.UNSIGNED_BYTE]:po.DT_UINT8,[Dn.ComponentType.SHORT]:po.DT_INT16,[Dn.ComponentType.BYTE]:po.DT_INT8}),e==="draco3d.encoder"&&(this._encoderModule=t,ll=this._encoderModule),this}setEncoderOptions(e){return this._encoderOptions=e,this}preread(e){if(!this._decoderModule)throw new Error(`[${to}] Please install extension dependency, "draco3d.decoder".`);const t=this.document.getLogger(),n=e.jsonDoc,r=new Map;try{const o=n.json.meshes||[];for(const a of o)for(const u of a.primitives){if(!u.extensions||!u.extensions[to])continue;const p=u.extensions[to];let[f,m]=r.get(p.bufferView)||[];if(!m||!f){const y=n.json.bufferViews[p.bufferView],S=n.json.buffers[y.buffer],M=tr.toView(S.uri?n.resources[S.uri]:n.resources["@glb.bin"],y.byteOffset||0,y.byteLength);f=new this._decoderModule.Decoder,m=NM(f,M),r.set(p.bufferView,[f,m]),t.debug(`[${to}] Decompressed ${M.byteLength} bytes.`)}for(const y in u.attributes){const S=e.jsonDoc.json.accessors[u.attributes[y]],M=f.GetAttributeByUniqueId(m,p.attributes[y]),P=UM(f,m,M,S);e.accessors[u.attributes[y]].setArray(P)}u.indices!==void 0&&e.accessors[u.indices].setArray(FM(f,m))}}finally{for(const[o,a]of Array.from(r.values()))this._decoderModule.destroy(o),this._decoderModule.destroy(a)}return this}read(e){return this}prewrite(e,t){if(!this._encoderModule)throw new Error(`[${to}] Please install extension dependency, "draco3d.encoder".`);const n=this.document.getLogger();n.debug(`[${to}] Compression options: ${JSON.stringify(this._encoderOptions)}`);const r=function(u){const p=u.getLogger(),f=new Set,m=new Set;for(const j of u.getRoot().listMeshes())for(const k of j.listPrimitives())k.getIndices()?k.getMode()!==im.Mode.TRIANGLES?(m.add(k),p.warn(`[${to}] Skipping Draco compression on non-TRIANGLES primitive.`)):f.add(k):(m.add(k),p.warn(`[${to}] Skipping Draco compression on non-indexed primitive.`));const y=u.getRoot().listAccessors(),S=new Map;for(let j=0;j<y.length;j++)S.set(y[j],j);const M=new Map,P=new Set,D=new Map;for(const j of Array.from(f)){let k=tE(j,S);if(P.has(k))D.set(j,k);else{if(M.has(j.getIndices())){const L=j.getIndices(),R=L.clone();S.set(R,u.getRoot().listAccessors().length-1),j.swap(L,R)}for(const L of j.listAttributes())if(M.has(L)){const R=L.clone();S.set(R,u.getRoot().listAccessors().length-1),j.swap(L,R)}k=tE(j,S),P.add(k),D.set(j,k),M.set(j.getIndices(),k);for(const L of j.listAttributes())M.set(L,k)}}for(const j of Array.from(M.keys())){const k=new Set(j.listParents().map(L=>L.propertyType));if(k.size!==2||!k.has(hn.PRIMITIVE)||!k.has(hn.ROOT))throw new Error(`[${to}] Compressed accessors must only be used as indices or vertex attributes.`)}for(const j of Array.from(f)){const k=D.get(j),L=j.getIndices();if(M.get(L)!==k||j.listAttributes().some(R=>M.get(R)!==k))throw new Error(`[${to}] Draco primitives must share all, or no, accessors.`)}for(const j of Array.from(m)){const k=j.getIndices();if(M.has(k)||j.listAttributes().some(L=>M.has(L)))throw new Error(`[${to}] Accessor cannot be shared by compressed and uncompressed primitives.`)}return D}(this.document),o=new Map;let a="mesh";this._encoderOptions.quantizationVolume==="scene"&&(this.document.getRoot().listScenes().length!==1?n.warn(`[${to}]: quantizationVolume=scene requires exactly 1 scene.`):a=function(u){const p={min:[1/0,1/0,1/0],max:[-1/0,-1/0,-1/0]},f=u.propertyType===hn.NODE?[u]:u.listChildren();for(const m of f)m.traverse(y=>{const S=y.getMesh();if(!S)return;const M=AM(S,y.getWorldMatrix());Gw(M.min,p),Gw(M.max,p)});return p}(this.document.getRoot().listScenes().pop()));for(const u of Array.from(r.keys())){const p=r.get(u);if(!p)throw new Error("Unexpected primitive.");if(o.has(p)){o.set(p,o.get(p));continue}const f=u.getIndices(),m=e.jsonDoc.json.accessors,y=jM(u,bp({},this._encoderOptions,{quantizationVolume:a}));o.set(p,y);const S=e.createAccessorDef(f);S.count=y.numIndices,e.accessorIndexMap.set(f,m.length),m.push(S);for(const P of u.listSemantics()){const D=u.getAttribute(P),j=e.createAccessorDef(D);j.count=y.numVertices,e.accessorIndexMap.set(D,m.length),m.push(j)}const M=u.getAttribute("POSITION").getBuffer()||this.document.getRoot().listBuffers()[0];e.otherBufferViews.has(M)||e.otherBufferViews.set(M,[]),e.otherBufferViews.get(M).push(y.data)}return n.debug(`[${to}] Compressed ${r.size} primitives.`),e.extensionData[to]={primitiveHashMap:r,primitiveEncodingMap:o},this}write(e){const t=e.extensionData[to];for(const n of this.document.getRoot().listMeshes()){const r=e.jsonDoc.json.meshes[e.meshIndexMap.get(n)];for(let o=0;o<n.listPrimitives().length;o++){const a=n.listPrimitives()[o],u=r.primitives[o],p=t.primitiveHashMap.get(a);if(!p)continue;const f=t.primitiveEncodingMap.get(p);u.extensions=u.extensions||{},u.extensions[to]={bufferView:e.otherBufferViewsIndexMap.get(f.data),attributes:f.attributeIDs}}}if(!t.primitiveHashMap.size){const n=e.jsonDoc.json;n.extensionsUsed=(n.extensionsUsed||[]).filter(r=>r!==to),n.extensionsRequired=(n.extensionsRequired||[]).filter(r=>r!==to)}return this}}function tE(s,e){const t=[],n=s.getIndices();t.push(e.get(n));for(const r of s.listAttributes())t.push(e.get(r));return t.sort().join("|")}d0.EXTENSION_NAME=to,d0.EncoderMethod=h0;class r_ extends Fs{init(){this.extensionName="KHR_lights_punctual",this.propertyType="Light",this.parentTypes=[hn.NODE]}getDefaults(){return Object.assign(super.getDefaults(),{color:[1,1,1],intensity:1,type:r_.Type.POINT,range:null,innerConeAngle:0,outerConeAngle:Math.PI/4})}getColor(){return this.get("color")}setColor(e){return this.set("color",e)}getColorHex(){return ol.factorToHex(this.getColor())}setColorHex(e){const t=this.getColor().slice();return ol.hexToFactor(e,t),this.setColor(t)}getIntensity(){return this.get("intensity")}setIntensity(e){return this.set("intensity",e)}getType(){return this.get("type")}setType(e){return this.set("type",e)}getRange(){return this.get("range")}setRange(e){return this.set("range",e)}getInnerConeAngle(){return this.get("innerConeAngle")}setInnerConeAngle(e){return this.set("innerConeAngle",e)}getOuterConeAngle(){return this.get("outerConeAngle")}setOuterConeAngle(e){return this.set("outerConeAngle",e)}}r_.EXTENSION_NAME="KHR_lights_punctual",r_.Type={POINT:"point",SPOT:"spot",DIRECTIONAL:"directional"};const Ny="KHR_lights_punctual";class nE extends ms{constructor(...e){super(...e),this.extensionName=Ny}createLight(e=""){return new r_(this.document.getGraph(),e)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions.KHR_lights_punctual)return this;const n=(t.json.extensions.KHR_lights_punctual.lights||[]).map(r=>{var o,a;const u=this.createLight().setName(r.name||"").setType(r.type);return r.color!==void 0&&u.setColor(r.color),r.intensity!==void 0&&u.setIntensity(r.intensity),r.range!==void 0&&u.setRange(r.range),((o=r.spot)==null?void 0:o.innerConeAngle)!==void 0&&u.setInnerConeAngle(r.spot.innerConeAngle),((a=r.spot)==null?void 0:a.outerConeAngle)!==void 0&&u.setOuterConeAngle(r.spot.outerConeAngle),u});return t.json.nodes.forEach((r,o)=>{r.extensions&&r.extensions.KHR_lights_punctual&&e.nodes[o].setExtension(Ny,n[r.extensions.KHR_lights_punctual.light])}),this}write(e){const t=e.jsonDoc;if(this.properties.size===0)return this;const n=[],r=new Map;for(const o of this.properties){const a=o,u={type:a.getType()};ws.eq(a.getColor(),[1,1,1])||(u.color=a.getColor()),a.getIntensity()!==1&&(u.intensity=a.getIntensity()),a.getRange()!=null&&(u.range=a.getRange()),a.getName()&&(u.name=a.getName()),a.getType()===r_.Type.SPOT&&(u.spot={innerConeAngle:a.getInnerConeAngle(),outerConeAngle:a.getOuterConeAngle()}),n.push(u),r.set(a,n.length-1)}return this.document.getRoot().listNodes().forEach(o=>{const a=o.getExtension(Ny);if(a){const u=e.nodeIndexMap.get(o),p=t.json.nodes[u];p.extensions=p.extensions||{},p.extensions.KHR_lights_punctual={light:r.get(a)}}}),t.json.extensions=t.json.extensions||{},t.json.extensions.KHR_lights_punctual={lights:n},this}}nE.EXTENSION_NAME=Ny;const{R:iE,G:rE,B:GM}=Ns;class sE extends Fs{init(){this.extensionName="KHR_materials_clearcoat",this.propertyType="Clearcoat",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{clearcoatFactor:0,clearcoatTexture:null,clearcoatTextureInfo:new as(this.graph,"clearcoatTextureInfo"),clearcoatRoughnessFactor:0,clearcoatRoughnessTexture:null,clearcoatRoughnessTextureInfo:new as(this.graph,"clearcoatRoughnessTextureInfo"),clearcoatNormalScale:1,clearcoatNormalTexture:null,clearcoatNormalTextureInfo:new as(this.graph,"clearcoatNormalTextureInfo")})}getClearcoatFactor(){return this.get("clearcoatFactor")}setClearcoatFactor(e){return this.set("clearcoatFactor",e)}getClearcoatTexture(){return this.getRef("clearcoatTexture")}getClearcoatTextureInfo(){return this.getRef("clearcoatTexture")?this.getRef("clearcoatTextureInfo"):null}setClearcoatTexture(e){return this.setRef("clearcoatTexture",e,{channels:iE})}getClearcoatRoughnessFactor(){return this.get("clearcoatRoughnessFactor")}setClearcoatRoughnessFactor(e){return this.set("clearcoatRoughnessFactor",e)}getClearcoatRoughnessTexture(){return this.getRef("clearcoatRoughnessTexture")}getClearcoatRoughnessTextureInfo(){return this.getRef("clearcoatRoughnessTexture")?this.getRef("clearcoatRoughnessTextureInfo"):null}setClearcoatRoughnessTexture(e){return this.setRef("clearcoatRoughnessTexture",e,{channels:rE})}getClearcoatNormalScale(){return this.get("clearcoatNormalScale")}setClearcoatNormalScale(e){return this.set("clearcoatNormalScale",e)}getClearcoatNormalTexture(){return this.getRef("clearcoatNormalTexture")}getClearcoatNormalTextureInfo(){return this.getRef("clearcoatNormalTexture")?this.getRef("clearcoatNormalTextureInfo"):null}setClearcoatNormalTexture(e){return this.setRef("clearcoatNormalTexture",e,{channels:iE|rE|GM})}}sE.EXTENSION_NAME="KHR_materials_clearcoat";const sm="KHR_materials_clearcoat";class oE extends ms{constructor(...e){super(...e),this.extensionName=sm}createClearcoat(){return new sE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[sm]){const a=this.createClearcoat();e.materials[o].setExtension(sm,a);const u=r.extensions[sm];if(u.clearcoatFactor!==void 0&&a.setClearcoatFactor(u.clearcoatFactor),u.clearcoatRoughnessFactor!==void 0&&a.setClearcoatRoughnessFactor(u.clearcoatRoughnessFactor),u.clearcoatTexture!==void 0){const p=u.clearcoatTexture;a.setClearcoatTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getClearcoatTextureInfo(),p)}if(u.clearcoatRoughnessTexture!==void 0){const p=u.clearcoatRoughnessTexture;a.setClearcoatRoughnessTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getClearcoatRoughnessTextureInfo(),p)}if(u.clearcoatNormalTexture!==void 0){const p=u.clearcoatNormalTexture;a.setClearcoatNormalTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getClearcoatNormalTextureInfo(),p),p.scale!==void 0&&a.setClearcoatNormalScale(p.scale)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(sm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions[sm]={clearcoatFactor:r.getClearcoatFactor(),clearcoatRoughnessFactor:r.getClearcoatRoughnessFactor()};if(r.getClearcoatTexture()){const p=r.getClearcoatTexture(),f=r.getClearcoatTextureInfo();u.clearcoatTexture=e.createTextureInfoDef(p,f)}if(r.getClearcoatRoughnessTexture()){const p=r.getClearcoatRoughnessTexture(),f=r.getClearcoatRoughnessTextureInfo();u.clearcoatRoughnessTexture=e.createTextureInfoDef(p,f)}if(r.getClearcoatNormalTexture()){const p=r.getClearcoatNormalTexture(),f=r.getClearcoatNormalTextureInfo();u.clearcoatNormalTexture=e.createTextureInfoDef(p,f),r.getClearcoatNormalScale()!==1&&(u.clearcoatNormalTexture.scale=r.getClearcoatNormalScale())}}}),this}}oE.EXTENSION_NAME=sm;class aE extends Fs{init(){this.extensionName="KHR_materials_emissive_strength",this.propertyType="EmissiveStrength",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{emissiveStrength:1})}getEmissiveStrength(){return this.get("emissiveStrength")}setEmissiveStrength(e){return this.set("emissiveStrength",e)}}aE.EXTENSION_NAME="KHR_materials_emissive_strength";const om="KHR_materials_emissive_strength";class lE extends ms{constructor(...e){super(...e),this.extensionName=om}createEmissiveStrength(){return new aE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions[om]){const r=this.createEmissiveStrength();e.materials[n].setExtension(om,r);const o=t.extensions[om];o.emissiveStrength!==void 0&&r.setEmissiveStrength(o.emissiveStrength)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(om);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions[om]={emissiveStrength:r.getEmissiveStrength()}}}),this}}lE.EXTENSION_NAME=om;class cE extends Fs{init(){this.extensionName="KHR_materials_ior",this.propertyType="IOR",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{ior:0})}getIOR(){return this.get("ior")}setIOR(e){return this.set("ior",e)}}cE.EXTENSION_NAME="KHR_materials_ior";const Fy="KHR_materials_ior";class uE extends ms{constructor(...e){super(...e),this.extensionName=Fy}createIOR(){return new cE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{if(t.extensions&&t.extensions.KHR_materials_ior){const r=this.createIOR();e.materials[n].setExtension(Fy,r);const o=t.extensions.KHR_materials_ior;o.ior!==void 0&&r.setIOR(o.ior)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Fy);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{},a.extensions.KHR_materials_ior={ior:r.getIOR()}}}),this}}uE.EXTENSION_NAME=Fy;const{R:QM,G:HM}=Ns;class hE extends Fs{init(){this.extensionName="KHR_materials_iridescence",this.propertyType="Iridescence",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{iridescenceFactor:0,iridescenceTexture:null,iridescenceTextureInfo:new as(this.graph,"iridescenceTextureInfo"),iridescenceIOR:1.3,iridescenceThicknessMinimum:100,iridescenceThicknessMaximum:400,iridescenceThicknessTexture:null,iridescenceThicknessTextureInfo:new as(this.graph,"iridescenceThicknessTextureInfo")})}getIridescenceFactor(){return this.get("iridescenceFactor")}setIridescenceFactor(e){return this.set("iridescenceFactor",e)}getIridescenceTexture(){return this.getRef("iridescenceTexture")}getIridescenceTextureInfo(){return this.getRef("iridescenceTexture")?this.getRef("iridescenceTextureInfo"):null}setIridescenceTexture(e){return this.setRef("iridescenceTexture",e,{channels:QM})}getIridescenceIOR(){return this.get("iridescenceIOR")}setIridescenceIOR(e){return this.set("iridescenceIOR",e)}getIridescenceThicknessMinimum(){return this.get("iridescenceThicknessMinimum")}setIridescenceThicknessMinimum(e){return this.set("iridescenceThicknessMinimum",e)}getIridescenceThicknessMaximum(){return this.get("iridescenceThicknessMaximum")}setIridescenceThicknessMaximum(e){return this.set("iridescenceThicknessMaximum",e)}getIridescenceThicknessTexture(){return this.getRef("iridescenceThicknessTexture")}getIridescenceThicknessTextureInfo(){return this.getRef("iridescenceThicknessTexture")?this.getRef("iridescenceThicknessTextureInfo"):null}setIridescenceThicknessTexture(e){return this.setRef("iridescenceThicknessTexture",e,{channels:HM})}}hE.EXTENSION_NAME="KHR_materials_iridescence";const am="KHR_materials_iridescence";class dE extends ms{constructor(...e){super(...e),this.extensionName=am}createIridescence(){return new hE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[am]){const a=this.createIridescence();e.materials[o].setExtension(am,a);const u=r.extensions[am];if(u.iridescenceFactor!==void 0&&a.setIridescenceFactor(u.iridescenceFactor),u.iridescenceIor!==void 0&&a.setIridescenceIOR(u.iridescenceIor),u.iridescenceThicknessMinimum!==void 0&&a.setIridescenceThicknessMinimum(u.iridescenceThicknessMinimum),u.iridescenceThicknessMaximum!==void 0&&a.setIridescenceThicknessMaximum(u.iridescenceThicknessMaximum),u.iridescenceTexture!==void 0){const p=u.iridescenceTexture;a.setIridescenceTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getIridescenceTextureInfo(),p)}if(u.iridescenceThicknessTexture!==void 0){const p=u.iridescenceThicknessTexture;a.setIridescenceThicknessTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getIridescenceThicknessTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(am);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions[am]={};if(r.getIridescenceFactor()>0&&(u.iridescenceFactor=r.getIridescenceFactor()),r.getIridescenceIOR()!==1.3&&(u.iridescenceIor=r.getIridescenceIOR()),r.getIridescenceThicknessMinimum()!==100&&(u.iridescenceThicknessMinimum=r.getIridescenceThicknessMinimum()),r.getIridescenceThicknessMaximum()!==400&&(u.iridescenceThicknessMaximum=r.getIridescenceThicknessMaximum()),r.getIridescenceTexture()){const p=r.getIridescenceTexture(),f=r.getIridescenceTextureInfo();u.iridescenceTexture=e.createTextureInfoDef(p,f)}if(r.getIridescenceThicknessTexture()){const p=r.getIridescenceThicknessTexture(),f=r.getIridescenceThicknessTextureInfo();u.iridescenceThicknessTexture=e.createTextureInfoDef(p,f)}}}),this}}dE.EXTENSION_NAME=am;const{R:pE,G:fE,B:mE,A:gE}=Ns;class _E extends Fs{init(){this.extensionName="KHR_materials_pbrSpecularGlossiness",this.propertyType="PBRSpecularGlossiness",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{diffuseFactor:[1,1,1,1],diffuseTexture:null,diffuseTextureInfo:new as(this.graph,"diffuseTextureInfo"),specularFactor:[1,1,1],glossinessFactor:1,specularGlossinessTexture:null,specularGlossinessTextureInfo:new as(this.graph,"specularGlossinessTextureInfo")})}getDiffuseFactor(){return this.get("diffuseFactor")}setDiffuseFactor(e){return this.set("diffuseFactor",e)}getDiffuseHex(){return ol.factorToHex(this.getDiffuseFactor())}setDiffuseHex(e){const t=this.getDiffuseFactor().slice();return this.setDiffuseFactor(ol.hexToFactor(e,t))}getDiffuseTexture(){return this.getRef("diffuseTexture")}getDiffuseTextureInfo(){return this.getRef("diffuseTexture")?this.getRef("diffuseTextureInfo"):null}setDiffuseTexture(e){return this.setRef("diffuseTexture",e,{channels:pE|fE|mE|gE})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getGlossinessFactor(){return this.get("glossinessFactor")}setGlossinessFactor(e){return this.set("glossinessFactor",e)}getSpecularGlossinessTexture(){return this.getRef("specularGlossinessTexture")}getSpecularGlossinessTextureInfo(){return this.getRef("specularGlossinessTexture")?this.getRef("specularGlossinessTextureInfo"):null}setSpecularGlossinessTexture(e){return this.setRef("specularGlossinessTexture",e,{channels:pE|fE|mE|gE})}}_E.EXTENSION_NAME="KHR_materials_pbrSpecularGlossiness";const lm="KHR_materials_pbrSpecularGlossiness";class vE extends ms{constructor(...e){super(...e),this.extensionName=lm}createPBRSpecularGlossiness(){return new _E(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[lm]){const a=this.createPBRSpecularGlossiness();e.materials[o].setExtension(lm,a);const u=r.extensions[lm];if(u.diffuseFactor!==void 0&&a.setDiffuseFactor(u.diffuseFactor),u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.glossinessFactor!==void 0&&a.setGlossinessFactor(u.glossinessFactor),u.diffuseTexture!==void 0){const p=u.diffuseTexture;a.setDiffuseTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getDiffuseTextureInfo(),p)}if(u.specularGlossinessTexture!==void 0){const p=u.specularGlossinessTexture;a.setSpecularGlossinessTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getSpecularGlossinessTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(lm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions[lm]={diffuseFactor:r.getDiffuseFactor(),specularFactor:r.getSpecularFactor(),glossinessFactor:r.getGlossinessFactor()};if(r.getDiffuseTexture()){const p=r.getDiffuseTexture(),f=r.getDiffuseTextureInfo();u.diffuseTexture=e.createTextureInfoDef(p,f)}if(r.getSpecularGlossinessTexture()){const p=r.getSpecularGlossinessTexture(),f=r.getSpecularGlossinessTextureInfo();u.specularGlossinessTexture=e.createTextureInfoDef(p,f)}}}),this}}vE.EXTENSION_NAME=lm;const{R:WM,G:qM,B:YM,A:XM}=Ns;class AE extends Fs{init(){this.extensionName="KHR_materials_sheen",this.propertyType="Sheen",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{sheenColorFactor:[0,0,0],sheenColorTexture:null,sheenColorTextureInfo:new as(this.graph,"sheenColorTextureInfo"),sheenRoughnessFactor:0,sheenRoughnessTexture:null,sheenRoughnessTextureInfo:new as(this.graph,"sheenRoughnessTextureInfo")})}getSheenColorFactor(){return this.get("sheenColorFactor")}getSheenColorHex(){return ol.factorToHex(this.getSheenColorFactor())}setSheenColorFactor(e){return this.set("sheenColorFactor",e)}setSheenColorHex(e){const t=this.getSheenColorFactor().slice();return this.set("sheenColorFactor",ol.hexToFactor(e,t))}getSheenColorTexture(){return this.getRef("sheenColorTexture")}getSheenColorTextureInfo(){return this.getRef("sheenColorTexture")?this.getRef("sheenColorTextureInfo"):null}setSheenColorTexture(e){return this.setRef("sheenColorTexture",e,{channels:WM|qM|YM})}getSheenRoughnessFactor(){return this.get("sheenRoughnessFactor")}setSheenRoughnessFactor(e){return this.set("sheenRoughnessFactor",e)}getSheenRoughnessTexture(){return this.getRef("sheenRoughnessTexture")}getSheenRoughnessTextureInfo(){return this.getRef("sheenRoughnessTexture")?this.getRef("sheenRoughnessTextureInfo"):null}setSheenRoughnessTexture(e){return this.setRef("sheenRoughnessTexture",e,{channels:XM})}}AE.EXTENSION_NAME="KHR_materials_sheen";const Uy="KHR_materials_sheen";class yE extends ms{constructor(...e){super(...e),this.extensionName=Uy}createSheen(){return new AE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions.KHR_materials_sheen){const a=this.createSheen();e.materials[o].setExtension(Uy,a);const u=r.extensions.KHR_materials_sheen;if(u.sheenColorFactor!==void 0&&a.setSheenColorFactor(u.sheenColorFactor),u.sheenRoughnessFactor!==void 0&&a.setSheenRoughnessFactor(u.sheenRoughnessFactor),u.sheenColorTexture!==void 0){const p=u.sheenColorTexture;a.setSheenColorTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getSheenColorTextureInfo(),p)}if(u.sheenRoughnessTexture!==void 0){const p=u.sheenRoughnessTexture;a.setSheenRoughnessTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getSheenRoughnessTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(Uy);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions.KHR_materials_sheen={sheenColorFactor:r.getSheenColorFactor(),sheenRoughnessFactor:r.getSheenRoughnessFactor()};if(r.getSheenColorTexture()){const p=r.getSheenColorTexture(),f=r.getSheenColorTextureInfo();u.sheenColorTexture=e.createTextureInfoDef(p,f)}if(r.getSheenRoughnessTexture()){const p=r.getSheenRoughnessTexture(),f=r.getSheenRoughnessTextureInfo();u.sheenRoughnessTexture=e.createTextureInfoDef(p,f)}}}),this}}yE.EXTENSION_NAME=Uy;const{R:KM,G:JM,B:$M,A:ZM}=Ns;class bE extends Fs{init(){this.extensionName="KHR_materials_specular",this.propertyType="Specular",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{specularFactor:1,specularTexture:null,specularTextureInfo:new as(this.graph,"specularTextureInfo"),specularColorFactor:[1,1,1],specularColorTexture:null,specularColorTextureInfo:new as(this.graph,"specularColorTextureInfo")})}getSpecularFactor(){return this.get("specularFactor")}setSpecularFactor(e){return this.set("specularFactor",e)}getSpecularColorFactor(){return this.get("specularColorFactor")}setSpecularColorFactor(e){return this.set("specularColorFactor",e)}getSpecularColorHex(){return ol.factorToHex(this.getSpecularColorFactor())}setSpecularColorHex(e){const t=this.getSpecularColorFactor().slice();return this.set("specularColorFactor",ol.hexToFactor(e,t))}getSpecularTexture(){return this.getRef("specularTexture")}getSpecularTextureInfo(){return this.getRef("specularTexture")?this.getRef("specularTextureInfo"):null}setSpecularTexture(e){return this.setRef("specularTexture",e,{channels:ZM})}getSpecularColorTexture(){return this.getRef("specularColorTexture")}getSpecularColorTextureInfo(){return this.getRef("specularColorTexture")?this.getRef("specularColorTextureInfo"):null}setSpecularColorTexture(e){return this.setRef("specularColorTexture",e,{channels:KM|JM|$M})}}bE.EXTENSION_NAME="KHR_materials_specular";const cm="KHR_materials_specular";class wE extends ms{constructor(...e){super(...e),this.extensionName=cm}createSpecular(){return new bE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[cm]){const a=this.createSpecular();e.materials[o].setExtension(cm,a);const u=r.extensions[cm];if(u.specularFactor!==void 0&&a.setSpecularFactor(u.specularFactor),u.specularColorFactor!==void 0&&a.setSpecularColorFactor(u.specularColorFactor),u.specularTexture!==void 0){const p=u.specularTexture;a.setSpecularTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getSpecularTextureInfo(),p)}if(u.specularColorTexture!==void 0){const p=u.specularColorTexture;a.setSpecularColorTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getSpecularColorTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(cm);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions[cm]={};if(r.getSpecularFactor()!==1&&(u.specularFactor=r.getSpecularFactor()),ws.eq(r.getSpecularColorFactor(),[1,1,1])||(u.specularColorFactor=r.getSpecularColorFactor()),r.getSpecularTexture()){const p=r.getSpecularTexture(),f=r.getSpecularTextureInfo();u.specularTexture=e.createTextureInfoDef(p,f)}if(r.getSpecularColorTexture()){const p=r.getSpecularColorTexture(),f=r.getSpecularColorTextureInfo();u.specularColorTexture=e.createTextureInfoDef(p,f)}}}),this}}wE.EXTENSION_NAME=cm;const{R:eT}=Ns;class xE extends Fs{init(){this.extensionName="KHR_materials_transmission",this.propertyType="Transmission",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{transmissionFactor:0,transmissionTexture:null,transmissionTextureInfo:new as(this.graph,"transmissionTextureInfo")})}getTransmissionFactor(){return this.get("transmissionFactor")}setTransmissionFactor(e){return this.set("transmissionFactor",e)}getTransmissionTexture(){return this.getRef("transmissionTexture")}getTransmissionTextureInfo(){return this.getRef("transmissionTexture")?this.getRef("transmissionTextureInfo"):null}setTransmissionTexture(e){return this.setRef("transmissionTexture",e,{channels:eT})}}xE.EXTENSION_NAME="KHR_materials_transmission";const um="KHR_materials_transmission";class EE extends ms{constructor(...e){super(...e),this.extensionName=um}createTransmission(){return new xE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions[um]){const a=this.createTransmission();e.materials[o].setExtension(um,a);const u=r.extensions[um];if(u.transmissionFactor!==void 0&&a.setTransmissionFactor(u.transmissionFactor),u.transmissionTexture!==void 0){const p=u.transmissionTexture;a.setTransmissionTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getTransmissionTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(um);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions[um]={transmissionFactor:r.getTransmissionFactor()};if(r.getTransmissionTexture()){const p=r.getTransmissionTexture(),f=r.getTransmissionTextureInfo();u.transmissionTexture=e.createTextureInfoDef(p,f)}}}),this}}EE.EXTENSION_NAME=um;class SE extends Fs{init(){this.extensionName="KHR_materials_unlit",this.propertyType="Unlit",this.parentTypes=[hn.MATERIAL]}}SE.EXTENSION_NAME="KHR_materials_unlit";const jy="KHR_materials_unlit";class CE extends ms{constructor(...e){super(...e),this.extensionName=jy}createUnlit(){return new SE(this.document.getGraph())}read(e){return(e.jsonDoc.json.materials||[]).forEach((t,n)=>{t.extensions&&t.extensions.KHR_materials_unlit&&e.materials[n].setExtension(jy,this.createUnlit())}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{if(n.getExtension(jy)){const r=e.materialIndexMap.get(n),o=t.json.materials[r];o.extensions=o.extensions||{},o.extensions.KHR_materials_unlit={}}}),this}}CE.EXTENSION_NAME=jy;class ME extends Fs{init(){this.extensionName="KHR_materials_variants",this.propertyType="Mapping",this.parentTypes=["MappingList"]}getDefaults(){return Object.assign(super.getDefaults(),{material:null,variants:[]})}getMaterial(){return this.getRef("material")}setMaterial(e){return this.setRef("material",e)}addVariant(e){return this.addRef("variants",e)}removeVariant(e){return this.removeRef("variants",e)}listVariants(){return this.listRefs("variants")}}ME.EXTENSION_NAME="KHR_materials_variants";class TE extends Fs{init(){this.extensionName="KHR_materials_variants",this.propertyType="MappingList",this.parentTypes=[hn.PRIMITIVE]}getDefaults(){return Object.assign(super.getDefaults(),{mappings:[]})}addMapping(e){return this.addRef("mappings",e)}removeMapping(e){return this.removeRef("mappings",e)}listMappings(){return this.listRefs("mappings")}}TE.EXTENSION_NAME="KHR_materials_variants";class Jw extends Fs{init(){this.extensionName="KHR_materials_variants",this.propertyType="Variant",this.parentTypes=["MappingList"]}}Jw.EXTENSION_NAME="KHR_materials_variants";const hh="KHR_materials_variants";class IE extends ms{constructor(...e){super(...e),this.extensionName=hh}createMappingList(){return new TE(this.document.getGraph())}createVariant(e=""){return new Jw(this.document.getGraph(),e)}createMapping(){return new ME(this.document.getGraph())}listVariants(){return Array.from(this.properties).filter(e=>e instanceof Jw)}read(e){const t=e.jsonDoc;if(!t.json.extensions||!t.json.extensions[hh])return this;const n=(t.json.extensions[hh].variants||[]).map(r=>this.createVariant().setName(r.name||""));return(t.json.meshes||[]).forEach((r,o)=>{const a=e.meshes[o];(r.primitives||[]).forEach((u,p)=>{if(!u.extensions||!u.extensions[hh])return;const f=this.createMappingList(),m=u.extensions[hh];for(const y of m.mappings){const S=this.createMapping();y.material!==void 0&&S.setMaterial(e.materials[y.material]);for(const M of y.variants||[])S.addVariant(n[M]);f.addMapping(S)}a.listPrimitives()[p].setExtension(hh,f)})}),this}write(e){const t=e.jsonDoc,n=this.listVariants();if(!n.length)return this;const r=[],o=new Map;for(const a of n)o.set(a,r.length),r.push(e.createPropertyDef(a));for(const a of this.document.getRoot().listMeshes()){const u=e.meshIndexMap.get(a);a.listPrimitives().forEach((p,f)=>{const m=p.getExtension(hh);if(!m)return;const y=e.jsonDoc.json.meshes[u].primitives[f],S=m.listMappings().map(M=>{const P=e.createPropertyDef(M),D=M.getMaterial();return D&&(P.material=e.materialIndexMap.get(D)),P.variants=M.listVariants().map(j=>o.get(j)),P});y.extensions=y.extensions||{},y.extensions[hh]={mappings:S}})}return t.json.extensions=t.json.extensions||{},t.json.extensions[hh]={variants:r},this}}IE.EXTENSION_NAME=hh;const{G:tT}=Ns;class PE extends Fs{init(){this.extensionName="KHR_materials_volume",this.propertyType="Volume",this.parentTypes=[hn.MATERIAL]}getDefaults(){return Object.assign(super.getDefaults(),{thicknessFactor:0,thicknessTexture:null,thicknessTextureInfo:new as(this.graph,"thicknessTexture"),attenuationDistance:1/0,attenuationColor:[1,1,1]})}getThicknessFactor(){return this.get("thicknessFactor")}setThicknessFactor(e){return this.set("thicknessFactor",e)}getThicknessTexture(){return this.getRef("thicknessTexture")}getThicknessTextureInfo(){return this.getRef("thicknessTexture")?this.getRef("thicknessTextureInfo"):null}setThicknessTexture(e){return this.setRef("thicknessTexture",e,{channels:tT})}getAttenuationDistance(){return this.get("attenuationDistance")}setAttenuationDistance(e){return this.set("attenuationDistance",e)}getAttenuationColor(){return this.get("attenuationColor")}setAttenuationColor(e){return this.set("attenuationColor",e)}getAttenuationColorHex(){return ol.factorToHex(this.getAttenuationColor())}setAttenuationColorHex(e){const t=this.getAttenuationColor().slice();return this.set("attenuationColor",ol.hexToFactor(e,t))}}PE.EXTENSION_NAME="KHR_materials_volume";const zy="KHR_materials_volume";class DE extends ms{constructor(...e){super(...e),this.extensionName=zy}createVolume(){return new PE(this.document.getGraph())}read(e){const t=e.jsonDoc,n=t.json.textures||[];return(t.json.materials||[]).forEach((r,o)=>{if(r.extensions&&r.extensions.KHR_materials_volume){const a=this.createVolume();e.materials[o].setExtension(zy,a);const u=r.extensions.KHR_materials_volume;if(u.thicknessFactor!==void 0&&a.setThicknessFactor(u.thicknessFactor),u.attenuationDistance!==void 0&&a.setAttenuationDistance(u.attenuationDistance),u.attenuationColor!==void 0&&a.setAttenuationColor(u.attenuationColor),u.thicknessTexture!==void 0){const p=u.thicknessTexture;a.setThicknessTexture(e.textures[n[p.index].source]),e.setTextureInfo(a.getThicknessTextureInfo(),p)}}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(zy);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u=a.extensions.KHR_materials_volume={};if(r.getThicknessFactor()>0&&(u.thicknessFactor=r.getThicknessFactor()),Number.isFinite(r.getAttenuationDistance())&&(u.attenuationDistance=r.getAttenuationDistance()),ws.eq(r.getAttenuationColor(),[1,1,1])||(u.attenuationColor=r.getAttenuationColor()),r.getThicknessTexture()){const p=r.getThicknessTexture(),f=r.getThicknessTextureInfo();u.thicknessTexture=e.createTextureInfoDef(p,f)}}}),this}}DE.EXTENSION_NAME=zy;const RE="KHR_mesh_quantization";class BE extends ms{constructor(...e){super(...e),this.extensionName=RE}read(e){return this}write(e){return this}}BE.EXTENSION_NAME=RE;const kE="KHR_texture_basisu";class nT{match(e){return e[0]===171&&e[1]===75&&e[2]===84&&e[3]===88&&e[4]===32&&e[5]===50&&e[6]===48&&e[7]===187&&e[8]===13&&e[9]===10&&e[10]===26&&e[11]===10}getSize(e){const t=Xw(e);return[t.pixelWidth,t.pixelHeight]}getChannels(e){const t=Xw(e).dataFormatDescriptor[0];if(t.colorModel===163)return t.samples.length===2&&(15&t.samples[1].channelType)==15?4:3;if(t.colorModel===166)return(15&t.samples[0].channelType)==3?4:3;throw new Error(`Unexpected KTX2 colorModel, "${t.colorModel}".`)}getGPUByteLength(e){const t=Xw(e),n=this.getChannels(e)>3;let r=0;for(let o=0;o<t.levels.length;o++){const a=t.levels[o];r+=a.uncompressedByteLength?a.uncompressedByteLength:Math.max(1,Math.floor(t.pixelWidth/Math.pow(2,o)))/4*(Math.max(1,Math.floor(t.pixelHeight/Math.pow(2,o)))/4)*(n?16:8)}return r}}class OE extends ms{constructor(...e){super(...e),this.extensionName=kE,this.prereadTypes=[hn.TEXTURE]}static register(){ad.registerFormat("image/ktx2",new nT)}preread(e){return e.jsonDoc.json.textures.forEach(t=>{t.extensions&&t.extensions.KHR_texture_basisu&&(t.source=t.extensions.KHR_texture_basisu.source)}),this}read(e){return this}write(e){const t=e.jsonDoc;return this.document.getRoot().listTextures().forEach(n=>{if(n.getMimeType()==="image/ktx2"){const r=e.imageIndexMap.get(n);t.json.textures.forEach(o=>{o.source===r&&(o.extensions=o.extensions||{},o.extensions.KHR_texture_basisu={source:o.source},delete o.source)})}}),this}}OE.EXTENSION_NAME=kE;class LE extends Fs{init(){this.extensionName="KHR_texture_transform",this.propertyType="Transform",this.parentTypes=[hn.TEXTURE_INFO]}getDefaults(){return Object.assign(super.getDefaults(),{offset:[0,0],rotation:0,scale:[1,1],texCoord:null})}getOffset(){return this.get("offset")}setOffset(e){return this.set("offset",e)}getRotation(){return this.get("rotation")}setRotation(e){return this.set("rotation",e)}getScale(){return this.get("scale")}setScale(e){return this.set("scale",e)}getTexCoord(){return this.get("texCoord")}setTexCoord(e){return this.set("texCoord",e)}}LE.EXTENSION_NAME="KHR_texture_transform";const Vy="KHR_texture_transform";class NE extends ms{constructor(...e){super(...e),this.extensionName=Vy}createTransform(){return new LE(this.document.getGraph())}read(e){for(const[t,n]of Array.from(e.textureInfos.entries())){if(!n.extensions||!n.extensions.KHR_texture_transform)continue;const r=this.createTransform(),o=n.extensions.KHR_texture_transform;o.offset!==void 0&&r.setOffset(o.offset),o.rotation!==void 0&&r.setRotation(o.rotation),o.scale!==void 0&&r.setScale(o.scale),o.texCoord!==void 0&&r.setTexCoord(o.texCoord),t.setExtension(Vy,r)}return this}write(e){const t=Array.from(e.textureInfoDefMap.entries());for(const[n,r]of t){const o=n.getExtension(Vy);if(!o)continue;r.extensions=r.extensions||{};const a={},u=ws.eq;u(o.getOffset(),[0,0])||(a.offset=o.getOffset()),o.getRotation()!==0&&(a.rotation=o.getRotation()),u(o.getScale(),[1,1])||(a.scale=o.getScale()),o.getTexCoord()!=null&&(a.texCoord=o.getTexCoord()),r.extensions.KHR_texture_transform=a}return this}}NE.EXTENSION_NAME=Vy;const iT=[hn.ROOT,hn.SCENE,hn.NODE,hn.MESH,hn.MATERIAL,hn.TEXTURE,hn.ANIMATION];class FE extends Fs{init(){this.extensionName="KHR_xmp_json_ld",this.propertyType="Packet",this.parentTypes=iT}getDefaults(){return Object.assign(super.getDefaults(),{context:{},properties:{}})}getContext(){return this.get("context")}setContext(e){return this.set("context",bp({},e))}listProperties(){return Object.keys(this.get("properties"))}getProperty(e){const t=this.get("properties");return e in t?t[e]:null}setProperty(e,t){this._assertContext(e);const n=bp({},this.get("properties"));return t?n[e]=t:delete n[e],this.set("properties",n)}toJSONLD(){return bp({"@context":$w(this.get("context"))},$w(this.get("properties")))}fromJSONLD(e){const t=(e=$w(e))["@context"];return t&&this.set("context",t),delete e["@context"],this.set("properties",e)}_assertContext(e){if(!(e.split(":")[0]in this.get("context")))throw new Error(`KHR_xmp_json_ld: Missing context for term, "${e}".`)}}function $w(s){return JSON.parse(JSON.stringify(s))}FE.EXTENSION_NAME="KHR_xmp_json_ld";const Zw="KHR_xmp_json_ld";class UE extends ms{constructor(...e){super(...e),this.extensionName=Zw}createPacket(){return new FE(this.document.getGraph())}listPackets(){return Array.from(this.properties)}read(e){var t;const n=(t=e.jsonDoc.json.extensions)==null?void 0:t.KHR_xmp_json_ld;if(!n||!n.packets)return this;const r=e.jsonDoc.json,o=this.document.getRoot(),a=n.packets.map(f=>this.createPacket().fromJSONLD(f)),u=[[r.asset],r.scenes,r.nodes,r.meshes,r.materials,r.images,r.animations],p=[[o],o.listScenes(),o.listNodes(),o.listMeshes(),o.listMaterials(),o.listTextures(),o.listAnimations()];for(let f=0;f<u.length;f++){const m=u[f]||[];for(let y=0;y<m.length;y++){const S=m[y];S.extensions&&S.extensions.KHR_xmp_json_ld&&p[f][y].setExtension(Zw,a[S.extensions.KHR_xmp_json_ld.packet])}}return this}write(e){const{json:t}=e.jsonDoc,n=[];for(const r of this.properties){n.push(r.toJSONLD());for(const o of r.listParents()){let a;switch(o.propertyType){case hn.ROOT:a=t.asset;break;case hn.SCENE:a=t.scenes[e.sceneIndexMap.get(o)];break;case hn.NODE:a=t.nodes[e.nodeIndexMap.get(o)];break;case hn.MESH:a=t.meshes[e.meshIndexMap.get(o)];break;case hn.MATERIAL:a=t.materials[e.materialIndexMap.get(o)];break;case hn.TEXTURE:a=t.images[e.imageIndexMap.get(o)];break;case hn.ANIMATION:a=t.animations[e.animationIndexMap.get(o)];break;default:a=null,this.document.getLogger().warn(`[KHR_xmp_json_ld]: Unsupported parent property, "${o.propertyType}"`)}a&&(a.extensions=a.extensions||{},a.extensions.KHR_xmp_json_ld={packet:n.length-1})}}return n.length>0&&(t.extensions=t.extensions||{},t.extensions.KHR_xmp_json_ld={packets:n}),this}}UE.EXTENSION_NAME=Zw;const rT=[d0,nE,oE,lE,uE,dE,vE,wE,yE,EE,CE,IE,DE,BE,OE,NE,UE];let ex=class extends or{constructor(s,e,t){super(s,e,t??new sT,new Sn(0,0,0),1),this.enabled=!0,this._firstCall=!0}render(s,e,t,n,r){this.enabled&&super.render(s,e,t,n,r)}};ex=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Ci("High precision Normal Buffer")],ex);class sT extends c.RSm{constructor(){super()}onBeforeRender(e,t,n,r,o){var a,u;let p=o.material;Array.isArray(p)&&(p=p[0]),this.normalMap=(a=p==null?void 0:p.normalMap)!==null&&a!==void 0?a:null,this.needsUpdate=!0,this.side=(u=p.side)!==null&&u!==void 0?u:c.ehD}}class s_ extends xl{constructor(e=!0){super(),this.passId="normalBuffer",this._beforeFilters=["render"],this._afterFilters=[],this._requiredFilters=["render"],this.enabled=e}passCtor(e){this._normalTarget=e.renderer.createTarget({depthBuffer:!0,type:c.cLu,minFilter:c.TyD,magFilter:c.TyD,generateMipmaps:!1}),this._normalTarget.texture.name="normalBuffer",this._normalTarget.texture.generateMipmaps=!1;const t=this._normalTarget,n=new Set,r=new Set;return new class extends ex{render(o,a,u,p,f){const m=o.getRenderTarget(),y=o.getActiveCubeFace(),S=o.getActiveMipmapLevel();this.scene&&(this.scene.traverse(({material:M})=>{M&&((M.transparent&&M.userData.renderToDepth||!M.transparent&&M.transmission===0&&M.userData.renderToDepth===!1)&&(n.add(M),M.transparent=!M.transparent),Math.abs(M.transmission||0)>0&&M.userData.renderToDepth&&(r.add([M,M.transmission]),M.transmission=0))}),qt(o,{shadowMapRender:!1,backgroundRender:!1,opaqueRender:!0,transparentRender:!1,transmissionRender:!1,mainRenderPass:!1},()=>super.render(o,a,t,p,f)),n.forEach(M=>M.transparent=!M.transparent),n.clear(),r.forEach(([M,P])=>M.transmission=P),r.clear(),o.setRenderTarget(m,y,S))}}}_update(e){if(!super._update(e))return!1;const t=this.pass.passObject;return t.scene=e.scene.modelObject,t.camera=e.scene.activeCamera.cameraObject,!0}getNormalBuffer(){return this._normalTarget}async onDispose(e){}async onRemove(e){var t,n;return e.renderer.disposeTarget((n=(t=this._normalTarget)===null||t===void 0?void 0:t.dispose)===null||n===void 0?void 0:n.call(t)),super.onRemove(e)}updateShaderProperties(e){var t,n;return e.uniforms.tNormalBuffer?e.uniforms.tNormalBuffer.value=this.enabled&&(n=(t=this.getNormalBuffer())===null||t===void 0?void 0:t.texture)!==null&&n!==void 0?n:null:console.warn("BaseRenderer: no uniform: tNormalBuffer"),this}get uiConfig(){var e;return(e=this.pass)===null||e===void 0?void 0:e.passObject.uiConfig}}s_.PluginType="NormalBufferPlugin";function jE(s){const e=s==null?void 0:s.userData;if(!e)return!1;e._ssBevel||(e._ssBevel={});const t=e._ssBevel;return t.hasSSBevel=!0,t.radius===void 0&&(t.radius=0),s.isMaterial&&(s.needsUpdate=!0),!0}let tx=class extends _s{constructor(s,e,t,n){super({defines:{NUM_SAMPLES:16},uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},edgeMaskBuffer:{value:null},screenSize:{value:new c.FM8},radius:{value:1},samples:{value:null},frameCount:{value:0},cameraPositionWorld:{value:new c.Pa4(1,1,1)}},vertexShader:Sl,fragmentShader:`

            ${t}

            ${Cl}

            uniform sampler2D tNormalBuffer;uniform sampler2D edgeMaskBuffer;uniform vec2 screenSize;const float depthStep=0.02;uniform vec2 samples[NUM_SAMPLES];uniform vec3 cameraPositionWorld;varying vec2 vUv;
#include <common>
vec3 smoothNormal(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 texel=texture2D(tNormalDepth,uv);vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 avgNormal=2.*texture2D(tNormalBuffer,uv).rgb-1.;float depth=pow(unpack16(texel.xy),2.);vec2 invScreenSize=vec2(1.)/screenSize;vec4 mask=texture2D(tGBufferFlags,uv);float weightSum=0.;float radius=mask.g*255.*2.;float randomAngle=6.2*random(frameCount*0.1);float theta=randomAngle;float snTheta=sin(theta);float csTheta=cos(theta);mat2 randomRotationMatrix=mat2(csTheta,snTheta,-snTheta,csTheta);float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(1./(1.+pow(d_,0.5)),0.,1.);for(int i=0;i<5;i++){float x=float(i)-2.;for(int j=0;j<5;j++){float y=float(j)-2.;vec2 offset=randomRotationMatrix*vec2(x,y)*radius*radiusModifier*invScreenSize;vec4 texel=texture2D(tNormalDepth,uv+offset);float offsetDepth=pow(unpack16(texel.xy),2.);float depthWeight=abs(offsetDepth-depth);depthWeight=(1.-step(depthStep,depthWeight));vec3 offsetNormal=2.*texture2D(tNormalBuffer,uv+offset).rgb-1.;if(dot(offsetNormal,offsetNormal)>0.){avgNormal+=offsetNormal*depthWeight;}}}return normalize(avgNormal);}void main(){vec2 uv=gl_FragCoord.xy/screenSize;vec4 edgeMask=texture2D(edgeMaskBuffer,uv);vec3 normal=vec3(0.);if(edgeMask.x>0.){normal=smoothNormal();}else{normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}gl_FragColor=vec4(vec3(0.5*normal+0.5),1.);}
            
            `},"tDiffuse"),this.uiConfig=void 0,this.materialExtension={shaderExtender:(r,o,a)=>{var u,p;this.enabled&&(!((p=(u=o.materialObject.userData)===null||u===void 0?void 0:u._ssBevel)===null||p===void 0)&&p.hasSSBevel)&&(r.fragmentShader=Lr(r.fragmentShader,"#include <normal_fragment_maps>",` 
                normal = 2. * texture2D(tSSBevelMap, viewToScreen(vViewPosition.xyz).xy).rgb - 1.;
                normal = normalize(normal);
                //geometryNormal = normal;
            `))},onObjectRender:(r,o,a)=>{var u,p;if(!this.enabled||!(!((p=(u=o.materialObject.userData)===null||u===void 0?void 0:u._ssBevel)===null||p===void 0)&&p.hasSSBevel))return;const f=o.materialObject,m=this._target.texture;this.materialExtension.extraUniforms.tSSBevelMap.value!==m&&(this.materialExtension.extraUniforms.tSSBevelMap.value=m,f.needsUpdate=!0)},getUiConfig:r=>{const o={type:"folder",label:"SSBevel (Dev)",children:[{type:"checkbox",label:"Enabled",get value(){var a;return((a=r.materialObject.userData._ssBevel)===null||a===void 0?void 0:a.hasSSBevel)||!1},set value(a){var u,p;a!==((u=r.materialObject.userData._ssBevel)===null||u===void 0?void 0:u.hasSSBevel)&&(a?jE(r.materialObject)||alert("Cannot add screen space bevel."):(r.materialObject.userData._ssBevel.hasSSBevel=!1,r.materialObject.needsUpdate=!0),(p=o.uiRefresh)===null||p===void 0||p.call(o,"postFrame",!0))},onChange:this.setDirty},()=>({type:"slider",bounds:[0,8],label:"radius",hidden:()=>{var a;return!(!((a=r.materialObject.userData._ssBevel)===null||a===void 0)&&a.hasSSBevel)},property:[r.materialObject.userData._ssBevel,"radius"],onChange:this.setDirty})]};return o},parsFragmentSnippet:(r,o)=>{var a,u;return this.enabled&&(!((u=(a=o==null?void 0:o.materialObject.userData)===null||a===void 0?void 0:a._ssBevel)===null||u===void 0)&&u.hasSSBevel)?Z`
            uniform sampler2D tSSBevelMap;
            ${zm}
            `:""},extraUniforms:{tSSBevelMap:{value:null}},computeCacheKey:r=>{var o,a;return(this.enabled?"1":"0")+(!((a=(o=r.materialObject.userData)===null||o===void 0?void 0:o._ssBevel)===null||a===void 0)&&a.hasSSBevel?"1":"0")},isCompatible:r=>r.isMeshStandardMaterial2},this._target=e,this.needsSwap=!1,this.clear=!0,this._viewerApp=n,this._edgeMaterial=new Dc({uniforms:{tNormalDepth:{value:null},tNormalBuffer:{value:null},tGBufferFlags:{value:null},screenSize:{value:null},radius:{value:10},cameraNearFar:{value:new c.FM8(1,1)},cameraPositionWorld:{value:new c.Pa4(1,1,1)}},vertexShader:Sl,fragmentShader:"uniform vec2 screenSize;uniform sampler2D tNormalDepth;uniform sampler2D tNormalBuffer;uniform sampler2D tGBufferFlags;uniform float radius;uniform vec2 cameraNearFar;uniform vec3 cameraPositionWorld;const float depthStep=0.2;const float normalThreshold=0.9;float unpack16(vec2 value){return(value.x*0.996108949416342426275150501169264316558837890625+value.y*0.00389105058365758760263730664519243873655796051025390625);}vec3 unpackNormal(vec2 enc){vec2 fenc=enc*4.-2.;float f=dot(fenc,fenc);float g=sqrt(1.-f/4.);return vec3(fenc*g,1.-f/2.);}void lookupNormalDepth(out float depth,out vec3 normal,vec2 off){vec2 uv=(gl_FragCoord.st+off)/screenSize;vec4 texel=texture2D(tNormalDepth,uv);depth=mix(cameraNearFar.x,cameraNearFar.y,pow(unpack16(texel.xy),2.));normal=2.*texture2D(tNormalBuffer,uv).rgb-1.;}float getBorderWeight(){float depth1,depth2,depth3,depth4;vec3 normal1,normal2,normal3,normal4;float d_=dot(cameraPositionWorld,cameraPositionWorld);float radiusModifier=clamp(3./(1.+pow(d_,0.5)),0.,1.);float modRad=radius;lookupNormalDepth(depth1,normal1,vec2(0.,modRad));lookupNormalDepth(depth2,normal2,vec2(0.,-modRad));lookupNormalDepth(depth3,normal3,vec2(modRad,0.));lookupNormalDepth(depth4,normal4,vec2(-modRad,0.));vec2 uv=(gl_FragCoord.st)/screenSize;float mask=step(0.0001,texture2D(tGBufferFlags,uv).g);float mask1=texture2D(tGBufferFlags,uv+vec2(0.,modRad)/screenSize).b*255.;float mask2=texture2D(tGBufferFlags,uv+vec2(0.,-modRad)/screenSize).b*255.;float mask3=texture2D(tGBufferFlags,uv+vec2(modRad,0.)/screenSize).b*255.;float mask4=texture2D(tGBufferFlags,uv+vec2(-modRad,0.)/screenSize).b*255.;float maskWeight=max(abs(mask1-mask2),abs(mask3-mask4))*255.;maskWeight=(step(maskWeight,0.01));float a1=dot(normal1,normal2);float a2=dot(normal3,normal4);float normalWeight=min(abs(a1),abs(a2));normalWeight=1.-step(normalThreshold,normalWeight);float depthWeight=max(abs(depth1-depth2),abs(depth3-depth4));depthWeight=(step(depthWeight,depthStep));return normalWeight*depthWeight*maskWeight*mask;}void main(){float weight=getBorderWeight();vec2 uv=gl_FragCoord.st/screenSize;vec4 texel=texture2D(tNormalDepth,uv);float depth=pow(unpack16(texel.xy),2.);vec3 outColor=vec3(0.);if(depth>0.999){weight=0.;}else{outColor=vec3(weight);}gl_FragColor=vec4(outColor,1.);}"}),this._separableBlurMaterial=new Dc({defines:{KERNEL_RADIUS:3,SIGMA:3},uniforms:{colorTexture:{value:null},maskTexture:{value:null},texSize:{value:new c.FM8(.5,.5)},direction:{value:new c.FM8(.5,.5)}},vertexShader:Sl,fragmentShader:"varying vec2 vUv;uniform sampler2D colorTexture;uniform sampler2D maskTexture;uniform vec2 texSize;uniform vec2 direction;float gaussianPdf(in float x,in float sigma){return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;}void main(){vec2 invSize=1./texSize;float fSigma=float(SIGMA);float weightSum=gaussianPdf(0.,fSigma);vec4 mask=texture2D(maskTexture,vUv);vec3 diffuseSum=texture2D(colorTexture,vUv).rgb*weightSum;for(int i=1;i<KERNEL_RADIUS;i++){float x=float(i);float w=gaussianPdf(x,fSigma);vec2 uvOffset=direction*invSize*x;vec3 sample1=texture2D(colorTexture,vUv+uvOffset).rgb;vec3 sample2=texture2D(colorTexture,vUv-uvOffset).rgb;diffuseSum+=(sample1+sample2)*w;weightSum+=2.*w;}gl_FragColor=vec4(diffuseSum/weightSum,1.);}"})}render(s,e,t,n,r){var o,a;if(!this.enabled)return;const u=s.baseRenderer,p={minFilter:c.wem,magFilter:c.wem,isAntialiased:!1,format:c.wk1,depthBuffer:!1,generateMipmaps:!1},f=u.getTempTarget(p);this._renderEdges(u,f),this._blurEdges(u,f),this._viewerApp.scene.activeCamera.updateShaderProperties(this.material),(o=this._viewerApp.getPlugin(xr))===null||o===void 0||o.updateShaderProperties(this.material),(a=this._viewerApp.getPlugin(s_))===null||a===void 0||a.updateShaderProperties(this.material),this._viewerApp.renderer.updateShaderProperties(this.material),this.uniforms.edgeMaskBuffer.value=f.texture,super.render(s,this._target,f,n,r),u.releaseTempTarget(f)}_initsamples(){const s=[];return s.push(new c.FM8(-8,0).multiplyScalar(.125)),s.push(new c.FM8(-6,-4).multiplyScalar(.125)),s.push(new c.FM8(-3,-2).multiplyScalar(.125)),s.push(new c.FM8(-2,-6).multiplyScalar(.125)),s.push(new c.FM8(1,-1).multiplyScalar(.125)),s.push(new c.FM8(2,-5).multiplyScalar(.125)),s.push(new c.FM8(6,-7).multiplyScalar(.125)),s.push(new c.FM8(5,-3).multiplyScalar(.125)),s.push(new c.FM8(4,1).multiplyScalar(.125)),s.push(new c.FM8(7,4).multiplyScalar(.125)),s.push(new c.FM8(3,5).multiplyScalar(.125)),s.push(new c.FM8(0,7).multiplyScalar(.125)),s.push(new c.FM8(-1,3).multiplyScalar(.125)),s.push(new c.FM8(-4,6).multiplyScalar(.125)),s.push(new c.FM8(-7,8).multiplyScalar(.125)),s.push(new c.FM8(-5,2).multiplyScalar(.125)),s}_blurEdges(s,e){var t,n;const r={minFilter:c.wem,magFilter:c.wem,isAntialiased:!1,format:c.wk1,depthBuffer:!1,generateMipmaps:!1,sizeMultiplier:.5},o=s.getTempTarget(r),a=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,u=((n=e.texture.image)===null||n===void 0?void 0:n.height)||1;this._separableBlurMaterial.uniforms.texSize.value=new c.FM8(a,u),this._separableBlurMaterial.uniforms.colorTexture.value=e.texture,this._separableBlurMaterial.uniforms.direction.value=new c.FM8(1,0),s.blit(void 0,o,{material:this._separableBlurMaterial}),this._separableBlurMaterial.uniforms.texSize.value=new c.FM8(a/2,u/2),this._separableBlurMaterial.uniforms.colorTexture.value=o.texture,this._separableBlurMaterial.uniforms.direction.value=new c.FM8(0,1),s.blit(void 0,e,{material:this._separableBlurMaterial}),s.releaseTempTarget(o)}_renderEdges(s,e){var t,n,r,o;const a=((t=e.texture.image)===null||t===void 0?void 0:t.width)||1,u=((n=e.texture.image)===null||n===void 0?void 0:n.height)||1;this._edgeMaterial.uniforms.screenSize.value=new c.FM8(a,u),this._viewerApp.scene.activeCamera.updateShaderProperties(this._edgeMaterial),(r=this._viewerApp.getPlugin(xr))===null||r===void 0||r.updateShaderProperties(this._edgeMaterial),(o=this._viewerApp.getPlugin(s_))===null||o===void 0||o.updateShaderProperties(this._edgeMaterial),s.blit(void 0,e,{material:this._edgeMaterial})}};tx=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Ci("SSBevel")],tx);class wp extends xl{constructor(e=!0){super(),this.passId="ssBevel",this._beforeFilters=["render"],this._afterFilters=["gbuffer","normalBuffer"],this._requiredFilters=["render","gbuffer","normalBuffer"],this._lastEnabled=!1,this.dependencies=[dn,xr,s_],this.enabled=e,this.setDirty=this.setDirty.bind(this),this._loaderCreate=this._loaderCreate.bind(this)}get bevelTarget(){return this._bevelTarget}_loaderCreate({loader:e}){e.isGLTFLoader2&&e.register(t=>new oT(t))}passCtor(e){var t,n;this._bevelTarget=e.renderer.createTarget({depthBuffer:!0,type:c.cLu,minFilter:c.TyD,magFilter:c.TyD,generateMipmaps:!1}),this._bevelTarget.texture.name="bevelBuffer",this._bevelTarget.texture.generateMipmaps=!1;const r=e.getPluginByType("debug");return r&&r.addTexture("tempBuffer",()=>this._bevelTarget.texture,[440,50,400,200]),new tx(e.renderer,this._bevelTarget,(n=(t=e.getPlugin(xr))===null||t===void 0?void 0:t.getUnpackSnippet())!==null&&n!==void 0?n:"",e)}async onAdded(e){var t,n,r,o,a,u,p;await super.onAdded(e);const f=e.getPlugin(dn);return!((t=this.pass)===null||t===void 0)&&t.passObject.materialExtension&&((n=f==null?void 0:f.materials)===null||n===void 0||n.registerMaterialExtension((r=this.pass)===null||r===void 0?void 0:r.passObject.materialExtension)),(o=f==null?void 0:f.importer)===null||o===void 0||o.addEventListener("loaderCreate",this._loaderCreate),(p=(u=(a=f==null?void 0:f.exporter)===null||a===void 0?void 0:a.getExporter("gltf","glb"))===null||u===void 0?void 0:u.extensions)===null||p===void 0||p.push(aT),super.onAdded(e)}async onRemove(e){return e.renderer.disposeTarget(this._bevelTarget),super.onRemove(e)}setDirty(){var e,t,n,r;(e=this._viewer)===null||e===void 0||e.setDirty(),(r=(t=this.pass)===null||t===void 0?void 0:(n=t.passObject.materialExtension).setDirty)===null||r===void 0||r.call(n)}_update(e){var t;let n=this.enabled;if(n&&!this._lastEnabled){const r=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("NormalBufferPlugin");confirm("SS Bevel Plugin needs to enable NormalBufferPlugin. Enable now?")?r.enabled=!0:(this.enabled=!1,r.enabled=!1,n=!1)}return this._lastEnabled=n,n}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.pass)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(u=>Se(u)))===null||o===void 0||o.flat(2).forEach(u=>u&&(u.onChange=this.setDirty)),a}}wp.PluginType="SSBevelPlugin",wp.SSBEVEL_GLTF_EXTENSION="WEBGI_materials_ssbevel";class oT{constructor(e){this.parser=e,this.name=wp.SSBEVEL_GLTF_EXTENSION}async extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const r=n.extensions[this.name];return t.userData||(t.userData={}),jE(t),t.userData._ssBevel=kt(r,t.userData._ssBevel,!1,{}),Promise.resolve()}}const aT=s=>({writeMaterial:(e,t)=>{if(!e.isMeshStandardMaterial||!e.userData._ssBevel||!e.userData._ssBevel.hasSSBevel)return;t.extensions=t.extensions||{};const n=cn(e.userData._ssBevel,!1);t.extensions[wp.SSBEVEL_GLTF_EXTENSION]=n,s.extensionsUsed[wp.SSBEVEL_GLTF_EXTENSION]=!0}});class zE extends kw{constructor(e){super(),this._loadedLibs=!1,e=e||{method:d0.EncoderMethod.EDGEBREAKER,encodeSpeed:5},this._io=new IM().registerExtensions(rT).registerExtensions([VE,qy,Qy,Hy,Wy,Yy,Xy,Ky,Jy,$y,Zy,eb,tb,nb,ib]),this._encoderOptions=e}preload(){return this._loadLibs(),this}async _loadLibs(){if(this._loadedLibs||!this.loader)return;const e=await Promise.all([this.loader.initEncoder(),this.loader.initDecoder()]);this._io.registerDependencies({"draco3d.encoder":e[0],"draco3d.decoder":e[1]}),this._loadedLibs=!0}async parseAsync(e,{compress:t=!1,...n}){if(!this.loader)return console.error("GLTFDracoExporter: No DRACOLoader2 instance provided"),super.parseAsync(e,n);await this._loadLibs();const r={...n};t&&(r.externalImagesInExtras=!0);const o=await new Promise((y,S)=>this.parse(e,y,S,r)),a=await super.parseAsync(o,r);if(!t)return a;if(!o)throw new Error("GLTFDracoExporter: gltf is null");let u=o;const p=u.byteLength||1/0,f=await(typeof u!="object"||u.byteLength?this._io.readBinary(new Uint8Array(u)):this._io.readJSON({json:u,resources:{}}));if(f.createExtension(d0).setRequired(!0).setEncoderOptions(this._encoderOptions),r.exportExt==="glb")u=await this._io.writeBinary(f),isFinite(p)&&console.log("DRACO Compression ratio: "+(u.byteLength/p).toFixed(5));else{const y=await this._io.writeJSON(f);u=y.json,Object.values(y.resources).filter(S=>S).length>0&&(console.warn("DRACOExporter: extra resources in resources not supported properly"),u.resources=y.resources)}u.__isGLTFOutput=!0;const m=await super.parseAsync(u,r);return m.__uncompressed=a,m}}class nx extends ui{constructor(){super(...arguments),this.enabled=!0,this.dependencies=[dn,o0]}async onAdded(e){await super.onAdded(e);const t=e.getManager().importer;if(!t)throw new Error("GLTFDracoExportPlugin: AssetImporter not found");(function(n,r){Ow(n,zE,o=>{const a=ki()+".drc",u=o;u.loader=r.registerFile(a),u.loader.setDecoderConfig({type:"js"}),u.loader.preload(!0,!0)})})(e,t)}}nx.PluginType="GLTFDracoExportPlugin";class lT extends Fs{constructor(){super(...arguments),this.extensionName=Jo,this.parentTypes=[hn.SCENE],this.propertyType="ViewerJSON"}init(){}}class VE extends ms{constructor(){super(...arguments),this.extensionName=Jo,this._viewerConfig={},this._texturesRef=[],this.required=!0}read(e){var t;return this._viewerConfig={},(t=e.jsonDoc.json.scenes)===null||t===void 0||t.forEach((n,r)=>{if(n.extensions&&n.extensions[Jo]){const o=new lT(this.document.getGraph());e.scenes[r].setExtension(Jo,o);const a=n.extensions[Jo];this._viewerConfig=a}}),this}write(e){return this.document.getRoot().listScenes().forEach(t=>{var n;if(t.getExtension(Jo)){const r=(n=e.jsonDoc.json.scenes)===null||n===void 0?void 0:n[e.jsonDoc.json.scene||0];r&&this._viewerConfig!=={}&&(r.extensions=r.extensions||{},r.extensions[Jo]=this._viewerConfig,this._texturesRef=[],this._viewerConfig={})}}),this}}VE.EXTENSION_NAME=Jo;class Gy extends Fs{constructor(e,t,n){super(e,t),this.parentTypes=[hn.MATERIAL,hn.MESH,hn.NODE,hn.SCENE],this.propertyType="GenericExtension",this.textures={},this.extensionName=n}addTexture(e,t,n,r=4369){this.setRef(e,n,{channels:r}),this.textures[e]=[t,n]}copy(e,t=uh){return super.copy(e,t),this}dispose(){Object.values(this.textures).forEach(([e,t])=>{e==null||e.dispose()}),super.dispose()}init(){}}class cl extends ms{constructor(){super(...arguments),this.textureChannels={}}read(e){const t=e.jsonDoc,n=t.json.materials||[],r=t.json.textures||[];return n.forEach((o,a)=>{var u,p;if(o.extensions&&o.extensions[this.extensionName]){const f=new Gy(this.document.getGraph(),"",this.extensionName);e.materials[a].setExtension(this.extensionName,f);const m={...o.extensions[this.extensionName]};for(const[y,S]of Object.entries(m))if(typeof(S==null?void 0:S.index)=="number"){const M=S,P=(u=r[M.index])===null||u===void 0?void 0:u.source;if(typeof P!="number"){console.warn("GLTF Pipeline: source texture not found for texture info",M);continue}const D=e.textures[P],j=new as(this.document.getGraph()),k=(p=this.textureChannels[y])!==null&&p!==void 0?p:4369;f.addTexture(y,j,D,k),e.setTextureInfo(j,M),delete m[y]}f.setExtras(m)}}),(t.json.meshes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const u=new Gy(this.document.getGraph(),"",this.extensionName);e.meshes[a].setExtension(this.extensionName,u);const p=o.extensions[this.extensionName];u.setExtras(p)}}),(t.json.nodes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const u=new Gy(this.document.getGraph(),"",this.extensionName);e.nodes[a].setExtension(this.extensionName,u);const p=o.extensions[this.extensionName];u.setExtras(p)}}),(t.json.scenes||[]).forEach((o,a)=>{if(o.extensions&&o.extensions[this.extensionName]){const u=new Gy(this.document.getGraph(),"",this.extensionName);e.scenes[a].setExtension(this.extensionName,u);const p=o.extensions[this.extensionName];u.setExtras(p)}}),this}write(e){const t=e.jsonDoc;return this.document.getRoot().listMaterials().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.materialIndexMap.get(n),a=t.json.materials[o];a.extensions=a.extensions||{};const u={...r.getExtras()};for(const[p,f]of Object.entries(r.textures)){const m=f[0],y=f[1];y&&(u[p]=e.createTextureInfoDef(y,m))}a.extensions[this.extensionName]=u}}),this.document.getRoot().listMeshes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.meshIndexMap.get(n),a=t.json.meshes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listNodes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.nodeIndexMap.get(n),a=t.json.nodes[o];a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this.document.getRoot().listScenes().forEach(n=>{const r=n.getExtension(this.extensionName);if(r){const o=e.jsonDoc.json.scene||0,a=t.json.scenes[o];if(!a)return;a.extensions=a.extensions||{},a.extensions[this.extensionName]=r.getExtras()}}),this}}class Qy extends cl{constructor(){super(...arguments),this.extensionName=Qy.EXTENSION_NAME,this.textureChannels={bumpTexture:Ns.R}}}Qy.EXTENSION_NAME=ba;class Hy extends cl{constructor(){super(...arguments),this.extensionName=Hy.EXTENSION_NAME,this.textureChannels={lightMapTexture:Ns.R|Ns.G|Ns.B}}}Hy.EXTENSION_NAME=wa;class Wy extends cl{constructor(){super(...arguments),this.extensionName=Wy.EXTENSION_NAME,this.textureChannels={alphaTexture:Ns.G}}}Wy.EXTENSION_NAME=Al;class qy extends cl{constructor(){super(...arguments),this.extensionName=qy.EXTENSION_NAME}}qy.EXTENSION_NAME=Qr.DIAMOND_GLTF_EXTENSION;class Yy extends cl{constructor(){super(...arguments),this.extensionName=Yy.EXTENSION_NAME}}Yy.EXTENSION_NAME=Br.AnimationMarkersExtension;class Xy extends cl{constructor(){super(...arguments),this.extensionName=Xy.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Ns.R|Ns.G|Ns.B}}}Xy.EXTENSION_NAME=pa.ANISOTROPY_GLTF_EXTENSION;class Ky extends cl{constructor(){super(...arguments),this.extensionName=Ky.EXTENSION_NAME,this.textureChannels={anisotropyDirection:Ns.R|Ns.G|Ns.B}}}Ky.EXTENSION_NAME=$s.CUSTOM_BUMP_MAP_GLTF_EXTENSION;class Jy extends cl{constructor(){super(...arguments),this.extensionName=Jy.EXTENSION_NAME}}Jy.EXTENSION_NAME=Re;class $y extends cl{constructor(){super(...arguments),this.extensionName=$y.EXTENSION_NAME}}$y.EXTENSION_NAME=_l;class Zy extends cl{constructor(){super(...arguments),this.extensionName=Zy.EXTENSION_NAME}}Zy.EXTENSION_NAME=$o;class eb extends cl{constructor(){super(...arguments),this.extensionName=eb.EXTENSION_NAME}}eb.EXTENSION_NAME=Ja.CLEARCOAT_TINT_GLTF_EXTENSION;class tb extends cl{constructor(){super(...arguments),this.extensionName=tb.EXTENSION_NAME}}tb.EXTENSION_NAME=Ta.THIN_FILM_LAYER_GLTF_EXTENSION;class nb extends cl{constructor(){super(...arguments),this.extensionName=nb.EXTENSION_NAME}}nb.EXTENSION_NAME=wp.SSBEVEL_GLTF_EXTENSION;class ib extends cl{constructor(){super(...arguments),this.extensionName=ib.EXTENSION_NAME}}ib.EXTENSION_NAME=co.NOISE_BUMP_MATERIAL_GLTF_EXTENSION;class GE extends w{constructor(){super(...arguments),this.processor={forAssetType:"texture",process:(e,t)=>e}}async onAdded(e){}async onDispose(e){}async onRemove(e){this._pmrem=void 0}}GE.PluginType="PMREMGenerator";const QE=new c.Pa4,cT=new c._fP,HE=new c.Pa4;class uT extends c.Tme{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const dh=new c.yGw,hT=new c.yGw;class dT{constructor(e={}){const t=this;let n,r,o,a;const u={camera:{fov:0,style:""},objects:new WeakMap},p=e.element!==void 0?e.element:document.createElement("div");p.style.overflow="hidden",this.domElement=p;const f=document.createElement("div");function m(P){return Math.abs(P)<1e-10?0:P}function y(P){const D=P.elements;return"matrix3d("+m(D[0])+","+m(-D[1])+","+m(D[2])+","+m(D[3])+","+m(D[4])+","+m(-D[5])+","+m(D[6])+","+m(D[7])+","+m(D[8])+","+m(-D[9])+","+m(D[10])+","+m(D[11])+","+m(D[12])+","+m(-D[13])+","+m(D[14])+","+m(D[15])+")"}function S(P){const D=P.elements;return"translate(-50%,-50%)matrix3d("+m(D[0])+","+m(D[1])+","+m(D[2])+","+m(D[3])+","+m(-D[4])+","+m(-D[5])+","+m(-D[6])+","+m(-D[7])+","+m(D[8])+","+m(D[9])+","+m(D[10])+","+m(D[11])+","+m(D[12])+","+m(D[13])+","+m(D[14])+","+m(D[15])+")"}function M(P,D,j,k){if(P.isCSS3DObject){const L=P.visible===!0&&P.layers.test(j.layers)===!0;if(P.element.style.display=L===!0?"":"none",L===!0){let R;P.onBeforeRender(t,D,j),P.isCSS3DSprite?(dh.copy(j.matrixWorldInverse),dh.transpose(),P.rotation2D!==0&&dh.multiply(hT.makeRotationZ(P.rotation2D)),P.matrixWorld.decompose(QE,cT,HE),dh.setPosition(QE),dh.scale(HE),dh.elements[3]=0,dh.elements[7]=0,dh.elements[11]=0,dh.elements[15]=1,R=S(dh)):R=S(P.matrixWorld);const W=P.element,q=u.objects.get(P);if(q===void 0||q.style!==R){W.style.transform=R;const J={style:R};u.objects.set(P,J)}W.parentNode!==f&&f.appendChild(W),P.onAfterRender(t,D,j)}}for(let L=0,R=P.children.length;L<R;L++)M(P.children[L],D,j)}f.style.transformStyle="preserve-3d",f.style.pointerEvents="none",p.appendChild(f),this.getSize=function(){return{width:n,height:r}},this.render=function(P,D){const j=D.projectionMatrix.elements[5]*a;let k,L;u.camera.fov!==j&&(p.style.perspective=D.isPerspectiveCamera?j+"px":"",u.camera.fov=j),P.matrixWorldAutoUpdate===!0&&P.updateMatrixWorld(),D.parent===null&&D.matrixWorldAutoUpdate===!0&&D.updateMatrixWorld(),D.isOrthographicCamera&&(k=-(D.right+D.left)/2,L=(D.top+D.bottom)/2);const R=D.isOrthographicCamera?"scale("+j+")translate("+m(k)+"px,"+m(L)+"px)"+y(D.matrixWorldInverse):"translateZ("+j+"px)"+y(D.matrixWorldInverse),W=R+"translate("+o+"px,"+a+"px)";u.camera.style!==W&&(f.style.transform=W,u.camera.style=W),M(P,P,D)},this.setSize=function(P,D){n=P,r=D,o=n/2,a=r/2,p.style.width=P+"px",p.style.height=D+"px",f.style.width=P+"px",f.style.height=D+"px"}}}var rb,sb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let cd=rb=class extends ui{constructor(s=!0){super(),this._scene=new c.xsS,this.overCanvas=!0,this._trackers=[],this.attachIFrameToSelected=async()=>{var e,t,n,r,o;const a=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();if(!(a!=null&&a.geometry))return void await((n=this._viewer)===null||n===void 0?void 0:n.alert("No Geometry: Selected object must have a geometry to apply the iframe to"));const u=await((r=this._viewer)===null||r===void 0?void 0:r.prompt("URL: Enter the url for the webpage. (Make sure its allowed to be embedded in an iframe.)","https://webgi.xyz/",!1))||"https://webgi.pixotronics.com/";if(!u)return;const p=await((o=this._viewer)===null||o===void 0?void 0:o.prompt("Width: Enter the width for the object.","512",!1))||"512";p&&this.attachIFrame(a,u,parseInt(p))},this._resizeObserver=new ResizeObserver(()=>{var e;this.enabled&&((e=this._viewer)===null||e===void 0||e.scene.setDirty({sceneUpdate:!0}))}),this.enabled=s,this._refreshCanvasInDOM=this._refreshCanvasInDOM.bind(this),this._refreshEnabled=this._refreshEnabled.bind(this)}_refreshEnabled(){}_refreshCanvasInDOM(){const s=this._viewer;s&&this._renderer&&(s.canvas.remove(),this.overCanvas?this._renderer.domElement.insertAdjacentElement("afterbegin",s.canvas):this._renderer.domElement.appendChild(s.canvas))}_initialize(){if(this._renderer||!this._viewer)return;this._renderer=new dT;const s=this._viewer.renderer.rendererObject.getSize(new c.FM8);this._renderer.setSize(s.width,s.height);const e=document.createElement("div");e.style.position="absolute",e.style.top="0",e.style.zIndex="0",e.appendChild(this._renderer.domElement),this._viewer.canvas.style.position="absolute",this._viewer.canvas.style.top="0",this._viewer.canvas.style.left="0",this._viewer.canvas.style.zIndex="0",this._viewer.container.appendChild(e),this._refreshCanvasInDOM(),this._viewer.renderer.addEventListener("resize",()=>{if(!this._viewer||!this._renderer)return;const t=this._viewer.renderer.rendererObject.getSize(new c.FM8);this._renderer.setSize(t.width,t.height)})}async onAdded(s){await super.onAdded(s);let e=!0,t=!0;s.addEventListener("postFrame",o=>{var a,u;e&&this.enabled&&(this._renderer||this._initialize(),this._renderer&&(t&&this._trackers.forEach(p=>{var f,m;let y=!0;const S=p.modelObj.material.side;if(S!==c.ehD){const M=new c.Pa4(0,0,1).applyQuaternion(p.cssObj.quaternion),P=(m=(f=this._viewer)===null||f===void 0?void 0:f.scene.activeCamera)===null||m===void 0?void 0:m.cameraObject,D=M.dot(P.getWorldDirection(new c.Pa4));y=S===c._Li?D>0:D<0}p.cssObj.element.style.visibility=y?"visible":"hidden"}),this._trackers.filter(p=>p.dirty).forEach(p=>this._syncProperties(p)),(a=this._renderer)===null||a===void 0||a.render(this._scene,(u=s.scene.activeCamera)===null||u===void 0?void 0:u.cameraObject),e=!1))}),s.addEventListener("update",o=>{this.enabled&&(e=this._trackers.length>0)}),s.scene.addEventListener("sceneUpdate",o=>{this.enabled&&(this._trackers.forEach(a=>a.dirty=!0),e=this._trackers.length>0)}),s.scene.addEventListener("activeCameraUpdate",o=>{this.enabled&&(e=this._trackers.length>0,t=!0)});let n=!1;const r=new c.iMs;s.container.addEventListener("mousemove",o=>{if(!this.enabled||!this._viewer||this.overCanvas)return;const a=this._viewer.canvas.getBoundingClientRect(),u=(o.clientX-a.x)/a.width*2-1,p=-(o.clientY-a.y)/a.height*2+1;r.setFromCamera({x:u,y:p},this._viewer.scene.activeCamera.cameraObject);const f=this._trackers.map(y=>y.modelObj),m=r.intersectObjects(f,!1);if(console.log(m),m.length)return this._viewer.canvas.style.pointerEvents="none",n=!0,void console.log(this._viewer.canvas.style.pointerEvents);n&&(this._viewer.canvas.style.pointerEvents="auto",n=!1)})}attachIFrame(s,e,t){const n=ab(s.modelObject),r=WE(e,t,t*n.y/n.x,()=>{var o;return(o=s.setDirty)===null||o===void 0?void 0:o.call(s)});return this.attachCSS3DObject(r,s),r}attachCSS3DObject(s,e){var t,n,r,o,a;if(this._trackers.push({cssObj:s,modelObj:e.modelObject,dirty:!0}),s.element&&(this._resizeObserver.observe(s.element),s.element.__isCSS3DObjectElement=!0,console.log(s.element,s.element.__isCSS3DObjectElement)),e.userData.__oldMaterial=e.material,!e.setMaterial)throw"model not processed?";const u=(t=this._viewer)===null||t===void 0?void 0:t.createMaterial("basic",{opacity:0,color:new c.Ilk("black"),blending:c.jFi,side:c.Wl3});if(!u)throw"cannot create mat";u.userData.forcedLinearDepth=0,(n=e.setMaterial)===null||n===void 0||n.call(e,u),ob(e.modelObject),ix(e.modelObject),ab(e.modelObject),this._scene.add(s),(o=(r=this.uiConfig)===null||r===void 0?void 0:r.uiRefresh)===null||o===void 0||o.call(r),(a=e.setDirty)===null||a===void 0||a.call(e)}_syncProperties(s){const e=s.modelObj,t=s.cssObj;e.updateMatrixWorld();const n=s.cssObj.element.clientWidth<1.5?0:(s.cssObj.element.clientWidth-1.5)/ab(e).x,r=ob(e);t.quaternion.setFromUnitVectors(new c.Pa4(0,0,1),r),t.position.copy(ix(e)),t.scale.set(1,1,1).multiplyScalar(1/n),t.updateMatrixWorld(),t.applyMatrix4(e.matrixWorld),s.dirty=!1}async onDispose(s){return this._resizeObserver.disconnect(),super.onDispose(s)}};function WE(s,e,t,n){const r=document.createElement("div");r.style.width=e.toString()+"px",r.style.height=t.toString()+"px",r.style.backgroundColor="transparent";const o=document.createElement("iframe",{is:"x-frame-bypass"});o.style.width="100%",o.style.height="100%",o.style.border="0px";const a=()=>{var u,p;try{o.contentWindow.name}catch(f){(typeof f=="string"?f:(p=(u=f==null?void 0:f.toString)===null||u===void 0?void 0:u.call(f))!==null&&p!==void 0?p:"").includes("cross-origin")?console.warn("Trying to load cross-origin scripts, Install chrome extension if not able to load: https://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe"):console.error(f)}n(),o.removeEventListener("load",a)};return o.addEventListener("load",a),o.src=s,r.appendChild(o),new uT(r)}function ob(s){if(s.geometry.userData.geometryNormal)return s.geometry.userData.geometryNormal;const e=s.geometry.attributes.normal,t=new c.Pa4,n=new c.Pa4;for(let r=0,o=e.count;r<o;r++)t.fromBufferAttribute(e,r),n.add(t);return n.normalize(),s.geometry.userData.geometryNormal=n,n}function ix(s){if(s.geometry.userData.geometryCenter)return s.geometry.userData.geometryCenter;const e=s.geometry;if(!e)return new c.Pa4(0,0,0);e.boundingBox||e.computeBoundingBox();const t=e.boundingBox.getCenter(new c.Pa4);return s.geometry.userData.geometryCenter=t,t}function ab(s,e=new c.Pa4(0,0,1)){if(s.geometry.userData.geometrySize)return s.geometry.userData.geometrySize;const t=s.geometry;if(!t)return new c.Pa4(0,0,0);const n=t.clone();n.applyMatrix4(new c.yGw().makeRotationFromQuaternion(new c._fP().setFromUnitVectors(e,ob(s)).invert())),n.computeBoundingBox();const r=n.boundingBox.getSize(new c.Pa4);return s.geometry.userData.geometrySize=r,n.dispose(),r}cd.PluginType="CSS3DRenderer",sb([_n("Enabled"),we(rb.prototype._refreshEnabled),et()],cd.prototype,"enabled",void 0),sb([_n("Over canvas"),we(rb.prototype._refreshCanvasInDOM),et()],cd.prototype,"overCanvas",void 0),sb([Ji("Attach iframe")],cd.prototype,"attachIFrameToSelected",void 0),cd=rb=sb([Ci("CSS3D Renderer")],cd);const pT=1e4,qE=50;class o_{constructor(e=qE){this.velocity=0,this.naturalFrequency=0,this.setDecayTime(e)}setDecayTime(e){this.naturalFrequency=1/Math.max(.001,e)}update(e,t,n,r){const o=2e-4*this.naturalFrequency;if(e==null||r===0||e===t&&this.velocity===0)return t;if(n<0)return e;const a=e-t,u=this.velocity+this.naturalFrequency*a,p=a+n*u,f=Math.exp(-this.naturalFrequency*n),m=(u-this.naturalFrequency*p)*f,y=-this.naturalFrequency*(m+u*f);return Math.abs(m)<o*Math.abs(r)&&y*a>=0?(this.velocity=0,t):(this.velocity=m,t+p*f)}}const rx=new c.Pa4;class YE{constructor(){this.inputSource=null,this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.lastDragPosition=new c.Pa4,this.firstRatio=0,this.lastAngle=0,this.goalPosition=new c.Pa4,this.goalYaw=0,this.goalScale=1,this.presentedScene=null,this.placementBox=null,this.placeOnWall=!1,this.placementComplete=!1,this.xr=null,this.session=null,this._hitPosition=new c.Pa4,this._hitMatrix=new c.yGw,this.xDamper=new o_,this.yDamper=new o_,this.zDamper=new o_,this.yawDamper=new o_,this.scaleDamper=new o_,this.onSelectStart=e=>{const t=this.transientHitTestSource;if(t==null)return;const n=this.frame.getHitTestResultsForTransientInput(t),r=this.presentedScene,o=this.placementBox;if(n.length===1){this.inputSource=e.inputSource;const{axes:a}=this.inputSource.gamepad||{axes:[0,0]},u=o.getHit(r,a[0],a[1]);o.show=!0,u!=null?(this.isTranslating=!0,this.lastDragPosition.copy(u)):this.placeOnWall||(this.isRotating=!0,this.lastAngle=1.5*a[0])}else if(n.length===2){o.show=!0,this.isTwoFingering=!0;const{separation:a}=this.fingerPolar(n);this.firstRatio=a/r.scale.x}},this.onSelectEnd=()=>{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!1,this.inputSource=null,this.goalPosition.y+=this.placementBox.offsetHeight*this.presentedScene.scale.x,this.placementBox.show=!1}}async setSession(e,t,n,r){var o;this.transientHitTestSource=await((o=e.requestHitTestSourceForTransientInput)===null||o===void 0?void 0:o.call(e,{profile:"generic-touchscreen"})),this.presentedScene=t,this.placementBox=r,this.xr=n,this.session=e,this.placementComplete=!1,this.goalPosition.copy(t.position),this.goalYaw=t.rotation.y,this.goalScale=t.scale.x,e.addEventListener("selectstart",this.onSelectStart),e.addEventListener("selectend",this.onSelectEnd)}cancel(){this.transientHitTestSource&&(this.transientHitTestSource.cancel(),this.transientHitTestSource=void 0),this.presentedScene=null,this.placeOnWall=!1,this.frame=void 0,this.xr=null,this.placementBox&&(this.placementBox.show=!1,this.placementBox=null),this.session&&(this.session.removeEventListener("selectstart",this.onSelectStart),this.session.removeEventListener("selectend",this.onSelectEnd),this.session=null)}getHitPoint(e){var t;const n=(t=this.xr)===null||t===void 0?void 0:t.getReferenceSpace(),r=n?e.getPose(n):null;return r?(this._hitMatrix.fromArray(r.transform.matrix),this.placeOnWall&&(this.goalYaw=Math.atan2(this._hitMatrix.elements[4],this._hitMatrix.elements[6])),this._hitMatrix.elements[5]>.75!==this.placeOnWall?this._hitPosition.setFromMatrixPosition(this._hitMatrix):null):null}moveScene(e){if(!this.session)return;const t=this.presentedScene,n=t.position,r=t.rotation.y,o=this.placementBox,a=Math.max(o.boundingSize.x,o.boundingSize.y,o.boundingSize.z)/2,u=this.goalPosition,p=t.scale.x;if(!u.equals(n)||this.goalScale!==p){let{x:f,y:m,z:y}=n;f=this.xDamper.update(f,u.x,e,a),m=this.yDamper.update(m,u.y,e,a),y=this.zDamper.update(y,u.z,e,a),n.set(f,m,y);const S=this.scaleDamper.update(p,this.goalScale,e,1);if(t.scale.set(S,S,S),!this.isTranslating){const M=u.y-m;this.placementComplete&&!this.placeOnWall?o.offsetHeight=M/S:M===0&&(this.placementComplete=!0,o.show=!1)}}o.updateOpacity(e),t.rotation.y=this.yawDamper.update(r,this.goalYaw,e,Math.PI)}processInput(e){var t;this.frame=e;const n=this.transientHitTestSource;if(!n||!this.isTranslating&&!this.isTwoFingering&&!this.isRotating)return;const r=e.getHitTestResultsForTransientInput(n),o=this.presentedScene,a=o.scale.x;if(this.isTwoFingering)if(r.length<2)this.isTwoFingering=!1;else{const{separation:u,deltaYaw:p}=this.fingerPolar(r);if(this.placeOnWall||(this.goalYaw+=p),!o.userData.__scaleDisabled){const f=u/this.firstRatio;this.goalScale=f<1.3&&f>.7692307692307692?1:f}}else if(r.length!==2)if(this.isRotating&&(!((t=this.inputSource)===null||t===void 0)&&t.gamepad)){const u=1.5*this.inputSource.gamepad.axes[0];this.goalYaw+=u-this.lastAngle,this.lastAngle=u}else this.isTranslating&&(console.log("translating"),r.forEach(u=>{if(u.inputSource!==this.inputSource)return;let p=null;if(u.results.length>0&&(p=this.getHitPoint(u.results[0])),p==null&&(p=this.getTouchLocation()),p!=null){if(this.goalPosition.sub(this.lastDragPosition),!this.placeOnWall){const f=p.y-this.lastDragPosition.y;if(f<0){this.placementBox.offsetHeight=f/a;const m=rx.copy(this.xr.getCamera().position),y=-f/(m.y-p.y);m.multiplyScalar(y),p.multiplyScalar(1-y).add(m)}}this.goalPosition.add(p),this.lastDragPosition.copy(p)}}));else{this.isTranslating=!1,this.isRotating=!1,this.isTwoFingering=!0;const{separation:u}=this.fingerPolar(r);this.firstRatio=u/a}}getTouchLocation(){var e,t;const{axes:n}=(e=this.inputSource.gamepad)!==null&&e!==void 0?e:{axes:[0,0]},r=this.placementBox.getExpandedHit(this.presentedScene,n[0],n[1]);return r!=null&&(rx.copy(r).sub((t=this.xr)===null||t===void 0?void 0:t.getCamera().position),rx.length()>10)?null:r}fingerPolar(e){var t,n,r,o,a,u;const p=(r=(n=(t=e[0].inputSource)===null||t===void 0?void 0:t.gamepad)===null||n===void 0?void 0:n.axes)!==null&&r!==void 0?r:[0,0],f=(u=(a=(o=e[1].inputSource)===null||o===void 0?void 0:o.gamepad)===null||a===void 0?void 0:a.axes)!==null&&u!==void 0?u:[0,0],m=f[0]-p[0],y=f[1]-p[1],S=Math.atan2(y,m);let M=this.lastAngle-S;return M>Math.PI?M-=2*Math.PI:M<-Math.PI&&(M+=2*Math.PI),this.lastAngle=S,{separation:Math.sqrt(m*m+y*y),deltaYaw:M}}}const lb=.2,fT=Math.PI/24,XE=new c.FM8,cb=(s,e,t)=>{let n=e>0?t>0?0:-Math.PI/2:t>0?Math.PI/2:Math.PI;for(let r=0;r<=12;++r)s.push(e+.17*Math.cos(n),t+.17*Math.sin(n),0,e+lb*Math.cos(n),t+lb*Math.sin(n),0),n+=fT};class KE extends c.Kj0{constructor(e,t,n=!1){super(((p,f)=>{const m=new c.u9r,y=[],S=[],M=p.getSize(new c.Pa4),P=M.x/2,D=(f?M.y:M.z)/2;cb(S,P,D),cb(S,-P,D),cb(S,-P,-D),cb(S,P,-D);const j=S.length/3;for(let L=0;L<j-2;L+=2)y.push(L,L+1,L+3,L,L+3,L+2);const k=j-2;return y.push(k,k+1,1,k,1,0),m.setAttribute("position",new c.a$l(S,3)),m.setIndex(y),m})(e,n)),this.boundingSize=new c.Pa4,this._raycaster=new c.iMs,this._camera=t,this._placeOnWall=n;const r=this.material;r.side=c.Wl3,r.color=new Sn(16711935),r.opacity=0,this.userData.bboxVisible=!1;const o=e.getSize(this.boundingSize);console.log(e,n,o,this);const a=o.x/2,u=(n?o.y:o.z)/2;this.hitPlane=new c.Kj0(new c._12(2*(a+lb),2*(u+lb))),this.hitPlane.visible=!1,this.add(this.hitPlane),e.getCenter(this.position),n?(this.shadowHeight=e.min.z,this.position.z=this.shadowHeight):(this.rotateX(-Math.PI/2),this.shadowHeight=e.min.y,this.position.y=this.shadowHeight),this.offsetHeight=0}getHit(e,t,n){XE.set(t,-n),this.hitPlane.visible=!0;const r=this._positionAndNormalFromPoint(XE,this.hitPlane);return this.hitPlane.visible=!1,r==null?null:r.position}getExpandedHit(e,t,n){this.hitPlane.scale.set(1e3,1e3,1e3);const r=this.getHit(e,t,n);return this.hitPlane.scale.set(1,1,1),r}set offsetHeight(e){e-=.001,this._placeOnWall?this.position.z=this.shadowHeight+e:this.position.y=this.shadowHeight+e}get offsetHeight(){return this._placeOnWall?this.position.z-this.shadowHeight:this.position.y-this.shadowHeight}set show(e){this.material.opacity=e?.75:0}get show(){return this.material.opacity>.01}updateOpacity(e){const t=this.material;this.visible=t.opacity>0}dispose(){var e;const{geometry:t,material:n}=this.hitPlane;t.dispose(),n.dispose(),this.geometry.dispose(),this.material.dispose(),(e=this.parent)===null||e===void 0||e.remove(this)}_positionAndNormalFromPoint(e,t){if(!this._camera)return null;this._raycaster.setFromCamera(e,this._camera);const n=this._raycaster.intersectObject(t,!0);if(n.length===0)return null;const r=n[0];return r.face==null?null:r.uv==null?{position:r.point,normal:r.face.normal,uv:null}:(r.face.normal.applyNormalMatrix(new c.Vkp().getNormalMatrix(r.object.matrixWorld)),{position:r.point,normal:r.face.normal,uv:r.uv})}}class JE extends ui{constructor(){super(...arguments),this.enabled=!0,this._touchInputHelper=new YE,this._preRender=()=>{if(!(this._dirty&&this._viewer&&this._xrManager&&this._xrSession))return;this._viewer.renderer.composer.renderToScreen=!1,this._xrManager.enabled=!1;const e=this._xrManager.getCamera(),t=e.cameras[0]||e,n=this._viewer.scene.activeCamera;n.cameraObject.projectionMatrix.copy(t.projectionMatrix),n.cameraObject.projectionMatrixInverse.copy(n.cameraObject.projectionMatrix).invert()},this._postRender=()=>{var e,t;if(!this._dirty||!this._viewer||!this._xrSession)return;this._viewer.scene.activeCamera.cameraObject.updateProjectionMatrix();const n=this._viewer.renderer,r=(t=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera())===null||t===void 0?void 0:t.cameras[0].viewport;r?n.rendererObject.setViewport(r):console.warn("no viewport for ar camera"),qt(n.rendererObject,{sceneRender:!0,opaqueRender:!0,shadowMapRender:!1,backgroundRender:!1,transparentRender:!1,transmissionRender:!1,screenSpaceRendering:!1},()=>{ub.render(n.rendererObject,null,n.composer.readBuffer,0,!1)}),this._xrManager.enabled=!0,this._viewer.renderer.composer.renderToScreen=!0},this._frameCount=0,this._lastTime=0,this._preFrame=({xrFrame:e,deltaTime:t})=>{var n,r;if(this.dirty=!!e&&((n=this._xrManager)===null||n===void 0?void 0:n.isPresenting)||!1,this._viewer.scene.activeCamera.interactionsEnabled=!this._dirty,this._viewer.scene.activeCamera.autoLookAtTarget=!this._dirty,!this._dirty||!e)return void(this._xrSession&&this._xrSessionEnd());if(!this._xrSession&&!this._xrManager.getSession())return console.error("no xr session found, shouldn't happen"),void(this.dirty=!1);this._xrSession||console.log("webxr: AR session init"),this._frameCount++;const o=this._xrManager.getReferenceSpace(),a=e.getViewerPose(o);if(a==null&&this._frameCount,a==null||((r=this._viewer)===null||r===void 0?void 0:r.scene.modelRoot.children.length)===0)return this.dirty=!1,void console.log("no pose or no model");if(!this._xrSession){if(this._xrSession=this._xrManager.getSession()||void 0,!this._xrSession)return;this._frameCount=0,this._cancelHitSources(),this._savePreXRState(),this._preSetupModel(),this._xrSessionStart()}const u=this._viewer.scene.activeCamera;this._xrManager.updateCamera(u.cameraObject),u.setDirty(),this.moveToFloor(e),this._touchInputHelper.processInput(e),this._touchInputHelper.moveScene(t),this._updateShadow()},this.placeOnWall=!1,this._preXRState={viewerBg:null,modelScale:new c.Pa4(1,1,1),modelPosition:new c.Pa4,modelRotation:new c._fP,cameraPosition:new c.Pa4(0,0,5),cameraTarget:new c.Pa4,cameraUp:new c.Pa4(0,1,0),cameraAspect:1,cameraFov:50,cameraZoom:1,cameraNear:.01,cameraFar:100,groundOffset:new c.Pa4,groundScale:1},this._savePreXRState=()=>{if(!this._viewer)return;this._preXRState.viewerBg=this._viewer.getBackground(!0);const e=this._viewer.scene.modelRoot,t=this._viewer.scene.activeCamera;e.updateMatrix(),e.updateMatrixWorld(!0),this._preXRState.modelScale.copy(e.scale),this._preXRState.modelPosition.copy(e.position),this._preXRState.modelRotation.copy(e.quaternion),this._preXRState.cameraPosition.copy(t.position),this._preXRState.cameraTarget.copy(t.target),this._preXRState.cameraUp.copy(t.cameraObject.up),t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov=t.cameraObject.fov,this._preXRState.cameraAspect=t.cameraObject.aspect),this._preXRState.cameraZoom=t.cameraObject.zoom,this._preXRState.cameraNear=t.cameraObject.near,this._preXRState.cameraFar=t.cameraObject.far;const n=this._viewer.getPluginByType("Ground");n!=null&&n.mesh&&(this._preXRState.groundOffset.subVectors(e.position,n.mesh.modelObject.position),this._preXRState.groundScale=n.mesh.modelObject.scale.x,console.log("ground offset",this._preXRState.groundOffset,this._preXRState.groundScale),n.shadowBaker.enabled=!1)},this._xrSessionStart=()=>{if(!this._xrSession||!this._viewer)return;console.log("webxr: AR session start");const e=20*Math.PI/180,t=this.placeOnWall?void 0:new window.XRRay(new DOMPoint(0,0,0),{x:0,y:-Math.sin(e),z:-Math.cos(e)});this._touchInputHelper.placeOnWall=this.placeOnWall,this._viewer.resize(),(async()=>{var n,r;if(this._xrSession){const o=await this._xrSession.requestReferenceSpace("viewer");this._hitTestSource=await((r=(n=this._xrSession).requestHitTestSource)===null||r===void 0?void 0:r.call(n,{space:o,offsetRay:t}))}this._xrSession&&await this._touchInputHelper.setSession(this._xrSession,this._viewer.scene.modelRoot,this._xrManager,this._placementBox)})()},this._xrSessionEnd=()=>{var e;console.log("webxr: AR session end"),this._frameCount=0,(e=this._xrSession)===null||e===void 0||e.removeEventListener("end",this._xrSessionEnd),this._xrSession=void 0,this._cancelHitSources(),this._viewer&&(this._restorePreXRState(),this._viewer.resize())}}async onAdded(e){await super.onAdded(e);const t=e.renderer.rendererObject.xr;t.enabled=!0,t.cameraAutoUpdate=!1,this._xrManager=t;const n=document.getElementById("tweakpaneUiContainer"),r=n?{root:n}:void 0;document.body.appendChild(class{static createButton(o,a={}){const u=document.createElement("button");function p(){u.style.display="",u.style.cursor="auto",u.style.left="calc(50% - 75px)",u.style.width="150px",u.onmouseenter=null,u.onmouseleave=null,u.onclick=null}function f(m){m.style.position="absolute",m.style.bottom="20px",m.style.padding="12px 6px",m.style.border="1px solid #fff",m.style.borderRadius="4px",m.style.background="rgba(0,0,0,0.1)",m.style.color="#fff",m.style.font="normal 13px sans-serif",m.style.textAlign="center",m.style.opacity="0.5",m.style.outline="none",m.style.zIndex="999"}if("xr"in navigator)return u.id="ARButton",u.style.display="none",f(u),navigator.xr.isSessionSupported("immersive-ar").then(function(m){m?function(){if(a.domOverlay===void 0){const P=document.createElement("div");P.style.display="none",document.body.appendChild(P);const D=document.createElementNS("http://www.w3.org/2000/svg","svg");D.setAttribute("width",38),D.setAttribute("height",38),D.style.position="absolute",D.style.right="20px",D.style.top="20px",D.addEventListener("click",function(){y.end()}),P.appendChild(D);const j=document.createElementNS("http://www.w3.org/2000/svg","path");j.setAttribute("d","M 12,12 L 28,28 M 28,12 12,28"),j.setAttribute("stroke","#fff"),j.setAttribute("stroke-width",2),D.appendChild(j),a.optionalFeatures===void 0&&(a.optionalFeatures=[]),a.optionalFeatures.push("dom-overlay"),a.domOverlay={root:P}}let y=null;async function S(P){P.addEventListener("end",M),o.xr.setReferenceSpaceType("local"),await o.xr.setSession(P),u.textContent="STOP AR",a.domOverlay.root.style.display="",y=P}function M(){y.removeEventListener("end",M),u.textContent="START AR",a.domOverlay.root.style.display="none",y=null}u.style.display="",u.style.cursor="pointer",u.style.left="calc(50% - 50px)",u.style.width="100px",u.textContent="START AR",u.onmouseenter=function(){u.style.opacity="1.0"},u.onmouseleave=function(){u.style.opacity="0.5"},u.onclick=function(){y===null?navigator.xr.requestSession("immersive-ar",a).then(S):y.end()}}():(p(),u.textContent="AR NOT SUPPORTED")}).catch(function(m){p(),console.warn("Exception when trying to call xr.isSessionSupported",m),u.textContent="AR NOT ALLOWED"}),u;{const m=document.createElement("a");return window.isSecureContext===!1?(m.href=document.location.href.replace(/^http:/,"https:"),m.innerHTML="WEBXR NEEDS HTTPS"):(m.href="https://immersiveweb.dev/",m.innerHTML="WEBXR NOT AVAILABLE"),m.style.left="calc(50% - 90px)",m.style.width="180px",m.style.textDecoration="none",f(m),m}}}.createButton(e.renderer.rendererObject,{requiredFeatures:["hit-test"],optionalFeatures:["dom-overlay"],domOverlay:r})),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame)}_updateShadow(){if(!this._viewer)return;const e=this._viewer.scene.modelRoot,t=this._viewer.getPluginByType("Ground");t&&(t.groundReflection=!1,t.mesh.modelObject.position.copy(this._preXRState.groundOffset).multiplyScalar(e.modelObject.scale.x).sub(e.modelObject.position).negate(),t.mesh.modelObject.scale.setScalar(e.modelObject.scale.x*this._preXRState.groundScale))}moveToFloor(e){if(!this._dirty||!this._hitTestSource||!this._xrManager)return;const t=e.getHitTestResults(this._hitTestSource);if(!t.length)return;const n=t[0],r=this._touchInputHelper.getHitPoint(n);r&&(this._placementBox.show=!0,this._viewer.scene.modelRoot,this.placeOnWall?this._touchInputHelper.goalPosition.copy(r):this._touchInputHelper.goalPosition.y=r.y,this._hitTestSource.cancel(),this._hitTestSource=void 0,console.log("move to initial hit point",r))}_removePlacementBox(){this._placementBox&&(this._placementBox.dispose(),this._placementBox=void 0)}_preSetupModel(){var e;const t=this._viewer.scene.modelRoot,n=this._viewer.scene.activeCamera,r=(e=this._xrManager)===null||e===void 0?void 0:e.getCamera(),o=r.cameras[0]||r;this._removePlacementBox();const a=this._viewer.scene.getBounds(!0,!0);a.getSize(new c.Pa4).length()>.01&&(this._placementBox=new KE(a,r,this.placeOnWall),t.add(this._placementBox),this._placementBox.show=!1);const u=r.getWorldDirection(new c.Pa4);t.rotation.y=Math.atan2(-u.x,-u.z)-0,n.cameraObject.zoom=o.zoom,n.cameraObject.near=o.near,n.cameraObject.far=o.far,n.cameraObject.isPerspectiveCamera?(n.cameraObject.fov=o.fov,n.cameraObject.aspect=o.viewport.width/o.viewport.height):console.warn("Perspective camera required."),n.cameraObject.updateProjectionMatrix(),t.position.set(0,0,0);const p=t.userData.arScale||1;t.scale.set(p,p,p),t.position.copy(r.position).add(u.multiplyScalar(5)),t.visible=!0,this._viewer.setBackground(null)}_restorePreXRState(){if(!this._viewer)return;this._viewer.setBackground(this._preXRState.viewerBg),this._preXRState.viewerBg=null;const e=this._viewer.scene.modelRoot;e.scale.copy(this._preXRState.modelScale),e.position.copy(this._preXRState.modelPosition),e.quaternion.copy(this._preXRState.modelRotation),e.updateMatrix(),e.updateMatrixWorld(!0),e.visible=!0;const t=this._viewer.scene.activeCamera;t.position.copy(this._preXRState.cameraPosition),t.target.copy(this._preXRState.cameraTarget),t.cameraObject.up.copy(this._preXRState.cameraUp),t.cameraObject.near=this._preXRState.cameraNear,t.cameraObject.far=this._preXRState.cameraFar,t.cameraObject.isPerspectiveCamera&&(this._preXRState.cameraFov!==void 0&&(t.cameraObject.fov=this._preXRState.cameraFov),this._preXRState.cameraAspect!==void 0&&(t.cameraObject.aspect=this._preXRState.cameraAspect)),t.positionUpdated(!1),t.targetUpdated(!0),t.cameraObject.updateMatrixWorld(!0),t.cameraObject.updateProjectionMatrix()}_cancelHitSources(){this._hitTestSource&&(this._hitTestSource.cancel(),this._hitTestSource=void 0),this._touchInputHelper.cancel()}}JE.PluginType="WEBXR_ARPlugin";const ub=new te({vertexShader:C.vertexShader,fragmentShader:`
    uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			vec4 texel = texture2D( tDiffuse, vUv );
			// gl_FragColor = vec4(1,0,1,1);
			gl_FragColor = texel;

		}
		`,uniforms:C.uniforms});async function $E(s,e){if(s.createWriter){const n=await s.createWriter();return await n.write(0,e),void await n.close()}const t=await s.createWritable();await t.write(e),await t.close()}async function mT(s,e){const t={};return e&&(t.writable=!0,t.mode="readwrite"),await s.queryPermission(t)==="granted"||await s.requestPermission(t)==="granted"}ub.renderToScreen=!1,ub.useExistingRenderTarget=!0,ub.clear=!1;class p0 extends w{constructor(e,t){super(),this._state="stopped",this._console=console,this._currentRecording=[],this._currentImages=[],this.stepMode=!1,this._resumeSyncTime=0,this._frameCount=0,this._onstop=r=>{var o;if(this._state="stopped",this._recorder&&this._currentRecording.length>0){const a=new Blob(this._currentRecording,{type:this._options.mimeType});(o=this._recordingCallback)===null||o===void 0||o.call(this,a)}else this._currentImages.length>0&&(this._writeImages([...this._currentImages]),this._currentImages=[]);this._recorder=void 0,this.dispatchEvent({type:"stop"})},this._onstart=r=>{var o;this._state="recording",this._frameCount=0,this.dispatchEvent({type:"start"}),this.stepMode&&((o=this._recorder)===null||o===void 0||o.pause())},this._onresume=r=>{if(!this.stepMode)return;const o=()=>{var u;this._state==="recording"&&((u=this._recorder)===null||u===void 0||u.pause())},a=Math.min(this._resumeSyncTime-Mi(),0)+1e3/this._options.frameRate;a>0?is(a).then(o):o()},this._onpause=r=>{},this._ondataavailable=r=>{r.data&&r.data.size>0&&this._currentRecording.push(r.data)},this._onerror=r=>{this._state="error",this._console.error(r),this.dispatchEvent({type:"error",error:r}),this._recorder=void 0},this._canvas=e;const n=t==null?void 0:t.mimeType;this._options={mimeType:n||"auto",frameRate:30},this._setOptions(t||this._options)}_setOptions(e){var t,n;Object.assign(this._options,e),this._options.mimeType&&this._options.mimeType!=="auto"||(this._options.mimeType=(t=p0.GetSupportedMimeTypes([],["h264"],!0))!==null&&t!==void 0?t:p0.GetSupportedMimeTypes(void 0,void 0,!0)),this._options.mimeType&&!(!((n=this._options.mimeType)===null||n===void 0)&&n.startsWith("video/"))||window.MediaRecorder||(this._console.warn("MediaRecorder is not supported, switching to png"),this._options.mimeType="image/png"),this._options.mimeType||console.warn(new Error("No supported mimetype found"))}setOptions(e){this._setOptions(e)}isRecording(){return this._state==="recording"}start(){var e,t,n;if(this._state==="recording")return void this._console.log("Already recording canvas");if(this._state==="error"&&(this._recorder=void 0,this._console.warn("Resetting from error state.")),this._recorder)return this._state==="paused"?(this.dispatchEvent({type:"starting"}),void this._recorder.resume()):void this._console.warn("Canvas recorder unknown state",this._state);if(this._state==="paused")return this.dispatchEvent({type:"starting"}),void(this._state="recording");const r={mimeType:this._options.mimeType,videoBitsPerSecond:this._options.videoBitsPerSecond};if(this._currentRecording=[],this._currentImages=[],this._frameCount=0,(e=r.mimeType)===null||e===void 0?void 0:e.startsWith("video")){if(!window.MediaRecorder)return this._console.error("MediaRecorder not supported, use image sequence"),void(this._state="error");{const o=this._canvas.captureStream(this.stepMode?0:this._options.frameRate),a=(t=o.getVideoTracks())===null||t===void 0?void 0:t[0];this._track=a,this._recorder=new window.MediaRecorder(o,r),this._recorder.onstop=this._onstop,this._recorder.ondataavailable=this._ondataavailable,this._recorder.onerror=this._onerror,this._recorder.onresume=this._onresume,this._recorder.onstart=this._onstart}}this.dispatchEvent({type:"starting"}),this._recorder?(this._state="recording",(n=this._recorder)===null||n===void 0||n.start()):window.showDirectoryPicker&&window.showDirectoryPicker().then(async o=>{const a=await(o==null?void 0:o.getDirectoryHandle("i-"+Math.floor(Date.now()),{create:!0}));this._imgDirectory=a,this._state="recording",this._onstart({})}).catch(o=>{this._onerror({detail:o})})}async requestFrame(){if(this._state!=="recording")return;this._frameCount++;const e=this._options.mimeType;if(!this._recorder&&e.startsWith("image/")){const t=this._canvas.toDataURL(e,90);this._currentImages.push(["frame_"+String(this._frameCount).padStart(5,"0")+(e.includes("png")?".png":".jpg"),t]),this._currentImages.length>60&&(this._writeImages([...this._currentImages]),this._currentImages=[])}this._recorder&&this._track&&this.stepMode&&(this._resumeSyncTime=Mi(),this._track.requestFrame(),this._recorder.resume())}pause(){this._state!=="paused"&&this._state!=="stopped"&&(this._recorder?this._recorder.pause():this._state="paused")}stop(e){this._state!=="stopped"&&(this._state!=="error"?(this._recordingCallback=e,this.dispatchEvent({type:"stopping"}),this._recorder?this._recorder.stop():this._onstop({})):this._console.error("Recorder in error state, cannot stop, call start again."))}get state(){return this._state}dispose(){this._recorder&&this._state!=="error"?this.stop(e=>{this._console.warn("disposed with blob",e),this.dispose()}):this._recorder=void 0}async _writeImages(e){if(!this._imgDirectory)return;const t=await Promise.all(e.map(async([r,o])=>await(await fetch(o)).blob())),n=[];for(let r=0;r<e.length;r++){const o=await this._imgDirectory.getFileHandle(e[r][0],{create:!0});n.push($E(o,t[r]))}await Promise.all(n)}static GetSupportedMimeTypes(e,t,n=!1){if(!window.MediaRecorder)return n?void 0:[];const r=["webm","ogg","mp4","x-matroska"].filter(u=>!e||e.length<1||e.includes(u)),o=["vp9","vp9.0","vp8","vp8.0","avc1","av1","h265","h.265","h264","h.264","opus"].filter(u=>!t||t.length<1||t.includes(u)),a=[];return r.forEach(u=>{const p=`video/${u}`;o.forEach(f=>{[`${p};codecs=${f}`,`${p};codecs:${f}`,`${p};codecs=${f.toUpperCase()}`,`${p};codecs:${f.toUpperCase()}`,`${p}`].forEach(m=>{MediaRecorder.isTypeSupported(m)&&a.push(m)})})}),n?a.length>0?a[0]:void 0:a}}var sx=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class ph extends ui{constructor(){super(...arguments),this.enabled=!0,this.convergeMode=!1,this.mimeType="auto",this.videoFrameRate=30,this._renderToScreenDisabled=!1,this._preRender=()=>{var e,t,n;if(this.convergeMode&&(!((e=this._recorder)===null||e===void 0)&&e.isRecording())){const r=this._viewer.renderer.composer.renderToScreen;this._viewer.renderer.composer.renderToScreen=((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||n===void 0?void 0:n.isConverged())||!1,r&&!this._viewer.renderer.composer.renderToScreen&&(this._renderToScreenDisabled=!0)}},this._postRender=()=>{var e,t,n;if(!((e=this._recorder)===null||e===void 0)&&e.isRecording()&&(!this.convergeMode||!((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Progressive"))===null||n===void 0)&&n.isConverged(!0))){const r=()=>{var o;return(o=this._recorder)===null||o===void 0?void 0:o.requestFrame()};this.convergeMode?is(1).then(r):r()}this._renderToScreenDisabled&&(this._viewer.renderer.composer.renderToScreen=!0)}}get recorder(){return this._recorder}isRecording(){var e,t;return(t=(e=this._recorder)===null||e===void 0?void 0:e.isRecording())!==null&&t!==void 0&&t}refreshRecorderOptions(){this._recorder&&(this._recorder.setOptions({frameRate:this.videoFrameRate,mimeType:this.mimeType}),this._recorder.stepMode=this.convergeMode)}async onAdded(e){await super.onAdded(e),this._recorder=new p0(e.canvas,{frameRate:this.videoFrameRate,mimeType:this.mimeType}),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),this._recorder.addEventListener("starting",()=>this._stateChange(!1)),this._recorder.addEventListener("start",()=>{this.dispatchEvent({type:"start"}),this._stateChange(!this.convergeMode)}),this._recorder.addEventListener("error",()=>{this.dispatchEvent({type:"error"})}),this._recorder.addEventListener("pause",()=>this._stateChange(!1)),this._recorder.addEventListener("resume",()=>this._stateChange(!this.convergeMode)),this._recorder.addEventListener("stop",()=>{this.dispatchEvent({type:"stop"}),this._stateChange(!1)})}_stateChange(e){var t,n,r;this.dirty=e,(t=this._viewer)===null||t===void 0||t.setDirty(),(r=(n=this._uiConfig)===null||n===void 0?void 0:n.children)===null||r===void 0||r.map(o=>Se(o)).flat(2).forEach(o=>{var a;return(a=o==null?void 0:o.uiRefresh)===null||a===void 0?void 0:a.call(o)})}async onRemove(e){var t;return e.removeEventListener("preRender",this._preRender),e.removeEventListener("preRender",this._postRender),(t=this._recorder)===null||t===void 0||t.dispose(),super.onRemove(e)}startRecording(){var e;return!!this.enabled&&((e=this.recorder)===null||e===void 0?void 0:e.isRecording())===!1&&(this.recorder.stepMode=this.convergeMode,this.recorder.start(),!0)}async stopRecording(){var e;if(!((e=this.recorder)===null||e===void 0)&&e.isRecording())return new Promise((t,n)=>{var r;return(r=this.recorder)===null||r===void 0?void 0:r.stop(t)})}get uiConfig(){if(this._uiConfig)return this._uiConfig;const e=this;return this._uiConfig={type:"folder",label:"Video Export",children:[{type:"slider",label:"Frame Rate",bounds:[1,60],stepSize:1,property:[this,"videoFrameRate"]},{type:"checkbox",limitedUi:!0,property:[this,"convergeMode"]},{type:"dropdown",label:"Mime type",limitedUi:!0,property:[this,"mimeType"],children:[["Auto Video (x264)","auto"],["PNG sequence","image/png"],["JPEG sequence","image/jpeg"]].map(t=>({label:t[0],value:t[1]}))},{type:"input",disabled:!0,label:"State",limitedUi:!0,get value(){var t,n;return(n=(t=e.recorder)===null||t===void 0?void 0:t.state)!==null&&n!==void 0?n:"not initialized"},set value(t){}},{type:"button",get label(){var t;return!((t=e.recorder)===null||t===void 0)&&t.isRecording()?"Stop":"Start"},value:()=>{var t;!((t=e.recorder)===null||t===void 0)&&t.isRecording()?this.stopRecording().then(n=>{if(n){console.log(n);const r=n.type.split(";")[0].split("/").pop()||"mp4";Ss(n,"test."+r)}}):this.startRecording()}},{type:"button",limitedUi:!0,label:"Record Camera Views",hidden:()=>{var t,n;return!!(!((t=e.recorder)===null||t===void 0)&&t.isRecording())||!(!((n=this._viewer)===null||n===void 0)&&n.getPluginByType("CameraViews"))},value:()=>{var t,n;(n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("CameraViews"))===null||n===void 0||n.recordAllViews()}},{type:"button",limitedUi:!0,label:"Record Camera Views + GLTF Anim",hidden:()=>{var t,n,r,o;return!!(!((t=e.recorder)===null||t===void 0)&&t.isRecording())||!(!((n=this._viewer)===null||n===void 0)&&n.getPluginByType("CameraViews"))||!(!((o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("GLTFAnimation"))===null||o===void 0)&&o.animations.length)},value:()=>{var t,n,r,o;const a=((n=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("GLTFAnimation"))===null||n===void 0?void 0:n.animationState)==="playing";(o=(r=this._viewer)===null||r===void 0?void 0:r.getPluginByType("CameraViews"))===null||o===void 0||o.recordAllViews(()=>{var u,p;(p=(u=this._viewer)===null||u===void 0?void 0:u.getPluginByType("GLTFAnimation"))===null||p===void 0||p.playAnimation()}).then(()=>{var u,p;a||(p=(u=this._viewer)===null||u===void 0?void 0:u.getPluginByType("GLTFAnimation"))===null||p===void 0||p.stopAnimation()})}}]}}}ph.PluginType="CanvasRecorder",sx([we(ph.prototype.refreshRecorderOptions),et()],ph.prototype,"convergeMode",void 0),sx([we(ph.prototype.refreshRecorderOptions),et()],ph.prototype,"mimeType",void 0),sx([we(ph.prototype.refreshRecorderOptions),et()],ph.prototype,"videoFrameRate",void 0);var hb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const ox=new c.jyz({uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float h;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

			gl_FragColor = sum;

		}`});ox.depthTest=!1;const ax=new c.jyz({uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform sampler2D tDiffuse;
		uniform float v;

		varying vec2 vUv;

		void main() {

			vec4 sum = vec4( 0.0 );

			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
			sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

			gl_FragColor = sum;

		}`});ax.depthTest=!1;class fh extends Co{constructor(e={},t=!1){super(e),this.contactShadows=!0,this.blurAmount=1,this.shadowScale=1,this.shadowHeight=5,this.shadowCamera=new c.iKG(-1,1,1,-1,.001,this.shadowHeight),this._refreshShadowCameraFrustum=this._refreshShadowCameraFrustum.bind(this),this.refreshOptions=this.refreshOptions.bind(this),this._showDebug=t,t&&this.dependencies.push(Pl)}async onAdded(e){const t=e.renderer.createTarget({type:c.ywz,format:c.wk1,encoding:c.rnI,size:{width:512,height:512},generateMipmaps:!1,depthBuffer:!0,minFilter:c.wem,magFilter:c.wem});t.texture.name="groundContactDepthTexture";const n=new c.lRF({depthPacking:c.z81});n.onBeforeCompile=function(o){o.uniforms.opacity.value=1,o.fragmentShader=`
						${o.fragmentShader.replace("gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );","gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), 1.0 );")}
					`};const r=new q0(t,n);this._depthPass=r,await super.onAdded(e)}_postFrame(){super._postFrame(),this._viewer}_preRender(){if(super._preRender(),!this._viewer||!this._depthPass)return;this._depthPass.scene=this._viewer.scene.modelObject,this._depthPass.camera=this.shadowCamera,this._depthPass.render(this._viewer.renderer.rendererObject);const e=this._viewer.renderer.getTempTarget({type:c.ywz,format:c.wk1,encoding:c.rnI,size:{width:1024,height:1024},generateMipmaps:!1,depthBuffer:!1,minFilter:c.wem,magFilter:c.wem});this._blurShadow(e),this._blurShadow(e,.4),this._viewer.renderer.releaseTempTarget(e)}_blurShadow(e,t=1){this._viewer&&this._depthPass&&(ox.uniforms.h.value=t*this.blurAmount/256,ax.uniforms.v.value=t*this.blurAmount/256,this._viewer.renderer.blit(this._depthPass.target.texture,e,{material:ox,clear:!0}),this._viewer.renderer.blit(e.texture,this._depthPass.target,{material:ax,clear:!0}))}async onDispose(e){return super.onDispose(e)}async onRemove(e){return super.onRemove(e)}_refreshTransform(){super._refreshTransform(),this._mesh&&this._viewer&&(this.shadowCamera.position.copy(this._mesh.getWorldPosition(new c.Pa4)),this.shadowCamera.setRotationFromEuler(new c.USm(Math.PI/2,0,0)),this.shadowCamera.updateMatrixWorld(),this._refreshShadowCameraFrustum(),this._mesh.scale.y=-this.size)}_refreshShadowCameraFrustum(){this.shadowCamera&&(this.shadowCamera.left=-this.size/(2*this.shadowScale),this.shadowCamera.right=this.size/(2*this.shadowScale),this.shadowCamera.top=this.size/(2*this.shadowScale),this.shadowCamera.bottom=-this.size/(2*this.shadowScale),this.shadowCamera.far=this.shadowHeight,this.shadowCamera.updateProjectionMatrix(),this._setDirty())}_setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}_removeMaterial(){this._material&&super._removeMaterial()}refreshOptions(){this._viewer&&super.refreshOptions()}_refreshMaterial(){var e;if(!this._viewer)return!1;const t=super._refreshMaterial();return this._material&&(this._material.alphaMap=((e=this._depthPass)===null||e===void 0?void 0:e.target.texture)||null,t&&(this._material.roughness=1,this._material.metalness=0,this._material.color.set(1118481),this._material.transparent=!0,this._material.materialObject.userData.ssreflDisabled=!0,this._material.materialObject.userData.ssreflNonPhysical=!1)),t}_extraUiConfig(){return[{label:"Contact Shadows",type:"checkbox",property:[this,"contactShadows"]},{label:"Shadow Scale",type:"slider",bounds:[0,2],property:[this,"shadowScale"]},{label:"Shadow Height",type:"slider",bounds:[0,20],property:[this,"shadowHeight"]},{label:"Blur Amount",type:"slider",bounds:[0,10],property:[this,"blurAmount"]},...super._extraUiConfig()]}}fh.PluginType="ContactShadowGroundPlugin",hb([we(fh.prototype.refreshOptions),et()],fh.prototype,"contactShadows",void 0),hb([et(),we(fh.prototype._setDirty)],fh.prototype,"blurAmount",void 0),hb([et(),we(fh.prototype._refreshShadowCameraFrustum)],fh.prototype,"shadowScale",void 0),hb([et(),we(fh.prototype._refreshShadowCameraFrustum)],fh.prototype,"shadowHeight",void 0);const a_=new c.cPb(45,1,.1,1e3);function lx(s,e,t,n=7,r=new c.Pa4(0,0,1.5)){t=t??s.scene.modelObject;const o=new _t().expandByObject(t??e,!0,!0),a=o.getCenter(new c.Pa4),u=o.getSize(new c.Pa4);a_.position.copy(a).add(r.clone().multiplyScalar(Math.max(u.x,u.y,u.z))),a_.lookAt(a),e&&e.traverseVisible(m=>{m.layers.enable(n)}),n>0?a_.layers.set(n):a_.layers.enableAll();const p=e==null?void 0:e.visible;e&&(e.visible=!0),s.renderer.rendererObject.setRenderTarget(null),s.renderer.rendererObject.render(t,a_);const f=s.renderer.rendererObject.domElement.toDataURL("image/png");return e&&(e.visible=p,e.traverseVisible(m=>{m.layers.disable(n)}),a_.layers.enableAll()),s.setDirty(),f}class cx{constructor(e){this.viewer=e,this._lights=[],this.shapes={sphere:new c.Kj0(new c.xo$(1)),cube:new c.Kj0(new c.DvJ(1,1,1)),cylinder:new c.Kj0(new c.fHI(.5,.5,1))};const t=new c.xsS;this._channel=7;const n=new c.vmT(16777215,4473924,1);n.position.set(0,10,0),n.layers.set(this._channel),t.add(n),this._lights.push(n),this._scene=t}dispose(){[...this._lights].forEach(e=>e.dispose()),Object.values(this.shapes).forEach(e=>{e.geometry&&e.geometry.dispose()})}generate(e,t="sphere"){const n=this.shapes[t]||new c.Kj0(new c.xo$(1));n.material=e.materialObject,n.geometry.attributes.tangent||n.geometry.computeTangents(),this._scene.add(n),this._scene.environment=this.viewer.scene.getEnvironment();const r=n.material.envMapIntensity;typeof r=="number"&&(n.material.envMapIntensity=Math.max(r,2));const o=lx(this.viewer,n,this._scene,this._channel,new c.Pa4(0,0,1.5));return typeof r=="number"&&(n.material.envMapIntensity=r),this._scene.remove(n),n.material=void 0,o}}class db extends ui{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e))},this.dependencies=[dn],this.variations=[],this._selectedMaterial=()=>{var e,t;return((t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())===null||t===void 0?void 0:t.material)||void 0},this.uiConfig={label:"Material Configurator",type:"folder",children:[()=>{var e;return[{type:"input",label:"uuid",property:[this._selectedMaterial(),"uuid"],hidden:()=>!this._selectedMaterial(),disabled:!0},{type:"input",label:"title",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"title"],onChange:async()=>this.refreshUi()},{type:"dropdown",label:"Preview Type",hidden:()=>!this._selectedMaterial(),property:()=>[this.getSelectedVariation(),"preview"],onChange:async()=>this.refreshUi(),children:["generate:sphere","generate:cube","color","map","emissive",...Object.keys(kp).filter(t=>t.endsWith("Map"))].map(t=>({label:t,value:t}))},...((e=this.getSelectedVariation())===null||e===void 0?void 0:e.materials.map(t=>t.uiConfig?Object.assign(t.uiConfig,{expanded:!1}):{}))||[],{type:"button",label:"Remove All",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove all variations for this material?")&&(t.materials=[]),this.refreshUi()}},{type:"button",label:"Remove Variation",hidden:()=>!this._selectedMaterial(),value:async()=>{const t=this.getSelectedVariation();t&&await this._viewer.confirm("Material configurator: Remove this variation?")&&this.removeVariation(t)}},{type:"button",label:"Add Variation",hidden:()=>!this._selectedMaterial(),value:()=>this.addVariation(this._selectedMaterial())},{type:"button",label:"Refresh Ui",value:()=>this.refreshUi()}]}]}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new cx(this._viewer),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}fromJSON(e,t){return this.variations=[],super.fromJSON(e,t)}async onRemove(e){var t,n;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(n=this._picking)===null||n===void 0||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}findVariation(e){return e?this.variations.find(t=>t.uuid===e):void 0}getSelectedVariation(){var e,t;return this.findVariation((e=this._selectedMaterial())===null||e===void 0?void 0:e.uuid)||this.findVariation((t=this._selectedMaterial())===null||t===void 0?void 0:t.name)}applyVariation(e,t){var n,r;const o=e.materials.find(a=>a.uuid===t);if(o){const a=(r=(n=this._viewer)===null||n===void 0?void 0:n.getManager())===null||r===void 0?void 0:r.materials;let u=a==null?void 0:a.findMaterialsByName(e.uuid);(!u||u.length<1)&&(u=[a==null?void 0:a.findMaterial(e.uuid)]),u.forEach(p=>{if(!p)return;const f=p.name;p.copyProps(o),p.name=f})}}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return!(!this.enabled||!this._viewer||!this._uiNeedRefresh||(this._uiNeedRefresh=!1,this._refreshUiConfig(),0))}removeVariationForMaterial(e){let t=this.findVariation(e.uuid);!t&&e.name.length>0&&(t=this.findVariation(e.name)),t&&this.removeVariation(t)}removeVariation(e){e&&(this.variations.splice(this.variations.indexOf(e),1),this.refreshUi())}addVariation(e){var t;const n=(t=e==null?void 0:e.clone)===null||t===void 0?void 0:t.call(e);if(e&&n){let r=this.findVariation(e.uuid);!r&&e.name.length>0&&(r=this.findVariation(e.name)),r||this.variations.push(r={uuid:e.name.length>0?e.name:e.uuid,title:"Name",preview:"generate:sphere",materials:[]}),r.materials.push(n),this.refreshUi()}}}db.PluginType="MaterialConfiguratorBasePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([et()],db.prototype,"variations",void 0);const ZE=(s,e=!0)=>{const t=new Sn().set(s);return e&&t.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Crect width='16' height='16' fill='%23${t.getHexString()}'/%3E%3C/svg%3E%0A`},eS=(s,e=!0)=>{const t=new Sn().set(s);return e&&t.convertLinearToSRGB(),`data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='8' cy='8' r='7' fill='%23${t.getHexString()}'/%3E%3C/svg%3E%0A`},f0=s=>`data:image/svg+xml,%3Csvg viewBox='0 0 80 14' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext style='font: 8px "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace; fill: white;' x='9' y='9'%3E${s}%3C/text%3E%3C/svg%3E%0A`,ux=async(s,e)=>Cs(await bd(s),e),tS=async(s,e)=>await ux(s,e).then(t=>t.toDataURL("image/png"));class _u{static _initialize(){this._inited=!0,ql(se`
  .customContextGrid {
    background: #28223C;
    //backdrop-filter: blur(8px);
    border: 0.5px solid rgba(220, 220, 220, 0.3);
    width: auto;
    height: auto;
    position: absolute;
    display: flex;
    flex-direction: row;
    flex-wrap: wrap;
    z-index: 200;
    padding: 0.35rem 0.35rem;
    border-radius: 0.375rem;
    min-width: 5rem;
    pointer-events: auto;
    box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);

    color: white;
    font-size: 0.65rem;
    font-family: Inter, "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
  }
  .customContextGridItems {
    background-color: transparent;
    cursor: pointer;
    border-radius: 0.25rem;
    line-height: 1rem;
    font-weight: 500;
    overflow: hidden;
    margin: 0.12rem;
  }
  .customContextGridItems:hover {
    color: white;
    background-color: #017AFF;
  }
  .customContextGridItemImage{
    width: 100%;
    height: 100%;
  }
  .customContextGridHeading{
    width: 100%;
    padding: 0.12rem;
    font-size: 0.85rem;
  }

        `)}static Create(e,t,n,r,o,a,u){var p;this._inited||this._initialize();const f=Bp(),m=f?.15:.25,y=f?1.5:2.5,S=Cr({classList:["customContextGrid"],addToBody:!1,innerHTML:`
            <div class="customContextGridHeading"> ${t} </div>
            `});S.style.top=o+"px",S.style.left=r+"px",S.style.gap=m+"rem",S.style.width=(y+m)*n-m+"rem",S.dataset.tag=e;for(const M of a){const P=Cr({classList:["customContextGridItems"],addToBody:!1,innerHTML:`
            <img src="${M.image}" class="customContextGridItemImage">
            `});P.style.width=y+"rem",P.style.height=y+"rem",S.appendChild(P),P.onclick=()=>{var D;return(D=M.onClick)===null||D===void 0?void 0:D.call(M,M.id)},u(P,M)}return(p=this.Elements)===null||p===void 0||p.push(S),S}static RemoveAll(e){if(e){const t=this.Elements.filter(n=>n.dataset.tag===e);for(const n of t)n.remove();this.Elements=this.Elements.filter(n=>n.dataset.tag!==e)}else{for(const t of this.Elements)t.remove();this.Elements=[]}}static RebuildUi(e){if(this.Elements.length===0)return;e||(e=document.body);for(const n of this.Elements)n.remove();let t=20;for(const n of this.Elements)n.style.top=t+"px",e.appendChild(n),t+=n.clientHeight+20}}function vu(s){if(s==null)return window;if(s.toString()!=="[object Window]"){var e=s.ownerDocument;return e&&e.defaultView||window}return s}function l_(s){return s instanceof vu(s).Element||s instanceof Element}function bc(s){return s instanceof vu(s).HTMLElement||s instanceof HTMLElement}function hx(s){return typeof ShadowRoot<"u"&&(s instanceof vu(s).ShadowRoot||s instanceof ShadowRoot)}_u.Elements=[],_u._inited=!1;var hm=Math.max,pb=Math.min,c_=Math.round;function u_(s,e){e===void 0&&(e=!1);var t=s.getBoundingClientRect(),n=1,r=1;if(bc(s)&&e){var o=s.offsetHeight,a=s.offsetWidth;a>0&&(n=c_(t.width)/a||1),o>0&&(r=c_(t.height)/o||1)}return{width:t.width/n,height:t.height/r,top:t.top/r,right:t.right/n,bottom:t.bottom/r,left:t.left/n,x:t.left/n,y:t.top/r}}function dx(s){var e=vu(s);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function mh(s){return s?(s.nodeName||"").toLowerCase():null}function xp(s){return((l_(s)?s.ownerDocument:s.document)||window.document).documentElement}function px(s){return u_(xp(s)).left+dx(s).scrollLeft}function ud(s){return vu(s).getComputedStyle(s)}function fx(s){var e=ud(s),t=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(t+r+n)}function gT(s,e,t){t===void 0&&(t=!1);var n,r,o=bc(e),a=bc(e)&&function(y){var S=y.getBoundingClientRect(),M=c_(S.width)/y.offsetWidth||1,P=c_(S.height)/y.offsetHeight||1;return M!==1||P!==1}(e),u=xp(e),p=u_(s,a),f={scrollLeft:0,scrollTop:0},m={x:0,y:0};return(o||!o&&!t)&&((mh(e)!=="body"||fx(u))&&(f=(n=e)!==vu(n)&&bc(n)?{scrollLeft:(r=n).scrollLeft,scrollTop:r.scrollTop}:dx(n)),bc(e)?((m=u_(e,!0)).x+=e.clientLeft,m.y+=e.clientTop):u&&(m.x=px(u))),{x:p.left+f.scrollLeft-m.x,y:p.top+f.scrollTop-m.y,width:p.width,height:p.height}}function mx(s){var e=u_(s),t=s.offsetWidth,n=s.offsetHeight;return Math.abs(e.width-t)<=1&&(t=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:s.offsetLeft,y:s.offsetTop,width:t,height:n}}function fb(s){return mh(s)==="html"?s:s.assignedSlot||s.parentNode||(hx(s)?s.host:null)||xp(s)}function nS(s){return["html","body","#document"].indexOf(mh(s))>=0?s.ownerDocument.body:bc(s)&&fx(s)?s:nS(fb(s))}function m0(s,e){var t;e===void 0&&(e=[]);var n=nS(s),r=n===((t=s.ownerDocument)==null?void 0:t.body),o=vu(n),a=r?[o].concat(o.visualViewport||[],fx(n)?n:[]):n,u=e.concat(a);return r?u:u.concat(m0(fb(a)))}function _T(s){return["table","td","th"].indexOf(mh(s))>=0}function iS(s){return bc(s)&&ud(s).position!=="fixed"?s.offsetParent:null}function g0(s){for(var e=vu(s),t=iS(s);t&&_T(t)&&ud(t).position==="static";)t=iS(t);return t&&(mh(t)==="html"||mh(t)==="body"&&ud(t).position==="static")?e:t||function(n){var r=navigator.userAgent.toLowerCase().indexOf("firefox")!==-1;if(navigator.userAgent.indexOf("Trident")!==-1&&bc(n)&&ud(n).position==="fixed")return null;var o=fb(n);for(hx(o)&&(o=o.host);bc(o)&&["html","body"].indexOf(mh(o))<0;){var a=ud(o);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||r&&a.willChange==="filter"||r&&a.filter&&a.filter!=="none")return o;o=o.parentNode}return null}(s)||e}var Oa="top",Fl="bottom",Ul="right",La="left",mb="auto",h_=[Oa,Fl,Ul,La],dm="start",d_="end",rS="clippingParents",gx="viewport",p_="popper",sS="reference",_x=h_.reduce(function(s,e){return s.concat([e+"-"+dm,e+"-"+d_])},[]),vx=[].concat(h_,[mb]).reduce(function(s,e){return s.concat([e,e+"-"+dm,e+"-"+d_])},[]),oS="beforeRead",aS="read",lS="afterRead",cS="beforeMain",uS="main",hS="afterMain",dS="beforeWrite",pS="write",fS="afterWrite",mS=[oS,aS,lS,cS,uS,hS,dS,pS,fS];function vT(s){var e=new Map,t=new Set,n=[];function r(o){t.add(o.name),[].concat(o.requires||[],o.requiresIfExists||[]).forEach(function(a){if(!t.has(a)){var u=e.get(a);u&&r(u)}}),n.push(o)}return s.forEach(function(o){e.set(o.name,o)}),s.forEach(function(o){t.has(o.name)||r(o)}),n}var gS={placement:"bottom",modifiers:[],strategy:"absolute"};function _S(){for(var s=arguments.length,e=new Array(s),t=0;t<s;t++)e[t]=arguments[t];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function gb(s){s===void 0&&(s={});var e=s,t=e.defaultModifiers,n=t===void 0?[]:t,r=e.defaultOptions,o=r===void 0?gS:r;return function(a,u,p){p===void 0&&(p=o);var f,m,y={placement:"bottom",orderedModifiers:[],options:Object.assign({},gS,o),modifiersData:{},elements:{reference:a,popper:u},attributes:{},styles:{}},S=[],M=!1,P={state:y,setOptions:function(j){var k=typeof j=="function"?j(y.options):j;D(),y.options=Object.assign({},o,y.options,k),y.scrollParents={reference:l_(a)?m0(a):a.contextElement?m0(a.contextElement):[],popper:m0(u)};var L,R,W=function(q){var J=vT(q);return mS.reduce(function(ee,he){return ee.concat(J.filter(function(xe){return xe.phase===he}))},[])}((L=[].concat(n,y.options.modifiers),R=L.reduce(function(q,J){var ee=q[J.name];return q[J.name]=ee?Object.assign({},ee,J,{options:Object.assign({},ee.options,J.options),data:Object.assign({},ee.data,J.data)}):J,q},{}),Object.keys(R).map(function(q){return R[q]})));return y.orderedModifiers=W.filter(function(q){return q.enabled}),y.orderedModifiers.forEach(function(q){var J=q.name,ee=q.options,he=ee===void 0?{}:ee,xe=q.effect;if(typeof xe=="function"){var De=xe({state:y,name:J,instance:P,options:he});S.push(De||function(){})}}),P.update()},forceUpdate:function(){if(!M){var j=y.elements,k=j.reference,L=j.popper;if(_S(k,L)){y.rects={reference:gT(k,g0(L),y.options.strategy==="fixed"),popper:mx(L)},y.reset=!1,y.placement=y.options.placement,y.orderedModifiers.forEach(function(xe){return y.modifiersData[xe.name]=Object.assign({},xe.data)});for(var R=0;R<y.orderedModifiers.length;R++)if(y.reset!==!0){var W=y.orderedModifiers[R],q=W.fn,J=W.options,ee=J===void 0?{}:J,he=W.name;typeof q=="function"&&(y=q({state:y,options:ee,name:he,instance:P})||y)}else y.reset=!1,R=-1}}},update:(f=function(){return new Promise(function(j){P.forceUpdate(),j(y)})},function(){return m||(m=new Promise(function(j){Promise.resolve().then(function(){m=void 0,j(f())})})),m}),destroy:function(){D(),M=!0}};if(!_S(a,u))return P;function D(){S.forEach(function(j){return j()}),S=[]}return P.setOptions(p).then(function(j){!M&&p.onFirstUpdate&&p.onFirstUpdate(j)}),P}}var AT=gb(),_b={passive:!0},Ax={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(s){var e=s.state,t=s.instance,n=s.options,r=n.scroll,o=r===void 0||r,a=n.resize,u=a===void 0||a,p=vu(e.elements.popper),f=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&f.forEach(function(m){m.addEventListener("scroll",t.update,_b)}),u&&p.addEventListener("resize",t.update,_b),function(){o&&f.forEach(function(m){m.removeEventListener("scroll",t.update,_b)}),u&&p.removeEventListener("resize",t.update,_b)}},data:{}};function gh(s){return s.split("-")[0]}function f_(s){return s.split("-")[1]}function yx(s){return["top","bottom"].indexOf(s)>=0?"x":"y"}function vS(s){var e,t=s.reference,n=s.element,r=s.placement,o=r?gh(r):null,a=r?f_(r):null,u=t.x+t.width/2-n.width/2,p=t.y+t.height/2-n.height/2;switch(o){case Oa:e={x:u,y:t.y-n.height};break;case Fl:e={x:u,y:t.y+t.height};break;case Ul:e={x:t.x+t.width,y:p};break;case La:e={x:t.x-n.width,y:p};break;default:e={x:t.x,y:t.y}}var f=o?yx(o):null;if(f!=null){var m=f==="y"?"height":"width";switch(a){case dm:e[f]=e[f]-(t[m]/2-n[m]/2);break;case d_:e[f]=e[f]+(t[m]/2-n[m]/2)}}return e}var bx={name:"popperOffsets",enabled:!0,phase:"read",fn:function(s){var e=s.state,t=s.name;e.modifiersData[t]=vS({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},yT={top:"auto",right:"auto",bottom:"auto",left:"auto"};function AS(s){var e,t=s.popper,n=s.popperRect,r=s.placement,o=s.variation,a=s.offsets,u=s.position,p=s.gpuAcceleration,f=s.adaptive,m=s.roundOffsets,y=s.isFixed,S=a.x,M=S===void 0?0:S,P=a.y,D=P===void 0?0:P,j=typeof m=="function"?m({x:M,y:D}):{x:M,y:D};M=j.x,D=j.y;var k=a.hasOwnProperty("x"),L=a.hasOwnProperty("y"),R=La,W=Oa,q=window;if(f){var J=g0(t),ee="clientHeight",he="clientWidth";J===vu(t)&&ud(J=xp(t)).position!=="static"&&u==="absolute"&&(ee="scrollHeight",he="scrollWidth"),(r===Oa||(r===La||r===Ul)&&o===d_)&&(W=Fl,D-=(y&&J===q&&q.visualViewport?q.visualViewport.height:J[ee])-n.height,D*=p?1:-1),r!==La&&(r!==Oa&&r!==Fl||o!==d_)||(R=Ul,M-=(y&&J===q&&q.visualViewport?q.visualViewport.width:J[he])-n.width,M*=p?1:-1)}var xe,De=Object.assign({position:u},f&&yT),Fe=m===!0?function(ke){var Qe=ke.x,Oe=ke.y,ze=window.devicePixelRatio||1;return{x:c_(Qe*ze)/ze||0,y:c_(Oe*ze)/ze||0}}({x:M,y:D}):{x:M,y:D};return M=Fe.x,D=Fe.y,p?Object.assign({},De,((xe={})[W]=L?"0":"",xe[R]=k?"0":"",xe.transform=(q.devicePixelRatio||1)<=1?"translate("+M+"px, "+D+"px)":"translate3d("+M+"px, "+D+"px, 0)",xe)):Object.assign({},De,((e={})[W]=L?D+"px":"",e[R]=k?M+"px":"",e.transform="",e))}var wx={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(s){var e=s.state,t=s.options,n=t.gpuAcceleration,r=n===void 0||n,o=t.adaptive,a=o===void 0||o,u=t.roundOffsets,p=u===void 0||u,f={placement:gh(e.placement),variation:f_(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,AS(Object.assign({},f,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:p})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,AS(Object.assign({},f,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:p})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},vb={name:"applyStyles",enabled:!0,phase:"write",fn:function(s){var e=s.state;Object.keys(e.elements).forEach(function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},o=e.elements[t];bc(o)&&mh(o)&&(Object.assign(o.style,n),Object.keys(r).forEach(function(a){var u=r[a];u===!1?o.removeAttribute(a):o.setAttribute(a,u===!0?"":u)}))})},effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],o=e.attributes[n]||{},a=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:t[n]).reduce(function(u,p){return u[p]="",u},{});bc(r)&&mh(r)&&(Object.assign(r.style,a),Object.keys(o).forEach(function(u){r.removeAttribute(u)}))})}},requires:["computeStyles"]},yS={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(s){var e=s.state,t=s.options,n=s.name,r=t.offset,o=r===void 0?[0,0]:r,a=vx.reduce(function(m,y){return m[y]=function(S,M,P){var D=gh(S),j=[La,Oa].indexOf(D)>=0?-1:1,k=typeof P=="function"?P(Object.assign({},M,{placement:S})):P,L=k[0],R=k[1];return L=L||0,R=(R||0)*j,[La,Ul].indexOf(D)>=0?{x:R,y:L}:{x:L,y:R}}(y,e.rects,o),m},{}),u=a[e.placement],p=u.x,f=u.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=p,e.modifiersData.popperOffsets.y+=f),e.modifiersData[n]=a}},bT={left:"right",right:"left",bottom:"top",top:"bottom"};function Ab(s){return s.replace(/left|right|bottom|top/g,function(e){return bT[e]})}var wT={start:"end",end:"start"};function bS(s){return s.replace(/start|end/g,function(e){return wT[e]})}function wS(s,e){var t=e.getRootNode&&e.getRootNode();if(s.contains(e))return!0;if(t&&hx(t)){var n=e;do{if(n&&s.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function xx(s){return Object.assign({},s,{left:s.x,top:s.y,right:s.x+s.width,bottom:s.y+s.height})}function xS(s,e){return e===gx?xx(function(t){var n=vu(t),r=xp(t),o=n.visualViewport,a=r.clientWidth,u=r.clientHeight,p=0,f=0;return o&&(a=o.width,u=o.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(p=o.offsetLeft,f=o.offsetTop)),{width:a,height:u,x:p+px(t),y:f}}(s)):l_(e)?function(t){var n=u_(t);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}(e):xx(function(t){var n,r=xp(t),o=dx(t),a=(n=t.ownerDocument)==null?void 0:n.body,u=hm(r.scrollWidth,r.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),p=hm(r.scrollHeight,r.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0),f=-o.scrollLeft+px(t),m=-o.scrollTop;return ud(a||r).direction==="rtl"&&(f+=hm(r.clientWidth,a?a.clientWidth:0)-u),{width:u,height:p,x:f,y:m}}(xp(s)))}function ES(s){return Object.assign({},{top:0,right:0,bottom:0,left:0},s)}function SS(s,e){return e.reduce(function(t,n){return t[n]=s,t},{})}function m_(s,e){e===void 0&&(e={});var t=e,n=t.placement,r=n===void 0?s.placement:n,o=t.boundary,a=o===void 0?rS:o,u=t.rootBoundary,p=u===void 0?gx:u,f=t.elementContext,m=f===void 0?p_:f,y=t.altBoundary,S=y!==void 0&&y,M=t.padding,P=M===void 0?0:M,D=ES(typeof P!="number"?P:SS(P,h_)),j=m===p_?sS:p_,k=s.rects.popper,L=s.elements[S?j:m],R=function(Fe,ke,Qe){var Oe=ke==="clippingParents"?function(ot){var yt=m0(fb(ot)),Mt=["absolute","fixed"].indexOf(ud(ot).position)>=0&&bc(ot)?g0(ot):ot;return l_(Mt)?yt.filter(function(pt){return l_(pt)&&wS(pt,Mt)&&mh(pt)!=="body"}):[]}(Fe):[].concat(ke),ze=[].concat(Oe,[Qe]),$e=ze[0],Ge=ze.reduce(function(ot,yt){var Mt=xS(Fe,yt);return ot.top=hm(Mt.top,ot.top),ot.right=pb(Mt.right,ot.right),ot.bottom=pb(Mt.bottom,ot.bottom),ot.left=hm(Mt.left,ot.left),ot},xS(Fe,$e));return Ge.width=Ge.right-Ge.left,Ge.height=Ge.bottom-Ge.top,Ge.x=Ge.left,Ge.y=Ge.top,Ge}(l_(L)?L:L.contextElement||xp(s.elements.popper),a,p),W=u_(s.elements.reference),q=vS({reference:W,element:k,strategy:"absolute",placement:r}),J=xx(Object.assign({},k,q)),ee=m===p_?J:W,he={top:R.top-ee.top+D.top,bottom:ee.bottom-R.bottom+D.bottom,left:R.left-ee.left+D.left,right:ee.right-R.right+D.right},xe=s.modifiersData.offset;if(m===p_&&xe){var De=xe[r];Object.keys(he).forEach(function(Fe){var ke=[Ul,Fl].indexOf(Fe)>=0?1:-1,Qe=[Oa,Fl].indexOf(Fe)>=0?"y":"x";he[Fe]+=De[Qe]*ke})}return he}var CS={name:"flip",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name;if(!e.modifiersData[n]._skip){for(var r=t.mainAxis,o=r===void 0||r,a=t.altAxis,u=a===void 0||a,p=t.fallbackPlacements,f=t.padding,m=t.boundary,y=t.rootBoundary,S=t.altBoundary,M=t.flipVariations,P=M===void 0||M,D=t.allowedAutoPlacements,j=e.options.placement,k=gh(j),L=p||(k!==j&&P?function(pt){if(gh(pt)===mb)return[];var Qt=Ab(pt);return[bS(pt),Qt,bS(Qt)]}(j):[Ab(j)]),R=[j].concat(L).reduce(function(pt,Qt){return pt.concat(gh(Qt)===mb?function(Kt,Jt){Jt===void 0&&(Jt={});var tn=Jt,Mn=tn.placement,Rt=tn.boundary,oi=tn.rootBoundary,xi=tn.padding,ai=tn.flipVariations,Yi=tn.allowedAutoPlacements,gr=Yi===void 0?vx:Yi,wt=f_(Mn),Zt=wt?ai?_x:_x.filter(function(dr){return f_(dr)===wt}):h_,en=Zt.filter(function(dr){return gr.indexOf(dr)>=0});en.length===0&&(en=Zt);var li=en.reduce(function(dr,Ce){return dr[Ce]=m_(Kt,{placement:Ce,boundary:Rt,rootBoundary:oi,padding:xi})[gh(Ce)],dr},{});return Object.keys(li).sort(function(dr,Ce){return li[dr]-li[Ce]})}(e,{placement:Qt,boundary:m,rootBoundary:y,padding:f,flipVariations:P,allowedAutoPlacements:D}):Qt)},[]),W=e.rects.reference,q=e.rects.popper,J=new Map,ee=!0,he=R[0],xe=0;xe<R.length;xe++){var De=R[xe],Fe=gh(De),ke=f_(De)===dm,Qe=[Oa,Fl].indexOf(Fe)>=0,Oe=Qe?"width":"height",ze=m_(e,{placement:De,boundary:m,rootBoundary:y,altBoundary:S,padding:f}),$e=Qe?ke?Ul:La:ke?Fl:Oa;W[Oe]>q[Oe]&&($e=Ab($e));var Ge=Ab($e),ot=[];if(o&&ot.push(ze[Fe]<=0),u&&ot.push(ze[$e]<=0,ze[Ge]<=0),ot.every(function(pt){return pt})){he=De,ee=!1;break}J.set(De,ot)}if(ee)for(var yt=function(pt){var Qt=R.find(function(Kt){var Jt=J.get(Kt);if(Jt)return Jt.slice(0,pt).every(function(tn){return tn})});if(Qt)return he=Qt,"break"},Mt=P?3:1;Mt>0&&yt(Mt)!=="break";Mt--);e.placement!==he&&(e.modifiersData[n]._skip=!0,e.placement=he,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function _0(s,e,t){return hm(s,pb(e,t))}var MS={name:"preventOverflow",enabled:!0,phase:"main",fn:function(s){var e=s.state,t=s.options,n=s.name,r=t.mainAxis,o=r===void 0||r,a=t.altAxis,u=a!==void 0&&a,p=t.boundary,f=t.rootBoundary,m=t.altBoundary,y=t.padding,S=t.tether,M=S===void 0||S,P=t.tetherOffset,D=P===void 0?0:P,j=m_(e,{boundary:p,rootBoundary:f,padding:y,altBoundary:m}),k=gh(e.placement),L=f_(e.placement),R=!L,W=yx(k),q=W==="x"?"y":"x",J=e.modifiersData.popperOffsets,ee=e.rects.reference,he=e.rects.popper,xe=typeof D=="function"?D(Object.assign({},e.rects,{placement:e.placement})):D,De=typeof xe=="number"?{mainAxis:xe,altAxis:xe}:Object.assign({mainAxis:0,altAxis:0},xe),Fe=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,ke={x:0,y:0};if(J){if(o){var Qe,Oe=W==="y"?Oa:La,ze=W==="y"?Fl:Ul,$e=W==="y"?"height":"width",Ge=J[W],ot=Ge+j[Oe],yt=Ge-j[ze],Mt=M?-he[$e]/2:0,pt=L===dm?ee[$e]:he[$e],Qt=L===dm?-he[$e]:-ee[$e],Kt=e.elements.arrow,Jt=M&&Kt?mx(Kt):{width:0,height:0},tn=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Mn=tn[Oe],Rt=tn[ze],oi=_0(0,ee[$e],Jt[$e]),xi=R?ee[$e]/2-Mt-oi-Mn-De.mainAxis:pt-oi-Mn-De.mainAxis,ai=R?-ee[$e]/2+Mt+oi+Rt+De.mainAxis:Qt+oi+Rt+De.mainAxis,Yi=e.elements.arrow&&g0(e.elements.arrow),gr=Yi?W==="y"?Yi.clientTop||0:Yi.clientLeft||0:0,wt=(Qe=Fe==null?void 0:Fe[W])!=null?Qe:0,Zt=Ge+ai-wt,en=_0(M?pb(ot,Ge+xi-wt-gr):ot,Ge,M?hm(yt,Zt):yt);J[W]=en,ke[W]=en-Ge}if(u){var li,dr=W==="x"?Oa:La,Ce=W==="x"?Fl:Ul,Je=J[q],Te=q==="y"?"height":"width",it=Je+j[dr],ht=Je-j[Ce],nt=[Oa,La].indexOf(k)!==-1,bt=(li=Fe==null?void 0:Fe[q])!=null?li:0,sn=nt?it:Je-ee[Te]-he[Te]-bt+De.altAxis,mn=nt?Je+ee[Te]+he[Te]-bt-De.altAxis:ht,En=M&&nt?function(xn,Tn,yn){var gn=_0(xn,Tn,yn);return gn>yn?yn:gn}(sn,Je,mn):_0(M?sn:it,Je,M?mn:ht);J[q]=En,ke[q]=En-Je}e.modifiersData[n]=ke}},requiresIfExists:["offset"]},TS={name:"arrow",enabled:!0,phase:"main",fn:function(s){var e,t=s.state,n=s.name,r=s.options,o=t.elements.arrow,a=t.modifiersData.popperOffsets,u=gh(t.placement),p=yx(u),f=[La,Ul].indexOf(u)>=0?"height":"width";if(o&&a){var m=function(he,xe){return ES(typeof(he=typeof he=="function"?he(Object.assign({},xe.rects,{placement:xe.placement})):he)!="number"?he:SS(he,h_))}(r.padding,t),y=mx(o),S=p==="y"?Oa:La,M=p==="y"?Fl:Ul,P=t.rects.reference[f]+t.rects.reference[p]-a[p]-t.rects.popper[f],D=a[p]-t.rects.reference[p],j=g0(o),k=j?p==="y"?j.clientHeight||0:j.clientWidth||0:0,L=P/2-D/2,R=m[S],W=k-y[f]-m[M],q=k/2-y[f]/2+L,J=_0(R,q,W),ee=p;t.modifiersData[n]=((e={})[ee]=J,e.centerOffset=J-q,e)}},effect:function(s){var e=s.state,t=s.options.element,n=t===void 0?"[data-popper-arrow]":t;n!=null&&(typeof n!="string"||(n=e.elements.popper.querySelector(n)))&&wS(e.elements.popper,n)&&(e.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function IS(s,e,t){return t===void 0&&(t={x:0,y:0}),{top:s.top-e.height-t.y,right:s.right-e.width+t.x,bottom:s.bottom-e.height+t.y,left:s.left-e.width-t.x}}function PS(s){return[Oa,Ul,Fl,La].some(function(e){return s[e]>=0})}var DS={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(s){var e=s.state,t=s.name,n=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,a=m_(e,{elementContext:"reference"}),u=m_(e,{altBoundary:!0}),p=IS(a,n),f=IS(u,r,o),m=PS(p),y=PS(f);e.modifiersData[t]={referenceClippingOffsets:p,popperEscapeOffsets:f,isReferenceHidden:m,hasPopperEscaped:y},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":m,"data-popper-escaped":y})}},RS=gb({defaultModifiers:[Ax,bx,wx,vb,yS,CS,MS,TS,DS]}),BS="tippy-content",kS="tippy-arrow",OS="tippy-svg-arrow",pm={passive:!0,capture:!0},LS=function(){return document.body};function Ex(s,e,t){if(Array.isArray(s)){var n=s[e];return n??(Array.isArray(t)?t[e]:t)}return s}function Sx(s,e){var t={}.toString.call(s);return t.indexOf("[object")===0&&t.indexOf(e+"]")>-1}function NS(s,e){return typeof s=="function"?s.apply(void 0,e):s}function FS(s,e){return e===0?s:function(n){clearTimeout(t),t=setTimeout(function(){s(n)},e)};var t}function g_(s){return[].concat(s)}function US(s,e){s.indexOf(e)===-1&&s.push(e)}function yb(s){return[].slice.call(s)}function jS(s){return Object.keys(s).reduce(function(e,t){return s[t]!==void 0&&(e[t]=s[t]),e},{})}function v0(){return document.createElement("div")}function bb(s){return["Element","Fragment"].some(function(e){return Sx(s,e)})}function Cx(s,e){s.forEach(function(t){t&&(t.style.transitionDuration=e+"ms")})}function zS(s,e){s.forEach(function(t){t&&t.setAttribute("data-state",e)})}function Mx(s,e,t){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){s[n](r,t)})}function VS(s,e){for(var t=e;t;){var n;if(s.contains(t))return!0;t=t.getRootNode==null||(n=t.getRootNode())==null?void 0:n.host}return!1}var _h={isTouch:!1},GS=0;function xT(){_h.isTouch||(_h.isTouch=!0,window.performance&&document.addEventListener("mousemove",QS))}function QS(){var s=performance.now();s-GS<20&&(_h.isTouch=!1,document.removeEventListener("mousemove",QS)),GS=s}function ET(){var s,e=document.activeElement;if((s=e)&&s._tippy&&s._tippy.reference===s){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}var ST=!(typeof window>"u"||typeof document>"u"||!window.msCrypto),Au=Object.assign({appendTo:LS,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),CT=Object.keys(Au);function HS(s){var e=(s.plugins||[]).reduce(function(t,n){var r,o=n.name,a=n.defaultValue;return o&&(t[o]=s[o]!==void 0?s[o]:(r=Au[o])!=null?r:a),t},{});return Object.assign({},s,e)}function WS(s,e){var t=Object.assign({},e,{content:NS(e.content,[s])},e.ignoreAttributes?{}:function(n,r){return(r?Object.keys(HS(Object.assign({},Au,{plugins:r}))):CT).reduce(function(o,a){var u=(n.getAttribute("data-tippy-"+a)||"").trim();if(!u)return o;if(a==="content")o[a]=u;else try{o[a]=JSON.parse(u)}catch{o[a]=u}return o},{})}(s,e.plugins));return t.aria=Object.assign({},Au.aria,t.aria),t.aria={expanded:t.aria.expanded==="auto"?e.interactive:t.aria.expanded,content:t.aria.content==="auto"?e.interactive?null:"describedby":t.aria.content},t}function Tx(s,e){s.innerHTML=e}function qS(s){var e=v0();return s===!0?e.className=kS:(e.className=OS,bb(s)?e.appendChild(s):Tx(e,s)),e}function YS(s,e){bb(e.content)?(Tx(s,""),s.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?Tx(s,e.content):s.textContent=e.content)}function Ix(s){var e=s.firstElementChild,t=yb(e.children);return{box:e,content:t.find(function(n){return n.classList.contains(BS)}),arrow:t.find(function(n){return n.classList.contains(kS)||n.classList.contains(OS)}),backdrop:t.find(function(n){return n.classList.contains("tippy-backdrop")})}}function XS(s){var e=v0(),t=v0();t.className="tippy-box",t.setAttribute("data-state","hidden"),t.setAttribute("tabindex","-1");var n=v0();function r(o,a){var u=Ix(e),p=u.box,f=u.content,m=u.arrow;a.theme?p.setAttribute("data-theme",a.theme):p.removeAttribute("data-theme"),typeof a.animation=="string"?p.setAttribute("data-animation",a.animation):p.removeAttribute("data-animation"),a.inertia?p.setAttribute("data-inertia",""):p.removeAttribute("data-inertia"),p.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?p.setAttribute("role",a.role):p.removeAttribute("role"),o.content===a.content&&o.allowHTML===a.allowHTML||YS(f,s.props),a.arrow?m?o.arrow!==a.arrow&&(p.removeChild(m),p.appendChild(qS(a.arrow))):p.appendChild(qS(a.arrow)):m&&p.removeChild(m)}return n.className=BS,n.setAttribute("data-state","hidden"),YS(n,s.props),e.appendChild(t),t.appendChild(n),r(s.props,s.props),{popper:e,onUpdate:r}}XS.$$tippy=!0;var MT=1,wb=[],Px=[];function TT(s,e){var t,n,r,o,a,u,p,f,m=WS(s,Object.assign({},Au,HS(jS(e)))),y=!1,S=!1,M=!1,P=!1,D=[],j=FS(Yi,m.interactiveDebounce),k=MT++,L=(f=m.plugins).filter(function(Te,it){return f.indexOf(Te)===it}),R={id:k,reference:s,popper:v0(),popperInstance:null,props:m,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:L,clearDelayTimeouts:function(){clearTimeout(t),clearTimeout(n),cancelAnimationFrame(r)},setProps:function(Te){if(!R.state.isDestroyed){Ge("onBeforeUpdate",[R,Te]),xi();var it=R.props,ht=WS(s,Object.assign({},it,jS(Te),{ignoreAttributes:!0}));R.props=ht,oi(),it.interactiveDebounce!==ht.interactiveDebounce&&(Mt(),j=FS(Yi,ht.interactiveDebounce)),it.triggerTarget&&!ht.triggerTarget?g_(it.triggerTarget).forEach(function(nt){nt.removeAttribute("aria-expanded")}):ht.triggerTarget&&s.removeAttribute("aria-expanded"),yt(),$e(),J&&J(it,ht),R.popperInstance&&(en(),dr().forEach(function(nt){requestAnimationFrame(nt._tippy.popperInstance.forceUpdate)})),Ge("onAfterUpdate",[R,Te])}},setContent:function(Te){R.setProps({content:Te})},show:function(){var Te=R.state.isVisible,it=R.state.isDestroyed,ht=!R.state.isEnabled,nt=_h.isTouch&&!R.props.touch,bt=Ex(R.props.duration,0,Au.duration);if(!(Te||it||ht||nt||ke().hasAttribute("disabled")||(Ge("onShow",[R],!1),R.props.onShow(R)===!1))){if(R.state.isVisible=!0,Fe()&&(q.style.visibility="visible"),$e(),Jt(),R.state.isMounted||(q.style.transition="none"),Fe()){var sn=Oe();Cx([sn.box,sn.content],0)}var mn,En,xn;u=function(){var Tn;if(R.state.isVisible&&!P){if(P=!0,q.offsetHeight,q.style.transition=R.props.moveTransition,Fe()&&R.props.animation){var yn=Oe(),gn=yn.box,Ln=yn.content;Cx([gn,Ln],bt),zS([gn,Ln],"visible")}ot(),yt(),US(Px,R),(Tn=R.popperInstance)==null||Tn.forceUpdate(),Ge("onMount",[R]),R.props.animation&&Fe()&&function(un,jn){Mn(un,function(){R.state.isShown=!0,Ge("onShown",[R])})}(bt)}},En=R.props.appendTo,xn=ke(),(mn=R.props.interactive&&En===LS||En==="parent"?xn.parentNode:NS(En,[xn])).contains(q)||mn.appendChild(q),R.state.isMounted=!0,en()}},hide:function(){var Te=!R.state.isVisible,it=R.state.isDestroyed,ht=!R.state.isEnabled,nt=Ex(R.props.duration,1,Au.duration);if(!(Te||it||ht)&&(Ge("onHide",[R],!1),R.props.onHide(R)!==!1)){if(R.state.isVisible=!1,R.state.isShown=!1,P=!1,y=!1,Fe()&&(q.style.visibility="hidden"),Mt(),tn(),$e(!0),Fe()){var bt=Oe(),sn=bt.box,mn=bt.content;R.props.animation&&(Cx([sn,mn],nt),zS([sn,mn],"hidden"))}ot(),yt(),R.props.animation?Fe()&&function(En,xn){Mn(En,function(){!R.state.isVisible&&q.parentNode&&q.parentNode.contains(q)&&xn()})}(nt,R.unmount):R.unmount()}},hideWithInteractivity:function(Te){Qe().addEventListener("mousemove",j),US(wb,j),j(Te)},enable:function(){R.state.isEnabled=!0},disable:function(){R.hide(),R.state.isEnabled=!1},unmount:function(){R.state.isVisible&&R.hide(),R.state.isMounted&&(li(),dr().forEach(function(Te){Te._tippy.unmount()}),q.parentNode&&q.parentNode.removeChild(q),Px=Px.filter(function(Te){return Te!==R}),R.state.isMounted=!1,Ge("onHidden",[R]))},destroy:function(){R.state.isDestroyed||(R.clearDelayTimeouts(),R.unmount(),xi(),delete s._tippy,R.state.isDestroyed=!0,Ge("onDestroy",[R]))}};if(!m.render)return R;var W=m.render(R),q=W.popper,J=W.onUpdate;q.setAttribute("data-tippy-root",""),q.id="tippy-"+R.id,R.popper=q,s._tippy=R,q._tippy=R;var ee=L.map(function(Te){return Te.fn(R)}),he=s.hasAttribute("aria-expanded");return oi(),yt(),$e(),Ge("onCreate",[R]),m.showOnCreate&&Ce(),q.addEventListener("mouseenter",function(){R.props.interactive&&R.state.isVisible&&R.clearDelayTimeouts()}),q.addEventListener("mouseleave",function(){R.props.interactive&&R.props.trigger.indexOf("mouseenter")>=0&&Qe().addEventListener("mousemove",j)}),R;function xe(){var Te=R.props.touch;return Array.isArray(Te)?Te:[Te,0]}function De(){return xe()[0]==="hold"}function Fe(){var Te;return!((Te=R.props.render)==null||!Te.$$tippy)}function ke(){return p||s}function Qe(){var Te,it,ht=ke().parentNode;return ht&&(it=g_(ht)[0])!=null&&(Te=it.ownerDocument)!=null&&Te.body?it.ownerDocument:document}function Oe(){return Ix(q)}function ze(Te){return R.state.isMounted&&!R.state.isVisible||_h.isTouch||o&&o.type==="focus"?0:Ex(R.props.delay,Te?0:1,Au.delay)}function $e(Te){Te===void 0&&(Te=!1),q.style.pointerEvents=R.props.interactive&&!Te?"":"none",q.style.zIndex=""+R.props.zIndex}function Ge(Te,it,ht){var nt;ht===void 0&&(ht=!0),ee.forEach(function(bt){bt[Te]&&bt[Te].apply(bt,it)}),ht&&(nt=R.props)[Te].apply(nt,it)}function ot(){var Te=R.props.aria;if(Te.content){var it="aria-"+Te.content,ht=q.id;g_(R.props.triggerTarget||s).forEach(function(nt){var bt=nt.getAttribute(it);if(R.state.isVisible)nt.setAttribute(it,bt?bt+" "+ht:ht);else{var sn=bt&&bt.replace(ht,"").trim();sn?nt.setAttribute(it,sn):nt.removeAttribute(it)}})}}function yt(){!he&&R.props.aria.expanded&&g_(R.props.triggerTarget||s).forEach(function(Te){R.props.interactive?Te.setAttribute("aria-expanded",R.state.isVisible&&Te===ke()?"true":"false"):Te.removeAttribute("aria-expanded")})}function Mt(){Qe().removeEventListener("mousemove",j),wb=wb.filter(function(Te){return Te!==j})}function pt(Te){if(!_h.isTouch||!M&&Te.type!=="mousedown"){var it=Te.composedPath&&Te.composedPath()[0]||Te.target;if(!R.props.interactive||!VS(q,it)){if(g_(R.props.triggerTarget||s).some(function(ht){return VS(ht,it)})){if(_h.isTouch||R.state.isVisible&&R.props.trigger.indexOf("click")>=0)return}else Ge("onClickOutside",[R,Te]);R.props.hideOnClick===!0&&(R.clearDelayTimeouts(),R.hide(),S=!0,setTimeout(function(){S=!1}),R.state.isMounted||tn())}}}function Qt(){M=!0}function Kt(){M=!1}function Jt(){var Te=Qe();Te.addEventListener("mousedown",pt,!0),Te.addEventListener("touchend",pt,pm),Te.addEventListener("touchstart",Kt,pm),Te.addEventListener("touchmove",Qt,pm)}function tn(){var Te=Qe();Te.removeEventListener("mousedown",pt,!0),Te.removeEventListener("touchend",pt,pm),Te.removeEventListener("touchstart",Kt,pm),Te.removeEventListener("touchmove",Qt,pm)}function Mn(Te,it){var ht=Oe().box;function nt(bt){bt.target===ht&&(Mx(ht,"remove",nt),it())}if(Te===0)return it();Mx(ht,"remove",a),Mx(ht,"add",nt),a=nt}function Rt(Te,it,ht){ht===void 0&&(ht=!1),g_(R.props.triggerTarget||s).forEach(function(nt){nt.addEventListener(Te,it,ht),D.push({node:nt,eventType:Te,handler:it,options:ht})})}function oi(){var Te;De()&&(Rt("touchstart",ai,{passive:!0}),Rt("touchend",gr,{passive:!0})),(Te=R.props.trigger,Te.split(/\s+/).filter(Boolean)).forEach(function(it){if(it!=="manual")switch(Rt(it,ai),it){case"mouseenter":Rt("mouseleave",gr);break;case"focus":Rt(ST?"focusout":"blur",wt);break;case"focusin":Rt("focusout",wt)}})}function xi(){D.forEach(function(Te){var it=Te.node,ht=Te.eventType,nt=Te.handler,bt=Te.options;it.removeEventListener(ht,nt,bt)}),D=[]}function ai(Te){var it,ht=!1;if(R.state.isEnabled&&!Zt(Te)&&!S){var nt=((it=o)==null?void 0:it.type)==="focus";o=Te,p=Te.currentTarget,yt(),!R.state.isVisible&&Sx(Te,"MouseEvent")&&wb.forEach(function(bt){return bt(Te)}),Te.type==="click"&&(R.props.trigger.indexOf("mouseenter")<0||y)&&R.props.hideOnClick!==!1&&R.state.isVisible?ht=!0:Ce(Te),Te.type==="click"&&(y=!ht),ht&&!nt&&Je(Te)}}function Yi(Te){var it=Te.target,ht=ke().contains(it)||q.contains(it);if(Te.type!=="mousemove"||!ht){var nt=dr().concat(q).map(function(bt){var sn,mn=(sn=bt._tippy.popperInstance)==null?void 0:sn.state;return mn?{popperRect:bt.getBoundingClientRect(),popperState:mn,props:m}:null}).filter(Boolean);(function(bt,sn){var mn=sn.clientX,En=sn.clientY;return bt.every(function(xn){var Tn=xn.popperRect,yn=xn.popperState,gn=xn.props.interactiveBorder,Ln=yn.placement.split("-")[0],un=yn.modifiersData.offset;if(!un)return!0;var jn=Ln==="bottom"?un.top.y:0,Wn=Ln==="top"?un.bottom.y:0,ii=Ln==="right"?un.left.x:0,Wr=Ln==="left"?un.right.x:0,Dr=Tn.top-En+jn>gn,zn=En-Tn.bottom-Wn>gn,ci=Tn.left-mn+ii>gn,Fi=mn-Tn.right-Wr>gn;return Dr||zn||ci||Fi})})(nt,Te)&&(Mt(),Je(Te))}}function gr(Te){Zt(Te)||R.props.trigger.indexOf("click")>=0&&y||(R.props.interactive?R.hideWithInteractivity(Te):Je(Te))}function wt(Te){R.props.trigger.indexOf("focusin")<0&&Te.target!==ke()||R.props.interactive&&Te.relatedTarget&&q.contains(Te.relatedTarget)||Je(Te)}function Zt(Te){return!!_h.isTouch&&De()!==Te.type.indexOf("touch")>=0}function en(){li();var Te=R.props,it=Te.popperOptions,ht=Te.placement,nt=Te.offset,bt=Te.getReferenceClientRect,sn=Te.moveTransition,mn=Fe()?Ix(q).arrow:null,En=bt?{getBoundingClientRect:bt,contextElement:bt.contextElement||ke()}:s,xn=[{name:"offset",options:{offset:nt}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!sn}},{name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Tn){var yn=Tn.state;if(Fe()){var gn=Oe().box;["placement","reference-hidden","escaped"].forEach(function(Ln){Ln==="placement"?gn.setAttribute("data-placement",yn.placement):yn.attributes.popper["data-popper-"+Ln]?gn.setAttribute("data-"+Ln,""):gn.removeAttribute("data-"+Ln)}),yn.attributes.popper={}}}}];Fe()&&mn&&xn.push({name:"arrow",options:{element:mn,padding:3}}),xn.push.apply(xn,(it==null?void 0:it.modifiers)||[]),R.popperInstance=RS(En,q,Object.assign({},it,{placement:ht,onFirstUpdate:u,modifiers:xn}))}function li(){R.popperInstance&&(R.popperInstance.destroy(),R.popperInstance=null)}function dr(){return yb(q.querySelectorAll("[data-tippy-root]"))}function Ce(Te){R.clearDelayTimeouts(),Te&&Ge("onTrigger",[R,Te]),Jt();var it=ze(!0),ht=xe(),nt=ht[0],bt=ht[1];_h.isTouch&&nt==="hold"&&bt&&(it=bt),it?t=setTimeout(function(){R.show()},it):R.show()}function Je(Te){if(R.clearDelayTimeouts(),Ge("onUntrigger",[R,Te]),R.state.isVisible){if(!(R.props.trigger.indexOf("mouseenter")>=0&&R.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(Te.type)>=0&&y)){var it=ze(!1);it?n=setTimeout(function(){R.state.isVisible&&R.hide()},it):r=requestAnimationFrame(function(){R.hide()})}}else tn()}}function A0(s,e){e===void 0&&(e={});var t=Au.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",xT,pm),window.addEventListener("blur",ET);var n,r=Object.assign({},e,{plugins:t}),o=(n=s,bb(n)?[n]:function(a){return Sx(a,"NodeList")}(n)?yb(n):Array.isArray(n)?n:yb(document.querySelectorAll(n))).reduce(function(a,u){var p=u&&TT(u,r);return p&&a.push(p),a},[]);return bb(s)?o[0]:o}A0.defaultProps=Au,A0.setDefaultProps=function(s){Object.keys(s).forEach(function(e){Au[e]=s[e]})},A0.currentInput=_h,Object.assign({},vb,{effect:function(s){var e=s.state,t={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,t.popper),e.styles=t,e.elements.arrow&&Object.assign(e.elements.arrow.style,t.arrow)}}),A0.setDefaultProps({render:XS});var Dx=A0;class fm extends db{async _refreshUi(){var e;if(!await super._refreshUi())return!1;_u.RemoveAll(fm.PluginType);for(const t of this.variations)_u.Create(fm.PluginType,t.title,5,20,0,t.materials.map(n=>{let r;if(t.preview.startsWith("generate:"))r=this._previewGenerator.generate(n,t.preview.split(":")[1]);else{const o=n[t.preview]||"#ff00ff";r=o.image?Ic(o.image,100):void 0,r||(r=eS(o,!0))}return{id:n.uuid,image:r,onClick:o=>this.applyVariation(t,o),tooltip:n.name||n.uuid}}),(n,r)=>Dx(n,{placement:"bottom",content:r.tooltip}));return _u.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),!0}}fm.PluginType="MaterialConfiguratorPlugin";class xb extends ui{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this._refreshUiConfig=()=>{var e,t;this.enabled&&((t=(e=this.uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))},this.dependencies=[dn],this._selectedObject=()=>{var e;return((e=this._picking)===null||e===void 0?void 0:e.getSelectedObject())||void 0},this._selectedMaterial=()=>{var e;return((e=this._selectedObject())===null||e===void 0?void 0:e.material)||void 0}}async onAdded(e){var t,n;await super.onAdded(e),this.refreshUi=this.refreshUi.bind(this),this._refreshUi=this._refreshUi.bind(this),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),this._previewGenerator=new cx(this._viewer),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",this._refreshUiConfig),e.addEventListener("preFrame",this._refreshUi),this.addEventListener("deserialize",this.refreshUi)}async onRemove(e){var t,n;return(t=this._previewGenerator)===null||t===void 0||t.dispose(),this._previewGenerator=void 0,(n=this._picking)===null||n===void 0||n.removeEventListener("selectedObjectChanged",this._refreshUiConfig),this.removeEventListener("deserialize",this.refreshUi),e.removeEventListener("preFrame",this._refreshUi),this._picking=void 0,super.onRemove(e)}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}async _refreshUi(){return this._uiNeedRefresh&&this.enabled&&this._refreshUiConfig(),this._uiNeedRefresh=!1,!1}}xb.PluginType="MaterialLibraryBasePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([_n("Enabled")],xb.prototype,"enabled",void 0);class Ep extends xb{constructor(){super(...arguments),this.replaceMaterial=!1,this.uiConfig={type:"folder",label:"Material Library",uuid:ki(),children:[...Ql(this),()=>{var e;return{type:"dropdown",label:"Apply Material",limitedUi:!0,hidden:()=>!this._selectedObject(),children:[{label:"select one",value:""},[...this._viewer.getPlugin(dn).materials.getMaterialsOfType((e=this._selectedMaterial())===null||e===void 0?void 0:e.typeSlug).map(t=>({label:t.name||t.uuid,value:t.uuid}))||[]]],getValue:()=>{var t;return(t=this._selectedMaterial())===null||t===void 0?void 0:t.uuid},setValue:t=>{var n,r,o,a,u;const p=(o=(r=(n=this._viewer)===null||n===void 0?void 0:n.getPlugin(dn))===null||r===void 0?void 0:r.materials)===null||o===void 0?void 0:o.findMaterial(t);if(p)if(this.replaceMaterial)(u=(a=this._selectedObject())===null||a===void 0?void 0:a.setMaterial)===null||u===void 0||u.call(a,p);else{const f=this._selectedMaterial();if(f){const m=f.name,y=f.uuid;f.copyProps(p),f.name=m,f.uuid=y,f.userData.uuid&&(f.userData.uuid=y)}}this._refreshUi()}}}]}}async _refreshUi(){var e,t,n,r;if(!await super._refreshUi())return!1;const o=[Hs.TypeSlug,Ir.TypeSlug],a=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(dn))===null||t===void 0?void 0:t.materials,u=o.map(p=>[p,a==null?void 0:a.getMaterialsOfType(p)]);_u.RemoveAll(Ep.PluginType);for(const[p,f]of u)_u.Create(Ep.PluginType,p,5,20,0,(n=f)===null||n===void 0?void 0:n.filter(m=>!m.userData.__runtimeMaterial).map(m=>{let y;const S="generate:sphere";if(S.startsWith("generate:"))y=this._previewGenerator.generate(m,S.split(":")[1]);else{const M=m[S]||"#ff00ff";y=M.image?Ic(M.image,100):void 0,y||(y=ZE(M,!0))}return{id:m.uuid,image:y,onClick:M=>{const P=a==null?void 0:a.findMaterial(M);if(console.log(P==null?void 0:P.name),P){const D=P.userData.__appliedMeshes;if(D!=null&&D.size){const j=D.keys().next().value;j.dispatchEvent({type:"select",value:j})}}},tooltip:m.name||m.uuid}}),(m,y)=>Dx(m,{placement:"bottom",content:y.tooltip}));return _u.RebuildUi((r=this._viewer)===null||r===void 0?void 0:r.container),!0}}function KS(s,e,t,n){s.traverse(r=>{r&&(r.userData.cloneRotI=e,r.userData.rotationCount=t,r.userData.rotationAxis=n,r.addEventListener("beforeRender",o=>function(a,u){var p;u&&(!((p=u.map)===null||p===void 0)&&p.isTexture)&&(u.extraUniformsToUpload||(u.extraUniformsToUpload={}),u.extraUniformsToUpload.uvTransform||(u.extraUniformsToUpload.uvTransform={value:new c.Vkp}),u.extraUniformsToUpload.uvTransform.value.setUvTransform(u.map.offset.x*u.map.repeat.x*a.userData.cloneRotI/(a.userData.rotationCount||1),u.map.offset.y*u.map.repeat.y*a.userData.cloneRotI/(a.userData.rotationCount||1),u.map.repeat.x,u.map.repeat.y,u.map.rotation,u.map.center.x,u.map.center.y))}(r,o.material)))})}function JS(s,e,t,n="x"){var r;if(s.userData.rotationCount>1&&!s.userData.rotationRoot)return s;const o=s.parent;if(!o)throw new Error("No parent");if(s.userData.cloneParent){const u=s.userData.cloneParent;if(!(s=o.children.find(p=>u===p.uuid)))return console.error("Couldn't find clone root, cannot rotate. maybe a serialization issue?",u,o),s}let a=o.children.filter(u=>{var p;return((p=u.userData)===null||p===void 0?void 0:p.cloneParent)===s.uuid}).sort((u,p)=>u.userData.cloneRotI-p.userData.cloneRotI);if(s.userData.rotationCount===e&&e===a.length&&t===void 0&&s.userData.rotationAxis===n)return s;if(t==null&&(t=(r=s.userData.rotationSkips)!==null&&r!==void 0?r:[]),t!==s.userData.rotationSkips&&(s.userData.rotationSkips=[...t]),KS(s,0,e,n),s.userData.rotationRoot=!0,s.visible=!0,e<=a.length){for(let u=e-1;u<a.length;u++)o.remove(a[u]),a[u].traverse(p=>p.userData={__disposed:!0});a=a.slice(0,e)}for(let u=1;u<e;u++){const p=u<=a.length?a[u-1]:s.clone();p.rotation.copy(s.rotation),p.rotation[n]+=u/e*Math.PI*2,KS(p,u,e,n),u>a.length&&o.add(p),p.visible=!t.includes(u)}return s.visible=!t.includes(0),s}Ep.PluginType="MaterialLibraryPlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([_n("Replace Material")],Ep.prototype,"replaceMaterial",void 0);var __,y0=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let vh=__=class extends ui{constructor(){super(),this.enabled=!0,this.rotations=1,this.axis="x",this.skips="",this._selectedObjectChanged=this._selectedObjectChanged.bind(this)}async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var s,e,t,n,r,o,a,u,p;if(!this.enabled)return;const f=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(!f)return void((n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0));const m=f.userData.rotationRoot&&(r=f.userData.rotationCount)!==null&&r!==void 0?r:1;this.rotations=m,this.skips=(a=(o=f.userData.rotationSkips)===null||o===void 0?void 0:o.join(","))!==null&&a!==void 0?a:"",this.axis=f.userData.rotationAxis||"x",(p=(u=this.uiConfig).uiRefresh)===null||p===void 0||p.call(u,"postFrame",!0)}_paramsChanged(){var s,e,t,n,r,o;if(!this.enabled)return;const a=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject();if(a){if(this.rotations>1||a.userData.rotationCount){const u=a.userData.rotationCount,p=JS(a,this.rotations,this.skips.split(",").map(m=>parseInt(m)).filter(m=>isFinite(m)),this.axis),f=p==null?void 0:p.userData.rotationCount;if(f&&f!==u){const m=[];p==null||p.traverseAncestors(y=>{m.push(y)});for(const y of m)if(y.userData.autoScaled){vn(y),(t=this._viewer)===null||t===void 0||t.resetCamera({rootObject:y,centerOffset:new c.Pa4(4,4,4)});break}}a.parent&&!a.userData.__disposed||(r=(n=this._viewer)===null||n===void 0?void 0:n.getPluginByType("Picking"))===null||r===void 0||r.setSelectedObject(p,!0)}(o=this._viewer)===null||o===void 0||o.scene.setDirty({frameFade:!1,sceneUpdate:!0})}}};vh.PluginType="ObjectRotationPlugin",y0([et(),_n("Enabled"),we(__.prototype._paramsChanged)],vh.prototype,"enabled",void 0),y0([wn("Rotation Count",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),we(__.prototype._paramsChanged)],vh.prototype,"rotations",void 0),y0([Ao("Axis",["x","y","z"].map(s=>({label:s})),s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),we(__.prototype._paramsChanged)],vh.prototype,"axis",void 0),y0([Si("Rotation Skips",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPluginByType("Picking"))===null||t===void 0)&&t.getSelectedObject())||!s.rotations}})),we(__.prototype._paramsChanged)],vh.prototype,"skips",void 0),vh=__=y0([Ci("Object Rotations")],vh);var mm,v_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let yu=mm=class extends ui{constructor(s=!0){super(),this.enabled=!0,this.debugNormals=!1,this.debugHitHeight=!1,this._defines={PARALLAX_NORMAL_MAP_QUALITY:0},this.stepCount=12,this.binaryStepCount=3,this._bumpMapExtension={shaderExtender:(e,t,n)=>{if(t.materialObject.bumpMap&&this.enabled){e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_begin>",""),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",""),e.fragmentShader=e.fragmentShader.replace("#include <map_fragment>",`#include <normal_fragment_begin>
#include <normal_fragment_maps>
#include <map_fragment>`);for(const r of["map_fragment","alphamap_fragment","roughnessmap_fragment","metalnessmap_fragment","emissivemap_fragment","transmission_fragment"])e.fragmentShader=e.fragmentShader.replace(`#include <${r}>`,c.WdD[r].replace("vUv","parallaxUv.xy"));(this.debugNormals||this.debugHitHeight)&&(e.fragmentShader=e.fragmentShader.replace("texture2D( map, parallaxUv.xy )",this.debugNormals?"vec4(normal, 1.); normal = geometryNormal":"vec4(parallaxUv.z,0., 0., 1.)")),e.fragmentShader=e.fragmentShader.replace("#include <normal_fragment_maps>",c.WdD.normal_fragment_maps.replace("#elif defined( TANGENTSPACE_NORMALMAP )","#elif defined( TANGENTSPACE_NORMALMAP ) && !defined( USE_BUMPMAP )").replace("normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );","vec3 parallaxUv = reliefParallaxPerturbNormal(faceDirection, normal);"))}},parsFragmentSnippet:()=>this.enabled?`#ifdef USE_BUMPMAP
mat3 mat3_inverse(mat3 A){mat3 M_t=mat3(vec3(A[0][0],A[1][0],A[2][0]),vec3(A[0][1],A[1][1],A[2][1]),vec3(A[0][2],A[1][2],A[2][2]));float det=dot(cross(M_t[0],M_t[1]),M_t[2]);mat3 adjugate=mat3(cross(M_t[1],M_t[2]),cross(M_t[2],M_t[0]),cross(M_t[0],M_t[1]));return adjugate/det;}float CalculateHeight(in vec2 texCoords){float height=texture2D(bumpMap,texCoords).x;return clamp(height,0.,1.);}const vec2 bumpMapSize=vec2(512,512);vec3 CalculateNormal(in vec2 texCoords){
#if defined( TANGENTSPACE_NORMALMAP ) && 0 
vec3 mapN=texture2D(normalMap,texCoords).xyz;mapN.xy*=normalScale;return normalize(mapN);
#else
vec2 texOffs=1./bumpMapSize;
#if PARALLAX_NORMAL_MAP_QUALITY > 0
float hx[9];hx[0]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,-1.)).r;hx[1]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;hx[2]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,-1.)).r;hx[3]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;hx[4]=texture2D(bumpMap,texCoords.st).r;hx[5]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;hx[6]=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,1.)).r;hx[7]=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;hx[8]=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,1.)).r;vec2 deltaH=vec2(hx[0]-hx[2]+2.*(hx[3]-hx[5])+hx[6]-hx[8],hx[0]-hx[6]+2.*(hx[1]-hx[7])+hx[2]-hx[8]);
#else
float h_xa=texture2D(bumpMap,texCoords.st+texOffs*vec2(-1.,0.)).r;float h_xb=texture2D(bumpMap,texCoords.st+texOffs*vec2(1.,0.)).r;float h_ya=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,-1.)).r;float h_yb=texture2D(bumpMap,texCoords.st+texOffs*vec2(0.,1.)).r;vec2 deltaH=vec2(h_xa-h_xb,h_ya-h_yb);
#endif
return normalize(vec3(deltaH/texOffs,1.));
#endif
}vec3 ReliefParallax(in float frontFace,in vec3 texDir3D,in vec2 texCoord){float surf_sign=frontFace;float back_face=step(0.,-surf_sign);vec2 texStep=surf_sign*texDir3D.xy/abs(texDir3D.z);vec2 texC=texCoord.st+surf_sign*texStep+back_face*texStep.xy;float mapHeight=1.;float bumpHeightStep=1./float(PARALLAX_MAP_STEPS);float bestBumpHeight=mapHeight+bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_STEPS;i++){if(mapHeight<bestBumpHeight){bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);}}
#pragma unroll_loop_end
bestBumpHeight+=bumpHeightStep;
#pragma unroll_loop_start
for(int i=0;i<PARALLAX_MAP_B_STEPS;i++){bumpHeightStep*=0.5;bestBumpHeight-=bumpHeightStep;mapHeight=back_face+surf_sign*CalculateHeight(texC.xy-bestBumpHeight*texStep.xy);bestBumpHeight+=(bestBumpHeight<mapHeight)?bumpHeightStep:0.;}
#pragma unroll_loop_end
bestBumpHeight-=bumpHeightStep*clamp((bestBumpHeight-mapHeight)/bumpHeightStep,0.,1.);mapHeight=bestBumpHeight;texC-=mapHeight*texStep;return vec3(texC.xy,mapHeight);}vec3 reliefParallaxPerturbNormal(in float faceDirection,inout vec3 normal){if(abs(bumpScale)<0.001)return vec3(vUv,0.);float parallaxHeight;vec2 texCoords=vUv;float face_sign=sign(dot(normal,vViewPosition));vec3 N=normalize(normal);vec3 dp1=dFdx(-vViewPosition);vec3 dp2=dFdy(-vViewPosition);vec2 duv1=dFdx(vUv);vec2 duv2=dFdy(vUv);vec3 dp2perp=cross(dp2,N);vec3 dp1perp=cross(N,dp1);vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;float invmax=inversesqrt(max(dot(T,T),dot(B,B)));mat3 tbnMat=mat3(T*invmax,B*invmax,N*bumpScale);vec3 tangentPos=normalize(mat3_inverse(tbnMat)*-vViewPosition);vec3 parallaxUv=ReliefParallax(face_sign,tangentPos,vUv);tbnMat[2]=face_sign*N/bumpScale;normal=normalize(tbnMat*CalculateNormal(parallaxUv.xy).xyz);
#ifdef FLIP_SIDED
normal=-normal;
#endif
return parallaxUv;}
#endif 

`.replaceAll("PARALLAX_MAP_STEPS",this._defines.PARALLAX_MAP_STEPS).replaceAll("PARALLAX_MAP_B_STEPS",this._defines.PARALLAX_MAP_B_STEPS):"",isCompatible:e=>e.isMeshStandardMaterial2,computeCacheKey:e=>{var t;return this.enabled+" "+((t=e.materialObject.bumpMap)===null||t===void 0?void 0:t.uuid)+" "+this.debugNormals+" "+this.debugHitHeight+"  "},onObjectRender:(e,{materialObject:t},n)=>{for(const[r,o]of Object.entries(this._defines)){const a=typeof o=="number"?o:o?1:0;t.defines[r]!==a&&(t.defines[r]=a,t.needsUpdate=!0)}}},this.dependencies=[dn],this.enabled=s,this._updateExtension=this._updateExtension.bind(this)}_updateExtension(){var s,e,t;(e=(s=this._bumpMapExtension)===null||s===void 0?void 0:s.setDirty)===null||e===void 0||e.call(s),(t=this._viewer)===null||t===void 0||t.setDirty()}async onAdded(s){var e,t;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.registerMaterialExtension(this._bumpMapExtension),super.onAdded(s)}async onRemove(s){var e,t;return(t=(e=s.getPlugin(dn))===null||e===void 0?void 0:e.materials)===null||t===void 0||t.unregisterMaterialExtension(this._bumpMapExtension),super.onRemove(s)}};yu.PluginType="ReliefParallaxMapping",v_([we(mm.prototype._updateExtension),_n("Enabled")],yu.prototype,"enabled",void 0),v_([we(mm.prototype._updateExtension),_n("Debug Normals")],yu.prototype,"debugNormals",void 0),v_([we(mm.prototype._updateExtension),_n("Debug Hit Height")],yu.prototype,"debugHitHeight",void 0),v_([Xe("PARALLAX_MAP_STEPS",void 0,!0,mm.prototype._updateExtension),wn("Step count",[1,32],1),et()],yu.prototype,"stepCount",void 0),v_([Xe("PARALLAX_MAP_B_STEPS",void 0,!0,mm.prototype._updateExtension),wn("Binary search steps",[1,8],1),et()],yu.prototype,"binaryStepCount",void 0),yu=mm=v_([Ci("Parallax Mapping")],yu);var wc=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};class jl extends _s{constructor(e,t,n,r=!1){super({vertexShader:Sl,fragmentShader:`

${Um}
${Kp}
${Cl}
${K_}
${n}

${jm}

varying vec2 vUv;uniform float intensity;uniform float objectRadius;uniform float rayCount;uniform float power;uniform float bias;uniform float falloff;uniform float tolerance;uniform bool autoRadius;uniform vec2 screenSize;vec3 ComputeUniformL(vec3 N,vec2 E){vec3 L;L.xy=E;L.z=interleavedGradientNoise(gl_FragCoord.xy,frameCount*5.);L=L*2.-1.;return L;}vec2 GetRandomE(float seed){vec2 rand_e;rand_e.x=random3(vec3(gl_FragCoord.xy,frameCount+seed));rand_e.y=random3(vec3(gl_FragCoord.yx,rand_e.x+(frameCount)*7.));return rand_e;}vec4 calculateGI(in float seed,in vec3 screenPos,in vec3 normal,in float radiusFactor){vec3 viewPos=screenToView(screenPos.xy,screenPos.z);normal=normalize(normal);vec2 E=GetRandomE(seed);vec3 L=ComputeUniformL(normal,E);L=normalize(L);L*=sign(dot(L,normal));float cameraDist=length(cameraPositionWorld);float rayLen=autoRadius?length(viewPos-screenToView(screenPos.xy+objectRadius/10.,screenPos.z)):mix((cameraNearFar.y)+viewPos.z,-viewPos.z-cameraNearFar.x,L.z*0.5+0.5)*objectRadius;rayLen*=radiusFactor;float r=interleavedGradientNoise(gl_FragCoord.xy,frameCount*14.+seed)+0.05;rayLen=max(rayLen,0.001);vec3 state=vec3(1.,(r+0.5)/float(RTAO_STEP_COUNT),2.);viewPos+=normal*max(-0.01*viewPos.z,0.001);vec3 screenHitP=traceRay(viewPos,L*rayLen,tolerance*rayLen,state,RTAO_STEP_COUNT);vec3 viewHitP=screenToView(screenHitP.xy,screenHitP.z);vec3 LRes=viewHitP-viewPos;if(state.z>1.)LRes=vec3(9999999.);float dist=length(LRes)*falloff;float EPS=0.01;float zBias=(viewPos.z)*bias;float ao=(max(dot(normal,L)+zBias,0.))/(dist*dist+EPS);
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 hitColor=tLastFrameTexelToLinear(texture2D(tLastFrame,screenHitP.xy)).rgb;vec3 hitNormal=getViewNormal(screenHitP.xy);float giWeight=1.;giWeight=saturate2(giWeight/(dist+EPS),1.);giWeight*=saturate2((dot(normal,L)),1.);giWeight*=saturate2((dot(hitNormal,-L)),1.);return vec4(hitColor*giWeight,ao);
#endif
return vec4(0,0,0,ao);}float normpdf(in float x,in float sigma){return exp(-0.5*x*x/(sigma*sigma));}vec4 getLastThis(sampler2D tex,float depth,vec3 normal){vec2 direction=vec2(1,1);vec4 color=clamp(tLastThisTexelToLinear(texture2D(tex,vUv.xy)),0.,5.);return color;}void main(){float depth;vec3 normal;getDepthNormal(vUv,depth,normal);if(depth>0.99){discard;gl_FragColor=getLastThis(tLastThis,depth,normal);return;}float viewZ=depthToViewZ(depth);vec3 screenPos=vec3(vUv.x,vUv.y,viewZ);vec4 gi=vec4(0.);gi+=calculateGI(8.,screenPos,normal,1.);if(rayCount>1.5)gi=max(gi,calculateGI(2.,screenPos,normal,0.4));if(rayCount>2.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.5));if(rayCount>3.5)gi=max(gi,calculateGI(1.,screenPos,normal,0.6));if(rayCount>4.5)gi=max(gi,calculateGI(3.,screenPos,normal,1.));gi.a=min(1.,gi.a);gi.a=max(0.,gi.a);gi.rgb=min(vec3(3.),gi.rgb);gi.rgb=max(vec3(0.),gi.rgb);if(frameCount<3.){gl_FragColor=gi;return;}gl_FragColor=(texture2D(tLastThis,vUv));gl_FragColor=((gi+(gl_FragColor)*frameCount)/(frameCount+1.));}

            `,uniforms:{tLastThis:{value:null},tDiffuse:{value:null},tNormalDepth:{value:null},tLastFrame:{value:null},opacity:{value:1},intensity:{value:2.14},rayCount:{value:.1},objectRadius:{value:1},autoRadius:{value:!r},power:{value:1.1},bias:{value:.015},falloff:{value:.7},tolerance:{value:1.5},frameCount:{value:0},projection:{value:new c.yGw},screenSize:{value:new c.FM8},cameraPositionWorld:{value:new c.Pa4},cameraNearFar:{value:new c.FM8(.1,1e3)}},defines:{PERSPECTIVE_CAMERA:1,SSGI_ENABLED:r?1:0}},"tDiffuse","tLastFrame","tLastThis"),this.materialExtension={shaderExtender:(o,a,u)=>{if(!o.defines.SSRTAO_ENABLED)return;const p="vec3 totalDiffuse =";o.fragmentShader=o.fragmentShader.replace(p,`

            
            #if defined(SSRTAO_ENABLED) && SSRTAO_ENABLED > 0
vec4 ssgi=tSSGIMapTexelToLinear(texture2D(tSSGIMap,viewToScreen(vViewPosition.xyz).xy));float ambientOcclusion=1.-ssgi.a;ambientOcclusion=max(0.,ambientOcclusion);ambientOcclusion=pow(ambientOcclusion,ssaoPower);ambientOcclusion=min(1.,ambientOcclusion);reflectedLight.indirectDiffuse*=ambientOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
vec3 ssgiColor=ssgi.rgb*ssgiIntensity;reflectedLight.indirectDiffuse+=ssgiColor*(material.diffuseColor.rgb);
#endif
#if defined( USE_ENVMAP )
float dotNV=saturate(dot(geometry.normal,geometry.viewDir));float specularOcclusion=saturate(pow(dotNV+ambientOcclusion,exp2(-16.*material.roughness-1.))-1.+ambientOcclusion);reflectedLight.indirectSpecular*=specularOcclusion;
#if defined(SSGI_ENABLED) && SSGI_ENABLED > 0
#if !defined(SSR_ENABLED) || SSR_ENABLED < 1
reflectedLight.indirectSpecular+=ssgiColor*material.specularColor;
#endif
#endif
#endif
#endif

            
            // reflectedLight.directDiffuse = vec3(0.);
            // reflectedLight.indirectDiffuse = vec3(0.);
            // reflectedLight.directSpecular = vec3(0.);
            // reflectedLight.indirectSpecular = vec3(0.);
            
            
${p}`),o.fragmentShader=o.fragmentShader.replace("#include <aomap_fragment>",""),o.vertexUvs=!0},onObjectRender:(o,a,u)=>{var p,f,m;this.materialExtension.extraUniforms.tSSGIMap.value=(p=this._target)===null||p===void 0?void 0:p.texture;const y=a.materialObject,S=!y.transparent&&y.transmission<.001;let M=this.enabled&&S&&(this.renderWithCamera||this._renderer.frameCount>1)&&u.userData.screenSpaceRendering!==!1&&!(!((f=y.userData)===null||f===void 0)&&f.ssrtaoDisabled)&&!(!((m=y.userData)===null||m===void 0)&&m.ssaoDisabled)?1:0;y.defines.SSRTAO_ENABLED!==M&&(y.defines.SSRTAO_ENABLED=M,y.needsUpdate=!0),M=this.material.defines.SSGI_ENABLED,y.defines.SSGI_ENABLED!==M&&(y.defines.SSGI_ENABLED=M,y.needsUpdate=!0),M=this._target.texture,this.materialExtension.extraUniforms.tSSGIMap.value!==M&&(this.materialExtension.extraUniforms.tSSGIMap.value=M,y.needsUpdate=!0)},parsFragmentSnippet:o=>{var a;return Z`
            uniform float ssaoPower;
            uniform float ssgiIntensity;
            uniform sampler2D tSSGIMap;
            ${ft("tSSGIMap",(a=this._target)===null||a===void 0?void 0:a.texture,o.capabilities.isWebGL2)}

            ${zm}

        `},extraUniforms:{tSSGIMap:{value:null},ssaoPower:this.material.uniforms.power,ssgiIntensity:this.material.uniforms.intensity},computeCacheKey:o=>{var a,u;return this.enabled?"1":"0"+((u=(a=this._target)===null||a===void 0?void 0:a.texture)===null||u===void 0?void 0:u.encoding)},isCompatible:o=>{var a;return!(!((a=o.materialObject.userData)===null||a===void 0)&&a.ssaoDisabled)&&o.isMeshStandardMaterial2}},this.intensity=2,this.power=1.1,this.autoRadius=!0,this.objectRadius=2,this.tolerance=1,this.bias=.15,this.falloff=.7,this.rayCount=2,this.stepCount=4,this.smoothEnabled=!0,this.renderWithCamera=!0,this.uiConfig={type:"folder",label:"SS Global illumination (Dev)",children:[...Ql(this),{type:"checkbox",label:"GI Enabled",hidden:()=>!this._giActivated,property:[this,"ssgiEnabled"]}]},this._renderer=e,this._target=t,this.needsSwap=!0,this._giActivated=r,this.ssgiEnabled=r,this.bilateralPass=new Gm(this._target,n,"rgba")}get ssgiEnabled(){return parseInt(this.material.defines.SSGI_ENABLED)>.5}set ssgiEnabled(e){e=e&&this._giActivated,this.material.defines.SSGI_ENABLED=e?1:0,this.material.needsUpdate=!0}render(e,t,n,r,o){this.needsSwap=!1,!this.renderWithCamera&&this._renderer.frameCount<2||(this._renderer.blit(this._target.texture,t),this.uniforms.tLastThis.value=t.texture,super.render(e,this._target,n,r,o),this.smoothEnabled&&this.bilateralPass.render(e,t,n,r,o))}}wc([et()],jl.prototype,"bilateralPass",void 0),wc([wn("Intensity",[0,4]),et(),be()],jl.prototype,"intensity",void 0),wc([wn("Power",[0,3]),et(),be()],jl.prototype,"power",void 0),wc([_n("Auto radius"),et(),be()],jl.prototype,"autoRadius",void 0),wc([wn("Object Radius",[.01,10]),et(),be()],jl.prototype,"objectRadius",void 0),wc([wn("Tolerance",[.1,5]),et(),be()],jl.prototype,"tolerance",void 0),wc([wn("Bias",[-.3,.3]),et(),be()],jl.prototype,"bias",void 0),wc([wn("Falloff",[1e-4,4]),et(),be()],jl.prototype,"falloff",void 0),wc([wn("Ray Count",[1,5],1),et(),be()],jl.prototype,"rayCount",void 0),wc([wn("Step count",[1,16],1),et(),Xe("RTAO_STEP_COUNT")],jl.prototype,"stepCount",void 0),wc([_n("Smooth Enabled"),et()],jl.prototype,"smoothEnabled",void 0),wc([_n("Render with Camera")],jl.prototype,"renderWithCamera",void 0);class Eb extends Xp{constructor(e=!0){super(),this.dependencies=[dn,xr,lo],this._initEnabled=!1,this.setDirty=this.setDirty.bind(this),this._initEnabled=e}get rtgiTarget(){return this._rtgiTarget}async onAdded(e){var t,n;await super.onAdded(e),this.enabled=this._initEnabled,(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}get enabled(){var e,t;return((t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.enabled)||!1}set enabled(e){var t;!((t=this.passes.ssrtgi)===null||t===void 0)&&t.passObject&&(this.passes.ssrtgi.passObject.enabled=e)}createPasses(e){var t,n,r;this._rtgiTarget=e.renderer.createTarget({sizeMultiplier:1});let o=!1;return(t=this._viewer)===null||t===void 0||t.getPluginByType("debug"),[Qd(e,{passId:"ssrtgi",after:["gbuffer"],before:["render"],required:["render","gbuffer","progressive"],passObject:new jl(e.renderer,this._rtgiTarget,(r=(n=e.getPlugin(xr))===null||n===void 0?void 0:n.getUnpackSnippet())!==null&&r!==void 0?r:"",!0),update:()=>{var a;let u=this.enabled;if(u&&!o){const p=(a=this._viewer)===null||a===void 0?void 0:a.getPluginByType("SSAO");p!=null&&p.enabled&&(confirm("SSAO Plugin needs to be disabled to enable SSRTGI or SSRTAO. Disable now?")?p.enabled=!1:(this.enabled=!1,u=!1))}o=u,u&&this.passes.ssrtgi.passObject.bilateralPass.updateShaderProperties([e.getPlugin(xr)])}},()=>[e.getPlugin(xr),e.getPlugin(lo),e.scene.activeCamera,e.renderer])]}async onRemove(e){return e.renderer.disposeTarget(this._rtgiTarget),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n,r,o;const a=(n=(t=(e=this.passes.ssrtgi)===null||e===void 0?void 0:e.passObject)===null||t===void 0?void 0:t.uiConfig)!==null&&n!==void 0?n:{};return(o=(r=a.children)===null||r===void 0?void 0:r.map(u=>Se(u)))===null||o===void 0||o.flat(2).forEach(u=>u&&(u.onChange=this.setDirty)),a}}Eb.PluginType="SSGI";class Sp extends ui{constructor(){super(...arguments),this.enabled=!0,this._uiNeedRefresh=!1,this.dependencies=[dn],this.variations=[],this._selectedSwitchNode=()=>{var e;const t=(e=this._picking)===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;const n=this.variations.map(o=>o.name);let r;return t.traverseAncestors(o=>{r||n.includes(o.name)&&(r=o)}),r},this.uiConfig={label:"Switch Node",type:"folder",children:[()=>[{type:"folder",label:"All nodes",expanded:!0,children:[this.variations.map(e=>({type:"input",label:e.title,property:[e,"name"],onChange:()=>this.refreshUi()}))]},{type:"button",label:"Add Node",value:()=>{this.variations.push({name:"switch_node",selected:"",title:"Switch Node",camView:"front",camDistance:1}),this.refreshUi()}},{type:"button",label:"Refresh UI",value:()=>this.refreshUi()},{type:"input",label:"Selected node title",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"title"]:[]},onChange:()=>this.refreshUi()},{type:"slider",bounds:[.01,2],stepSize:.01,label:"Cam Distance",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camDistance"]:[]}},{type:"dropdown",label:"Cam View",hidden:()=>!this._selectedSwitchNode(),property:()=>{const e=this._selectedSwitchNode();return e?[this.variations.find(t=>t.name===e.name),"camView"]:[]},onChange:()=>this.refreshUi(),children:["top","bottom","front","back","left","right"].map(e=>({label:e,value:e}))}]]}}async onAdded(e){var t,n;await super.onAdded(e),this._picking=(t=this._viewer)===null||t===void 0?void 0:t.getPluginByType("Picking"),(n=this._picking)===null||n===void 0||n.addEventListener("selectedObjectChanged",()=>{var r,o;(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r)}),e.addEventListener("postFrame",()=>{this._uiNeedRefresh&&this._refreshUi()}),e.addEventListener("preRender",()=>{if(this._viewer)for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);if(!o||o.children.length<1)return;r.selected||(r.selected=o.children[0].name||o.children[0].uuid);for(const a of o.children)a.visible=(a.name||a.uuid)===r.selected}}),e.addEventListener("postRender",()=>{if(this._viewer)for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);if(!o||o.children.length<1)return;for(const a of o.children)a.visible=!0}}),this.addEventListener("deserialize",async()=>{await is(200),this.refreshUi()})}refreshUi(){this.enabled&&(this._uiNeedRefresh=!0)}_refreshUi(){var e,t,n;if(this.enabled&&this._viewer){this._uiNeedRefresh=!1,_u.RemoveAll(Sp.PluginType);for(const r of this.variations){const o=this._viewer.scene.getObjectByName(r.name);o?(o.children.length<1&&console.warn("SwitchNode does not have enough children",r),_u.Create(Sp.PluginType,r.title,Math.min(5,o.children.length),20,0,o.children.map(a=>{const u=r.camView,p=new c.Pa4((u.includes("right")?1:0)-(u.includes("left")?1:0),(u.includes("top")?1:0)-(u.includes("bottom")?1:0),(u.includes("front")?1:0)-(u.includes("back")?1:0));r.camDistance||(r.camDistance=1);const f=lx(this._viewer,a,void 0,7,p.multiplyScalar(.5*r.camDistance));return{id:a.uuid,image:f,onClick:()=>{var m;r.selected=a.name||a.uuid,(m=this._viewer)===null||m===void 0||m.scene.setDirty({sceneUpdate:!0,frameFade:!0})},tooltip:a.name||a.uuid}}),(a,u)=>Dx(a,{placement:"bottom",content:u.tooltip}))):console.warn("no object found for variation, skipping",r)}_u.RebuildUi((e=this._viewer)===null||e===void 0?void 0:e.container),(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t)}}}Sp.PluginType="SwitchNodePlugin",function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);o>3&&a&&Object.defineProperty(e,t,a)}([et()],Sp.prototype,"variations",void 0);class Rx extends c.u9r{constructor(e,t,n=32,r=64,o=!1,a=new c.FM8(1,1),u="shape"){super(),this.type="TubeShapeGeometry",this.parameters={path:t,shape:e,shapeSegments:n,tubularSegments:r,closed:o,primary:u,shapeScale:a.clone()};const p=t.computeFrenetFrames(r,o);this.frames=p;const f=new c.Pa4,m=new c.Pa4,y=new c.Pa4,S=new c.FM8;let M=new c.Pa4;const P=[],D=[],j=[],k=e.getSpacedPoints(n);for(const W of k)W.multiply(a);(function(){for(let W=0;W<r;W++)R(W);R(o===!1?r:0),function(){for(let W=0;W<=r;W++)for(let q=0;q<=n;q++)S.x=W/r,S.y=q/n,D.push(S.x,S.y)}(),function(){const W=u==="shape",q=W?n:r,J=W?r:n;for(let ee=1;ee<=q;ee++)for(let he=1;he<=J;he++){const[xe,De]=W?[he,ee]:[ee,he],Fe=(n+1)*(xe-1)+(De-1),ke=(n+1)*xe+(De-1),Qe=(n+1)*xe+De,Oe=(n+1)*(xe-1)+De;j.push(Fe,ke,Oe),j.push(ke,Qe,Oe)}}()})(),this.setIndex(j),this.setAttribute("position",new c.a$l(P,3)),this.setAttribute("uv",new c.a$l(D,2)),this.computeVertexNormals();const L=this.attributes.normal;function R(W){M=t.getPointAt(W/r,M);const q=p.normals[W],J=p.binormals[W];for(let ee=0;ee<=n;ee++){const he=k[ee%n];m.set(0,0,0).addScaledVector(q,he.x).addScaledVector(J,he.y),f.copy(M).add(m),P.push(f.x,f.y,f.z)}}(function(){for(let q=1;q<n;q++){const J=q+r*(n+1);m.fromBufferAttribute(L,q),y.fromBufferAttribute(L,J),m.add(y).normalize(),L.setXYZ(q,m.x,m.y,m.z),L.setXYZ(J,m.x,m.y,m.z)}for(let q=1;q<r;q++){const J=q*(n+1),ee=J+n;m.fromBufferAttribute(L,J),y.fromBufferAttribute(L,ee),m.add(y).normalize(),L.setXYZ(J,m.x,m.y,m.z),L.setXYZ(ee,m.x,m.y,m.z)}m.fromBufferAttribute(L,0),y.fromBufferAttribute(L,n),m.add(y);const W=r*(n+1);y.fromBufferAttribute(L,W),m.add(y),y.fromBufferAttribute(L,W+n),m.add(y),m.normalize(),L.setXYZ(0,m.x,m.y,m.z),L.setXYZ(n,m.x,m.y,m.z),L.setXYZ(W,m.x,m.y,m.z),L.setXYZ(W+n,m.x,m.y,m.z),L.needsUpdate=!0})()}createSplits(e){this.clearGroups();const t=this.parameters.primary==="shape"?this.parameters.shapeSegments:this.parameters.tubularSegments,n=this.index.count,r=[...e,1].sort();let o=0,a=0;for(const u of r){const p=Math.round(t*u)*n/t;this.addGroup(o,p-o,a++),o=p}return this.groups.length}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e.shape=this.parameters.shape.toJSON(),e}}var Bx,Cp=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let zl=Bx=class extends ui{constructor(){super(...arguments),this.enabled=!0,this.shapeSegments=32,this.tubularSegments=32,this.shapeScale=new c.FM8(1,1),this.materialSplits="0.3, 0.6",this.horizontalSplits=!0,this.extrudeCirceTube=async()=>{var s,e;const t=(e=(s=this._viewer)===null||s===void 0?void 0:s.getPlugin(er))===null||e===void 0?void 0:e.getSelectedObject();if(!t)return;let n=this._viewer.prompt("Radius: Radius for the circle","1",!0);if(!n)return;n=parseFloat(n);const r=new kx(0,0,n,n,0,2*Math.PI,!0,0);await this.extrudeObject(t,r)}}async onAdded(s){await super.onAdded(s)}static CreateCurve(s,e){var t,n;if(s==="circle")return new kx(0,0,(t=e.radius)!==null&&t!==void 0?t:1,(n=e.radius)!==null&&n!==void 0?n:1,0,2*Math.PI,!0,0);throw new Error("Unknown curve type")}async extrudeObject(s,e,t=this.shapeSegments,n=this.tubularSegments,r=this.shapeScale,o=this.materialSplits.split(",").map(u=>parseFloat(u.trim())),a=this.horizontalSplits){var u,p,f,m,y,S,M,P;if(s.userData.isExtrudedTube,s.userData._extrudeSource){const W=s.userData._extrudeSource;if(s=(u=s.parent)===null||u===void 0?void 0:u.children.find(q=>W===q.uuid),!s)return void console.warn("Could not find extrude source with uuid",W)}if(s.userData.extrudedObject){const W=s.userData.extrudedObject,q=(p=s.parent)===null||p===void 0?void 0:p.children.find(J=>W===J.uuid);q&&(q.removeFromParent(),q.geometry.dispose(),q.geometry=null,q.material=null),delete s.userData.extrudedObject}const D=s.geometry;if(!D)return void((f=this._viewer)===null||f===void 0||f.alert("Extrude: No geometry to extrude"));const j=[s.material];let k;try{const W=Bx.ConvertGeometryToFlatShape(D);k=new Rx(W,e,t,n,!0,r,a?"shape":"path"),k.computeBoundingBox(),k.createSplits(o)}catch(W){return void((m=this._viewer)===null||m===void 0||m.alert(typeof W=="string"?W:W==null?void 0:W.message))}j[0].color.set(16777215);for(let W=j.length;W<k.groups.length;W++){const q=j[0].clone();j.push(q),q.color.set(16777215*Math.random())}const L=new c.Kj0(k,j);L.userData._extrudeSource=s.uuid,L.userData.isExtrudedTube=!0,s.visible=!1,s.userData.bboxVisible=!1,L.name=s.name+"_extruded";const R=await((M=(S=(y=this._viewer)===null||y===void 0?void 0:y.getManager())===null||S===void 0?void 0:S.importer)===null||M===void 0?void 0:M.processImportedSingle(L,{autoCenter:!1,autoScale:!1}));R&&((P=s.parent)===null||P===void 0||P.add(R.modelObject),s.userData.extrudedObject=R.modelObject.uuid,R.dispatchEvent({type:"select",ui:!0,value:R}))}static ExtrudeShape(s,e,t,n,r,o,a,u){const p=new Rx(s,n,e,t,!0,new c.FM8(r,o),u?"shape":"path");p.computeBoundingBox(),p.createSplits(a);const f=new c.Kj0(p,[]);return f.userData.isExtrudedTube=!0,f}static ConvertGeometryToFlatShape(s,e=!0){if(s.userData.__planarShape)return s.userData.__planarShape;let t=s.attributes.position;if(!t)throw"no position attribute";if(t.count>500)throw"too large to extrude";const n=s;t=n.attributes.position,n.boundingBox||n.computeBoundingBox();const r=n.boundingBox.getSize(new c.Pa4),o=r.x<.001?"x":r.y<.001?"y":r.z<.001?"z":null;if(!o)throw"geometry is not axis aligned not planar";let a=[];for(let p=0;p<t.count;p++){const f=new c.FM8;o==="x"?f.set(t.getY(p),t.getZ(p)):o==="y"?f.set(t.getX(p),t.getZ(p)):f.set(t.getX(p),t.getY(p)),a.push(f)}if(e){let p=0;for(let f=0;f<a.length;f++)(a[f].x<a[p].x||a[f].x===a[p].x&&a[f].y<a[p].y)&&(p=f);p!==0&&(a=a.slice(p).concat(a.slice(0,p)))}const u=new c.bnF(a);return s.userData.__planarShape=u,u}};zl.PluginType="ShapeTubeExtrudePlugin",Cp([_n("Enabled")],zl.prototype,"enabled",void 0),Cp([wn("Shape Segments (X)",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"shapeSegments",void 0),Cp([wn("Tube Segments (Y)",[1,100],1,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"tubularSegments",void 0),Cp([Yr("Shape scale",[.01,10],.01,s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"shapeScale",void 0),Cp([Si("Material Splits",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"materialSplits",void 0),Cp([_n("Horizontal Splits",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"horizontalSplits",void 0),Cp([Ji("Extrude Circle Tube",s=>({hidden:()=>{var e,t;return!(!((t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0)&&t.getSelectedObject())}}))],zl.prototype,"extrudeCirceTube",void 0),zl=Bx=Cp([Ci("Extrude Tube Shapes")],zl);class kx extends c.Ny0{getPoint(e,t){return super.getPoint(e,t||new c.Pa4)}}class b0 extends ui{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.fromJSON=void 0,this._lastFrameTime=0,this._updaters=[],this.dependencies=[],this._fadeDisabled=!1,this.disableFrameFade=!0,this._postFrame=()=>{var t,n;if(!this._viewer)return;if(!this.enabled||Object.keys(this.animations).length<1)return this._lastFrameTime=0,void(this._fadeDisabled&&((t=this._viewer.getPluginByType("FrameFade"))===null||t===void 0||t.enable(b0.PluginType),this._fadeDisabled=!1));const r=Mi()/1e3;this._lastFrameTime<1&&(this._lastFrameTime=r-1/60);let o=r-this._lastFrameTime;this._lastFrameTime=r;const a=(n=this._viewer.getPluginByType("Progressive"))===null||n===void 0?void 0:n.postFrameConvergedRecordingDelta();if(a&&a>0&&(o=a),a!==0&&(o*=1e3,!(o<=.001)&&(this._updaters.forEach(u=>{let p=o;u.time+p<0&&(p=-u.time),u.time+=p,Math.abs(p)>.001&&u.u(p)}),!this._fadeDisabled&&this.disableFrameFade))){const u=this._viewer.getPluginByType("FrameFade");u&&(u.disable(b0.PluginType),this._fadeDisabled=!0)}},this.defaultDriver=t=>({start:()=>this._updaters.push({u:t,time:0}),stop:()=>this._updaters.splice(this._updaters.findIndex(n=>n.u===t),1)}),this.animations={},this.enabled=e,this._postFrame=this._postFrame.bind(this)}async onAdded(e){await super.onAdded(e),e.addEventListener("postFrame",this._postFrame)}async onRemove(e){return e.removeEventListener("postFrame",this._postFrame),super.onRemove(e)}animate(e){const t=ki(),n={id:t,options:e,stop:()=>{var r,o,a;!((r=this.animations[t])===null||r===void 0)&&r._stop?(a=(o=this.animations[t])===null||o===void 0?void 0:o._stop)===null||a===void 0||a.call(o):console.warn("Animation not started")}};return this.animations[t]=n,n.promise=new Promise((r,o)=>{const a={driver:this.defaultDriver,onComplete:()=>{var p;(p=e.onComplete)===null||p===void 0||p.call(e),r()},onStop:()=>{var p;(p=e.onStop)===null||p===void 0||p.call(e),r()},...e},u=ep(a);this.animations[t]._stop=u.stop,this.animations[t].options=a}).then(()=>(delete this.animations[t],t)),this.animations[t]}async animateAsync(e){return this.animate(e).promise}}b0.PluginType="PopmotionPlugin";const IT=async s=>ps(await(await fetch(s)).blob());async function $S(s,e=IT){const t=s.match(/(((ftp|https?):\/\/)[\-\w@:%_\+.~#?,&\/\/=]+)/g);if(t)for(const n of t){const r=await e(n);s=s.replace(n,r)}return s}function Ox(s,e,{width:t,height:n},r=!0){const o=`
<svg viewBox="0 0 ${t} ${n}" xmlns="http://www.w3.org/2000/svg">
    <style>
    ${e}
    </style>
    <foreignObject x="0" y="0" width="100%" height="100%">
        <div xmlns="http://www.w3.org/1999/xhtml" style="height: 100%; width: 100%; position: absolute: top:0; left:0">
            ${s}
        </div>
    </foreignObject>
</svg>
    `;return r?Be(o):o}async function PT(s,e,t){const n=Ox(s,e,t);return await ux(n,t)}async function DT(s,e,t){const n=Ox(s,e,t);return await tS(n,t)}var Lx,bu,gs=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Na=s=>({onChange:e=>{e.last&&s.onChange()}});let fo=Lx=class{constructor(){this.text="Custom Text",this.fontSize=100,this.width=1024,this.height=1024,this.xOffset=0,this.yOffset=0,this.boxWidth=1024,this.boxHeight=1024,this.fontFamily="",this.fontPath="",this.maskText=!1,this.innerShadow=!1,this.textColor="#000000",this.bgFillColor="#ffffff",this.svgBackground="#ffffff",this.onChange=()=>{}}set(s){Object.assign(this,s)}reset(){const s=this.onChange;Object.assign(this,new Lx),this.onChange=s}toJSON(){return{text:this.text,fontFamily:this.fontFamily,fontPath:this.fontPath,svgBackground:this.svgBackground,width:this.width,height:this.height,xOffset:this.xOffset,yOffset:this.yOffset,boxWidth:this.boxWidth,boxHeight:this.boxHeight,fontSize:this.fontSize,maskText:this.maskText,innerShadow:this.innerShadow,bgFillColor:this.bgFillColor,textColor:this.textColor}}};gs([Si("Text",Na)],fo.prototype,"text",void 0),gs([wn("Font Size",[2,400],1,Na)],fo.prototype,"fontSize",void 0),gs([wn("Width",[2,4096],1,Na)],fo.prototype,"width",void 0),gs([wn("Height",[2,4096],1,Na)],fo.prototype,"height",void 0),gs([wn("X Offset",[-1024,1024],1,Na)],fo.prototype,"xOffset",void 0),gs([wn("Y Offset",[-1024,1024],1,Na)],fo.prototype,"yOffset",void 0),gs([wn("V-Width",[2,4096],1,Na)],fo.prototype,"boxWidth",void 0),gs([wn("V-Height",[2,4096],1,Na)],fo.prototype,"boxHeight",void 0),gs([Si("Font",Na)],fo.prototype,"fontFamily",void 0),gs([Si("Font Url",Na)],fo.prototype,"fontPath",void 0),gs([_n("Mask Text",Na)],fo.prototype,"maskText",void 0),gs([_n("Inner Shadow",Na)],fo.prototype,"innerShadow",void 0),gs([dl("Text Color",Na)],fo.prototype,"textColor",void 0),gs([dl("BG Fill",Na)],fo.prototype,"bgFillColor",void 0),gs([dl("SVG BG",Na)],fo.prototype,"svgBackground",void 0),fo=Lx=gs([Ci("Text SVG Options")],fo);const ZS={woff:"woff",woff2:"woff2",ttf:"truetype",otf:"opentype",eot:"embedded-opentype"},w0=s=>({hidden:()=>{const e=s.getSelected();return!e||!e.userData[Vl.PluginType]}});let Vl=bu=class extends ui{constructor(){super(),this.enabled=!0,this.getSelected=()=>{var s,e;return(e=(s=this._viewer)===null||s===void 0?void 0:s.getPluginByType("Picking"))===null||e===void 0?void 0:e.getSelectedObject()},this.options=new fo,this.applyToMap=!0,this.applyToBumpMap=!1,this.applyToAlphaMap=!0,this.inverseAlphaMap=!1,this._lastMeta=void 0,this.fonts={roboto:"https://fonts.gstatic.com/s/roboto/v30/KFOmCnqEu92Fr1Mu4mxKKTU1Kg.woff2"},this._assetLoadOptions=void 0,this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this.addTextToSelected=this.addTextToSelected.bind(this),this._paramsChanged=this._paramsChanged.bind(this),this.options.onChange=this._paramsChanged}async onAdded(s){var e;await super.onAdded(s),(e=s.getPluginByType("Picking"))===null||e===void 0||e.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}_selectedObjectChanged(){var s,e,t,n,r,o;if(!this.enabled)return;const a=this.getSelected();if(!a)return void((e=(s=this.uiConfig).uiRefresh)===null||e===void 0||e.call(s,"postFrame",!0));const u=a.userData[bu.PluginType];if(!u)return this.options.reset(),this._lastMeta=void 0,void((n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0));this._lastMeta!==u&&(this.options.set(u),this._lastMeta=u),(o=(r=this.uiConfig).uiRefresh)===null||o===void 0||o.call(r,"postFrame",!0)}_paramsChanged(){if(!this.enabled)return;const s=this.getSelected();s&&s.isMesh&&s.userData[bu.PluginType]&&this.updateText(s,this.options.toJSON())}async addTextToSelected(){var s;const e=this.getSelected();e&&e.isMesh?e.material?(e.userData[bu.PluginType]||!e.material.map||await((s=this._viewer)===null||s===void 0?void 0:s.confirm("Add Text: This mesh already has a texture. Adding text will replace the texture. Continue?")))&&await this.addText(e):console.error("no material on mesh"):console.error("no mesh is selected")}async addText(s,e){return this.updateText(s,Object.assign(this.options.toJSON(),e))}async updateText(s,e){var t,n;if(!s.isMesh)return;if(!s.material)return void console.error("updateText: no material on mesh");let r=s.userData[bu.PluginType];r||(s.userData[bu.PluginType]=r={}),Object.assign(r,e);const o=s.material;o.map&&(o.map._isSimpleTextTexture&&o.map.dispose(),o.map=void 0),o.alphaMap&&(o.alphaMap._isSimpleTextTexture&&o.alphaMap.dispose(),o.alphaMap=void 0),o.bumpMap&&(o.bumpMap._isSimpleTextTexture&&o.bumpMap.dispose(),o.bumpMap=void 0);const a=await this.makeTextSvg(r);this.applyToMap&&(o.map=a),this.applyToAlphaMap&&(o.alphaMap=a,o.transparent=!0),this.applyToBumpMap&&(o.bumpMap=a),o.userData.inverseAlphaMap=this.inverseAlphaMap,o.setDirty(),o.needsUpdate=!0,(n=(t=this.uiConfig).uiRefresh)===null||n===void 0||n.call(t,"postFrame",!0)}async makeTextSvg(s){const e=s.fontFamily||"Arial",t=s.fontPath||this.fonts[e]||"";let n=s.style;if(t.length>0){const a=t.split("?")[0].split(".").pop()||"woff";n+=`
`+(t.length>0?`
            @font-face {
                font-family: ${e};
                src: url(${t}) format(${ZS[a]||a});
            }`:"")}let r=function({text:a="Custom Text",svgBackground:u="#ffffff",xOffset:p=0,yOffset:f=0,width:m=1024,height:y=1024,boxWidth:S=1024,boxHeight:M=1024,fontFamily:P="",fontSize:D=32,maskText:j=!0,innerShadow:k=!0,bgFillColor:L="#000000",textColor:R="#ffffff",style:W=""}){return`
<svg style="background-color:${u}" width="${m}" height="${y}" viewBox="0 0 ${S} ${M}"
 xmlns="http://www.w3.org/2000/svg"
 xmlns:xlink="http://www.w3.org/1999/xlink">
     <defs>
        <style>
        ${W}
        </style>
    </defs>

    <g style="overflow:hidden; text-anchor: middle; font-size: ${D}px; font-family: ${P||"Arial"}">
        <defs>

`+(j?`
<mask id="textMask">
<text style="fill:white; font-size: ${D}px;" x="${p+S/2}" y="${M/2+f+D/4}" > ${a} </text>
</mask>
`:"")+`

`+(k?`
<filter id="innerShadow" x="-20%" y="-20%" width="140%" height="140%">
<feGaussianBlur in="SourceGraphic" stdDeviation="0.5" result="blur"/>
<feOffset in="blur" dx="1.5" dy="1.5"/>
</filter>
`:"")+`

        </defs>

`+(j?`
        <g mask="url(#textMask)">
`:"")+`

        <rect x="0" y="0" width="${S}" height="${M}" style="fill:${L}"/>
        <text style="${k?"filter: url(#innerShadow);":""} fill:${R};" x="${p+S/2}" y="${M/2+f+D/4}"> ${a} </text>

`+(j?`
        </g>
`:"")+`

    </g>
</svg>
`}({...s,fontFamily:e,style:n});r=await $S(r,async a=>this._getAssetData(a)),r=Be(r);const o=await this._viewer.getManager().importer.importSinglePath(r,{generateMipmaps:!1,minFilter:c.wem});return o._isSimpleTextTexture=!0,o.flipY=!1,o.needsUpdate=!0,o}async _getAssetData(s){var e,t;if(s.startsWith("http://www.w3.org"))return s;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getManager())===null||t===void 0?void 0:t.importer;if(!n)throw new Error("no importer");this._assetLoadOptions=this._assetLoadOptions||{fileHandler:new Er(n.loadingManager),processImported:!1};try{return await n.importPath(s,this._assetLoadOptions)}catch(r){return console.error(r),""}}};Vl.PluginType="SimpleTextPlugin",gs([wr(void 0,{params:w0})],Vl.prototype,"options",void 0),gs([_n("Apply Map",w0),we(bu.prototype._paramsChanged)],Vl.prototype,"applyToMap",void 0),gs([_n("Apply Bump Map",w0),we(bu.prototype._paramsChanged)],Vl.prototype,"applyToBumpMap",void 0),gs([_n("Apply Alpha Map",w0),we(bu.prototype._paramsChanged)],Vl.prototype,"applyToAlphaMap",void 0),gs([_n("Invert Alpha Map",w0),we(bu.prototype._paramsChanged)],Vl.prototype,"inverseAlphaMap",void 0),gs([Ji("Add Text",s=>({hidden:()=>!s.getSelected()}))],Vl.prototype,"addTextToSelected",null),Vl=bu=gs([Ci("Simple Text")],Vl);class Nx{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y,this.array[this.top++]=e.z}}class RT{constructor(e){this.top=0,this.array=new Float32Array(e)}write(e){this.array[this.top++]=e.x,this.array[this.top++]=e.y}}class Ah{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)}clone(){const e=new Ah;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(t=>t.clone()),e}invert(){for(let t=0;t<this.polygons.length;t++)this.polygons[t].flip();this.plane&&this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();const e=this.front;this.front=this.back,this.back=e}clipPolygons(e){if(!this.plane)return e.slice();let t=new Array,n=new Array;for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],t,n,t,n);return this.front&&(t=this.front.clipPolygons(t)),n=this.back?this.back.clipPolygons(n):[],t.concat(n)}clipTo(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)}allPolygons(){let e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e}build(e){if(!e.length)return;this.plane||(this.plane=e[0].plane.clone());const t=[],n=[];for(let r=0;r<e.length;r++)this.plane.splitPolygon(e[r],this.polygons,this.polygons,t,n);t.length&&(this.front||(this.front=new Ah),this.front.build(t)),n.length&&(this.back||(this.back=new Ah),this.back.build(n))}}class ul{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}clone(){return new ul(this.x,this.y,this.z)}negate(){return this.x*=-1,this.y*=-1,this.z*=-1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}times(e){return this.x*=e,this.y*=e,this.z*=e,this}dividedBy(e){return this.x/=e,this.y/=e,this.z/=e,this}lerp(e,t){return this.add(new ul().copy(e).sub(this).times(t))}unit(){return this.dividedBy(this.length())}length(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2))}normalize(){return this.unit()}cross(e){const t=this.clone(),n=t.x,r=t.y,o=t.z,a=e.x,u=e.y,p=e.z;return this.x=r*p-o*u,this.y=o*a-n*p,this.z=n*u-r*a,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}toVector3(){return new c.Pa4(this.x,this.y,this.z)}}class gm{constructor(e,t){this.normal=e,this.w=t,this.normal=e,this.w=t}clone(){return new gm(this.normal.clone(),this.w)}flip(){this.normal.negate(),this.w=-this.w}splitPolygon(e,t,n,r,o){let a=0;const u=[];for(let p=0;p<e.vertices.length;p++){const f=this.normal.dot(e.vertices[p].pos)-this.w,m=f<-gm.EPSILON?2:f>gm.EPSILON?1:0;a|=m,u.push(m)}switch(a){case 0:(this.normal.dot(e.plane.normal)>0?t:n).push(e);break;case 1:r.push(e);break;case 2:o.push(e);break;case 3:{const p=[],f=[];for(let m=0;m<e.vertices.length;m++){const y=(m+1)%e.vertices.length,S=u[m],M=u[y],P=e.vertices[m],D=e.vertices[y];if(S!=2&&p.push(P),S!=1&&f.push(S!=2?P.clone():P),(S|M)==3){const j=(this.w-this.normal.dot(P.pos))/this.normal.dot(new ul().copy(D.pos).sub(P.pos)),k=P.interpolate(D,j);p.push(k),f.push(k.clone())}}p.length>=3&&r.push(new A_(p,e.shared)),f.length>=3&&o.push(new A_(f,e.shared));break}}}static fromPoints(e,t,n){const r=new ul().copy(t).sub(e).cross(new ul().copy(n).sub(e)).normalize();return new gm(r.clone(),r.dot(e))}}gm.EPSILON=1e-5;class A_{constructor(e,t){this.vertices=e,this.shared=t,this.plane=gm.fromPoints(e[0].pos,e[1].pos,e[2].pos)}clone(){return new A_(this.vertices.map(e=>e.clone()),this.shared)}flip(){this.vertices.reverse().map(e=>e.flip()),this.plane.flip()}}class Sb{constructor(e,t,n,r){this.pos=new ul().copy(e),this.normal=new ul().copy(t),this.uv=new ul().copy(n),this.uv.z=0,r&&(this.color=new ul().copy(r))}clone(){return new Sb(this.pos,this.normal,this.uv,this.color)}flip(){this.normal.negate()}interpolate(e,t){return new Sb(this.pos.clone().lerp(e.pos,t),this.normal.clone().lerp(e.normal,t),this.uv.clone().lerp(e.uv,t),this.color&&e.color&&this.color.clone().lerp(e.color,t))}}class xs{constructor(){this.polygons=new Array}static fromPolygons(e){const t=new xs;return t.polygons=e,t}static fromGeometry(e,t){let n=[];const r=e.attributes.position,o=e.attributes.normal,a=e.attributes.uv,u=e.attributes.color,p=e.groups;let f;if(e.index)f=e.index.array;else{f=new Array(r.array.length/r.itemSize|0);for(let y=0;y<f.length;y++)f[y]=y}const m=f.length/3|0;n=new Array(m);for(let y=0,S=0,M=f.length;y<M;y+=3,S++){const P=new Array(3);for(let D=0;D<3;D++){const j=f[y+D],k=3*j,L=2*j,R=r.array[k],W=r.array[k+1],q=r.array[k+2],J=o.array[k],ee=o.array[k+1],he=o.array[k+2],xe=a==null?void 0:a.array[L],De=a==null?void 0:a.array[L+1];P[D]=new Sb(new ul(R,W,q),new ul(J,ee,he),new ul(xe,De,0),u&&new ul(u.array[L],u.array[L+1],u.array[L+2]))}if(t===void 0&&p&&p.length>0)for(const D of p)y>=D.start&&y<D.start+D.count&&(n[S]=new A_(P,D.materialIndex));else n[S]=new A_(P,t)}return xs.fromPolygons(n.filter(y=>!isNaN(y.plane.normal.x)))}static toGeometry(e,t){let n=0;const r=e.polygons;for(const M of r)n+=M.vertices.length-2;const o=new c.u9r,a=new Nx(3*n*3),u=new Nx(3*n*3),p=new RT(2*n*3);let f;const m=[],y=[];for(const M of r){const P=M.vertices,D=P.length;M.shared!==void 0&&(m[M.shared]||(m[M.shared]=[])),D&&P[0].color!==void 0&&(f||(f=new Nx(3*n*3)));for(let j=3;j<=D;j++)(M.shared===void 0?y:m[M.shared]).push(a.top/3,a.top/3+1,a.top/3+2),a.write(P[0].pos),a.write(P[j-2].pos),a.write(P[j-1].pos),u.write(P[0].normal),u.write(P[j-2].normal),u.write(P[j-1].normal),p&&(p.write(P[0].uv),p.write(P[j-2].uv),p.write(P[j-1].uv)),f&&(f.write(P[0].color),f.write(P[j-2].color),f.write(P[j-1].color))}o.setAttribute("position",new c.TlE(a.array,3)),o.setAttribute("normal",new c.TlE(u.array,3)),p&&o.setAttribute("uv",new c.TlE(p.array,2)),f&&o.setAttribute("color",new c.TlE(f.array,3));for(let M=0;M<m.length;M++)m[M]===void 0&&(m[M]=[]);if(m.length){let M=[],P=0;for(let D=0;D<m.length;D++)o.addGroup(P,m[D].length,D),P+=m[D].length,M=M.concat(m[D]);o.addGroup(P,y.length,m.length),M=M.concat(y),o.setIndex(M)}const S=new c.yGw().copy(t).invert();return o.applyMatrix4(S),o.computeBoundingSphere(),o.computeBoundingBox(),o}static fromMesh(e,t){const n=xs.fromGeometry(e.geometry,t),r=new c.Pa4,o=new c.Vkp;o.getNormalMatrix(e.matrix);for(let a=0;a<n.polygons.length;a++){const u=n.polygons[a];for(let p=0;p<u.vertices.length;p++){const f=u.vertices[p];f.pos.copy(r.copy(f.pos.toVector3()).applyMatrix4(e.matrix)),f.normal.copy(r.copy(f.normal.toVector3()).applyMatrix3(o))}}return n}static toMesh(e,t,n){const r=xs.toGeometry(e,t),o=new c.Kj0(r,n);return o.matrix.copy(t),o.matrix.decompose(o.position,o.quaternion,o.scale),o.rotation.setFromQuaternion(o.quaternion),o.updateMatrixWorld(),o.castShadow=o.receiveShadow=!0,o}static union(e,t){const n=xs.fromMesh(e),r=xs.fromMesh(t);return xs.toMesh(n.union(r),e.matrix,e.material)}static subtract(e,t){const n=xs.fromMesh(e),r=xs.fromMesh(t);return xs.toMesh(n.subtract(r),e.matrix,e.material)}static intersect(e,t){const n=xs.fromMesh(e),r=xs.fromMesh(t);return xs.toMesh(n.intersect(r),e.matrix,e.material)}clone(){const e=new xs;return e.polygons=this.polygons.map(t=>t.clone()).filter(t=>Number.isFinite(t.plane.w)),e}toPolygons(){return this.polygons}union(e){const t=new Ah(this.clone().polygons),n=new Ah(e.clone().polygons);return t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),xs.fromPolygons(t.allPolygons())}subtract(e){const t=new Ah(this.clone().polygons),n=new Ah(e.clone().polygons);return t.invert(),t.clipTo(n),n.clipTo(t),n.invert(),n.clipTo(t),n.invert(),t.build(n.allPolygons()),t.invert(),xs.fromPolygons(t.allPolygons())}intersect(e){const t=new Ah(this.clone().polygons),n=new Ah(e.clone().polygons);return t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.build(n.allPolygons()),t.invert(),xs.fromPolygons(t.allPolygons())}inverse(){const e=this.clone();for(const t of e.polygons)t.flip();return e}toMesh(e,t){return xs.toMesh(this,e,t)}toGeometry(e){return xs.toGeometry(this,e)}}var y_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const Fx=["union","subtract","intersect"];class hd extends ui{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this.dependencies=[er],this.rootMesh=new c.Kj0,this.showResult=!1,this.csgSelectedEnabled=!1,this.csgSelectedOperation="union",this._csgNeedsUpdate=!1,this._csgVisible=!1,this._sceneUpdate=this._sceneUpdate.bind(this),this._preFrame=this._preFrame.bind(this),this.makeSelectedCSGBrush=this.makeSelectedCSGBrush.bind(this),this.refreshCSG=this.refreshCSG.bind(this),this._selectedObjectChanged=this._selectedObjectChanged.bind(this),this._updateSelectedProperties=this._updateSelectedProperties.bind(this),this.downloadObject=this.downloadObject.bind(this),this.exportObject=this.exportObject.bind(this)}async onAdded(e){var t;await super.onAdded(e),this.rootObject=await e.createObject3D(),this.rootObject.modelObject.add(this.rootMesh),e.scene.addEventListener("sceneUpdate",this._sceneUpdate),e.addEventListener("preFrame",this._preFrame),(t=e.getPlugin(er))===null||t===void 0||t.addEventListener("selectedObjectChanged",this._selectedObjectChanged)}async makeSelectedCSGBrush(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();n&&n.geometry&&(n.userData._isCSGMesh||(n.userData.csgBrush||(n.userData.csgBrush={enabled:!0,operation:"union"}),this._selectedObjectChanged()))}refreshCSG(){this._sceneUpdate()}async downloadObject(){const e=await this.exportObject();e&&Ss(e,"csg."+e.ext)}async exportObject(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPluginByType("AssetExporterPlugin"))===null||t===void 0?void 0:t.exporter;if(!n||!this.rootObject)return;const r=this.rootMesh.visible;this.rootMesh.visible=!0;const o=await n.exportObject(this.rootObject.modelObject,{});return this.rootMesh.visible=r,o}_updateSelectedProperties(){var e,t;const n=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();n&&n.userData.csgBrush&&(n.userData.csgBrush.enabled=this.csgSelectedEnabled,n.userData.csgBrush.operation=this.csgSelectedOperation)}_selectedObjectChanged(){var e,t,n,r,o,a,u,p;const f=(t=(e=this._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();f&&(this.csgSelectedEnabled=(r=(n=f.userData.csgBrush)===null||n===void 0?void 0:n.enabled)!==null&&r!==void 0&&r,this.csgSelectedOperation=(a=(o=f.userData.csgBrush)===null||o===void 0?void 0:o.operation)!==null&&a!==void 0?a:"union"),(p=(u=this.uiConfig)===null||u===void 0?void 0:u.uiRefresh)===null||p===void 0||p.call(u,"postFrame",!0)}_preFrame(){var e,t,n;if(!this.rootObject||!this._csgNeedsUpdate&&this._csgVisible===this.showResult)return;const r=this._findCSGMeshes();this._csgNeedsUpdate&&(this._csgNeedsUpdate=!1,(e=this.rootObject)===null||e===void 0||e.modelObject.updateMatrixWorld(!0),((t=this.rootMesh.userData.dispose)!==null&&t!==void 0?t:this.rootMesh.removeFromParent)(),this.rootMesh=this._buildCSGMesh(r)),this.rootMesh&&!this.rootMesh.parent&&((n=this.rootObject)===null||n===void 0||n.modelObject.add(this.rootMesh)),this.showResult?(r.forEach(o=>{o[0].visible=!1}),this.rootObject.visible=!0,this._csgVisible=!0,this.rootObject.setDirty()):(r.forEach(o=>{o[0].visible=!0}),this.rootObject.visible=!1,this._csgVisible=!1,this.rootObject.setDirty())}_findCSGMeshes(){var e;const t=[];return(e=this._viewer)===null||e===void 0||e.scene.traverse(n=>{var r;n.isMesh&&n.geometry&&(!((r=n.userData.csgBrush)===null||r===void 0)&&r.enabled)&&t.push([n,n.userData.csgBrush.operation])}),t}_sceneUpdate(e){var t,n;!((n=(t=e==null?void 0:e.object)===null||t===void 0?void 0:t.userData)===null||n===void 0)&&n._isCSGMesh||(this._csgNeedsUpdate=!0)}}y_([_n("Show Result",s=>({onChange:()=>{var e;return(e=s._viewer)===null||e===void 0?void 0:e.setDirty()}}))],hd.prototype,"showResult",void 0),y_([Ji("Make CSG Brush",s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();return!(n!=null&&n.userData)||!!n.userData.csgBrush||n.userData._isCSGMesh}}))],hd.prototype,"makeSelectedCSGBrush",null),y_([_n("Enabled",s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:s._updateSelectedProperties}))],hd.prototype,"csgSelectedEnabled",void 0),y_([Ao("Operation",Fx.map(s=>({label:s})),s=>({hidden:()=>{var e,t;const n=(t=(e=s._viewer)===null||e===void 0?void 0:e.getPlugin(er))===null||t===void 0?void 0:t.getSelectedObject();return!n||!n.userData.csgBrush},onChange:s._updateSelectedProperties}))],hd.prototype,"csgSelectedOperation",void 0),y_([Ji("Refresh CSG")],hd.prototype,"refreshCSG",null),y_([Ji("Export Result",s=>({hidden:()=>{var e;return!(!((e=s._viewer)===null||e===void 0)&&e.getPluginByType("AssetExporterPlugin"))}}))],hd.prototype,"downloadObject",null);function eC(s,e){let t=new xs;const n=s.map(o=>o[0].material).flatMap(o=>o);s.forEach(([o,a])=>{if(!Fx.includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const u=o.matrix;o.matrix=o.matrixWorld;let p=0;p=Array.isArray(o.material)?void 0:n.indexOf(o.material),t=t[a](xs.fromMesh(o,p)),o.matrix=u});const r=t.toMesh(e??new c.yGw().identity(),n);return r.userData._isCSGMesh=!0,r.geometry.groups=r.geometry.groups.filter(o=>o.count>0),r}let Cb=class extends hd{_buildCSGMesh(s){return eC(s)}};Cb.PluginType="CSGPluginBSP",Cb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Ci("CSG Plugin (BSP)")],Cb);class dd{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,r=-1/0;for(let o=0,a=e.length;o<a;o++){const u=e[o][t];n=u<n?u:n,r=u>r?u:r}this.min=n,this.max=r}setFromPoints(e,t){let n=1/0,r=-1/0;for(let o=0,a=t.length;o<a;o++){const u=t[o],p=e.dot(u);n=p<n?p:n,r=p>r?p:r}this.min=n,this.max=r}isSeparated(e){return this.min>e.max||e.min>this.max}}dd.prototype.setFromBox=function(){const s=new c.Pa4;return function(e,t){const n=t.min,r=t.max;let o=1/0,a=-1/0;for(let u=0;u<=1;u++)for(let p=0;p<=1;p++)for(let f=0;f<=1;f++){s.x=n.x*u+r.x*(1-u),s.y=n.y*p+r.y*(1-p),s.z=n.z*f+r.z*(1-f);const m=e.dot(s);o=Math.min(m,o),a=Math.max(m,a)}this.min=o,this.max=a}}();const BT=function(){const s=new c.Pa4,e=new c.Pa4,t=new c.Pa4;return function(n,r,o){const a=n.start,u=s,p=r.start,f=e;t.subVectors(a,p),s.subVectors(n.end,r.start),e.subVectors(r.end,r.start);const m=t.dot(f),y=f.dot(u),S=f.dot(f),M=t.dot(u),P=u.dot(u)*S-y*y;let D,j;D=P!==0?(m*y-M*S)/P:0,j=(m+D*y)/S,o.x=D,o.y=j}}(),Ux=function(){const s=new c.FM8,e=new c.Pa4,t=new c.Pa4;return function(n,r,o,a){BT(n,r,s);let u=s.x,p=s.y;if(u>=0&&u<=1&&p>=0&&p<=1)return n.at(u,o),void r.at(p,a);if(u>=0&&u<=1)return p<0?r.at(0,a):r.at(1,a),void n.closestPointToPoint(a,!0,o);if(p>=0&&p<=1)return u<0?n.at(0,o):n.at(1,o),void r.closestPointToPoint(o,!0,a);{let f,m;f=u<0?n.start:n.end,m=p<0?r.start:r.end;const y=e,S=t;return n.closestPointToPoint(m,!0,e),r.closestPointToPoint(f,!0,t),y.distanceToSquared(m)<=S.distanceToSquared(f)?(o.copy(y),void a.copy(m)):(o.copy(f),void a.copy(S))}}}(),kT=function(){const s=new c.Pa4,e=new c.Pa4,t=new c.JOQ,n=new c.Zzh;return function(r,o){const{radius:a,center:u}=r,{a:p,b:f,c:m}=o;if(n.start=p,n.end=f,n.closestPointToPoint(u,!0,s).distanceTo(u)<=a||(n.start=p,n.end=m,n.closestPointToPoint(u,!0,s).distanceTo(u)<=a)||(n.start=f,n.end=m,n.closestPointToPoint(u,!0,s).distanceTo(u)<=a))return!0;const y=o.getPlane(t);if(Math.abs(y.distanceToPoint(u))<=a){const S=y.projectPoint(u,e);if(o.containsPoint(S))return!0}return!1}}();function b_(s){return Math.abs(s)<1e-15}class yh extends c.CJI{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new c.Pa4),this.satBounds=new Array(4).fill().map(()=>new dd),this.points=[this.a,this.b,this.c],this.sphere=new c.aLr,this.plane=new c.JOQ,this.needsUpdate=!0}intersectsSphere(e){return kT(e,this)}update(){const e=this.a,t=this.b,n=this.c,r=this.points,o=this.satAxes,a=this.satBounds,u=o[0],p=a[0];this.getNormal(u),p.setFromPoints(u,r);const f=o[1],m=a[1];f.subVectors(e,t),m.setFromPoints(f,r);const y=o[2],S=a[2];y.subVectors(t,n),S.setFromPoints(y,r);const M=o[3],P=a[3];M.subVectors(n,e),P.setFromPoints(M,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(u,e),this.needsUpdate=!1}}yh.prototype.closestPointToSegment=function(){const s=new c.Pa4,e=new c.Pa4,t=new c.Zzh;return function(n,r=null,o=null){const{start:a,end:u}=n,p=this.points;let f,m=1/0;for(let y=0;y<3;y++){const S=(y+1)%3;t.start.copy(p[y]),t.end.copy(p[S]),Ux(t,n,s,e),f=s.distanceToSquared(e),f<m&&(m=f,r&&r.copy(s),o&&o.copy(e))}return this.closestPointToPoint(a,s),f=a.distanceToSquared(s),f<m&&(m=f,r&&r.copy(s),o&&o.copy(a)),this.closestPointToPoint(u,s),f=u.distanceToSquared(s),f<m&&(m=f,r&&r.copy(s),o&&o.copy(u)),Math.sqrt(m)}}(),yh.prototype.intersectsTriangle=function(){const s=new yh,e=new Array(3),t=new Array(3),n=new dd,r=new dd,o=new c.Pa4,a=new c.Pa4,u=new c.Pa4,p=new c.Pa4,f=new c.Zzh,m=new c.Zzh,y=new c.Zzh;return function(S,M=null){this.needsUpdate&&this.update(),S.isExtendedTriangle?S.needsUpdate&&S.update():(s.copy(S),s.update(),S=s);const P=this.plane,D=S.plane;if(Math.abs(P.normal.dot(D.normal))>1-1e-10){const j=this.satBounds,k=this.satAxes;t[0]=S.a,t[1]=S.b,t[2]=S.c;for(let W=0;W<4;W++){const q=j[W],J=k[W];if(n.setFromPoints(J,t),q.isSeparated(n))return!1}const L=S.satBounds,R=S.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let W=0;W<4;W++){const q=L[W],J=R[W];if(n.setFromPoints(J,e),q.isSeparated(n))return!1}for(let W=0;W<4;W++){const q=k[W];for(let J=0;J<4;J++){const ee=R[J];if(o.crossVectors(q,ee),n.setFromPoints(o,e),r.setFromPoints(o,t),n.isSeparated(r))return!1}}return M&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),M.start.set(0,0,0),M.end.set(0,0,0)),!0}{const j=this.points;let k=!1,L=0;for(let ke=0;ke<3;ke++){const Qe=j[ke],Oe=j[(ke+1)%3];f.start.copy(Qe),f.end.copy(Oe),f.delta(a);const ze=k?m.start:m.end,$e=b_(D.distanceToPoint(Qe));if(b_(D.normal.dot(a))&&$e){m.copy(f),L=2;break}if((D.intersectLine(f,ze)||$e)&&!b_(ze.distanceTo(Oe))){if(L++,k)break;k=!0}}if(L===1&&this.containsPoint(m.start))return M&&(M.start.copy(m.start),M.end.copy(m.start)),!0;if(L!==2)return!1;const R=S.points;let W=!1,q=0;for(let ke=0;ke<3;ke++){const Qe=R[ke],Oe=R[(ke+1)%3];f.start.copy(Qe),f.end.copy(Oe),f.delta(u);const ze=W?y.start:y.end,$e=b_(P.distanceToPoint(Qe));if(b_(P.normal.dot(u))&&$e){y.copy(f),q=2;break}if((P.intersectLine(f,ze)||$e)&&!b_(ze.distanceTo(Oe))){if(q++,W)break;W=!0}}if(q===1&&this.containsPoint(y.start))return M&&(M.start.copy(y.start),M.end.copy(y.start)),!0;if(q!==2)return!1;if(m.delta(a),y.delta(u),a.dot(u)<0){let ke=y.start;y.start=y.end,y.end=ke}const J=m.start.dot(a),ee=m.end.dot(a),he=y.start.dot(a),xe=y.end.dot(a),De=ee<he,Fe=J<xe;return(J===xe||he===ee||De!==Fe)&&(M&&(p.subVectors(m.start,y.start),p.dot(a)>0?M.start.copy(m.start):M.start.copy(y.start),p.subVectors(m.end,y.end),p.dot(a)<0?M.end.copy(m.end):M.end.copy(y.end)),!0)}}}(),yh.prototype.distanceToPoint=function(){const s=new c.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),yh.prototype.distanceToTriangle=function(){const s=new c.Pa4,e=new c.Pa4,t=["a","b","c"],n=new c.Zzh,r=new c.Zzh;return function(o,a=null,u=null){const p=a||u?n:null;if(this.intersectsTriangle(o,p))return(a||u)&&(a&&p.getCenter(a),u&&p.getCenter(u)),0;let f=1/0;for(let m=0;m<3;m++){let y;const S=t[m],M=o[S];this.closestPointToPoint(M,s),y=M.distanceToSquared(s),y<f&&(f=y,a&&a.copy(s),u&&u.copy(M));const P=this[S];o.closestPointToPoint(P,s),y=P.distanceToSquared(s),y<f&&(f=y,a&&a.copy(P),u&&u.copy(s))}for(let m=0;m<3;m++){const y=t[m],S=t[(m+1)%3];n.set(this[y],this[S]);for(let M=0;M<3;M++){const P=t[M],D=t[(M+1)%3];r.set(o[P],o[D]),Ux(n,r,s,e);const j=s.distanceToSquared(e);j<f&&(f=j,a&&a.copy(s),u&&u.copy(e))}}return Math.sqrt(f)}}();class tC{constructor(){this.intersectionSet={},this.ids=[]}add(e,t){const{intersectionSet:n,ids:r}=this;n[e]||(n[e]=[],r.push(e)),n[e].push(t)}}const _m=new c.zHn,nC=new c.yGw,Fa=new c.CJI,pd=new c.Pa4,iC=new c.Ltg,rC=new c.Ltg,sC=new c.Ltg,jx=new c.Ltg,Mb=new c.Ltg,Tb=new c.Ltg,zx=new c.Zzh,Vx=1e-8;let Ib=null;function oC(s){Ib=s}function aC(s,e){function t(){return Math.random()-.5}_m.origin.copy(s.a).add(s.b).add(s.c).multiplyScalar(1/3),s.getNormal(_m.direction);let n=0,r=1/0;for(let o=0;o<3;o++){_m.direction.x+=t()*Vx,_m.direction.y+=t()*Vx,_m.direction.z+=t()*Vx;const a=e.raycastFirst(_m,c.ehD);if(Boolean(a&&_m.direction.dot(a.face.normal)>0)&&n++,a!==null&&(r=Math.min(r,a.distance)),r===0||n/3>.5||(o-n+1)/3>.5)break}return r===0?0:n/3>.5?-1:1}function lC(s,e,t,n,r,o,a=!1){const u=t.attributes,p=t.index,f=3*s,m=p.getX(f+0),y=p.getX(f+1),S=p.getX(f+2);for(const M in o){const P=u[M],D=o[M];if(!(M in u))throw new Error(`CSG Operations: Attribute ${M} not available on geometry.`);const j=P.itemSize;M==="position"?(Fa.a.fromBufferAttribute(P,m).applyMatrix4(n),Fa.b.fromBufferAttribute(P,y).applyMatrix4(n),Fa.c.fromBufferAttribute(P,S).applyMatrix4(n),Gx(Fa.a,Fa.b,Fa.c,e,3,D,a)):M==="normal"?(Fa.a.fromBufferAttribute(P,m).applyNormalMatrix(r),Fa.b.fromBufferAttribute(P,y).applyNormalMatrix(r),Fa.c.fromBufferAttribute(P,S).applyNormalMatrix(r),a&&(Fa.a.multiplyScalar(-1),Fa.b.multiplyScalar(-1),Fa.c.multiplyScalar(-1)),Gx(Fa.a,Fa.b,Fa.c,e,3,D,a,!0)):(iC.fromBufferAttribute(P,m),rC.fromBufferAttribute(P,y),sC.fromBufferAttribute(P,S),Gx(iC,rC,sC,e,j,D,a))}}function cC(s,e,t,n,r,o,a,u=!1){Qx(s,n,r,o,a,u),Qx(e,n,r,o,a,u),Qx(t,n,r,o,a,u)}function uC(s,e,t=!1){switch(s){case 0:if(e===1||e===0&&t)return 1;break;case 1:if(t){if(e===-1)return 0}else if(e===1)return 1;break;case 3:if(e===-1)return 0;if(e===1)return 1;case 4:if(e===-1||e===0&&t)return 1;break;default:throw new Error(`Unrecognized CSG operation enum "${s}".`)}return 2}function Gx(s,e,t,n,r,o,a=!1,u=!1){const p=f=>{o.push(f.x),r>1&&o.push(f.y),r>2&&o.push(f.z),r>3&&o.push(f.w)};jx.set(0,0,0,0).addScaledVector(s,n.a.x).addScaledVector(e,n.a.y).addScaledVector(t,n.a.z),Mb.set(0,0,0,0).addScaledVector(s,n.b.x).addScaledVector(e,n.b.y).addScaledVector(t,n.b.z),Tb.set(0,0,0,0).addScaledVector(s,n.c.x).addScaledVector(e,n.c.y).addScaledVector(t,n.c.z),u&&(jx.normalize(),Mb.normalize(),Tb.normalize()),p(jx),a?(p(Tb),p(Mb)):(p(Mb),p(Tb))}function Qx(s,e,t,n,r,o=!1){for(const a in r){const u=e[a],p=r[a];if(!(a in e))throw new Error(`CSG Operations: Attribute ${a} no available on geometry.`);const f=u.itemSize;a==="position"?(pd.fromBufferAttribute(u,s).applyMatrix4(t),p.push(pd.x,pd.y,pd.z)):a==="normal"?(pd.fromBufferAttribute(u,s).applyNormalMatrix(n),o&&pd.multiplyScalar(-1),p.push(pd.x,pd.y,pd.z)):(p.push(u.getX(s)),f>1&&p.push(u.getY(s)),f>2&&p.push(u.getZ(s)),f>3&&p.push(u.getW(s)))}}const Mp=1e-14,Pb=1e-7,bh=new c.Zzh,js=new c.Zzh,wu=new c.Pa4,hC=new c.Pa4,x0=new c.JOQ,OT=new yh;function E0(s){return s.a.distanceToSquared(s.b)<Mp||s.a.distanceToSquared(s.c)<Mp||s.b.distanceToSquared(s.c)<Mp}class LT extends c.CJI{constructor(...e){super(...e),this.side=null,this.originalSide=null,this.coplanarCount=0}init(){this.side=null,this.originalSide=null,this.coplanarCount=0}initFrom(e){this.side=e.side,this.originalSide=e.originalSide,this.coplanarCount=e.coplanarCount}updateSide(e,t=null,n=-1){if(this.originalSide!==null&&this.side===null)return;wu.copy(this.a).add(this.b).add(this.c).multiplyScalar(1/3);const r=e.distanceToPoint(wu)<0?-1:1;t&&n!==-1?r===1&&(this.coplanarCount++,this.coplanarCount===3&&(this.side=0)):(this.originalSide===null&&(this.originalSide=r,this.side=r),r!==this.side&&(this.side=null))}}class NT{constructor(){this._pool=[],this._index=0}getTriangle(){this._index>=this._pool.length&&this._pool.push(new LT);const e=this._pool[this._index++];return e.init(),e}clear(){this._index=0}reset(){this._pool.length=0,this._index=0}}class FT{constructor(){this.trianglePool=new NT,this.triangles=[],this.normal=new c.Pa4}initialize(e){const{triangles:t,trianglePool:n,normal:r}=this;if(t.length=0,n.clear(),Array.isArray(e))for(let o=0,a=e.length;o<a;o++){const u=e[o];if(o===0)u.getNormal(r);else if(Math.abs(1-u.getNormal(wu).dot(r))>Mp)throw new Error("Triangle Splitter: Cannot initialize with triangles that have different normals.");const p=n.getTriangle();p.copy(u),t.push(p)}else{e.getNormal(r);const o=n.getTriangle();o.copy(e),t.push(o)}}splitByTriangle(e){const{normal:t,triangles:n}=this;if(e.getPlane(x0),Math.abs(1-Math.abs(x0.normal.dot(t)))<Pb){const r=[e.a,e.b,e.c];for(let o=0;o<3;o++){const a=(o+1)%3,u=r[o],p=r[a];wu.subVectors(p,u).normalize(),hC.crossVectors(t,wu),x0.setFromNormalAndCoplanarPoint(hC,u),this.splitByPlane(x0,e,o)}for(let o=0,a=n.length;o<a;o++)n[o].coplanarCount=0}else this.splitByPlane(x0,e)}splitByPlane(e,t=null,n=-1){const{triangles:r,trianglePool:o}=this;let a=null;t!==null&&(a=OT,a.copy(t),a.needsUpdate=!0);for(let u=0,p=r.length;u<p;u++){const f=r[u],{a:m,b:y,c:S}=f;if(a&&(!a.intersectsTriangle(f,bh)||bh.distance()<1e-5)){f.updateSide(e,a,n),f.side=null;continue}let M=0,P=-1,D=0,j=0,k=!1;const L=[m,y,S];for(let R=0;R<3;R++){const W=(R+1)%3;bh.start.copy(L[R]),bh.end.copy(L[W]);const q=e.distanceToPoint(bh.start),J=e.distanceToPoint(bh.end);Math.abs(q)<Mp?j++:q>0&&D++,Math.abs(q)<Pb&&Math.abs(J)<Pb&&(k=!0);let ee=!!e.intersectLine(bh,wu);!ee&&Math.abs(J)<Mp&&(wu.copy(bh.end),ee=!0),!ee||wu.distanceTo(bh.start)<Mp||(wu.distanceTo(bh.end)<Mp&&(P=R),M===0?js.start.copy(wu):js.end.copy(wu),M++)}if(!k&&j<2&&M===2&&js.distance()>Pb)if(P!==-1){P=(P+1)%3;let R=0;R===P&&(R=(R+1)%3);let W=R+1;W===P&&(W=(W+1)%3);const q=o.getTriangle();q.a.copy(L[W]),q.b.copy(js.end),q.c.copy(js.start),E0(q)||(r.push(q),q.initFrom(f),q.updateSide(e,a,n)),f.a.copy(L[R]),f.b.copy(js.start),f.c.copy(js.end),E0(f)?(r.splice(u,1),u--,p--):f.updateSide(e,a,n)}else{const R=L.findIndex(he=>D>=2?e.distanceToPoint(he)<0:e.distanceToPoint(he)>0);if(R===0){let he=js.start;js.start=js.end,js.end=he}else if(R===-1)continue;const W=(R+1)%3,q=(R+2)%3,J=o.getTriangle(),ee=o.getTriangle();L[W].distanceToSquared(js.start)<L[q].distanceToSquared(js.end)?(J.a.copy(L[W]),J.b.copy(js.start),J.c.copy(js.end),ee.a.copy(L[W]),ee.b.copy(L[q]),ee.c.copy(js.start)):(J.a.copy(L[q]),J.b.copy(js.start),J.c.copy(js.end),ee.a.copy(L[W]),ee.b.copy(L[q]),ee.c.copy(js.end)),f.a.copy(L[R]),f.b.copy(js.end),f.c.copy(js.start),E0(J)||(r.push(J),J.initFrom(f),J.updateSide(e,a,n)),E0(ee)||(r.push(ee),ee.initFrom(f),ee.updateSide(e,a,n)),E0(f)?(r.splice(u,1),u--,p--):f.updateSide(e,a,n)}else M===3&&console.warn("TriangleClipper: Coplanar clip not handled")}}reset(){this.triangles.length=0}}function dC(){return typeof SharedArrayBuffer<"u"}function UT(s){if(s.buffer instanceof SharedArrayBuffer)return s;const e=s.constructor,t=s.buffer,n=new SharedArrayBuffer(t.byteLength),r=new Uint8Array(t);return new Uint8Array(n).set(r,0),new e(n)}class pC{constructor(e,t=500){const n=dC()?SharedArrayBuffer:ArrayBuffer;this.expansionFactor=1.5,this.type=e,this.array=new e(new n(t*e.BYTES_PER_ELEMENT)),this.length=0}expand(e=null){const{type:t,array:n,expansionFactor:r}=this;e===null&&(e=~~(n.length*r));const o=new t(e);o.set(n,0),this.array=o}push(...e){let{array:t,length:n}=this;n+e.length>t.length&&(this.expand(),t=this.array);for(let r=0,o=e.length;r<o;r++)t[n+r]=e[r];this.length+=e.length}clear(){this.length=0}}class jT{constructor(){this.groupAttributes=[{}],this.groupCount=0}getType(e){return this.groupAttributes[0][e].type}getTotalLength(e){const{groupCount:t,groupAttributes:n}=this;let r=0;for(let o=0;o<t;o++)r+=n[o][e].length;return r}getGroupSet(e=0){const{groupAttributes:t}=this;if(t[e])return this.groupCount=Math.max(this.groupCount,e+1),t[e];const n=t[0];for(this.groupCount=Math.max(this.groupCount,e+1);e>=t.length;){const r={};t.push(r);for(const o in n)r[o]=new pC(n[o].type)}return t[e]}getGroupArray(e,t=0){const{groupAttributes:n}=this;if(!n[0][e])throw new Error(`TypedAttributeData: Attribute with "${e}" has not been initialized`);return this.getGroupSet(t)[e]}initializeArray(e,t){const{groupAttributes:n}=this,r=n[0][e];if(r){if(r.type!==t)throw new Error(`TypedAttributeData: Array ${e} already initialized with a different type.`)}else for(let o=0,a=n.length;o<a;o++)n[o][e]=new pC(t)}clear(){this.groupCount=0;const{groupAttributes:e}=this;e.forEach(t=>{for(const n in t)t[n].clear()})}delete(e){this.groupAttributes.forEach(t=>{delete t[e]})}reset(){this.groupAttributes=[]}}class zT{constructor(e){this.triangle=new c.CJI().copy(e),this.intersects={}}addTriangle(e,t){this.intersects[e]=new c.CJI().copy(t)}getIntersectArray(){const e=[],{intersects:t}=this;for(const n in t)e.push(t[n]);return e}}class fC{constructor(){this.data={}}addTriangleIntersection(e,t,n,r){const{data:o}=this;o[e]||(o[e]=new zT(t)),o[e].addTriangle(n,r)}getTrianglesAsArray(e=null){const{data:t}=this,n=[];if(e!==null)e in t&&n.push(t[e].triangle);else for(const r in t)n.push(t[r].triangle);return n}getTriangleIndices(){return Object.keys(this.data).map(e=>parseInt(e))}getIntersectionIndices(e){const{data:t}=this;return t[e]?Object.keys(t[e].intersects).map(n=>parseInt(n)):[]}getIntersectionsAsArray(e=null,t=null){const{data:n}=this,r=new Set,o=[],a=u=>{if(n[u])if(t!==null)n[u].intersects[t]&&o.push(n[u].intersects[t]);else{const p=n[u].intersects;for(const f in p)r.has(f)||(r.add(f),o.push(p[f]))}};if(e!==null)a(e);else for(const u in n)a(u);return o}reset(){this.data={}}}class VT{constructor(){this.enabled=!1,this.triangleIntersectsA=new fC,this.triangleIntersectsB=new fC,this.intersectionEdges=[]}addIntersectingTriangles(e,t,n,r){const{triangleIntersectsA:o,triangleIntersectsB:a}=this;o.addTriangleIntersection(e,t,n,r),a.addTriangleIntersection(n,r,e,t)}addEdge(e){this.intersectionEdges.push(e.clone())}reset(){this.triangleIntersectsA.reset(),this.triangleIntersectsB.reset(),this.intersectionEdges=[]}}const Tp=new c.yGw,w_=new c.Vkp,vm=new c.CJI,Db=new c.CJI,Rb=new c.CJI,S0=new c.CJI;function GT(s){for(const e of s)return e}function mC(s,e,t,n,r,o,a,u=0){Tp.copy(e.matrixWorld).invert().multiply(s.matrixWorld),w_.getNormalMatrix(s.matrixWorld);const p=s.geometry.groupIndices,f=s.geometry.index,m=s.geometry.attributes.position,y=e.geometry.boundsTree,S=e.geometry.index,M=e.geometry.attributes.position,P=t.ids,D=t.intersectionSet;for(let j=0,k=P.length;j<k;j++){const L=P[j],R=u===-1?0:p[L]+u,W=a.getGroupSet(R),q=3*L,J=f.getX(q+0),ee=f.getX(q+1),he=f.getX(q+2);vm.a.fromBufferAttribute(m,J).applyMatrix4(Tp),vm.b.fromBufferAttribute(m,ee).applyMatrix4(Tp),vm.c.fromBufferAttribute(m,he).applyMatrix4(Tp),o.initialize(vm);const xe=D[L];for(let Fe=0,ke=xe.length;Fe<ke;Fe++){const Qe=3*xe[Fe],Oe=S.getX(Qe+0),ze=S.getX(Qe+1),$e=S.getX(Qe+2);Db.a.fromBufferAttribute(M,Oe),Db.b.fromBufferAttribute(M,ze),Db.c.fromBufferAttribute(M,$e),o.splitByTriangle(Db)}const De=o.triangles;for(let Fe=0,ke=De.length;Fe<ke;Fe++){const Qe=De[Fe],Oe=uC(n,aC(Qe,y),r);if(Oe!==2)switch(vm.getBarycoord(Qe.a,S0.a),vm.getBarycoord(Qe.b,S0.b),vm.getBarycoord(Qe.c,S0.c),Oe){case 1:lC(L,S0,s.geometry,s.matrixWorld,w_,W);break;case 0:lC(L,S0,s.geometry,s.matrixWorld,w_,W,!0)}}}return P.length}function gC(s,e,t,n,r,o,a=0){Tp.copy(e.matrixWorld).invert().multiply(s.matrixWorld),w_.getNormalMatrix(s.matrixWorld);const u=e.geometry.boundsTree,p=s.geometry.groupIndices,f=s.geometry.index,m=s.geometry.attributes,y=m.position,S=[],M=s.geometry.halfEdges,P=new Set;for(let D=0,j=f.count/3;D<j;D++)D in t.intersectionSet||P.add(D);for(;P.size>0;){const D=GT(P);P.delete(D),S.push(D);const j=3*D,k=f.getX(j+0),L=f.getX(j+1),R=f.getX(j+2);Rb.a.fromBufferAttribute(y,k).applyMatrix4(Tp),Rb.b.fromBufferAttribute(y,L).applyMatrix4(Tp),Rb.c.fromBufferAttribute(y,R).applyMatrix4(Tp);const W=uC(n,aC(Rb,u),r);for(;S.length>0;){const q=S.pop(),J=a===-1?0:p[q]+a,ee=o.getGroupSet(J);for(let ke=0;ke<3;ke++){const Qe=M.getSiblingTriangleIndex(q,ke);Qe!==-1&&P.has(Qe)&&(S.push(Qe),P.delete(Qe))}const he=3*q,xe=f.getX(he+0),De=f.getX(he+1),Fe=f.getX(he+2);switch(W){case 1:cC(xe,De,Fe,m,s.matrixWorld,w_,ee);break;case 0:cC(Fe,De,xe,m,s.matrixWorld,w_,ee,r)}}}}const Hx=1.25,Wx=65535,QT=Math.pow(2,-24);class Bb{constructor(){}}function wh(s,e,t){return t.min.x=e[s],t.min.y=e[s+1],t.min.z=e[s+2],t.max.x=e[s+3],t.max.y=e[s+4],t.max.z=e[s+5],t}function _C(s){let e=-1,t=-1/0;for(let n=0;n<3;n++){const r=s[n+3]-s[n];r>t&&(t=r,e=n)}return e}function vC(s,e){e.set(s)}function AC(s,e,t){let n,r;for(let o=0;o<3;o++){const a=o+3;n=s[o],r=e[o],t[o]=n<r?n:r,n=s[a],r=e[a],t[a]=n>r?n:r}}function kb(s,e,t){for(let n=0;n<3;n++){const r=e[s+2*n],o=e[s+2*n+1],a=r-o,u=r+o;a<t[n]&&(t[n]=a),u>t[n+3]&&(t[n+3]=u)}}function C0(s){const e=s[3]-s[0],t=s[4]-s[1],n=s[5]-s[2];return 2*(e*t+t*n+n*e)}function qx(s,e,t,n,r=null){let o=1/0,a=1/0,u=1/0,p=-1/0,f=-1/0,m=-1/0,y=1/0,S=1/0,M=1/0,P=-1/0,D=-1/0,j=-1/0;const k=r!==null;for(let L=6*e,R=6*(e+t);L<R;L+=6){const W=s[L+0],q=s[L+1],J=W-q,ee=W+q;J<o&&(o=J),ee>p&&(p=ee),k&&W<y&&(y=W),k&&W>P&&(P=W);const he=s[L+2],xe=s[L+3],De=he-xe,Fe=he+xe;De<a&&(a=De),Fe>f&&(f=Fe),k&&he<S&&(S=he),k&&he>D&&(D=he);const ke=s[L+4],Qe=s[L+5],Oe=ke-Qe,ze=ke+Qe;Oe<u&&(u=Oe),ze>m&&(m=ze),k&&ke<M&&(M=ke),k&&ke>j&&(j=ke)}n[0]=o,n[1]=a,n[2]=u,n[3]=p,n[4]=f,n[5]=m,k&&(r[0]=y,r[1]=S,r[2]=M,r[3]=P,r[4]=D,r[5]=j)}const HT=(s,e)=>s.candidate-e.candidate,Ip=new Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ob=new Float32Array(6);class xh extends c.ZzF{constructor(...e){super(...e),this.isOrientedBox=!0,this.matrix=new c.yGw,this.invMatrix=new c.yGw,this.points=new Array(8).fill().map(()=>new c.Pa4),this.satAxes=new Array(3).fill().map(()=>new c.Pa4),this.satBounds=new Array(3).fill().map(()=>new dd),this.alignedSatBounds=new Array(3).fill().map(()=>new dd),this.needsUpdate=!1}set(e,t,n){super.set(e,t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}}xh.prototype.update=function(){const s=this.matrix,e=this.min,t=this.max,n=this.points;for(let p=0;p<=1;p++)for(let f=0;f<=1;f++)for(let m=0;m<=1;m++){const y=n[1*p|2*f|4*m];y.x=p?t.x:e.x,y.y=f?t.y:e.y,y.z=m?t.z:e.z,y.applyMatrix4(s)}const r=this.satBounds,o=this.satAxes,a=n[0];for(let p=0;p<3;p++){const f=o[p],m=r[p],y=n[1<<p];f.subVectors(a,y),m.setFromPoints(f,n)}const u=this.alignedSatBounds;u[0].setFromPointsField(n,"x"),u[1].setFromPointsField(n,"y"),u[2].setFromPointsField(n,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},xh.prototype.intersectsBox=function(){const s=new dd;return function(e){this.needsUpdate&&this.update();const t=e.min,n=e.max,r=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(s.min=t.x,s.max=n.x,a[0].isSeparated(s)||(s.min=t.y,s.max=n.y,a[1].isSeparated(s))||(s.min=t.z,s.max=n.z,a[2].isSeparated(s)))return!1;for(let u=0;u<3;u++){const p=o[u],f=r[u];if(s.setFromBox(p,e),f.isSeparated(s))return!1}return!0}}(),xh.prototype.intersectsTriangle=function(){const s=new yh,e=new Array(3),t=new dd,n=new dd,r=new c.Pa4;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(s.copy(o),s.update(),o=s);const a=this.satBounds,u=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let y=0;y<3;y++){const S=a[y],M=u[y];if(t.setFromPoints(M,e),S.isSeparated(t))return!1}const p=o.satBounds,f=o.satAxes,m=this.points;for(let y=0;y<3;y++){const S=p[y],M=f[y];if(t.setFromPoints(M,m),S.isSeparated(t))return!1}for(let y=0;y<3;y++){const S=u[y];for(let M=0;M<4;M++){const P=f[M];if(r.crossVectors(S,P),t.setFromPoints(r,e),n.setFromPoints(r,m),t.isSeparated(n))return!1}}return!0}}(),xh.prototype.closestPointToPoint=function(s,e){return this.needsUpdate&&this.update(),e.copy(s).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},xh.prototype.distanceToPoint=function(){const s=new c.Pa4;return function(e){return this.closestPointToPoint(e,s),e.distanceTo(s)}}(),xh.prototype.distanceToBox=function(){const s=["x","y","z"],e=new Array(12).fill().map(()=>new c.Zzh),t=new Array(12).fill().map(()=>new c.Zzh),n=new c.Pa4,r=new c.Pa4;return function(o,a=0,u=null,p=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(u||p)&&(o.getCenter(r),this.closestPointToPoint(r,n),o.closestPointToPoint(n,r),u&&u.copy(n),p&&p.copy(r)),0;const f=a*a,m=o.min,y=o.max,S=this.points;let M=1/0;for(let D=0;D<8;D++){const j=S[D];r.copy(j).clamp(m,y);const k=j.distanceToSquared(r);if(k<M&&(M=k,u&&u.copy(j),p&&p.copy(r),k<f))return Math.sqrt(k)}let P=0;for(let D=0;D<3;D++)for(let j=0;j<=1;j++)for(let k=0;k<=1;k++){const L=(D+1)%3,R=(D+2)%3,W=1<<D|j<<L|k<<R,q=S[j<<L|k<<R],J=S[W];e[P].set(q,J);const ee=s[D],he=s[L],xe=s[R],De=t[P],Fe=De.start,ke=De.end;Fe[ee]=m[ee],Fe[he]=j?m[he]:y[he],Fe[xe]=k?m[xe]:y[he],ke[ee]=y[ee],ke[he]=j?m[he]:y[he],ke[xe]=k?m[xe]:y[he],P++}for(let D=0;D<=1;D++)for(let j=0;j<=1;j++)for(let k=0;k<=1;k++){r.x=D?y.x:m.x,r.y=j?y.y:m.y,r.z=k?y.z:m.z,this.closestPointToPoint(r,n);const L=r.distanceToSquared(n);if(L<M&&(M=L,u&&u.copy(n),p&&p.copy(r),L<f))return Math.sqrt(L)}for(let D=0;D<12;D++){const j=e[D];for(let k=0;k<12;k++){const L=t[k];Ux(j,L,n,r);const R=n.distanceToSquared(r);if(R<M&&(M=R,u&&u.copy(n),p&&p.copy(r),R<f))return Math.sqrt(R)}}return Math.sqrt(M)}}();const Lb=new c.Pa4,Nb=new c.Pa4,Fb=new c.Pa4,yC=new c.FM8,bC=new c.FM8,wC=new c.FM8,xC=new c.Pa4;function EC(s,e,t,n,r){const o=3*n,a=s.index.getX(o),u=s.index.getX(o+1),p=s.index.getX(o+2),f=function(m,y,S,M,P,D,j){Lb.fromBufferAttribute(y,M),Nb.fromBufferAttribute(y,P),Fb.fromBufferAttribute(y,D);const k=function(L,R,W,q,J,ee){let he;return he=ee===c._Li?L.intersectTriangle(q,W,R,!0,J):L.intersectTriangle(R,W,q,ee!==c.ehD,J),he===null?null:{distance:L.origin.distanceTo(J),point:J.clone()}}(m,Lb,Nb,Fb,xC,j);if(k){S&&(yC.fromBufferAttribute(S,M),bC.fromBufferAttribute(S,P),wC.fromBufferAttribute(S,D),k.uv=c.CJI.getUV(xC,Lb,Nb,Fb,yC,bC,wC,new c.FM8));const L={a:M,b:P,c:D,normal:new c.Pa4,materialIndex:0};c.CJI.getNormal(Lb,Nb,Fb,L.normal),k.face=L,k.faceIndex=M}return k}(t,s.attributes.position,s.attributes.uv,a,u,p,e);return f?(f.faceIndex=n,r&&r.push(f),f):null}function SC(s,e,t){return s===null?null:(s.point.applyMatrix4(e.matrixWorld),s.distance=s.point.distanceTo(t.ray.origin),s.object=e,s.distance<t.near||s.distance>t.far?null:s)}function Eh(s,e,t,n){const r=s.a,o=s.b,a=s.c;let u=e,p=e+1,f=e+2;t&&(u=t.getX(e),p=t.getX(e+1),f=t.getX(e+2)),r.x=n.getX(u),r.y=n.getY(u),r.z=n.getZ(u),o.x=n.getX(p),o.y=n.getY(p),o.z=n.getZ(p),a.x=n.getX(f),a.y=n.getY(f),a.z=n.getZ(f)}function CC(s,e,t,n,r,o,a){const u=t.index,p=t.attributes.position;for(let f=s,m=e+s;f<m;f++)if(Eh(a,3*f,u,p),a.needsUpdate=!0,n(a,f,r,o))return!0;return!1}class MC{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){const e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}function Pp(s,e){return e[s+15]===65535}function x_(s,e){return e[s+6]}function M0(s,e){return e[s+14]}function T0(s){return s+8}function I0(s,e){return e[s+6]}const E_=new c.ZzF,Ub=new c.Pa4,WT=["x","y","z"];function Yx(s,e,t,n,r){let o=2*s,a=S_,u=Dp,p=Rp;if(Pp(o,u))(function(f,m,y,S,M,P){for(let D=S,j=S+M;D<j;D++)EC(f,m,y,D,P)})(e,t,n,x_(s,p),M0(o,u),r);else{const f=T0(s);jb(f,a,n,Ub)&&Yx(f,e,t,n,r);const m=I0(s,p);jb(m,a,n,Ub)&&Yx(m,e,t,n,r)}}function Xx(s,e,t,n){let r=2*s,o=S_,a=Dp,u=Rp;if(Pp(r,a))return function(p,f,m,y,S){let M=1/0,P=null;for(let D=y,j=y+S;D<j;D++){const k=EC(p,f,m,D);k&&k.distance<M&&(P=k,M=k.distance)}return P}(e,t,n,x_(s,u),M0(r,a));{const p=function(D,j){return j[D+7]}(s,u),f=WT[p],m=n.direction[f]>=0;let y,S;m?(y=T0(s),S=I0(s,u)):(y=I0(s,u),S=T0(s));const M=jb(y,o,n,Ub)?Xx(y,e,t,n):null;if(M){const D=M.point[f];if(m?D<=o[S+p]:D>=o[S+p+3])return M}const P=jb(S,o,n,Ub)?Xx(S,e,t,n):null;return M&&P?M.distance<=P.distance?M:P:M||P||null}}const qT=function(){let s,e;const t=[],n=new MC(()=>new c.ZzF);return function(...o){s=n.getPrimitive(),e=n.getPrimitive(),t.push(s,e);const a=r(...o);n.releasePrimitive(s),n.releasePrimitive(e),t.pop(),t.pop();const u=t.length;return u>0&&(e=t[u-1],s=t[u-2]),a};function r(o,a,u,p,f=null,m=0,y=0){function S(L){let R=2*L,W=Dp,q=Rp;for(;!Pp(R,W);)R=2*(L=T0(L));return x_(L,q)}function M(L){let R=2*L,W=Dp,q=Rp;for(;!Pp(R,W);)R=2*(L=I0(L,q));return x_(L,q)+M0(R,W)}let P=2*o,D=S_,j=Dp,k=Rp;if(Pp(P,j)){const L=x_(o,k),R=M0(P,j);return wh(o,D,s),p(L,R,!1,y,m+o,s)}{const L=T0(o),R=I0(o,k);let W,q,J,ee,he=L,xe=R;if(f&&(J=s,ee=e,wh(he,D,J),wh(xe,D,ee),W=f(J),q=f(ee),q<W)){he=R,xe=L;const Oe=W;W=q,q=Oe,J=ee}J||(J=s,wh(he,D,J));const De=u(J,Pp(2*he,j),W,y+1,m+he);let Fe;if(De===2){const Oe=S(he);Fe=p(Oe,M(he)-Oe,!0,y+1,m+he,J)}else Fe=De&&r(he,a,u,p,f,m,y+1);if(Fe)return!0;ee=e,wh(xe,D,ee);const ke=u(ee,Pp(2*xe,j),q,y+1,m+xe);let Qe;if(ke===2){const Oe=S(xe);Qe=p(Oe,M(xe)-Oe,!0,y+1,m+xe,ee)}else Qe=ke&&r(xe,a,u,p,f,m,y+1);return!!Qe}}}(),YT=function(){const s=new yh,e=new yh,t=new c.yGw,n=new xh,r=new xh;return function o(a,u,p,f,m=null){let y=2*a,S=S_,M=Dp,P=Rp;if(m===null&&(p.boundingBox||p.computeBoundingBox(),n.set(p.boundingBox.min,p.boundingBox.max,f),m=n),!Pp(y,M)){const D=a+8,j=P[a+6];return wh(D,S,E_),m.intersectsBox(E_)&&o(D,u,p,f,m)?!0:(wh(j,S,E_),!(!m.intersectsBox(E_)||!o(j,u,p,f,m)))}{const D=u,j=D.index,k=D.attributes.position,L=p.index,R=p.attributes.position,W=x_(a,P),q=M0(y,M);if(t.copy(f).invert(),p.boundsTree)return wh(a,S,r),r.matrix.copy(t),r.needsUpdate=!0,p.boundsTree.shapecast({intersectsBounds:ee=>r.intersectsBox(ee),intersectsTriangle:ee=>{ee.a.applyMatrix4(f),ee.b.applyMatrix4(f),ee.c.applyMatrix4(f),ee.needsUpdate=!0;for(let he=3*W,xe=3*(q+W);he<xe;he+=3)if(Eh(e,he,j,k),e.needsUpdate=!0,ee.intersectsTriangle(e))return!0;return!1}});for(let J=3*W,ee=q+3*W;J<ee;J+=3){Eh(s,J,j,k),s.a.applyMatrix4(t),s.b.applyMatrix4(t),s.c.applyMatrix4(t),s.needsUpdate=!0;for(let he=0,xe=L.count;he<xe;he+=3)if(Eh(e,he,L,R),e.needsUpdate=!0,s.intersectsTriangle(e))return!0}}}}();function jb(s,e,t,n){return wh(s,e,E_),t.intersectBox(E_,n)}const Kx=[];let zb,S_,Dp,Rp;function P0(s){zb&&Kx.push(zb),zb=s,S_=new Float32Array(s),Dp=new Uint16Array(s),Rp=new Uint32Array(s)}function Vb(){zb=null,S_=null,Dp=null,Rp=null,Kx.length&&P0(Kx.pop())}const Jx=Symbol("skip tree generation"),$x=new c.ZzF,Zx=new c.ZzF,C_=new c.yGw,Am=new xh,D0=new xh,R0=new c.Pa4,Gb=new c.Pa4,XT=new c.Pa4,KT=new c.Pa4,JT=new c.Pa4,TC=new c.ZzF,Sh=new MC(()=>new yh);class Qo{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Qo.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0||arguments[2]});t={cloneBuffers:!0,...t};const n=e.geometry,r=e._roots,o=n.getIndex();let a;return a=t.cloneBuffers?{roots:r.map(u=>u.slice()),index:o.array.slice()}:{roots:r,index:o.array},a}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Qo.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0||arguments[2]});n={setIndex:!0,...n};const{index:r,roots:o}=e,a=new Qo(t,{...n,[Jx]:!0});if(a._roots=o,n.setIndex){const u=t.getIndex();if(u===null){const p=new c.TlE(e.index,1,!1);t.setIndex(p)}else u.array!==r&&(u.array.set(r),u.needsUpdate=!0)}return a}constructor(e,t={}){if(!e.isBufferGeometry)throw new Error("MeshBVH: Only BufferGeometries are supported.");if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.");if((t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[Jx]:!1},t)).useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[Jx]||(this._roots=function(n,r){const o=function(M,P){function D(Oe){xe&&xe(Oe/De)}function j(Oe,ze,$e,Ge=null,ot=0){if(!Fe&&ot>=q&&(Fe=!0,J&&(console.warn(`MeshBVH: Max depth of ${q} reached when generating BVH. Consider increasing maxDepth.`),console.warn(M))),$e<=ee||ot>=q)return D(ze+$e),Oe.offset=ze,Oe.count=$e,Oe;const yt=function(pt,Qt,Kt,Jt,tn,Mn){let Rt=-1,oi=0;if(Mn===0)Rt=_C(Qt),Rt!==-1&&(oi=(Qt[Rt]+Qt[Rt+3])/2);else if(Mn===1)Rt=_C(pt),Rt!==-1&&(oi=function(xi,ai,Yi,gr){let wt=0;for(let Zt=ai,en=ai+Yi;Zt<en;Zt++)wt+=xi[6*Zt+2*gr];return wt/Yi}(Kt,Jt,tn,Rt));else if(Mn===2){const xi=C0(pt);let ai=Hx*tn;const Yi=6*Jt,gr=6*(Jt+tn);for(let wt=0;wt<3;wt++){const Zt=Qt[wt],en=(Qt[wt+3]-Zt)/32;if(tn<8){const li=[...Ip];li.length=tn;let dr=0;for(let Je=Yi;Je<gr;Je+=6,dr++){const Te=li[dr];Te.candidate=Kt[Je+2*wt],Te.count=0;const{bounds:it,leftCacheBounds:ht,rightCacheBounds:nt}=Te;for(let bt=0;bt<3;bt++)nt[bt]=1/0,nt[bt+3]=-1/0,ht[bt]=1/0,ht[bt+3]=-1/0,it[bt]=1/0,it[bt+3]=-1/0;kb(Je,Kt,it)}li.sort(HT);let Ce=tn;for(let Je=0;Je<Ce;Je++){const Te=li[Je];for(;Je+1<Ce&&li[Je+1].candidate===Te.candidate;)li.splice(Je+1,1),Ce--}for(let Je=Yi;Je<gr;Je+=6){const Te=Kt[Je+2*wt];for(let it=0;it<Ce;it++){const ht=li[it];Te>=ht.candidate?kb(Je,Kt,ht.rightCacheBounds):(kb(Je,Kt,ht.leftCacheBounds),ht.count++)}}for(let Je=0;Je<Ce;Je++){const Te=li[Je],it=Te.count,ht=tn-Te.count,nt=Te.leftCacheBounds,bt=Te.rightCacheBounds;let sn=0;it!==0&&(sn=C0(nt)/xi);let mn=0;ht!==0&&(mn=C0(bt)/xi);const En=1+Hx*(sn*it+mn*ht);En<ai&&(Rt=wt,ai=En,oi=Te.candidate)}}else{for(let Ce=0;Ce<32;Ce++){const Je=Ip[Ce];Je.count=0,Je.candidate=Zt+en+Ce*en;const Te=Je.bounds;for(let it=0;it<3;it++)Te[it]=1/0,Te[it+3]=-1/0}for(let Ce=Yi;Ce<gr;Ce+=6){let Je=~~((Kt[Ce+2*wt]-Zt)/en);Je>=32&&(Je=31);const Te=Ip[Je];Te.count++,kb(Ce,Kt,Te.bounds)}const li=Ip[31];vC(li.bounds,li.rightCacheBounds);for(let Ce=30;Ce>=0;Ce--){const Je=Ip[Ce],Te=Ip[Ce+1];AC(Je.bounds,Te.rightCacheBounds,Je.rightCacheBounds)}let dr=0;for(let Ce=0;Ce<31;Ce++){const Je=Ip[Ce],Te=Je.count,it=Je.bounds,ht=Ip[Ce+1].rightCacheBounds;Te!==0&&(dr===0?vC(it,Ob):AC(it,Ob,Ob)),dr+=Te;let nt=0,bt=0;dr!==0&&(nt=C0(Ob)/xi);const sn=tn-dr;sn!==0&&(bt=C0(ht)/xi);const mn=1+Hx*(nt*dr+bt*sn);mn<ai&&(Rt=wt,ai=mn,oi=Je.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${Mn} used.`);return{axis:Rt,pos:oi}}(Oe.boundingData,Ge,R,ze,$e,he);if(yt.axis===-1)return D(ze+$e),Oe.offset=ze,Oe.count=$e,Oe;const Mt=function(pt,Qt,Kt,Jt,tn){let Mn=Kt,Rt=Kt+Jt-1;const oi=tn.pos,xi=2*tn.axis;for(;;){for(;Mn<=Rt&&Qt[6*Mn+xi]<oi;)Mn++;for(;Mn<=Rt&&Qt[6*Rt+xi]>=oi;)Rt--;if(!(Mn<Rt))return Mn;for(let ai=0;ai<3;ai++){let Yi=pt[3*Mn+ai];pt[3*Mn+ai]=pt[3*Rt+ai],pt[3*Rt+ai]=Yi;let gr=Qt[6*Mn+2*ai+0];Qt[6*Mn+2*ai+0]=Qt[6*Rt+2*ai+0],Qt[6*Rt+2*ai+0]=gr;let wt=Qt[6*Mn+2*ai+1];Qt[6*Mn+2*ai+1]=Qt[6*Rt+2*ai+1],Qt[6*Rt+2*ai+1]=wt}Mn++,Rt--}}(W,R,ze,$e,yt);if(Mt===ze||Mt===ze+$e)D(ze+$e),Oe.offset=ze,Oe.count=$e;else{Oe.splitAxis=yt.axis;const pt=new Bb,Qt=ze,Kt=Mt-ze;Oe.left=pt,pt.boundingData=new Float32Array(6),qx(R,Qt,Kt,pt.boundingData,L),j(pt,Qt,Kt,L,ot+1);const Jt=new Bb,tn=Mt,Mn=$e-Kt;Oe.right=Jt,Jt.boundingData=new Float32Array(6),qx(R,tn,Mn,Jt.boundingData,L),j(Jt,tn,Mn,L,ot+1)}return Oe}(function(Oe,ze){if(!Oe.index){const $e=Oe.attributes.position.count,Ge=ze.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;let ot;ot=$e>65535?new Uint32Array(new Ge(4*$e)):new Uint16Array(new Ge(2*$e)),Oe.setIndex(new c.TlE(ot,1));for(let yt=0;yt<$e;yt++)ot[yt]=yt}})(M,P);const k=new Float32Array(6),L=new Float32Array(6),R=function(Oe,ze){const $e=Oe.attributes.position,Ge=$e.array,ot=Oe.index.array,yt=ot.length/3,Mt=new Float32Array(6*yt),pt=$e.offset||0;let Qt=3;$e.isInterleavedBufferAttribute&&(Qt=$e.data.stride);for(let Kt=0;Kt<yt;Kt++){const Jt=3*Kt,tn=6*Kt,Mn=ot[Jt+0]*Qt+pt,Rt=ot[Jt+1]*Qt+pt,oi=ot[Jt+2]*Qt+pt;for(let xi=0;xi<3;xi++){const ai=Ge[Mn+xi],Yi=Ge[Rt+xi],gr=Ge[oi+xi];let wt=ai;Yi<wt&&(wt=Yi),gr<wt&&(wt=gr);let Zt=ai;Yi>Zt&&(Zt=Yi),gr>Zt&&(Zt=gr);const en=(Zt-wt)/2,li=2*xi;Mt[tn+li+0]=wt+en,Mt[tn+li+1]=en+(Math.abs(wt)+en)*QT,wt<ze[xi]&&(ze[xi]=wt),Zt>ze[xi+3]&&(ze[xi+3]=Zt)}}return Mt}(M,k),W=M.index.array,q=P.maxDepth,J=P.verbose,ee=P.maxLeafTris,he=P.strategy,xe=P.onProgress,De=M.index.count/3;let Fe=!1;const ke=[],Qe=function(Oe){if(!Oe.groups||!Oe.groups.length)return[{offset:0,count:Oe.index.count/3}];const ze=[],$e=new Set;for(const ot of Oe.groups)$e.add(ot.start),$e.add(ot.start+ot.count);const Ge=Array.from($e.values()).sort((ot,yt)=>ot-yt);for(let ot=0;ot<Ge.length-1;ot++){const yt=Ge[ot],Mt=Ge[ot+1];ze.push({offset:yt/3,count:(Mt-yt)/3})}return ze}(M);if(Qe.length===1){const Oe=Qe[0],ze=new Bb;ze.boundingData=k,function($e,Ge,ot,yt){let Mt=1/0,pt=1/0,Qt=1/0,Kt=-1/0,Jt=-1/0,tn=-1/0;for(let Mn=6*Ge,Rt=6*(Ge+ot);Mn<Rt;Mn+=6){const oi=$e[Mn+0];oi<Mt&&(Mt=oi),oi>Kt&&(Kt=oi);const xi=$e[Mn+2];xi<pt&&(pt=xi),xi>Jt&&(Jt=xi);const ai=$e[Mn+4];ai<Qt&&(Qt=ai),ai>tn&&(tn=ai)}yt[0]=Mt,yt[1]=pt,yt[2]=Qt,yt[3]=Kt,yt[4]=Jt,yt[5]=tn}(R,Oe.offset,Oe.count,L),j(ze,Oe.offset,Oe.count,L),ke.push(ze)}else for(let Oe of Qe){const ze=new Bb;ze.boundingData=new Float32Array(6),qx(R,Oe.offset,Oe.count,ze.boundingData,L),j(ze,Oe.offset,Oe.count,L),ke.push(ze)}return ke}(n,r);let a,u,p;const f=[],m=r.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let M=0;M<o.length;M++){const P=o[M],D=new m(32*y(P));a=new Float32Array(D),u=new Uint32Array(D),p=new Uint16Array(D),S(0,P),f.push(D)}return f;function y(M){return M.count?1:1+y(M.left)+y(M.right)}function S(M,P){const D=M/4,j=M/2,k=!!P.count,L=P.boundingData;for(let R=0;R<6;R++)a[D+R]=L[R];if(k){const R=P.offset,W=P.count;return u[D+6]=R,p[j+14]=W,p[j+15]=Wx,M+32}{const R=P.left,W=P.right,q=P.splitAxis;let J;if(J=S(M+32,R),J/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return u[D+6]=J/4,J=S(J,W),u[D+7]=q,J}}}(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new c.ZzF))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));const t=this.geometry,n=t.index.array,r=t.attributes.position,o=r.array,a=r.offset||0;let u,p,f,m,y=3;r.isInterleavedBufferAttribute&&(y=r.data.stride);let S=0;const M=this._roots;for(let D=0,j=M.length;D<j;D++)u=M[D],p=new Uint32Array(u),f=new Uint16Array(u),m=new Float32Array(u),P(0,S),S+=u.byteLength;function P(D,j,k=!1){const L=2*D;if(f[L+15]===Wx){const R=p[D+6];let W=1/0,q=1/0,J=1/0,ee=-1/0,he=-1/0,xe=-1/0;for(let De=3*R,Fe=3*(R+f[L+14]);De<Fe;De++){const ke=n[De]*y+a,Qe=o[ke+0],Oe=o[ke+1],ze=o[ke+2];Qe<W&&(W=Qe),Qe>ee&&(ee=Qe),Oe<q&&(q=Oe),Oe>he&&(he=Oe),ze<J&&(J=ze),ze>xe&&(xe=ze)}return(m[D+0]!==W||m[D+1]!==q||m[D+2]!==J||m[D+3]!==ee||m[D+4]!==he||m[D+5]!==xe)&&(m[D+0]=W,m[D+1]=q,m[D+2]=J,m[D+3]=ee,m[D+4]=he,m[D+5]=xe,!0)}{const R=D+8,W=p[D+6],q=R+j,J=W+j;let ee=k,he=!1,xe=!1;e?ee||(he=e.has(q),xe=e.has(J),ee=!he&&!xe):(he=!0,xe=!0);const De=ee||xe;let Fe=!1;(ee||he)&&(Fe=P(R,j,ee));let ke=!1;De&&(ke=P(W,j,ee));const Qe=Fe||ke;if(Qe)for(let Oe=0;Oe<3;Oe++){const ze=R+Oe,$e=W+Oe,Ge=m[ze],ot=m[ze+3],yt=m[$e],Mt=m[$e+3];m[D+Oe]=Ge<yt?Ge:yt,m[D+Oe+3]=ot>Mt?ot:Mt}return Qe}}}traverse(e,t=0){const n=this._roots[t],r=new Uint32Array(n),o=new Uint16Array(n);(function a(u,p=0){const f=2*u,m=o[f+15]===Wx;if(m){const y=r[u+6],S=o[f+14];e(p,m,new Float32Array(n,4*u,6),y,S)}else{const y=u+8,S=r[u+6],M=r[u+7];e(p,m,new Float32Array(n,4*u,6),M)||(a(y,p+1),a(S,p+1))}})(0)}raycast(e,t=c.Wl3){const n=this._roots,r=this.geometry,o=[],a=t.isMaterial,u=Array.isArray(t),p=r.groups,f=a?t.side:t;for(let m=0,y=n.length;m<y;m++){const S=u?t[p[m].materialIndex].side:f,M=o.length;if(P0(n[m]),Yx(0,r,S,e,o),Vb(),u){const P=p[m].materialIndex;for(let D=M,j=o.length;D<j;D++)o[D].face.materialIndex=P}}return o}raycastFirst(e,t=c.Wl3){const n=this._roots,r=this.geometry,o=t.isMaterial,a=Array.isArray(t);let u=null;const p=r.groups,f=o?t.side:t;for(let m=0,y=n.length;m<y;m++){const S=a?t[p[m].materialIndex].side:f;P0(n[m]);const M=Xx(0,r,S,e);Vb(),M!=null&&(u==null||M.distance<u.distance)&&(u=M,a&&(M.face.materialIndex=p[m].materialIndex))}return u}intersectsGeometry(e,t){const n=this.geometry;let r=!1;for(const o of this._roots)if(P0(o),r=YT(0,n,e,t),Vb(),r)break;return r}shapecast(e,t,n){const r=this.geometry;if(e instanceof Function){if(t){const S=t;t=(M,P,D,j)=>{const k=3*P;return S(M,k,k+1,k+2,D,j)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}const o=Sh.getPrimitive();let{boundsTraverseOrder:a,intersectsBounds:u,intersectsRange:p,intersectsTriangle:f}=e;if(p&&f){const S=p;p=(M,P,D,j,k)=>!!S(M,P,D,j,k)||CC(M,P,r,f,D,j,o)}else p||(p=f?(S,M,P,D)=>CC(S,M,r,f,P,D,o):(S,M,P)=>P);let m=!1,y=0;for(const S of this._roots){if(P0(S),m=qT(0,r,u,p,a,y),Vb(),m)break;y+=S.byteLength}return Sh.releasePrimitive(o),m}bvhcast(e,t,n){let{intersectsRanges:r,intersectsTriangles:o}=n;const a=this.geometry.index,u=this.geometry.attributes.position,p=e.geometry.index,f=e.geometry.attributes.position;C_.copy(t).invert();const m=Sh.getPrimitive(),y=Sh.getPrimitive();if(o){let P=function(D,j,k,L,R,W,q,J){for(let ee=k,he=k+L;ee<he;ee++){Eh(y,3*ee,p,f),y.a.applyMatrix4(t),y.b.applyMatrix4(t),y.c.applyMatrix4(t),y.needsUpdate=!0;for(let xe=D,De=D+j;xe<De;xe++)if(Eh(m,3*xe,a,u),m.needsUpdate=!0,o(m,y,xe,ee,R,W,q,J))return!0}return!1};var M=P;if(r){const D=r;r=function(j,k,L,R,W,q,J,ee){return!!D(j,k,L,R,W,q,J,ee)||P(j,k,L,R,W,q,J,ee)}}else r=P}e.getBoundingBox(Zx),Zx.applyMatrix4(t);const S=this.shapecast({intersectsBounds:P=>Zx.intersectsBox(P),intersectsRange:(P,D,j,k,L,R)=>($x.copy(R),$x.applyMatrix4(C_),e.shapecast({intersectsBounds:W=>$x.intersectsBox(W),intersectsRange:(W,q,J,ee,he)=>r(P,D,W,q,k,L,ee,he)}))});return Sh.releasePrimitive(m),Sh.releasePrimitive(y),S}intersectsBox(e,t){return Am.set(e.min,e.max,t),Am.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Am.intersectsBox(n),intersectsTriangle:n=>Am.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},r={},o=0,a=1/0){e.boundingBox||e.computeBoundingBox(),Am.set(e.boundingBox.min,e.boundingBox.max,t),Am.needsUpdate=!0;const u=this.geometry,p=u.attributes.position,f=u.index,m=e.attributes.position,y=e.index,S=Sh.getPrimitive(),M=Sh.getPrimitive();let P=Gb,D=XT,j=null,k=null;r&&(j=KT,k=JT);let L=1/0,R=null,W=null;return C_.copy(t).invert(),D0.matrix.copy(C_),this.shapecast({boundsTraverseOrder:q=>Am.distanceToBox(q),intersectsBounds:(q,J,ee)=>ee<L&&ee<a&&(J&&(D0.min.copy(q.min),D0.max.copy(q.max),D0.needsUpdate=!0),!0),intersectsRange:(q,J)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:ee=>D0.distanceToBox(ee),intersectsBounds:(ee,he,xe)=>xe<L&&xe<a,intersectsRange:(ee,he)=>{for(let xe=3*ee,De=3*(ee+he);xe<De;xe+=3){Eh(M,xe,y,m),M.a.applyMatrix4(t),M.b.applyMatrix4(t),M.c.applyMatrix4(t),M.needsUpdate=!0;for(let Fe=3*q,ke=3*(q+J);Fe<ke;Fe+=3){Eh(S,Fe,f,p),S.needsUpdate=!0;const Qe=S.distanceToTriangle(M,P,j);if(Qe<L&&(D.copy(P),k&&k.copy(j),L=Qe,R=Fe/3,W=xe/3),Qe<o)return!0}}}});for(let ee=0,he=y?y.count:m.count;ee<he;ee+=3){Eh(M,ee,y,m),M.a.applyMatrix4(t),M.b.applyMatrix4(t),M.c.applyMatrix4(t),M.needsUpdate=!0;for(let xe=3*q,De=3*(q+J);xe<De;xe+=3){Eh(S,xe,f,p),S.needsUpdate=!0;const Fe=S.distanceToTriangle(M,P,j);if(Fe<L&&(D.copy(P),k&&k.copy(j),L=Fe,R=xe/3,W=ee/3),Fe<o)return!0}}}}),Sh.releasePrimitive(S),Sh.releasePrimitive(M),L===1/0?null:(n.point?n.point.copy(D):n.point=D.clone(),n.distance=L,n.faceIndex=R,r&&(r.point?r.point.copy(k):r.point=k.clone(),r.point.applyMatrix4(C_),D.applyMatrix4(C_),r.distance=D.sub(r.point).length(),r.faceIndex=W),n)}closestPointToPoint(e,t={},n=0,r=1/0){const o=n*n,a=r*r;let u=1/0,p=null;if(this.shapecast({boundsTraverseOrder:m=>(R0.copy(e).clamp(m.min,m.max),R0.distanceToSquared(e)),intersectsBounds:(m,y,S)=>S<u&&S<a,intersectsTriangle:(m,y)=>{m.closestPointToPoint(e,R0);const S=e.distanceToSquared(R0);return S<u&&(Gb.copy(R0),u=S,p=y),S<o}}),u===1/0)return null;const f=Math.sqrt(u);return t.point?t.point.copy(Gb):t.point=Gb.clone(),t.distance=f,t.faceIndex=p,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{wh(0,new Float32Array(t),TC),e.union(TC)}),e}}const IC=Qo.prototype.raycast;Qo.prototype.raycast=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');const[e,t,n,r]=s;return IC.call(this,n,e.material).forEach(o=>{(o=SC(o,e,t))&&r.push(o)}),r}return IC.apply(this,s)};const PC=Qo.prototype.raycastFirst;Qo.prototype.raycastFirst=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');const[e,t,n]=s;return SC(PC.call(this,n,e.material),e,t)}return PC.apply(this,s)};const DC=Qo.prototype.closestPointToPoint;Qo.prototype.closestPointToPoint=function(...s){if(s[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),s.unshift();const e=s[1],t={};return s[1]=t,DC.apply(this,s),e&&e.copy(t.point),t.distance}return DC.apply(this,s)};const RC=Qo.prototype.closestPointToGeometry;Qo.prototype.closestPointToGeometry=function(...s){const e=s[2],t=s[3];if(e&&e.isVector3||t&&t.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');const n={},r={},o=s[1];return s[2]=n,s[3]=r,RC.apply(this,s),e&&e.copy(n.point),t&&t.copy(r.point).applyMatrix4(o),n.distance}return RC.apply(this,s)};const BC=Qo.prototype.refit;Qo.prototype.refit=function(...s){const e=s[0],t=s[1];if(t&&(t instanceof Set||Array.isArray(t))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');const n=new Set;t.forEach(r=>n.add(r)),e&&e.forEach(r=>n.add(r)),BC.call(this,n)}else BC.apply(this,s)},["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(s=>{const e=Qo.prototype[s];Qo.prototype[s]=function(...t){return(t[0]===null||t[0].isMesh)&&(t.shift(),console.warn(`MeshBVH: The function signature for "${s}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,t)}});const e1=[new c.Pa4,new c.Pa4,new c.Pa4];function t1(s){return~~(1e4*s)}function kC(s){return`${t1(s.x)},${t1(s.y)},${t1(s.z)}`}class $T{constructor(e=null){this.data=null,this.unmatchedEdges=null,this.matchedEdges=null,this.useDrawRange=!0,e&&this.updateFrom(e)}getSiblingTriangleIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:~~(n/3)}getSiblingEdgeIndex(e,t){const n=this.data[3*e+t];return n===-1?-1:n%3}updateFrom(e){const t=new Map,{attributes:n}=e,r=e.index,o=n.position;let a=r?r.count/3:o.count/3;const u=a;let p=0;this.useDrawRange&&(p=e.drawRange.start,e.drawRange.count!==1/0&&(a=~~(e.drawRange.count/3)));let f=this.data;(!f||f.length<3*u)&&(f=new Int32Array(3*u)),f.fill(-1);let m=0,y=0;for(let S=0;S<a;S++){const M=3*S+p;for(let P=0;P<3;P++){let D=M+P;r&&(D=r.getX(D)),e1[P].fromBufferAttribute(o,D)}for(let P=0;P<3;P++){const D=(P+1)%3,j=e1[P],k=e1[D],L=kC(j),R=kC(k),W=`${R}_${L}`;if(t.has(W)){const q=t.get(W);f[M+P]=q,f[q]=M+P,t.delete(W),m--,y++}else{const q=`${L}_${R}`;t.set(q,M+P),m++}}}this.matchedEdges=y,this.unmatchedEdges=m,this.data=f}}class Qb extends c.Kj0{constructor(...e){super(...e),this.isBrush=!0,this._previousMatrix=new c.yGw,this._previousMatrix.elements.fill(0)}markUpdated(){this._previousMatrix.copy(this.matrix)}isDirty(){const{matrix:e,_previousMatrix:t}=this,n=e.elements,r=t.elements;for(let o=0;o<16;o++)if(n[o]!==r[o])return!0;return!1}prepareGeometry(){const e=this.geometry,t=e.attributes;if(dC())for(const n in t){const r=t[n];if(r.isInterleavedBufferAttribute)throw new Error("Brush: InterleavedBufferAttributes are not supported.");r.array=UT(r.array)}if(e.boundsTree||(e.boundsTree=new Qo(e,{maxLeafTris:3}),e.halfEdges&&e.halfEdges.updateFrom(e)),e.halfEdges||(e.halfEdges=new $T(e)),!e.groupIndices){const n=e.index.count/3,r=new Uint16Array(n),o=e.groups;for(let a=0,u=o.length;a<u;a++){const{start:p,count:f}=o[a];for(let m=p/3,y=(p+f)/3;m<y;m++)r[m]=a}e.groupIndices=r}}disposeCacheData(){const{geometry:e}=this;e.halfEdges=null,e.boundsTree=null,e.groupIndices=null}}function OC(s,e){let t=e;return Array.isArray(e)||(t=[],s.forEach(n=>{t[n.materialIndex]=e})),t}class ZT{constructor(){this.triangleSplitter=new FT,this.attributeData=new jT,this.attributes=["position","uv","normal"],this.useGroups=!0,this.debug=new VT}evaluate(e,t,n,r=new Qb){e.prepareGeometry(),t.prepareGeometry();const{triangleSplitter:o,attributeData:a,attributes:u,useGroups:p,debug:f}=this,m=r.geometry,y=e.geometry.attributes;for(let k=0,L=u.length;k<L;k++){const R=u[k],W=y[R];a.initializeArray(R,W.array.constructor)}for(const k in a.attributes)u.includes(k)||a.delete(k);for(const k in m.attributes)u.includes(k)||(m.deleteAttribute(k),m.dispose());a.clear(),f.enabled&&(f.reset(),oC(f)),function(k,L,R,W,q,J){const{useGroups:ee=!0}=J,{aIntersections:he,bIntersections:xe}=function(Fe,ke){const Qe=new tC,Oe=new tC;return nC.copy(Fe.matrixWorld).invert().multiply(ke.matrixWorld),Fe.geometry.boundsTree.bvhcast(ke.geometry.boundsTree,nC,{intersectsTriangles:(ze,$e,Ge,ot)=>(ze.intersectsTriangle($e,zx)&&zx.distance()>1e-5&&(Qe.add(Ge,ot),Oe.add(ot,Ge),Ib&&(Ib.addEdge(zx),Ib.addIntersectingTriangles(Ge,ze,ot,$e))),!1)}),{aIntersections:Qe,bIntersections:Oe}}(k,L);let De;De=ee?0:-1,gC(k,L,he,R,!1,q,De),mC(k,L,he,R,!1,W,q,De),De=ee?k.geometry.groups.length||1:-1,gC(L,k,xe,R,!0,q,De),mC(L,k,xe,R,!0,W,q,De)}(e,t,n,o,a,{useGroups:p}),f.enabled&&oC(null);const S=p&&e.geometry.groups.length!==0?e.geometry.groups.map(k=>({...k})):[{start:0,count:1/0,materialIndex:0}],M=p&&t.geometry.groups.length!==0?t.geometry.groups.map(k=>({...k})):[{start:0,count:1/0,materialIndex:0}],P=OC(S,e.material),D=OC(M,t.material);M.forEach(k=>{k.materialIndex+=P.length}),function(k,L,R,W){let q=!1,J=-1;const ee=W.groupCount,he=k.attributes,xe=W.groupAttributes[0];for(const Fe in xe){const ke=W.getTotalLength(Fe,ee),Qe=xe[Fe].type;let Oe=he[Fe];if(!Oe||Oe.array.length<ke){const $e=L.attributes[Fe];Oe=new c.TlE(new Qe(ke),$e.itemSize,$e.normalized),k.setAttribute(Fe,Oe),q=!0}let ze=0;for(let $e=0;$e<ee;$e++){const{array:Ge,type:ot,length:yt}=W.groupAttributes[$e][Fe],Mt=new ot(Ge.buffer,0,yt);Oe.array.set(Mt,ze),ze+=Mt.length}Oe.needsUpdate=!0,J=ke/Oe.itemSize}k.setDrawRange(0,J),k.clearGroups();let De=0;for(let Fe=0;Fe<ee;Fe++){const ke=W.getGroupArray("position",Fe).length/3;if(ke!==0){const Qe=R[Fe];k.addGroup(De,ke,Qe.materialIndex),De+=ke}}if(k.index){const Fe=k.index.array;if(Fe.length<J)k.index=null,q=!0;else for(let ke=0,Qe=Fe.length;ke<Qe;ke++)Fe[ke]=ke}k.boundsTree=null,q&&k.dispose()}(m,e.geometry,[...S,...M],a);const j=m.groups;if(p){const k=new Map,L=[...P,...D];let R=0;for(let W=0,q=L.length;W<q;W++)Boolean(j.find(J=>J.materialIndex===W))?(k.set(W,R),R++):L[W]=null;for(let W=0,q=j.length;W<q;W++){const J=j[W];J.materialIndex=k.get(J.materialIndex)}r.material=L.filter(W=>W)}return r}evaluateHierarchy(e,t=new Qb){e.updateMatrixWorld(!0);const n=(o,a)=>{const u=o.children;for(let p=0,f=u.length;p<f;p++){const m=u[p];m.isOperationGroup?n(m,a):a(m)}},r=o=>{const a=o.children;let u=!1;for(let f=0,m=a.length;f<m;f++){const y=a[f];u=r(y)||u}const p=o.isDirty();if(p&&o.markUpdated(),u&&!o.isOperationGroup){let f;return n(o,m=>{f=f?this.evaluate(f,m,m.operation):this.evaluate(o,m,m.operation)}),o._cachedGeometry=f.geometry,o._cachedMaterials=f.material,!0}return u||p};return r(e),t.geometry=e._cachedGeometry,t.material=e._cachedMaterials,t}reset(){this.triangleSplitter.reset()}}const LC={union:0,subtract:1,intersect:4,difference:3};function NC(s,e){const t=new ZT;t.useGroups=!0,t.attributes=["position","normal","uv"],s.forEach(o=>{for(const a of[...t.attributes])o[0].geometry.getAttribute(a)||t.attributes.splice(t.attributes.indexOf(a),1)});let n=new Qb(new c._12(.01,.01,2,2));s.forEach(([o,a])=>{if(!Object.keys(LC).includes(a))return void console.error(`Unknown operation ${a}`);o.updateMatrix(),o.updateMatrixWorld();const u=new Qb;u.geometry=o.geometry,u.material=o.material,o.matrixWorld.decompose(u.position,u.quaternion,u.scale),u.updateMatrix(),u.updateMatrixWorld(),n=t.evaluate(n,u,LC[a])});const r=n;return r.userData._isCSGMesh=!0,r}let Hb=class extends hd{_buildCSGMesh(s){return NC(s)}};Hb.PluginType="CSGPluginBVH",Hb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a}([Ci("CSG Plugin (BVH)")],Hb);var FC=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const eI=new c.Pa4(0,0,1),UC=new c.USm,tI=new c._fP,nI=new c._fP(-Math.sqrt(.5),0,0,Math.sqrt(.5)),M_=new c._fP,iI={type:"change"};let B0=class extends w{constructor(s){super(),this.enabled=!1,this.lastOrder="XYZ",this.dampingFactor=.05,this.lastQuaternion=new c._fP,this.onDeviceOrientationChangeEvent=e=>{this.deviceOrientation=e},this.onScreenOrientationChangeEvent=()=>{this.screenOrientation=screen.orientation},this._initQuaternion=new c._fP,this._initQuaternionInvert=new c._fP,this._initQuaternionDest=new c._fP,this._lastTime=-1,window.isSecureContext===!1&&console.error("DeviceOrientationControls2: DeviceOrientationEvent is only available in secure contexts (https)"),this.object=s,this.lastOrder=this.object.rotation.order,this.object.rotation.reorder("YXZ"),this.connect()}connect(){this.onScreenOrientationChangeEvent(),window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(s=>{s=="granted"&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(s=>{console.error("DeviceOrientationControls2: Unable to use DeviceOrientation API:",s)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0,this._initQuaternion.copy(this.object.quaternion),this._initQuaternionInvert.copy(this.object.quaternion).invert()}disconnect(){window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this._initQuaternion.identity(),this._initQuaternionInvert.identity(),this._initQuaternionDest=new c._fP,this.object.rotation.reorder(this.lastOrder),this.lastOrder="XYZ",this.enabled=!1}update(){if(!this.enabled)return;const s=this.deviceOrientation;if(s){const e=s.alpha!==null?c.M8C.degToRad(s.alpha):0,t=s.beta!==null?c.M8C.degToRad(s.beta):0,n=s.gamma!==null?c.M8C.degToRad(s.gamma):0,r=this.screenOrientation?c.M8C.degToRad(this.screenOrientation.angle):0;this.setObjectQuaternion(e,t,n,r),8*(1-this.lastQuaternion.dot(this.object.quaternion))>1e-6&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(iI))}}dispose(){this.disconnect()}setObjectQuaternion(s,e,t,n){const r=Mi()/1e3;UC.set(e,s,-t,"YXZ"),M_.setFromEuler(UC),M_.multiply(nI),M_.multiply(tI.setFromAxisAngle(eI,-n)),this._initQuaternionDest.__init||(this._initQuaternionDest.copy(M_).invert(),this._initQuaternionDest.__init=!0),M_.premultiply(this._initQuaternionDest),this.object.quaternion.slerp(M_,this.dampingFactor/(Math.min(1,r-this._lastTime)/(1/60))),this._lastTime=r}};FC([et(),wn("Damping",[0,1],.01)],B0.prototype,"dampingFactor",void 0),B0=FC([Ci("Device Orientation Controls")],B0);class n1 extends ui{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._cameraChanged=e=>{var t,n,r,o;(n=(t=e.lastCamera)===null||t===void 0?void 0:t.removeControlsCtor)===null||n===void 0||n.call(t,this.controlsKey),(o=(r=e.camera)===null||r===void 0?void 0:r.setControlsCtor)===null||o===void 0||o.call(r,this.controlsKey,this._controlsCtor)}}async onAdded(e){await super.onAdded(e),this._cameraChanged({camera:e.scene.activeCamera}),e.scene.addEventListener("activeCameraChange",this._cameraChanged)}async onRemove(e){return this._cameraChanged({lastCamera:e.scene.activeCamera}),e.scene.removeEventListener("activeCameraChange",this._cameraChanged),super.onRemove(e)}}class i1 extends n1{constructor(){super(...arguments),this.controlsKey="deviceOrientation",this._controlsCtor=(e,t)=>new B0(e)}}i1.PluginType="DeviceOrientationControlsPlugin";var va=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const jC=new c.Pa4,r1=new c.$V,s1=new c.Pa4,rI={type:"change"};let mo=class extends w{constructor(s,e){super(),this.enabled=!0,this.enableKeys=!0,this.movementSpeed=1,this.lookSpeed=.005,this.lookVertical=!0,this.autoForward=!1,this.activeLook=!0,this.heightSpeed=!1,this.heightCoef=1,this.heightMin=0,this.heightMax=1,this.constrainVertical=!1,this.verticalMin=0,this.verticalMax=Math.PI,this.mouseDragOn=!1,this.autoSpeedFactor=0,this.mouseX=0,this.mouseY=0,this.moveForward=!1,this.moveBackward=!1,this.moveLeft=!1,this.moveRight=!1,this.moveUp=!1,this.moveDown=!1,this.viewHalfX=0,this.viewHalfY=0,this.lat=0,this.lon=0,this.targetPosition=new c.Pa4,this._lastTime=-1,this.object=s,this.domElement=e,this.onMouseMove=this.onMouseMove.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onKeyDown=this.onKeyDown.bind(this),this.onKeyUp=this.onKeyUp.bind(this),this.onContextMenu=this.onContextMenu.bind(this),this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("mousemove",this.onMouseMove),this.domElement.addEventListener("mousedown",this.onMouseDown),this.domElement.addEventListener("mouseup",this.onMouseUp),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize(),this.setOrientation()}setOrientation(){const s=this.object.quaternion;jC.set(0,0,-1).applyQuaternion(s),r1.setFromVector3(jC),this.lat=90-c.M8C.radToDeg(r1.phi),this.lon=c.M8C.radToDeg(r1.theta)}handleResize(){this.domElement===document?(this.viewHalfX=window.innerWidth/2,this.viewHalfY=window.innerHeight/2):(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}onMouseDown(s){if(this.domElement!==document&&this.domElement.focus(),this.activeLook)switch(s.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}onMouseUp(s){if(this.activeLook)switch(s.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}onMouseMove(s){this.domElement===document?(this.mouseX=s.pageX-this.viewHalfX,this.mouseY=s.pageY-this.viewHalfY):(this.mouseX=s.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=s.pageY-this.domElement.offsetTop-this.viewHalfY)}onKeyDown(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}onKeyUp(s){if(this.enableKeys)switch(s.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}lookAt(s,e,t){return s.isVector3?s1.copy(s):e===void 0||t===void 0?console.error("FirstPersonControls2.lookAt: y and z parameters are required"):s1.set(s,e,t),this.object.lookAt(s1),this.setOrientation(),this}update(){const s=Mi(),e=(this._lastTime<0?16:Math.min(s-this._lastTime,1e3))/1e3;if(this._lastTime=s,!this.enabled)return;if(this.heightSpeed){const p=c.M8C.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(p*this.heightCoef)}else this.autoSpeedFactor=0;const t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let n=e*this.lookSpeed;this.activeLook||(n=0);let r=1;this.constrainVertical&&(r=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*n,this.lookVertical&&(this.lat-=this.mouseY*n*r),this.lat=Math.max(-85,Math.min(85,this.lat));let o=c.M8C.degToRad(90-this.lat);const a=c.M8C.degToRad(this.lon);this.constrainVertical&&(o=c.M8C.mapLinear(o,0,Math.PI,this.verticalMin,this.verticalMax));const u=this.object.position;this.targetPosition.setFromSphericalCoords(1,o,a).add(u),this.object.lookAt(this.targetPosition),this.dispatchEvent(rI)}dispose(){this.domElement.removeEventListener("contextmenu",this.onContextMenu),this.domElement.removeEventListener("mousedown",this.onMouseDown),this.domElement.removeEventListener("mousemove",this.onMouseMove),this.domElement.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}onContextMenu(s){this.enableKeys&&s.preventDefault()}};va([et(),_n()],mo.prototype,"enabled",void 0),va([et(),_n()],mo.prototype,"enableKeys",void 0),va([et(),Si()],mo.prototype,"movementSpeed",void 0),va([et(),Si()],mo.prototype,"lookSpeed",void 0),va([et(),_n()],mo.prototype,"lookVertical",void 0),va([et(),_n()],mo.prototype,"autoForward",void 0),va([et(),_n()],mo.prototype,"activeLook",void 0),va([et(),_n()],mo.prototype,"heightSpeed",void 0),va([et(),Si()],mo.prototype,"heightCoef",void 0),va([et(),Si()],mo.prototype,"heightMin",void 0),va([et(),Si()],mo.prototype,"heightMax",void 0),va([et(),_n()],mo.prototype,"constrainVertical",void 0),va([et(),Si()],mo.prototype,"verticalMin",void 0),va([et(),Si()],mo.prototype,"verticalMax",void 0),va([et(),_n()],mo.prototype,"mouseDragOn",void 0),mo=va([Ci("First Person Controls")],mo);class o1 extends n1{constructor(){super(...arguments),this.controlsKey="firstPerson",this._controlsCtor=(e,t)=>new mo(e,t)}}o1.PluginType="FirstPersonControlsPlugin";var T_=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};const I_=new c.USm(0,0,0,"YXZ"),P_=new c.Pa4,sI={type:"change"},oI={type:"lock"},aI={type:"unlock"},zC=Math.PI/2;let fd=class extends w{constructor(s,e){super(),this.isLocked=!1,this.enabled=!0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this.autoLockOnClick=!0,this._movementX=0,this._movementY=0,this._forwardDirection=new c.Pa4(0,0,-1),this.domElement=e,this.object=s,this.onElementClick=this.onElementClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onPointerlockChange=this.onPointerlockChange.bind(this),this.onPointerlockError=this.onPointerlockError.bind(this),this.connect()}onElementClick(s){this.isLocked||this.autoLockOnClick&&(s.preventDefault(),this.lock())}onMouseMove(s){this.isLocked&&(this._movementX+=s.movementX||s.mozMovementX||s.webkitMovementX||0,this._movementY+=s.movementY||s.mozMovementY||s.webkitMovementY||0)}onPointerlockChange(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(oI),this.isLocked=!0):(this.dispatchEvent(aI),this.isLocked=!1)}onPointerlockError(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError),this.domElement.addEventListener("click",this.onElementClick)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError),this.domElement.removeEventListener("click",this.onElementClick)}dispose(){this.disconnect()}getDirection(s){return s.copy(this._forwardDirection).applyQuaternion(this.object.quaternion)}moveForward(s){P_.setFromMatrixColumn(this.object.matrix,0),P_.crossVectors(this.object.up,P_),this.object.position.addScaledVector(P_,s)}moveRight(s){P_.setFromMatrixColumn(this.object.matrix,0),this.object.position.addScaledVector(P_,s)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}update(){I_.setFromQuaternion(this.object.quaternion),I_.y-=.002*this._movementX*this.pointerSpeed,I_.x-=.002*this._movementY*this.pointerSpeed,this._movementX=0,this._movementY=0,I_.x=Math.max(zC-this.maxPolarAngle,Math.min(zC-this.minPolarAngle,I_.x)),this.object.quaternion.setFromEuler(I_),this.dispatchEvent(sI)}};T_([_n(),et()],fd.prototype,"enabled",void 0),T_([Si(),et()],fd.prototype,"minPolarAngle",void 0),T_([Si(),et()],fd.prototype,"maxPolarAngle",void 0),T_([Si(),et()],fd.prototype,"pointerSpeed",void 0),T_([_n(),et()],fd.prototype,"autoLockOnClick",void 0),fd=T_([Ci("Pointer Lock Controls")],fd);class a1 extends n1{constructor(){super(...arguments),this.controlsKey="pointerLock",this._controlsCtor=(e,t)=>new fd(e,t.ownerDocument?t:t.documentElement)}}a1.PluginType="PointerLockControlsPlugin";var lI=__webpackgi_require__(819);class xc{static _initialize(){this._inited=!0,ql(se`
          #customContextMenu {
            background: #2c2c2e99;
            backdrop-filter: blur(8px);
            border: 0.5px solid rgba(20, 20, 20, 0.3);
            width: auto;
            height: auto;
            position: absolute;
            display: flex;
            flex-direction: column;
            z-index: 9999;
            padding: 0.35rem 0.20rem;
            border-radius: 0.375rem;
            min-width: 6rem;
            pointer-events: auto;
            box-shadow: 0px 2px 10px rgba(12, 12, 12, 0.2);
          }

          .customContextMenuItems {
            color: white;
            font-size: 0.65rem;
            font-family: "Roboto Mono", "Source Code Pro", Menlo, Courier, monospace;
            background-color: transparent;
            cursor: pointer;
            padding: 0.12rem 0.35rem;
            border-radius: 0.25rem;
            line-height: 1rem;
            font-weight: 500;
          }

          .customContextMenuItems:hover {
            color: white;
            background-color: #017AFF;
          }
        `),document.addEventListener("mouseup",e=>{this.Element&&!this.Element.contains(e.target)&&this.Remove()})}static Create(e,t,n){this._inited||this._initialize(),this.Element&&this.Remove();const r=Cr({id:"customContextMenu",addToBody:!1});r.style.top=n+"px",r.style.left=t+"px";for(const[o,a]of Object.entries(e)){const u=Cr({classList:["customContextMenuItems"],addToBody:!1,innerHTML:o});r.appendChild(u),u.onclick=a}return this.Element=r,r}static Remove(){var e;(e=this.Element)===null||e===void 0||e.remove(),this.Element=void 0}}xc.Element=void 0,xc._inited=!1;var cI=__webpackgi_require__(665);const uI=(s,e,t)=>{var n,r,o;const a=s.controller_,u=(r=(n=a.parent)===null||n===void 0?void 0:n.children)===null||r===void 0?void 0:r.indexOf(a);return!(((f,m)=>m.controller_.rackController.rack===f.controller_.parent)(s,e)&&u===t||(u!==void 0&&u>=0&&((o=a.parent)===null||o===void 0||o.remove(s)),e.add(s,t),0))},hI=(s,e,t,n)=>{var r,o,a,u,p;let f=e.uiRef;const m=f==null?void 0:f.expanded;if(f||(f=s.addFolder({title:""}),f.on("fold",j=>{var k,L,R;let W=f.expanded;_e(e,"expanded",W,!0),W=(k=Se(e.expanded))!==null&&k!==void 0?k:W,W!==f.expanded&&(f.expanded=W),(L=e.uiRefresh)===null||L===void 0||L.call(e,"postFrame",!0),W&&((R=e.onExpand)===null||R===void 0||R.call(e,e))})),!f)return f;f.expanded=(o=(r=Se(e.expanded))!==null&&r!==void 0?r:m)!==null&&o!==void 0&&o;const y=((a=e.children)!==null&&a!==void 0?a:[]).map(j=>j&&Se(j)).flat(2).filter(j=>j);let S=0;for(const j of y){let k=j.uiRef;k&&k.controller_.viewProps.get("disposed")&&(j.uiRef=void 0),k=j.uiRef,k||(t.appendUiObject({uiConfig:j},f),k=j.uiRef),k&&uI(k,f,S++)&&t.appendUiObject({uiConfig:j},f)}let M=f.children;for(;M.length>S;){const j=M[M.length-1];f.remove(j),M=f.children}f.controller_.props.set("title",(u=Se(e.label))!==null&&u!==void 0?u:"");const P=f.controller_.view.containerElement,D=Se(e.domChildren,[]);if((D==null?void 0:D.length)!==void 0){const j=[];for(let k=0;k<P.children.length;k++){const L=P.children[k];!((p=L.dataset)===null||p===void 0)&&p.tpCustomDOM&&j.push(L)}for(const k of j)P.removeChild(k);for(const k of D)k.parentElement!==P&&(P.appendChild(k),k.dataset.tpCustomDOM="true");f.controller_.foldable.cleanUpTransition()}return f},dI=(s,e,t,n)=>{var r,o;const[a,u]=(r=e.property)!==null&&r!==void 0?r:[void 0,void 0],p=(o=Se(e.label))!==null&&o!==void 0?o:u;let f=e.uiRef;return f||(f=s.addButton({title:""}),f.on("click",async()=>{var m;const y=[];e.prompt&&y.push(await t.prompt(...e.prompt));const S=(m=a&&u?a[u]:void 0)!==null&&m!==void 0?m:e.value;if(typeof S=="function"){const M=()=>{t.removeEventListener("postFrame",M),S(...y)};t.addEventListener("postFrame",M)}else console.warn("Invalid action type for button")})),f&&(f.title=p??"click me"),f},pI=(s,e,t,n)=>{var r;const o=Object.fromEntries(((r=Se(e.children))!==null&&r!==void 0?r:[]).map(a=>Se(a)).flat(2).filter(a=>a).map(a=>{var u;const p=Se(a.label);return[p,(u=a.value)!==null&&u!==void 0?u:p]}));return Ch(s,e,t,{options:o,...n??{}})},fI=(s,e,t,n)=>{var r,o;const a=Se(e.bounds),u=((r=a==null?void 0:a.length)!==null&&r!==void 0?r:0)>=2?a[1]:1,p=((o=a==null?void 0:a.length)!==null&&o!==void 0?o:0)>=1?a[0]:0,f=e.stepSize||void 0;return Ch(s,e,t,{min:p,max:u,step:f,...n??{}})},Wb=(s,e,t,n)=>{var r,o,a;const u=Se(e.bounds);if(!u||u.length<1)return Ch(s,e,t,{...n??{}});const p=((r=u.length)!==null&&r!==void 0?r:0)>=2?u[1]:1,f=((o=u.length)!==null&&o!==void 0?o:0)>=1?u[0]:0,m={min:f,max:p,step:(a=e.stepSize)!==null&&a!==void 0?a:(p-f)/100},y={x:m,y:m};e.type!=="vec3"&&e.type!=="vec4"||(y.z=m),e.type==="vec4"&&(y.w=m);const S=e.property;if(e.value===void 0&&S&&S[0]&&typeof S[0]=="object"&&S[0][S[1]]&&Array.isArray(S[0][S[1]])){const[M,P]=S,D=M[P],j=D.length,k=new(j===2?c.FM8:j===3?c.Pa4:c.Ltg)().fromArray(D);e.value=k,e.property=void 0,e.onChange=[()=>{M[P]=k.toArray()},...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(L=>L),e.label===void 0&&(e.label=P)}return Ch(s,e,t,{...y,...n??{}})},mI=(s,e,t,n)=>{var r;const o=e.property;if(e.value===void 0&&o&&typeof o[0]=="object"&&(!((r=o[0][o[1]])===null||r===void 0)&&r.isColor)){const[a,u]=o,p=new Sn().set(a[u]).convertSRGBToLinear();Object.defineProperty(e,"value",{get:()=>{const f=a[u];return f?p.set(f).convertLinearToSRGB().getHex():0},set:f=>{const m=a[u];p.setHex(f).convertSRGBToLinear(),m.isColor?m.copy(p):typeof m=="number"?a[u]=p.getHex():typeof m=="string"&&(a[u]="#"+p.getHexString()),typeof(a==null?void 0:a.setDirty)=="function"&&a.setDirty()}}),e.property=void 0,e.onChange=[...Array.isArray(e.onChange)?e.onChange:[e.onChange]].filter(f=>f),e.label===void 0&&(e.label=u)}return(n=n??{}).view="color",Se(e.inlinePicker)&&(n.picker="inline"),Ch(s,e,t,n)},Ch=(s,e,t,n)=>{var r;let o=Se(e.property);if((e.getValue||e.setValue)&&o&&console.error("specify either property or value, or getValue and setValue",e),o)e.value&&console.warn("Both property and value are defined, value will be ignored",e);else if(e.value===void 0&&(e.getValue||e.setValue)&&(Object.defineProperty(e,"value",{get:()=>{var p;return(p=e.getValue)===null||p===void 0?void 0:p.call(e)},set:p=>{var f;return(f=e.setValue)===null||f===void 0?void 0:f.call(e,p)}}),o=[e,"value"]),o||e.value===void 0||(o=[e,"value"]),!o)return void console.error("cannot determine property",e);n=n??{};const a={label:(r=Se(e.label))!==null&&r!==void 0?r:o[1],...n};let u=e.uiRef;if(!u&&typeof o[0]=="object"&&o[0]){const[p,f]=o;try{u=e.isMonitor?s.addMonitor(p,f,a):s.addInput(p,f,a).on("change",m=>{[e.onChange].flat().forEach(y=>typeof y=="function"&&(y==null?void 0:y(m))),typeof(p==null?void 0:p.setDirty)=="function"&&p.setDirty(m)})}catch(m){if(!m.message.startsWith("No matching controller for"))throw m;u=void 0}}if(u){for(const[p,f]of Object.entries(a)){const m=u.controller_.props.value(p);m!==void 0&&m.rawValue!==f&&u.controller_.props.set(p,f)}e.type==="slider"&&(a.min!==void 0&&u.controller_.valueController.sliderController.props.set("minValue",a.min),a.max!==void 0&&u.controller_.valueController.sliderController.props.set("maxValue",a.max)),u.refresh()}return u};class VC extends w{constructor(e=!1,t=!1,n=!1,r=!0,o=document.body){super(),this._refreshQueue={preRender:[],postRender:[],preFrame:[],postFrame:[]},this._lastModeTime={preRender:0,postRender:0,preFrame:0,postFrame:0},this._typeGenerators={folder:hI,input:Ch,slider:fI,dropdown:pI,checkbox:Ch,color:mI,vec:Wb,vec2:Wb,vec3:Wb,vec4:Wb,button:dI,monitor:(u,p,f,m)=>(p.isMonitor=!0,Ch(u,p,f,m)),dummy:(u,p,f,m)=>Ch(u,p,f,m)},this.alert=async u=>alert(u),this.confirm=async u=>confirm(u),this.prompt=async(u,p,f=!0)=>prompt(u,p),this._expand=e,this._limitedOptions=n;const a=this._createUiContainer();o.appendChild(a),this._pane=new cI.Pane({title:"Configuration",container:a}),this._pane.expanded=this._expand,r&&(this.addEventListener("postFrame",()=>this.refreshQueue("postFrame")),setTimeout(()=>{this.dispatchEvent({type:"postFrame"})},32))}refreshQueue(e){const t=this._refreshQueue[e],n=[],r=Mi(),o=r-this._lastModeTime[e];t.forEach(a=>{a[2]>.001?(a[2]-=o,n.push(a)):this._refreshUiObject(a[0],a[1],a[2])}),this._refreshQueue[e]=n,this._lastModeTime[e]=r}addToRefreshQueue(e,t){var n;const r=(n=t[0])===null||n===void 0?void 0:n.uiConfig,o=r==null?void 0:r.uuid,a=this._refreshQueue[e],u=a.find(p=>p[3]===o);u?u[2]=Math.max(u[2],t[2]):a.push([...t,o]),this._refreshQueue[e]=a}dispose(){var e;(e=this._pane)===null||e===void 0||e.dispose(),this._pane=void 0}appendUiObject(e,t){e&&this._appendUiObject(e,t)}_appendUiObject(e,t){var n,r,o,a;const{uiConfig:u}=e??{};if(u&&(!this._limitedOptions||u.limitedUi)&&(t=t??this._pane,u.type)){u.uuid||(u.uuid=ki()),u.uiRef&&u.uiRefType!==u.type&&(console.log("Removing UI object because of type mismatch",u.uiRef),this.removeUiConfig(u));const p=(r=(n=this._typeGenerators)[u.type])===null||r===void 0?void 0:r.call(n,t,u,this);p&&(p.hidden=(o=Se(u.hidden))!==null&&o!==void 0&&o,p.disabled=(a=Se(u.disabled))!==null&&a!==void 0&&a),u.uiRef=p,u.uiRefType=p?u.type:void 0,u.uiRefresh=(f="postFrame",m=!1,y=0)=>{var S;return this._uiObjectRefresh(f,(S=e==null?void 0:e.uiConfig)!==null&&S!==void 0?S:u,t,m,y)}}}removeUiObject(e){this.removeUiConfig(e==null?void 0:e.uiConfig)}removeUiConfig(e){var t,n;e&&e.uiRef&&((n=(t=e.uiRef).dispose)===null||n===void 0||n.call(t),e.uiRef=void 0,e.uiRefType=void 0,e.uiRefresh=void 0)}_uiObjectRefresh(e,t,n,r,o){(r?l1(t,n):[{uiConfig:t,parentFolder:n}]).forEach(a=>{const u=[{uiConfig:a.uiConfig},a.parentFolder,o];e==="immediate"?this._refreshUiObject(...u):this.addToRefreshQueue(e,u)})}_refreshUiObject(e,t,n=0){this._appendUiObject(e,t),n>1e-4&&console.error("no support for immediate delay")}_createUiContainer(){const e=Cr({id:"tweakpaneUiContainer",addToBody:!1});return ql(se`
          :root{
            --tweakpane-ui-container-width: 300px;
          }
          @media only screen and (min-width: 1500px) {
            :root{
              --tweakpane-ui-container-width: 300px;
            }
          }
          @media only screen and (min-width: 2500px) {
            :root{
              --tweakpane-ui-container-width: 500px;
            }
          }
          #tweakpaneUiContainer {
            position: fixed;
            top: 0px;
            padding-right: 4px;
            padding-bottom: 10px;
            right: 10px;
            width: var(--tweakpane-ui-container-width);
            height: auto;
            overflow-y: scroll;
            z-index: 100;
            pointer-events: auto;
            max-height: calc(100% - 6rem);
            border-radius: 0.5rem;
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "system-ui", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
          }
        `),e}}function l1(s,e,t){var n;return t=t??[],s&&(t.push({uiConfig:s,parentFolder:e}),(n=s.children)===null||n===void 0||n.forEach(r=>t=l1(r,s.uiRef,t))),t}class c1{constructor(){c1.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,n,r,o,a,u,p,f){const m=this.elements;return m[0]=e,m[1]=r,m[2]=u,m[3]=t,m[4]=o,m[5]=p,m[6]=n,m[7]=a,m[8]=f,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,r=t.elements,o=this.elements,a=n[0],u=n[3],p=n[6],f=n[1],m=n[4],y=n[7],S=n[2],M=n[5],P=n[8],D=r[0],j=r[3],k=r[6],L=r[1],R=r[4],W=r[7],q=r[2],J=r[5],ee=r[8];return o[0]=a*D+u*L+p*q,o[3]=a*j+u*R+p*J,o[6]=a*k+u*W+p*ee,o[1]=f*D+m*L+y*q,o[4]=f*j+m*R+y*J,o[7]=f*k+m*W+y*ee,o[2]=S*D+M*L+P*q,o[5]=S*j+M*R+P*J,o[8]=S*k+M*W+P*ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],u=e[5],p=e[6],f=e[7],m=e[8];return t*a*m-t*u*f-n*o*m+n*u*p+r*o*f-r*a*p}invert(){const e=this.elements,t=e[0],n=e[1],r=e[2],o=e[3],a=e[4],u=e[5],p=e[6],f=e[7],m=e[8],y=m*a-u*f,S=u*p-m*o,M=f*o-a*p,P=t*y+n*S+r*M;if(P===0)return this.set(0,0,0,0,0,0,0,0,0);const D=1/P;return e[0]=y*D,e[1]=(r*f-m*n)*D,e[2]=(u*n-r*a)*D,e[3]=S*D,e[4]=(m*t-r*p)*D,e[5]=(r*o-u*t)*D,e[6]=M*D,e[7]=(n*p-f*t)*D,e[8]=(a*t-n*o)*D,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,r,o,a,u){const p=Math.cos(o),f=Math.sin(o);return this.set(n*p,n*f,-n*(p*a+f*u)+a+e,-r*f,r*p,-r*(-f*a+p*u)+u+t,0,0,1),this}scale(e,t){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){const t=Math.cos(e),n=Math.sin(e),r=this.elements,o=r[0],a=r[3],u=r[6],p=r[1],f=r[4],m=r[7];return r[0]=t*o+n*p,r[3]=t*a+n*f,r[6]=t*u+n*m,r[1]=-n*o+t*p,r[4]=-n*a+t*f,r[7]=-n*u+t*m,this}translate(e,t){const n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){const t=this.elements,n=e.elements;for(let r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}function GC(s){return document.createElementNS("http://www.w3.org/1999/xhtml",s)}let D_;class gI{constructor(e=null){this.isSource=!0,this.uuid=gt(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},r=this.data;if(r!==null){let o;if(Array.isArray(r)){o=[];for(let a=0,u=r.length;a<u;a++)r[a].isDataTexture?o.push(u1(r[a].image)):o.push(u1(r[a]))}else o=u1(r);n.url=o}return t||(e.images[this.uuid]=n),n}}function u1(s){if(typeof HTMLImageElement<"u"&&s instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&s instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&s instanceof ImageBitmap)return class{static getDataURL(e,t=!1){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{D_===void 0&&(D_=GC("canvas")),D_.width=e.width,D_.height=e.height;const r=D_.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=D_}return!t&&(n.width>2048||n.height>2048)?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=GC("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const r=n.getImageData(0,0,e.width,e.height),o=r.data;for(let a=0;a<o.length;a++)o[a]=255*gi(o[a]/255);return n.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(255*gi(t[n]/255)):t[n]=gi(t[n]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}.getDataURL(s);if(s.data){let e=[];try{e=Array.from(s.data)}catch(t){t.message.includes("Invalid array length")?console.warn("Serializing large texture, might not be saved in JSON structure."):console.error(t),e=s.data}return{data:e,width:s.width,height:s.height,type:s.data.constructor.name}}return console.warn("THREE.Texture: Unable to serialize Texture."),{}}let _I=0;class R_ extends class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const n=this._listeners[e];if(n!==void 0){const r=n.indexOf(t);r!==-1&&n.splice(r,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const t=this._listeners[e.type];if(t!==void 0){e.target=this;const n=t.slice(0);for(let r=0,o=n.length;r<o;r++)n[r].call(this,e);e.target=null}}}{constructor(e=R_.DEFAULT_IMAGE,t=R_.DEFAULT_MAPPING,n=1001,r=1001,o=Gi,a=1008,u=1023,p=1009,f=1,m=3e3){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:_I++}),this.uuid=gt(),this.name="",this.source=new gI(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=o,this.minFilter=a,this.anisotropy=f,this.format=u,this.internalFormat=null,this.type=p,this.offset=new St(0,0),this.repeat=new St(1,1),this.center=new St(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new c1,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=m,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case 1e3:e.x=e.x-Math.floor(e.x);break;case 1001:e.x=e.x<0?0:1;break;case 1002:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case 1e3:e.y=e.y-Math.floor(e.y);break;case 1001:e.y=e.y<0?0:1;break;case 1002:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}}R_.DEFAULT_IMAGE=null,R_.DEFAULT_MAPPING=300;var qb=__webpackgi_require__(898),k0={};qb.Z&&qb.Z.locals&&(k0.locals=qb.Z.locals);var h1,d1=0,ym={};ym.styleTagTransform=zv(),ym.setAttributes=jv(),ym.insert=function(s,e){(e.target||document.head).appendChild(s)},ym.domAPI=Ig(),ym.insertStyleElement=Lf(),k0.use=function(s){return ym.options=s||{},d1++||(h1=Uv()(qb.Z,ym)),k0},k0.unuse=function(){d1>0&&!--d1&&(h1(),h1=null)};var vI=k0;class p1 extends VC{constructor(e=!1,t=!1,n=!1,r=document.body){super(e,t,n,!1),this.dependencies=[dn],this._preRender=()=>this.refreshQueue("preRender"),this._postRender=()=>this.refreshQueue("postRender"),this._postFrame=o=>{this.dispatchEvent(o),this.refreshQueue("postFrame")},this._preFrame=()=>this.refreshQueue("preFrame"),this._plugins=[],this.alert=async o=>this._viewer?this._viewer.alert(o):super.alert(o),this.confirm=async o=>this._viewer?this._viewer.confirm(o):super.confirm(o),this.prompt=async(o,a,u=!0)=>this._viewer?this._viewer.prompt(o,a,u):super.prompt(o,a,u),this._pane.registerPlugin(lI),vI.use({target:r})}async onAdded(e){this._viewer=e,this._typeGenerators.image=(t=>(n,r,o,a)=>{const u=r.property,p="placeholder";if(r.value===void 0&&u&&typeof u[0]=="object"){const[f,m]=u,y=f0("Render Target"),S=f0("Data Texture"),M=f0("CUBE Texture"),P=f0("Compressed Texture"),D={},j={};Object.defineProperty(r,"value",{get:()=>{var k;let L,R=f[m];if(R!=null&&R.get&&(R=R.get()),!R)return p;if(R.isRenderTargetTexture&&!R.image.tp_src&&(R.image.tp_src=y),R.isDataTexture&&!R.image.tp_src&&(R.image.tp_src=S),R.isCompressedTexture&&!R.image.tp_src&&(R.image.tp_src=P),R.isTexture?(R.image&&(R.image instanceof ImageBitmap||R.image instanceof HTMLImageElement||R.image instanceof HTMLVideoElement)&&!R.image.tp_src&&(R.image.tp_src=Ic(R.image,160)),R.image&&(L=R.image.tp_src_uuid,L=L?D[L]:void 0,L||(L=R.image.tp_src||R.image.src))):typeof R=="string"?L=R:R.domainMin?(L=R.texture,R.texture.image&&!R.texture.image.tp_src&&(R.texture.image.tp_src=M),R.texture.image&&(L=R.texture.image.tp_src_uuid,L=L?D[L]:void 0,L||(L=R.texture.image.tp_src||R.texture.image.src))):R&&console.error("unknown value",R),L||(L=p),R.image&&!R.image.tp_src_uuid){const W=ki();R.image.tp_src_uuid=W,j[L]=W}return typeof L=="string"&&(L=(k=D[L])!==null&&k!==void 0?k:L),L},set:k=>{var L,R,W,q,J,ee,he,xe,De,Fe,ke;const Qe=f[m],Oe=$e=>{var Ge;f[m]=$e,$e!=null&&$e.isTexture&&($e.flipY=$e.isDataTexture?$e.flipY:(Ge=Qe==null?void 0:Qe.flipY)===null||Ge===void 0||Ge)};if(typeof k=="string")return void(typeof Qe=="string"&&Oe(k));if(!k)return void(r.value=p);if(k.isPlaceholder)return void(Qe&&(Oe(typeof Qe=="string"?"":null),typeof(f==null?void 0:f.setDirty)=="function"&&f.setDirty()));let ze=k.tp_src_uuid;if(ze||(ze=(L=k.src)!==null&&L!==void 0?L:k.tp_src,ze=(R=j[ze])!==null&&R!==void 0?R:ze,delete j[ze],k.tp_src_uuid=ze),ze&&(D[ze]=k),typeof Qe!="string"){if(!((Qe==null?void 0:Qe.image)===k||((W=Qe==null?void 0:Qe.image)===null||W===void 0?void 0:W.src)===k.src||((q=Qe==null?void 0:Qe.image)===null||q===void 0?void 0:q.tp_src)===k.tp_src&&k.tp_src!=null||((J=Qe==null?void 0:Qe.image)===null||J===void 0?void 0:J.tp_src)===k.src&&k.src!=null||((ee=Qe==null?void 0:Qe.image)===null||ee===void 0?void 0:ee.src)===k.tp_src&&k.tp_src!=null))if(k instanceof File){const $e=t==null?void 0:t.getPlugin(dn);if(!$e)throw"Viewer or AssetManagerPlugin not found";(he=$e.importer)===null||he===void 0||he.importSingle({file:k,path:k.src}).then(Ge=>{var ot,yt,Mt,pt;if(Ge){Ge.isDataTexture&&(Ge.needsUpdate=!0);const Qt=(Mt=(yt=(ot=k.src)===null||ot===void 0?void 0:ot.split("?"))===null||yt===void 0?void 0:yt[0])===null||Mt===void 0?void 0:Mt.split(".").pop();Ge.userData&&(Ge.userData.mimeType||(Ge.userData.mimeType="image/"+(["jpg","jpeg"].includes(Qt)?"jpeg":"png"))),Oe(Ge),[r.onChange].flat().forEach(Kt=>typeof Kt=="function"&&(Kt==null?void 0:Kt())),typeof(f==null?void 0:f.setDirty)=="function"&&f.setDirty(),(pt=r.uiRefresh)===null||pt===void 0||pt.call(r,"postFrame",!1)}})}else{const $e=new R_(k);$e.assetType="texture",$e.needsUpdate=!0;const Ge=(Fe=(De=(xe=k.src)===null||xe===void 0?void 0:xe.split("?"))===null||De===void 0?void 0:De[0])===null||Fe===void 0?void 0:Fe.split(".").pop();$e.userData.mimeType||($e.userData.mimeType="image/"+(["jpg","jpeg"].includes(Ge)?"jpeg":"png")),Oe($e);const ot=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(m);$e.encoding=ot?c.rnI:c.knz,$e.wrapS=c.rpg,$e.wrapT=c.rpg,[r.onChange].flat().forEach(yt=>typeof yt=="function"&&(yt==null?void 0:yt())),typeof(f==null?void 0:f.setDirty)=="function"&&f.setDirty(),(ke=r.uiRefresh)===null||ke===void 0||ke.call(r,"postFrame",!1)}}else Oe(ze)}}),r.property=void 0,r.label===void 0&&(r.label=m)}return(a=a??{}).extensions=[".jpg",".png",".svg",".hdr",".exr",".jpeg",".bmp",".gif",".webp",".cube"],a.imageFit===void 0&&(a.imageFit="contain"),a.clickCallback===void 0&&(a.clickCallback=(f,m)=>{var y;const S=f==null?void 0:f.target,M=S==null?void 0:S.getBoundingClientRect();if(!M)return void m.click();const P=r.uiRef.controller_.valueController.value.rawValue,D=P===p||P!=null&&P.isPlaceholder?{}:{"remove image":()=>{var k;r.uiRef.controller_.valueController.value.setRawValue("");const[L,R]=u||[r,"value"],W=typeof L[R]=="string";L[R]=W?"":null,[r.onChange].flat().forEach(q=>typeof q=="function"&&(q==null?void 0:q())),typeof(L==null?void 0:L.setDirty)=="function"&&L.setDirty(),(k=r.uiRefresh)===null||k===void 0||k.call(r,"postFrame",!1),xc.Remove()},"download image":()=>{var k,L,R;const[W,q]=u||[r,"value"];let J=(L=(k=W[q])===null||k===void 0?void 0:k.image)!==null&&L!==void 0?L:r.uiRef.controller_.valueController.value.rawValue;J&&(J instanceof ImageBitmap||J instanceof HTMLImageElement||J instanceof HTMLVideoElement)&&!J.src&&(J=Ic(J));const ee=document.createElement("a");document.body.appendChild(ee),ee.style.display="none",ee.href=(R=J==null?void 0:J.src)!==null&&R!==void 0?R:J,ee.download="image.png",ee.click(),document.body.removeChild(ee),xc.Remove()}},j=xc.Create({...D,"set/replace image":()=>{m.click(),xc.Remove()},"from url":async()=>{var k,L;let R="";if(R&&(R.startsWith("http")||R.startsWith("data:image"))||(R=""),R=await o.prompt("Load texture: Enter Image/Texture URL",R,!0),!R||!R.startsWith("http")&&!R.startsWith("data:image"))return R!==null&&await o.alert("Loading Image: Invalid URL"),void xc.Remove();const[W,q]=u||[r,"value"],J=W[q];if(typeof J=="string")W[q]=R,[r.onChange].flat().forEach(ee=>typeof ee=="function"&&(ee==null?void 0:ee())),typeof(W==null?void 0:W.setDirty)=="function"&&W.setDirty(),(k=r.uiRefresh)===null||k===void 0||k.call(r,"postFrame",!1);else{const ee=t==null?void 0:t.getPlugin(dn);if(!ee)throw"Viewer or AssetManagerPlugin not found";(L=ee.importer)===null||L===void 0||L.importSinglePath(R).then(he=>{var xe;if(he){he.isDataTexture?he.needsUpdate=!0:he&&(J==null?void 0:J.flipY)!==void 0&&(he.flipY=J.flipY),W[q]=he;const De=["normalMap","aoMap","emissiveMap","roughnessMap","metalnessMap","displacementMap","bumpMap","alphaMap"].includes(q);he.encoding=De?c.rnI:c.knz,[r.onChange].flat().forEach(Fe=>typeof Fe=="function"&&(Fe==null?void 0:Fe())),typeof(W==null?void 0:W.setDirty)=="function"&&W.setDirty(),(xe=r.uiRefresh)===null||xe===void 0||xe.call(r,"postFrame",!1)}})}xc.Remove()},cancel:()=>{xc.Remove()}},2,M.height+8);(y=S.parentElement)===null||y===void 0||y.appendChild(j),M.y>.7*document.body.clientHeight&&(j.style.top="auto",j.style.bottom=M.height+8+"px")}),a.view="input-image",Ch(n,r,o,a)})(this._viewer),e.addEventListener("preRender",this._preRender),e.addEventListener("postRender",this._postRender),e.addEventListener("preFrame",this._preFrame),e.addEventListener("postFrame",this._postFrame)}async onDispose(e){this.dispose()}async onRemove(e){this._viewer=void 0,e.removeEventListener("preRender",this._preRender),e.removeEventListener("postRender",this._postRender),e.removeEventListener("preFrame",this._preFrame),e.removeEventListener("postFrame",this._postFrame),this.dispose()}setupPluginUi(e){var t;const n=(t=this._viewer)===null||t===void 0?void 0:t.getPlugin(e);if(!n)return void console.warn("plugin not found:",e);this._plugins.push(n),n.uiConfig&&(n.uiConfig.limitedUi=!0),n.uiConfig&&n.uiConfig.hidden===void 0&&(n.uiConfig.hidden=!1),this._appendUiObject(n);const r=n.uiConfig;if(r!=null&&r.uiRef&&n.toJSON){const o=r.uiRef.controller_.view.element,a=Cr({innerHTML:"&#8942;",classList:["pluginOptionsButton"],elementTag:"button"});a.onclick=u=>{const p={};typeof n.toJSON=="function"&&(p["download preset"]=async()=>{var m,y;const S=(y=(m=this._viewer)===null||m===void 0?void 0:m.getPlugin(dn))===null||y===void 0?void 0:y.exportPluginPreset(n);await Ss(new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),"preset."+n.constructor.PluginType+".json"),xc.Remove()}),typeof n.fromJSON=="function"&&(p["upload preset"]=async()=>{var m,y;xc.Remove();const S=await Tc(!1,!1);if(S.length===0)return;const M=S[0],P=await M.text(),D=JSON.parse(P);await((y=(m=this._viewer)===null||m===void 0?void 0:m.getPlugin(dn))===null||y===void 0?void 0:y.importPluginPreset(D,n))});const f=xc.Create(p,o.clientWidth-120,12);o.append(f),u.preventDefault()},o.appendChild(a)}return r}setupPlugins(...e){e.forEach(t=>this.setupPluginUi(t))}refreshPluginsEnabled(){this._plugins.forEach(e=>{var t;const n=e.uiConfig;n&&(Se(n.hidden)!==!0?(t=n.uiRefresh)===null||t===void 0||t.call(n,"postFrame",!0):n.uiRef&&(n.uiRef.hidden=!0))})}}p1.PluginType="TweakpaneUi";class Yb extends ui{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this.bgUIConfig={label:"Color",type:"color",inlinePicker:!0,onChange:()=>{if(!this._viewer)return;const e=new Sn(this.bgUIConfig.value||16777215).convertSRGBToLinear();this._viewer.setBackground(e.getHex())},expanded:!0,limitedUi:!0},this.uiConfig={label:"Background / Environment",type:"folder",expanded:!1,limitedUi:!0,children:[this.bgUIConfig,{label:"Image",property:[this,"sceneBackground"],type:"image",limitedUi:!0},{label:"EnvMap BG",type:"checkbox",property:[this,"envmapBg"]},()=>({type:"slider",label:"BG Intensity",property:[this._viewer,"backgroundIntensity"],bounds:[0,16]}),{label:"Set Transparent BG",type:"button",hidden:()=>!this._viewer||this._viewer.useRgbm,value:()=>{var e;(e=this._viewer)===null||e===void 0||e.setBackground(null)}},{label:"Environment",property:[this,"sceneEnvironment"],type:"image",limitedUi:!0},{type:"slider",label:"Env Rotation",property:[this,"sceneEnvironmentRotation"],bounds:[0,2*Math.PI],limitedUi:!0},{type:"slider",label:"Env Intensity",property:[this,"sceneEnvironmentIntensity"],bounds:[0,4],limitedUi:!0}]}}get sceneBackground(){var e;const t=(e=this._viewer)===null||e===void 0?void 0:e.getBackground();return t&&(t.isTexture||t.assetType==="texture")?t:null}set sceneBackground(e){var t,n;e?(t=this._viewer)===null||t===void 0||t.setBackground(e):(n=this._viewer)===null||n===void 0||n.setBackground(this.bgUIConfig.value)}get sceneEnvironment(){var e;return(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment()}set sceneEnvironment(e){var t;(t=this._viewer)===null||t===void 0||t.scene.setEnvironment(e)}get sceneEnvironmentRotation(){var e,t,n;return(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.getEnvironment())===null||t===void 0?void 0:t.rotation)!==null&&n!==void 0?n:0}set sceneEnvironmentRotation(e){var t,n;const r=(t=this._viewer)===null||t===void 0?void 0:t.scene.getEnvironment();r&&(r.rotation=e,(n=this._viewer)===null||n===void 0||n.scene.setDirty())}get sceneEnvironmentIntensity(){var e,t;return(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.envMapIntensity)!==null&&t!==void 0?t:1}set sceneEnvironmentIntensity(e){var t;!((t=this._viewer)===null||t===void 0)&&t.scene&&(this._viewer.scene.envMapIntensity=e)}get envmapBg(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.getBackground(!0))===El}set envmapBg(e){if(this._viewer)if(e){const t=this._viewer.getBackground(!0);t&&t!==El&&(this.lastBgVal=t),this._viewer.setBackground(El)}else this._viewer.getBackground()===this._viewer.scene.getEnvironment()&&this._viewer.setBackground(this.lastBgVal||this.bgUIConfig.value)}async onAdded(e){var t;await super.onAdded(e);const n=e.getBackground();this.bgUIConfig.value=typeof n=="string"&&n!==El||typeof n=="number"||!((t=n)===null||t===void 0)&&t.isColor?"#"+new Sn(n).getHexString():"#000000",this.lastBgVal=n}}Yb.PluginType="SimpleBackgroundEnvUiPlugin1";class Xb extends ui{constructor(){super(),this.enabled=!0,this.toJSON=void 0,this._uiConfig={type:"folder",label:"Scene Objects",children:[],onExpand:()=>{var e,t;(t=(e=this._uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}},this._clearSceneButton={type:"button",label:"Clear Scene",value:()=>{var e;(e=this._viewer)===null||e===void 0||e.scene.disposeSceneModels()}},this._sceneUpdate=this._sceneUpdate.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}setDirty(){var e;(e=this._viewer)===null||e===void 0||e.setDirty()}get uiConfig(){var e,t,n;return this._viewer?(this._uiConfig.children=[this._clearSceneButton],this._uiConfig.children.push(...(n=(t=(e=this._viewer)===null||e===void 0?void 0:e.scene.modelRoot.modelObject.children)===null||t===void 0?void 0:t.map(r=>r.assetType==="light"?null:r.uiConfig).filter(r=>r!=null))!==null&&n!==void 0?n:[]),this._uiConfig):this._uiConfig}_sceneUpdate(){var e,t;(t=(e=this._uiConfig)===null||e===void 0?void 0:e.uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0)}}Xb.PluginType="SimpleUi";var AI=__webpackgi_require__(1),yI=__webpackgi_require__.n(AI)();class Kb extends ui{constructor(e=!0){super(),this.enabled=!0,this.toJSON=void 0,this.treeView=void 0,this.hierarchyDiv=Cr({innerHTML:"",id:"tpHierarchyContainer",addToBody:!1}),this._uiConfig={type:"folder",label:"Hierarchy",children:[]},this._buildData=(t,n)=>(t.push({text:n.name||"unnamed",id:n.uuid,children:n.children.reduce(this._buildData,[])}),t),this._findVisible=(t,n)=>(n.visible&&(n.children.length<1?t.push(n.uuid):t.push(...n.children.reduce(this._findVisible,[]))),t),this._setVisible=t=>{var n,r,o;const a=(n=this._viewer)===null||n===void 0?void 0:n.scene.modelRoot;if(!a||t==null)return;const u=new Set;a.traverse(p=>{p!==a&&(p.visible=t.includes(p.uuid),p.visible&&p.traverseAncestors(f=>u.add(f)))}),u.forEach(p=>p.visible=!0),(o=(r=this._viewer)===null||r===void 0?void 0:r.scene)===null||o===void 0||o.setDirty({sceneUpdate:!0,fromHierarchyPlugin:!0,updateGround:!1})},this.enabled=e,this.reset=this.reset.bind(this),ql(se`
#tpHierarchyContainer{
  width: 100%;
  height: auto;
  background-color: transparent;
  color: #e9e9ed;
  margin-top: 0;
}
`)}reset(e){var t;if(e!=null&&e.fromHierarchyPlugin||!(e!=null&&e.hierarchyChanged))return;for(;this.hierarchyDiv.firstChild;)this.hierarchyDiv.firstChild.remove();const n=(t=this._viewer)===null||t===void 0?void 0:t.scene.modelRoot;if(!n)return;const r=n.children.reduce(this._buildData,[]),o=n.children.reduce(this._findVisible,[]);let a=!1;return new Promise((u,p)=>{this.treeView=new yI(this.hierarchyDiv,{closeDepth:1,data:r,loaded:function(){this.values=o,u()},onChange:()=>{a?is(200).then(()=>{this.treeView&&this._setVisible(this.treeView.values)}):a=!0},onItemLabelClick:f=>{var m;const y=(m=this._viewer)===null||m===void 0?void 0:m.scene.modelRoot.modelObject.getObjectByProperty("uuid",f);y&&n.visible&&y.dispatchEvent({type:"select",value:y,ui:!0})}})})}async onAdded(e){await super.onAdded(e),this.reset(),e.scene.addEventListener("sceneUpdate",this.reset)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this.reset),super.onRemove(e)}async onDispose(e){return super.onDispose(e)}get uiConfig(){return this._uiConfig.domChildren||(this._uiConfig.domChildren=[this.hierarchyDiv]),this._uiConfig}}Kb.PluginType="HierarchyUiPlugin";class Jb extends ui{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Lights",children:[{type:"button",label:"Add Directional Light",value:()=>{if(!this._viewer)return;const e=new sc;e.position.set(0,0,0),e.target.position.set(0,0,-1).normalize(),e.intensity=2,e.shadow.mapSize.set(1024,1024),this._viewer.scene.addLight(e)}}],limitedUi:!0},this.dependencies=[dn],this._sceneUpdate=e=>{var t,n,r;if(!e.hierarchyChanged)return;const o=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(a=>{if(!a.lightObject)return;const u=a.uiConfig;u&&!o.includes(u)&&o.push(u)}),[...this.uiConfig.children].forEach(a=>{var u;((u=a)===null||u===void 0?void 0:u.type)==="button"||o.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),o.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}Jb.PluginType="SimpleLightsUi";class $b extends ui{constructor(){super(),this.toJSON=void 0,this.enabled=!0,this.uiConfig={type:"folder",label:"Cameras (Loaded)",children:[{type:"button",label:"Add Camera",hidden:!0}],limitedUi:!0},this.dependencies=[dn],this._sceneUpdate=e=>{var t,n,r;if(!e.hierarchyChanged)return;const o=[];(t=this._viewer)===null||t===void 0||t.traverseSceneObjects(a=>{if(!a.cameraObject)return;const u=a.uiConfig;u&&!o.includes(u)&&o.push(u)}),[...this.uiConfig.children].forEach(a=>{var u;((u=a)===null||u===void 0?void 0:u.type)==="button"||o.includes(a)||this.uiConfig.children.splice(this.uiConfig.children.indexOf(a),1)}),o.forEach(a=>{this.uiConfig.children.includes(a)||this.uiConfig.children.push(a)}),(r=(n=this.uiConfig).uiRefresh)===null||r===void 0||r.call(n,"postFrame",!0)}}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("sceneUpdate",this._sceneUpdate)}async onRemove(e){return e.scene.removeEventListener("sceneUpdate",this._sceneUpdate),super.onRemove(e)}}$b.PluginType="SimpleSceneCamerasUi";var O0,Zb=function(s,e,t,n){var r,o=arguments.length,a=o<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")a=Reflect.decorate(s,e,t,n);else for(var u=s.length-1;u>=0;u--)(r=s[u])&&(a=(o<3?r(a):o>3?r(e,t,a):r(e,t))||a);return o>3&&a&&Object.defineProperty(e,t,a),a};let md=O0=class extends ui{constructor(){super(),this.enabled=!0,this.width=0,this.height=0,this.scale=1,this._sizeChanged=this._sizeChanged.bind(this),this._refresh=this._refresh.bind(this)}refreshSize(){this._sizeChanged()}_sizeChanged(){var s;if(!this._viewer)return;const e={width:Math.round(this.width),height:Math.round(this.height)},t=this._viewer.container.getBoundingClientRect();e.width>=t.width&&delete e.width,e.height>=t.height&&delete e.height,(s=this._viewer)===null||s===void 0||s.setSize(e),this._viewer.renderer.displayCanvasScaling=this.scale}async onAdded(s){await super.onAdded(s);const e=s.canvas.clientWidth,t=s.canvas.clientHeight,n=s.renderer.displayCanvasScaling;this.width=e,this.height=t,this.scale=n,s.renderer.addEventListener("resize",this._refresh),this.addEventListener("deserialize",this._sizeChanged),this._refresh()}async onRemove(s){return this.removeEventListener("deserialize",this._sizeChanged),s.renderer.removeEventListener("resize",this._refresh),super.onRemove(s)}_refresh(){var s,e;(e=(s=this.uiConfig)===null||s===void 0?void 0:s.uiRefresh)===null||e===void 0||e.call(s,"postFrame",!0)}};md.PluginType="RendererParamsUiPlugin",Zb([et(),we(O0.prototype._sizeChanged),wn("Width",void 0,1,s=>({bounds:()=>{var e;return[10,((e=s._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().width)||1024]}}))],md.prototype,"width",void 0),Zb([et(),we(O0.prototype._sizeChanged),wn("Height",void 0,1,s=>({bounds:()=>{var e;return[10,((e=s._viewer)===null||e===void 0?void 0:e.container.getBoundingClientRect().height)||1024]}}))],md.prototype,"height",void 0),Zb([et(),we(O0.prototype._sizeChanged),wn("Scale",[.25,4],.25,{limitedUi:!0})],md.prototype,"scale",void 0),md=O0=Zb([Ci("Renderer")],md);class ew extends ui{constructor(){super(),this.enabled=!0,this.serializeWithViewer=!1,this._refresh=this._refresh.bind(this)}async onAdded(e){await super.onAdded(e),e.scene.addEventListener("activeCameraChange",this._refresh),e.scene.addEventListener("sceneUpdate",this._refresh)}async onRemove(e){return e.scene.removeEventListener("activeCameraChange",this._refresh),e.scene.removeEventListener("sceneUpdate",this._refresh),super.onRemove(e)}toJSON(e){var t;const n=super.toJSON(e);return n.activeCamera=(t=this._viewer)===null||t===void 0?void 0:t.scene.activeCamera.toJSON(),n}fromJSON(e,t){var n;return e.activeCamera&&((n=this._viewer)===null||n===void 0||n.scene.activeCamera.fromJSON(e.activeCamera),delete(e={...e}).activeCamera),super.fromJSON(e,t)}_refresh(){var e,t;this._viewer&&((t=(e=this.uiConfig).uiRefresh)===null||t===void 0||t.call(e,"postFrame",!0))}get uiConfig(){var e;return((e=this._viewer)===null||e===void 0?void 0:e.scene.activeCamera.uiConfig)||{}}}ew.PluginType="CameraUiPlugin";var bI={create:s=>{let e="button"+(s.type?" "+s.type:""),t=ni.createDiv(e,s.text);return t.addEventListener("click",s.onClick),t}};let Ua={createElement:(s,e,t,n)=>{let r=document.createElement(s);if(e&&(r.className=e),t&&(r.innerHTML=t),n)for(let o in n)r.setAttribute(o,n[o]);return r},createDiv:(s,e,t)=>Ua.createElement("div",s,e,t),createDomTree:s=>{if(!s||!s.hasOwnProperty("dom"))return s;let e=s.dom;if(s.children)for(let t in s.children)s.children[t]&&e.appendChild(Ua.createDomTree(s.children[t]));return e},removeElement:s=>{s!=null&&s.parentNode.removeChild(s)},appendToBody:s=>{document.body.appendChild(s)},makeIconHTML:s=>{let e="";return s=="ok"&&(e="#tick"),s=="error"&&(e="#cancel"),s=="info"&&(e="#info-button"),s=="caution"&&(e="#danger"),s=="min"&&(e="#line"),s=="close"&&(e="#close"),`<svg class="icon ${s}"><use xlink:href="${e}" /></svg>`},makeNftContent:s=>{let e=null;if(s.type){let t=null;t=typeof s.content=="string"?Ua.createDiv("inner-content",s.content):Ua.createDomTree({dom:Ua.createDiv("inner-content"),children:[s.content]}),e=s.type=="text"?Ua.createDomTree({dom:Ua.createDiv("content text"),children:[t]}):Ua.createDomTree({dom:Ua.createDiv("content"),children:[Ua.createDiv("state",Ua.makeIconHTML(s.type)),t]})}else typeof s.content=="string"&&(e=Ua.createDiv("content",s.content));return e},standardizeButtons:(s,e)=>{let t=[];if(e.buttons===void 0)return e.type!="caution"&&e.type!="info"||t.push({key:27,text:"Cancel",onClick:s.close.bind(s,"cancel")}),t.push({key:13,text:"OK",type:"main",onClick:s.close.bind(s,"ok")}),t;t=e.buttons,t.constructor!==Array&&(t=[t]);for(let n in t)!t[n].onClick&&(t[n].onClick=s.close.bind(s,t[n].id));return t},makeButtons:s=>{let e=[];if(s)for(let t in s)e.push(bI.create({text:s[t].text?s[t].text:"OK",type:s[t].normal?null:"main",onClick:s[t].onClick}));return Ua.createDomTree({dom:Ua.createDiv("button-wrapper"),children:e})},bindButtonKeyEvents:s=>{let e=t=>{for(let n in s)if(s[n].key===t.keyCode)return void s[n].onClick()};return window.addEventListener("keydown",e),e},unbindButtonKeyEvents:s=>{window.removeEventListener("keydown",s)}};var ni=Ua,zs=__webpackgi_require__(476),Ho={"wwise-overlay-in-1":{opacity:"0"},"wwise-overlay-in-2":{opacity:"1"},"wwise-overlay-out-1":{opacity:"0"},"wwise-pop-in-1":{transform:"scale(0.5, 0.5)","margin-top":"50px",opacity:".5"},"wwise-pop-in-2":{transform:"scale(1, 1)","margin-top":"0",opacity:"1"},"wwise-pop-in-3":{transform:"scale(1.05, 1.05)"},"wwise-pop-in-4":{transform:"scale(1, 1)"},"wwise-pop-out-1":{transform:"scale(0.25, 0.25)","margin-top":"50px",opacity:"0"},"wwise-flip-in-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:".2"},"wwise-flip-in-2":{transform:"none",opacity:"1"},"wwise-flip-out-1":{transform:"rotateX(60deg) scaleX(.5)",opacity:"0"},"wwise-top-in-1":{transform:"translateY(-30vh)",opacity:".5"},"wwise-top-in-2":{transform:"none",opacity:"1"},"wwise-top-out-1":{transform:"translateY(-30vh)",opacity:"0"},"wwise-bottom-in-1":{transform:"translateY(30vh)",opacity:".5"},"wwise-bottom-in-2":{transform:"none",opacity:"1"},"wwise-bottom-out-1":{transform:"translateY(30vh)",opacity:"0"},"wwise-left-in-1":{transform:"translateX(-30vw)",opacity:".5"},"wwise-left-in-2":{transform:"none",opacity:"1"},"wwise-left-out-1":{transform:"translateX(-30vw)",opacity:"0"},"wwise-right-in-1":{transform:"translateX(30vw)",opacity:".5"},"wwise-right-in-2":{transform:"none",opacity:"1"},"wwise-right-out-1":{transform:"translateX(30vw)",opacity:"0"},"wwise-min-in-1":{"margin-top":"0",transform:"rotateX(-60deg) scale(0.2, 1.8) translateY(80vh)",opacity:".2"},"wwise-min-in-2":{transform:"none",opacity:"1"},"wwise-min-out-1":{"margin-top":"30vh",transform:"rotateX(-60deg) scale(0.05, 2) translateY(30vh)",opacity:"0"}};let xu={};xu.overlay_in=[new zs.Frame(Ho["wwise-overlay-in-1"],0),new zs.Frame(Ho["wwise-overlay-in-2"],400)],xu.overlay_out=[new zs.Frame(Ho["wwise-overlay-out-1"],300)],xu.pop_in=[new zs.Frame(Ho["wwise-pop-in-1"],0),new zs.Frame(Ho["wwise-pop-in-2"],{duration:200,"timing-function":"ease-in"}),new zs.Frame(Ho["wwise-pop-in-3"],{duration:100,"timing-function":"linear"}),new zs.Frame(Ho["wwise-pop-in-4"],{duration:100,"timing-function":"linear"})],xu.pop_out=[new zs.Frame(Ho["wwise-pop-out-1"],{duration:250,"timing-function":"ease-in"})],xu.flip_in=[new zs.Frame(Ho["wwise-flip-in-1"],0),new zs.Frame(Ho["wwise-flip-in-2"],500)],xu.flip_out=[new zs.Frame(Ho["wwise-flip-out-1"],400)],xu.min_in=[new zs.Frame(Ho["wwise-min-in-1"],0),new zs.Frame(Ho["wwise-min-in-2"],350)],xu.min_out=[new zs.Frame(Ho["wwise-min-out-1"],400)];let QC=["top","bottom","left","right"];for(let s in QC){let e=QC[s];xu[e+"_in"]=[new zs.Frame(Ho["wwise-"+e+"-in-1"],0),new zs.Frame(Ho["wwise-"+e+"-in-2"],{duration:400,"timing-function":"ease-out"})],xu[e+"_out"]=[new zs.Frame(Ho["wwise-"+e+"-out-1"],{duration:400,"timing-function":"ease-in"})]}var tw=xu;let wI={animation:"pop",topbar:{showClose:!0,showMin:!1},keepOverlay:!1,position:"center",overlay:!1,clickOverlayToClose:!0,removeBackground:!1,noRadius:!1,zIndex:null};class f1{static create(e,t){let n=e.getElementsByClassName("title")[0];n&&(n=n.innerHTML);let r=e.getElementsByClassName("content")[0];return r&&(r=r.innerHTML),ni.removeElement(e),t.title=n,t.content=r,new f1(t)}constructor(e){this.options=JSON.parse(JSON.stringify(wI));for(let p in e)e[p]!=null&&(this.options[p]=e[p]);let t=this.options.position;if(t.indexOf(" ")==-1&&(t=="left"||t=="right"?t+=" center":t=t=="top"||t=="bottom"?"center "+t:t+" "+t),this.options.position=t,this.options.overlay){let p=document.getElementsByClassName("wwise-overlay");p.length?(this.overlay=p[0],this.hasOverlay=!0):(this.overlay=ni.createDiv("wwise-overlay"),this.options.zIndex&&(this.overlay.style.zIndex=this.options.zIndex)),this.overlayClickHandler=this.close.bind(this,void 0)}else this.options.clickOverlayToClose=!1;let n="content";if(this.options.topbar){let p=[];this.options.topbar.showMin&&(p.push(ni.createDiv(null,ni.makeIconHTML("min"))),p[p.length-1].addEventListener("click",this.min.bind(this))),this.options.topbar.showClose&&(p.push(ni.createDiv(null,ni.makeIconHTML("close"))),p[p.length-1].addEventListener("click",this.close.bind(this,void 0)));let f=null;f=typeof this.options.title=="string"?ni.createDiv("title",this.options.title):ni.createDomTree({dom:ni.createDiv("title"),children:[this.options.title]}),this.topbar=ni.createDomTree({dom:ni.createDiv("topbar"),children:[{dom:ni.createDiv("control"),children:p.map(m=>({dom:m}))},{dom:f},{dom:ni.createDiv("clear")}]})}else n+=" no-topbar";typeof this.options.content=="string"?this.content=ni.createDomTree({dom:ni.createDiv(n,this.options.content)}):this.content=ni.createDomTree({dom:ni.createDiv(n),children:[this.options.content]}),this.options.removeBackground&&(this.content.style.background="initial"),this.window=ni.createDomTree({dom:ni.createDiv("wwise"+(this.options.noRadius?" no-radius":"")),children:[this.topbar,this.content]});let r=ni.createDiv("wwise-wrapper");this.options.zIndex&&(r.style.zIndex=this.options.zIndex),this.wrapper=ni.createDomTree({dom:r,children:[this.window]}),this.dom=ni.createDomTree({dom:ni.createDiv(),children:[this.wrapper]});let o=this.options.position.split(" "),a=-50,u=-50;if(o[0]=="left"?(a=0,this.wrapper.classList.add("left")):o[0]=="right"?(a=-100,this.wrapper.classList.add("right")):o[0]=="center"?this.wrapper.classList.add("h-center"):this.wrapper.style.left=o[0],o[1]=="top"?(u=0,this.wrapper.classList.add("top")):o[1]=="bottom"?(u=-100,this.wrapper.classList.add("bottom")):o[1]=="center"?this.wrapper.classList.add("v-center"):this.wrapper.style.top=t[1],this.window.style.transform=`translate(${a}%, ${u}%)`,this.options.style)for(let p in this.options.style)this.window.style[p]=this.options.style[p];this.options.margin&&(this.wrapper.style.margin=this.options.margin),this.options.draggable&&this.draggable()}open(e){if(this.opened)return;this.promise=new Promise(n=>{this.promiseResolve=n}),this.appendDoms(),this.opened=!0,this.options.clickOverlayToClose&&(this.overlay.addEventListener("click",this.overlayClickHandler),this.overlay.addEventListener("touchstart",this.overlayClickHandler));let t=e?"min":this.options.animation;if(t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new zs.Queue(this.wrapper,tw[t+"_in"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.hasOverlay&&n.push(new zs.Queue(this.overlay,tw.overlay_in,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.dom.classList.remove("wwise-perspective")})}return Promise.resolve()}close(e){if(!this.opened)return;this.opened=!1;let t=e?"min":this.options.animation;if(this.overlay&&(this.overlay.removeEventListener("click",this.overlayClickHandler),this.overlay.removeEventListener("touchstart",this.overlayClickHandler)),t){t!="min"&&t!="flip"||this.dom.classList.add("wwise-perspective");let n=[new zs.Queue(this.wrapper,tw[t+"_out"],{instant:!0,applyOnEnd:!0}).getPromise()];return this.options.overlay&&!this.options.keepOverlay&&n.push(new zs.Queue(this.overlay,tw.overlay_out,{instant:!0,applyOnEnd:!0}).getPromise()),Promise.all(n).then(()=>{this.removeDoms(),this.dom.classList.remove("wwise-perspective"),this.promiseResolve()})}return this.removeDoms(),this.promiseResolve(),Promise.resolve()}min(){return this.close(!0)}resume(){return this.open(!0)}getPromise(){return this.promise}appendDoms(){this.options.overlay&&!this.hasOverlay&&(ni.appendToBody(this.overlay),document.body.classList.add("wwise-no-scroll"),this.overlay.addEventListener("touchstart",e=>{e.preventDefault()})),ni.appendToBody(this.dom)}removeDoms(){ni.removeElement(this.dom),!this.options.keepOverlay&&this.overlay&&(ni.removeElement(this.overlay),document.body.classList.remove("wwise-no-scroll"))}draggable(e=!0){this.topbar&&(e?(this.draggableMouseMoveHandler=this.handleDraggableMouseMove.bind(this),this.draggableMouseDownHandler=this.handleDraggableMouseDown.bind(this),this.draggableMouseUpHandler=this.handleDraggableMouseUp.bind(this),this.draggableMouseOutHandler=this.handleDraggableMouseOut.bind(this),window.addEventListener("mousemove",this.draggableMouseMoveHandler),window.addEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.addEventListener("mousedown",this.draggableMouseDownHandler),window.addEventListener("mouseup",this.draggableMouseUpHandler)):(window.removeEventListener("mousemove",this.draggableMouseMoveHandler),window.removeEventListener("mouseout",this.draggableMouseOutHandler),this.topbar.removeEventListener("mousedown",this.draggableMouseDownHandler),window.removeEventListener("mouseup",this.draggableMouseUpHandler)))}handleDraggableMouseMove(e){if(this.inDragging){let t={x:e.clientX-this.dragPrev.x,y:e.clientY-this.dragPrev.y},n=window.getComputedStyle(this.wrapper),r=this.options.draggable,o=parseFloat(n.left),a=parseFloat(n.top);if(n.left.indexOf("%")!=-1){o=n.left,o=o.substr(0,o.length-1),o=parseInt(o);let u=window,p=document,f=p.documentElement,m=p.getElementsByTagName("body")[0];o=o*(u.innerWidth||f.clientWidth||m.clientWidth)/100}if(n.top.indexOf("%")!=-1){a=n.top,a=a.substr(0,a.length-1),a=parseInt(a);let u=window,p=document,f=p.documentElement,m=p.getElementsByTagName("body")[0];a=a*(u.innerHeight||f.clientHeight||m.clientHeight)/100}r!=1&&r!="horizontal"||(this.wrapper.style.left=o+t.x+"px"),r!=1&&r!="vertical"||(this.wrapper.style.top=a+t.y+"px"),this.dragPrev={x:e.clientX,y:e.clientY}}}handleDraggableMouseDown(e){this.inDragging=!0,this.dragPrev={x:e.clientX,y:e.clientY}}handleDraggableMouseUp(e){this.inDragging=!1}handleDraggableMouseOut(e){let t=e.relatedTarget;t&&t.nodeName!="HTML"||(this.inDragging=!1)}}var xI=f1,m1=class{constructor(s){let e=this.options=s;!e.type&&(e.type="ok");let t={topbar:!1};t.content=this.constructContent({type:e.type,title:e.title,text:e.text,content:e.content,buttons:e.buttons}),t.overlay=!0,t.keepOverlay=e.keepOverlay,t.clickOverlayToClose=!1,t.animation=e.animation,t.zIndex=e.zIndex,this.wwise=new xI(t)}constructContent(s){let e=ni.createDiv("modal"),t=ni.createDomTree({dom:ni.createDiv("main "+s.type),children:[ni.createDiv(null,ni.makeIconHTML(s.type)),ni.createDiv("title",s.title),ni.createDiv("text",s.text)]});this.buttonArr=ni.standardizeButtons(this,s);let n=ni.makeButtons(this.buttonArr),r=null;s.content&&(r=typeof s.content=="string"?ni.createDiv(null,s.content):s.content);let o=null;return n.innerHTML&&(o=ni.createDomTree({dom:ni.createDiv("operation "+s.type),children:[n]})),r||o||t.classList.add("no-op"),ni.createDomTree({dom:e,children:[t,r,o]})}open(){if(this.wwise.opened)return;let s=this.wwise.open();return this.value=void 0,this.promise=new Promise(e=>{this.promiseResolve=e}),this.wwise.getPromise().then(this.handlePromiseResolve.bind(this)),this.keyHandler=ni.bindButtonKeyEvents(this.buttonArr),this.options.closeAfter&&window.setTimeout(()=>{this.close("timer")},this.options.closeAfter),s}close(s){if(this.wwise.opened)return this.value=s,ni.unbindButtonKeyEvents(this.keyHandler),this.wwise.close()}getPromise(){return this.promise}handlePromiseResolve(){this.promiseResolve(this.value)}};let EI={showCancel:!1,okText:"OK",cancelText:"Cancel",placeholder:"",validator:null},SI={type:"info",keepOverlay:!1,title:"Input",text:"",zIndex:null};var nw=__webpackgi_require__(513),L0={};nw.Z&&nw.Z.locals&&(L0.locals=nw.Z.locals);var g1,_1=0,bm={};bm.styleTagTransform=zv(),bm.setAttributes=jv(),bm.insert=function(s,e){(e.target||document.head).appendChild(s)},bm.domAPI=Ig(),bm.insertStyleElement=Lf(),L0.use=function(s){return bm.options=s||{},_1++||(g1=Uv()(nw.Z,bm)),L0},L0.unuse=function(){_1>0&&!--_1&&(g1(),g1=null)};var CI=L0;class v1 extends ui{constructor(){super(...arguments),this.enabled=!0,this.toJSON=void 0,this._previousMappings={}}async onAdded(e){await super.onAdded(e),this._previousMappings={alert:e.alert,confirm:e.confirm,prompt:e.prompt},ni.appendToBody=t=>{e.container.appendChild(t)},ni.makeIconHTML=t=>"",CI.use({target:e.container}),e.alert=async t=>{const n=t==null?void 0:t.split(":")[0],r=new m1({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n+":",""))||"",buttons:[{key:13,text:"OK",type:"main",id:"ok"}],animation:"overlay"});return r.open(),r.getPromise()},e.confirm=async t=>{const n=t==null?void 0:t.split(":")[0],r=new m1({type:"info",title:n??"&ndsp;",text:(t==null?void 0:t.replace(n||"","").replace(":",""))||"",buttons:[{id:"no",key:27,text:"No",normal:!0},{id:"yes",key:13,text:"Yes"}],animation:"overlay"});return r.open(),await r.getPromise()==="yes"},e.prompt=async(t,n,r=!0)=>{const o=t==null?void 0:t.split(":")[0],a=new class{constructor(u){this.options=JSON.parse(JSON.stringify(EI));for(let y in u)u[y]!=null&&(this.options[y]=u[y]);let p=this.options,f=JSON.parse(JSON.stringify(SI));for(let y in f)p.hasOwnProperty(y)&&(f[y]=p[y]);let m=[];p.showCancel&&m.push({key:27,text:p.cancelText,normal:!0,onClick:this.handleCancel.bind(this)}),m.push({key:13,text:p.okText,onClick:this.handleOk.bind(this)}),f.buttons=m,this.input=ni.createElement("input","input",null,{placeholder:p.placeholder}),this.error=ni.createDiv("error"),f.content=ni.createDomTree({dom:ni.createDiv("input-wrapper"),children:[this.input,this.error]}),this.modal=new m1(f)}handleCancel(){this.close().then(this.promiseReject.bind(this))}handleOk(){this.options.validator?this.options.validator(this.input.value).then(()=>{this.close().then(this.promiseResolve.bind(this,this.input.value))},u=>{this.error.innerText=u}):this.close().then(this.promiseResolve.bind(this,this.input.value))}open(){if(this.modal.wwise.opened)return;let u=this.modal.open();return this.input.value="",this.error.innerText="",this.input.focus(),this.promise=new Promise((p,f)=>{this.promiseResolve=p,this.promiseReject=f}),u}close(){if(this.modal.wwise.opened)return this.modal.close()}getPromise(){return this.promise}}({type:"info",title:o??"&ndsp;",placeholder:n??"",showCancel:r,animation:"overlay",text:(t==null?void 0:t.replace(o||"","").replace(":",""))||""});return a.open(),await a.getPromise().catch(async()=>null)}}async onRemove(e){return e.alert=this._previousMappings.alert,e.confirm=this._previousMappings.confirm,e.prompt=this._previousMappings.prompt,super.onRemove(e)}}v1.PluginType="WindowiseDialogPlugin";var MI=gb({defaultModifiers:[Ax,bx,wx,vb]}),TI=__webpackgi_require__(388),II=__webpackgi_require__.n(TI);function PI(s){const e=[];s.traverse(r=>{r.geometry&&e.push(r)});const t={},n={};e.forEach(r=>{var o;if(!t[r.geometry.uuid]){const p=r.geometry.toJSON().data,f=p?II()({a:p.attributes||{},b:p.index||[]}):"";t[r.geometry.uuid]=f}const a=t[r.geometry.uuid],u=(o=n[a])!==null&&o!==void 0?o:n[a]=[];u.includes(r)||u.push(r)}),Object.values(n).forEach(r=>{if(r.length<2)return;const o=r[0].geometry;r.forEach((a,u)=>{u<1||(a.geometry.dispose(),a.geometry=o)})})}const gd=new c.Pa4,wm=new c.Pa4,iw=new c.Pa4,A1=new c.Pa4,rw=new c.Pa4,B_=new c.Pa4;let y1=1;const DI=new c.Pa4(0,1,0);class RI extends Wl{constructor(e,t){super(e,t),this.targetOffset=new c.Pa4(0,0,0);const n=this.update;this.update=()=>this._update(n)}_update(e){this.target.add(this.targetOffset),gd.copy(this.object.position).sub(this.target),y1=gd.length(),B_.copy(this.target);const t=e();return B_.sub(this.target),gd.copy(this.object.position).sub(this.target),y1/=gd.length(),this.target.add(B_),this.object.position.copy(this.target).add(gd),gd.normalize(),wm.crossVectors(DI,gd).normalize(),iw.crossVectors(gd,wm).normalize(),A1.crossVectors(wm,iw).normalize().negate(),wm.length()>.1&&this.object.up.crossVectors(gd.clone().normalize(),wm),this.enablePan&&(rw.set(0,0,0).addScaledVector(wm,B_.x).addScaledVector(iw,B_.y).addScaledVector(A1,B_.z),this.targetOffset.add(rw),this.targetOffset.multiplyScalar(1/y1)),rw.set(0,0,0).addScaledVector(wm,-this.targetOffset.x).addScaledVector(iw,-this.targetOffset.y).addScaledVector(A1,-this.targetOffset.z),this.object.lookAt(rw.add(this.target)),this.object.updateMatrixWorld(),this.object.isCamera&&this.object.updateProjectionMatrix(),this.target.sub(this.targetOffset),t}}class BI extends iv{constructor(){super(),this.boundingScaleMultiplier=1.2,this._initGeometry(new c.cJO(1,0))}}function b1(s,e){var t,n;const r=Array.from(((t=s.access)!==null&&t!==void 0?t:"").split(".")),o=r.pop();let a=(n=s.targetObject)!==null&&n!==void 0?n:e;if(!o||o.length===0)return{key:void 0,tar:a};if(a=oe(r,a),a&&!(o in a))throw console.error("invalid key",o,a,e,s),"";return{key:o,tar:a}}function w1(s,e,t,n){const{key:r,tar:o}=b1(s,e);return r&&o?pf(o,r,()=>{var a;t&&(!((a=s.updater)===null||a===void 0)&&a.length)&&s.updater.forEach(u=>t[u]()),n==null||n()}):a=>console.warn("Unable to set ",a,r,o,s,e)}async function sw(s,e,t){var n,r,o,a;const{key:u,tar:p}=b1(e,s),f=e.animSet?[HC(p,e.animSet,t,(n=e.animSetParallel)!==null&&n!==void 0&&n)]:[];if(u&&p){const m=(a=e.updater)!==null&&a!==void 0?a:[],y=async()=>ff(p,u,{...e,onUpdate:S=>{var M;(M=e.onUpdate)===null||M===void 0||M.call(e,S),m.forEach(P=>{var D;return(D=t[P])===null||D===void 0?void 0:D.call(t)})}});e.delay?f.push(is(e.delay).then(y)):f.push(y())}else(e.duration||e.delay)&&f.push(is(((r=e.delay)!==null&&r!==void 0?r:0)+((o=e.duration)!==null&&o!==void 0?o:0)));return f.length===1?f[0]:Promise.all(f)}async function HC(s,e,t,n=!1){if(n)return Promise.all(e.map(async r=>sw(s,r,t)));for(const r of e)await sw(s,r,t)}function WC(s,e,t,n){var r,o,a,u,p,f,m;if(!s)return;e||(e=[]);const y=n??{},S=s;for(let M=0,P=e.length;M<P;M++){const D=e[M];if(D.uiRef){const k=(p=S==null?void 0:S.indexOf(D.uiRef))!==null&&p!==void 0?p:-1;k!==M&&(k>=0&&(S==null||S.splice(k,1)),S==null||S.splice(M,0,D.uiRef))}else{D.uiRef={type:"folder",label:(r=D.name)!==null&&r!==void 0?r:"Animation "+M,children:[]};const k=[{type:"button",label:"animate",value:()=>{sw(t,D,y).then(()=>{var L;return console.log(((L=D.uiRef)===null||L===void 0?void 0:L.label)+" finished")})}}];D.access!==void 0&&k.push({type:"input",property:[D,"access"]}),D.from!==void 0&&k.push({type:(o=D.uiObjectType)!==null&&o!==void 0?o:"input",property:[D,"from"],onChange:()=>{var L;w1(D,t)(D.from),(L=D.updater)===null||L===void 0||L.forEach(R=>R in y&&y[R]())}}),D.to!==void 0&&k.push({type:(a=D.uiObjectType)!==null&&a!==void 0?a:"input",property:[D,"to"],onChange:()=>{var L;w1(D,t)(D.to),(L=D.updater)===null||L===void 0||L.forEach(R=>R in y&&y[R]())}}),D.duration!==void 0&&k.push({type:"input",property:[D,"duration"]}),D.animSet&&(D.animSetParallel||(D.animSetParallel=!1),k.push({type:"input",label:"run parallel",property:[D,"animSetParallel"]})),D.animSet&&k.push({type:"folder",label:"AnimSet",expanded:!1,children:[],animSetContainer:!0}),(u=D.uiRef.children)===null||u===void 0||u.push(...k),S==null||S.splice(M,0,D.uiRef)}const j=(f=D.uiRef.children)===null||f===void 0?void 0:f.map(k=>Se(k)).flat(2).find(k=>k==null?void 0:k.animSetContainer);D.animSet&&j&&WC(j.children,D.animSet,(m=D.targetObject)!==null&&m!==void 0?m:t,n)}}function qC(s,e){return e?s*(1e3/e):0}function kI(s){var e,t=s.from,n=t===void 0?0:t,r=s.velocity,o=r===void 0?0:r,a=s.min,u=s.max,p=s.power,f=p===void 0?.8:p,m=s.timeConstant,y=m===void 0?750:m,S=s.bounceStiffness,M=S===void 0?500:S,P=s.bounceDamping,D=P===void 0?10:P,j=s.restDelta,k=j===void 0?1:j,L=s.modifyTarget,R=s.driver,W=s.onUpdate,q=s.onComplete;function J(ze){return a!==void 0&&ze<a||u!==void 0&&ze>u}function ee(ze){return a===void 0?u:u===void 0||Math.abs(a-ze)<Math.abs(u-ze)?a:u}function he(ze){e==null||e.stop(),e=ep(ns(ns({},ze),{driver:R,onUpdate:function($e){var Ge;W==null||W($e),(Ge=ze.onUpdate)===null||Ge===void 0||Ge.call(ze,$e)},onComplete:q}))}function xe(ze){he(ns({type:"spring",stiffness:M,damping:D,restDelta:k},ze))}if(J(n))xe({from:n,velocity:o,to:ee(n)});else{var De=f*o+n;L!==void 0&&(De=L(De));var Fe,ke,Qe=ee(De),Oe=Qe===a?-1:1;he({type:"decay",from:n,velocity:o,timeConstant:y,power:f,restDelta:k,modifyTarget:L,onUpdate:J(De)?function(ze){Fe=ke,ke=ze,o=qC(ze-Fe,mg().delta),(Oe===1&&ze>Qe||Oe===-1&&ze<Qe)&&xe({from:ze,to:Qe,velocity:o})}:void 0})}return{stop:function(){return e==null?void 0:e.stop()}}}var YC=function(s){return 180*s/Math.PI},OI=function(s,e){return e===void 0&&(e=lf),YC(Math.atan2(e.y-s.y,e.x-s.x))},LI=function(s,e){var t=!0;return e===void 0&&(e=s,t=!1),function(n){return t?n-s+e:(s=n,t=!0,e)}},NI=function(s){return s},x1=function(s){return s===void 0&&(s=NI),function(e,t,n){var r=t-n,o=-(0-e+1)*(0-s(Math.abs(r)));return r<=0?t+o:t-o}},FI=x1(),UI=x1(Math.sqrt),XC=function(s){return s*Math.PI/180},ow=function(s){return s.hasOwnProperty("x")&&s.hasOwnProperty("y")},E1=function(s){return ow(s)&&s.hasOwnProperty("z")},aw=function(s,e){return Math.abs(s-e)};function jI(s,e){if(sg(s)&&sg(e))return aw(s,e);if(ow(s)&&ow(e)){var t=aw(s.x,e.x),n=aw(s.y,e.y),r=E1(s)&&E1(e)?aw(s.z,e.z):0;return Math.sqrt(Math.pow(t,2)+Math.pow(n,2)+Math.pow(r,2))}}var zI=function(s,e,t){return e=XC(e),{x:t*Math.cos(e)+s.x,y:t*Math.sin(e)+s.y}},KC=function(s,e){return e===void 0&&(e=2),e=Math.pow(10,e),Math.round(s*e)/e},JC=function(s,e,t,n){return n===void 0&&(n=0),KC(s+t*(e-s)/Math.max(n,t))},VI=function(s){s===void 0&&(s=50);var e=0,t=0;return function(n){var r=mg().timestamp,o=r!==t?r-t:0,a=o?JC(e,n,o,s):e;return t=r,e=a,a}},GI=function(s){if(typeof s=="number")return function(n){return Math.round(n/s)*s};var e=0,t=s.length;return function(n){var r=Math.abs(s[0]-n);for(e=1;e<t;e++){var o=s[e],a=Math.abs(o-n);if(a===0)return o;if(a>r)return s[e-1];if(e===t-1)return o;r=a}}};function QI(s,e){return s/(1e3/e)}var HI=function(s,e,t){var n=e-s;return((t-s)%n+n)%n+s},$C=function(s,e){return 1-3*e+3*s},ZC=function(s,e){return 3*e-6*s},eM=function(s){return 3*s},lw=function(s,e,t){return(($C(e,t)*s+ZC(e,t))*s+eM(e))*s},tM=function(s,e,t){return 3*$C(e,t)*s*s+2*ZC(e,t)*s+eM(e)},cw=.1;function WI(s,e,t,n){if(s===e&&t===n)return nf;for(var r=new Float32Array(11),o=0;o<11;++o)r[o]=lw(o*cw,s,t);return function(a){return a===0||a===1?a:lw(function(u){for(var p=0,f=1;f!==10&&r[f]<=u;++f)p+=cw;--f;var m=p+(u-r[f])/(r[f+1]-r[f])*cw,y=tM(m,s,t);return y>=.001?function(S,M,P,D){for(var j=0;j<8;++j){var k=tM(M,P,D);if(k===0)return M;M-=(lw(M,P,D)-S)/k}return M}(u,m,s,t):y===0?m:function(S,M,P,D,j){var k,L,R=0;do(k=lw(L=M+(P-M)/2,D,j)-S)>0?P=L:M=L;while(Math.abs(k)>1e-7&&++R<10);return L}(u,p,p+cw,s,t)}(a),e,n)}}var qI=function(s,e){return e===void 0&&(e="end"),function(t){var n=(t=e==="end"?Math.min(t,.999):Math.max(t,.001))*s,r=e==="end"?Math.floor(n):Math.ceil(n);return qu(0,1,r/s)}};async function YI(s,{debug:e=!1,ground:t=!0,bloom:n=!0,depthTonemap:r=!1,importPopup:o=!0,caching:a=!0}){const u=new Ya(s);u.enabled=!1,e&&await u.addPlugin(Pl),await u.addPlugin(dn,void 0,void 0,{storage:a&&window.caches?await window.caches.open("webgi-cache-storage"):void 0}),await u.addPlugin(o0),await u.addPlugin(nx),o&&await u.addPlugin(uu),await u.addPlugin(v1),await u.addPlugin(r0),await u.addPlugin(wi),await u.addPlugin(mc),await u.addPlugin(n0),await u.addPlugin(jo),await u.addPlugin($g),await u.addPlugin(t0),await u.addPlugin(Yp),await u.addPlugin(er,rv,!1,!0),await zg(u,{ground:t,bloom:n,depthTonemap:r}),await u.addPlugin(Eb,!1),await u.addPlugin(yu,!1),await u.addPlugin(s_,!1),await u.addPlugin(wp,!1),await u.addPlugin(i1),await u.addPlugin(o1),await u.addPlugin(a1),await u.addPlugin(cd,!1),await u.addPlugin(vh),await u.addPlugin(zl),await u.addPlugin(Vl),await u.addPlugin(fm),await u.addPlugin(Sp),await u.addPlugin(Ep),await u.addPlugin(ph),await u.addPlugin(fa),await u.addPlugin(Kb),await u.addPlugin(Xb),await u.addPlugin(Jb),await u.addPlugin($b),await u.addPlugin(md),await u.addPlugin(ew),await u.addPlugin(Yb);const p=await u.addPlugin(new p1(!Bp()));return u.renderer.refreshPipeline(),u.scene.addEventListener("textureAdded",f=>{f.texture&&u.scene.setEnvironment(f.texture)}),p.setupPluginUi(ts),p.setupPluginUi(md),p.setupPluginUi(ew),p.setupPluginUi(Yp),p.setupPluginUi(Yb),p.setupPluginUi(o0),p.setupPluginUi(Br),p.setupPluginUi(nu),p.setupPluginUi(Sp),p.setupPluginUi(fm),p.setupPluginUi(Kb),p.setupPluginUi(Ep),p.setupPluginUi(Qr),p.setupPluginUi(er),t&&p.setupPluginUi(ha),p.setupPluginUi(Vm),p.setupPluginUi(rs),p.setupPluginUi(ph),p.setupPluginUi(Ff),p.setupPluginUi(Fg),p.setupPluginUi(jg),p.setupPluginUi(Og),p.setupPluginUi(Lg),p.setupPluginUi(su),p.setupPluginUi(Qm),p.setupPluginUi(s_),p.setupPluginUi(wp),p.setupPluginUi(Xb),p.setupPluginUi(vh),p.setupPluginUi(zl),p.setupPluginUi(lo),p.setupPluginUi(Jb),p.setupPluginUi($b),p.setupPluginUi(Ta),p.setupPluginUi(co),n&&p.setupPluginUi(Zu),p.setupPluginUi(fa),p.setupPluginUi(pa),p.setupPluginUi(Mf),p.setupPluginUi(ma),p.setupPluginUi(Eb),p.setupPluginUi(Vl),p.setupPluginUi(Zc),p.setupPluginUi(Cf),p.setupPluginUi(lu),p.setupPluginUi($s),p.setupPluginUi(yu),p.setupPluginUi(uu),p.setupPluginUi(ga),p.setupPluginUi(cd),u.enabled=!0,u}})();__webpackgi_exports__.LY2;__webpackgi_exports__.HRj;__webpackgi_exports__.li4;__webpackgi_exports__.FO5;__webpackgi_exports__.Nlh;__webpackgi_exports__.QvI;__webpackgi_exports__.JHp;__webpackgi_exports__.bGH;__webpackgi_exports__.NDo;__webpackgi_exports__.gSk;__webpackgi_exports__.WMw;__webpackgi_exports__.OTo;__webpackgi_exports__.Se2;__webpackgi_exports__.cum;__webpackgi_exports__.Mig;__webpackgi_exports__.B$7;__webpackgi_exports__.i_9;__webpackgi_exports__.m7l;__webpackgi_exports__.sYA;__webpackgi_exports__.Xcj;__webpackgi_exports__.mzJ;__webpackgi_exports__.ZZA;__webpackgi_exports__.$Ph;__webpackgi_exports__.T__;__webpackgi_exports__.HkE;__webpackgi_exports__.tGC;__webpackgi_exports__.g1S;__webpackgi_exports__.I$C;__webpackgi_exports__.QIH;__webpackgi_exports__._JE;var __webpackgi_exports__AssetManagerPlugin=__webpackgi_exports__.ksm;__webpackgi_exports__.jl_;__webpackgi_exports__.b7R;__webpackgi_exports__.BDV;__webpackgi_exports__.Ea_;__webpackgi_exports__.qff;__webpackgi_exports__.tmC;__webpackgi_exports__.BON;__webpackgi_exports__.P40;__webpackgi_exports__.wLL;__webpackgi_exports__.iHO;__webpackgi_exports__.BbS;__webpackgi_exports__.kqm;__webpackgi_exports__.Hmr;__webpackgi_exports__.SJI;__webpackgi_exports__.mTL;__webpackgi_exports__.y8_;__webpackgi_exports__._Li;__webpackgi_exports__.g56;__webpackgi_exports__.bj3;__webpackgi_exports__.z81;__webpackgi_exports__._MY;__webpackgi_exports__.yEv;var __webpackgi_exports__BloomPlugin=__webpackgi_exports__.dFZ;__webpackgi_exports__.N$j;__webpackgi_exports__._YM;__webpackgi_exports__.TUj;__webpackgi_exports__.ZzF;__webpackgi_exports__.qzb;__webpackgi_exports__.GQ;__webpackgi_exports__.nvb;__webpackgi_exports__.DvJ;__webpackgi_exports__.fQA;__webpackgi_exports__.cPz;__webpackgi_exports__.TlE;__webpackgi_exports__.u9r;__webpackgi_exports__.s4_;__webpackgi_exports__.T95;__webpackgi_exports__.F5w;__webpackgi_exports__.NlP;__webpackgi_exports__.$8Z;__webpackgi_exports__.YYN;__webpackgi_exports__.CtF;__webpackgi_exports__.V1s;__webpackgi_exports__.jOv;__webpackgi_exports__.Rki;__webpackgi_exports__.pzV;__webpackgi_exports__.itZ;var __webpackgi_exports__CameraViewPlugin=__webpackgi_exports__.qKx;__webpackgi_exports__.vlJ;__webpackgi_exports__.nPO;__webpackgi_exports__.zcQ;var __webpackgi_exports__CanvasSnipperPlugin=__webpackgi_exports__.GH1;__webpackgi_exports__.ROQ;__webpackgi_exports__.YN5;__webpackgi_exports__.BVQ;__webpackgi_exports__.YT8;__webpackgi_exports__._DE;__webpackgi_exports__.YGz;__webpackgi_exports__.trn;__webpackgi_exports__.zf8;__webpackgi_exports__.uWy;__webpackgi_exports__.wYQ;__webpackgi_exports__.SUY;__webpackgi_exports__.Ilk;__webpackgi_exports__.R2R;__webpackgi_exports__.epp;__webpackgi_exports__.xmJ;__webpackgi_exports__.GD$;__webpackgi_exports__.EB7;__webpackgi_exports__.DqL;__webpackgi_exports__._3;__webpackgi_exports__.b_z;__webpackgi_exports__.OCn;__webpackgi_exports__._am;__webpackgi_exports__.kB7;__webpackgi_exports__.fY$;__webpackgi_exports__.vxC;__webpackgi_exports__.BtG;__webpackgi_exports__.cBK;__webpackgi_exports__.g8_;__webpackgi_exports__.AXT;__webpackgi_exports__.yj7;__webpackgi_exports__.dYG;__webpackgi_exports__.tm_;__webpackgi_exports__.S2y;__webpackgi_exports__.B02;__webpackgi_exports__.PeU;__webpackgi_exports__.Hyl;__webpackgi_exports__.Wqd;__webpackgi_exports__.Xaj;__webpackgi_exports__.DUb;__webpackgi_exports__.dZ3;__webpackgi_exports__.m_w;__webpackgi_exports__.fHI;__webpackgi_exports__.LBq;__webpackgi_exports__.dHf;__webpackgi_exports__.Qww;__webpackgi_exports__.CGV;__webpackgi_exports__.JUT;__webpackgi_exports__.p3g;__webpackgi_exports__.IEO;__webpackgi_exports__.CN8;__webpackgi_exports__.zob;__webpackgi_exports__.yxD;__webpackgi_exports__.CUS;__webpackgi_exports__.A5E;__webpackgi_exports__.zqG;__webpackgi_exports__.PfX;__webpackgi_exports__.Q1o;__webpackgi_exports__.jfJ;__webpackgi_exports__.T_J;__webpackgi_exports__.tEQ;__webpackgi_exports__.gb4;__webpackgi_exports__.qkB;__webpackgi_exports__.cvk;__webpackgi_exports__.HWo;__webpackgi_exports__.brP;__webpackgi_exports__.$YQ;__webpackgi_exports__.X8d;__webpackgi_exports__.Zdt;__webpackgi_exports__.yNB;var __webpackgi_exports__DiamondPlugin=__webpackgi_exports__.h7x;__webpackgi_exports__.Ox3;__webpackgi_exports__.qtn;__webpackgi_exports__.cBI;__webpackgi_exports__.cU9;__webpackgi_exports__.DT1;__webpackgi_exports__.Kgo;__webpackgi_exports__.ehD;__webpackgi_exports__.fhJ;__webpackgi_exports__.y1s;__webpackgi_exports__.fSK;__webpackgi_exports__.Vdb;__webpackgi_exports__.l8J;__webpackgi_exports__.dj0;__webpackgi_exports__.QM0;__webpackgi_exports__.OIS;__webpackgi_exports__.q8b;__webpackgi_exports__.TOt;__webpackgi_exports__.xaN;__webpackgi_exports__.Ny0;__webpackgi_exports__.NeD;__webpackgi_exports__.Zof;__webpackgi_exports__.eD;__webpackgi_exports__.jwo;__webpackgi_exports__.dSO;__webpackgi_exports__.Bf4;__webpackgi_exports__.USm;__webpackgi_exports__.pBf;__webpackgi_exports__.$Vf;__webpackgi_exports__.O7d;__webpackgi_exports__.ksq;__webpackgi_exports__.gXf;__webpackgi_exports__.hH6;__webpackgi_exports__.kpi;__webpackgi_exports__.DwZ;__webpackgi_exports__.kN3;__webpackgi_exports__.e62;__webpackgi_exports__.a$l;__webpackgi_exports__.OM3;__webpackgi_exports__.VzW;__webpackgi_exports__.ybr;__webpackgi_exports__.yo9;__webpackgi_exports__.$Bt;__webpackgi_exports__.Wzm;__webpackgi_exports__.Wl3;__webpackgi_exports__.iWj;__webpackgi_exports__.DNz;var __webpackgi_exports__GBufferPlugin=__webpackgi_exports__.m1M;__webpackgi_exports__.ylh;__webpackgi_exports__.v9Y;__webpackgi_exports__.LSk;__webpackgi_exports__.LHE;__webpackgi_exports__.KE0;__webpackgi_exports__.KCF;__webpackgi_exports__.a4n;__webpackgi_exports__.zIH;__webpackgi_exports__.Hfk;__webpackgi_exports__.png;__webpackgi_exports__.tAj;__webpackgi_exports__.Eb_;__webpackgi_exports__.BT2;__webpackgi_exports__._8p;__webpackgi_exports__.V5Z;var __webpackgi_exports__GammaCorrectionPlugin=__webpackgi_exports__.s5b;__webpackgi_exports__.hkn;__webpackgi_exports__.GFY;__webpackgi_exports__.w$m;__webpackgi_exports__.ksN;__webpackgi_exports__.j4z;__webpackgi_exports__.OAl;__webpackgi_exports__.VLJ;__webpackgi_exports__.C73;__webpackgi_exports__.ZAu;__webpackgi_exports__.ibP;__webpackgi_exports__._fI;__webpackgi_exports__.hUN;__webpackgi_exports__.cLu;__webpackgi_exports__.vmT;__webpackgi_exports__.Qpg;__webpackgi_exports__.So8;__webpackgi_exports__.eOv;__webpackgi_exports__.Wjw;__webpackgi_exports__.cJO;__webpackgi_exports__.QRU;__webpackgi_exports__.S3k;__webpackgi_exports__.PpQ;__webpackgi_exports__.AHu;__webpackgi_exports__.q_9;__webpackgi_exports__.ZRs;__webpackgi_exports__.oqc;__webpackgi_exports__.T_x;__webpackgi_exports__.lb7;__webpackgi_exports__.L5s;__webpackgi_exports__.$TI;__webpackgi_exports__.SPe;__webpackgi_exports__.aVm;__webpackgi_exports__.j87;__webpackgi_exports__.RNb;__webpackgi_exports__.Kz5;__webpackgi_exports__.vpT;__webpackgi_exports__.kB5;__webpackgi_exports__._C8;__webpackgi_exports__.Syv;__webpackgi_exports__.NMF;__webpackgi_exports__.pIN;__webpackgi_exports__.eMJ;__webpackgi_exports__.rN7;__webpackgi_exports__.iUp;__webpackgi_exports__.GFd;__webpackgi_exports__.x5V;__webpackgi_exports__.tUh;__webpackgi_exports__.z8B;__webpackgi_exports__.vcl;__webpackgi_exports__.GZb;__webpackgi_exports__.p7y;__webpackgi_exports__.S9g;__webpackgi_exports__.Zr5;__webpackgi_exports__.vCF;__webpackgi_exports__.yt0;__webpackgi_exports__.uXU;__webpackgi_exports__._kC;__webpackgi_exports__.lk7;__webpackgi_exports__.USc;__webpackgi_exports__.x12;__webpackgi_exports__.Zzh;__webpackgi_exports__.nls;__webpackgi_exports__.g_z;__webpackgi_exports__.U7;__webpackgi_exports__.FT0;__webpackgi_exports__.blk;__webpackgi_exports__.ejS;__webpackgi_exports__.rnI;__webpackgi_exports__.wem;__webpackgi_exports__.lfu;__webpackgi_exports__.FDw;__webpackgi_exports__.lRj;__webpackgi_exports__.D1R;__webpackgi_exports__.qyh;__webpackgi_exports__.GUF;__webpackgi_exports__.EoG;__webpackgi_exports__.aNw;__webpackgi_exports__.Zp0;__webpackgi_exports__.lLk;__webpackgi_exports__.jAl;__webpackgi_exports__.uEv;__webpackgi_exports__.YKA;__webpackgi_exports__.cRx;__webpackgi_exports__.Y8D;__webpackgi_exports__.RsA;__webpackgi_exports__.Y0m;__webpackgi_exports__.F5T;__webpackgi_exports__.EDU;__webpackgi_exports__.z$Q;__webpackgi_exports__.KA8;__webpackgi_exports__.XUj;__webpackgi_exports__.Me$;__webpackgi_exports__.u7G;__webpackgi_exports__.PEk;__webpackgi_exports__.BG4;__webpackgi_exports__.M8C;__webpackgi_exports__.Vkp;__webpackgi_exports__.yGw;__webpackgi_exports__.Sm8;__webpackgi_exports__.Kj0;__webpackgi_exports__.vBJ;__webpackgi_exports__.QfV;__webpackgi_exports__.lRF;__webpackgi_exports__.Lun;__webpackgi_exports__.YBo;__webpackgi_exports__.kaV;__webpackgi_exports__.RSm;__webpackgi_exports__.xoR;__webpackgi_exports__.EJi;__webpackgi_exports__.Wid;__webpackgi_exports__.iuj;__webpackgi_exports__.IKL;__webpackgi_exports__.r_;__webpackgi_exports__.OoA;__webpackgi_exports__.qhX;__webpackgi_exports__.qPT;__webpackgi_exports__.M5h;__webpackgi_exports__.Ns1;__webpackgi_exports__.TyD;__webpackgi_exports__.vZf;__webpackgi_exports__.HTd;__webpackgi_exports__.aH4;__webpackgi_exports__.YLQ;__webpackgi_exports__.BVF;__webpackgi_exports__.MyG;__webpackgi_exports__.jFi;__webpackgi_exports__.aCh;__webpackgi_exports__.uL9;__webpackgi_exports__.TNj;__webpackgi_exports__.IFH;__webpackgi_exports__.bdR;__webpackgi_exports__.kM_;__webpackgi_exports__.M6v;__webpackgi_exports__.RvT;__webpackgi_exports__.dUE;__webpackgi_exports__.oe_;__webpackgi_exports__.BuN;__webpackgi_exports__.Tme;__webpackgi_exports__.N9P;__webpackgi_exports__.Gql;__webpackgi_exports__.$XY;__webpackgi_exports__.O9d;__webpackgi_exports__.zEO;__webpackgi_exports__.qfx;__webpackgi_exports__.PA7;__webpackgi_exports__.REq;__webpackgi_exports__.pQR;__webpackgi_exports__.ghN;__webpackgi_exports__.Hy8;__webpackgi_exports__.Wpd;__webpackgi_exports__.LgZ;__webpackgi_exports__.iWC;__webpackgi_exports__.mqn;__webpackgi_exports__.SKe;__webpackgi_exports__.iKG;__webpackgi_exports__._iA;__webpackgi_exports__.ntZ;__webpackgi_exports__.anP;__webpackgi_exports__.X2e;__webpackgi_exports__.FCo;__webpackgi_exports__.y$t;__webpackgi_exports__.cPb;__webpackgi_exports__.lmx;__webpackgi_exports__.JOQ;__webpackgi_exports__.BKK;__webpackgi_exports__._12;__webpackgi_exports__.tJx;__webpackgi_exports__.cek;__webpackgi_exports__.qD0;__webpackgi_exports__.xG9;__webpackgi_exports__.wI8;__webpackgi_exports__.Sgv;__webpackgi_exports__.woe;__webpackgi_exports__.UY4;__webpackgi_exports__.aq0;__webpackgi_exports__.ujx;__webpackgi_exports__.Uol;__webpackgi_exports__.JiH;__webpackgi_exports__.VYz;__webpackgi_exports__._Pm;var __webpackgi_exports__ProgressivePlugin=__webpackgi_exports__.EsW;__webpackgi_exports__.iUV;__webpackgi_exports__.tf;__webpackgi_exports__.ZQ6;__webpackgi_exports__.mXe;__webpackgi_exports__._fP;__webpackgi_exports__.iLg;__webpackgi_exports__.zbs;__webpackgi_exports__.UZH;__webpackgi_exports__.mSO;__webpackgi_exports__.wk1;__webpackgi_exports__.E2K;__webpackgi_exports__.FUD;__webpackgi_exports__.pKu;__webpackgi_exports__.GG6;__webpackgi_exports__.Gih;__webpackgi_exports__.iiP;__webpackgi_exports__.SvJ;__webpackgi_exports__.ptH;__webpackgi_exports__.jZA;__webpackgi_exports__.y2t;__webpackgi_exports__.gi4;__webpackgi_exports__.Djp;__webpackgi_exports__.BG$;__webpackgi_exports__.NYV;__webpackgi_exports__.xJs;__webpackgi_exports__.bsb;__webpackgi_exports__.ekQ;__webpackgi_exports__.CaW;__webpackgi_exports__.eaV;__webpackgi_exports__.BFQ;__webpackgi_exports__.v3W;__webpackgi_exports__.ILR;__webpackgi_exports__.UCm;__webpackgi_exports__.Inb;__webpackgi_exports__.U1$;__webpackgi_exports__.LgE;__webpackgi_exports__.fto;__webpackgi_exports__.l0P;__webpackgi_exports__.vCx;__webpackgi_exports__._AM;__webpackgi_exports__.wuA;__webpackgi_exports__.av9;__webpackgi_exports__.CtA;__webpackgi_exports__.BvQ;__webpackgi_exports__.FZJ;__webpackgi_exports__.FIo;__webpackgi_exports__.zHn;__webpackgi_exports__.iMs;__webpackgi_exports__.T_f;__webpackgi_exports__.hEm;__webpackgi_exports__.D9w;__webpackgi_exports__.sHH;__webpackgi_exports__.CdI;__webpackgi_exports__.rkc;__webpackgi_exports__.rpg;__webpackgi_exports__.ce8;__webpackgi_exports__.rOj;__webpackgi_exports__.P6m;__webpackgi_exports__.JA6;__webpackgi_exports__.V4E;__webpackgi_exports__.o8S;__webpackgi_exports__.flB;__webpackgi_exports__.DUH;__webpackgi_exports__.KI_;__webpackgi_exports__.iLN;__webpackgi_exports__.jsw;__webpackgi_exports__.srG;__webpackgi_exports__.i6Z;__webpackgi_exports__.vfv;__webpackgi_exports__.xsS;__webpackgi_exports__.or;__webpackgi_exports__.EQj;__webpackgi_exports__.ov0;__webpackgi_exports__.WdD;__webpackgi_exports__.Vj0;__webpackgi_exports__.jyz;__webpackgi_exports__.mTM;__webpackgi_exports__.Mn1;__webpackgi_exports__.Hlq;__webpackgi_exports__.Fi7;__webpackgi_exports__.Tn7;__webpackgi_exports__.bnF;__webpackgi_exports__.HW6;__webpackgi_exports__.oa8;__webpackgi_exports__.T_1;__webpackgi_exports__.zHJ;__webpackgi_exports__.iDF;__webpackgi_exports__.iAb;__webpackgi_exports__.d4E;__webpackgi_exports__.lBg;__webpackgi_exports__.JeJ;__webpackgi_exports__.FKY;__webpackgi_exports__.zlZ;__webpackgi_exports__.vkg;__webpackgi_exports__.brh;__webpackgi_exports__.kZK;__webpackgi_exports__.puG;__webpackgi_exports__.OdW;__webpackgi_exports__._YX;__webpackgi_exports__.TUv;__webpackgi_exports__.Hw6;__webpackgi_exports__.aLr;__webpackgi_exports__.Aip;__webpackgi_exports__.xo$;__webpackgi_exports__.bIn;__webpackgi_exports__.$V;__webpackgi_exports__.lDi;__webpackgi_exports__.gti;__webpackgi_exports__.PMe;__webpackgi_exports__.iwP;__webpackgi_exports__.FvO;__webpackgi_exports__.jyi;__webpackgi_exports__.xeV;__webpackgi_exports__.k74;__webpackgi_exports__.RlZ;__webpackgi_exports__.KhW;__webpackgi_exports__.HgB;__webpackgi_exports__.W2J;__webpackgi_exports__.JWc;__webpackgi_exports__.u37;__webpackgi_exports__.Z6B;__webpackgi_exports__.QZ1;__webpackgi_exports__.Ir4;__webpackgi_exports__.NwF;__webpackgi_exports__.Wbm;__webpackgi_exports__.N4l;__webpackgi_exports__.ej9;__webpackgi_exports__.QmN;__webpackgi_exports__.IOt;__webpackgi_exports__.NOD;__webpackgi_exports__.L5g;__webpackgi_exports__.H$k;__webpackgi_exports__.cuP;__webpackgi_exports__.xEZ;__webpackgi_exports__.dpR;__webpackgi_exports__.wOD;__webpackgi_exports__.KNb;var __webpackgi_exports__TonemapPlugin=__webpackgi_exports__.IiN;__webpackgi_exports__.Cne;__webpackgi_exports__.XvJ;__webpackgi_exports__.XZw;__webpackgi_exports__.FE5;__webpackgi_exports__.lVp;__webpackgi_exports__.CJI;__webpackgi_exports__.z$h;__webpackgi_exports__.UlW;__webpackgi_exports__.WwZ;__webpackgi_exports__.Lcc;__webpackgi_exports__.WXh;__webpackgi_exports__.Vjr;__webpackgi_exports__.LuM;__webpackgi_exports__.LP5;__webpackgi_exports__.xfE;__webpackgi_exports__.qlB;__webpackgi_exports__.lCJ;__webpackgi_exports__.WTc;__webpackgi_exports__.rAo;__webpackgi_exports__.LZj;__webpackgi_exports__.xWb;__webpackgi_exports__.gH0;__webpackgi_exports__.rBU;__webpackgi_exports__.rDY;__webpackgi_exports__.ywz;__webpackgi_exports__.wJv;__webpackgi_exports__.JQ4;__webpackgi_exports__.k0A;__webpackgi_exports__.irR;__webpackgi_exports__.LsT;__webpackgi_exports__.q5h;__webpackgi_exports__.TKh;__webpackgi_exports__.tyg;__webpackgi_exports__.Ro5;__webpackgi_exports__.dwk;__webpackgi_exports__.FM8;__webpackgi_exports__.Pa4;__webpackgi_exports__.Ltg;__webpackgi_exports__.yC1;__webpackgi_exports__.lHq;__webpackgi_exports__.fO1;var __webpackgi_exports__ViewerApp=__webpackgi_exports__.oMA;__webpackgi_exports__.JzW;__webpackgi_exports__.QEt;__webpackgi_exports__.b5g;__webpackgi_exports__.Ywn;__webpackgi_exports__.GVz;__webpackgi_exports__.oAp;__webpackgi_exports__.kFz;__webpackgi_exports__.p7A;__webpackgi_exports__.dd2;__webpackgi_exports__.CP7;__webpackgi_exports__.fQK;__webpackgi_exports__.Wd$;__webpackgi_exports__.t1_;__webpackgi_exports__.Uk6;__webpackgi_exports__._sL;__webpackgi_exports__.Pnf;__webpackgi_exports__.c8b;__webpackgi_exports__._lf;__webpackgi_exports__.ad5;__webpackgi_exports__.sZV;__webpackgi_exports__.TfA;__webpackgi_exports__.sKX;__webpackgi_exports__.UdM;__webpackgi_exports__.P0y;__webpackgi_exports__.L_r;__webpackgi_exports__.Bve;__webpackgi_exports__.UeO;__webpackgi_exports__.$nx;__webpackgi_exports__.Bk6;__webpackgi_exports__.y4l;__webpackgi_exports__.pQ0;__webpackgi_exports__.wXW;__webpackgi_exports__.r5x;__webpackgi_exports__.MSI;__webpackgi_exports__.EUu;__webpackgi_exports__.jtH;__webpackgi_exports__.T0T;__webpackgi_exports__.gAb;__webpackgi_exports__.iwT;__webpackgi_exports__.je_;__webpackgi_exports__.wBP;__webpackgi_exports__.LU2;__webpackgi_exports__.wQL;__webpackgi_exports__.Zs7;__webpackgi_exports__.x7s;__webpackgi_exports__.Mnd;__webpackgi_exports__.A0_;__webpackgi_exports__.d73;__webpackgi_exports__.HCD;__webpackgi_exports__.RG9;__webpackgi_exports__.G2P;__webpackgi_exports__.XLf;__webpackgi_exports__.CGN;__webpackgi_exports__.mvg;__webpackgi_exports__.Hiy;__webpackgi_exports__.XMc;__webpackgi_exports__.N7M;__webpackgi_exports__.iv;__webpackgi_exports__.n55;__webpackgi_exports__.IaC;__webpackgi_exports__.h9t;__webpackgi_exports__.yDW;__webpackgi_exports__.gJv;__webpackgi_exports__.l$g;__webpackgi_exports__.vQi;__webpackgi_exports__.$MY;__webpackgi_exports__.wJl;__webpackgi_exports__.Z7Y;__webpackgi_exports__.X7D;__webpackgi_exports__.BnX;__webpackgi_exports__.uZ5;__webpackgi_exports__.zVI;__webpackgi_exports__.DpF;__webpackgi_exports__.nNb;__webpackgi_exports__.cqZ;__webpackgi_exports__.pKN;__webpackgi_exports__.d_$;__webpackgi_exports__.DdI;__webpackgi_exports__.rrX;__webpackgi_exports__.KlC;__webpackgi_exports__.KVn;__webpackgi_exports__.oau;__webpackgi_exports__.aw9;__webpackgi_exports__.Aap;__webpackgi_exports__.Dxg;__webpackgi_exports__.MjT;__webpackgi_exports__.F7Q;__webpackgi_exports__.IFq;__webpackgi_exports__.IJl;__webpackgi_exports__.O5A;__webpackgi_exports__.wCn;__webpackgi_exports__.gGT;__webpackgi_exports__.pEc;__webpackgi_exports__.Bi6;__webpackgi_exports__.fi_;__webpackgi_exports__.TT;__webpackgi_exports__.q2Z;__webpackgi_exports__.NyK;__webpackgi_exports__.bgu;__webpackgi_exports__.kcS;__webpackgi_exports__.rRN;__webpackgi_exports__.ivY;__webpackgi_exports__._s1;__webpackgi_exports__._HO;__webpackgi_exports__.tpL;__webpackgi_exports__.DMK;__webpackgi_exports__.LjN;__webpackgi_exports__.iFs;__webpackgi_exports__.qTg;__webpackgi_exports__.Wtl;__webpackgi_exports__.DmK;__webpackgi_exports__.Htt;__webpackgi_exports__.Hx7;__webpackgi_exports__.imt;__webpackgi_exports__.US6;__webpackgi_exports__.vZs;__webpackgi_exports__.TE$;__webpackgi_exports__.lmu;__webpackgi_exports__.SvO;__webpackgi_exports__.YQY;__webpackgi_exports__.mZN;__webpackgi_exports__.VvG;__webpackgi_exports__.omp;__webpackgi_exports__.utz;__webpackgi_exports__.TFV;__webpackgi_exports__.hrz;__webpackgi_exports__.JKM;__webpackgi_exports__.jZf;__webpackgi_exports__.RjL;__webpackgi_exports__.RRI;__webpackgi_exports__.RUq;__webpackgi_exports__._t4;__webpackgi_exports__.YHh;__webpackgi_exports__.R8g;__webpackgi_exports__.Bbl;__webpackgi_exports__.V9r;__webpackgi_exports__.PZ2;__webpackgi_exports__.w7A;__webpackgi_exports__.N6S;__webpackgi_exports__.Uxp;__webpackgi_exports__.tAz;__webpackgi_exports__.R$F;__webpackgi_exports__.N33;__webpackgi_exports__.gw2;__webpackgi_exports__.KlU;__webpackgi_exports__.wo6;__webpackgi_exports__.H4P;__webpackgi_exports__.swA;__webpackgi_exports__._Z3;__webpackgi_exports__.ivc;__webpackgi_exports__.rZ1;__webpackgi_exports__.CpZ;__webpackgi_exports__.dyc;__webpackgi_exports__.MxZ;__webpackgi_exports__.btp;__webpackgi_exports__.mXy;__webpackgi_exports__.Ej0;__webpackgi_exports__.ep4;__webpackgi_exports__.DQP;__webpackgi_exports__.VNr;__webpackgi_exports__.V7q;__webpackgi_exports__.zEk;__webpackgi_exports__.qfq;__webpackgi_exports__.piB;__webpackgi_exports__.IIc;__webpackgi_exports__.rrF;__webpackgi_exports__.naq;__webpackgi_exports__.sXR;__webpackgi_exports__.p5I;__webpackgi_exports__.wps;__webpackgi_exports__.wuo;__webpackgi_exports__.GpE;__webpackgi_exports__.F4b;__webpackgi_exports__.t$v;__webpackgi_exports__.tdn;__webpackgi_exports__.Y9t;__webpackgi_exports__.GEo;__webpackgi_exports__.DH3;__webpackgi_exports__.uxM;__webpackgi_exports__.zH3;__webpackgi_exports__.MLs;__webpackgi_exports__.xXG;__webpackgi_exports__.YM4;__webpackgi_exports__.B3r;__webpackgi_exports__.iAx;__webpackgi_exports__.lDn;__webpackgi_exports__.oaQ;__webpackgi_exports__.CD7;__webpackgi_exports__.Rc0;__webpackgi_exports__.iPG;__webpackgi_exports__.TIc;__webpackgi_exports__.xsC;__webpackgi_exports__.zOc;__webpackgi_exports__.r46;__webpackgi_exports__.z2C;__webpackgi_exports__._X$;__webpackgi_exports__._yn;__webpackgi_exports__.Dyg;__webpackgi_exports__.cUc;__webpackgi_exports__.zGw;__webpackgi_exports__.Ctq;__webpackgi_exports__.$ch;__webpackgi_exports__.k5b;__webpackgi_exports__.kZl;__webpackgi_exports__.OCg;__webpackgi_exports__.YjH;__webpackgi_exports__.Ui8;__webpackgi_exports__.YD2;__webpackgi_exports__.vi9;__webpackgi_exports__.ij3;__webpackgi_exports__.YPW;__webpackgi_exports__.Bg1;__webpackgi_exports__.kon;__webpackgi_exports__.M3g;__webpackgi_exports__.F2z;__webpackgi_exports__.pJF;__webpackgi_exports__.knz;__webpackgi_exports__.Ejo;__webpackgi_exports__.BgY;__webpackgi_exports__.qCG;__webpackgi_exports__.HD9;__webpackgi_exports__.fEB;__webpackgi_exports__.Udc;__webpackgi_exports__.ZQg;__webpackgi_exports__.ofC;__webpackgi_exports__.yRy;__webpackgi_exports__._NL;__webpackgi_exports__.LCA;__webpackgi_exports__.j1w;__webpackgi_exports__.i8J;__webpackgi_exports__.p7C;__webpackgi_exports__.ZAS;__webpackgi_exports__.ipH;__webpackgi_exports__.$TF;__webpackgi_exports__.uZI;__webpackgi_exports__.VWG;__webpackgi_exports__.pQ7;__webpackgi_exports__.STw;__webpackgi_exports__.jc8;__webpackgi_exports__.BL_;__webpackgi_exports__.S6;__webpackgi_exports__.T8U;__webpackgi_exports__.TD6;__webpackgi_exports__.akS;__webpackgi_exports__.QKE;__webpackgi_exports__.dKx;__webpackgi_exports__.OvX;__webpackgi_exports__.VsW;__webpackgi_exports__.YMc;__webpackgi_exports__.aPg;__webpackgi_exports__.LFn;__webpackgi_exports__.wey;__webpackgi_exports__.MaE;__webpackgi_exports__.s4x;__webpackgi_exports__.FJA;__webpackgi_exports__.vIA;__webpackgi_exports__.Spv;__webpackgi_exports__.w8l;__webpackgi_exports__.riG;__webpackgi_exports__.Kbh;__webpackgi_exports__.t8K;__webpackgi_exports__.Q7n;__webpackgi_exports__.KGF;__webpackgi_exports__.e5;__webpackgi_exports__.Rik;__webpackgi_exports__.GZo;__webpackgi_exports__.Bds;__webpackgi_exports__.HTu;__webpackgi_exports__.cTq;__webpackgi_exports__.X_Y;__webpackgi_exports__.dA8;__webpackgi_exports__.bwS;__webpackgi_exports__.Lks;__webpackgi_exports__.Rvq;__webpackgi_exports__.P4F;__webpackgi_exports__.Pd0;__webpackgi_exports__.Pjo;__webpackgi_exports__.Tum;__webpackgi_exports__.dRH;__webpackgi_exports__.RX0;__webpackgi_exports__.reQ;__webpackgi_exports__.cWm;__webpackgi_exports__.NC9;__webpackgi_exports__.$Re;__webpackgi_exports__.Xo9;__webpackgi_exports__.LNO;__webpackgi_exports__.iZP;gsapWithCSS.registerPlugin(ScrollTrigger);const arrow=document.querySelector(".arrow"),section01=document.querySelector(".section-1");arrow.addEventListener("click",()=>{section01.scrollIntoView()});async function setupViewer(){const K=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("hero-canvas")}),A=await K.addPlugin(__webpackgi_exports__AssetManagerPlugin);await K.addPlugin(__webpackgi_exports__GBufferPlugin),await K.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await K.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await K.addPlugin(__webpackgi_exports__DiamondPlugin),await K.addPlugin(__webpackgi_exports__CameraViewPlugin),await K.addPlugin(__webpackgi_exports__BloomPlugin),await K.addPlugin(__webpackgi_exports__CanvasSnipperPlugin),await K.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),K.renderer.refreshPipeline(),await A.addFromPath("./model/ring08.glb"),K.scene.activeCamera.setCameraOptions({zoom:.8});const w=K.getPlugin(__webpackgi_exports__CameraViewPlugin);w==null||w.animateAllViews()}setupViewer().then();gsapWithCSS.registerPlugin(ScrollTrigger);ScrollTrigger.create({trigger:".section-1",pin:"#ring-area-2",start:"center center",endTrigger:".section-3",end:"top top",scrub:1});async function setupViewer2(){const K=new __webpackgi_exports__ViewerApp({canvas:document.getElementById("canvas-2")}),A=await K.addPlugin(__webpackgi_exports__AssetManagerPlugin);await K.addPlugin(__webpackgi_exports__GBufferPlugin),await K.addPlugin(new __webpackgi_exports__ProgressivePlugin(32)),await K.addPlugin(__webpackgi_exports__GammaCorrectionPlugin),await K.addPlugin(__webpackgi_exports__DiamondPlugin),await K.addPlugin(__webpackgi_exports__CameraViewPlugin),await K.addPlugin(__webpackgi_exports__BloomPlugin),await K.addPlugin(__webpackgi_exports__CanvasSnipperPlugin),await K.addPlugin(new __webpackgi_exports__TonemapPlugin(!0)),K.renderer.refreshPipeline(),await A.addFromPath("./model/ring09.glb");const w=K.scene.activeCamera.controls;K.scene.activeCamera.setCameraOptions({zoom:.8}),w&&(w.autoRotate=!0,w.enableDamping=!0,w.enableZoom=!1,w.autoRotateSpeed=1);const c=K.getPlugin(__webpackgi_exports__CameraViewPlugin);c==null||c.camViews[0].focusView(),ScrollTrigger.create({trigger:".section-1",start:"top top",endTrigger:".section-1",end:"center center",onEnter:()=>{c==null||c.camViews[0].focusView()},onEnterBack:()=>{c==null||c.camViews[0].focusView()},scrub:1}),ScrollTrigger.create({trigger:".section-2",start:"top center",endTrigger:".section-2",end:"top bottom",onEnter:()=>{c==null||c.camViews[1].focusView()},onEnterBack:()=>{c==null||c.camViews[0].focusView()},scrub:1}),ScrollTrigger.create({trigger:".section-3",start:"top center",endTrigger:".section-3",end:"top bottom",onEnter:()=>{c==null||c.camViews[2].focusView()},onEnterBack:()=>{c==null||c.camViews[1].focusView()},scrub:1})}setupViewer2().then();
